<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45690251">
          <h3><a class="item" href="https://roc.camera/">Roc Camera</a></h3>
          <section>
            <h4>
              <span>2025-10-24 @ 02:54:29</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45690251"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45690045">
          <h3>
            <a class="item" href="https://prog21.dadgum.com/210.html"
              >Computer science courses that don't exist, but should (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-24 @ 02:22:07</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45690045"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45688836">
          <h3>
            <a class="item" href="https://github.com/xyflow/xyflow"
              >React Flow, open source libraries for node-based UIs with React
              or Svelte</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 23:33:28</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45688836"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45688443">
          <h3>
            <a
              class="item"
              href="https://journals.sagepub.com/doi/10.1177/2515245917744314"
              >Introduction to the concept of likelihood and its applications
              (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 22:52:15</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45688443"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45688236">
          <h3>
            <a
              class="item"
              href="https://adrs-ucb.notion.site/moe-load-balancing"
              >Automating Algorithm Discovery: A Case Study in MoE Load
              Balancing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 22:35:22</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45688236"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45688006">
          <h3>
            <a
              class="item"
              href="https://9to5mac.com/2025/10/23/apple-loses-uk-app-store-monopoly-case-penalty-might-near-2-billion/"
              >Apple loses UK App Store monopoly case, penalty might near $2B</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 22:11:23</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45688006"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45687796">
          <h3>
            <a
              class="item"
              href="https://info.varnish-software.com/blog/how-memory-maps-mmap-deliver-25x-faster-file-access-in-go"
              >How memory maps (mmap) deliver faster file access in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 21:56:07</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45687796"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45687458">
          <h3>
            <a
              class="item"
              href="https://jyu.dev/blog/why-dev-null-is-an-acid-compliant-database/"
              >/dev/null is an ACID compliant database</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 21:28:02</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45687458"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45687441">
          <h3>
            <a
              class="item"
              href="https://www.henrikkarlsson.xyz/p/wordless-thought"
              >When is it better to think without words?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 21:26:57</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45687441"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45686280">
          <h3>
            <a class="item" href="https://notes.xeome.dev/notes/Zram"
              >Zram Performance Analysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 19:58:12</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45686280"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45685793">
          <h3>
            <a class="item" href="https://opensnowcat.io/"
              >Show HN: OpenSnowcat – A fork of Snowplow to keep open analytics
              alive</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 19:24:04</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45685793"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                What made me fall in love with Snowplow was that it was
                unopinionated, gave access to raw event data, and was truly open
                source. Back in 2013, that changed everything for me. I couldn’t
                look at GA the same way again.
              </p>
              <p>
                Over the years, analytics moved into SQL warehouses driven by
                cheaper CPU/storage, dbt, reproducibility, and transparency. I
                saw the need for a democratized Snowplow pipeline and launched a
                hosted version in 2019.
              </p>
              <p>
                In January 2024, Snowplow changed its license (SLULA),
                effectively ending open-source Snowplow by restricting
                production use. When that happened, I realized the spirit of
                open data and open architecture was gone.
              </p>
              <p>A week later, I forked it, I wanted to keep the idea alive.</p>
              <p>
                OpenSnowcat keeps the original collector and enricher under
                Apache 2.0 and stays fully compatible with existing Snowplow
                pipelines. We maintain it with regular patches, performance
                optimizations, and integrations with modern tools like
                Warpstream Bento for event processing/routing.
              </p>
              <p>The goal is simple: keep open analytics open.</p>
              <p>
                Would love to hear how others in the community think we can
                preserve openness in data infrastructure as “open source”
                becomes increasingly commercialized.
              </p>
              <p>
                That's it, I should have posted here earlier but now felt right.
              </p>
            </div>
          </section>
        </section>
        <section id="45685007">
          <h3>
            <a
              class="item"
              href="https://www.volts.wtf/p/can-second-life-ev-batteries-work"
              >Can “second life” EV batteries work as grid-scale energy
              storage?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 18:15:45</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45685007"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45684934">
          <h3>
            <a
              class="item"
              href="https://www.dexerto.com/entertainment/armed-police-swarm-student-after-ai-mistakes-bag-of-doritos-for-a-weapon-3273512/"
              >Armed police swarm student after AI mistakes bag of Doritos for a
              weapon</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 18:09:37</span
              ><span class="points-container"
                >Points: <span class="points">535</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45684934"
                  >Comments</a
                ><span class="descendants">: 327</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45684236">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/openai-acquires-software-applications-incorporated"
              >OpenAI acquires Sky.app</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 17:04:17</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45684236"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45684155">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/research/new-updates-and-more-access-to-google-earth-ai/"
              >New updates and more access to Google Earth AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 16:58:04</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45684155"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45684134">
          <h3>
            <a class="item" href="https://www.anthropic.com/news/memory"
              >Claude Memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 16:56:07</span
              ><span class="points-container"
                >Points: <span class="points">405</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45684134"
                  >Comments</a
                ><span class="descendants">: 226</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45683152">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/finance/currencies/trump-pardons-convicted-binance-founder-7509bd63"
              >Trump pardons convicted Binance founder</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 15:41:48</span
              ><span class="points-container"
                >Points: <span class="points">806</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45683152"
                  >Comments</a
                ><span class="descendants">: 834</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45682776">
          <h3>
            <a class="item" href="https://twigg.ai"
              >Show HN: Git for LLMs – A context management interface</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 15:12:57</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45682776"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              <p>
                During our master’s we continually found the same pain points
                cropping up when using LLMs. The linear nature of typical LLMs
                interfaces - like ChatGPT and Claude - made it really easy to
                get lost without any easy way to visualise or navigate your
                project.
              </p>
              <p>
                Worst of all, none of them are well suited for long term
                projects. We found ourselves spending days using the same chat,
                only for it to eventually break. Transferring context from one
                chat to another is also cumbersome. We decided to build
                something more intuitive to the ways humans think.
              </p>
              <p>
                We started with two simple ideas. Enabling chat branching for
                exploring tangents, and an interactive tree diagram to allow for
                easy visualisation and navigation of your project.
              </p>
              <p>
                Twigg has developed into an interface for context management -
                like “Git for LLMs”. We believe the input to a model - or the
                context - is fundamental to its performance. To extract the
                maximum potential of an LLM, we believe the users need complete
                control over exactly what context is provided to the model,
                which you can do using simple features like cut, copy and delete
                to manipulate your tree.
              </p>
              <p>
                Through Twigg, you can access a variety of LLMs from all the
                major providers, like ChatGPT, Gemini, Claude, and Grok. Aside
                from a standard tiered subscription model (free, plus, pro), we
                also offer a Bring Your Own Key (BYOK) service, where you can
                plug and play with your own API keys.
              </p>
              <p>
                Our target audience are technical users who use LLMs for large
                projects on a regular basis. If this sounds like you, please try
                out Twigg, you can sign up for free at
                <a href="https://twigg.ai/">https://twigg.ai/</a>. We would love
                to get your feedback!
              </p>
            </div>
          </section>
        </section>
        <section id="45681147">
          <h3>
            <a
              class="item"
              href="https://www.yahoo.com/news/articles/us-investigates-waymo-robotaxis-over-102015308.html"
              >US probes Waymo robotaxis over school bus safety</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 12:40:57</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45681147"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45680237">
          <h3>
            <a
              class="item"
              href="https://pytorch.org/blog/introducing-pytorch-monarch/"
              >PyTorch Monarch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 10:15:12</span
              ><span class="points-container"
                >Points: <span class="points">322</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45680237"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45677139">
          <h3>
            <a class="item" href="https://aws.amazon.com/message/101925/"
              >Summary of the Amazon DynamoDB Service Disruption in US-East-1
              Region</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 01:19:58</span
              ><span class="points-container"
                >Points: <span class="points">440</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45677139"
                  >Comments</a
                ><span class="descendants">: 135</span></span
              >
            </h4>
            <div class="text">
              <i>AWS multiple services outage in us-east-1</i> -
              <a href="https://news.ycombinator.com/item?id=45640838"
                >https://news.ycombinator.com/item?id=45640838</a
              >
              (2045 comments)
            </div>
          </section>
        </section>
        <section id="45639618">
          <h3>
            <a class="item" href="https://github.com/pyscripter/pyscripter"
              >Pyscripter – Open-source Python IDE written in Delphi</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-20 @ 02:03:40</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45639618"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45626685">
          <h3>
            <a
              class="item"
              href="https://assetstore.unity.com/packages/tools/camera/vr-without-glasses-for-webgl-332314"
              >Glasses-free 3D using webcam head tracking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-18 @ 12:07:40</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45626685"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45613327">
          <h3>
            <a
              class="item"
              href="https://americanhistory.si.edu/explore/stories/betty-white-world-war-ii"
              >Betty White's shoulder bag is a time capsule of World War II
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-17 @ 04:28:46</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45613327"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45597198">
          <h3>
            <a
              class="item"
              href="https://joeyh.name/blog/entry/cheap_DIY_solar_fence_design/"
              >Cheap DIY solar fence design</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-15 @ 19:23:39</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45597198"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45584500">
          <h3>
            <a
              class="item"
              href="https://chillphysicsenjoyer.substack.com/p/i-managed-to-grow-countable-yeast"
              >I managed to grow countable yeast colonies</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 20:36:09</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45584500"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45581305">
          <h3>
            <a
              class="item"
              href="https://planetscale.com/blog/benchmarking-postgres-17-vs-18"
              >Benchmarking Postgres 17 vs. 18</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 15:35:44</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45581305"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45580795">
          <h3>
            <a class="item" href="https://kaitai.io/"
              >Kaitai Struct: declarative binary format parsing language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 14:51:29</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45580795"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45550588">
          <h3>
            <a
              class="item"
              href="https://www.bostonglobe.com/2025/10/10/business/dunkin-donuts-scott-murphy-bain-capital-carlyle-inspire/"
              >Dunkin’ Donuts started as a small Quincy coffee and doughnut
              shop</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 16:47:31</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45550588"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45545860">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Deepstaria_enigmatica"
              >Deepstaria Enigmatica</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 01:49:07</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45545860"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
