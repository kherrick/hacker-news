<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37085097">
          <h3>
            <a
              class="item"
              href="https://status.render.com/incidents/cshql6qwnldj"
              >Websites and APIs on Render are unavailable due to Cloudflare
              network errors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-11 @ 04:25:58</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37085097"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37084677">
          <h3>
            <a
              class="item"
              href="https://blog.mozilla.org/addons/2023/08/10/prepare-your-firefox-desktop-extension-for-the-upcoming-android-release/"
              >Firefox desktop extensions coming soon for the upcoming Android
              release</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-11 @ 03:09:30</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37084677"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37084575">
          <h3>
            <a class="item" href="https://github.com/google/git-appraise"
              >git-appraise – Distributed Code Review for Git</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-11 @ 02:52:46</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37084575"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37084262">
          <h3>
            <a
              class="item"
              href="https://www.javiergonzalez.io/blog/i-fixed-a-bug/"
              >I fixed a bug the other day</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-11 @ 02:06:47</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37084262"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37083309">
          <h3>
            <a class="item" href="https://ofrak.com/tetris/"
              >Show HN: Tetris, but the blocks are ARM instructions that execute
              in the browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 23:56:03</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37083309"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                In the game, 32-bit, little-endian ARM assembly instructions
                fall, and you can modify the operands before executing them on a
                CPU emulator. There are two segments mapped – one for
                instructions, and one for data (though both have read, write,
                and execute permissions). Your score is a four byte signed
                integer stored at the virtual address pointed to by the R12
                register, and the goal is to use the instructions that fall to
                make the score value in memory as high as possible. When it's
                game over, you can download your game as an ELF to relive the
                glory in GDB on your favorite ARM device.
              </p>
              <p>
                The CPU emulator is a version of Unicorn (<a
                  href="https://www.unicorn-engine.org/"
                  >https://www.unicorn-engine.org/</a
                >) that has been cross-compiled to WebAssembly (<a
                  href="https://alexaltea.github.io/unicorn.js/"
                  >https://alexaltea.github.io/unicorn.js/</a
                >), so everything on the page runs in the browser without the
                need for any complicated infrastructure on the back end.
              </p>
              <p>
                Since I've only been working on this for a short period of time
                leading up to its debut at DEF CON, there are still many more
                features I'd eventually like to implement. These include adding
                support for other ISAs besides ARM, adding an instruction
                reference manual, and lots of little cleanups, bug fixes, and
                adjustments.
              </p>
              <p>
                My highest score is 509,644,979, but my average is about
                131,378.
              </p>
              <p>
                I look forward to feedback, bug reports, feature requests, and
                strategy discussions!
              </p>
            </div>
          </section>
        </section>
        <section id="37082941">
          <h3>
            <a class="item" href="https://www.sqlite.org/json1.html"
              >SQLite Functions for Working with JSON</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 23:14:08</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37082941"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37082771">
          <h3>
            <a
              class="item"
              href="https://github.com/id-Software/quake2-rerelease-dll"
              >Source code for Quake 2 rerelease</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 22:57:10</span
              ><span class="points-container"
                >Points: <span class="points">355</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37082771"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37082289">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2020/Oct/9/git-scraping/"
              >Git scraping: track changes over time by scraping to a Git
              repository</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 21:57:24</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37082289"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37082117">
          <h3>
            <a class="item" href="https://github.com/microsoft/Llama-2-Onnx"
              >Llama 2 on ONNX runs locally</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 21:37:17</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37082117"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37081833">
          <h3>
            <a
              class="item"
              href="https://interrupt.memfault.com/blog/a-modern-c-dev-env"
              >A Modern C Development Environment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 21:08:40</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37081833"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37081789">
          <h3>
            <a
              class="item"
              href="https://blog.networkprofile.org/my-home-network-complete-details-2023/"
              >My Overkill Home Network</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 21:05:20</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37081789"
                  >Comments</a
                ><span class="descendants">: 206</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37081752">
          <h3>
            <a
              class="item"
              href="https://www.planeandpilotmag.com/news/pilot-talk/grumman-f11-tiger-shoot-itself-down/"
              >A Grumman F11 Tiger Shot Itself Down (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 21:02:55</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37081752"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37081485">
          <h3>
            <a
              class="item"
              href="https://tableflow.com/blog/was-y-combinator-worth-it"
              >Was Y Combinator worth it?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 20:41:05</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37081485"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37081306">
          <h3>
            <a
              class="item"
              href="https://www.hashicorp.com/blog/hashicorp-adopts-business-source-license"
              >HashiCorp adopts Business Source License</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 20:26:37</span
              ><span class="points-container"
                >Points: <span class="points">372</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37081306"
                  >Comments</a
                ><span class="descendants">: 423</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37081129">
          <h3>
            <a
              class="item"
              href="https://www.woodtv.com/news/grand-rapids/1980s-computer-controls-grps-heat-and-ac/"
              >Amiga runs Michigan schools' heating and air conditioning systems
              (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 20:12:22</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37081129"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37080790">
          <h3>
            <a
              class="item"
              href="https://news.fnal.gov/2023/08/muon-g-2-doubles-down-with-latest-measurement/"
              >Muon g-2 doubles down with latest measurement, explores uncharted
              territory</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 19:43:23</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37080790"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37080404">
          <h3>
            <a
              class="item"
              href="https://news.harvard.edu/gazette/story/2023/08/turns-out-lowly-thymus-may-be-saving-your-life/"
              >Turns out lowly thymus may be saving your life</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 19:07:38</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37080404"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37079909">
          <h3>
            <a
              class="item"
              href="https://graphite.dev/blog/how-an-aws-aurora-feature-cut-db-costs"
              >Aurora I/O optimized config saved 90% DB cost</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 18:29:48</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37079909"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37079616">
          <h3>
            <a
              class="item"
              href="https://evergreenoffgrid.com/water-cooled-rooftop-solar-panels/"
              >Water Cooled Rooftop Solar Panels</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 18:05:41</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37079616"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37079534">
          <h3>
            <a
              class="item"
              href="https://workspaceupdates.googleblog.com/2023/08/esignature-google-docs-google-drive.html"
              >eSignature for Google Docs and Google Drive (Beta)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 17:59:07</span
              ><span class="points-container"
                >Points: <span class="points">335</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37079534"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37078719">
          <h3>
            <a class="item" href="https://neovim.io/news/2023/08">Vim Boss</a>
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 17:02:14</span
              ><span class="points-container"
                >Points: <span class="points">899</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37078719"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37078708">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/memfault/jobs/zALzwIe-backend-engineer-systems-data"
              >Memfault (YC W19) Is Hiring a Data/Back End Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 17:01:03</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37078047">
          <h3>
            <a
              class="item"
              href="https://physicaleducationandwellness.mit.edu/about/pirate-certificate/"
              >MIT Pirate Certificate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 16:12:25</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37078047"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37076693">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37076693"
              >Launch HN: Rubbrband (YC W23) – Deformity detection for
              AI-generated images</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 14:35:25</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37076693"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.rubbrband.com/">https://www.rubbrband.com/</a
              >). Rubbrband is software that evaluates the quality of images
              generated by Stable Diffusion (or Midjourney, DALL-e, etc…).
              <p>
                We actually stumbled into this idea while working on solving a
                different problem. While helping a few companies use Stable
                Diffusion in production, we found that these companies needed to
                use QA analysts to manually evaluate their images to make sure
                they were high quality once in prod. This process often took
                days just to go through thousands of images, so companies that
                have a text-to-image product with PMF couldn’t guarantee that
                their images were of high quality.
              </p>
              <p>
                From our initial set of customers, we found that evaluating the
                quality of their outputs at scale was an even larger problem
                than just using the model itself. So we pivoted our company into
                working on solving this problem using our skills from CV
                research. All three of us did computer vision research at UC
                Berkeley, and Abhi worked with John Canny, who invented many CV
                techniques like the Canny Edge Detector.
              </p>
              <p>
                We built a product that automates this process using computer
                vision. We’ve trained in-house several computer vision models
                that grade images based on different criteria.
              </p>
              <p>
                These include: - Detecting human deformities, such as a person
                with 7 fingers on a hand (image generation models generate
                deformed hands over 80% of the time when generating a photo of a
                person! This includes the state of the art: Midjourney, SDXL,
                Runway, etc…); - A score that rates how well the image aligns
                with the prompt(we do this using our own finetuned Visual
                Question Answer model); - A composition score (how well composed
                the image is according to photography “rules”)
              </p>
              <p>
                Using Rubbrband is pretty simple. You can send an image to us to
                process via our API or our web app, and you’ll get scores for
                each of those criteria back on your dashboard in less than 10
                seconds. Here is a quick Loom demo:
                <a
                  href="https://www.loom.com/share/961830347b3643dcbb92dfe80f8ca1f0?sid=faf1d9fb-5023-4dc8-96fc-5b3806ef3c6b"
                  >https://www.loom.com/share/961830347b3643dcbb92dfe80f8ca1f0?...</a
                >.
              </p>
              <p>
                You can filter your images based on certain criteria from the
                dashboard. For instance, if you want to see all images with
                deformed eyes, you can click the “deformed eyes” filter at the
                top of the screen to see all of those images.
              </p>
              <p>
                We store images generated by your image generation model. We’re
                like a logging tool for images, with evaluations on top. We
                currently charge $0.01 per image, with your first 1000 images
                free.
              </p>
              <p>
                We’re super excited to launch this to Hacker News. We’d love to
                hear what you think. Thanks in advance!
              </p>
            </div>
          </section>
        </section>
        <section id="37068230">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/08/09/arts/music/robbie-robertson-dead.html"
              >Robbie Robertson has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 20:52:54</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37068230"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37065391">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Pentium_FDIV_bug"
              >Pentium floating-point division bug (1994)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 16:48:46</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37065391"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37063184">
          <h3>
            <a
              class="item"
              href="https://ava.substack.com/p/therapy-as-a-way-of-aligning-with"
              >Therapy as a way of aligning with your subconscious</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 14:26:46</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37063184"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37061133">
          <h3>
            <a
              class="item"
              href="https://resobscura.substack.com/p/experiencing-scientific-revolutions"
              >Experiencing scientific revolutions: the 1660s and the 2020s</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 11:31:22</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37061133"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37058171">
          <h3>
            <a class="item" href="https://www.sensorwatch.net/"
              >Sensor Watch: a board swap for the classic Casio F-91W
              wristwatch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 02:50:52</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37058171"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37052425">
          <h3>
            <a
              class="item"
              href="https://www.evilsocket.net/2022/10/20/Reverse-Engineering-the-Apple-MultiPeer-Connectivity-Framework/"
              >Reverse Engineering the Apple Multipeer Connectivity Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 17:17:58</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37052425"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
