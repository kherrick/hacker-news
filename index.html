<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40926656">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-07-10/intuit-to-cull-10-of-employees-in-latest-round-of-tech-layoffs"
              >Intuit to Cut 10% of Employees in Latest Round of Tech Layoffs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 13:27:14</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40926656"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40926648">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/7b8d2057-2687-45b3-bae4-1488a75ac5b2"
              >AMD to buy Finnish startup Silo AI for $665M in drive to compete
              with Nvidia</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 13:26:15</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40926648"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40926411">
          <h3>
            <a
              class="item"
              href="https://blog.josefsson.org/2024/07/10/towards-idempotent-rebuilds/"
              >Towards Idempotent Rebuilds?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 13:01:57</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40926411"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40926211">
          <h3>
            <a class="item" href="https://github.com/darrenburns/posting"
              >Show HN: Posting v1 – The modern HTTP client that lives in your
              terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 12:35:14</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40926211"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                I just released version 1.0 of Posting, an open source terminal
                application I've been working on which you might find useful if
                you work with, test, or develop HTTP APIs!
              </p>
              <p>
                Posting (<a href="https://github.com/darrenburns/posting"
                  >https://github.com/darrenburns/posting</a
                >) is an HTTP client, not unlike Postman and Insomnia. However,
                as a TUI application, it works over SSH and enables efficient
                keyboard-centric workflows. Your requests are stored locally in
                simple readable YAML files, meaning they're easy to read and
                version control.
              </p>
              <p>Some other features include:</p>
              <p>
                - "Jump mode" navigation - Environments/variables with
                autocompletion - Syntax highlighting powered by tree-sitter -
                Vim keys support in much of the UI - Various builtin themes - A
                config system - "Open in $EDITOR" - A fuzzy search command
                palette for quickly accessing functionality.
              </p>
              <p>
                Posting is written in Python using the Textual[1] framework,
                which I also help maintain.
              </p>
              <p>
                Although 1.0 has been released, it's not yet feature complete.
                I'd love to hear feedback from the community to make sure I'm on
                the right track and learn what's important to people.
              </p>
              <p>
                So, if you have any thoughts, feature requests, or opinions, big
                or small, I'd love to hear them. At this early stage, your ideas
                can really help shape the roadmap of the project!
              </p>
              <p>Thanks, Darren</p>
              <p>
                [1] Textual:
                <a href="https://github.com/Textualize/textual"
                  >https://github.com/Textualize/textual</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40925906">
          <h3>
            <a class="item" href="https://strflow.app"
              >Show HN: I made a Note-Taking app for people who keep texting
              themselves</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 11:54:35</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40925906"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
            <div class="text">
              <p>
                Originally developed as a macOS app, Strflow is now also
                available for iOS. Strflow is designed to make note-taking as
                quick and intuitive as possible, centered around a chronological
                timeline UI.
              </p>
              <p>Here are some of its features:</p>
              <p>* Tag system</p>
              <p>
                * Rich editor with text formatting, images, and note linking
              </p>
              <p>* Global shortcuts for quick access</p>
              <p>* Share extension</p>
              <p>
                * Encrypted iCloud backup &amp; synchronization (becomes
                end-to-end encryption if you enable iCloud’s Advanced Data
                Protection)
              </p>
              <p>
                Hope you find Strflow interesting. I’m happy to answer any
                questions.
              </p>
              <p>
                ## Some implementation details some of you might be interested
                in:
              </p>
              <p>* The app is implemented natively using Swift.</p>
              <p>
                * On macOS, it’s based on AppKit, and on iOS, it uses UIKit,
                with SwiftUI used partially.
              </p>
              <p>* The editor intensively utilizes TextKit.</p>
              <p>* The sync engine is custom-built using CloudKit.</p>
            </div>
          </section>
        </section>
        <section id="40925896">
          <h3>
            <a class="item" href="https://www.deep-ml.com/"
              >ML Code Exercises</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 11:53:30</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40925896"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40925474">
          <h3>
            <a
              class="item"
              href="https://wingolog.org/archives/2024/07/10/copying-collectors-with-block-structured-heaps-are-unreliable"
              >Copying collectors with block-structured heaps are unreliable</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 10:26:14</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40925474"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40925471">
          <h3>
            <a
              class="item"
              href="https://venturebeat.com/games/girls-in-tech-closes-its-doors-after-17-years/"
              >Girls in Tech closes its doors after 17 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 10:25:44</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40925471"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40925266">
          <h3>
            <a class="item" href="https://plausible.io/blog/community-edition"
              >Plausible Community Edition</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 09:48:54</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40925266"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40925025">
          <h3>
            <a class="item" href="https://www.simsig.co.uk/"
              >SimSig: Railway Signalling Simulations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 09:02:16</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40925025"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40924915">
          <h3>
            <a
              class="item"
              href="https://www.esa.int/Enabling_Support/Space_Transportation/Ariane/Europe_s_new_Ariane_6_rocket_powers_into_space"
              >Europe's new Ariane 6 rocket powers into space</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 08:42:12</span
              ><span class="points-container"
                >Points: <span class="points">281</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40924915"
                  >Comments</a
                ><span class="descendants">: 263</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40924368">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/photoroom/fc379626-eb33-4eb6-839c-10e5d578e2ed?lever-origin=applied&amp;lever-source%5B%5D=yc"
              >Photoroom (YC S20) Is Hiring Rust Developers in Paris
              (X-Platform, Wgpu, WASM)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 07:00:40</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40922884">
          <h3>
            <a
              class="item"
              href="https://www.jetify.com/blog/automated-dev-envs-with-devbox-and-direnv/"
              >Automate Project Environments with Devbox and Direnv</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 01:13:11</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40922884"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40922874">
          <h3>
            <a
              class="item"
              href="https://exrocketman.blogspot.com/2021/12/the-seal-failure-in-srb-that-doomed.html"
              >The Seal Failure in the SRB That Doomed Challenger (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 01:11:00</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40922874"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40922740">
          <h3>
            <a class="item" href="https://www.awsviz.dev/"
              >Awsviz.dev simplifying AWS IAM policies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 00:35:48</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40922740"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40922739">
          <h3>
            <a class="item" href="https://github.com/lm-sys/RouteLLM"
              >RouteLLM: A framework for serving and evaluating LLM routers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 00:35:38</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40922739"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40921989">
          <h3>
            <a class="item" href="https://ai-murder-mystery.onrender.com/"
              >Multi-agent chatbot murder mystery – AI Alibis (free,
              in-browser)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 22:34:39</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40921989"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40921038">
          <h3>
            <a
              class="item"
              href="https://aiencoder.substack.com/p/graphrag-analysis-part-1-how-indexing"
              >Knowledge Graphs in RAG: Hype vs. Ragas Analysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 21:00:00</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40921038"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40920681">
          <h3>
            <a
              class="item"
              href="https://github.com/maelstrom-software/maelstrom"
              >Show HN: Maelstrom – A Hermetic, Clustered Test Runner for Python
              and Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 20:23:12</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40920681"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                Maelstrom is a suite of tools for running tests in hermetic
                micro-containers locally on your machine or distributed across
                arbitrarily large clusters. Maelstrom currently has test runners
                for Rust and Python, with more on the way. You might use
                Maelstrom to run your tests because:
              </p>
              <p></p>
              <pre><code>  * It's easy. Maelstrom functions as a drop-in replacement for cargo test and pytest. In most cases, it just works with your existing tests with minimal configuration.
  * It's reliable. Maelstrom runs every test hermetically in its own lightweight container, eliminating confusing errors caused by inter-test or implicit test-environment dependencies.
  * It's scalable. Maelstrom can be run as a cluster. You can add more worker machines to linearly increase test throughput.
  * It's clean. Maelstrom has built a rootless container implementation (not relying on Docker or RunC) from scratch, in Rust, optimized to be low-overhead and start quickly.
  * It's fast. In most cases, Maelstrom is faster than cargo test, even without using clustering. Maelstrom’s test-per-process model is inherently slower than pytest’s shared-process model, but Maelstrom provides test isolation at a low performance cost.
</code></pre>
              While our focus thus far has been on running tests, Maelstrom's
              underlying job execution system is general-purpose. We provide a
              command line utility to run arbitrary commands, as well a
              gRPC-based API and Rust bindings for programmatic access and
              control.
              <p>
                Feedback and questions are welcome! Thanks for giving it a
                whirl.
              </p>
            </div>
          </section>
        </section>
        <section id="40920246">
          <h3>
            <a
              class="item"
              href="https://flyingcarcomputer.com/posts/how-to-validate-market-with-development-board/"
              >How to validate a market with development boards and SD cards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 19:47:32</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40920246"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40920122">
          <h3>
            <a
              class="item"
              href="https://tedium.co/2024/07/06/compact-disc-pregap-history/"
              >How CD pregaps gained their hidden track superpowers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 19:38:36</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40920122"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40919253">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/07/08/github_copilot_dmca/"
              >Judge dismisses DMCA copyright claim in GitHub Copilot suit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 18:25:03</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40919253"
                  >Comments</a
                ><span class="descendants">: 324</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40916786">
          <h3>
            <a class="item" href="https://turbopuffer.com/blog/turbopuffer"
              >Turbopuffer: Fast search on object storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 14:48:59</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40916786"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40916193">
          <h3>
            <a
              class="item"
              href="https://www.orionreed.com/posts/scoped-propagators"
              >Scoped Propagators</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 13:54:59</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40916193"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40914958">
          <h3>
            <a class="item" href="https://circos.ca/"
              >Circos – Circular Visualization</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 11:44:40</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40914958"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40901224">
          <h3>
            <a
              class="item"
              href="https://www.otherbranch.com/blog/rebooting-something-like-triplebyte"
              >Rebooting (something like) early Triplebyte</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-07 @ 23:01:47</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40901224"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40898715">
          <h3>
            <a
              class="item"
              href="https://garrettdbates.com/2024/07/07/why-use-onion-layering.html"
              >Why Use Onion Layering?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-07 @ 16:44:04</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40898715"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40891391">
          <h3>
            <a
              class="item"
              href="https://santhoshsundar.medium.com/using-the-5s-principle-in-coding-6237a1614a02"
              >Using the 5S Principle in Coding</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-06 @ 16:19:41</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40891391"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40889272">
          <h3>
            <a
              class="item"
              href="https://medium.com/@abdulgh/compile-time-json-deserialization-in-c-1e3d41a73628"
              >Compile-time JSON deserialization in C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-06 @ 09:35:33</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40889272"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40885703">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-02211-0"
              >How I swapped my ivory tower for the world of science fiction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 20:27:51</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40885703"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
