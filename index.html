<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44193473">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/76919"
              >CircuitHub (YC W12) is hiring full-stack robotics engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 17:00:26</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44193390">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/06/05/x-changes-its-terms-to-bar-training-of-ai-models-using-its-content/"
              >X changes its terms to bar training of AI models using its
              content</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 16:52:10</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44193390"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44193328">
          <h3>
            <a class="item" href="https://deepmind.google/models/gemini/pro/"
              >Gemini-2.5-pro-preview-06-05</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 16:44:49</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44193328"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44193225">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s42255-025-01297-8"
              >Cysteine depletion triggers adipose tissue thermogenesis and
              weight loss</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 16:33:00</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44193225"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44193216">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/youre-not-ready-for-ai-hacker-agents/"
              >The Rise of 'Vibe Hacking' Is the Next AI Nightmare</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 16:32:01</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44193216"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44193198">
          <h3>
            <a
              class="item"
              href="https://puri.sm/posts/google-restricts-android-sideloading-what-it-means-for-user-autonomy-and-the-future-of-mobile-freedom/"
              >Google Restricts Android Sideloadingâ€“What It Means for User
              Autonomy and Freedom</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 16:29:02</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44193198"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44193120">
          <h3>
            <a
              class="item"
              href="https://www.cbc.ca/news/canada/newfoundland-labrador/black-iceberg-labrador-coast-1.7551078"
              >Rare black iceberg spotted off Labrador coast could be 100k years
              old</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 16:21:04</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44193120"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44192995">
          <h3>
            <a
              class="item"
              href="https://defector.com/seven-days-at-the-bin-store"
              >Seven Days at the Bin Store</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 16:07:03</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44192995"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44192955">
          <h3>
            <a
              class="item"
              href="https://fossa.com/blog/understanding-purl-specification-package-url/"
              >Understanding the PURL Specification (Package URL)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 16:02:54</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44192955"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44191620">
          <h3>
            <a
              class="item"
              href="https://crookedtimber.org/2025/06/05/occasional-paper-the-impossible-predicament-of-the-death-newts/"
              >The impossible predicament of the death newts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 13:40:48</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44191620"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44191591">
          <h3>
            <a class="item" href="https://mjg59.dreamwidth.org/71646.html"
              >Twitter's new encrypted DMs aren't better than the old ones</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 13:37:29</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44191591"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44191558">
          <h3>
            <a
              class="item"
              href="https://daringfireball.net/linked/2025/06/04/apple-notes-markdown"
              >Apple Notes Will Gain Markdown Export at WWDC, and, I Have
              Thoughts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 13:32:48</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44191558"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44190371">
          <h3>
            <a
              class="item"
              href="https://andregarzia.com/2025/06/experimenting-with-no-build-web-applications.html"
              >Experimenting with no-build Web Applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 10:54:12</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44190371"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44189741">
          <h3>
            <a class="item" href="https://github.com/bearstech/phptop"
              >Phptop: Simple PHP ressource profiler, safe and useful for
              production sites</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 08:52:56</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44189741"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44189426">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2505.17117"
              >From Tokens to Thoughts: How LLMs and Humans Trade Compression
              for Meaning</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 07:59:21</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44189426"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44189329">
          <h3>
            <a
              class="item"
              href="https://networkedartifacts.com/airlab/simulator"
              >Air Lab â€“ A portable and open air quality measuring device</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 07:42:25</span
              ><span class="points-container"
                >Points: <span class="points">262</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44189329"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
            <div class="text">
              <p>
                Iâ€™ve been working on an air quality measuring device called Air
                Lab for the past three years. It measures CO2, temperature,
                relative humidity, air pollutants (VOC, NOx), and atmospheric
                pressure. You can log and analyze the data directly on the
                device â€” no smartphone or laptop needed.
              </p>
              <p>
                To better show what the device can do and how it feels like, I
                spent the past week developing a web-based simulator using
                Emscripten. It runs the stock firmware with most features
                available except for networking. Check it out and let me know
                what you think!
              </p>
              <p>
                The firmware will be open-source and available once the first
                batch of devices ships. Weâ€™re currently finishing up our
                crowdfunding campaign on CrowdSupply. If you want to get one,
                now is the time to support the project:
                <a
                  href="https://www.crowdsupply.com/networked-artifacts/air-lab"
                  >https://www.crowdsupply.com/networked-artifacts/air-lab</a
                >
              </p>
              <p>
                We started building the Air Lab because most air quality
                measuring devices we found were locked-down or hard to tinker
                with. Air quality is a growing concern, and weâ€™re hoping a more
                open, playful approach can help make the topic more accessible.
                It is important to us that there is a low bar for customizing
                and extending the Air Lab. Until we ship, we plan to create rich
                documentation and further tools, like the simulator, to make
                this as easy as possible.
              </p>
              <p>
                The technical: The device is powered by the popular ESP32S3
                microcontroller, equipped with a precise CO2, temperature, and
                relative humidity sensor (SCD41) as well as a VOC/NOx (SGP41)
                and atmospheric pressure sensor (LPS22). The support circuitry
                provides built-in battery charging, a real-time clock, an RGB
                LED, buzzer, an accelerometer, and capacitive touch, which makes
                Air Lab a powerful stand-alone device. The firmware itself is
                written on top of esp-idf and uses LVGL for rendering the UI.
              </p>
              <p>
                If you seek more high-level info, here are also some videos
                covering the project: -
                <a href="https://www.youtube.com/watch?v=oBltdMLjUyg"
                  >https://www.youtube.com/watch?v=oBltdMLjUyg</a
                >
                (Introduction) -
                <a href="https://www.youtube.com/watch?v=_tzjVYPm_MU"
                  >https://www.youtube.com/watch?v=_tzjVYPm_MU</a
                >
                (Product Update)
              </p>
              <p>
                Would love your feedback â€” on the device, hardware choices,
                potential use cases, or anything else worth improving. If you
                want to get notified on project updates, subscribe on Crowd
                Supply.
              </p>
              <p>Happy to answer any questions!</p>
            </div>
          </section>
        </section>
        <section id="44188248">
          <h3>
            <a
              class="item"
              href="https://www.usgs.gov/news/national-news-release/end-era-landsat-7-decommissioned-after-25-years-earth-observation"
              >End of an Era: Landsat 7 Decommissioned After 25 Years of Earth
              Observation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 04:09:00</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44188248"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44187645">
          <h3>
            <a
              class="item"
              href="https://seve.blog/p/i-made-a-3d-svg-renderer-that-projects"
              >Show HN: I made a 3D SVG Renderer that projects textures without
              rasterization</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 02:05:33</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44187645"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44186736">
          <h3>
            <a
              class="item"
              href="https://mattrighetti.com/2025/05/03/authentication-with-axum"
              >Authentication with Axum</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 23:33:41</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44186736"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44186660">
          <h3>
            <a
              class="item"
              href="https://iopscience.iop.org/article/10.3847/1538-4357/adbf9b"
              >A Spiral Structure in the Inner Oort Cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 23:22:07</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44186660"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44186536">
          <h3>
            <a class="item" href="https://github.com/hugomd/parrot.live"
              >parrot.live</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 23:05:32</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44186536"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44186496">
          <h3>
            <a
              class="item"
              href="https://www.zachdaniel.dev/p/llms-and-elixir-windfall-or-deathblow"
              >LLMs and Elixir: Windfall or Deathblow?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 23:00:35</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44186496"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44185913">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2025/06/openai-says-court-forcing-it-to-save-all-chatgpt-logs-is-a-privacy-nightmare/"
              >OpenAI slams court order to save all ChatGPT logs, including
              deleted chats</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 21:47:33</span
              ><span class="points-container"
                >Points: <span class="points">1002</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44185913"
                  >Comments</a
                ><span class="descendants">: 828</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44185256">
          <h3>
            <a class="item" href="https://www.cursor.com/en/changelog/1-0"
              >Cursor 1.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 20:39:53</span
              ><span class="points-container"
                >Points: <span class="points">552</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44185256"
                  >Comments</a
                ><span class="descendants">: 419</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44184900">
          <h3>
            <a
              class="item"
              href="https://www.tudelft.nl/en/2025/lr/autonomous-drone-from-tu-delft-defeats-human-champions-in-historic-racing-first"
              >Autonomous drone defeats human champions in racing first</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 20:03:43</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44184900"
                  >Comments</a
                ><span class="descendants">: 207</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44183799">
          <h3>
            <a
              class="item"
              href="https://github.com/explainers-by-googlers/local-network-access"
              >A proposal to restrict sites from accessing a usersâ€™ local
              network</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 18:15:54</span
              ><span class="points-container"
                >Points: <span class="points">550</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44183799"
                  >Comments</a
                ><span class="descendants">: 315</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44183591">
          <h3>
            <a
              class="item"
              href="https://tech.marksblogg.com/apple-iphone-15-pro-depth-map-heic.html"
              >The iPhone 15 Proâ€™s Depth Maps</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 17:57:15</span
              ><span class="points-container"
                >Points: <span class="points">321</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44183591"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44182698">
          <h3>
            <a
              class="item"
              href="https://www.softwareheritage.org/2025/06/04/history_computer_vision/"
              >When memory was measured in kilobytes: The art of efficient
              vision</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 16:46:24</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44182698"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44182188">
          <h3>
            <a
              class="item"
              href="https://addyo.substack.com/p/the-prompt-engineering-playbook-for"
              >Prompt engineering playbook for programmers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 15:58:57</span
              ><span class="points-container"
                >Points: <span class="points">368</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44182188"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44182186">
          <h3>
            <a
              class="item"
              href="https://git.ffmpeg.org/gitweb/ffmpeg.git/commit/167e343bbe75515a80db8ee72ffa0c607c944a00"
              >FFmpeg merges WebRTC support</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-04 @ 15:58:50</span
              ><span class="points-container"
                >Points: <span class="points">824</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44182186"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
