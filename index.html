<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38933315">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-01-09/amazon-s-twitch-to-cut-500-employees-about-35-of-staff"
              >Amazon's Twitch to Cut 500 Employees, About 35% of Staff</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 22:41:55</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38933315"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38932603">
          <h3>
            <a class="item" href="https://www.wikihouse.cc/"
              >Wikihouse: Open-Source Houses</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 21:48:05</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38932603"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38932509">
          <h3>
            <a
              class="item"
              href="https://en.bitcoinsistemi.com/breaking-gary-gensler-says-secs-x-account-hacked-bitcoin-spot-etfs-not-yet-approved/"
              >SEC's X Account Hacked, Bitcoin Spot ETFs Not yet Approved</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 21:40:06</span
              ><span class="points-container"
                >Points: <span class="points">237</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38932509"
                  >Comments</a
                ><span class="descendants">: 237</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38932489">
          <h3>
            <a class="item" href="https://www.rabbit.tech/?r1"
              >Rabbit R1, Designed by Teenage Engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 21:39:02</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38932489"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38932472">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-01-09/sec-says-has-not-yet-granted-approval-of-spot-bitcoin-etfs"
              >SEC Says It Has Not yet Granted Approval of Bitcoin ETFs: Gensler
              blames hack</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 21:37:52</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38932472"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38932398">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Linux-6.8-Networking"
              >Linux 6.8 Network Optimizations Can Boost TCP Performance by
              ~40%</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 21:32:18</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38932398"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38931931">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/magical-error-correction-scheme-proved-inherently-inefficient-20240109/"
              >'Magical' Error Correction Scheme Proved Inherently
              Inefficient</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 20:51:29</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38931931"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38931282">
          <h3>
            <a
              class="item"
              href="https://news.ncsu.edu/2023/12/ancient-stars-made-extraordinarily-heavy-elements/"
              >Ancient Stars Made Extraordinarily Heavy Elements (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 20:06:30</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38931282"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38930928">
          <h3>
            <a
              class="item"
              href="https://www.indiehackers.com/post/aim-fire-scan-the-80-20-of-executing-on-big-projects-571580cd0a"
              >Aim, fire, scan: the 80/20 of executing on big projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 19:42:43</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38930928"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38930746">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/01/09/ftc-x-mode-ban-delete-location-data/"
              >FTC bans X-Mode from selling phone location data, and orders firm
              to delete data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 19:31:10</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38930746"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38929917">
          <h3>
            <a class="item" href="https://deepflow.io/"
              >DeepFlow – open-source eBPF Distributed Tracing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 18:31:01</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38929917"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38929677">
          <h3>
            <a class="item" href="https://opendev.org/"
              >OpenDev is a collaboratory for open source software development
              at scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 18:14:22</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38929677"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38929369">
          <h3>
            <a class="item" href="https://hobbes.nmsu.edu/"
              >Hobbes OS/2 Archive: As of April 15th, 2024 this site will no
              longer exist</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 17:55:44</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38929369"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38928970">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/air-space-magazine/ugliest-airplane-appreciation-180978708/"
              >The Ugliest Airplane: An Appreciation of the Transavia AirTruk</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 17:31:22</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38928970"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38928673">
          <h3>
            <a class="item" href="https://github.com/nsqio/nsq"
              >NSQ: Open-source realtime distributed messaging, billions of
              messages / day</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 17:11:14</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38928673"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38928508">
          <h3>
            <a class="item" href="https://roboflow.com/careers"
              >Roboflow (YC S20) is hiring an engineer focused on their open
              source projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 17:00:53</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38928334">
          <h3>
            <a class="item" href="https://lproven.livejournal.com/189791.html"
              >Non-PC compatible x86 computers (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 16:49:09</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38928334"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38928277">
          <h3>
            <a class="item" href="https://ben.page/eink"
              >Building an e-ink picture frame that displays an iCloud photo
              album</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 16:45:58</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38928277"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38928182">
          <h3>
            <a
              class="item"
              href="https://koreajoongangdaily.joins.com/news/2024-01-09/business/industry/Samsung-forecasts-85-drop-in-profit-for-last-year-amid-chip-slump/1954130"
              >Samsung forecasts 85% drop in profit as chip sales falter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 16:40:17</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38928182"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38928064">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38928064"
              >Launch HN: Corgea (YC S23) – Auto fix vulnerable code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 16:32:21</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38928064"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
            <div class="text">
              <a href="https://corgea.com">https://corgea.com</a>). We help
              companies fix their vulnerable source code using AI.
              <p>
                Originally, we started with a data security product that would
                detect data leaks at companies. Despite initial successes and
                customer acquisitions, we frequently heard that highlighting
                issues wasn't enough; customers wanted proactive fixes. They had
                hundreds (yes hundreds!) of security tools alerting them about
                vulnerabilities, but couldn’t afford a dedicated team to go
                through them all and fix them. One prospect we spoke to had tens
                of thousands of reported vulnerabilities in their SAST tool.
                With the rise of AI code generation, we saw an opportunity to
                give customers what they really wanted.
              </p>
              <p>
                Having Corgea is like having a security engineer on staff
                focused on making your code more secure. We want security to be
                an enabler of engineering rather than a blocker to it, and the
                reverse to be true. To accomplish this, we built it on top of
                existing LLMs to issue code fixes.
              </p>
              <p>
                To show Corgea’s capabilities, we took some popular
                vulnerable-by-design applications like Juice Shop (<a
                  href="https://github.com/juice-shop/juice-shop"
                  >https://github.com/juice-shop/juice-shop</a
                >), scanned them and issued fixes for their vulnerabilities. You
                can see some of them here:
                <a href="https://demo.corgea.com">https://demo.corgea.com</a>.
                Some examples of vulnerabilities it solves are like SQL
                injection, Path Traversal and XSS.
              </p>
              <p>
                What makes this tough is that currently LLMs struggle at
                generalist coding tasks because it has to understand your whole
                code base, the domain you’re in, and the user’s request to do
                something. This can lead to a lot of unintended behavior where
                it codes things incorrectly because it’s giving a best guess at
                what you want. Adam, one of the founding engineers on the team
                coined it well: LLMs don’t reason, they fuzz.
              </p>
              <p>
                We made several decisions that helped the LLM become more
                deterministic. First, what we’re doing is extremely domain
                specific: vulnerable code fixes in a limited number of
                programming languages. There are roughly 900 security
                vulnerabilities in code, called CWE’s (<a
                  href="https://cwe.mitre.org/"
                  >https://cwe.mitre.org/</a
                >), that we’ve built into Corgea. An SQL injection vulnerability
                in a Javascript app is the same regardless if you’re a payments
                company or a travel booking website. Second, we have no user
                generated input going into the LLM, because SAST scanners
                everything needed to issue a fix. This makes it much more
                predictable and reproducible for us and customers. We can also
                create robust QA processes and checks.
              </p>
              <p>
                To illustrate the point, let’s put some of this to the test
                using some napkin math. Assume you’re serving 5,000 enterprises
                that ship on average 300 domain specific features a year in 5
                different programming languages that each require 30 lines of
                code changes across multiple files. You’ll have about 300m
                permutations the product needs to support. What a nightmare!
              </p>
              <p>
                Using the same napkin math, Corgea needs to support the ~900
                vulnerabilities (CWE’s). Most of them require 1 - 2 line
                changes. It doesn’t need to understand the whole codebase since
                the problem is usually isolated to a few lines. We want to
                support the 5 most popular programming languages. If we have
                5,000 customers, we have to support ~4,500 permutations (900
                issues x 5 different languages). This leads to a massive
                difference in accuracy. Obviously, this is an oversimplification
                of the whole thing but it illustrates the point.
              </p>
              <p>
                What makes this different from Copilot and other code-gen tools
                is that they do not specialize in security and we’ve seen them
                inadvertently introduce security issues unbeknownst to the
                engineer. Additionally, they do not integrate into existing
                scanning tools that companies are using to resolve those issues.
                So unless a developer is working on every part of the product,
                they’re unable to clear security backlogs, which can be in the
                thousands of tickets.
              </p>
              <p>
                As for security scanners, the current market is flooded with
                tools that report and overwhelm security teams and are not
                effective at fixing what they’re reporting. Most vulnerability
                scanners do not remediate issues, and if they do they’re mostly
                limited to upgrading packages from one version to another to
                reduce a CVSS. If they do offer CWE remediation capabilities
                their success rates are very low because they’re often based on
                traditional AI methodologies. Additionally, they do not
                integrate with each other because they want to only serve their
                own findings. Enterprises use multiple tools like Snyk, Semgrep,
                Checkmarx, but also have a penetration testing program, and a
                bug bounty program. They need a solution that consolidates
                across their existing tools. They also use Github, Gitlab and
                Bitbucket for their code repository.
              </p>
              <p>
                We’re offering a free tier for smaller teams and priced tiers.
                We believe we can reduce 80% of the engineering effort for
                security fixes, which would equate to at least $10m a year for
                enterprises.
              </p>
              <p>
                We’re really excited to share this with you all and we’d love
                any thoughts, feedback, and comments!
              </p>
            </div>
          </section>
        </section>
        <section id="38926978">
          <h3>
            <a
              class="item"
              href="https://www.ge.com/news/press-releases/ge-vernova-announces-2point4-gw-order-for-pattern-energy-sunzia-wind-project"
              >GE Vernova announces order of 674 wind turbines, providing 2.4 GW
              of power</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 15:05:40</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38926978"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38925928">
          <h3>
            <a class="item" href="https://github.com/gscept/nebula"
              >Nebula is an open-source and free-to-use modern C++ game
              engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 13:29:20</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38925928"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38925802">
          <h3>
            <a class="item" href="https://github.com/linkdd/aitoolkit"
              >AI Toolkit: Give a brain to your game's NPCs, a header-only C++
              library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 13:16:00</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38925802"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38925307">
          <h3>
            <a class="item" href="https://turingcomplete.game/"
              >Turing Complete is a game about computer science</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 12:22:42</span
              ><span class="points-container"
                >Points: <span class="points">276</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38925307"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38924159">
          <h3>
            <a class="item" href="https://www.gibbard.me/using_git_offline/"
              >Using Git Offline</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 09:44:29</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38924159"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38923741">
          <h3>
            <a
              class="item"
              href="https://tonybaloney.github.io/posts/python-gets-a-jit.html"
              >Python 3.13 Gets a JIT</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 08:35:58</span
              ><span class="points-container"
                >Points: <span class="points">859</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38923741"
                  >Comments</a
                ><span class="descendants">: 407</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38923627">
          <h3>
            <a
              class="item"
              href="https://www.fromjason.xyz/p/notebook/where-have-all-the-websites-gone/"
              >Where Have All the Websites Gone?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 08:13:13</span
              ><span class="points-container"
                >Points: <span class="points">392</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38923627"
                  >Comments</a
                ><span class="descendants">: 341</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38922040">
          <h3>
            <a
              class="item"
              href="https://dmitry.gr/?r=05.Projects&amp;proj=11.%20Bluetooth%20LE%20fakery"
              >Bit-Banging Bluetooth Low Energy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 03:43:57</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38922040"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38912240">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2024-01-functional-semiconductor-graphene.html"
              >Researchers create first functional semiconductor made from
              graphene</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 14:21:03</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38912240"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38911079">
          <h3>
            <a
              class="item"
              href="https://peacefulrevolutionary.substack.com/p/a-guide-for-prospective-tea-monks"
              >A Guide for Prospective Tea Monks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 12:35:31</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38911079"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
