<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44132873">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/05/29/well/maha-report-citations.html"
              >White House releases health report written by LLM, with
              hallucinated citations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-30 @ 04:31:37</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44132873"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44132823">
          <h3>
            <a
              class="item"
              href="https://github.com/muthuishere/mcp-server-bash-sdk"
              >Show HN: MCP Server SDK in Bash (~250 lines, zero runtime)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-30 @ 04:25:23</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44132823"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44132750">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/u-s-woman-dies-from-mad-cow-like-brain-disease-that-lay-dormant-for-50-years-2000603359"
              >U.S. Woman Dies from Mad Cow-Like Brain Disease That Lay Dormant
              for 50 Years</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-30 @ 04:08:56</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44132750"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44132673">
          <h3>
            <a
              class="item"
              href="https://www.chosenplaintext.ca/articles/radix-2-51-trick.html"
              >The radix 2^51 trick</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-30 @ 03:55:37</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44132673"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44132404">
          <h3>
            <a
              class="item"
              href="https://omeka-s.library.illinois.edu/s/MPAL/page/player-piano-rolls-landing"
              >Player Piano Rolls</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-30 @ 02:58:02</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44132404"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44132075">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2025/05/u-s-sanctions-cloud-provider-funnull-as-top-source-of-pig-butchering-scams/"
              >U.S. sanctions cloud provider 'Funnull' as top source of 'pig
              butchering' scams</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-30 @ 01:58:24</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44132075"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44131984">
          <h3>
            <a class="item" href="https://nostarch.com/practical-sdr"
              >Practical SDR: Getting started with software-defined radio</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-30 @ 01:34:23</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44131984"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44131901">
          <h3>
            <a class="item" href="https://github.com/IRS-Public/direct-file"
              >IRS Direct File</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-30 @ 01:19:41</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44131901"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44131513">
          <h3>
            <a class="item" href="https://wave3.social"
              >I'm starting a social club to solve the male loneliness
              epidemic</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 23:57:11</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44131513"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
            <div class="text">
              <a href="https://news.ycombinator.com/item?id=44098369"
                >https://news.ycombinator.com/item?id=44098369</a
              >) and it definitely hit home. As a guy in my early 30s, it made
              me realize how I've let many of my most meaningful friendships
              fade. I have a good group of friends - and my wife - but it
              doesn't feel like when I was in college and hung out with a crew
              of 10+ people on a weekly basis. So, I decided to do something
              about it. I’ve launched wave3.social - a platform to help guys
              build in-person social circles with actual depth. Think
              parlor.social or timeleft for guys: curated events and meaningful
              connections for men who don’t want their friendships to atrophy
              post-college.
              <p>
                It started as a Boston-based idea (where I live), but I built it
                with flexibility in mind so it could scale to other cities if
                there’s interest. It’s intentionally not on Meetup or Facebook -
                I wanted something that feels more intentional, with a better UX
                and less noise.
              </p>
              <p>
                Right now, I'm in the “see if this resonates with anyone” stage.
                If this sounds interesting to you and you're in Boston or
                another city where this type of thing might be needed, drop a
                comment or shot me an email. I'd love to hear any feedback on
                the site and ideas on how we can fix the male loneliness
                epidemic in the work-from-home era.
              </p>
            </div>
          </section>
        </section>
        <section id="44130295">
          <h3>
            <a
              class="item"
              href="https://mattlakeman.org/2025/05/29/notes-on-tunisia/"
              >Notes on Tunisia</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 20:53:39</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44130295"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44128322">
          <h3>
            <a class="item" href="https://bfl.ai/models/flux-kontext"
              >FLUX.1 Kontext</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 17:40:35</span
              ><span class="points-container"
                >Points: <span class="points">321</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44128322"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44128101">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/research/open-source-circuit-tracing"
              >Open-sourcing circuit tracing tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 17:16:54</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44128101"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44127948">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/infisical/jobs/vGwCQVk-full-stack-engineer-us-canada"
              >Infisical (YC W23) Is Hiring Full Stack Engineers (TypeScript) in
              US and Canada</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 17:01:18</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44127739">
          <h3>
            <a class="item" href="https://antirez.com/news/153"
              >Human coders are still better than LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 16:41:04</span
              ><span class="points-container"
                >Points: <span class="points">452</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44127739"
                  >Comments</a
                ><span class="descendants">: 526</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44127173">
          <h3>
            <a
              class="item"
              href="https://twitter.com/keenanisalive/status/1925225500659658999"
              >Putting Rigid Bodies to Rest</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 15:43:33</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44127173"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://xcancel.com/keenanisalive/status/1925225500659658999"
                >https://xcancel.com/keenanisalive/status/1925225500659658999</a
              >
            </div>
          </section>
        </section>
        <section id="44127109">
          <h3>
            <a class="item" href="https://weatherstar.netbymatt.com/"
              >WeatherStar 4000+: Weather Channel Simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 15:38:45</span
              ><span class="points-container"
                >Points: <span class="points">576</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44127109"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44127027">
          <h3>
            <a
              class="item"
              href="https://www.spacebar.news/the-flip-phone-web-browsing-with-the-original-opera-mini/"
              >The flip phone web: browsing with the original Opera Mini</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 15:30:17</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44127027"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44126612">
          <h3>
            <a class="item" href="https://commandline.stribny.name/"
              >Show HN: I wrote a modern Command Line Handbook</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 14:44:33</span
              ><span class="points-container"
                >Points: <span class="points">293</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44126612"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
            <div class="text">
              <p>
                A few years back I wrote an ebook about the Linux command line.
                Instead of focusing on a specific shell, paraphrasing manual
                pages, or providing long repetitive explanations, the idea was
                to create a modern guide that would help readers to understand
                the command line in the practical sense, cover the most common
                things people use the command line for, and do so without
                wasting the readers' time.
              </p>
              <p>
                The book contains material on terminals, shells (compatible with
                both Bash and Zsh), configuration, command line programs for
                typical use cases, shell scripting, and many tips and tricks to
                make working on the command line more convenient. I still
                consider it "an introduction" and it is not necessarily a book
                for the HN crowd that lives in the terminal, but I believe that
                the book will easily cover 80 % of the things most people want
                or need to do in the terminal.
              </p>
              <p>
                I made a couple of updates to the book over the years and just
                finished a significant one for 2025. The book is not perfect. I
                still see a lot of room for improvement, but I think it is good
                enough and I truly want to share it with everyone. Hence, pay
                what you want.
              </p>
              <p>
                EXAMPLE PAGES:
                <a
                  href="https://drive.google.com/file/d/1PkUcLv83Ib6nKYF88n3OBqeeVffAs3Sp/view?usp=sharing"
                  >https://drive.google.com/file/d/1PkUcLv83Ib6nKYF88n3OBqeeVff...</a
                >
              </p>
              <p>
                <a href="https://commandline.stribny.name/"
                  >https://commandline.stribny.name/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44125966">
          <h3>
            <a class="item" href="https://alloc.dev/2025/05/29/learning_c3"
              >Learning C3</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 13:33:31</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44125966"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44123852">
          <h3>
            <a class="item" href="https://cybercultural.com/p/web-design-1997/"
              >Gurus of 90s Web Design: Zeldman, Siegel, Nielsen</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 07:33:02</span
              ><span class="points-container"
                >Points: <span class="points">381</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44123852"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44120306">
          <h3>
            <a
              class="item"
              href="http://blog.pamelafox.org/2025/05/a-visual-exploration-of-vector.html"
              >A visual exploration of vector embeddings</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 20:21:47</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44120306"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44115244">
          <h3>
            <a
              class="item"
              href="https://goodinternetmagazine.com/oral-history-of-flash/"
              >Flash Back: An “oral” history of Flash</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 12:21:44</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44115244"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44114982">
          <h3>
            <a
              class="item"
              href="https://goodinternetmagazine.com/my-website-is-ugly-because-i-made-it/"
              >My website is ugly because I made it</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 11:53:47</span
              ><span class="points-container"
                >Points: <span class="points">476</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44114982"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44108590">
          <h3>
            <a
              class="item"
              href="https://www.asawicki.info/Mirror/Car%20Physics%20for%20Games/Car%20Physics%20for%20Games.html"
              >Car Physics for Games (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-27 @ 16:44:36</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44108590"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44108139">
          <h3>
            <a
              class="item"
              href="https://ironicsans.ghost.io/why-is-everybody-knitting-chickens/"
              >Why is everybody knitting chickens?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-27 @ 15:52:49</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44108139"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44106048">
          <h3>
            <a class="item" href="https://github.com/mathiasbynens/small"
              >Smallest Possible Files</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-27 @ 11:57:01</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44106048"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44106007">
          <h3>
            <a
              class="item"
              href="https://daxe.substack.com/p/disarming-an-atomic-bomb-is-the-worst"
              >Dr John C. Clark, a scientist who disarmed atomic bombs twice</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-27 @ 11:52:13</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44106007"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44105746">
          <h3>
            <a
              class="item"
              href="https://leetarxiv.substack.com/p/making-c-and-python-talk-to-each"
              >Making C and Python Talk to Each Other</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-27 @ 11:06:10</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44105746"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44103923">
          <h3>
            <a
              class="item"
              href="https://kaurpalang.com/posts/invading-the-sauna/"
              >Invading the Huum Uku WiFi Controller</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-27 @ 04:18:18</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44103923"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44102906">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/how-did-geometry-create-modern-physics-20250515/"
              >How did geometry create modern physics?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-27 @ 00:33:44</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44102906"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
