<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35408652">
          <h3>
            <a
              class="item"
              href="https://infosec.exchange/@tazwake/110108960041803779"
              >UK Treasury trying to find a Head of Cyber Security for £55k</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 09:16:27</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35408652"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35408507">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-03-magnon-based-paradigm-shift.html"
              >Magnon-based computation could signal computing paradigm shift</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 08:50:43</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35408507"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35408249">
          <h3>
            <a
              class="item"
              href="https://www.popsci.com/environment/renewable-energy-generation-coal-2022/"
              >For the first time, renewable energy generation beat out coal in
              the US</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 07:57:17</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35408249"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35407658">
          <h3>
            <a
              class="item"
              href="https://www.thehindu.com/sci-tech/science/isro-successfully-conducts-landing-experiment-of-the-reusable-launch-vehicle/article66690655.ece"
              >ISRO successfully lands a Reusable Launch Vehicle from a 4.5 km
              altitude.</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 06:04:27</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35407658"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35407420">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/web/AvoidingHTTP3ForNow"
              >Avoiding HTTP/3 (for a while) as a pragmatic default</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 05:18:00</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35407420"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35407295">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/23648726/hp-officejet-printer-region-how-to-change-why"
              >How to change the region on an HP OfficeJet printer in 57 easy
              steps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 04:53:30</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35407295"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35406369">
          <h3>
            <a
              class="item"
              href="https://crisal.io/words/2023/03/30/xul-layout-is-gone.html"
              >XUL Layout is gone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 02:02:27</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35406369"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35405946">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/peoplebox/jobs/P225TqI-account-executive-saas-sales-india-apac"
              >Peoplebox (YC S22) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 01:01:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35405682">
          <h3>
            <a
              class="item"
              href="https://blog.adacore.com/the-end-of-binary-protocol-parser-vulnerabilities"
              >RecordFlux: Addressing binary protocol parser vulnerabilities</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 00:21:27</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35405682"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35405338">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=ySEx_Bqxvvo"
              >MIT 6.S191: Recurrent Neural Networks, Transformers, and
              Attention</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 23:35:41</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35405338"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35405030">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2023/04/spacex-moves-starship-to-launch-site-and-liftoff-could-be-just-days-away/"
              >SpaceX moves Starship to launch site, and liftoff could be just
              days away</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 22:58:23</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35405030"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35404823">
          <h3>
            <a
              class="item"
              href="https://interactive.satellitetoday.com/via/april-2023/how-spacex-alums-are-branching-out-and-shaping-the-startup-economy/"
              >SpaceX alums are branching out and shaping the startup economy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 22:32:57</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35404823"
                  >Comments</a
                ><span class="descendants">: 176</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35404275">
          <h3>
            <a class="item" href="https://fabiensanglard.net/joy/index.html"
              >The Joy of Computer History Books</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 21:30:26</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35404275"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35404025">
          <h3>
            <a class="item" href="https://queue.acm.org/detail.cfm?id=3588242"
              >Catch-23: The New C Standard Sets the World on Fire</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 21:01:59</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35404025"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35403726">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/features/2023-03-27/swedish-housing-market-crash-exposes-economic-divisions"
              >What broke Sweden? Real estate bust exposes big divide</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 20:22:19</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35403726"
                  >Comments</a
                ><span class="descendants">: 475</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35399603">
          <h3>
            <a
              class="item"
              href="https://www.exhypothesi.com/clocks-and-causality/"
              >Clocks and Causality – Ordering Events in Distributed Systems
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 12:11:13</span
              ><span class="points-container"
                >Points: <span class="points">345</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35399603"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35399590">
          <h3>
            <a class="item" href="https://dragon863.github.io/blog/alexa.html"
              >Alexa, what is my wifi password?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 12:08:35</span
              ><span class="points-container"
                >Points: <span class="points">383</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35399590"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35399551">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-03-magnon-based-paradigm-shift.html"
              >Magnon-based computation could signal computing paradigm shift</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 12:01:07</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35399551"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35399406">
          <h3>
            <a class="item" href="https://queue.acm.org/detail.cfm?id=3580505"
              >All Sliders to the Right</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 11:32:44</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35399406"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35398901">
          <h3>
            <a
              class="item"
              href="https://csswizardry.com/2023/01/why-not-document-write/"
              >Why Not document.write()?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 09:58:13</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35398901"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35398545">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Dogme_95"
              >Dogme 95</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 08:50:26</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35398545"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35397994">
          <h3>
            <a
              class="item"
              href="https://sw.kovidgoyal.net/kitty/keyboard-protocol/"
              >Comprehensive Keyboard Handling in Terminals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 07:16:34</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35397994"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35397051">
          <h3>
            <a class="item" href="https://en.hexatrek.com"
              >Hexatrek: The long distance thru hike in France</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 04:14:02</span
              ><span class="points-container"
                >Points: <span class="points">303</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35397051"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35396156">
          <h3>
            <a
              class="item"
              href="https://www.cell.com/cell/fulltext/S0092-8674(23)00262-3"
              >Sounds emitted by plants under stress are airborne and
              informative</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 01:39:31</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35396156"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35391984">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41561-023-01159-6"
              >A solar wind-derived water reservoir on the Moon hosted by impact
              glass beads</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 19:15:21</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35391984"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35391433">
          <h3>
            <a
              class="item"
              href="https://blog.twitter.com/engineering/en_us/topics/open-source/2023/twitter-recommendation-algorithm"
              >Twitter's Recommendation Algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 18:42:16</span
              ><span class="points-container"
                >Points: <span class="points">1629</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35391433"
                  >Comments</a
                ><span class="descendants">: 1115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35389110">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35389110"
              >Launch HN: Inri (YC W23) – Wealthfront for Investing in India</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 16:02:50</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35389110"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.goinri.com/">https://www.goinri.com/</a>), an
              investment platform for Indian expats to diversify capital in
              India, without any taxation or repatriation hassles. Super excited
              to be launching on HN, the platform that I personally nerd on and
              has helped me discover some of my favorite products early.
              <p>
                My cofounder Hemant (@hemantgangolia) has been living in the US
                since 6 years and has tried multiple times to invest in India.
                He couldn't go ahead with the process because bank account
                opening was a challenge and the process after that wasn't clear.
                There is complexity around taxation, moving money back and a
                general lack of clarity on where to invest.
              </p>
              <p>
                Even though there are currently over 30 million Indian expats
                globally, there are no digital, full-service solutions offered
                for them specifically. US solutions focus only on US investments
                and Indian solutions focus only on Indian customers—this makes
                the India &lt;&gt; US belt underserved. Indian banks with
                overseas branches offer these services, but investors don’t
                trust these banks because of conflict of interest. There are
                other small players in the market but they expect customers to
                do their own service, which is not what customers want, based on
                our learnings.
              </p>
              <p>
                We found a lot of other Indian expats in the same situation as
                us - wanting to invest in India for financial and emotional
                reasons, but unable to do so easily or consistently. We wished a
                simple product existed to solve for this online. We couldn’t
                find one, so we built it.
              </p>
              <p>
                Inri is like Wealthfront for your India investments. It is a web
                platform that offers curated mutual fund portfolios and solves
                for all tax compliance and repatriation needs online. We have
                curated the funds based on performance, history and compliance
                based on your resident country, and funds are selected based on
                your risk preference, similarly to Wealthfront. We facilitate
                investments through central platforms like National Stock
                Exchange and show the holdings via a dashboard on the platform
                once the investments are done. Additionally, we do this while
                making tax compliance and repatriation easy.
              </p>
              <p>
                Just log in to the platform, upload your documents, approve the
                emails with details confirmation and you’re sorted. Currently,
                only people with a PAN card (Indian financial identity document)
                can invest.
              </p>
              <p>
                Our early customers are all people who have tried doing this
                before, but gave up because of all the hassle. The fact that
                they could get invested in just 2 days vs weeks for traditional
                alternatives was unheard of to them.
              </p>
              <p>
                We know this is a bit of a niche product for HN but we also know
                that there are quite a few Indian expats like us here, who could
                make use of it—and we hope it makes interesting enough reading
                for everybody else. We would love to get your feedback! Thank
                you!
              </p>
            </div>
          </section>
        </section>
        <section id="35386815">
          <h3>
            <a
              class="item"
              href="https://semiengineering.com/do-necessary-tools-exist-for-risc-v-verification/"
              >Do Necessary Tools Exist for RISC-V Verification?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 13:26:10</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35386815"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35384605">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/chip-shortage"
              >How and when the chip shortage will end</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 09:37:53</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35384605"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35380775">
          <h3>
            <a
              class="item"
              href="https://blog.prusa3d.com/the-state-of-open-source-in-3d-printing-in-2023_76659/"
              >The state of open-source in 3D printing in 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 00:32:09</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35380775"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
