<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39001399">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/lago/jobs/twKO87q-founding-marketer"
              >Lago – open-source Stripe alternative is hiring a Founding
              Marketer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 14:35:21</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39001210">
          <h3>
            <a
              class="item"
              href="https://twitter.com/WillManidis/status/1746894832415719554"
              >25% of US/Canada trade depends on a single privately owned
              bridge</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 14:15:01</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39001210"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39000437">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39000437"
              >Ask HN: Help me solve a dilemma, study in the US or take a job in
              the EU?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 13:05:15</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39000437"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm 20M from South Asia (not India). Got a near full-tuition
                scholarship from a T200 public university to study undergrad in
                the US. Total costs would come out to about $20k USD/year
                according to the university.
              </p>
              <p>
                I have about a year of experience under my belt and recently
                joined a non-tech-focused startup in Brlin for work under the
                condition that I'll move there soon. And, I'm really confused on
                which way to go. I do not have a qualification yet, moving to a
                place where everyone has a Masters and I don't speak the
                language feels like it'd be a massive footgun in case I get laid
                off or if the startup has to liquidate.
              </p>
              <p>
                The traditional wisdom that I'd read repeatedly until last year
                was job experience triumphs college and the opportunity cost is
                not worth it which is why I took the job, but I'm having second
                thoughts. Does that also apply to Europe?
              </p>
              <p>
                Would you say this is still the case considering the events of
                last year? Does the compensation and tax differential across the
                pond make the investment worth it to join the US labor pool down
                the line?
              </p>
              <p>
                I would like to be close to home and Europe would be more
                amenable to frequent travel, but I've read many European
                developers lament how they could effectively retire and return
                after working for just a few years if they could work in the
                states, how realistic is that?
              </p>
              <p>
                Objectively which do you think will be the better option? The
                analysis paralysis is crushing me and any advice would be
                greatly appreciated.
              </p>
            </div>
          </section>
        </section>
        <section id="39000192">
          <h3>
            <a
              class="item"
              href="https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/"
              >Get a Windows 11 development environment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 12:40:51</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39000192"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38999428">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Beaver_drop"
              >Beaver Drop</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 10:54:21</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38999428"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38998615">
          <h3>
            <a
              class="item"
              href="https://borncity.com/win/2024/01/13/order-license-chaos-for-vmware-products-after-broadcom-takeover-jan-2024/"
              >Order/license chaos for VMware products after Broadcom
              takeover</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 08:38:38</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38998615"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38998516">
          <h3>
            <a
              class="item"
              href="https://www.bitsand.cloud/posts/slashing-data-transfer-costs/"
              >Slashing Data Transfer Costs in AWS by 99%</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 08:19:13</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38998516"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38998423">
          <h3>
            <a
              class="item"
              href="https://www.themotte.org/post/797/chatgpt-vs-advent-of-code"
              >ChatGPT does Advent of Code 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 08:00:36</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38998423"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38998257">
          <h3>
            <a
              class="item"
              href="https://www.visual-literacy.org/periodic_table/periodic_table.html"
              >A periodic table of visualization methods</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 07:26:35</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38998257"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38997970">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/1964/07/18/the-swimmer"
              >The Swimmer (1964)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 06:28:39</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38997970"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38995972">
          <h3>
            <a class="item" href="https://databrokerswatch.org/"
              >Tracking and mapping the data broker ecosystem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 00:29:23</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38995972"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38994817">
          <h3>
            <a class="item" href="https://orlp.net/blog/when-random-isnt/"
              >When Random Isn't</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 21:56:29</span
              ><span class="points-container"
                >Points: <span class="points">313</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38994817"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38994680">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/leaving-arizona"
              >Leaving Arizona – the Story of the Motorola 6800 part 2 and
              creation of the 6502</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 21:38:50</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38994680"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38993891">
          <h3>
            <a
              class="item"
              href="https://www.phpied.com/font-face-toggler-bookmarklet/"
              >Font-Face Toggler Bookmarklet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 20:01:14</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38993891"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38992601">
          <h3>
            <a class="item" href="https://github.com/vanna-ai/vanna"
              >Vanna.ai: Chat with your SQL database</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 17:58:06</span
              ><span class="points-container"
                >Points: <span class="points">480</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38992601"
                  >Comments</a
                ><span class="descendants">: 206</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38989585">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/01/12/microsoft_update_for_bitlocker_vuln/"
              >Microsoft suggests command line fiddling to get Windows 10 update
              installed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 11:46:12</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38989585"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38988949">
          <h3>
            <a
              class="item"
              href="https://www.sqlite.org/cgi/src/doc/wal2/doc/wal2.md"
              >SQLite: Wal2 Mode</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 09:42:18</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38988949"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38988948">
          <h3>
            <a
              class="item"
              href="https://qsantos.fr/2024/01/04/dynamic-programming-is-not-black-magic/"
              >Dynamic programming is not black magic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 09:42:15</span
              ><span class="points-container"
                >Points: <span class="points">395</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38988948"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38988788">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/37c3-11828-how_to_build_a_submarine_and_survive#l=eng&amp;t=0"
              >How to build a submarine and survive [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 09:13:35</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38988788"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38988389">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20240112-why-the-hovercrafts-time-might-have-finally-arrived"
              >The hovercraft's time might have arrived</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 07:50:55</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38988389"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38984564">
          <h3>
            <a
              class="item"
              href="https://www.rtl-sdr.com/etherify-transmitting-morse-code-via-raspberry-pi-ethernet-rf-leakage/"
              >Etherify: Transmitting Morse Code via Raspberry Pi Ethernet RF
              Leakage (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 21:06:51</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38984564"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38979771">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/style/interactive/2024/ken-fritz-greatest-stereo-auction-cost/"
              >He spent his life building a $1M stereo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 13:40:45</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38979771"
                  >Comments</a
                ><span class="descendants">: 276</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38979412">
          <h3>
            <a
              class="item"
              href="https://omar.website/posts/notes-from-dynamicland-geokit/"
              >Notes from Dynamicland: Geokit (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 12:37:58</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38979412"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38979266">
          <h3>
            <a
              class="item"
              href="https://henrikwarne.com/2020/04/27/20-5-years-of-xp-and-agile/"
              >20.5 Years of XP and Agile (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 12:11:16</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38979266"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38978851">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/flying-circus-aerial-maps"
              >Flying Circuses</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 10:55:33</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38978851"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38977645">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Decimal_time"
              >Decimal Time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 05:44:57</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38977645"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38969533">
          <h3>
            <a
              class="item"
              href="https://johnstawinski.com/2024/01/11/playing-with-fire-how-we-executed-a-critical-supply-chain-attack-on-pytorch/"
              >A supply chain attack on PyTorch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 15:53:49</span
              ><span class="points-container"
                >Points: <span class="points">439</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38969533"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38966646">
          <h3>
            <a
              class="item"
              href="https://www.tokyoweekender.com/wp-content/uploads/2023/10/En_Route_2023.pdf"
              >En Route: A Magazine About Trains in Japan [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 11:08:45</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38966646"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38966257">
          <h3>
            <a class="item" href="http://www.terse.com/ddj.pdf"
              >Terse: A language with hi-level look-and-feel, low-level control
              (1995) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 10:17:01</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38966257"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38965636">
          <h3>
            <a class="item" href="https://penrose.cs.cmu.edu/"
              >Penrose – Create diagrams by typing notation in plain text</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 08:45:35</span
              ><span class="points-container"
                >Points: <span class="points">426</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38965636"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
