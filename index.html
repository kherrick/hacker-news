<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46841374">
          <h3>
            <a
              class="item"
              href="https://nmn.sh/blog/2023-10-02-swift-is-the-more-convenient-rust"
              >Swift is a more convenient Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 22:05:03</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46841374"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46841187">
          <h3>
            <a
              class="item"
              href="https://www.npopov.com/2026/01/31/This-year-in-LLVM-2025.html"
              >This Year in LLVM (2025)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 21:44:23</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46841187"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46840924">
          <h3>
            <a
              class="item"
              href="https://wikiedu.org/blog/2026/01/29/generative-ai-and-wikipedia-editing-what-we-learned-in-2025/"
              >Generative AI and Wikipedia editing: What we learned in 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 21:14:02</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46840924"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46840865">
          <h3>
            <a
              class="item"
              href="https://erikjohannes.no/posts/20260130-outsourcing-thinking/index.html"
              >Outsourcing Thinking</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 21:06:57</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46840865"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46840801">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/collectwise/jobs/ZunnO6k-ai-agent-engineer"
              >CollectWise (YC F24) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 21:00:56</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46840676">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2026/01/30/road_sign_hijack_ai/"
              >Autonomous cars, drones cheerfully obey prompt injection by road
              sign</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 20:48:33</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46840676"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46840252">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2512.21473"
              >Demystifying ARM SME to Optimize General Matrix
              Multiplications</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 20:05:22</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46840252"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46840219">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/system/files/login-logout_1305_mickens.pdf"
              >The Saddest Moment (2013) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 20:02:36</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46840219"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46840179">
          <h3>
            <a
              class="item"
              href="https://github.com/noctalia-dev/noctalia-shell"
              >Noctia: A sleek and minimal desktop shell thoughtfully crafted
              for Wayland</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 19:58:14</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46840179"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46840178">
          <h3>
            <a class="item" href="https://github.com/rtvkiz/minimal"
              >Show HN: Minimal – Open-Source Community driven Hardened
              Container Images</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 19:58:00</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46840178"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              I would like to share Minimal - Its a open source collection of
              hardened container images build using Apko, Melange and Wolfi
              packages. The images are build daily, checked for updates and
              resolved as soon as fix is available in upstream source and Wolfi
              package. It utilizes the power of available open source solutions
              and contains commercially available images for free. Minimal
              demonstrates that it is possible to build and maintain hardened
              container images by ourselves. Minimal will add more images
              support, and goal is to be community driven to add images as
              required and fully customizable.
            </div>
          </section>
        </section>
        <section id="46839784">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2026/jan/31/record-harvest-berlin-giveaway-potatoes"
              >Berlin: Record harvest sparks mass giveaway of free potatoes</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 19:15:52</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46839784"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46839743">
          <h3>
            <a class="item" href="https://gwern.net/death-note-anonymity"
              >Death Note: L, Anonymity and Eluding Entropy (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 19:11:34</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46839743"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46839215">
          <h3>
            <a class="item" href="https://crl.io/ds-game-engine/"
              >Nintendo DS code editor and scriptable game engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 18:27:36</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46839215"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46838981">
          <h3>
            <a class="item" href="https://genode.org/about/index"
              >Genode OS is a tool kit for building highly secure
              special-purpose OS</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 18:03:32</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46838981"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46838635">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2026-01-29/us-has-investigated-claims-that-whatsapp-chats-aren-t-private"
              >US has investigated claims WhatsApp chats aren't private</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 17:25:30</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46838635"
                  >Comments</a
                ><span class="descendants">: 287</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.ph/lZlAs">https://archive.ph/lZlAs</a>
              <p>
                <a
                  href="https://www.theguardian.com/technology/2026/jan/31/us-authorities-reportedly-investigate-claims-that-meta-can-read-encrypted-whatsapp-messages"
                  >https://www.theguardian.com/technology/2026/jan/31/us-author...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46838597">
          <h3>
            <a class="item" href="https://an.dywa.ng/carrier-gnss.html"
              >Mobile carriers can get your GPS location</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 17:21:34</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46838597"
                  >Comments</a
                ><span class="descendants">: 219</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46838417">
          <h3>
            <a class="item" href="https://yle.fi/a/74-20207494"
              >Finland to end "uncontrolled human experiment" with ban on youth
              social media</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 17:06:22</span
              ><span class="points-container"
                >Points: <span class="points">359</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46838417"
                  >Comments</a
                ><span class="descendants">: 280</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46835612">
          <h3>
            <a class="item" href="https://nemin.hu/guix.html"
              >Guix System First Impressions as a Nix User</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 11:22:24</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46835612"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46835454">
          <h3>
            <a
              class="item"
              href="https://mail.openjdk.org/pipermail/hotspot-dev/2026-January/118080.html"
              >Giving up upstream-ing my patches and feel free to pick them
              up</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 10:53:38</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46835454"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46834953">
          <h3>
            <a
              class="item"
              href="https://blog.globalping.io/we-have-ipinfo-at-home-or-how-to-geolocate-ips-in-your-cli-using-latency/"
              >We have ipinfo at home or how to geolocate IPs in your CLI using
              latency</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 09:30:05</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46834953"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46832074">
          <h3>
            <a
              class="item"
              href="https://simedw.com/2026/01/31/ear-pronunication-via-ctc/"
              >Show HN: I trained a 9M speech model to fix my Mandarin tones</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 00:51:27</span
              ><span class="points-container"
                >Points: <span class="points">427</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46832074"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's a 9M Conformer-CTC model trained on ~300h (AISHELL +
                Primewords), quantized to INT8 (11 MB), runs 100% in-browser via
                ONNX Runtime Web.
              </p>
              <p>
                Grades per-syllable pronunciation + tones with Viterbi forced
                alignment.
              </p>
              <p>
                Try it here:
                <a href="https://simedw.com/projects/ear/"
                  >https://simedw.com/projects/ear/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46829965">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Wikipedia:Sandbox"
              >Wikipedia: Sandbox</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-30 @ 21:12:01</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46829965"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              I was learning about Wikipedia recently and thought it was
              interesting there was a global, public page specifically for
              writing random stuff to learn how to use their editor. I assumed
              there would be something like this on a per-user, invisible to the
              public level, but not a global level like this page.
            </div>
          </section>
        </section>
        <section id="46815209">
          <h3>
            <a
              class="item"
              href="https://ferrari-imports.enigmatechnologies.dev/"
              >Ferrari vs. Markets</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-29 @ 19:25:32</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46815209"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46809846">
          <h3>
            <a
              class="item"
              href="https://somehowmanage.com/2026/01/22/a-step-behind-the-bleeding-edge-monarchs-philosophy-on-ai-in-dev/"
              >A Step Behind the Bleeding Edge: A Philosophy on AI in Dev</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-29 @ 13:20:07</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46809846"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46795487">
          <h3>
            <a class="item" href="https://github.com/narwhal-io/narwhal"
              >Show HN: An extensible pub/sub messaging server for edge
              applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-28 @ 13:59:06</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46795487"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                what is it? Narwhal is a lightweight Pub/Sub server and protocol
                designed specifically for edge applications. while there are
                great tools out there like NATS or MQTT, i wanted to build
                something that prioritizes customization and extensibility. my
                goal was to create a system where developers can easily adapt
                the routing logic or message handling pipeline to fit specific
                edge use cases, without fighting the server's defaults.
              </p>
              <p>
                why Rust? i chose Rust because i needed a low memory footprint
                to run efficiently on edge devices (like Raspberry Pis or small
                gateways), and also because I have a personal vendetta against
                Garbage Collection pauses. :)
              </p>
              <p>
                current status: it is currently in Alpha. it works for basic
                pub/sub patterns, but I’d like to start working on persistence
                support soon (so messages survive restarts or network
                partitions).
              </p>
              <p>
                i’d love for you to take a look at the code! i’m particularly
                interested in all kind of feedback regarding any improvements i
                may have overlooked.
              </p>
            </div>
          </section>
        </section>
        <section id="46794971">
          <h3>
            <a
              class="item"
              href="https://jaisenmathai.com/articles/my-ridiculously-robust-photo-management-system-immich-edition/"
              >My ridiculously robust photo management system (Immich
              edition)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-28 @ 13:17:56</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46794971"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46792242">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/space/2026/01/one-of-nasas-three-wb-57-aircraft-just-did-a-belly-landing-in-houston/"
              >NASA's WB-57 crash lands at Houston</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-28 @ 07:43:39</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46792242"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46791434">
          <h3>
            <a
              class="item"
              href="https://www.thetimes.com/culture/books/article/sicilian-man-leonardo-sciascia-rise-mafia-struggle-italy-soul-caroline-moorehead-review-lbsbd2p5w"
              >A novelist who took on the Italian mafia and lived</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-28 @ 05:28:36</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46791434"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.md/bzPSR">https://archive.md/bzPSR</a>
            </div>
          </section>
        </section>
        <section id="46780086">
          <h3>
            <a class="item" href="https://github.com/zpoint/CPython-Internals"
              >CPython Internals Explained</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 14:07:37</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46780086"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46779061">
          <h3>
            <a
              class="item"
              href="https://minidump.net/writing-a-net-gc-in-c-part-6/"
              >Writing a .NET Garbage Collector in C# – Part 6: Mark and
              Sweep</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 12:23:24</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46779061"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
