<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41376044">
          <h3>
            <a class="item" href="https://areweanticheatyet.com/"
              >Are We Anti-Cheat Yet?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 04:46:44</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41376044"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41375902">
          <h3>
            <a
              class="item"
              href="https://prestonbyrne.com/2024/08/24/thoughts-on-the-durov-arrest/"
              >Thoughts on the Durov Arrest</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 04:16:01</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41375902"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41375746">
          <h3>
            <a
              class="item"
              href="https://news.griffith.edu.au/2024/08/27/game-changing-needle-free-covid-19-intranasal-vaccine/"
              >Covid-19 Intranasal Vaccine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 03:47:38</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41375746"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41375548">
          <h3>
            <a class="item" href="https://gamengen.github.io"
              >Diffusion Models Are Real-Time Game Engines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 02:59:40</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41375548"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41374849">
          <h3>
            <a
              class="item"
              href="https://cerebras.ai/press-release/cerebras-launches-the-worlds-fastest-ai-inference"
              >Cerebras Launches the Fastest AI Inference</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 00:35:23</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41374849"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41374663">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/08/27/teslas-ttpoe-at-hot-chips-2024-replacing-tcp-for-low-latency-applications/"
              >Tesla's TTPoE at Hot Chips 2024: Replacing TCP for Low Latency
              Applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 00:06:45</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41374663"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41374009">
          <h3>
            <a class="item" href="https://chartdb.io/"
              >ChartDB – Free and open source, database design editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 22:38:49</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41374009"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41372992">
          <h3>
            <a class="item" href="https://www.easypost.com/careers"
              >EasyPost (YC S13) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 21:01:46</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41372833">
          <h3>
            <a class="item" href="https://josephg.com/blog/crdts-go-brrr/"
              >Faster CRDTs (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 20:47:28</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41372833"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41372482">
          <h3>
            <a class="item" href="https://taskwarrior.org/"
              >Taskwarrior – CLI Task Management</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 20:17:24</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41372482"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41372059">
          <h3>
            <a class="item" href="https://github.com/klee/klee"
              >KLEE Symbolic Execution Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 19:43:54</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41372059"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41372028">
          <h3>
            <a
              class="item"
              href="https://chromium.googlesource.com/chromium/src/+/main/docs/accessibility/browser/how_a11y_works.md"
              >How Chrome Accessibility Works</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 19:41:59</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41372028"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41371170">
          <h3>
            <a class="item" href="https://www.freepublicapis.com/"
              >A Collection of Free Public APIs That Is Tested Daily</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 18:38:59</span
              ><span class="points-container"
                >Points: <span class="points">334</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41371170"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41371106">
          <h3>
            <a class="item" href="https://www.mono-project.com/"
              >Microsoft donates the Mono Project to the Wine team</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 18:34:09</span
              ><span class="points-container"
                >Points: <span class="points">934</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41371106"
                  >Comments</a
                ><span class="descendants">: 285</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41371083">
          <h3>
            <a class="item" href="https://github.com/NousResearch/DisTrO"
              >DisTrO – a family of low latency distributed optimizers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 18:32:37</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41371083"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41370420">
          <h3>
            <a
              class="item"
              href="https://blog.apnic.net/2021/11/18/vulnerabilities-show-why-starttls-should-be-avoided-if-possible/"
              >Vulnerabilities show why STARTTLS should be avoided if possible
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 17:42:03</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41370420"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41370344">
          <h3>
            <a
              class="item"
              href="https://research.nccgroup.com/2023/02/06/rustproofing-linux-part-1-4-leaking-addresses/"
              >Rustproofing Linux (Part 1/4 Leaking Addresses) (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 17:34:52</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41370344"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41370187">
          <h3>
            <a
              class="item"
              href="https://www.blitzortung.org/en/live_lightning_maps.php"
              >Blitzortung – real time lightning strikes around the world</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 17:21:56</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41370187"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41370020">
          <h3>
            <a
              class="item"
              href="https://owickstrom.github.io/the-monospace-web/"
              >The Monospace Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 17:09:56</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41370020"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41368866">
          <h3>
            <a
              class="item"
              href="https://www.theartnewspaper.com/2024/08/27/sainsbury-wing-contractors-find-1990-letter-from-donor-anticipating-their-demolition-of-false-columns"
              >Sainsbury Wing contractors find 1990 letter from donor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 15:49:27</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41368866"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41367750">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41367750"
              >Launch HN: Bucket Robotics (YC S24) – Defect detection for molded
              and cast parts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 14:12:45</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41367750"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <a href="https://bucket.bot">https://bucket.bot</a> Bucket
              transforms CAD models into custom defect detection models for
              manufacturing:
              <a href="https://youtu.be/RCyguguf3Is"
                >https://youtu.be/RCyguguf3Is</a
              >
              <p>
                Injection molded and cast parts are everywhere – 50% of what’s
                visible on a modern car is injection molded – and these molds
                are custom created for each part and assembly line. Injection
                molding is a process where small plastic pellets are heated -
                primarily by friction from an auger - and pushed into a mold -
                usually two big milled out chunks of aluminum or steel - that
                are pushed together by somewhere between 10 tons and 1000s of
                tons of pressure. Once the plastic cools the machine opens up
                the mold and pushes the newly formed object out using rods
                called ejector pins. Look at a plastic object and you can
                usually find a couple round marks from the ejector pins, a mark
                from the injection site, a ridge where the faces of the molds
                meet, and maybe some round stamp marks that tell you the day and
                shift it was made on. (Link to a great explainer on the process:
                <a href="https://youtu.be/RMjtmsr3CqA?si=QjErT_rOU9-_TQ8d"
                  >https://youtu.be/RMjtmsr3CqA?si=QjErT_rOU9-_TQ8d</a
                >)
              </p>
              <p>
                Defect detection is either traditional ML based – get a
                real-world sample, image it, label defect, repeat until there’s
                a big enough set to build a model – or done manually. Humans
                have an 80% success rate at detection - that gets worse
                throughout the day, because decision fatigue leads to
                deterioration in performance near lunch/end-of-shift (<a
                  href="https://en.wikipedia.org/wiki/Decision_fatigue"
                  >https://en.wikipedia.org/wiki/Decision_fatigue</a
                >). Creating an automated system usually takes somewhere between
                2 days and 2 weeks to collect and label real world samples then
                build a model.
              </p>
              <p>
                Injection molding is currently a 300 billion USD market, and as
                vehicle electrification increases, more of the total components
                of a car are injection molded making that market even bigger.
                And because so much of that surface area is customer-facing –
                any blemish, scratch, or burn is considered defective. Speaking
                to folks in the space, you can see a defect rate as high as 15%
                for blemishes as small as 1cm^2.
              </p>
              <p>
                Our solution to this problem is to build the models off of CAD
                designs instead of real world data. An injection mold is usually
                machined aluminum or steel and can cost anywhere from $5k to
                &gt;$100k - usually with a significant lead time. So when
                customers send out their designs to the mold makers - or their
                CNC if they do it in-house - they can also send them to us in
                parallel and have a defect detection model ready to go long
                before their mold is even finished.
              </p>
              <p>
                On the backend we’re generating these detection models by
                creating a large number of variations of the 3D model - some to
                simulate innocuous things like ejector pin marks and most to
                simulate various defects like flash. Once we have our 3D models
                generated we fire them off to the cloud to render photorealistic
                scenes with varied camera parameters, lighting, and obscurants
                (shops are dusty). Now that we have labeled images it’s a simple
                task to train a fairly off the shelf transformer based vision
                model from them and deliver it to the customer.
              </p>
              <p>
                Running the model doesn’t require fancy hardware - our usual
                target device is an Orin Nano with a 12MP camera on it - and we
                run it purely on-device so that customer images don’t need to
                leave their worksite. We charge customers by the model — when
                they plan a line change to a new mold, ideally they’ll contact
                us and we’ll have their model ready before retooling is
                complete.
              </p>
              <p>
                Injection molding is as error prone as it is cool to watch. For
                example, flash is a thin layer of extra plastic - usually
                hanging off the edge of the part or overhanging a hole in the
                part which makes parts defective aesthetically or can even
                prevent parts from joining up properly. It can happen for so
                many reasons. Too high an injection pressure, too low a clamping
                pressure, a grubby mold surface, mold wear, poor mold design,
                and that’s just to name a few!
              </p>
              <p>
                Steph and I have a history of working on tasks performed
                manually that we want to automate – we’ve been working together
                for the last five years in Pittsburgh on self-driving cars at
                Argo AI, Latitude AI, and Stack AV. Before that, I worked at
                Michelin’s test track and Uber ATG. We really, really love
                robots.
              </p>
              <p>
                Our first pitch to Y Combinator was, “build a better Intel
                RealSense” since it’s a universally used (and loathed) vision
                system in robotics. We built our first few units and started
                building demos for how folks could use our camera - and that’s
                when we found defect detection for injection molding and
                casting. Defect detection is understood and highly automated for
                things like PCBs – where a surface defect can indicate a future
                critical failure (hey that capacitor looks a little big?) but
                defect detection for higher volume/lower cost parts is still too
                high a cost and effort for most shops.
              </p>
              <p>
                We’re excited to launch Bucket with you all! We’d love to hear
                from the community – and if you know anyone working in
                industrial computer vision or in quality control, please connect
                us! My email is matt@bucket.bot – we can’t wait to see what you
                all think!
              </p>
            </div>
          </section>
        </section>
        <section id="41366006">
          <h3>
            <a class="item" href="https://splatt3r.active.vision/"
              >Splatt3R: Zero-Shot Gaussian Splatting from Uncalibrated Image
              Pairs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 10:23:35</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41366006"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41365868">
          <h3>
            <a
              class="item"
              href="https://www.politico.com/news/2024/08/26/zuckerberg-meta-white-house-pressure-00176399"
              >Zuckerberg claims regret on caving to White House pressure on
              content</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 09:50:15</span
              ><span class="points-container"
                >Points: <span class="points">540</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41365868"
                  >Comments</a
                ><span class="descendants">: 971</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41356100">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/interactive/2024/08/26/upshot/ai-synthetic-data.html"
              >When A.I.'s Output Is a Threat to A.I. Itself</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 11:24:41</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41356100"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41355797">
          <h3>
            <a class="item" href="https://rerun.io"
              >Rerun: Visualize Multimodal Data over Time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 10:34:49</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41355797"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41355796">
          <h3>
            <a
              class="item"
              href="https://wwiiafterwwii.wordpress.com/2017/02/20/cleaning-up-after-wwii/"
              >Cleaning up after WWII (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 10:34:41</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41355796"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41347368">
          <h3>
            <a
              class="item"
              href="https://theconvivialsociety.substack.com/p/if-your-world-is-not-enchanted-youre"
              >If Your World Is Not Enchanted, You're Not Paying Attention</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-25 @ 13:59:55</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41347368"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41347310">
          <h3>
            <a
              class="item"
              href="https://mssv.net/2024/08/21/a-weekend-at-the-immersion-larp-festival/"
              >A Weekend at the Immersion Larp Festival</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-25 @ 13:50:31</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41347310"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41338581">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/the-simple-algorithm-that-ants-use-to-build-bridges-20180226/"
              >The Simple Algorithm That Ants Use to Build Bridges (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-24 @ 14:29:38</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41338581"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41337469">
          <h3>
            <a class="item" href="https://github.com/moxie0/knockknock"
              >Knockknock: Simple, secure, and stealthy port knocking
              implementation (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-24 @ 11:49:53</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41337469"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
