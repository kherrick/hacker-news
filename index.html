<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43508817">
          <h3>
            <a
              class="item"
              href="https://bmcbiol.biomedcentral.com/articles/10.1186/s12915-025-02190-2"
              >A cretaceous fly trap? remarkable abdominal modification in a
              fossil wasp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 18:55:00</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43508817"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43508546">
          <h3>
            <a
              class="item"
              href="https://www.johndcook.com/blog/2025/03/27/superhyperbola/"
              >Superhyperbola</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 18:25:21</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43508546"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43508418">
          <h3>
            <a
              class="item"
              href="https://www.landh.tech/blog/20250327-we-hacked-gemini-source-code/"
              >We hacked Gemini's Python sandbox and leaked its source code (at
              least some)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 18:12:58</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43508418"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43508061">
          <h3>
            <a class="item" href="https://github.com/EmberEmu/Hexi"
              >Show HN: Hexi – Modern header-only network binary serialisation
              for C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 17:37:42</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43508061"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                I decided to put together my own class to do the job, starting
                with an easy, low-overhead way to move bytes in and out of
                arbitrary buffers. Along the way, it picked up useful bits and
                pieces, such as buffer structures and allocators that made the
                byte shuffling faster, often being able to do it with zero
                allocations and zero copies. Safety features came along to make
                sure that malicious packet data or mistakes in the code wouldn't
                result in segfaults or vulnerabilities.
              </p>
              <p>
                It's become useful enough to me that I've packaged it up in its
                own standalone library on the chance that it might be useful to
                others. It has zero dependencies other than the standard library
                and has been designed for quick integration into any project
                within minutes, or seconds with a copy paste of the amalgamated
                header. It can be used in production code but it's also ideal
                for for those that want to quickly hack away at binary data with
                minimal fuss.
              </p>
            </div>
          </section>
        </section>
        <section id="43507758">
          <h3>
            <a class="item" href="https://signalbot.one/"
              >SignalBotOne – Notification Webhooks for Signal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 17:06:56</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43507758"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43507404">
          <h3>
            <a
              class="item"
              href="https://99percentinvisible.org/episode/the-real-book/"
              >The Real Book (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 16:39:10</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43507404"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43507286">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/how-did-kerala-go-from-poor-to-prosperous-among-indias-states"
              >How Kerala got rich</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 16:27:44</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43507286"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43506574">
          <h3>
            <a
              class="item"
              href="https://depot.dev/blog/uncovering-disk-io-bottlenecks-github-actions-ci"
              >Disk I/O bottlenecks in GitHub Actions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 15:22:36</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43506574"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43506238">
          <h3>
            <a
              class="item"
              href="https://terrytao.wordpress.com/2025/03/26/decomposing-a-factorial-into-large-factors/"
              >Decomposing a Factorial into Large Factors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 14:55:54</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43506238"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43506068">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43506068"
              >Show HN: Cursor IDE now remembers your coding prefs using MCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 14:44:59</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43506068"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              <p>
                Before this integration, Cursor (an AI-assisted IDE many of us
                already use daily) lacked a robust way to persist user context.
                To solve this, I used Graphiti’s Model Context Protocol (MCP)
                server, which allows structured data exchange between the IDE
                and Graphiti's temporal knowledge graph.
              </p>
              <p>Key points of how this works:</p>
              <p>
                - Custom entities like 'Requirement', 'Preference', and
                'Procedure' precisely capture coding standards and project
                specs.
              </p>
              <p>
                - Real-time updates let Cursor adapt instantly—if you change
                frameworks or update standards, the memory updates immediately.
              </p>
              <p>
                - Persistent retrieval ensures Cursor always recalls your latest
                preferences and project decisions, across new agent sessions,
                projects, and even after restarting the IDE.
              </p>
              <p>
                I’d love your feedback—particularly on the approach and how it
                fits your workflow.
              </p>
              <p>
                Here's a detailed write-up:
                <a
                  href="https://www.getzep.com/blog/cursor-adding-memory-with-graphiti-mcp/"
                  >https://www.getzep.com/blog/cursor-adding-memory-with-graphi...</a
                >
              </p>
              <p>
                GitHub Repo:
                <a href="https://github.com/getzep/graphiti"
                  >https://github.com/getzep/graphiti</a
                >
              </p>
              <p>-Daniel</p>
            </div>
          </section>
        </section>
        <section id="43505646">
          <h3>
            <a class="item" href="https://calabro.io/zig-cgo"
              >Building Statically Linked Go Executables with CGO and Zig</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 14:11:07</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43505646"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43505626">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/materials/plastic-dissolves-ocean-overnight-no-microplastics/"
              >Japanese scientists create new plastic that dissolves in
              saltwater overnight</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 14:09:10</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43505626"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43505447">
          <h3>
            <a
              class="item"
              href="https://www.caryinstitute.org/news-insights/press-release/getting-hit-lightning-good-some-tropical-trees"
              >Getting hit by lightning is good for some tropical trees</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 13:52:58</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43505447"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43505334">
          <h3>
            <a class="item" href="https://fathom.lib.uchicago.edu/2/21701757/"
              >The Biology of B-Movie Monsters (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 13:40:41</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43505334"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43505022">
          <h3>
            <a
              class="item"
              href="https://www.ditto.com/blog/cross-platform-p2p-wi-fi-how-the-eu-killed-awdl"
              >Cross-Platform P2P Wi-Fi: How the EU Killed AWDL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 13:13:04</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43505022"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43504413">
          <h3>
            <a
              class="item"
              href="https://cardinalnews.org/2025/03/28/i-drove-300-miles-in-rural-virginia-then-asked-police-to-send-me-their-public-surveillance-footage-of-my-car-heres-what-i-learned/"
              >I asked police to send me their public surveillance footage of my
              car</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 12:14:06</span
              ><span class="points-container"
                >Points: <span class="points">431</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43504413"
                  >Comments</a
                ><span class="descendants">: 335</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43504299">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/permitflow?departmentId=d33195eb-8978-4439-abc6-5a8a072de808"
              >PermitFlow (YC W22) Is Hiring Senior/Staff Engineers in NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 12:02:32</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43503897">
          <h3>
            <a class="item" href="https://github.com/agsb/milliForth-6502"
              >MilliForth-6502: The smallest Forth real programming language for
              6502</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 11:04:40</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43503897"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43503872">
          <h3>
            <a
              class="item"
              href="https://refactoringenglish.com/chapters/write-blog-posts-developers-read/"
              >How to Write Blog Posts That Developers Read · Refactoring
              English</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 11:01:19</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43503872"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43502291">
          <h3>
            <a class="item" href="https://blog.startifact.com/posts/xee/"
              >Xee: A Modern XPath and XSLT Engine in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 06:48:18</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43502291"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43501989">
          <h3>
            <a
              class="item"
              href="https://www.cosmicpython.com/book/preface.html"
              >Architecture Patterns with Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 05:57:27</span
              ><span class="points-container"
                >Points: <span class="points">381</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43501989"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43499992">
          <h3>
            <a
              class="item"
              href="https://blog.autorouting.com/p/13-things-i-would-have-told-myself"
              >Things I would have told myself before building an autorouter</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 00:38:53</span
              ><span class="points-container"
                >Points: <span class="points">338</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43499992"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43499823">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20250325-00/?p=110993"
              >A note on the USB-to-PS/2 mouse adapter that came with Microsoft
              mouse devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 00:16:29</span
              ><span class="points-container"
                >Points: <span class="points">338</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43499823"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43499342">
          <h3>
            <a
              class="item"
              href="https://www.livescience.com/animals/giant-fungus-like-organism-may-be-a-completely-unknown-branch-of-life"
              >Giant, fungus-like organism may be a completely unknown branch of
              life</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-27 @ 23:15:28</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43499342"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43497719">
          <h3>
            <a
              class="item"
              href="https://www.merriam-webster.com/grammar/em-dash-en-dash-how-to-use"
              >How to Use Em Dashes (–), En Dashes (–), and Hyphens (-)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-27 @ 20:19:38</span
              ><span class="points-container"
                >Points: <span class="points">566</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43497719"
                  >Comments</a
                ><span class="descendants">: 427</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43497394">
          <h3>
            <a
              class="item"
              href="https://victorpoughon.fr/i-tried-making-artificial-sunlight-at-home/"
              >I tried making artificial sunlight at home</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-27 @ 19:49:28</span
              ><span class="points-container"
                >Points: <span class="points">535</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43497394"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43495617">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/research/tracing-thoughts-language-model"
              >Tracing the thoughts of a large language model</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-27 @ 17:05:36</span
              ><span class="points-container"
                >Points: <span class="points">923</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43495617"
                  >Comments</a
                ><span class="descendants">: 321</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43471096">
          <h3>
            <a
              class="item"
              href="https://euroquis.nl/freebsd/2025/03/16/framework.html"
              >Framework 13 AMD Setup with FreeBSD</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-25 @ 13:34:00</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43471096"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43469783">
          <h3><a class="item" href="https://wakana.io">Show HN</a></h3>
          <section>
            <h4>
              <span>2025-03-25 @ 10:52:03</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43469783"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                I also felt features like goals, invoices and management of
                clients shouldn't require premium subscription. And for the most
                part, I feel I'm right. Especially after implementing these
                features.
              </p>
              <p>
                The website is now in beta testing and I'd love your feedback on
                some of the metrics you'd like to see that are not currently on
                the wakatime website.
              </p>
              <p>
                I've already added stats about the amount of coding time spent
                writing code. And for me it feels like a big deal thus far.
              </p>
              <p>
                I've also been playing with an idea of showing developer
                focus/attention as buckets of heartbeats over time or heartbeat
                frequency over time.
              </p>
              <p>
                I feel there is more. Looking forward to hearing your feedback
              </p>
            </div>
          </section>
        </section>
        <section id="43463003">
          <h3>
            <a
              class="item"
              href="https://newscenter.lbl.gov/2025/03/24/moire-than-meets-the-eye/"
              >Moiré Than Meets the Eye: Uncovering the Quantum Potential of
              Phasons</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-24 @ 16:49:35</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43463003"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
