<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37524158">
          <h3>
            <a
              class="item"
              href="https://www.latimes.com/politics/story/2023-09-14/california-bill-delete-online-personal-data"
              >California lawmakers pass bill to make it easier to delete online
              personal data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 15:03:32</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37524158"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37523992">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2023/sep/14/google-location-tracking-data-settlement"
              >Google to pay $93M in settlement over deceptive location
              tracking</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 14:53:56</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37523992"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37523873">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/sysadmin/comments/16j8kw4/we_forced_our_company_to_allow_work_from_home/"
              >We forced our company to allow work from home again</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 14:47:22</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37523873"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37523188">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37523188"
              >Ask HN: Why Don't Developers Support Open Source Maintainers?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 14:09:09</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37523188"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              As developers, we may unintentionally consume other developers'
              time by using their libraries without giving back. I believe that
              if we heavily rely on a specific library, we should consider
              donating even as little as one dollar. Just imagine the positive
              impact on open-source maintainers' earnings, as they truly deserve
              our support
            </div>
          </section>
        </section>
        <section id="37522858">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/business/2023/sep/14/carrefour-puts-shrinkflation-price-warnings-on-food-to-shame-brands"
              >Carrefour puts ‘shrinkflation’ price warnings on food to shame
              brands</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 13:44:47</span
              ><span class="points-container"
                >Points: <span class="points">311</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37522858"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37522799">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2023/09/14/johnson-johnson-has-a-new-logo-after-more-than-130-years.html"
              >Johnson and Johnson is getting rid of its script logo after more
              than 130 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 13:41:23</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37522799"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37522700">
          <h3>
            <a
              class="item"
              href="https://pikuma.com/blog/origins-of-vim-text-editor"
              >Understanding the Origins and the Evolution of Vi and Vim</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 13:34:14</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37522700"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37522644">
          <h3>
            <a
              class="item"
              href="https://omnifish.ee/2023/09/15/glassfish-embedded-a-simple-way-to-run-jakarta-ee-apps/"
              >GlassFish Embedded – a simple way to run Jakarta EE apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 13:28:59</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37522644"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37522106">
          <h3>
            <a
              class="item"
              href="https://www.ritsumei.ac.jp/~akitaoka/index-e.html"
              >Akiyoshi’s Illusion Pages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 12:43:52</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37522106"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37521710">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2023/sep/15/tiktok-fined-345m-for-breaking-eu-data-law-on-childrens-accounts"
              >TikTok fined €345M for breaking EU data law on children’s
              accounts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 12:02:27</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37521710"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37521690">
          <h3>
            <a class="item" href="https://up.codes/careers"
              >UpCodes (YC S17) is hiring remote engineers across the
              Americas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 12:00:44</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37521508">
          <h3>
            <a
              class="item"
              href="https://www.imperial.ac.uk/aeronautics/research/facilities/space-lab/ice-cube-thruster/"
              >Project: ICE cube thruster</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 11:41:26</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37521508"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37521240">
          <h3>
            <a
              class="item"
              href="https://iq.thc.org/how-does-linux-start-a-process"
              >How does Linux start a process</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 11:08:06</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37521240"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37520509">
          <h3>
            <a
              class="item"
              href="https://www.embarcadero.com/products/cbuilder/starter"
              >C++Builder 11 Community Edition</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 09:34:40</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37520509"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37520441">
          <h3>
            <a class="item" href="https://incolumitas.com/pages/BotOrNot/"
              >BotOrNot (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 09:23:50</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37520441"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37520079">
          <h3>
            <a
              class="item"
              href="https://ramatak.com/2023/09/15/unitys-new-pricing-a-wake-up-call-on-the-importance-of-open-source-in-gaming/"
              >Unity’s New Pricing: A Wake-Up Call on the Importance of Open
              Source in Gaming</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 08:24:59</span
              ><span class="points-container"
                >Points: <span class="points">389</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37520079"
                  >Comments</a
                ><span class="descendants">: 355</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37520065">
          <h3>
            <a
              class="item"
              href="https://www.metzdowd.com/pipermail/cryptography/2016-March/028824.html"
              >On the Impending Crypto Monoculture (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 08:23:23</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37520065"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37520039">
          <h3>
            <a class="item" href="https://www.findmycat.io/"
              >Find my cat: open-source Cat Tracker</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 08:18:19</span
              ><span class="points-container"
                >Points: <span class="points">280</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37520039"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37519928">
          <h3>
            <a class="item" href="https://github.com/mackieks/MaplePad"
              >MaplePad – RP2040 Dreamcast controller, VMU, and Purupuru (rumble
              pack) emulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 08:00:15</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37519928"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37519852">
          <h3>
            <a
              class="item"
              href="https://cerereanscratchpad.blogspot.com/2022/08/the-ashrae-ventilation-recommendations.html"
              >The Ashrae Ventilation Recommendations Are Too Low</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 07:49:22</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37519852"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37519418">
          <h3>
            <a
              class="item"
              href="https://billwillingham.substack.com/p/willingham-sends-fables-into-the"
              >Willingham sends Fables into the public domain</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 06:51:54</span
              ><span class="points-container"
                >Points: <span class="points">421</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37519418"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37518874">
          <h3>
            <a
              class="item"
              href="https://github.com/UnknownShadow200/ClassiCube"
              >Custom Minecraft Classic client written from scratch in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 05:35:45</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37518874"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37517567">
          <h3>
            <a class="item" href="https://b612-font.com/">B612 Font Family</a>
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 02:33:03</span
              ><span class="points-container"
                >Points: <span class="points">339</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37517567"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37517118">
          <h3>
            <a
              class="item"
              href="https://terrytao.wordpress.com/2012/12/29/a-mathematical-formalisation-of-dimensional-analysis/"
              >A mathematical formalization of dimensional analysis (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-15 @ 01:34:36</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37517118"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37514801">
          <h3>
            <a
              class="item"
              href="https://hermanradtke.com/webhook-failure-scenarios/"
              >Webhook Failure Scenarios</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-14 @ 21:02:47</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37514801"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37514079">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/archaeologists-discover-more-than-100-ancient-drawings-in-spanish-cave-180982898/"
              >Archaeologists Discover More Than 100 Ancient Drawings in a
              Spanish Cave</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-14 @ 20:01:47</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37514079"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37510865">
          <h3>
            <a
              class="item"
              href="https://blog.google/outreach-initiatives/education/automatic-update-extension-chromebook/"
              >Chromebooks will get 10 years of automatic updates</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-14 @ 16:14:17</span
              ><span class="points-container"
                >Points: <span class="points">635</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37510865"
                  >Comments</a
                ><span class="descendants">: 371</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37509507">
          <h3>
            <a
              class="item"
              href="https://nothinghuman.substack.com/p/the-tyranny-of-the-marginal-user"
              >The Tyranny of the Marginal User</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-14 @ 14:28:06</span
              ><span class="points-container"
                >Points: <span class="points">1294</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37509507"
                  >Comments</a
                ><span class="descendants">: 711</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37507419">
          <h3>
            <a class="item" href="https://nuejs.org"
              >Show HN: Nue – A React/Vue/Vite/Astro Alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-14 @ 11:11:17</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37507419"
                  >Comments</a
                ><span class="descendants">: 219</span></span
              >
            </h4>
            <div class="text">
              <p>I'm releasing two things today:</p>
              <p>
                1. Nue JS:
                <a href="https://nuejs.org/docs/nuejs/"
                  >https://nuejs.org/docs/nuejs/</a
                >
                — A tiny (2.3kb minzipped) JavaScript library for building user
                interfaces. It's like React/Vue core, but there are no hooks,
                effects, props, or other unusual abstractions on your way. Know
                the basics of HTML, CSS, and JavaScript and you are good to go.
                Nue JS supports server-side rendering (SSR), reactive
                components, and "isomorphic" combinations. It takes inspiration
                from Vue 2.0 and Riot.js. (I'm actually the original author of
                Riot).
              </p>
              <p>
                2. Nue ecosystem:
                <a href="https://nuejs.org/ecosystem/"
                  >https://nuejs.org/ecosystem/</a
                >
                — This is the ultimate goal and once all the sub-projects are
                finished, Nue will be a serious alternative to things like Vite,
                Next.js, and Astro.
              </p>
              <p>
                The thing is that I'm not happy with the current state of web
                development, so I want to write a completely new ecosystem from
                scratch. I'm taking advantage of the "old" innovations like
                progressive enhancement, separation of concerns, and semantic
                web design. Benefits highlighted here:
                <a href="https://nuejs.org/why/">https://nuejs.org/why/</a>
              </p>
              <p>All projects will be released under the MIT license.</p>
              <p>Happy to answer any questions.</p>
            </div>
          </section>
        </section>
        <section id="37506248">
          <h3>
            <a class="item" href="https://github.com/barracuda-fsh/pyobd"
              >Pyobd - a free and open source program for car diagnostics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-14 @ 08:05:19</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37506248"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
