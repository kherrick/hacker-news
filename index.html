<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35967850">
          <h3>
            <a
              class="item"
              href="https://www.githubstatus.com/incidents/v2xjymn61dv8"
              >GitHub Incident</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 21:16:09</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35967850"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35967704">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/middleware/jobs/8l5TKYq-ai-founding-engineer"
              >Middleware (YC W23) Is Hiring AI Founding Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 21:01:15</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35967549">
          <h3>
            <a
              class="item"
              href="https://www.gamespot.com/articles/steam-now-offers-90-minute-game-trials-starting-with-dead-space/1100-6514177/"
              >Steam Now Offers 90-Minute Game Trials, Starting with Dead
              Space</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 20:48:06</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35967549"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35967458">
          <h3>
            <a
              class="item"
              href="https://redmonk.com/sogrady/2023/05/16/language-rankings-1-23/"
              >The RedMonk Programming Language Rankings: January 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 20:40:47</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35967458"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35967381">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/23725039/framework-laptop-13-2023-intel-review"
              >Framework Laptop 13 review: a DIY dream come true</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 20:33:47</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35967381"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35966680">
          <h3>
            <a class="item" href="https://github.com/robdelacruz/lkwebserver"
              >Show HN: A little web server in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 19:37:42</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35966680"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>Supports: CGI, Reverse Proxy.</p>
              <p>Single threaded using I/O multiplexing (select).</p>
            </div>
          </section>
        </section>
        <section id="35966543">
          <h3>
            <a class="item" href="https://artificialintelligenceact.eu/"
              >EU Artificial Intelligence Act</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 19:27:33</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35966543"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35966537">
          <h3>
            <a class="item" href="http://raganwald.com/2020/05/03/fractran.html"
              >John Conway's FRACTRAN, a ridiculous, yet surprisingly deep
              language (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 19:27:18</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35966537"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35966210">
          <h3>
            <a
              class="item"
              href="https://social.treehouse.systems/@marcan/110366434912340959"
              >Why KDE Plasma was chosen as the default desktop environment for
              Asahi Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 19:05:34</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35966210"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35965541">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-01610-z"
              >One man's rare Alzheimer’s mutation delayed its onset</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 18:09:04</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35965541"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35965496">
          <h3>
            <a
              class="item"
              href="https://blogs.nvidia.com/blog/2023/05/16/colossal-biosciences-de-extinct-woolly-mammoth-parabricks/"
              >Colossal Biosciences Aims to ‘De-Extinct’ the Woolly Mammoth</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 18:05:52</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35965496"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35965483">
          <h3>
            <a class="item" href="https://bun.sh/blog/bun-v0.6.0">Bun 0.6</a>
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 18:04:20</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35965483"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35964640">
          <h3>
            <a class="item" href="https://www.neucards.com"
              >Show HN: Neucards – Privacy based digital contact card</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 17:00:55</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35964640"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <p>
                There are two major problems that neucards addresses. First,
                most people end up with contact lists that are hopelessly out of
                date. Over time, people move, change jobs, or add social
                profiles and unless they tell you, chances are you could lose
                touch. Second, your contact information ends up in the wrong
                hands. There has been a huge increase in robocalls, unsolicited
                emails, data breaches, and online scams that is driven by
                accessing a person's contact info. Even worse, with AI now being
                able to imitate a person's voice or other mannerisms, knowledge
                about the connections you have with others can be used against
                you.
              </p>
              <p>
                Neucards automatically updates your contact information for
                anyone who has your digital contact card. You control your
                contact information and who has access. This is possible because
                of end-to-end encryption. Neucards brings the same level of
                protection for your contact information as Signal or WhatsApp
                does for your chats. Privacy is built it.
              </p>
              <p>
                But, even with these protections, you can share your contact
                info with anyone. As an example, here is a link to my Social
                card:
              </p>
              <p>
                <a
                  href="https://www.neucards.com/of/braddominy?id=M6TC5PLngD&amp;k=4R98iwnoRi"
                  >https://www.neucards.com/of/braddominy?id=M6TC5PLngD&amp;k=4R98i...</a
                >
              </p>
              <p>
                I'm excited about how much neucards has grown and what I have
                planned for the future to do even more to protect people's
                privacy. If you have any comments, please let me know.
              </p>
              <p>
                Brad
                <a href="https://www.neucards.com">https://www.neucards.com</a>
              </p>
            </div>
          </section>
        </section>
        <section id="35964335">
          <h3>
            <a
              class="item"
              href="https://lgug2z.com/articles/the-bookmarking-data-model-is-wrong-for-highlighting/"
              >The Bookmarking Data Model Is Wrong for Highlighting</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 16:40:54</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35964335"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35963936">
          <h3>
            <a class="item" href="https://github.com/microsoft/guidance"
              >A guidance language for controlling LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 16:14:11</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35963936"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35961700">
          <h3>
            <a
              class="item"
              href="https://www.erlang.org/blog/otp-26-highlights/"
              >Erlang/OTP 26 Highlights</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 13:36:44</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35961700"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35961590">
          <h3>
            <a
              class="item"
              href="https://github.com/hendricius/the-sourdough-framework"
              >The Sourdough Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 13:27:56</span
              ><span class="points-container"
                >Points: <span class="points">379</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35961590"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35961309">
          <h3>
            <a
              class="item"
              href="https://www.alcademics.com/index-of-ice-experiments-on-alcademics.html"
              >Experiments in Making Cocktail Ice</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 13:04:34</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35961309"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35961032">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2023/05/re-victimization-from-police-auctioned-cell-phones/"
              >Re-Victimization from Police-Auctioned Cell Phones</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 12:39:47</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35961032"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35960663">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/05/apple-previews-live-speech-personal-voice-and-more-new-accessibility-features/"
              >Apple previews Live Speech, Personal Voice, and more new
              accessibility features</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 12:07:00</span
              ><span class="points-container"
                >Points: <span class="points">551</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35960663"
                  >Comments</a
                ><span class="descendants">: 272</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35960125">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/openai-chief-goes-before-us-congress-propose-licenses-building-ai-2023-05-16/"
              >Sam Altman goes before US Congress to propose licenses for
              building AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 11:06:54</span
              ><span class="points-container"
                >Points: <span class="points">595</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35960125"
                  >Comments</a
                ><span class="descendants">: 807</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35960018">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/widely-used-chemical-strongly-linked-parkinson-s-disease"
              >Widely used chemical strongly linked to Parkinson’s disease</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 10:52:47</span
              ><span class="points-container"
                >Points: <span class="points">644</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35960018"
                  >Comments</a
                ><span class="descendants">: 303</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35959991">
          <h3>
            <a
              class="item"
              href="https://fortran-lang.discourse.group/t/optimization-without-using-derivatives-the-prima-package-its-fortran-implementation-and-its-inclusion-in-scipy/5798"
              >Optimization Without Derivatives: Prima Fortran Version and
              Inclusion in SciPy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 10:49:29</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35959991"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35956275">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/pdf/10.1145/3510457.3513031"
              >Verifying Dynamic Trait Objects in Rust (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 00:12:01</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35956275"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35950921">
          <h3>
            <a
              class="item"
              href="https://heatmap.news/technology/so-how-do-you-actually-refill-an-aquifer"
              >So, how do you refill an aquifer?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 16:37:24</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35950921"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35949670">
          <h3>
            <a
              class="item"
              href="https://www.space.com/saturn-moon-king-62-newfound-satellites"
              >Saturn reclaims 'moon king' title from Jupiter with 62 newfound
              satellites</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 15:22:08</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35949670"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35946279">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/united-states/2023/05/14/pinball-is-booming-in-america-thanks-to-nostalgia-and-canny-marketing"
              >Pinball is booming in America</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 10:59:42</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35946279"
                  >Comments</a
                ><span class="descendants">: 182</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35946181">
          <h3>
            <a
              class="item"
              href="https://orbitalhq.com/blog/2023-05-12-why-we-created-taxi"
              >Why we created Taxi, and why we felt the need for another schema
              language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 10:48:57</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35946181"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35945006">
          <h3>
            <a class="item" href="https://www.playhextraction.com/how-to-play"
              >How to Play Hextraction</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 07:54:47</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35945006"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35941369">
          <h3>
            <a
              class="item"
              href="https://blog.plover.com/notes/game-mechanics.html"
              >Notes on rarely-seen game mechanics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-14 @ 21:09:50</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35941369"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
