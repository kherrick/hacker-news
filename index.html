<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40108231">
          <h3>
            <a
              class="item"
              href="https://blog.persistent.info/2013/06/google-reader-shutdown-tidbits.html?m=1"
              >Google Reader shutdown tidbits (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 18:58:48</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40108231"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40108069">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/are-your-earliest-childhood-memories-still-lurking-your-mind-or-gone-forever"
              >The Fading Memories of Youth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 18:36:52</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40108069"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40108031">
          <h3>
            <a class="item" href="https://www.gridstatus.io/live/caiso"
              >California Electricity Mix Live Dashboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 18:32:22</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40108031"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40107787">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.08698"
              >Lossless Acceleration of LLM via Adaptive N-Gram Parallel
              Decoding</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 18:02:40</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40107787"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40107509">
          <h3>
            <a
              class="item"
              href="https://unstructured.io/blog/understanding-what-matters-for-llm-ingestion-and-preprocessing"
              >Understanding What Matters for LLM Ingestion and Preprocessing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 17:30:54</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40107509"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40107456">
          <h3>
            <a
              class="item"
              href="https://www.chiark.greenend.org.uk/~sgtatham/puzzles/"
              >Simon Tatham's Portable Puzzle Collection</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 17:25:32</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40107456"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40107283">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/Cambly?departmentId=58bf36fe-813a-4048-bd36-11bd6f0ee3e2&amp;utm_source=ROe4eDx4yP"
              >Cambly (YC W14) is hiring engineers in SF to help people learn
              and teach English</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 17:00:43</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40107201">
          <h3>
            <a
              class="item"
              href="https://communitynets.org/content/anti-muni-broadband-budget-amendment-gets-nixed-new-york"
              >Anti-municipal broadband budget amendment gets nixed in New
              York</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 16:48:51</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40107201"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40107112">
          <h3>
            <a
              class="item"
              href="https://github.com/SuboptimalEng/volume-rendering"
              >Show HN: Volume rendering 3D data in Three.js and GLSL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 16:40:46</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40107112"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                Code should be easy to get started with for anyone familiar with
                the JS ecosystem.
              </p>
              <p>
                Questions for the HN community: I spent 20-25% of the entire
                time just setting up the project and fighting issues with the
                JavaScript ecosystem. This experience has made me consider
                learning Cpp, Metal, and XCode. Has anyone made the transition
                from WebGL/TS to Cpp or done it the other way around? What was
                your experience with it? And what about debugging? That's a big
                issue with WebGL.
              </p>
              <p>
                As for now, I'm thinking about picking up WebGPU next because it
                has an up-and-coming debugger made by Brendan Duncan[0] that
                looks promising.
              </p>
              <p>
                Edit: Anyone know why MRI data is sent via CDs and not the web?
                I started working on this project specifically because some
                people close to me got MRI scans and received CDs of their
                results. I know that some MRI data can be huge so downloading
                over the web doesn't make sense, but anything under 64MB should
                be sent over the web, no? For reference, I believe most MRI data
                can be under 250MB[1].
              </p>
              <p>
                [0]
                <a href="https://github.com/brendan-duncan/webgpu_inspector"
                  >https://github.com/brendan-duncan/webgpu_inspector</a
                >
              </p>
              <p>
                [1]
                <a
                  href="https://www.researchgate.net/figure/Typical-image-dimensions-and-uncompressed-file-sizes-for-common-medical-imaging_tbl1_320511493"
                  >https://www.researchgate.net/figure/Typical-image-dimensions...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40107007">
          <h3>
            <a class="item" href="https://github.com/google-deepmind/penzai"
              >Penzai: JAX research toolkit for building, editing, and
              visualizing neural nets</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 16:28:49</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40107007"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40106500">
          <h3>
            <a
              class="item"
              href="https://www.roguelynn.com/talks/everyday-apis/"
              >The Design of Everyday APIs (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 15:28:57</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40106500"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40106147">
          <h3>
            <a
              class="item"
              href="https://web.stanford.edu/~nanbhas/blog/forward-hooks-pytorch/"
              >Intermediate Activations – The Forward Hook</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 14:46:42</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40106147"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40105773">
          <h3>
            <a
              class="item"
              href="https://www.writesoftwarewell.com/lorry-driver-to-rails-developer-at-38/"
              >From a lorry driver to Ruby on rails developer at 38</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 13:48:19</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40105773"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40105371">
          <h3>
            <a
              class="item"
              href="https://tonoko.notion.site/I-made-an-open-source-app-to-rewind-search-everything-happened-on-your-screen-on-Windows-184d1a9d5edb494dba0c2f46d311ec5c"
              >I made an open source Windows app to rewind and search everything
              on screen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 12:53:25</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40105371"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40104774">
          <h3>
            <a
              class="item"
              href="https://github.com/tinyworldmap/tiny-world-map"
              >Tiny World Map</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 11:21:13</span
              ><span class="points-container"
                >Points: <span class="points">294</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40104774"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40104641">
          <h3>
            <a class="item" href="https://stepify.tech/"
              >Show HN: I made a website that converts YT videos into
              step-by-step guides</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 10:52:25</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40104641"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been working on this side project for the past month. It
                generates a step-by-step tutorial guide for YouTube videos that
                you can follow along without watching long videos. Best suited
                for tutorial videos but can work for other videos aswell. No BS.
                Just straight to the point.
              </p>
              <p>
                The guides are generated from pure transcript so you don't have
                to worry about it being AI. It's my first project as a total
                beginner. Something I had to do inorder to get out of tutorial
                hell.
              </p>
              <p>
                Please let me know if you have any suggestions or if you face
                any problems or bugs. I would try to fix them to the best of my
                abilities and as soon as possible.
              </p>
              <p>
                I would appreciate your feedback on this. Let me know what you
                think!
              </p>
            </div>
          </section>
        </section>
        <section id="40104492">
          <h3>
            <a class="item" href="https://github.com/luainkernel/lunatik"
              >Lunatik: Lunatik is a framework for scripting the Linux kernel
              with Lua</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 10:14:42</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40104492"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40104361">
          <h3>
            <a
              class="item"
              href="https://finance.yahoo.com/news/amazon-grows-over-750-000-153000967.html"
              >Amazon grows to over 750k robots, replacing 100k humans</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 09:40:36</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40104361"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40103590">
          <h3>
            <a
              class="item"
              href="https://jsomers.net/i-should-have-loved-biology/"
              >I Should Have Loved Biology</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 06:28:58</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40103590"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40103407">
          <h3>
            <a
              class="item"
              href="http://agileotter.blogspot.com/2014/09/programming-is-mostly-thinking.html"
              >Programming Is Mostly Thinking (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 05:40:07</span
              ><span class="points-container"
                >Points: <span class="points">602</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40103407"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40102779">
          <h3>
            <a
              class="item"
              href="https://fortune.com/europe/2024/04/11/pharmaceutical-giant-bayer-ceo-bill-anderson-rid-bosses-staff-self-organize-save-2-billion/"
              >Bayer is getting rid of bosses and asking staff to
              ‘self-organize’</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 02:38:58</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40102779"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40100569">
          <h3>
            <a
              class="item"
              href="https://www.wbur.org/onpoint/2023/11/15/how-to-fix-americas-aviation-system"
              >How to fix America's aviation system (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 20:07:33</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40100569"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40098597">
          <h3>
            <a
              class="item"
              href="https://medium.com/@philogb/exploring-indras-pearls-with-webgpu-e0f4a745c2f6"
              >Show HN: Exploring Indra's Pearls with WebGPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 16:40:26</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40098597"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40097681">
          <h3>
            <a
              class="item"
              href="https://without.boats/blog/coroutines-and-effects/"
              >Coroutines and Effects</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 14:39:30</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40097681"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40095900">
          <h3>
            <a
              class="item"
              href="https://www.gq.com/story/pulling-weeds-with-chris-black-cindy-lee-might-be-the-future-of-music"
              >Cindy Lee might be the future of music</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 09:01:37</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40095900"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40095376">
          <h3>
            <a
              class="item"
              href="https://mlochbaum.github.io/BQN/doc/birds.html"
              >BQN for Birdwatchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 06:46:10</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40095376"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40090580">
          <h3>
            <a class="item" href="https://www.lostlanguageofthemachines.com"
              >Show HN: A storybook designed to teach kids about how computers
              work</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-19 @ 18:45:53</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40090580"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <p>
                Set 500 years in the future, the story follows two kids – one a
                robot, the other a human – as they explore the workings of what
                to them is ancient technology: our present-day computers. I’ve
                aimed to keep each story short and engaging, sprinkling in humor
                and illustrations to captivate young readers.
              </p>
              <p>
                As an open-source project, you’re also welcome to check out the
                source here:
                <a href="https://github.com/yong/lostlanguageofthemachines"
                  >https://github.com/yong/lostlanguageofthemachines</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40089028">
          <h3>
            <a
              class="item"
              href="https://apps.apple.com/ca/app/the-official-mta-app/id1297605670"
              >Show HN: We relaunched the Official MTA App for NYC public
              transit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-19 @ 16:46:28</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40089028"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
            <div class="text"><p>Let us know what you think!</p></div>
          </section>
        </section>
        <section id="40083748">
          <h3>
            <a class="item" href="https://lwn.net/Articles/968300/"
              >The PostgreSQL community debates ALTER SYSTEM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-19 @ 05:39:36</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40083748"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40077557">
          <h3>
            <a
              class="item"
              href="https://theoceancleanup.com/updates/the-ocean-cleanup-makes-biggest-ever-river-catch-in-guatemala/"
              >Our biggest ever river catch?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-18 @ 16:00:16</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40077557"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
