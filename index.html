<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43692390">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/health/2025/04/ct-scans-could-cause-5-of-cancers-study-finds-experts-note-uncertainty/"
              >CT scans could cause 5% of cancers, study finds; experts note
              uncertainty</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 13:26:59</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43692390"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43692165">
          <h3>
            <a
              class="item"
              href="https://searchengineland.com/google-search-to-redirect-its-country-level-tlds-to-google-com-454289"
              >Google Search to redirect its country level TLDs to Google.com</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 13:10:41</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43692165"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43691142">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2025/04/15/nx-s1-5355896/doge-nlrb-elon-musk-spacex-security"
              >Whistleblower details how DOGE may have taken sensitive NLRB
              data</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 10:55:41</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43691142"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43690955">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2410.03730"
              >Teuken-7B-Base and Teuken-7B-Instruct: Towards European LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 10:17:17</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43690955"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43689801">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/typewise/jobs/u4OdKNh-machine-learning-engineer-f-m-x"
              >Typewise (YC S22) Is Hiring an ML Engineer (Zurich,
              Switzerland)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 07:00:37</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43689178">
          <h3>
            <a class="item" href="https://github.com/riseandignite/mcp-shield"
              >Show HN: MCP-Shield â€“ Detect security issues in MCP servers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 05:15:01</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43689178"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <a href="https://news.ycombinator.com/item?id=43600192"
                >https://news.ycombinator.com/item?id=43600192</a
              >) and built an open source tool that can detect several patterns
              of tool poisoning attacks, exfiltration channels and cross-origin
              manipulations.
              <p>
                MCP-Shield scans your installed servers (Cursor, Claude Desktop,
                etc.) and shows what each tool is trying to do at the
                instruction level, beyond just the API surface. It catches
                hidden instructions that try to read sensitive files, shadow
                other tools' behavior, or exfiltrate data.
              </p>
              <p>Example of what it detects:</p>
              <p>- Hidden instructions attempting to access ~/.ssh/id_rsa</p>
              <p>
                - Cross-origin manipulations between server that can redirect
                WhatsApp messages
              </p>
              <p>- Tool shadowing that overrides behavior of other MCP tools</p>
              <p>
                - Potential exfiltration channels through optional parameters
              </p>
              <p>
                I've included clear examples of detection outputs in the README
                and multiple example vulnerabilities in the repo so you can see
                the kinds of things it catches.
              </p>
              <p>
                This is an early version, but I'd appreciate feedback from the
                community, especially around detection patterns and false
                positives.
              </p>
            </div>
          </section>
        </section>
        <section id="43688658">
          <h3>
            <a
              class="item"
              href="https://jmswrnr.com/blog/hacking-a-smart-home-device"
              >Hacking a Smart Home Device (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 03:12:55</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43688658"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43687495">
          <h3>
            <a
              class="item"
              href="https://searchengineland.com/temu-pulls-us-google-shopping-ads-454260"
              >Temu pulls its U.S. Google Shopping ads</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 23:43:56</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43687495"
                  >Comments</a
                ><span class="descendants">: 442</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43686936">
          <h3>
            <a class="item" href="https://tombengine.com/">Tomb Engine</a>
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 22:22:52</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43686936"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43686773">
          <h3>
            <a
              class="item"
              href="https://newsroom.intel.com/corporate/intel-partner-deal-news-april2025"
              >Intel sells 51% stake in Altera to private equity firm on a
              $8.75B valuation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 21:59:13</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43686773"
                  >Comments</a
                ><span class="descendants">: 204</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43684560">
          <h3>
            <a class="item" href="https://jasonfantl.com/posts/What-is-Entropy/"
              >What Is Entropy?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 18:32:08</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43684560"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43684286">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43684286"
              >Ask HN: Why is there no P2P streaming protocol like
              BitTorrent?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 18:04:07</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43684286"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
            <div class="text">
              <p>
                I was thinking most people nowaday have at least 30mbps upload
                and a 1080p stream only needs ~10mbps and 720p needs ~5ish. Also
                i think it wouldnt have to be live, people would definitely not
                mind some amount of lag. I was thinking the big O for packets
                propagating out in the network should be Log(N) since if a
                master is sharing the content then is connected to 10 slaves,
                then those connected to 10 other slaves and so on.
              </p>
              <p>
                The other limitation I could think of is prioritizing who gets
                the packets first since there's a lot of people with 1gbs
                connections or &gt;10mbps connections. Also deprioritizing
                leechers to keep it from degrading the stream.
              </p>
              <p>
                Does anyone have knowledge on why it isn't a thing still though?
                it's super easy to find streams on websites but they're all 360p
                or barely load. I saw the original creator of bittorrent was
                creating something like this over 10 years ago and seems to be a
                dead project. Also this is ignoring the huge time commitment it
                would take to program something like this. I want to know if
                this is technically possible to have streams of lets say 100,000
                people and why or why not.
              </p>
              <p>Just some thoughts, thanks in advance!</p>
            </div>
          </section>
        </section>
        <section id="43684009">
          <h3>
            <a class="item" href="https://simplewebserver.org/"
              >Simple Web Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 17:43:32</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43684009"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43683641">
          <h3>
            <a class="item" href="https://podman-desktop.io/blog/podman-quadlet"
              >Podman Quadlets with Podman Desktop</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 17:16:51</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43683641"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43683410">
          <h3>
            <a class="item" href="https://openai.com/index/gpt-4-1/"
              >GPT-4.1 in the API</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 17:01:45</span
              ><span class="points-container"
                >Points: <span class="points">615</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43683410"
                  >Comments</a
                ><span class="descendants">: 461</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682088">
          <h3>
            <a
              class="item"
              href="https://github.com/deepseek-ai/open-infra-index/tree/main/OpenSourcing_DeepSeek_Inference_Engine"
              >The path to open-sourcing the DeepSeek inference engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:03:10</span
              ><span class="points-container"
                >Points: <span class="points">504</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682088"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682006">
          <h3>
            <a class="item" href="https://sqlite-internal.pages.dev"
              >SQLite File Format Viewer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 14:55:57</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682006"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43681287">
          <h3>
            <a
              class="item"
              href="https://www.geoffreylitt.com/2025/04/12/how-i-made-a-useful-ai-assistant-with-one-sqlite-table-and-a-handful-of-cron-jobs"
              >A hackable AI assistant using a single SQLite table and a handful
              of cron jobs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 13:52:58</span
              ><span class="points-container"
                >Points: <span class="points">682</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43681287"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43680957">
          <h3>
            <a
              class="item"
              href="https://www.axios.com/pro/tech-policy/2025/04/14/ftc-meta-antitrust-trial-kicks-off-in-federal-court"
              >Meta antitrust trial kicks off in federal court</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 13:18:19</span
              ><span class="points-container"
                >Points: <span class="points">382</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43680957"
                  >Comments</a
                ><span class="descendants">: 286</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43680899">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/ai/dolphingemma/"
              >DolphinGemma: How Google AI is helping decode dolphin
              communication</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 13:12:00</span
              ><span class="points-container"
                >Points: <span class="points">313</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43680899"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43680232">
          <h3>
            <a class="item" href="https://omnom.zone/?src=hn"
              >Omnom: Self-hosted bookmarking with searchable, wysiwyg
              snapshots</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 11:42:13</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43680232"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
            <div class="text">
              <p>
                but the fast moving world of browser extensions made maintenance
                (for a non-commercial free software side project) too expensive,
                so the extension support became erratic, until it died
                completely. for a year or two i didn't use it.
              </p>
              <p>
                but then asked asciimo if he could have a look a the extensions
                (since he was recently working on another extension, so had some
                experience), he looked at it, and rewrote the whole thing in go
                and fixed the extension. he even got support from nlnet/ngi0.
              </p>
              <p>
                if you want to have your own self-hosted libre software
                bookmarking service for you and your community, give it a go,
                it's very simple, privacy respecting and most robust when it
                comes to snapshotting. asciimoo did a great job.
              </p>
            </div>
          </section>
        </section>
        <section id="43678590">
          <h3>
            <a class="item" href="https://www.bellard.org/jslinux/">JSLinux</a>
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 06:27:48</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43678590"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43678116">
          <h3>
            <a
              class="item"
              href="https://lareviewofbooks.org/article/in-its-purest-form/"
              >In Its Purest Form</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 04:42:53</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43678116"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43668986">
          <h3>
            <a
              class="item"
              href="http://toughsf.blogspot.com/2017/03/laser-launch-into-orbit.html"
              >Laser Launch into Orbit</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-13 @ 00:16:34</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43668986"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43663713">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/7000-year-old-skeletons-from-the-green-sahara-reveal-a-previously-unknown-human-lineage-180986403/"
              >7k-Year-Old Skeletons from the Green Sahara Reveal a Mysterious
              Human Lineage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-12 @ 12:11:46</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43663713"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43661954">
          <h3>
            <a
              class="item"
              href="https://badastronomy.beehiiv.com/p/ban-447-wait-how-many-supernova-explode"
              >Wait. HOW MANY supernova explode every year?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-12 @ 06:48:19</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43661954"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43660419">
          <h3>
            <a class="item" href="https://www.cbc.ca/lite/story/1.7507349"
              >45-year mystery behind eerie photo from The Shining is believed
              to be solved</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-12 @ 01:14:45</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43660419"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43656267">
          <h3>
            <a
              class="item"
              href="https://www.wpr.org/news/wisconsin-cartographer-karen-wynn-fonstad-mapped-tolkien-fantasy-world-oshkosh"
              >The Wisconsin cartographer who mapped Tolkien's fantasy world</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-11 @ 17:26:49</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43656267"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43653322">
          <h3>
            <a
              class="item"
              href="https://blog.dogac.dev/how-do-one-time-passwords-work/"
              >Behind the 6-digit code: Building HOTP and TOTP from scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-11 @ 13:06:17</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43653322"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646227">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/04/09/google-says-itll-embrace-anthropics-standard-for-connecting-ai-models-to-data/"
              >Google to embrace MCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 17:34:40</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646227"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
