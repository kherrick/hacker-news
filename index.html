<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42592910">
          <h3>
            <a class="item" href="https://practicapp.com/carbagepilot-part1/"
              >Self driving 1993 Volvo with open pilot</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-04 @ 06:30:24</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42592910"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42592665">
          <h3>
            <a
              class="item"
              href="https://cepr.org/voxeu/columns/china-worlds-sole-manufacturing-superpower-line-sketch-rise"
              >China is the manufacturing superpower</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-04 @ 05:25:04</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42592665"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42592543">
          <h3>
            <a class="item" href="https://pages.cs.wisc.edu/~remzi/Naur.pdf"
              >Programming as Theory Building [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-04 @ 05:00:24</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42592543"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42592316">
          <h3>
            <a class="item" href="https://www.strydr.net/articles/devlog-0x1"
              >XORShift for Magic Bitboards</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-04 @ 04:11:21</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42592316"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42592224">
          <h3>
            <a
              class="item"
              href="https://calendar.perfplanet.com/2024/breaking-up-with-long-tasks-or-how-i-learned-to-group-loops-and-wield-the-yield/"
              >Breaking Up with Long Tasks or: how I learned to group loops and
              wield the yield</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-04 @ 03:51:38</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42592224"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42592126">
          <h3>
            <a class="item" href="https://lewiscampbell.tech/blog/250104.html"
              >Do Files want to be Actors?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-04 @ 03:32:06</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42592126"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42591818">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/battlezone"
              >The Invention of Battlezone (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-04 @ 02:35:58</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42591818"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42590903">
          <h3>
            <a
              class="item"
              href="https://www.ksjd.org/2024-12-31/in-colorado-a-marriage-of-solar-energy-and-farming-provides-a-model-for-a-more-sustainable-future"
              >In Colorado, a marriage of solar energy and farming</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-04 @ 00:13:13</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42590903"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42590788">
          <h3>
            <a class="item" href="https://github.com/caoccao/swc4j"
              >Swc4j: SWC for Java</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 23:52:00</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42590788"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42590307">
          <h3>
            <a
              class="item"
              href="https://github.com/obfusk/fdroid-fakesigner-poc"
              >F-Droid Fake Signer PoC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 22:47:11</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42590307"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42590055">
          <h3>
            <a
              class="item"
              href="https://mainichi.jp/english/articles/20241115/p2a/00m/0sc/009000c"
              >Parasitic worms 'manipulate' mantises onto asphalt roads, say
              researchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 22:18:12</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42590055"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42589863">
          <h3>
            <a
              class="item"
              href="https://twitter.com/damengchen/status/1875296442417607072"
              >Perplexity got ads</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 21:54:42</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42589863"
                  >Comments</a
                ><span class="descendants">: 187</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42589629">
          <h3>
            <a
              class="item"
              href="https://github.com/engboris/transcendental-syntax"
              >Transcendental Syntax</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 21:24:44</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42589629"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42589431">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/extend/9d4d8974-bd9b-432d-84ec-8268e5a8ed37"
              >Extend (YC W23) is hiring engineers to build LLM document
              processing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 21:01:16</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42588956">
          <h3>
            <a class="item" href="https://github.com/s-macke/VoxelSpace"
              >VoxelSpace: Terrain rendering algorithm in less than 20 lines of
              code (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 20:01:29</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42588956"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42587356">
          <h3>
            <a class="item" href="https://pavelsevecek.github.io/">SpaceSim</a>
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 17:05:17</span
              ><span class="points-container"
                >Points: <span class="points">292</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42587356"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42586590">
          <h3>
            <a
              class="item"
              href="https://mathr.co.uk/blog/2021-05-14_deep_zoom_theory_and_practice.html"
              >Mandelbrot deep zoom theory and practice (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 15:42:02</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42586590"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42586042">
          <h3>
            <a class="item" href="https://blog.val.town/blog/fast-follow/"
              >What we learned copying all the best code assistants</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 14:45:52</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42586042"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42585707">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2501.00536"
              >Phase behavior of Cacio and Pepe sauce</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 13:59:49</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42585707"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42585009">
          <h3>
            <a class="item" href="https://pimosa.app/"
              >Show HN: I completed shipping my desktop app</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 12:20:27</span
              ><span class="points-container"
                >Points: <span class="points">276</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42585009"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
            <div class="text">
              <p>
                I had made so many useless apps [you should check my website
                <a href="https://ansh.life">https://ansh.life</a>], but this
                time I built a very useful product that has a number of super
                easy-to-use tools in one app for video, music, and photo files.
                Users can compress, convert, resize, and do so much more with
                easy-to-use tools.
              </p>
              <p>
                Background: I developed a frame-by-frame video cropper to upload
                cropped landscape videos to Instagram Reels. However, it
                required FFmpeg, and as a noob video editor, I decided to
                incorporate more user-friendly video tools. I then introduced
                image and audio tools to maximize the capabilities of FFmpeg. I
                use my app daily, and it has surprisingly generated a few
                thousand dollars for me.
              </p>
            </div>
          </section>
        </section>
        <section id="42584750">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/publications/loginonline/evolution-sre-google"
              >The Evolution of SRE at Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 11:38:49</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42584750"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42584400">
          <h3>
            <a
              class="item"
              href="https://minimaxir.com/2025/01/write-better-code/"
              >Can LLMs write better code if you keep asking them to “write
              better code”?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 10:30:44</span
              ><span class="points-container"
                >Points: <span class="points">675</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42584400"
                  >Comments</a
                ><span class="descendants">: 385</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42583947">
          <h3>
            <a
              class="item"
              href="https://benjamincongdon.me/blog/2021/08/17/B-Trees-More-Than-I-Thought-Id-Want-to-Know/"
              >B-Trees: More Than I Thought I'd Want to Know</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 09:04:50</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42583947"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42583181">
          <h3>
            <a class="item" href="https://inventwithpython.com/recursion/"
              >The Recursive Book of Recursion</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 06:43:59</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42583181"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42570429">
          <h3>
            <a class="item" href="https://obnakwa.itch.io/dimityjones"
              >Show HN: Dimity Jones in Puzzle Castle: An Electronic Escape
              Novel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-02 @ 00:17:52</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42570429"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <a href="https://news.ycombinator.com/item?id=39972586"
                >https://news.ycombinator.com/item?id=39972586</a
              >
              ... I was humbled by and am wholeheartedly grateful to several
              brilliant proofreaders; their names appear at the end of the
              second chapter.)
              <p>
                _Dimity Jones In Puzzle Castle: An Electronic Escape Novel in
                Eighty-Nine Ciphertexts_ is a (mostly) fictional story,
                contained in a single text file, that requires the reader to
                solve puzzles as they go along, and to use each chapter's
                solution as a key to decipher the next.
              </p>
              <p>
                Think: escape room in the form of a novel -- or, as one reader
                put it, "Interactive Fiction meets Advent of Code."
              </p>
              <p>
                A computer, and rudimentary coding skills in a language of your
                choice, will be indispensable for performing the transformations
                -- and might help with the solving too!
              </p>
              <p>
                My wife, the author, passed away six years ago. This is not the
                last thing she wrote, but it is the most unusual,
                unapproachable, and personal of her major works. It is also, as
                the only novel of hers that I cannot breeze through in an
                afternoon (and despite my unflattering appearance in it), my
                favorite.
              </p>
              <p>
                Though _Dimity Jones_ was left unfinished, and perhaps
                abandoned, at the time of my wife's death, its elements were all
                there, on her hard disk, awaiting only a final compiling. My
                contribution to this text has therefore been little more than
                that of an occasional copyeditor (my wife was a meticulous
                speller and self-proofreader) and playtester.
              </p>
              <p>Thank you for checking it out.</p>
            </div>
          </section>
        </section>
        <section id="42558496">
          <h3>
            <a class="item" href="https://github.com/turbolytics/sql-flow"
              >Show HN: Execute SQL against Bluesky firehose</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-31 @ 13:13:20</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42558496"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42557924">
          <h3>
            <a
              class="item"
              href="https://www.cnet.com/tech/mobile/a-billion-pixels-a-second-i-got-a-rare-look-inside-apples-secret-iphone-16-camera-labs/"
              >A Billion Pixels a Second: Rare Look Inside Apple's iPhone 16
              Camera Labs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-31 @ 10:56:29</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42557924"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42557920">
          <h3>
            <a
              class="item"
              href="https://nicollet.net/blog/darklaga/remake.html"
              >Show HN: A remake of my 2004 PDA video game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-31 @ 10:55:56</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42557920"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                Play the game online:
                <a href="https://nicollet.net/blog/darklaga/darklaga.html"
                  >https://nicollet.net/blog/darklaga/darklaga.html</a
                >
              </p>
              <p>
                Technical article about the remake:
                <a href="https://nicollet.net/blog/darklaga/remake.html"
                  >https://nicollet.net/blog/darklaga/remake.html</a
                >
              </p>
              <p>
                I have tested Firefox, Chrome and Edge on desktop and mobile (no
                access to a device capable of running Safari).
              </p>
              <p>
                It's amazing how much difference 20 years makes: the hardware is
                so much more powerful, the web as a deployment platform is so
                much easier than side-loading onto a PDA through a serial cable
                or sharing .exe files through e-mail, and my experience as a
                professional developer makes almost everything so much easier...
                but at the same, it didn't feel that the language, editor or
                debugger (TypeScript on Visual Studio Code) were significantly
                better than good old Visual C++ 6.
              </p>
              <p>
                Repository with the code of the remake:
                <a href="https://github.com/VictorNicollet/Darklaga"
                  >https://github.com/VictorNicollet/Darklaga</a
                >
                (sadly, I cannot provide the video and audio assets themselves
                under any open license).
              </p>
            </div>
          </section>
        </section>
        <section id="42557850">
          <h3>
            <a class="item" href="https://github.com/acaudwell/Gource"
              >Gource: Software Version Control Visualization</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-31 @ 10:37:02</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42557850"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42556808">
          <h3>
            <a class="item" href="https://dvaluch.web.cern.ch/hh3/"
              >Elektročas HH3 – the most accurate pendulum clock on the
              planet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-31 @ 06:12:10</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42556808"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
