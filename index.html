<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40585728">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/live/world-us-canada-69094213"
              >Boeing Starliner launches first crewed mission</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 15:04:03</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40585728"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40585212">
          <h3>
            <a
              class="item"
              href="https://www.antipope.org/charlie/blog-static/2024/06/is-microsoft-trying-to-commit-.html"
              >Is Microsoft trying to commit suicide?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 14:28:46</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40585212"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40585207">
          <h3>
            <a
              class="item"
              href="https://www.seattletimes.com/business/boeing-aerospace/jury-finds-boeing-stole-technology-from-electric-airplane-startup-zunum/"
              >Jury finds Boeing stole technology from electric airplane startup
              Zunum</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 14:28:20</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40585207"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40585039">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2406.02061"
              >Alice in Wonderland: Simple Tasks Showing Complete Reasoning
              Breakdown in LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 14:13:39</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40585039"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40585029">
          <h3>
            <a
              class="item"
              href="https://rarehistoricalphotos.com/human-computer-women-profession/"
              >Human Computers: The Women Who Powered Early Technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 14:12:18</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40585029"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40584901">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/06/05/agile_failure_rates/"
              >Study finds 268% higher failure rates for Agile software
              projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 14:01:51</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40584901"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40584853">
          <h3>
            <a
              class="item"
              href="https://pxlnv.com/linklog/preview-rise-and-fall/"
              >The Rise and Fall of Preview</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 13:57:45</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40584853"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40584606">
          <h3>
            <a
              class="item"
              href="https://9to5mac.com/2024/06/04/bartender-acquired-unknown-developer/"
              >Popular Mac app 'Bartender' acquired by new unknown developer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 13:38:05</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40584606"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40584563">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/texas-stock-exchange-nyse-nasdaq-elon-musk-tesla-exxon-mobil-2024-6"
              >Texas poised to get own stock exchange – with less red tape than
              NYSE or Nasdaq</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 13:33:04</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40584563"
                  >Comments</a
                ><span class="descendants">: 184</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40584498">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-01677-2"
              >Superfast Microsoft AI is first to predict air pollution for the
              whole world</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 13:24:14</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40584498"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40584435">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/mcdonalds-big-mac-eu-trademark-ireland-14922a383563c60592bd3ee152a73d87"
              >McDonald's Loses 'Big Mac' Trademark in European Union</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 13:17:33</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40584435"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40584399">
          <h3>
            <a
              class="item"
              href="https://www.gamesradar.com/games/platformer/nintendo-leak-reportedly-came-from-an-employee-accessing-private-youtube-videos-but-google-says-it-was-non-intentional-because-they-only-showed-it-to-a-friend/"
              >Nintendo leak:employee accessing private YouTube videos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 13:12:58</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40584399"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40584042">
          <h3>
            <a
              class="item"
              href="https://www.schneier.com/blog/archives/2024/06/online-privacy-and-overfishing.html"
              >Online Privacy and Overfishing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 12:28:13</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40584042"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40583965">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gaming/2024/06/what-kind-of-bug-would-make-machine-learning-suddenly-40-worse-at-nethack/"
              >What kind of bug would make machine learning suddenly 40% worse
              at NetHack?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 12:17:52</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40583965"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40583946">
          <h3>
            <a
              class="item"
              href="https://www.androidauthority.com/google-maps-killing-timeline-web-access-3449017/"
              >Google Maps is killing Timeline for Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 12:15:37</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40583946"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40583909">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40583909"
              >Shuttle (YC S20) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 12:10:16</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                Shuttle is open source and our Infrastructure from Code
                framework paired with our cloud platform eliminates infra hassle
                and accelerates app development and deployment.
              </p>
              <p>
                We’re looking for a Senior Cloud Engineer who will implement and
                contribute to the technical vision for Shuttle.
              </p>
              <p>
                This is a hands-on role, with the majority of your time
                dedicated to individual contribution.
              </p>
              <p>Salary: $80K - $150K</p>
              <p>
                Read more and apply here:
                <a
                  href="https://www.ycombinator.com/companies/shuttle/jobs/9IkARen-senior-cloud-engineer"
                  >https://www.ycombinator.com/companies/shuttle/jobs/9IkARen-s...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40582603">
          <h3>
            <a class="item" href="https://github.com/laktak/zfind"
              >Show HN: zfind – CLI like find but using SQL syntax and also does
              tar/zip</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 08:19:23</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40582603"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                Also I never liked find's option syntax. I think most people
                already know SQL (or at least it's easier to learn) and a much
                better match for this task.
              </p>
            </div>
          </section>
        </section>
        <section id="40581545">
          <h3>
            <a
              class="item"
              href="https://github.blog/2024-06-03-arm64-on-github-actions-powering-faster-more-efficient-build-systems/"
              >GitHub now provides Arm-based runners</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 05:02:09</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40581545"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40581495">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/russian/articles/cg33yn232z7o"
              >Tetris Is Forty Years Old</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 04:52:21</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40581495"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40580549">
          <h3>
            <a
              class="item"
              href="https://blog.ploeh.dk/2024/06/03/youll-regret-using-natural-keys/"
              >You'll regret using natural keys</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 01:25:09</span
              ><span class="points-container"
                >Points: <span class="points">558</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40580549"
                  >Comments</a
                ><span class="descendants">: 397</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40578705">
          <h3>
            <a
              class="item"
              href="https://www.andreinc.net/2024/04/24/from-the-circle-to-epicycles"
              >An animated introduction to Fourier series</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 20:39:52</span
              ><span class="points-container"
                >Points: <span class="points">489</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40578705"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40576132">
          <h3>
            <a
              class="item"
              href="https://digilent.com/blog/why-do-electronic-components-have-such-odd-values/"
              >Why do electronic components have such odd values? (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 16:20:49</span
              ><span class="points-container"
                >Points: <span class="points">413</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40576132"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40573213">
          <h3>
            <a
              class="item"
              href="https://domm.plix.at/perl/2024_06_chopping_utf8.html"
              >How to chop off bytes of an UTF-8 string to fit into a small slot
              and look nice</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 11:25:41</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40573213"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40572288">
          <h3>
            <a class="item" href="https://github.com/NX-AI/xlstm"
              >XLSTM code release by NX-AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 09:09:55</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40572288"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40572113">
          <h3>
            <a class="item" href="https://gamehistory.org/atari-2600-tarzan/"
              >The Long-Lost Tarzan Atari Game, Preserved</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 08:43:59</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40572113"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40571727">
          <h3>
            <a class="item" href="https://emildziewanowski.com/flat-planets/"
              >Sphere Rendering: Flat Planets</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 07:42:01</span
              ><span class="points-container"
                >Points: <span class="points">228</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40571727"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40571402">
          <h3>
            <a
              class="item"
              href="https://unherd.com/2024/05/dont-be-terrified-of-pale-fire/"
              >Don't be terrified of Pale Fire</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 06:48:55</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40571402"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40569385">
          <h3>
            <a class="item" href="https://github.com/jstrieb/poker-chipper"
              >Show HN: Allocate poker chips optimally with mixed-integer
              nonlinear programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 00:29:37</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40569385"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
            <div class="text">
              <p>
                Try it out here (the submitted link goes to the GitHub repo):
                <a href="https://jstrieb.github.io/poker-chipper/"
                  >https://jstrieb.github.io/poker-chipper/</a
                >
              </p>
              <p>
                It turns out that picking chip denominations optimally—such that
                as many chips are distributed as possible, and such that the
                denominations are nice—is hard (in the computational complexity
                sense). Upon reflection, the problem seemed to be a perfect fit
                for constrained optimization.
              </p>
              <p>
                I first got a CLI prototype working with Z3 (an SMT solver with
                optimization capabilities
                <a href="https://github.com/Z3Prover/z3"
                  >https://github.com/Z3Prover/z3</a
                >) in Python. Then, I cross-compiled SCIP (<a
                  href="https://www.scipopt.org/"
                  >https://www.scipopt.org/</a
                >) to web assembly, and ported my code to use SCIP instead of Z3
                so it could run in the browser.
              </p>
              <p>
                The web interface is designed to be fast and easy to use on
                desktop and mobile.
              </p>
              <p>
                I would love to answer questions and discuss design choices. I'm
                also open to feedback and bug reports. Thanks for taking a look!
              </p>
            </div>
          </section>
        </section>
        <section id="40564489">
          <h3>
            <a class="item" href="https://www.mdpi.com/1424-8220/24/11/3349"
              >The state of the art in copter drones and flight control
              systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-03 @ 16:45:01</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40564489"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40560010">
          <h3>
            <a
              class="item"
              href="https://samcurry.net/hacking-millions-of-modems"
              >Hacking millions of modems and investigating who hacked my
              modem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-03 @ 06:51:24</span
              ><span class="points-container"
                >Points: <span class="points">757</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40560010"
                  >Comments</a
                ><span class="descendants">: 257</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
