<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37666773">
          <h3>
            <a
              class="item"
              href="https://github.com/merlinmann/wisdom/blob/master/wisdom.md"
              >Merlin's Wisdom Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 22:38:55</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37666773"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37665988">
          <h3>
            <a class="item" href="https://kapouay.eu.org/notes/sysclean-intro/"
              >Introduction to Sysclean(8) on OpenBSD</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 21:24:09</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37665988"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37665408">
          <h3>
            <a class="item" href="https://shop.boox.com/products/palma"
              >BOOX Palma</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 20:29:54</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37665408"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37664682">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/books/page-turner/rethinking-the-luddites-in-the-age-of-ai"
              >Rethinking the Luddites in the Age of A.I</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 19:31:40</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37664682"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37663820">
          <h3>
            <a class="item" href="https://github.com/facebook/prophet"
              >Prophet: Automatic Forecasting Procedure</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 18:35:04</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37663820"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37663725">
          <h3>
            <a
              class="item"
              href="https://appleinsider.com/articles/23/09/26/eu-tells-apple-to-open-everything-up-to-its-rivals"
              >EU tells Apple to open everything up to its rivals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 18:28:20</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37663725"
                  >Comments</a
                ><span class="descendants">: 326</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37663601">
          <h3>
            <a class="item" href="https://www.hertzbleed.com/gpu.zip/"
              >GPU.zip: side channel attack that exposes visual data processed
              on the GPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 18:19:40</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37663601"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37663523">
          <h3>
            <a class="item" href="https://ff13.fastforwardlabs.com/"
              >Causality for Machine Learning (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 18:14:23</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37663523"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37663270">
          <h3>
            <a class="item" href="https://raverie-us.github.io/raverie-engine/"
              >Show HN: Unity like game editor running in pure WASM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 17:58:47</span
              ><span class="points-container"
                >Points: <span class="points">370</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37663270"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
            <div class="text">
              <p>
                We’re building off a previous engine that we worked on for
                DigiPen Institute of Technology called the Zero Engine with a
                similar component based design architecture to Unity. Our engine
                had a unique feature called Spaces: separate worlds/levels that
                you can instantiate and run at the same time, which became super
                useful for creating UI overlays using only game objects, running
                multiple simulations, etc. The lighting and rendering engine is
                scriptable, and the default deferred rendering implementation is
                based on the Unreal physically based rendering (PBR) approach.
                The physics engine was built from the ground up to handle both
                2D and 3D physics together. The scripting language was also
                built in house to be a type safe language that binds to C++
                objects and facilitates auto-complete (try it in editor!)
              </p>
              <p>
                This particular fork by Raverie builds both the engine and
                editor to WebAssembly using only clang without Emscripten. We
                love Emscripten and in fact borrowed a tiny bit of exception
                code that we’d love to see up-streamed into LLVM, however we
                wanted to create a pure WASM binary without Emscripten bindings.
                We also love WASI too though we already had our own in memory
                virtual file system, hence we don’t use the WASI imports. All
                WASM imports and exports needed to run the engine are defined
                here:
                <a
                  href="https://github.com/raverie-us/raverie-engine/blob/main/Code/Foundation/Platform/PlatformCommunication.hpp"
                  >https://github.com/raverie-us/raverie-engine/blob/main/Code/...</a
                >
              </p>
              <p>
                The abstraction means that in the future, porting to other
                platforms that can support a WASM runtime should be trivial.
                It’s our dream to be able to export a build of your game to any
                platform, all from inside the browser. Our near term road-map
                includes getting the sound engine integrated with WebAudio,
                getting the script debugger working (currently freezes), porting
                our networking engine to WebRTC and WebSockets, and getting
                saving/loading from a database instead of browser local storage.
              </p>
              <p>
                Our end goal is to use this engine to create an online
                Flash-like hub for games that people can share and remix, akin
                to Scratch or Tinkercad.
              </p>
              <p>
                <a href="https://github.com/raverie-us/raverie-engine"
                  >https://github.com/raverie-us/raverie-engine</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37663194">
          <h3>
            <a
              class="item"
              href="https://www.eetimes.com/rocm-is-amds-no-1-priority-exec-says/"
              >ROCm is AMD's priority, executive says</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 17:54:42</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37663194"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37663159">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/security/2023/09/gpus-from-all-major-suppliers-are-vulnerable-to-new-pixel-stealing-attack/"
              >Sidechannel pixel-stealing attack works in Chromium on all modern
              GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 17:52:45</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37663159"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37662655">
          <h3>
            <a class="item" href="https://fabiensanglard.net/st/index.html"
              >Exploring Linux command-line space time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 17:21:12</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37662655"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37662561">
          <h3>
            <a class="item" href="https://github.com/mckinsey/vizro"
              >Vizro – toolkit for creating modular data visualization
              applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 17:15:33</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37662561"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37662510">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/09/macos-sonoma-is-available-today/"
              >macOS Sonoma is available today</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 17:12:17</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37662510"
                  >Comments</a
                ><span class="descendants">: 257</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37662297">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/byterat/jobs/UtaWWqL-founding-engineer"
              >Byterat (YC W23) Is Hiring a Founding Engineer (San Francisco)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 17:00:05</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37662281">
          <h3>
            <a
              class="item"
              href="https://modernfarmer.com/2023/09/digging-in-mutton/"
              >Why don’t Americans eat mutton?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 16:59:20</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37662281"
                  >Comments</a
                ><span class="descendants">: 167</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37661767">
          <h3>
            <a class="item" href="https://github.com/jackmpcollins/magentic"
              >Show HN: Magentic – Use LLMs as simple Python functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 16:31:16</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37661767"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built this to show that we can think about using LLMs more
                fluidly than just chains and chats, i.e. more interchangeably
                with regular code, and to make it easy to do that.
              </p>
              <p>Please let me know what you think! Contributions welcome.</p>
              <p>
                <a href="https://github.com/jackmpcollins/magentic"
                  >https://github.com/jackmpcollins/magentic</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37661446">
          <h3>
            <a
              class="item"
              href="https://www.ftc.gov/news-events/news/press-releases/2023/09/ftc-sues-amazon-illegally-maintaining-monopoly-power"
              >FTC sues Amazon for illegally maintaining monopoly power</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 16:10:40</span
              ><span class="points-container"
                >Points: <span class="points">712</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37661446"
                  >Comments</a
                ><span class="descendants">: 545</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37660025">
          <h3>
            <a class="item" href="https://github.com/ruricolist/spinneret"
              >Spinneret: A modern Common Lisp HTML generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 14:36:18</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37660025"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37659164">
          <h3>
            <a
              class="item"
              href="https://www.japantimes.co.jp/community/2023/09/25/how-tos/freelancer-tax-system/"
              >Freelancers aren’t happy with Japan’s new invoice system</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 13:41:45</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37659164"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37657772">
          <h3>
            <a class="item" href="https://github.com/datalens-tech"
              >Yandex open sourced it's BI tool DataLens</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 11:36:21</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37657772"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37657368">
          <h3>
            <a
              class="item"
              href="https://www.etymonline.com/columns/post/who-lusts-for-certainty-lusts-for-lies"
              >Who lusts for certainty lusts for lies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 10:50:26</span
              ><span class="points-container"
                >Points: <span class="points">361</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37657368"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37654751">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/mathematicians-cross-the-line-to-get-to-the-point-20230925/"
              >Mathematicians cross the line to get to the point</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 05:17:18</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37654751"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37650402">
          <h3>
            <a
              class="item"
              href="https://www.cambridgeblog.org/2023/05/a-journey-into-the-shaken-baby-syndrome-abusive-head-trauma-controversy/"
              >A journey into the shaken baby syndrome/abusive head trauma
              controversy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 20:49:09</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37650402"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37649250">
          <h3>
            <a
              class="item"
              href="https://www.theparisreview.org/blog/2023/09/22/j-g-ballards-brilliant-not-good-writing/"
              >J. G. Ballard’s brilliant, “not good” writing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 19:27:00</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37649250"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37646008">
          <h3>
            <a class="item" href="https://verilogtorouting.org/"
              >Verilog to Routing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 15:59:13</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37646008"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37644493">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-09-donated-artifacts-treasure-trove-neanderthal.html"
              >Box of donated artifacts turns out to be treasure trove of
              Neanderthal bones</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 14:35:22</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37644493"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37632509">
          <h3>
            <a
              class="item"
              href="https://www.edbatista.com/2023/09/currencies-on-motivating-different-people.html"
              >Currencies (On Motivating Different People)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-24 @ 12:31:12</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37632509"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37631907">
          <h3>
            <a
              class="item"
              href="https://slack.engineering/traffic-101-packets-mostly-flow/"
              >Traffic 101: Packets Mostly Flow</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-24 @ 10:45:17</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37631907"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37621151">
          <h3>
            <a class="item" href="https://rdivyanshu.github.io/hat.html"
              >Drawing hat tiling using Racket</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-23 @ 06:51:31</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37621151"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
