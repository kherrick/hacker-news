<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42825441">
          <h3>
            <a
              class="item"
              href="https://crastinator-pro.github.io/steam-brick/"
              >Steam Brick: No screen, no controller, just a power button and a
              USB port</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 22:15:13</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42825441"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42825423">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42825423"
              >Bucket Robotics (YC S24) Is Hiring Our First Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 22:13:30</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                We're looking for a Founding Engineer based out of our San
                Francisco office to help shape our technology and culture from
                the ground up. You'll work across the robotics stack, from
                real-time defect detection to AI model deployment. Ideal
                candidates have experience in Rust, Python, computer vision, and
                robotics, with a passion for building production-grade AI
                systems.
              </p>
              <p>Why Join?</p>
              <p>
                - Work on cutting-edge AI + robotics in a high-impact role -
                Competitive salary + meaningful equity - Hands-on experience
                with real-world robotic vision challenges
              </p>
              <p>
                More details and apply here:
                <a
                  href="https://www.ycombinator.com/companies/bucket-robotics/jobs/Zp9hGkv-founding-engineer"
                  >https://www.ycombinator.com/companies/bucket-robotics/jobs/Z...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42825126">
          <h3>
            <a
              class="item"
              href="https://jimgray.azurewebsites.net/papers/TandemTR86.2_FaultToleranceInTandemComputerSystems.pdf"
              >Fault Tolerance in Tandem Computer Systems (1986)[pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 21:40:08</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42825126"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42825097">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/larry-ellison-ai-surveillance-keep-citizens-on-their-best-behavior-2024-9"
              >Larry Ellison: vast AI surveillance can ensure citizens are on
              best behavior</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 21:37:41</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42825097"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42825048">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42825048"
              >Poll: What is your preferred Search Engine?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 21:33:42</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42825048"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42824983">
          <h3>
            <a
              class="item"
              href="https://www.cidrdb.org/cidr2015/Papers/CIDR15_Paper16.pdf"
              >Immutability Changes Everything (2016) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 21:25:42</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42824983"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42824625">
          <h3>
            <a
              class="item"
              href="https://magazine.ucsf.edu/building-a-silicon-brain"
              >Using AI to develop a fuller model of the human brain</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 20:36:26</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42824625"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42824617">
          <h3>
            <a class="item" href="https://wikenigma.org.uk/start"
              >Wikenigma â€“ an Encyclopedia of Unknowns</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 20:35:45</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42824617"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42824599">
          <h3>
            <a class="item" href="https://github.com/IQEngine/WebFFT"
              >WebFFT â€“ The Fastest Fourier Transform on the Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 20:32:59</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42824599"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42824562">
          <h3>
            <a
              class="item"
              href="https://www.downtowndougbrown.com/2025/01/the-invalid-68030-instruction-that-accidentally-allowed-the-mac-classic-ii-to-successfully-boot-up/"
              >An invalid 68030 instruction accidentally allowed the Mac Classic
              II to boot</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 20:29:41</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42824562"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42824553">
          <h3>
            <a class="item" href="https://dualqrcode.com/"
              >Dual-Link QR Code Generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 20:28:18</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42824553"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42824526">
          <h3>
            <a
              class="item"
              href="https://mathieu.fenniak.net/testtrim-2025-01-nested-syscall-tracing/"
              >Testtrim: A testing tool that couldn't test itself (until now)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 20:24:55</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42824526"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42824513">
          <h3>
            <a class="item" href="https://github.com/revenate/actionate"
              >Show HN: Actionate â€“Â GitHub Actions for JetBrains IDEs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 20:23:33</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42824513"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                With Actionate, weâ€™re not just integrating CI/CD into JetBrains;
                weâ€™re leveraging the powerful building blocks provided by
                JetBrains and GitHub Actions to create new, transformative
                functionality. Our MVP (Minimum Viable Product) focuses on the
                most essential features we find critical for a smoother
                workflow, but the goal is to push beyond typical CI/CD
                boundaries and empower developers in ways that havenâ€™t been
                possible before.
              </p>
              <p>
                If this vision resonates with you, weâ€™d love for you to check
                out Actionate and let us know what you thinkâ€”good or bad. We
                thrive on community input, and your feedback will shape our
                roadmap as we continue expanding on whatâ€™s possible inside the
                IDE.
              </p>
              <p>
                Thanks for reading, and I hope Actionate helps you take your
                GitHub Actions workflow to the next level!
              </p>
            </div>
          </section>
        </section>
        <section id="42824507">
          <h3>
            <a class="item" href="https://hntrbrk.com/schrodinger/"
              >SchrÃ¶dinger: The Nvidia biotech partner Jensen Huang told to
              "think bigger"</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 20:22:53</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42824507"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42824473">
          <h3>
            <a
              class="item"
              href="https://outsidetext.substack.com/p/anomalous-tokens-in-deepseek-v3-and"
              >Searching for DeepSeek's glitch tokens</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 20:19:12</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42824473"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42823722">
          <h3>
            <a
              class="item"
              href="https://iamwillwang.com/dollar/every-html-element/"
              >Every HTML Element</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 19:02:26</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42823722"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42823667">
          <h3>
            <a class="item" href="https://www.openra.net/"
              >OpenRA â€“ Classic strategy games rebuilt for the modern era</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 18:55:07</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42823667"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42823568">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2501.12948"
              >DeepSeek-R1: Incentivizing Reasoning Capability in LLMs via RL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 18:39:49</span
              ><span class="points-container"
                >Points: <span class="points">331</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42823568"
                  >Comments</a
                ><span class="descendants">: 285</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42823385">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/01/25/us/politics/cia-covid-lab-leak.html"
              >CIA now favors lab leak theory to explain Covid's origins</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 18:16:15</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42823385"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42822825">
          <h3>
            <a class="item" href="https://tomforth.co.uk/whynorthenglandispoor/"
              >Why Northern England is poor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 16:59:35</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42822825"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42821922">
          <h3>
            <a
              class="item"
              href="https://careers.arsenal.com/jobs/5434108-research-engineer"
              >Arsenal FC AI Research Engineer job posting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 14:47:33</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42821922"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42821457">
          <h3>
            <a class="item" href="https://pilane.obviy.us/"
              >Show HN: I built a DIY plane spotting system at home</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 13:14:37</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42821457"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42820419">
          <h3>
            <a
              class="item"
              href="https://byroot.github.io/ruby/performance/2025/01/23/the-mythical-io-bound-rails-app.html"
              >The Mythical IO-Bound Rails App</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-25 @ 08:47:31</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42820419"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42809648">
          <h3>
            <a
              class="item"
              href="https://christopherchmielewski.xyz/blog/2025-01-23-enigma-oo-implementation.html"
              >Enigma Cipher Machine: An Object Oriented Python
              Implementation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-24 @ 01:13:39</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42809648"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42796298">
          <h3>
            <a
              class="item"
              href="https://eventhorizontelescope.org/m87-one-year-later-catching-black-holes-turbulent-accretion-flow"
              >M87* One Year Later: Catching the Black Hole's Turbulent
              Accretion Flow</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-22 @ 19:03:06</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42796298"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42795646">
          <h3>
            <a
              class="item"
              href="https://cacm.acm.org/opinion/life-lessons-from-the-first-half-century-of-my-career/"
              >Life lessons from the first half-century of my career</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-22 @ 18:01:18</span
              ><span class="points-container"
                >Points: <span class="points">344</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42795646"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42793580">
          <h3>
            <a class="item" href="https://github.com/SpinalHDL/VexRiscv"
              >A FPGA friendly 32 bit RISC-V CPU implementation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-22 @ 15:06:36</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42793580"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42791378">
          <h3>
            <a class="item" href="https://openheart.fyi/"
              >Open Heart Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-22 @ 10:49:56</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42791378"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42789670">
          <h3>
            <a
              class="item"
              href="https://suveenellawela.com/thoughts/codenames-ai"
              >OpenAI's o1 Playing Codenames</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-22 @ 06:21:12</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42789670"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42778151">
          <h3>
            <a
              class="item"
              href="https://mattrighetti.com/2025/01/20/you-dont-need-sql-builders"
              >You probably don't need query builders</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-21 @ 09:47:55</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42778151"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
