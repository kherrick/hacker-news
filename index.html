<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41040543">
          <h3>
            <a class="item" href="https://danq.me/2024/07/21/ascii/"
              >The Elegance of the ASCII Table</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 22:31:17</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41040543"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41040494">
          <h3>
            <a
              class="item"
              href="https://netflixtechblog.com/supporting-diverse-ml-systems-at-netflix-2d2e6b6d205d"
              >Diverse ML Systems at Netflix</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 22:25:04</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41040494"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41040417">
          <h3>
            <a
              class="item"
              href="https://fas.org/publication/united-states-discloses-nuclear-warhead-numbers-restores-nuclear-transparency/"
              >United States Discloses Nuclear Warhead Numbers; Restores Nuclear
              Transparency</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 22:16:04</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41040417"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41039967">
          <h3>
            <a class="item" href="https://github.com/linuxmint/timeshift"
              >Timeshift: System Restore Tool for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 21:23:02</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41039967"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41039708">
          <h3>
            <a
              class="item"
              href="https://community.intel.com/t5/Processors/July-2024-Update-on-Instability-Reports-on-Intel-Core-13th-and/m-p/1617113#M74792"
              >July 2024 Update on Instability Reports on Intel Core 13th/14th
              Gen Desktop CPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 20:55:02</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41039708"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41039644">
          <h3>
            <a
              class="item"
              href="https://glasgow2024.org/hugo-awards/statement-22-july-2024/"
              >Glasgow 2024 Hugo Awards Statement – 22 July, 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 20:47:44</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41039644"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41039333">
          <h3>
            <a class="item" href="https://josefadamcik.github.io/SofleKeyboard/"
              >SofleKeyboard – A split keyboard based on Lily58, Crkbd and Helix
              keyboards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 20:17:05</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41039333"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41039213">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2407.09584"
              >Planck stars, White Holes, Remnants and Planck-mass
              quasi-particles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 20:05:42</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41039213"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41038552">
          <h3>
            <a
              class="item"
              href="https://bitbuilt.net/forums/index.php?threads/kawaii.6474/"
              >Kawaii – A Keychain-Sized Nintendo Wii</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 19:12:22</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41038552"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41038406">
          <h3>
            <a
              class="item"
              href="https://bigthink.com/the-past/love-letter-generator-turing-strachey-ai/"
              >The love letter generator created by Alan Turing and Christopher
              Strachey</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 19:01:45</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41038406"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41038372">
          <h3>
            <a class="item" href="https://matthewstrom.com/writing/copying/"
              >Copying is the way design works</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 18:59:38</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41038372"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41038188">
          <h3>
            <a
              class="item"
              href="https://thehobbyist.substack.com/p/800-85k-in-72-hours-reflections-on"
              >Reflections on Luck and Skill from the Part Time Poker Grind</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 18:47:23</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41038188"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41038055">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2020/05/04/the-man-who-thought-too-fast"
              >A Man Who Thought Too Fast (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 18:38:25</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41038055"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41037981">
          <h3>
            <a
              class="item"
              href="https://johncarlosbaez.wordpress.com/2024/07/20/what-is-entropy/"
              >What Is Entropy?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 18:33:35</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41037981"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41037774">
          <h3>
            <a class="item" href="https://github.com/Netflix/maestro"
              >Netflix has open-sourced its Maestro Workflow Orchestrator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 18:21:14</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41037774"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41037745">
          <h3>
            <a
              class="item"
              href="https://netflixtechblog.com/maestro-netflixs-workflow-orchestrator-ee13a06f9c78"
              >Maestro: Netflix's Workflow Orchestrator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 18:20:16</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41037745"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41037177">
          <h3>
            <a
              class="item"
              href="https://github.com/DouglasNeuroInformatics/OpenDataCapture"
              >Show HN: OpenDataCapture an electronic data capture platform for
              data collection</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 17:43:10</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41037177"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                We're the Douglas Neuroinformatics Platform[1], and we've been
                working on Open Data Capture, a web-based electronic data
                capture (EDC) platform for continuous clinical and research data
                collection. You can use it to administer instruments (like forms
                and interactive tasks) either in-person or remotely.
              </p>
              <p>
                The platform is based on a fundamentally longitudinal data
                model. Unlike other EDC platforms, which are centered around the
                concept of a study with rigid timepoints, Open Data Capture is
                designed for continuous data capture. Data is associated with a
                given session, which includes metadata such as date, time, and
                mode (i.e., in-person or remote).
              </p>
              <p>
                We've designed the system around the core restriction that many
                hospital institutions demand that data remain on-premise, while
                clinician-researchers often want to evaluate clients outside the
                institution with research questions. This has resulted in our
                innovative gateway concept, where assigned remote assessments
                are pushed onto an internet accessible service, and responses
                are encrypted in-place with HPKE[2] until the backend pulls them
                into the backend database. This makes the deployment
                firewall-friendly provided you can launch a minimal VPS or VM
                host somewhere globally accessible.
              </p>
              <p>
                We're also a big fan of making things easy to deploy, so we
                supply a docker-compose stack which can bring up a demo instance
                easily to run locally.
              </p>
              <p>
                The platform is free, open source, and written in TypeScript,
                with a NoSQL database underneath. Users can write instruments in
                TypeScript using a type-safe declarative form system (with
                native i18n support built in) or wrap and integrate completely
                arbitrary interactive tasks written in JavaScript (with optional
                support for TypeScript and JSX). Under the hood, this is based
                on dynamic imports and native ESM. There’s a browser-based IDE
                (the Instrument Playground) with live reloading and full
                Intellisense where you can try creating your own instruments.
              </p>
              <p>
                We have a local deployment going live at our institution and
                appropriately-licensed (free) instruments we're deploying here
                will be integrated directly into the codebase.
              </p>
              <p>
                Our future plans include expanding our instrument types to allow
                for binary data storage with an s3-like backend, and with
                abstractions for data types, like actigraphy, and MRI.
              </p>
              <p>
                Check it out on GitHub[3], try the Instrument Playground[4], or
                see the Live Demo[5].
              </p>
              <p>Would love to hear everybody’s thoughts!</p>
              <p>Links:</p>
              <p>
                [1]
                <a href="https://github.com/DouglasNeuroInformatics/"
                  >https://github.com/DouglasNeuroInformatics/</a
                >
              </p>
              <p>@gdevenyi @joshunrau</p>
              <p>
                [2]
                <a href="https://datatracker.ietf.org/doc/rfc9180/"
                  >https://datatracker.ietf.org/doc/rfc9180/</a
                >
              </p>
              <p>
                [3]
                <a
                  href="https://github.com/DouglasNeuroInformatics/OpenDataCapture"
                  >https://github.com/DouglasNeuroInformatics/OpenDataCapture</a
                >
              </p>
              <p>
                [4]
                <a href="https://playground.opendatacapture.org"
                  >https://playground.opendatacapture.org</a
                >
              </p>
              <p>
                [5]
                <a href="https://demo.opendatacapture.org"
                  >https://demo.opendatacapture.org</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41037079">
          <h3>
            <a class="item" href="https://ieeexplore.ieee.org/document/10549891"
              >A Formulation of the Trilemma in Proof of Work Blockchain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 17:35:06</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41037079"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41037065">
          <h3>
            <a
              class="item"
              href="https://portal.uni-koeln.de/en/universitaet/aktuell/press-releases/single-news/another-intermediate-mass-black-hole-discovered-at-the-centre-of-our-galaxy"
              >Another intermediate-mass black hole discovered at the centre of
              our galaxy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 17:34:07</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41037065"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036633">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/roame/jobs/tu786nh-founding-growth-operations"
              >Roame (YC S23) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 17:00:37</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036526">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/articles/c728ven2v9eo"
              >Oxygen discovery defies knowledge of the deep ocean</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 16:48:44</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41036526"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036462">
          <h3>
            <a
              class="item"
              href="https://www.ucsf.edu/news/2024/07/428011/scientists-discover-new-hormone-can-build-strong-bones"
              >Scientists discover a new hormone that can build strong bones</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 16:42:22</span
              ><span class="points-container"
                >Points: <span class="points">270</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41036462"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036231">
          <h3>
            <a class="item" href="https://github.com/bugbakery/audapolis"
              >Audapolis: Edit audio files by transcript, not waveform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 16:25:21</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41036231"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41033579">
          <h3>
            <a
              class="item"
              href="https://www.brendangregg.com/blog/2024-07-22/no-more-blue-fridays.html"
              >No More Blue Fridays</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 12:21:06</span
              ><span class="points-container"
                >Points: <span class="points">371</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41033579"
                  >Comments</a
                ><span class="descendants">: 221</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41033005">
          <h3>
            <a
              class="item"
              href="https://www.openresearchlab.org/studies/unconditional-cash-study/study"
              >Unconditional Cash Study: first findings available</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 11:00:16</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41033005"
                  >Comments</a
                ><span class="descendants">: 227</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41031975">
          <h3>
            <a class="item" href="https://billabear.com/"
              >Show HN: A source-available billing system I've spent 18 months
              building</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 08:22:16</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41031975"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41031112">
          <h3>
            <a class="item" href="https://github.com/eza-community/eza"
              >Eza: A modern, maintained replacement for ls</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 05:17:23</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41031112"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40988935">
          <h3>
            <a
              class="item"
              href="https://www.entrepreneur.com/en-gb/leadership/lessons-from-a-private-equity-earn-out-how-i-lost-ps550k/475909"
              >Lessons from a Private Equity Earn Out: How I Lost £550K Due to a
              Lowercase 'C'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 18:39:11</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40988935"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40988229">
          <h3>
            <a
              class="item"
              href="https://blog.golioth.io/all-golioth-hardware-is-now-open-source/"
              >All Golioth Hardware Is Now Open Source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 17:31:46</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40988229"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40986250">
          <h3>
            <a
              class="item"
              href="https://hh409.user.srcf.net/blog/lens-distortion-correction-lines.html"
              >Wide angle lens distortion correction from lines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 14:20:51</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40986250"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
