<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43953722">
          <h3>
            <a class="item" href="https://github.com/glassflow/clickhouse-etl"
              >Show HN: GlassFlow – OSS streaming dedup and joins from Kafka to
              ClickHouse</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 13:33:54</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43953722"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/glassflow/clickhouse-etl"
                >https://github.com/glassflow/clickhouse-etl</a
              >
              <p>
                Why we built this: Dedup with batch data is straightforward. You
                load the data into a temporary table. Then, find only the latest
                versions of the record through hashes or keys and keep them.
                After that, move the clean data into your main table. But have
                you tried this with streaming data? Users of our prev product
                were running real-time analytics pipelines from Kafka to
                ClickHouse and noticed that the analyses were wrong due to
                duplicates. The source systems produced duplicates as they
                ingested similar user data from CRMs, shop systems and click
                streams.
              </p>
              <p>
                We wanted to solve this issue for them with the existing
                ClickHouse options, but ClickHouse ReplacingMergeTree has an
                uncontrollable background merging process. This means the new
                data is in the system, but you never know when they’ll finish
                the merging, and until then, your queries return incorrect
                results.
              </p>
              <p>
                We looked into using FINAL but haven't been happy with the speed
                for real-time workloads.
              </p>
              <p>
                We tried Flink, but there is too much overhead to manage Java
                Flink jobs, and a self-built solution would have put us in a
                position to set up and maintain state storage, possibly a very
                large one (number of unique keys), to keep track of whether we
                have already encountered a record. And if your dedupe service
                fails, you need to rehydrate that state before processing new
                records. That would have been too much maintenance for us.
              </p>
              <p>
                We decided to solve it by building a new product and are excited
                to share it with you.
              </p>
              <p>
                The key difference is that the streams are deduplicated before
                ingesting to ClickHouse. So, ClickHouse always has clean data
                and less load, eliminating the risk of wrong results. We want
                more people to benefit from it and decided to open-source it
                (Apache-2.0).
              </p>
              <p>Main components:</p>
              <p>
                - Streaming deduplication: You define the deduplication key and
                a time window (up to 7 days), and it handles the checks in real
                time to avoid duplicates before hitting ClickHouse. The state
                store is built in.
              </p>
              <p>
                - Temporal Stream Joins: You can join two Kafka streams on the
                fly with a few config inputs. You set the join key, choose a
                time window (up to 7 days), and you're good.
              </p>
              <p>
                - Built-in Kafka source connector: There is no need to build
                custom consumers or manage polling logic. Just point it at your
                Kafka cluster, and it auto-subscribes to the topics you define.
                Payloads are parsed as JSON by default, so you get structured
                data immediately. As underlying tech, we decided on NATS to make
                it lightweight and low-latency.
              </p>
              <p>
                - ClickHouse sink: Data gets pushed into ClickHouse through a
                native connector optimized for performance. You can tweak batch
                sizes and flush intervals to match your throughput needs. It
                handles retries automatically, so you don't lose data on
                transient failures.
              </p>
              <p>
                We'd love to hear your feedback and know if you solved it nicely
                with existing tools. Thanks for reading!
              </p>
            </div>
          </section>
        </section>
        <section id="43953229">
          <h3>
            <a
              class="item"
              href="https://www.harudagondi.space/blog/rust-documentation-ecosystem-review/"
              >A Rust Documentation Ecosystem Review</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 12:08:24</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43953229"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43953200">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/roame/jobs/S7ytgrb-founding-full-stack-engineer"
              >Roame (YC S23) Is Hiring Lead Fullstack Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 12:01:16</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43952746">
          <h3>
            <a class="item" href="http://bitshifters.cc/2025/05/04/zig.html"
              >Zig, the Ideal C Replacement Or?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 10:15:08</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43952746"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43952714">
          <h3>
            <a class="item" href="https://epochalypse-project.org/"
              >The Epochalypse Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 10:08:53</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43952714"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43951985">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2505.03335"
              >Absolute Zero: Reinforced Self-Play Reasoning with Zero Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 07:07:26</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43951985"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43951737">
          <h3>
            <a
              class="item"
              href="https://www.strangeloopcanon.com/p/on-thinkers-and-doers"
              >On thinkers and doers (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 05:58:01</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43951737"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43951588">
          <h3>
            <a class="item" href="https://mrbruh.com/asusdriverhub/"
              >One-Click RCE in Asus's Preinstalled Driver Software</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 05:11:18</span
              ><span class="points-container"
                >Points: <span class="points">338</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43951588"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43951368">
          <h3>
            <a class="item" href="https://flak.tedunangst.com/post/fan-service"
              >Fan Service</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 04:26:33</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43951368"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43950976">
          <h3>
            <a class="item" href="https://www.airs.com/blog/archives/670"
              >Leaving Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 03:01:56</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43950976"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43950709">
          <h3>
            <a
              class="item"
              href="https://mezzantrop.wordpress.com/2025/02/04/netbsd-10-x-kernel-math_emulation/"
              >NetBSD 10.x Kernel Math_emulation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 02:13:49</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43950709"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43950525">
          <h3>
            <a class="item" href="https://lab.avl.la/dotless/"
              >Dotless Domains</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 01:38:00</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43950525"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43950046">
          <h3>
            <a
              class="item"
              href="https://about.fandom.com/news/fandom-sells-giant-bomb-to-independent-creators"
              >Giant Bomb is now owned by the people who make Giant Bomb</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 00:00:14</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43950046"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43949855">
          <h3>
            <a class="item" href="https://retool.com/visual-basic"
              >The History and Legacy of Visual Basic</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 23:24:18</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43949855"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43949542">
          <h3>
            <a
              class="item"
              href="https://skincontact.substack.com/p/21-observations-from-people-watching"
              >Observations from people-watching</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 22:32:01</span
              ><span class="points-container"
                >Points: <span class="points">319</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43949542"
                  >Comments</a
                ><span class="descendants">: 172</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43949238">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/sierpinski-triangle-in-my-bitwise"
              >Sierpiński Triangle? In My Bitwise and?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 21:42:55</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43949238"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43949056">
          <h3>
            <a
              class="item"
              href="https://www.vintagecomputing.com/index.php/archives/2833/why-the-apple-ii-didnt-support-lowercase-letters"
              >Why the Apple II Didn't Support Lowercase Letters (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 21:15:04</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43949056"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43948945">
          <h3>
            <a class="item" href="https://github.com/blackrabbit17/xenolab"
              >Show HN: Xenolab – Rasp Pi monitor for my pet carnivourus
              plants</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 20:58:27</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43948945"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43947630">
          <h3>
            <a
              class="item"
              href="https://s3data.computerhistory.org/brochures/commodore.commodore64.1982.102646264.pdf"
              >For $595, you get what nobody else can give you for twice the
              price (1982) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 18:05:09</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43947630"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43946824">
          <h3>
            <a
              class="item"
              href="http://www.righto.com/2025/05/386-prefetch-circuitry-reverse-engineered.html"
              >Reverse engineering the 386 processor's prefetch queue
              circuitry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 16:23:06</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43946824"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43945993">
          <h3>
            <a
              class="item"
              href="https://raz.sh/blog/2025-05-02_a_critical_look_at_mcp"
              >A critical look at MCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 14:37:59</span
              ><span class="points-container"
                >Points: <span class="points">514</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43945993"
                  >Comments</a
                ><span class="descendants">: 278</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43945820">
          <h3>
            <a
              class="item"
              href="https://storage.courtlistener.com/recap/gov.uscourts.dcd.223205/gov.uscourts.dcd.223205.1300.1.pdf"
              >US vs. Google amicus curiae brief of Y Combinator in support of
              plaintiffs [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 14:15:56</span
              ><span class="points-container"
                >Points: <span class="points">381</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43945820"
                  >Comments</a
                ><span class="descendants">: 794</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43930725">
          <h3>
            <a
              class="item"
              href="https://www.doc.cc/articles/a-brief-history-of-the-numeric-keypad"
              >A brief history of the numeric keypad</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 20:04:48</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43930725"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43926713">
          <h3>
            <a class="item" href="http://rochus-keller.ch/?p=1350"
              >When Suno covers my song (very useful) – a study with
              variations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 14:58:41</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43926713"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43924082">
          <h3>
            <a
              class="item"
              href="https://blog.appsignal.com/2025/05/07/an-introduction-to-solid-queue-for-ruby-on-rails.html"
              >An Introduction to Solid Queue for Ruby on Rails</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 07:58:33</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43924082"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43918478">
          <h3>
            <a
              class="item"
              href="https://medicalxpress.com/news/2025-04-wearable-heart-technology.html"
              >Engineers develop wearable heart attack detection technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-07 @ 17:32:14</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43918478"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43915470">
          <h3>
            <a class="item" href="https://github.com/vapetrov/PCB_strain_gauge"
              >Strain gauge made out of PCB</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-07 @ 13:32:24</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43915470"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43914321">
          <h3>
            <a
              class="item"
              href="https://www.humanqr.com/news/qr-code-not-scanning-well-try-to-help/"
              >Crowd Sourcing Broken QR Codes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-07 @ 11:24:33</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43914321"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43913414">
          <h3>
            <a
              class="item"
              href="https://forum.lazarus.freepascal.org/index.php?topic=71050.0"
              >Lazarus Release 4.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-07 @ 08:36:57</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43913414"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43909986">
          <h3>
            <a
              class="item"
              href="https://maxrozen.com/on-four-years-running-saas-competitive-market"
              >Four years of running a SaaS in a competitive market</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-06 @ 21:47:18</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43909986"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
