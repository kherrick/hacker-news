<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37545412">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37545412"
              >Brazil will hit 49c in September this year</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 14:29:55</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37545412"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                In recent days, climate models have consistently indicated a
                potential temperature record in much of central and southern
                South America. In reality, as the date approaches, the models
                are indicating even more intense heat.
              </p>
              <p>
                For the 26th, the models are predicting up to 49°C in Mato
                Grosso do Sul and Mato Grosso. But the heat record will affect a
                large part of Brazil, not just the Midwest. Records are also
                expected to be set in Paraguay, northern Argentina, and Bolivia.
              </p>
              <p>
                The models indicate a temperature anomaly of more than 20°C,
                that is, 20°C above the normal for this time of the year.
              </p>
              <p>
                In Curitiba, the forecast is up to 39°C (the record in the city
                is 35°C).
              </p>
              <p>In São Paulo, the forecast is 41°C (the record is 37°C).</p>
              <p>In Cuiabá, the forecast is 48°C (the record is 43°C).</p>
              <p>In Londrina, the forecast is 44°C (the record is 41°C).</p>
              <p>In Campinas, the forecast is 42°C...</p>
              <p>
                You can see the model here: GFS Model – 2m Temperature
                \(shaded\) for South America | Tropical Tidbits
                https://www.tropicaltidbits.com/analysis/models/?model=gfs®ion=samer&amp;pkg=T2m&amp;runtime=2023091618&amp;fh=0
              </p>
              <p>
                A heat dome occurs in areas of high pressure that act like heat
                domes, having descending air (subsidence). This compresses the
                air on the ground and through compression heats the column of
                air. In short, a heat dome is created when an area of high
                pressure remains over the same area for days or even weeks,
                trapping very hot air below just like a lid on a pot.
              </p>
              <p>
                It is, therefore, a physical process in the atmosphere. The
                masses of hot air expand vertically in the atmosphere, creating
                a high-pressure dome that diverts meteorological systems - like
                cold fronts - around it. As the high-pressure system settles in
                a certain region, the air below heats the atmosphere and
                dissipates cloud cover. The high angle of the summer sun
                combined with the clear or few clouds sky heats the ground even
                more.
              </p>
              <p>
                Evidence from studies suggests that climate change is increasing
                the frequency of intense heat domes, pumping them higher into
                the atmosphere, not unlike adding more hot air to an already
                heated air balloon. Therefore, several studies point to an
                increase in the intensity, duration, and frequency of heatwaves
                in Brazil and around the world.
              </p>
              <p>
                Never in the history of over a century of global climate
                observation have so many all-time heat records fallen by such a
                large margin as in the historic heatwave of late June 2021 in
                the western North America, an effect of a massive heat dome. It
                was the second most deadly climate disaster of the year with
                1,037 deaths: 808 in western Canada and 229 in the northwestern
                US.
              </p>
              <p>
                "This was the most anomalous regional extreme heat event to
                occur anywhere on Earth since the beginning of temperature
                records. Nothing compares," said climate historian Christopher
                Burt, author of the book Extreme Weather. Pointing to Lytton,
                Canada, he added, "There has never been a national heat record
                in a country with an extensive period of record and a multitude
                of observation locations that was surpassed by 4°C," he said.
                International meteorological record researcher Maximiliano
                Herrera agreed. "What we saw is totally unprecedented
                worldwide," he said. "It is an endless cascade of records being
                broken," he summarized.
              </p>
              <p>
                A rapid response study from the World Weather Attribution
                program found that the high daily temperatures observed in a
                study area covering much of western Oregon, Washington, and
                British Columbia in June 2021 would have been "virtually
                impossible without human-caused climate change." The study
                estimated that it was approximately a 1 in 1000 year event in
                today's climate, but in a world with 2°C of global warming,
                which is projected for two decades from now, a similar event
                could occur approximately every five to ten years.
              </p>
            </div>
          </section>
        </section>
        <section id="37545384">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/more-writers-sue-openai-copyright-infringement-over-ai-training-2023-09-11/"
              >More writers sue OpenAI for copyright infringement over AI
              training</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 14:26:57</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37545384"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37545328">
          <h3>
            <a
              class="item"
              href="https://www.gamedeveloper.com/blogs/unity-s-just-not-into-you-indie-developer"
              >Unity's Just Not into You, Indie Developer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 14:20:17</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37545328"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37545313">
          <h3>
            <a
              class="item"
              href="https://e360.yale.edu/digest/environmental-defenders-murdered-2022"
              >Close to 2k Environmental Activists Killed over Last Decade</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 14:17:52</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37545313"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37545071">
          <h3>
            <a class="item" href="https://groups.google.com/g/comp.lang.c"
              >Comp.lang.c is now full of spam from Google Groups</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 13:52:52</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37545071"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37545040">
          <h3>
            <a
              class="item"
              href="https://without.boats/blog/changing-the-rules-of-rust/"
              >Changing the Rules of Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 13:49:11</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37545040"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37544881">
          <h3>
            <a
              class="item"
              href="https://www.centredaily.com/news/local/education/penn-state/article278868069.html"
              >Whistleblower CISO says PennState lied about IT security to win
              $2B from US gov</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 13:31:38</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37544881"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37544628">
          <h3>
            <a class="item" href="https://linearbookscanner.org/"
              >Linear Book Scanner – The open-source automatic book scanner</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 13:03:12</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37544628"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37544097">
          <h3>
            <a
              class="item"
              href="https://www.qualcomm.com/news/onq/2023/09/what-is-risc-v-and-why-were-unlocking-its-potential"
              >Qualcomm: What is RISC-V, and why we're unlocking its
              potential</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 11:57:42</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37544097"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37544019">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/2023/sep/17/how-learning-thinking-in-a-foreign-language-improves-decision-making"
              >Thinking in a foreign language improves decision-making</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 11:48:36</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37544019"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37543904">
          <h3>
            <a
              class="item"
              href="https://www.spiegel.de/international/world/russia-s-scorched-earth-policy-in-ukraine-a-trip-to-the-dried-up-kakhovka-reservoir-a-992aef1d-f4a7-4fbf-84a2-74c5d93b6566"
              >A trip to the dried-up Kakhovka Reservoir</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 11:33:19</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37543904"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37543664">
          <h3>
            <a class="item" href="https://asahilina.net/agx-exploit/"
              >CVE-2022-32947: I hacked macOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 10:58:26</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37543664"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37542733">
          <h3>
            <a class="item" href="https://apod.nasa.gov/apod/ap230916.html"
              >Fireball over Iceland</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 08:19:58</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37542733"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37542117">
          <h3>
            <a
              class="item"
              href="https://www.ece.lsu.edu/lpeng/papers/tpds-20-1.pdf"
              >A High Throughput B+tree for SIMD Architectures (2020) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 06:30:37</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37542117"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37541994">
          <h3>
            <a
              class="item"
              href="https://ziglang.org/news/bounties-damage-open-source-projects/"
              >Bounties Damage Open Source Projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 06:06:34</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37541994"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37541721">
          <h3>
            <a
              class="item"
              href="https://gethealthspan.com/blog/articles/acarbose-longevity-benefits-gut-microbiota/n3jokanbseg1f1apq7wt3/"
              >Are the Longevity Benefits of Acarbose Rooted in Its Role on the
              Gut Microbiota?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 05:09:22</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37541721"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37541685">
          <h3>
            <a class="item" href="https://wordsandbuttons.online/SYTYKC.pdf"
              >So You Think You Know C? [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 05:03:16</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37541685"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37541531">
          <h3>
            <a
              class="item"
              href="http://www.tcherepnin.com/alex/basic_elem3.htm"
              >Tcherepnin: Basic Elements of My Musical Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 04:29:27</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37541531"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37541093">
          <h3>
            <a
              class="item"
              href="https://jackcook.com/2023/09/08/predictive-text.html"
              >A look at Apple’s new Transformer-powered predictive text
              model</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 03:00:23</span
              ><span class="points-container"
                >Points: <span class="points">372</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37541093"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37540856">
          <h3>
            <a
              class="item"
              href="http://oldvcr.blogspot.com/2023/09/the-fossil-wrist-pda-becomes-tiny.html"
              >The Fossil Wrist PDA becomes a tiny Gopher client</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 02:21:45</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37540856"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37540770">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/finance/investing/cereal-decline-breakfast-trend-6dd591e8"
              >Breakfast cereal is in long-term decline</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 02:05:19</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37540770"
                  >Comments</a
                ><span class="descendants">: 485</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37540529">
          <h3>
            <a
              class="item"
              href="https://www.nist.gov/blogs/taking-measure/pirates-caribbean-metric-edition"
              >Pirates of the Caribbean (Metric Edition) (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 01:19:46</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37540529"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37540445">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/gym-class-by-irl-studios/jobs/ADcM4ZV-backend-engineer"
              >Gym Class VR (YC W22) Is Hiring a Lead Back End Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 01:00:57</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37540109">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2308.03921"
              >Spellburst: LLM–Powered Interactive Canvas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 00:03:00</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37540109"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37538333">
          <h3>
            <a
              class="item"
              href="https://wscp.dev/posts/tech/java-pattern-matching/"
              >Java 21 makes me like Java again</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-16 @ 20:20:15</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37538333"
                  >Comments</a
                ><span class="descendants">: 581</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37535537">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02890-1"
              >Cystic fibrosis treatment wins Breakthrough Prize</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-16 @ 15:18:46</span
              ><span class="points-container"
                >Points: <span class="points">375</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37535537"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37532794">
          <h3>
            <a
              class="item"
              href="https://www.dota2.com/newsentry/3675555405719286536"
              >How Valve built soundproof booths</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-16 @ 07:40:27</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37532794"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37532736">
          <h3>
            <a class="item" href="https://howhttps.works">How HTTPS Works</a>
          </h3>
          <section>
            <h4>
              <span>2023-09-16 @ 07:28:48</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37532736"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37505646">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/The_Gods_of_the_Copybook_Headings"
              >The Gods of the Copybook Headings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-14 @ 06:27:29</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37505646"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37505539">
          <h3>
            <a
              class="item"
              href="https://miles.land/posts/stanford-is-a-platform/"
              >Stanford is a platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-14 @ 06:11:48</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37505539"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
