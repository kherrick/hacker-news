<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46839106">
          <h3>
            <a class="item" href="https://scottaaronson.blog/?p=9530"
              >Guest Post from an Iranian</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 18:16:43</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46839106"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46838981">
          <h3>
            <a class="item" href="https://genode.org/about/index"
              >Genode OS is a tool kit for building highly secure
              special-purpose OS</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 18:03:32</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46838981"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46838644">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2026-01-30/bitcoin-btc-slides-toward-longest-monthly-losing-streak-since-2018"
              >Bitcoin Looks Set for Longest Monthly Losing Streak Since 2018</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 17:26:18</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46838644"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46838597">
          <h3>
            <a class="item" href="https://an.dywa.ng/carrier-gnss.html"
              >Mobile carriers can get your GPS location</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 17:21:34</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46838597"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46838417">
          <h3>
            <a class="item" href="https://yle.fi/a/74-20207494"
              >Finland to end "uncontrolled human experiment" with ban on youth
              social media</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 17:06:22</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46838417"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46837814">
          <h3>
            <a
              class="item"
              href="https://help.apple.com/pdf/security/en_US/apple-platform-security-guide.pdf"
              >Apple Platform Security (Jan 2026) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 16:04:03</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46837814"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46835834">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/goldbridge/jobs/78gGEHh-forward-deployed-engineer"
              >Insane Growth Goldbridge (YC F25) Is Hiring a Forward Deployed
              Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 12:00:22</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46835612">
          <h3>
            <a class="item" href="https://nemin.hu/guix.html"
              >Guix System First Impressions as a Nix User</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 11:22:24</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46835612"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46835454">
          <h3>
            <a
              class="item"
              href="https://mail.openjdk.org/pipermail/hotspot-dev/2026-January/118080.html"
              >"Giving up upstream-ing my patches &amp;amp; feel free to pick
              them up"</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 10:53:38</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46835454"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46835336">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2026/01/30/euro_firms_must_ditch_us/"
              >Euro firms must ditch Uncle Sam's clouds and go EU-native</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 10:34:07</span
              ><span class="points-container"
                >Points: <span class="points">611</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46835336"
                  >Comments</a
                ><span class="descendants">: 556</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46834953">
          <h3>
            <a
              class="item"
              href="https://blog.globalping.io/we-have-ipinfo-at-home-or-how-to-geolocate-ips-in-your-cli-using-latency/"
              >We have ipinfo at home or how to geolocate IPs in your CLI using
              latency</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 09:30:05</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46834953"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46834313">
          <h3>
            <a
              class="item"
              href="https://archaeologyworlds.com/5500-year-old-sumerian-star-map-recorded/"
              >Sumerian Star Map Recorded the Impact of an Asteroid (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 07:32:51</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46834313"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46833754">
          <h3>
            <a class="item" href="https://phage-explorer.org/"
              >Show HN: Phage Explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 05:22:03</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46833754"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
            <div class="text">
              <p>
                This was largely inspired by the work of Sydney Brenner, which
                became the basis of my brennerbot.org project.
              </p>
              <p>
                In particular, I became very fascinated by phages, which are
                viruses that attack bacteria. They're the closest thing to the
                "fundamental particles" of biology: the minimal units of genetic
                code that do something useful that allows them to reproduce and
                spread.
              </p>
              <p>
                They also have some incredible properties, like having a
                structure that somehow encodes an icosahedron.
              </p>
              <p>
                I always wondered how the DNA of these things translated into
                geometry in the physical world. That mapping between the
                "digital" realm of ACGT, which in turn maps onto the 20 amino
                acids in groups of 3, and the world of 3D, analog shapes, still
                seems magical and mysterious to me.
              </p>
              <p>
                I wanted to dig deeper into the subject, but not by reading a
                boring textbook. I wanted to get a sense for these phages in a
                tangible way. What are the different major types of phages? How
                do they compare to each other in terms of the length and
                structure of their genetic code? The physical structure they
                assume?
              </p>
              <p>
                I decided to make a program to explore all this stuff in an
                interactive way.
              </p>
              <p>
                And so I'm very pleased to present you with my open-source Phage
                Explorer:
              </p>
              <p>phage-explorer.org</p>
              <p>
                I probably went a bit overboard, because what I ended up with
                has taken a sickening number of tokens to generate, and resulted
                in ~150k lines of Typescript and Rust/Wasm.
              </p>
              <p>
                It implements 23 analysis algorithms, over 40 visualizations,
                and has the complete genetic data and 3D structure of 24
                different classes of phage.
              </p>
              <p>
                It actually took a lot of engineering to make this work well in
                a browser; it's a surprising amount of data (this becomes
                obvious when you look at some of the 3D structure models).
              </p>
              <p>
                It works fairly well on mobile, but if you want to get the full
                experience, I highly recommend opening it on a desktop browser
                in high resolution.
              </p>
              <p>
                As far as I know, it's the most complete informational /
                educational software about phages available anywhere. Now, I am
                the first to admit that I'm NOT an expert, or even that
                knowledgeable, about, well, ANY of this stuff.
              </p>
              <p>
                So if you’re a biology expert, please take a look and let me
                know what you think of what I've made! And if I've gotten
                anything wrong, please let me know in the GitHub Issues and I'll
                fix it:
              </p>
              <p>
                <a href="https://github.com/Dicklesworthstone/phage_explorer"
                  >https://github.com/Dicklesworthstone/phage_explorer</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46832074">
          <h3>
            <a
              class="item"
              href="https://simedw.com/2026/01/31/ear-pronunication-via-ctc/"
              >Show HN: I trained a 9M speech model to fix my Mandarin tones</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 00:51:27</span
              ><span class="points-container"
                >Points: <span class="points">385</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46832074"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's a 9M Conformer-CTC model trained on ~300h (AISHELL +
                Primewords), quantized to INT8 (11 MB), runs 100% in-browser via
                ONNX Runtime Web.
              </p>
              <p>
                Grades per-syllable pronunciation + tones with Viterbi forced
                alignment.
              </p>
              <p>
                Try it here:
                <a href="https://simedw.com/projects/ear/"
                  >https://simedw.com/projects/ear/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46829582">
          <h3>
            <a class="item" href="https://peerweb.lol/"
              >Peerweb: Decentralized website hosting via WebTorrent</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-30 @ 20:40:00</span
              ><span class="points-container"
                >Points: <span class="points">333</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46829582"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/omodaka9375/peerweb"
                >https://github.com/omodaka9375/peerweb</a
              >
            </div>
          </section>
        </section>
        <section id="46829147">
          <h3>
            <a class="item" href="https://antirender.com/"
              >Antirender: remove the glossy shine on architectural
              renderings</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-30 @ 20:05:24</span
              ><span class="points-container"
                >Points: <span class="points">1725</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46829147"
                  >Comments</a
                ><span class="descendants">: 414</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46826597">
          <h3>
            <a
              class="item"
              href="https://github.com/MoonshotAI/Kimi-K2.5/blob/master/tech_report.pdf"
              >Kimi K2.5 Technical Report [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-30 @ 16:43:50</span
              ><span class="points-container"
                >Points: <span class="points">354</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46826597"
                  >Comments</a
                ><span class="descendants">: 135</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46824422">
          <h3><a class="item" href="https://http.cat/">HTTP Cats</a></h3>
          <section>
            <h4>
              <span>2026-01-30 @ 13:56:51</span
              ><span class="points-container"
                >Points: <span class="points">509</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46824422"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46820360">
          <h3><a class="item" href="https://www.moltbook.com/">Moltbook</a></h3>
          <section>
            <h4>
              <span>2026-01-30 @ 03:55:34</span
              ><span class="points-container"
                >Points: <span class="points">1625</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46820360"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <a href="https://twitter.com/karpathy/status/2017296988589723767"
                >https://twitter.com/karpathy/status/2017296988589723767</a
              >
              <p>
                also
                <i
                  >Moltbook is the most interesting place on the internet right
                  now</i
                >
                -
                <a href="https://news.ycombinator.com/item?id=46826963"
                  >https://news.ycombinator.com/item?id=46826963</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46809846">
          <h3>
            <a
              class="item"
              href="https://somehowmanage.com/2026/01/22/a-step-behind-the-bleeding-edge-monarchs-philosophy-on-ai-in-dev/"
              >A Step Behind the Bleeding Edge: A Philosophy on AI in Dev</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-29 @ 13:20:07</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46809846"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46802748">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/blog/topics/threat-intelligence/disrupting-largest-residential-proxy-network"
              >Disrupting the largest residential proxy network</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-28 @ 22:46:38</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46802748"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46799244">
          <h3>
            <a
              class="item"
              href="https://www.nbcnews.com/tech/internet/college-students-ai-cheating-detectors-humanizers-rcna253878"
              >Students using “humanizer” programs to beat accusations of
              cheating with AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-28 @ 18:09:07</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46799244"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46794971">
          <h3>
            <a
              class="item"
              href="https://jaisenmathai.com/articles/my-ridiculously-robust-photo-management-system-immich-edition/"
              >My Ridiculously Robust Photo Management System (Immich
              Edition)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-28 @ 13:17:56</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46794971"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46792242">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/space/2026/01/one-of-nasas-three-wb-57-aircraft-just-did-a-belly-landing-in-houston/"
              >NASA's WB-57 crash lands at Houston</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-28 @ 07:43:39</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46792242"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46780086">
          <h3>
            <a class="item" href="https://github.com/zpoint/CPython-Internals"
              >CPython Internals Explained</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 14:07:37</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46780086"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46775758">
          <h3>
            <a class="item" href="https://jvoight.github.io/quat.html"
              >Quaternion Algebras</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 05:06:06</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46775758"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46769399">
          <h3>
            <a class="item" href="https://blog.billyedmoore.com/heathrow"
              >Predicting how Heathrow is using it's runways in the browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-26 @ 18:18:07</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46769399"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46768260">
          <h3>
            <a class="item" href="https://blog.plover.com/2026/01/26/#wrterm"
              >An anecdote about backward compatibility</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-26 @ 17:07:37</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46768260"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46764979">
          <h3>
            <a
              class="item"
              href="https://arthur.pizza/2025/12/animated-avif-for-the-modern-web/"
              >Animated AVIF for the Modern Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-26 @ 12:45:50</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46764979"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46764472">
          <h3>
            <a
              class="item"
              href="https://commandcenter.blogspot.com/2026/01/implementing-transcendental-functions.html"
              >Implementing the Transcendental Functions in Ivy</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-26 @ 11:40:55</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46764472"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
