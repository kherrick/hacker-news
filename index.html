<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38941847">
          <h3>
            <a class="item" href="https://physiqonomics.com/biggest-losers/"
              >The Biggest Losers: Metabolic Damage or Constrained Energy?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-10 @ 18:58:04</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38941847"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38941582">
          <h3>
            <a class="item" href="https://www.hey.com/calendar/"
              >37Signals Launches Hey Calendar</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-10 @ 18:28:43</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38941582"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38940670">
          <h3>
            <a
              class="item"
              href="https://boards.greenhouse.io/snapdocs/jobs/5053815004"
              >Snapdocs (YC W14) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-10 @ 17:00:58</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38937801">
          <h3>
            <a
              class="item"
              href="https://biology.stackexchange.com/questions/30116/does-dna-have-the-equivalent-of-if-statements-while-loops-or-function-calls-h"
              >Does DNA have the equivalent of IF-statements, WHILE loops, or
              function calls?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-10 @ 08:40:51</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38937801"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38937129">
          <h3>
            <a class="item" href="https://shady-gang.github.io/vcc/"
              >Vcc â€“ The Vulkan Clang Compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-10 @ 07:05:51</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38937129"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38935605">
          <h3>
            <a
              class="item"
              href="https://www.afterbabel.com/p/international-mental-illness-part-one"
              >The teen mental illness epidemic is international (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-10 @ 02:59:58</span
              ><span class="points-container"
                >Points: <span class="points">435</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38935605"
                  >Comments</a
                ><span class="descendants">: 693</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38935205">
          <h3>
            <a
              class="item"
              href="https://ellie.wtf/posts/i-quit-my-job-to-work-full-time-on-my-open-source-project"
              >I quit my job to work full time on my open source project</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-10 @ 02:00:44</span
              ><span class="points-container"
                >Points: <span class="points">581</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38935205"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38934824">
          <h3>
            <a class="item" href="https://shonumi.github.io/articles/art33.html"
              >Glucoboy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-10 @ 01:10:20</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38934824"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38933999">
          <h3>
            <a class="item" href="https://mrbruh.com/chattr/"
              >I pwned half of America's fast food chains simultaneously</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 23:41:38</span
              ><span class="points-container"
                >Points: <span class="points">973</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38933999"
                  >Comments</a
                ><span class="descendants">: 407</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38933021">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-00012-z"
              >Ibogaine banishes PTSD, small study finds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 22:15:57</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38933021"
                  >Comments</a
                ><span class="descendants">: 223</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38932603">
          <h3>
            <a class="item" href="https://www.wikihouse.cc/"
              >Wikihouse: Open-Source Houses</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 21:48:05</span
              ><span class="points-container"
                >Points: <span class="points">456</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38932603"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38932398">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Linux-6.8-Networking"
              >Linux 6.8 Network Optimizations Can Boost TCP Performance by
              ~40%</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 21:32:18</span
              ><span class="points-container"
                >Points: <span class="points">236</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38932398"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38932350">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2401.04081"
              >MoE-Mamba: Efficient Selective State Space Models with Mixture of
              Experts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 21:28:11</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38932350"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38931282">
          <h3>
            <a
              class="item"
              href="https://news.ncsu.edu/2023/12/ancient-stars-made-extraordinarily-heavy-elements/"
              >Ancient Stars Made Extraordinarily Heavy Elements (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 20:06:30</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38931282"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38930928">
          <h3>
            <a
              class="item"
              href="https://www.indiehackers.com/post/aim-fire-scan-the-80-20-of-executing-on-big-projects-571580cd0a"
              >Aim, fire, scan: the 80/20 of executing on big projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 19:42:43</span
              ><span class="points-container"
                >Points: <span class="points">237</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38930928"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38930822">
          <h3>
            <a
              class="item"
              href="https://www.cell.com/cell/fulltext/S0092-8674(23)01344-2?_returnURL=https%3A%2F%2Flinkinghub.elsevier.com%2Fretrieve%2Fpii%2FS0092867423013442%3Fshowall%3Dtrue"
              >Human fetal brain self-organizes into long-term expanding
              organoids</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 19:36:31</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38930822"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38930126">
          <h3>
            <a class="item" href="https://www.rabbit.tech/"
              >Rabbit: LLM-First Mobile Phone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 18:44:17</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38930126"
                  >Comments</a
                ><span class="descendants">: 446</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38929917">
          <h3>
            <a class="item" href="https://deepflow.io/"
              >DeepFlow â€“ open-source eBPF Distributed Tracing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 18:31:01</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38929917"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38929474">
          <h3>
            <a
              class="item"
              href="https://blog.redplanetlabs.com/2024/01/09/everything-wrong-with-databases-and-why-their-complexity-is-now-unnecessary/"
              >Databases and why their complexity is now unnecessary</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 18:01:24</span
              ><span class="points-container"
                >Points: <span class="points">309</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38929474"
                  >Comments</a
                ><span class="descendants">: 292</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38928277">
          <h3>
            <a class="item" href="https://ben.page/eink"
              >Building an e-ink picture frame that displays an iCloud photo
              album</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 16:45:58</span
              ><span class="points-container"
                >Points: <span class="points">293</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38928277"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38928064">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38928064"
              >Launch HN: Corgea (YC S23) â€“ Auto fix vulnerable code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 16:32:21</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38928064"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
            <div class="text">
              <a href="https://corgea.com">https://corgea.com</a>). We help
              companies fix their vulnerable source code using AI.
              <p>
                Originally, we started with a data security product that would
                detect data leaks at companies. Despite initial successes and
                customer acquisitions, we frequently heard that highlighting
                issues wasn't enough; customers wanted proactive fixes. They had
                hundreds (yes hundreds!) of security tools alerting them about
                vulnerabilities, but couldnâ€™t afford a dedicated team to go
                through them all and fix them. One prospect we spoke to had tens
                of thousands of reported vulnerabilities in their SAST tool.
                With the rise of AI code generation, we saw an opportunity to
                give customers what they really wanted.
              </p>
              <p>
                Having Corgea is like having a security engineer on staff
                focused on making your code more secure. We want security to be
                an enabler of engineering rather than a blocker to it, and the
                reverse to be true. To accomplish this, we built it on top of
                existing LLMs to issue code fixes.
              </p>
              <p>
                To show Corgeaâ€™s capabilities, we took some popular
                vulnerable-by-design applications like Juice Shop (<a
                  href="https://github.com/juice-shop/juice-shop"
                  >https://github.com/juice-shop/juice-shop</a
                >), scanned them and issued fixes for their vulnerabilities. You
                can see some of them here:
                <a href="https://demo.corgea.com">https://demo.corgea.com</a>.
                Some examples of vulnerabilities it solves are like SQL
                injection, Path Traversal and XSS.
              </p>
              <p>
                What makes this tough is that currently LLMs struggle at
                generalist coding tasks because it has to understand your whole
                code base, the domain youâ€™re in, and the userâ€™s request to do
                something. This can lead to a lot of unintended behavior where
                it codes things incorrectly because itâ€™s giving a best guess at
                what you want. Adam, one of the founding engineers on the team
                coined it well: LLMs donâ€™t reason, they fuzz.
              </p>
              <p>
                We made several decisions that helped the LLM become more
                deterministic. First, what weâ€™re doing is extremely domain
                specific: vulnerable code fixes in a limited number of
                programming languages. There are roughly 900 security
                vulnerabilities in code, called CWEâ€™s (<a
                  href="https://cwe.mitre.org/"
                  >https://cwe.mitre.org/</a
                >), that weâ€™ve built into Corgea. An SQL injection vulnerability
                in a Javascript app is the same regardless if youâ€™re a payments
                company or a travel booking website. Second, we have no user
                generated input going into the LLM, because SAST scanners
                everything needed to issue a fix. This makes it much more
                predictable and reproducible for us and customers. We can also
                create robust QA processes and checks.
              </p>
              <p>
                To illustrate the point, letâ€™s put some of this to the test
                using some napkin math. Assume youâ€™re serving 5,000 enterprises
                that ship on average 300 domain specific features a year in 5
                different programming languages that each require 30 lines of
                code changes across multiple files. Youâ€™ll have about 300m
                permutations the product needs to support. What a nightmare!
              </p>
              <p>
                Using the same napkin math, Corgea needs to support the ~900
                vulnerabilities (CWEâ€™s). Most of them require 1 - 2 line
                changes. It doesnâ€™t need to understand the whole codebase since
                the problem is usually isolated to a few lines. We want to
                support the 5 most popular programming languages. If we have
                5,000 customers, we have to support ~4,500 permutations (900
                issues x 5 different languages). This leads to a massive
                difference in accuracy. Obviously, this is an oversimplification
                of the whole thing but it illustrates the point.
              </p>
              <p>
                What makes this different from Copilot and other code-gen tools
                is that they do not specialize in security and weâ€™ve seen them
                inadvertently introduce security issues unbeknownst to the
                engineer. Additionally, they do not integrate into existing
                scanning tools that companies are using to resolve those issues.
                So unless a developer is working on every part of the product,
                theyâ€™re unable to clear security backlogs, which can be in the
                thousands of tickets.
              </p>
              <p>
                As for security scanners, the current market is flooded with
                tools that report and overwhelm security teams and are not
                effective at fixing what theyâ€™re reporting. Most vulnerability
                scanners do not remediate issues, and if they do theyâ€™re mostly
                limited to upgrading packages from one version to another to
                reduce a CVSS. If they do offer CWE remediation capabilities
                their success rates are very low because theyâ€™re often based on
                traditional AI methodologies. Additionally, they do not
                integrate with each other because they want to only serve their
                own findings. Enterprises use multiple tools like Snyk, Semgrep,
                Checkmarx, but also have a penetration testing program, and a
                bug bounty program. They need a solution that consolidates
                across their existing tools. They also use Github, Gitlab and
                Bitbucket for their code repository.
              </p>
              <p>
                Weâ€™re offering a free tier for smaller teams and priced tiers.
                We believe we can reduce 80% of the engineering effort for
                security fixes, which would equate to at least $10m a year for
                enterprises.
              </p>
              <p>
                Weâ€™re really excited to share this with you all and weâ€™d love
                any thoughts, feedback, and comments!
              </p>
            </div>
          </section>
        </section>
        <section id="38925812">
          <h3>
            <a
              class="item"
              href="https://blog.jgc.org/2010/06/your-last-name-contains-invalid.html"
              >Your last name contains invalid characters (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 13:17:09</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38925812"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38925307">
          <h3>
            <a class="item" href="https://turingcomplete.game/"
              >Turing Complete is a game about computer science</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 12:22:42</span
              ><span class="points-container"
                >Points: <span class="points">362</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38925307"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38923627">
          <h3>
            <a
              class="item"
              href="https://www.fromjason.xyz/p/notebook/where-have-all-the-websites-gone/"
              >Where Have All the Websites Gone?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 08:13:13</span
              ><span class="points-container"
                >Points: <span class="points">490</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38923627"
                  >Comments</a
                ><span class="descendants">: 375</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38921441">
          <h3>
            <a
              class="item"
              href="https://physics.stackexchange.com/questions/101913/why-does-a-remote-car-key-work-when-held-to-your-head-body"
              >Why does holding a key fob to your head increase its range?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 02:23:15</span
              ><span class="points-container"
                >Points: <span class="points">568</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38921441"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38920043">
          <h3><a class="item" href="https://pola.rs/">Polars</a></h3>
          <section>
            <h4>
              <span>2024-01-08 @ 23:32:54</span
              ><span class="points-container"
                >Points: <span class="points">934</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38920043"
                  >Comments</a
                ><span class="descendants">: 375</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38916663">
          <h3>
            <a class="item" href="https://www.cs.umd.edu/~ben/goldenrules.html"
              >Golden Rules of Interface Design (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 19:15:07</span
              ><span class="points-container"
                >Points: <span class="points">313</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38916663"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38909377">
          <h3>
            <a
              class="item"
              href="https://www.jviotti.com/2024/01/05/is-objective-c-bool-a-boolean-type-it-depends.html"
              >Is Objective-C BOOL a boolean type? It depends</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 08:16:02</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38909377"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38909180">
          <h3>
            <a class="item" href="https://cheesemak.ing/how-much-milk/"
              >Show HN: Tool to calculate how much milk is needed to make an
              amount of cheese</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 07:40:29</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38909180"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38908956">
          <h3>
            <a
              class="item"
              href="https://belkadan.com/blog/2024/01/The-Biggest-Smallest-PNG/"
              >The Biggest Smallest PNG</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 06:43:26</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38908956"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
