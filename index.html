<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43631925">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43631925"
              >Ask HN: Are you interested in a text only browser that runs
              JavaScript?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 13:37:29</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43631925"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                Curious as to response. Probably a few weeks off release yet but
                here’s a brief screencap: https://youtu.be/_Bs7BoQBoBA (Or if
                you prefer an asciinema:
                https://asciinema.org/a/9w6CMnaI9VxiykI1PgVWm4lsi )
              </p>
              <p>Thoughts?</p>
              <p>
                The context is it’s meant for constrained environments (ultra
                thin client, engine runs remotely or on same machine if you
                like; security constraints? Bandwidth constraints? Resource
                constraints? Content constraints?).
              </p>
              <p>
                Personally, this is a project close to my heart because my first
                interactions with computers, and even the Internet was textbased
                back in the days of dialup and BBS systems. But for another
                reason in the modern era, I often have the feeling I just wanna
                get away from all the bullshit all the colors and images begging
                for my attention. I just want a quiet web that works. But I
                don’t like an extension knowing everything, and content scripts
                are fragile. For me, the medium of the terminal is actually a
                different message and distinct experience that I find valuable.
                And I think the Internet wants to see itself that way too.
              </p>
              <p>
                So I’m building this whatever the response here. I also think
                maybe I can make a trendy thing as OCR is still a major problem
                and if AI’s can have a text based way to drive web content,
                maybe they’d like that. Not my main bag though, but I need to
                consider cash.
              </p>
              <p>
                I have some other fun ideas for this too, that’s a real nod to
                the past; a more civilized age.
              </p>
            </div>
          </section>
        </section>
        <section id="43631854">
          <h3>
            <a
              class="item"
              href="https://www.euronews.com/my-europe/2025/04/09/eu-member-states-agree-first-wave-of-retaliatory-tariffs"
              >EU member states agree first wave of retaliatory tariffs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 13:30:30</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43631854"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43631672">
          <h3>
            <a
              class="item"
              href="https://whynothugo.nl/journal/2025/04/09/man-pages-are-great-man-readers-are-the-problem/"
              >Man pages are great, man readers are the problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 13:11:50</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43631672"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43631656">
          <h3>
            <a class="item" href="https://jcarlosroldan.com/post/355"
              >Quality-of-Life in Tetris Games</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 13:10:44</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43631656"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43631402">
          <h3>
            <a
              class="item"
              href="https://cleantechnica.com/2025/04/07/tesla-solar-sales-declined-for-4-straight-quarters-then-tesla-stopped-publishing-the-numbers/"
              >Tesla Solar Sales Declined for 4 Qtrs. Then Tesla Stopped
              Publishing the Numbers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 12:41:40</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43631402"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43631384">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2025/04/08/fake-job-seekers-use-ai-to-interview-for-remote-jobs-tech-ceos-say.html"
              >Fake job seekers are flooding US companies that are hiring for
              remote positions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 12:39:16</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43631384"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43631381">
          <h3>
            <a
              class="item"
              href="https://developers.googleblog.com/en/a2a-a-new-era-of-agent-interoperability/"
              >The Agent2Agent Protocol (A2A)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 12:38:20</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43631381"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43631298">
          <h3>
            <a
              class="item"
              href="https://www.securityweek.com/treasurys-occ-says-hackers-had-access-to-150000-emails/"
              >Treasury's OCC Says Hackers Had Access to 150k Emails</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 12:28:01</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43631298"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43631274">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/google-cloud/ironwood-tpu-age-of-inference/"
              >Ironwood: The first Google TPU for the age of inference</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 12:24:19</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43631274"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43631230">
          <h3>
            <a class="item" href="https://docs.getwhisky.app/maintenance-notice"
              >Whisky is no longer actively maintained</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 12:17:03</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43631230"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43631147">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/markets/commodities/commodities-oil-suffers-biggest-5-day-drop-since-2022-metals-plunge-trade-war-2025-04-09/"
              >Oil hits 4-year low, coffee falls as trade war escalates</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 12:01:24</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43631147"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43630957">
          <h3>
            <a class="item" href="https://css-naked-day.org/">CSS Naked Day</a>
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 11:26:02</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43630957"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43630733">
          <h3>
            <a class="item" href="https://buzzed.chat"
              >Show HN: I built a Yahoo Messenger-inspired web chat app – pure
              nostalgia</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 10:47:20</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43630733"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                Room owners can customize things like backgrounds and even
                cursors of their room. Users can format their messages with
                basic markdown like bold, italics, and color texts (kind of like
                the old Yahoo! days).
              </p>
              <p>
                I even brought back the classic Yahoo! Messenger emoticons
                because… well, why not?
              </p>
              <p>
                You can try it out here:
                <a href="https://buzzed.chat">https://buzzed.chat</a> (Heads up:
                it's still pretty barebones, so excuse any bugs you might run
                into!)
              </p>
              <p>I'm thinking of adding a few more features next, like:</p>
              <p>• Audibles</p>
              <p>• A buddy list so you can add friends</p>
              <p>• Private chats between buddies</p>
              <p>
                Before I keep building, I wanted to check in and see what people
                think. Anyone else remember using Yahoo! Messenger back in the
                day? Any features you’d love to see again?
              </p>
              <p>Would genuinely love to hear your thoughts and ideas</p>
            </div>
          </section>
        </section>
        <section id="43630661">
          <h3>
            <a
              class="item"
              href="https://speedbumpapp.com/en/blog/how-to-reduce-screen-time/"
              >The guide to reduce screen time</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 10:34:42</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43630661"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43630388">
          <h3>
            <a
              class="item"
              href="https://attackanddefense.dev/2025/04/09/hardening-the-firefox-frontend-with-content-security-policies.html"
              >Hardening the Firefox Front End with Content Security Policies</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 09:34:16</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43630388"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43629887">
          <h3>
            <a
              class="item"
              href="https://www.centauri-dreams.org/2025/04/08/on-sun-like-stars/"
              >'Sun-Like' Stars</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 08:01:38</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43629887"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43629307">
          <h3>
            <a class="item" href="https://endler.dev/2025/best-programmers/"
              >The best programmers I know</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 06:02:01</span
              ><span class="points-container"
                >Points: <span class="points">277</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43629307"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43628500">
          <h3>
            <a class="item" href="https://github.com/DistroHopper39B/NTATV"
              >NTATV: Bringing Windows NT (Windows XP, Windows 2003) to the
              Original Apple TV</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 03:00:01</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43628500"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43628037">
          <h3>
            <a class="item" href="https://github.com/reteps/dockerfmt"
              >Dockerfmt: A Dockerfile Formatter</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 01:21:22</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43628037"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43627864">
          <h3>
            <a
              class="item"
              href="https://tomscii.sig7.se/2025/04/The-Barium-Experiment"
              >The Barium Experiment</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 00:44:22</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43627864"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43627758">
          <h3>
            <a class="item" href="https://www.drawdb.app/"
              >Show HN: DrawDB – open-source online database diagram editor (a
              retro)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 00:20:18</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43627758"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
            <div class="text">
              <p>
                In a year we somehow managed to hit 26k stars, grow a 1000+
                person discord community, and support 37 languages. I couldn't
                be more grateful for the community that helped this grow, but
                now i don't know what direction to take this project in.
              </p>
              <p>
                All of this was an accident. But now I feel like I'm missing out
                on not using this success. I have been thinking of monetization
                options, but not sure if I wanna go down that route. I like the
                idea of it being free and available for everyone but also can't
                help but think of everything that could be done if committed
                full-time or even had a small team. I keep telling myself(and
                others) i'll do something if i meet a co-founder, but doubt and
                fear of blowing this up keeps back.
              </p>
              <p>How would you proceed?</p>
            </div>
          </section>
        </section>
        <section id="43627646">
          <h3>
            <a
              class="item"
              href="https://blog.vectorchord.ai/postgresql-full-text-search-fast-when-done-right-debunking-the-slow-myth"
              >PostgreSQL Full-Text Search: Fast When Done Right (Debunking the
              Slow Myth)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-09 @ 00:00:15</span
              ><span class="points-container"
                >Points: <span class="points">326</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43627646"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43625474">
          <h3>
            <a
              class="item"
              href="https://yuxi-liu-wired.github.io/essays/posts/cyc/"
              >Obituary for Cyc</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-08 @ 19:13:50</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43625474"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43624220">
          <h3>
            <a class="item" href="https://echarts.apache.org/en/index.html"
              >Apache ECharts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-08 @ 17:23:29</span
              ><span class="points-container"
                >Points: <span class="points">1450</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43624220"
                  >Comments</a
                ><span class="descendants">: 216</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43620279">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/the-americas/2025/04/03/brazils-government-run-payments-system-has-become-dominant"
              >Brazil's government-run payments system has become dominant</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-08 @ 10:59:26</span
              ><span class="points-container"
                >Points: <span class="points">621</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43620279"
                  >Comments</a
                ><span class="descendants">: 686</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43620141">
          <h3>
            <a class="item" href="https://tailscale.com/blog/series-c"
              >Tailscale has raised $160M</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-08 @ 10:36:07</span
              ><span class="points-container"
                >Points: <span class="points">602</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43620141"
                  >Comments</a
                ><span class="descendants">: 300</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43602652">
          <h3>
            <a class="item" href="https://avisoft.com/recorder-tests/"
              >Microphone Input Noise Comparison – Avisoft Bioacoustics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 16:23:53</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43602652"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43597264">
          <h3>
            <a
              class="item"
              href="https://github.com/a13xp0p0v/linux-kernel-defence-map"
              >Linux Kernel Defence Map – Security Hardening Concepts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 22:16:54</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43597264"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43595193">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2025/making-graphs-more-accessible-blind-low-vision-readers-0325"
              >A new way to make graphs more accessible to blind and low-vision
              readers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 17:47:10</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43595193"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43594090">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/science.ads1325"
              >Nonlinear soundsheet microscopy:imaging opaque organs
              capillary/cellular scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 15:13:00</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43594090"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
