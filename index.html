<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39629225">
          <h3>
            <a
              class="item"
              href="https://worldbuildingpasta.blogspot.com/2024/03/hurried-thoughts-youre-wrong-about.html"
              >Hurried Thoughts: You're Wrong About Tidal-Locking</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 14:08:26</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39629225"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39629207">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2024/03/06/1236033493/nasas-voyager-1-spacecraft-is-talking-nonsense-its-friends-on-earth-are-worried"
              >Voyager 1 spacecraft is talking nonsense. Its friends on Earth
              are worried</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 14:06:59</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39629207"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39629044">
          <h3>
            <a class="item" href="https://eloquentjavascript.net/"
              >Eloquent JavaScript 4th edition (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 13:52:16</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39629044"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39629015">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/science/elements/the-magic-of-bird-brains"
              >The Magic of Bird Brains</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 13:50:07</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39629015"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39628842">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/china-google-justice-department-63156ade1e564d15d92adbef91e9c5da"
              >Ex-Google engineer charged with stealing AI trade secrets</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 13:33:46</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39628842"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39628696">
          <h3>
            <a
              class="item"
              href="https://ludic.mataroa.blog/blog/the-brotherhood-of-morons/"
              >The Brotherhood of Morons</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 13:19:00</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39628696"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39628689">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Fedora-41-No-GNOME-Xorg-Install"
              >Fedora Workstation 41 to No Longer Install Gnome X.org Session by
              Default</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 13:18:29</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39628689"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39628285">
          <h3>
            <a class="item" href="https://github.com/flydelabs/flyde"
              >Show HN: Flyde – an open-source visual programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 12:33:36</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39628285"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.flyde.dev">https://www.flyde.dev</a>.
              <p>
                In my last role as an engineering manager for a B2B-oriented
                product, I authored and reviewed many diagrams for backend
                applications, mostly for integrations between 2 third-party
                services. Some of these diagrams were elaborate enough that I
                started dreaming of a way to simply run a diagram as is; I
                imagined a “run” button on the top-right corner of the screen
                that would execute the diagram without the need to translate it
                into code.
              </p>
              <p>
                That led me down a rabbit hole of exploration and
                experimentation, from tools like Zapier, Pipedream and Make,
                which are great for automating “backoffice” stuff, and up to
                NodeRED, NoFlo.js and the great work of J. Paul Morisson on
                Flow-Based Programming. I failed to find a tool that would
                answer my needs - a tool that balances a new level of
                abstraction, manages to stay powerful and flexible, and most
                importantly, integrates with the existing ecosystem, and doesn’t
                replace it. I built Flyde as an attempt to answer that need.
              </p>
              <p>
                Flyde is designed to complement and enhance traditional textual
                coding, not to replace it. It includes a VSCode extension, it
                seamlessly integrates with existing TypeScript/JavaScript code
                and can run on Node.js and in the browser.
              </p>
              <p>
                I believe that as we delegate more coding tasks to AI, we’ll
                assume the role of an architect rather than a programmer. This
                shift will require tools that focus more on orchestration and
                high-level troubleshooting and less on low-level functionality.
              </p>
              <p>
                I’d love to hear your thoughts and feedback on Flyde’s
                direction!
              </p>
            </div>
          </section>
        </section>
        <section id="39628199">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2024/03/on-dma-eve-google-whines-apple-sounds-alarms-and-tiktok-wants-out/"
              >On DMA eve, Google whines, Apple sounds alarms, and TikTok wants
              out</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 12:24:10</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39628199"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39628064">
          <h3>
            <a
              class="item"
              href="https://ncatlab.org/ufias2012/files/turner.pdf"
              >Total Functional Programming (2004) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 12:07:20</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39628064"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39628015">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/03/05/inside-snapdragon-8-gen-1s-igpu-adreno-gets-big/"
              >Snapdragon 8 Gen 1's iGPU: Adreno Gets Big</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 12:00:10</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39628015"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39628014">
          <h3>
            <a class="item" href="https://up.codes/careers?utm_source=HN"
              >UpCodes (YC S17) Is Hiring SWEs Across the Americas</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 12:00:04</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39627624">
          <h3>
            <a
              class="item"
              href="https://www.iccl.ie/digital-data/european-court-of-justice-finds-iab-europe-responsible-for-tcf-consent-spam-popups-across-the-internet/"
              >ECJ finds IAB Europe responsible for TCF consent spam popups
              across the Internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 11:16:15</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39627624"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39627443">
          <h3>
            <a
              class="item"
              href="https://blog.datadesk.eco/p/sky-lapse-in-two-tone"
              >Sky lapse in two tone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 10:48:39</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39627443"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39627410">
          <h3>
            <a class="item" href="https://github.com/explodingcamera/tinywasm"
              >Show HN: TinyWasm – A tiny WebAssembly Runtime written in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 10:44:35</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39627410"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                Hi HN! I'm excited to share TinyWasm (<a
                  href="https://github.com/explodingcamera/tinywasm"
                  >https://github.com/explodingcamera/tinywasm</a
                >), a WebAssembly Interpreter I developed for my final
                university project.
              </p>
              <p>
                The main goal of this project was to deepen my understanding of
                WebAssembly and interpreter design. TinyWasm successfully passes
                all the official WebAssembly 1.0 tests and also includes
                features from future proposals such as like bulk memory
                operations.
              </p>
              <p>
                Initially more of a research project, TinyWasm focuses on
                simplicity and portability. It has minimal third-party
                dependencies, a small codebase, and is compatible with no_std
                environments. It's now available as a standalone library (<a
                  href="https://crates.io/crates/tinywasm"
                  >https://crates.io/crates/tinywasm</a
                >), and I hope it can be useful for embedding into other
                projects and hacking on, especially because it's designed to be
                easy to understand and modify, while still being decently
                performant.
              </p>
              <p>I'm looking forward to feedback, hope you find it useful!</p>
            </div>
          </section>
        </section>
        <section id="39625919">
          <h3>
            <a
              class="item"
              href="https://www.nikon.com/company/news/2024/0307_01.html"
              >Nikon to acquire RED</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 07:01:42</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39625919"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39625917">
          <h3>
            <a
              class="item"
              href="https://blog.gtk.org/2024/03/07/on-fractional-scales-fonts-and-hinting/"
              >Fractional scales, fonts and hinting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 07:01:37</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39625917"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39625662">
          <h3>
            <a class="item" href="https://briancallahan.net/blog/20240306.html"
              >FreeBSD has a(nother) new C compiler: Intel oneAPI DPC++/C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 06:28:11</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39625662"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39625594">
          <h3>
            <a
              class="item"
              href="https://www.wolframphysics.org/bulletins/2020/08/a-short-note-on-the-double-slit-experiment-and-other-quantum-interference-effects-in-the-wolfram-model/"
              >On the Double-Slit Experiment and Quantum Interference in the
              Wolfram Model (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 06:14:34</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39625594"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39623128">
          <h3>
            <a
              class="item"
              href="https://github.com/dekuNukem/bob_cassette_rewinder"
              >Bob_cassette_rewinder</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 23:28:01</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39623128"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39620060">
          <h3>
            <a
              class="item"
              href="https://github.com/classvsoftware/under-new-management"
              >Detect when your installed Chrome extensions have changed
              owners</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 19:21:31</span
              ><span class="points-container"
                >Points: <span class="points">660</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39620060"
                  >Comments</a
                ><span class="descendants">: 246</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39618822">
          <h3>
            <a
              class="item"
              href="https://www.fda.gov/news-events/press-announcements/fda-clears-first-over-counter-continuous-glucose-monitor"
              >FDA clears first over-the-counter continuous glucose monitor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 18:03:43</span
              ><span class="points-container"
                >Points: <span class="points">717</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39618822"
                  >Comments</a
                ><span class="descendants">: 378</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39615715">
          <h3>
            <a class="item" href="https://benkettle.xyz/posts/message-book/"
              >Autogenerating a Book Series from Three Years of iMessages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 13:27:37</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39615715"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39614404">
          <h3>
            <a class="item" href="https://jkorpela.fi/forms/accesskey.html"
              >Using accesskey attribute in HTML forms and links (1998)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 10:26:29</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39614404"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39614156">
          <h3>
            <a
              class="item"
              href="https://gorisanson.github.io/pikachu-volleyball/en/"
              >Pikachu Volleyball</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 09:49:02</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39614156"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39613699">
          <h3>
            <a
              class="item"
              href="https://archive.org/details/dr_dobbs_journal_vol_01/page/n316/mode/1up"
              >Dr. Dobb's Journal – Vol 1 (1976)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 08:38:45</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39613699"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39610509">
          <h3>
            <a
              class="item"
              href="https://doctorow.medium.com/a-bug-in-early-creative-commons-licenses-has-enabled-a-new-breed-of-superpredator-5f6360713299"
              >A Bug in Early Creative Commons Licenses Has Enabled Copyleft
              Trolls (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 23:40:13</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39610509"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39606873">
          <h3>
            <a
              class="item"
              href="https://inkandswitch.notion.site/Academish-Voice-0d8126b3be5545d2a21705ceedb5dd45"
              >Academish Voice (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 17:52:11</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39606873"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39600968">
          <h3>
            <a
              class="item"
              href="https://blog.sqlitecloud.io/interactive-sqlite-documentation-experiment-with-queries-in-real-time"
              >Interactive SQLite Documentation: Experiment with Queries in
              Real-Time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 08:58:12</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39600968"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39598211">
          <h3>
            <a
              class="item"
              href="https://nolanlawson.com/2023/01/17/my-talk-on-css-runtime-performance/"
              >My talk on CSS runtime performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 01:06:39</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39598211"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
