<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44014587">
          <h3>
            <a
              class="item"
              href="https://30fps.net/pages/palette-lighting-tricks-n64/"
              >Palette lighting tricks on the Nintendo 64</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 14:28:59</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44014587"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44014343">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2505.05587"
              >Steepest Descent Density Control for Compact 3D Gaussian
              Splatting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 13:52:51</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44014343"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44014106">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2025-05-16/fda-approves-first-blood-test-to-diagnose-alzheimer-s-disease"
              >FDA Clears First Blood Test to Diagnose Alzheimer's</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 13:17:31</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44014106"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44013933">
          <h3>
            <a
              class="item"
              href="https://english.elpais.com/climate/2025-05-17/miyawaki-in-nezahualcoyotl-the-japanese-method-of-creating-forests-comes-to-mexico.html"
              >The Japanese method of creating forests comes to Mexico</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 12:51:26</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44013933"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44013913">
          <h3>
            <a
              class="item"
              href="https://engineering.fb.com/2025/05/15/developer-tools/introducing-pyrefly-a-new-type-checker-and-ide-experience-for-python/"
              >Pyrefly: A new type checker and IDE experience for Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 12:47:40</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44013913"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44013671">
          <h3>
            <a class="item" href="https://miasap.se/obnc/"
              >OBNC â€“ Oberon-07 Compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 12:00:53</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44013671"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44013181">
          <h3>
            <a class="item" href="https://topp.openproblem.net/"
              >Open Problems in Computational geometry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 09:37:46</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44013181"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44013157">
          <h3>
            <a
              class="item"
              href="https://matklad.github.io/2023/11/15/push-ifs-up-and-fors-down.html"
              >Push Ifs Up and Fors Down</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 09:31:55</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44013157"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44012729">
          <h3>
            <a class="item" href="https://seiya.me/blog/riscv-hypervisor"
              >Implementing a RISC-V Hypervisor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 07:46:29</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44012729"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44012615">
          <h3>
            <a class="item" href="https://github.com/prathyvsh/os-catalog"
              >Catalog of Novel Operating Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 07:19:55</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44012615"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44012227">
          <h3>
            <a
              class="item"
              href="https://v8.dev/features/explicit-resource-management"
              >JavaScript's New Superpower: Explicit Resource Management</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 05:23:20</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44012227"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44011515">
          <h3>
            <a class="item" href="https://github.com/xtool-org/xtool"
              >XTool â€“ Cross-platform Xcode replacement</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 02:10:36</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44011515"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44011489">
          <h3>
            <a class="item" href="https://phl.upr.edu/wow/outreach"
              >Wow@Home â€“ Network of Amateur Radio Telescopes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 02:02:14</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44011489"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44011381">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/1017720/7155ecb9602e9ef2/"
              >A kernel developer plays with Home Assistant</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 01:36:23</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44011381"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44011254">
          <h3>
            <a class="item" href="https://github.com/merliot/hub"
              >Show HN: Merliot â€“ plugging physical devices into LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 01:09:38</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44011254"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                What does that mean? It means you can control and interact with
                your physical devices, your security cameras, your thermometer,
                seamlessly using natural language from an LLM host such as
                Claude Desktop or Cursor. The hub is a gateway between AI and
                the physical world.
              </p>
              <p>What could go wrong?</p>
            </div>
          </section>
        </section>
        <section id="44009848">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/blog/products/databases/techniques-for-improving-text-to-sql"
              >Getting AI to write good SQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-16 @ 21:10:12</span
              ><span class="points-container"
                >Points: <span class="points">425</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44009848"
                  >Comments</a
                ><span class="descendants">: 266</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44009464">
          <h3>
            <a
              class="item"
              href="https://clojurescript.org/news/2025-05-16-release"
              >ClojureScript 1.12.42</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-16 @ 20:20:20</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44009464"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44008843">
          <h3>
            <a class="item" href="https://dcurt.is/thinking"
              >Thoughts on thinking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-16 @ 19:09:55</span
              ><span class="points-container"
                >Points: <span class="points">556</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44008843"
                  >Comments</a
                ><span class="descendants">: 358</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44006426">
          <h3>
            <a
              class="item"
              href="https://economics.mit.edu/news/assuring-accurate-research-record"
              >MIT asks arXiv to withdraw preprint of paper on AI and scientific
              discovery</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-16 @ 15:09:25</span
              ><span class="points-container"
                >Points: <span class="points">347</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44006426"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44006381">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44006381"
              >I'm Peter Roberts, immigration attorney, who does work for YC and
              startups. AMA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-16 @ 15:05:32</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44006381"
                  >Comments</a
                ><span class="descendants">: 426</span></span
              >
            </h4>
            <div class="text">
              <p>
                Edit: I am taking a break now and will return later this
                afternoon/evening to respond to any comments and answer any
                questions. Thank you everyone for a great and engaged AMA so
                far.
              </p>
            </div>
          </section>
        </section>
        <section id="44006345">
          <h3>
            <a class="item" href="https://openai.com/index/introducing-codex/"
              >A Research Preview of Codex</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-16 @ 15:02:02</span
              ><span class="points-container"
                >Points: <span class="points">465</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44006345"
                  >Comments</a
                ><span class="descendants">: 397</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43997135">
          <h3>
            <a class="item" href="https://popcorn.swmansion.com/"
              >Popcorn: Run Elixir in WASM</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-15 @ 17:14:28</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43997135"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43993711">
          <h3>
            <a class="item" href="https://aruarian.dance/blog/japan-ic-cards/"
              >Japan's IC cards are weird and wonderful</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-15 @ 10:59:09</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43993711"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43992242">
          <h3>
            <a
              class="item"
              href="http://muratbuffalo.blogspot.com/2025/05/chapter-2-serializability-theory.html"
              >Chapter 2: Serializability Theory (1987 Concurrency Control
              Book)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-15 @ 05:58:38</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43992242"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43988070">
          <h3>
            <a
              class="item"
              href="https://advanced.onlinelibrary.wiley.com/doi/10.1002/advs.202412167"
              >Laser-Induced Graphene from Commercial Inks and Dyes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-14 @ 19:00:50</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43988070"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43981971">
          <h3>
            <a class="item" href="https://github.com/Nicoshev/rapidhash"
              >New high-quality hash measures 71GB/s on M4</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-14 @ 07:45:00</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43981971"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43981198">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/articles/cx2enydkew3o"
              >How can traditional British TV survive the US streaming giants</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-14 @ 05:44:32</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43981198"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43977890">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/why-moderna-merged-its-tech-and-hr-departments-95318c2a"
              >Why Moderna Merged Its Tech and HR Departments</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 21:24:36</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43977890"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43972669">
          <h3>
            <a
              class="item"
              href="https://www.memorysafety.org/blog/rustls-server-perf/"
              >Rustls Server-Side Performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 13:22:36</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43972669"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43972334">
          <h3>
            <a class="item" href="https://www.speakeasy.com/mcp/mcp-tutorial"
              >MCP: An in-depth introduction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 12:47:04</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43972334"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
