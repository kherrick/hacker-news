<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37678318">
          <h3>
            <a class="item" href="https://www.meta.com/quest/quest-3/"
              >Meta Quest 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 17:45:55</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37678318"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37678046">
          <h3>
            <a
              class="item"
              href="https://elinux.org/images/0/06/Lca13-gregkh-I-dont-want-your-code.pdf"
              >Linux kernel maintainers, why are they so grumpy? (2013) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 17:28:29</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37678046"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37677810">
          <h3>
            <a
              class="item"
              href="https://searchengineland.com/more-popular-websites-blocking-gptbot-432531"
              >26% of the top websites are now blocking GPTBot</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 17:12:13</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37677810"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37677358">
          <h3>
            <a
              class="item"
              href="https://nrk.neocities.org/articles/c-static-analyzers"
              >A gentle introduction to static analyzers for C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 16:42:38</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37677358"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37677341">
          <h3>
            <a
              class="item"
              href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-932%3A+Queues+for+Kafka"
              >Queues for Kafka</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 16:41:14</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37677341"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37677296">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/nitazenes-synthetic-opioids-more-deadly-than-fentanyl-are-starting-to-turn-up-in-overdose-cases-212589"
              >Synthetic opioids deadlier than fentanyl are showing up in
              overdose cases</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 16:38:03</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37677296"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37676880">
          <h3>
            <a
              class="item"
              href="https://archive.org/details/TheAshleyBookOfKnots"
              >The Ashley Book of Knots</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 16:13:37</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37676880"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37676393">
          <h3>
            <a
              class="item"
              href="https://headlineshq.substack.com/p/issue-no-029-live-near-your-friends"
              >Live near your friends</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 15:45:58</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37676393"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37675988">
          <h3>
            <a
              class="item"
              href="https://www.shuttle.rs/blog/2023/09/27/rust-vs-go-comparison"
              >Rust vs Go: A Hands-On Comparison</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 15:22:29</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37675988"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37675894">
          <h3>
            <a
              class="item"
              href="https://github.com/highlight/highlight/tree/main/backend/embeddings"
              >Show HN: Using LLMs and Embeddings to classify application
              errors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 15:17:35</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37675894"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                Given that there’s a lot of founders/engineers using LLMs in
                their products, we figured we’d share how we built the new
                functionality, their impact on our workflows, and how you can
                try it out.
              </p>
              <p>
                Our goal was to build two features: (1) tagging errors (e.g.
                deeming an error as “authentication error” or a “database
                error”); and (2) grouping similar errors together (e.g. two
                errors that have a different stacktrace and body, but are
                semantically not very different).
              </p>
              <p>
                Each of these rely heavily on comparing text across our
                application. After some experimentation with the OpenAI
                embeddings API [3], we went ahead and hosted a private model
                instance of thenlper/gte-large (an open-source MIT licensed
                model), which is a 1024-dimension model running on an Intel Ice
                Lake 2 vCPU machine on Hugging face [4].
              </p>
              <p>
                Our general approach for classifying/comparing text is as
                follows. As each set of tokens (i.e a string) comes in, our
                backend makes a request to an inference endpoint and receives a
                1024-dimension float vector as a response (see the code here
                [5]). We then store that vector using pgvector [6]. To compare
                any two sets for similarity, we simply look at the Euclidian
                distance between their respective embeddings using the ivfflat
                index implemented by pgvector (example code here [7]).
              </p>
              <p>
                To tag errors, we assign an error its most relevant tag from a
                predetermined set decided by us. For example, if we tag an error
                as an "authentication error" or a "database error", we can allow
                developers to have a starting point before inspecting an
                issue.(see the logic here [8]).
              </p>
              <p>
                Anecdotally, this approach seems to work very well. For example,
                here are two authentication errors that got tagged as
                “Authentication Error”:
              </p>
              <p></p>
              <pre><code>    * Firebase: A network AuthError has occurred
    * Error retrieving user from firebase api for email verification: cannot find user from uid.
</code></pre>
              We also use these error embeddings to group similar errors. To
              decide whether an error joins a group or starts a new one, we
              decide on a distance threshold (using the euclidean distance)
              ahead of time. An interesting thing about this approach, compared
              to using a text-based heuristic, is that two errors with different
              stack traces can still be grouped together. Here’s an example:
              <p></p>
              <pre><code>    * github.com/highlight-run/highlight/backend/worker.(*Worker).ReportStripeUsage
    * github.com/highlight-run/highlight/backend/private-graph/graph.(*Resolver).GetSlackChannelsFromSlack.func1
</code></pre>
              Both reported as `integration api error` as they involve the
              Stripe and Slack integrations respectively. The neat thing is that
              the LLM can use the full context of an error and match based on
              the most relevant details about the error.
              <p>
                We have rolled out a first version of the error grouping logic
                to our cloud product [9], and there’s a demo of all the
                functionality at [2]. Long-term, if the HN community has other
                ideas of what we could build with LLM tooling in observability,
                we’re all ears. Let us know what you think!
              </p>
              <p>Links</p>
              <p>
                [1]
                <a href="https://news.ycombinator.com/item?id=36774611"
                  >https://news.ycombinator.com/item?id=36774611</a
                >
              </p>
              <p>
                [2]
                <a href="https://app.highlight.io/error-tags"
                  >https://app.highlight.io/error-tags</a
                >
              </p>
              <p>
                [3]
                <a href="https://platform.openai.com/docs/guides/embeddings"
                  >https://platform.openai.com/docs/guides/embeddings</a
                >
              </p>
              <p>
                [4]
                <a href="https://huggingface.co/thenlper/gte-large"
                  >https://huggingface.co/thenlper/gte-large</a
                >
              </p>
              <p>
                [5]
                <a
                  href="https://github.com/highlight/highlight/blob/main/backend/embeddings/embeddings.go#L139-L189"
                  >https://github.com/highlight/highlight/blob/main/backend/emb...</a
                >
              </p>
              <p>
                [6]
                <a
                  href="https://github.com/highlight/highlight/blob/main/backend/model/model.go#L957C1-L963"
                  >https://github.com/highlight/highlight/blob/main/backend/mod...</a
                >
              </p>
              <p>
                [7]
                <a
                  href="https://github.com/highlight/highlight/blob/main/backend/public-graph/graph/resolver.go#L479-L487"
                  >https://github.com/highlight/highlight/blob/main/backend/pub...</a
                >
              </p>
              <p>
                [8]
                <a
                  href="https://github.com/highlight/highlight/blob/main/backend/private-graph/graph/resolver.go#L3768-L3774"
                  >https://github.com/highlight/highlight/blob/main/backend/pri...</a
                >
              </p>
              <p>
                [9]
                <a href="https://app.highlight.io">https://app.highlight.io</a>
              </p>
            </div>
          </section>
        </section>
        <section id="37675864">
          <h3>
            <a
              class="item"
              href="https://forgottenfiles.substack.com/p/accidents-happen-c1890s"
              >Accidents Happen: Sketches of misfortune in an insurance trade
              card c. 1890s</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 15:16:22</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37675864"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37675831">
          <h3>
            <a
              class="item"
              href="https://www.eurekalert.org/news-releases/1002811"
              >Desalination system could produce freshwater that is cheaper than
              tap water</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 15:14:03</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37675831"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37675496">
          <h3>
            <a
              class="item"
              href="https://mistral.ai/news/announcing-mistral-7b/"
              >Mistral 7B</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 14:52:46</span
              ><span class="points-container"
                >Points: <span class="points">402</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37675496"
                  >Comments</a
                ><span class="descendants">: 272</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37675400">
          <h3>
            <a
              class="item"
              href="https://rachelbythebay.com/w/2019/07/15/giant/"
              >Your nines are not my nines (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 14:45:23</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37675400"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674967">
          <h3>
            <a
              class="item"
              href="https://clickhouse.com/blog/clickhouse-keeper-a-zookeeper-alternative-written-in-cpp"
              >ClickHouse Keeper: A ZooKeeper alternative written in C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 14:14:30</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674967"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674752">
          <h3>
            <a class="item" href="https://deno.com/blog/queues">Deno Queues</a>
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 13:58:58</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674752"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674519">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/09/27/servo_returns/"
              >Rusty revenant Servo returns to render once more</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 13:40:25</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674519"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674139">
          <h3>
            <a
              class="item"
              href="https://programming.guide/worlds-most-copied-so-snippet.html"
              >The most copied StackOverflow snippet of all time is flawed
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 13:10:03</span
              ><span class="points-container"
                >Points: <span class="points">296</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674139"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674097">
          <h3>
            <a class="item" href="https://blog.cloudflare.com/workers-ai/"
              >Workers AI: serverless GPU-powered inference on Cloudflare’s
              global network</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 13:06:47</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674097"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37673539">
          <h3>
            <a
              class="item"
              href="https://nltimes.nl/2023/09/27/philips-allegedly-hid-3700-complaints-sleep-apnea-machines-us-authority"
              >Philips allegedly hid 3700 complaints about sleep apnea machines
              from U.S.</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 12:14:45</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37673539"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37672692">
          <h3>
            <a
              class="item"
              href="https://blog.appsignal.com/2023/09/27/an-introduction-to-litestack-for-ruby-on-rails.html"
              >An Introduction to LiteStack for Ruby on Rails</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 10:21:57</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37672692"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37671419">
          <h3>
            <a class="item" href="https://nakst.gitlab.io/essence"
              >Essence: A desktop OS built from scratch, for control and
              simplicity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 07:44:37</span
              ><span class="points-container"
                >Points: <span class="points">308</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37671419"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37670938">
          <h3>
            <a
              class="item"
              href="https://www.timdbg.com/posts/writing-a-debugger-from-scratch-part-5/"
              >Writing a debugger from scratch: Breakpoints</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 06:31:25</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37670938"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37670740">
          <h3>
            <a class="item" href="https://nullprogram.com/blog/2023/09/27/"
              >Arena allocator tips and tricks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 05:59:55</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37670740"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37669387">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/arts-culture/books/optimal-illusions-review-efficient-to-a-fault-1fe78078"
              >‘Optimal Illusions’ Review: Efficient to a Fault</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 03:00:30</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37669387"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37667981">
          <h3>
            <a class="item" href="https://www.ifte.de/books/eda/index.html"
              >VLSI Physical Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 00:29:13</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37667981"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37664082">
          <h3>
            <a
              class="item"
              href="https://thonyc.wordpress.com/2023/09/21/incorrect-casual-assumptions/"
              >Incorrect casual assumptions in the history of science</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 18:53:49</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37664082"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37658208">
          <h3>
            <a
              class="item"
              href="https://jackevansevo.github.io/my-unhealthy-relationship-with-keyboards.html"
              >My Unhealthy Relationship with Keyboards</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 12:22:21</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37658208"
                  >Comments</a
                ><span class="descendants">: 259</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37650402">
          <h3>
            <a
              class="item"
              href="https://www.cambridgeblog.org/2023/05/a-journey-into-the-shaken-baby-syndrome-abusive-head-trauma-controversy/"
              >A journey into the shaken baby syndrome/abusive head trauma
              controversy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 20:49:09</span
              ><span class="points-container"
                >Points: <span class="points">787</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37650402"
                  >Comments</a
                ><span class="descendants">: 462</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37639945">
          <h3>
            <a class="item" href="http://www.erikyyy.de/tempest/"
              >Tempest: Transmit Radio Waves via a PC Video Card with No Extra
              Hardware</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 05:29:34</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37639945"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
