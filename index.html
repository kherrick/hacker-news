<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36274525">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2023/06/barracuda-urges-replacing-not-patching-its-email-security-gateways/"
              >Barracuda Urges Replacing – Not Patching – Its Email Security
              Gateways</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 20:06:32</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36274525"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36273890">
          <h3>
            <a class="item" href="https://github.com/ajayyy/DeArrow"
              >DeArrow: Crowdsourcing better titles and thumbnails on YouTube</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 19:08:15</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36273890"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36273544">
          <h3>
            <a
              class="item"
              href="https://github.com/Voultapher/sort-research-rs/blob/main/writeup/intel_avx512/text.md"
              >A performance analysis of Intel x86-SIMD-sort (AVX-512)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 18:42:00</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36273544"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36273075">
          <h3>
            <a
              class="item"
              href="https://github.com/obsproject/obs-studio/commit/851a8c216e14617fb523951839f3bdb240e85141"
              >OBS merges WebRTC support</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 18:07:23</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36273075"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36272935">
          <h3>
            <a
              class="item"
              href="https://viksit.com/blog/case-for-decentralization-online-forums"
              >The case for the decentralization of online forums</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 17:57:28</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36272935"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36272747">
          <h3>
            <a
              class="item"
              href="https://twitter.com/JustJake/status/1667478906591666176"
              >GCP automatically lowered our quota, caused an incident, and
              refused to upgrade</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 17:42:28</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36272747"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36272409">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/06/10/us/ted-kaczynski-dead.html"
              >Ted Kaczynski has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 17:12:05</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36272409"
                  >Comments</a
                ><span class="descendants">: 262</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36271926">
          <h3>
            <a class="item" href="https://ai.honu.io/papers/musicgen/"
              >MusicGen: Simple and controllable music generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 16:29:03</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36271926"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36271910">
          <h3>
            <a
              class="item"
              href="https://exponentially.substack.com/p/what-should-you-build"
              >What Should You Build?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 16:27:00</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36271910"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36271804">
          <h3>
            <a
              class="item"
              href="https://wccftech.com/apple-m2-ultra-soc-isnt-faster-than-amd-intel-last-year-desktop-cpus-50-slower-than-nvidia-rtx-4080/"
              >Apple M2 Ultra SoC isn’t faster than AMD and Intel last year
              desktop CPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 16:16:37</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36271804"
                  >Comments</a
                ><span class="descendants">: 206</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36271583">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-01546-4"
              >Why Nature will not allow the use of generative AI in images and
              video</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 15:51:50</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36271583"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36271112">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2208.07339"
              >LLM.int8(): 8-Bit Matrix Multiplication for Transformers at Scale
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 15:03:01</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36271112"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36270884">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/green-hydrogen-offshore-wind"
              >Wind-to-hydrogen production reaches deep water</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 14:41:30</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36270884"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36270851">
          <h3>
            <a
              class="item"
              href="https://bitfieldconsulting.com/golang/examples"
              >Executable Examples in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 14:37:44</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36270851"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36270597">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2023/06/10/business/congestion-pricing-new-york-city-transportation/index.html"
              >New York City will charge drivers going downtown</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 14:09:17</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36270597"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36270565">
          <h3>
            <a
              class="item"
              href="https://ecl.common-lisp.dev/static/files/papers/ecl-1995-attardi.pdf"
              >The Embeddable Common Lisp (2005) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 14:06:38</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36270565"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36270554">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/06/09/fbi_fisa_section_702_absolutely/"
              >FBI: FISA Section 702 'absolutely critical' to spy on, err,
              protect Americans</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 14:05:46</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36270554"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36270413">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/06/09/mercedes_california_tesla/"
              >Mercedes beats Tesla to autonomous driving in California</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 13:45:45</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36270413"
                  >Comments</a
                ><span class="descendants">: 213</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36270303">
          <h3>
            <a
              class="item"
              href="https://aisnakeoil.substack.com/p/licensing-is-neither-feasible-nor"
              >Licensing is neither feasible nor effective for addressing AI
              risks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 13:30:12</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36270303"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36270150">
          <h3>
            <a class="item" href="https://github.com/mnurzia/rv"
              >Show HN: RISC-V core written in 600 lines of C89</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 13:08:09</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36270150"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36268931">
          <h3>
            <a
              class="item"
              href="https://thedailywtf.com/articles/A_Case_of_the_MUMPS"
              >A Case of the MUMPS (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 09:11:56</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36268931"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36268247">
          <h3>
            <a
              class="item"
              href="https://matklad.github.io/2023/05/06/zig-language-server-and-cancellation.html"
              >Zig language server and cancellation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-10 @ 06:40:10</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36268247"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36265777">
          <h3>
            <a
              class="item"
              href="https://www.return.life/p/how-folklore-goes-digital"
              >How Folklore Goes Digital</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 23:32:24</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36265777"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36264744">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/history-of-computer-graphics-industry"
              >The computer graphics industry got started at the university of
              Utah</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 21:57:03</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36264744"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36260961">
          <h3>
            <a class="item" href="https://github.com/BloopAI/bloop"
              >Show HN: Bloop – Answer questions about your code with an LLM
              agent</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 17:19:12</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36260961"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <a href="https://news.ycombinator.com/item?id=35236275"
                >https://news.ycombinator.com/item?id=35236275</a
              >) and received a huge amount of feedback (both positive +
              constructive). We've undertaken a rewrite of the core search
              framework, which now acts as an LLM agent, significantly improving
              the number of queries that can be successfully answered.
              <p>
                There's a bunch of hype surrounding LLM agents, but we're
                positive this is one of the first implementations of an agent
                that can deliver immediate value for engineers working on
                existing projects, especially larger ones. We'll do a full write
                up of how the agent works and the tools it can use soon, but we
                wanted to share our progress, now that we've got a stable
                release.
              </p>
              <p>
                bloop is a developer assistant that uses GPT-4 to answer
                questions about your codebase. The agent searches both your
                local and remote repositories with natural language, regex and
                filtered queries.
              </p>
              <p>
                Some of the ways engineers use bloop to improve their efficiency
                when working on large codebases:
              </p>
              <p>
                - Summarise how large files work and how multiple files work
                together
              </p>
              <p>
                - Understand how to use open source libraries when documentation
                is lacking
              </p>
              <p>- Identify the origin of errors</p>
              <p>
                - Ask questions about English-language codebases in other
                languages
              </p>
              <p>
                - Reduce code duplication by checking for existing functionality
              </p>
              <p>
                - Write new code, taking into account existing codebase context
                (eg: "write a dockerfile for this project")
              </p>
              <p>
                bloop runs as a free desktop app on Mac, Windows and Linux:
                <a href="https://github.com/bloopAI/bloop/releases/latest"
                  >https://github.com/bloopAI/bloop/releases/latest</a
                >. On desktop, your code is indexed with a MiniLM embedding
                model and stored locally, meaning at index time your codebase
                stays private. 'Private' here means that no code is shared with
                us or OpenAI at index time, and when a search is made only
                relevant code snippets are shared to generate the response.
                (This is more or less the same data usage as Copilot).
              </p>
              <p>
                We also have a paid cloud offering for teams ($45 per user per
                month). Members of the same organisation can search a shared
                index hosted by us and will get access to enterprise only
                features down the line (currently there's no feature gap between
                desktop and cloud).
              </p>
            </div>
          </section>
        </section>
        <section id="36256325">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2023/06/do-open-source-licences-cover-the-ship-of-theseus/"
              >Do open source licences cover the Ship of Theseus?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 11:38:15</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36256325"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36255989">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/all-about-skimmers/"
              >All About Skimmers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 10:55:53</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36255989"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36254887">
          <h3>
            <a class="item" href="https://www.nber.org/papers/w31308"
              >Top Talent, Elite Colleges, and Migration: The IITs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 08:21:18</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36254887"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36254776">
          <h3>
            <a
              class="item"
              href="https://www.studiobinder.com/blog/what-is-technicolor-definition/"
              >What is Technicolor? (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 08:06:22</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36254776"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36253882">
          <h3>
            <a class="item" href="https://www.oliverburkeman.com/onething"
              >List one task, do it, cross it out</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 06:02:24</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36253882"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
