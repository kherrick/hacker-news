<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37245300">
          <h3>
            <a
              class="item"
              href="https://www.aljazeera.com/news/2023/8/24/japan-prepares-to-start-release-of-fukushima-radioactive-water"
              >Japan starts release of Fukushima’s treated radioactive water</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 05:18:47</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37245300"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37244503">
          <h3>
            <a
              class="item"
              href="https://medium.com/@ludirehak/printing-lol-doubled-the-speed-of-my-go-code-e32e02fc3f92"
              >Print(“lol”) doubled the speed of my Go function</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 02:53:12</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37244503"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37244012">
          <h3>
            <a class="item" href="https://bun.sh/blog/bun-v0.8.0">Bun v0.8</a>
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 01:21:02</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37244012"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37243751">
          <h3>
            <a
              class="item"
              href="https://nolanlawson.com/2023/08/23/use-web-components-for-what-theyre-good-at/"
              >Use web components for what they’re good at</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 00:37:58</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37243751"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37241625">
          <h3>
            <a class="item" href="https://github.com/norvig/pytudes">Pytudes</a>
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 20:41:01</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37241625"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37241601">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/uk/2012/aug/21/life-on-board-nuclear-submarine"
              >Life on board a British nuclear submarine (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 20:35:33</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37241601"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37241487">
          <h3>
            <a
              class="item"
              href="https://nvidianews.nvidia.com/news/nvidia-announces-financial-results-for-second-quarter-fiscal-2024"
              >Nvidia Announces Financial Results for Second Quarter Fiscal
              2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 20:24:40</span
              ><span class="points-container"
                >Points: <span class="points">260</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37241487"
                  >Comments</a
                ><span class="descendants">: 303</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37240681">
          <h3>
            <a
              class="item"
              href="https://www.laphamsquarterly.org/roundtable/early-history-counting"
              >The Early History of Counting</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 19:02:55</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37240681"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37240363">
          <h3>
            <a class="item" href="https://github.com/Dataherald/dataherald"
              >Show HN: Dataherald AI – Natural Language to SQL Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 18:38:56</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37240363"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/Dataherald/dataherald"
                >https://github.com/Dataherald/dataherald</a
              >). This engine allows you to set up an API from your structured
              database that can answer questions in plain English.
              <p>
                GPT-4 class LLMs have gotten remarkably good at writing SQL.
                However, out-of-the-box LLMs and existing frameworks would not
                work with our own structured data at a necessary quality level.
                For example, given the question “what was the average rent in
                Los Angeles in May 2023?” a reasonable human would either assume
                the question is about Los Angeles, CA or would confirm the state
                with the question asker in a follow up. However, an LLM
                translates this to:
              </p>
              <p>
                select price from rent_prices where city=”Los Angeles” AND
                month=”05” AND year=”2023”
              </p>
              <p>
                This pulls data for Los Angeles, CA and Los Angeles, TX without
                getting columns to differentiate between the two. You can read
                more about the challenges of enterprise-level text-to-SQL in
                this blog post I wrote on the topic:
                <a
                  href="https://medium.com/dataherald/why-enterprise-natural-language-to-sql-is-hard-8849414f41c"
                  >https://medium.com/dataherald/why-enterprise-natural-languag...</a
                >
              </p>
              <p>
                Dataherald comes with “batteries-included.” It has best-in-class
                implementations of core components, including, but not limited
                to: a state of the art NL-to-SQL agent, an LLM-based
                SQL-accuracy evaluator. The architecture is modular, allowing
                these components to be easily replaced. It’s easy to set up and
                use with major data warehouses.
              </p>
              <p>
                There is a “Context Store” where information (NL2SQL examples,
                schemas and table descriptions) is used for the LLM prompts to
                make the engine get better with usage. And we even made it fast!
              </p>
              <p>
                This version allows you to easily connect to PG, Databricks,
                BigQuery or Snowflake and set up an API for semantic
                interactions with your structured data. You can then add
                business and data context that are used for few-shot prompting
                by the engine.
              </p>
              <p>
                The NL-to-SQL agent in this open source release was developed by
                our own Mohammadreza Pourreza, whose DIN-SQL algorithm is
                currently top of the Spider (<a
                  href="https://yale-lily.github.io/spider"
                  >https://yale-lily.github.io/spider</a
                >) and Bird (<a href="https://bird-bench.github.io/"
                  >https://bird-bench.github.io/</a
                >) NL 2 SQL benchmarks. This agent has outperformed the
                Langchain SQLAgent anywhere from 12%-250%.5x (depending on the
                provided context) in our own internal benchmarking while being
                only ~15s slower on average.
              </p>
              <p>
                Needless to say, this is an early release and the codebase is
                under swift development. We would love for you to try it out and
                give us your feedback! And if you are interested in
                contributing, we’d love to hear from you!
              </p>
            </div>
          </section>
        </section>
        <section id="37239979">
          <h3>
            <a
              class="item"
              href="https://opencoreventures.com/blog/2023-08-23-hashicorp-switching-bsl-shows-need-for-open-charter-companies/"
              >HashiCorp switching to BSL shows a need for open charter
              companies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 18:12:25</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37239979"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37239747">
          <h3>
            <a
              class="item"
              href="https://interviewing.io/blog/sabotage-salary-negotiation-before-even-start"
              >Common mistakes in salary negotiation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 17:56:15</span
              ><span class="points-container"
                >Points: <span class="points">420</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37239747"
                  >Comments</a
                ><span class="descendants">: 329</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37238976">
          <h3>
            <a class="item" href="https://www.aptible.com/culture-hub/careers"
              >Aptible (YC S14) Is Hiring: Security Compliance Manager,
              Product-Led Sales Lead</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 17:02:18</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37238648">
          <h3>
            <a class="item" href="https://gentrace.ai"
              >Show HN: Gentrace – evaluation and observability for generative
              AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 16:38:13</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37238648"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                Gentrace is our new evaluation and observability tool for
                generative AI (open beta).
              </p>
              <p>
                Generative pipelines are hard to evaluate because outputs are
                subjective. Lots of developers end up just doing “gut checks” on
                a few inputs before shipping changes, or they build up a
                spreadsheet of test cases that they manually run through the
                pipeline. Some companies outsource filling out the spreadsheet.
                However, in any of these cases, you end up with a very slow and
                expensive process for evaluation.
              </p>
              <p>
                At one point, we did this too. Gentrace is the result of a
                pivot; it was an internal tool we used to automatically grade
                new PRs as developers shipped changes to generative pipelines
                that other people thought might be useful.
              </p>
              <p>
                Gentrace makes pre-production testing of generative pipelines
                continuous and nearly instantaneous. In Gentrace, you:
              </p>
              <p>
                - Import and/or construct suites of test data - Use a
                combination of AI and heuristic evaluators to grade for quality,
                hallucination, safety, etc - Use our interface to correct
                automated grades or add your own (yourself or a member of your
                team)
              </p>
              <p>
                Gentrace integrates at a code level for evaluation, meaning we
                test your generative AI pipeline the way you would test normal
                code. This allows you to test more than just prompt changes; for
                example, you can compare models (eg Claude 2 vs GPT-4 vs GPT 3.5
                vs Llama 2) or see the effects of additional chained steps
                (”Rewrite the previous answer in the following tone:”).
              </p>
              <p>
                Here’s a video overview that goes into a bit more detail:
                <a href="https://youtu.be/XxgDPSrTWIw"
                  >https://youtu.be/XxgDPSrTWIw</a
                >
              </p>
              <p>
                In production, Gentrace observes for speed, cost, and data flow.
                It also shows real user feedback as well. We do this by
                integrating via our SDK at a code level; Gentrace does not proxy
                requests.
              </p>
              <p>
                Soon, we’ll allow you to convert production data into test
                cases, allowing customer support to turn bad production
                generations into “failing tests” for AI teams to make pass.
              </p>
              <p>
                We process interim steps and multiple outputs as well, helping
                evaluate agent flows / chains where the “last output” isn’t
                always the only thing that matters.
              </p>
              <p>
                There’s been a lot of observability tools published recently. We
                differ from those by focusing more strongly on blending
                observability with strong evaluation and by using an SDK rather
                than a “man-in-the-middle” approach to capturing data (ie
                Gentrace can be down and your request to OpenAI will still
                succeed).
              </p>
              <p>
                Within the evaluation landscape, we differentiate by integrating
                with code (see above for benefits) for capturing generative
                outputs and by providing a customizable UI workflow for building
                evaluators. In Gentrace, you start with off-the-shelf automated
                evaluators and then customize them to your specific task. You
                also build and run new evaluators on old generative outputs.
                Finally, you easily override automated evaluators and/or blend
                automated evaluation with evaluation by humans on your team.
              </p>
              <p>
                We also focus on being suitable for business use. We are SOC 2
                Type 1 compliant (Type 2 coming shortly), have robust legal
                documentation around data processing, security, and privacy, and
                have already passed several vendor legal and security reviews at
                large technology companies.
              </p>
              <p>
                Our standard usage-based pricing is available on the website:
                <a href="https://gentrace.ai/pricing"
                  >https://gentrace.ai/pricing</a
                >
              </p>
              <p>
                If you are building features with generative AI, we would love
                to get your feedback. You can self-serve sign up (without a
                credit card) for a 14 day trial here:
                <a href="https://gentrace.ai/">https://gentrace.ai/</a>
              </p>
              <p>
                We’re available right here for feedback and questions. We’re
                also available at support@gentrace.ai.
              </p>
              <p>Best, Doug, Vivek, and Daniel</p>
            </div>
          </section>
        </section>
        <section id="37238306">
          <h3>
            <a
              class="item"
              href="https://milen.me/writings/exploring-windows-xp-on-macos-arm64/"
              >Exploring Windows XP on macOS ARM64</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 16:15:48</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37238306"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37238254">
          <h3>
            <a class="item" href="https://seaglass.cs.washington.edu/"
              >SeaGlass: City-Wide IMSI-Catcher Detection (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 16:12:27</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37238254"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37237583">
          <h3>
            <a class="item" href="https://generated.photos/human-generator/"
              >AI real-time human full-body photo generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 15:28:45</span
              ><span class="points-container"
                >Points: <span class="points">541</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37237583"
                  >Comments</a
                ><span class="descendants">: 289</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37236027">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/ai/2023/08/how-chatgpt-turned-generative-ai-into-an-anything-tool/"
              >ChatGPT turned generative AI into an “anything tool”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 14:01:18</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37236027"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37233936">
          <h3>
            <a
              class="item"
              href="https://www.isro.gov.in/LIVE_telecast_of_Soft_landing.html"
              >Chandrayaan-3 Soft-landing [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 10:30:23</span
              ><span class="points-container"
                >Points: <span class="points">1797</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37233936"
                  >Comments</a
                ><span class="descendants">: 470</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37232074">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/travel/the-sticky-history-of-baklava-180982771/"
              >The sticky history of baklava</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 05:05:05</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37232074"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37231347">
          <h3>
            <a class="item" href="https://github.com/h313/spet"
              >An interpreter for a programming language based on Spotify
              playlists</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 02:54:33</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37231347"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37231025">
          <h3>
            <a class="item" href="https://pretextbook.org/"
              >PreTeXt: Write Once Read Anywhere Authoring and Publishing
              System</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 02:04:16</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37231025"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37227606">
          <h3>
            <a
              class="item"
              href="https://attainablefelicity.mattkirkland.com/20230822/Sketchbooks.html"
              >On keeping sketchbooks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-22 @ 19:42:08</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37227606"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37226879">
          <h3>
            <a
              class="item"
              href="https://carcinisation.com/2023/08/22/against-automaticity/"
              >Against Automaticity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-22 @ 18:39:30</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37226879"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37224042">
          <h3>
            <a
              class="item"
              href="https://rosenzweig.io/blog/first-conformant-m1-gpu-driver.html"
              >The first conformant M1 GPU driver</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-22 @ 15:23:09</span
              ><span class="points-container"
                >Points: <span class="points">1498</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37224042"
                  >Comments</a
                ><span class="descendants">: 621</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37216702">
          <h3>
            <a
              class="item"
              href="https://www.embopress.org/doi/full/10.15252/msb.202211325"
              >Automated assembly – molecular mechanisms from text mining and
              curated databases</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 23:28:12</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37216702"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37216455">
          <h3>
            <a
              class="item"
              href="https://www.abortretry.fail/p/the-history-of-windows-20"
              >The History of Windows 2.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 22:55:25</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37216455"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37216424">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/23836187/gen-z-news-creator-sourcing-tiktok-instagram-lil-tay"
              >The Fandomization of News</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 22:52:38</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37216424"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37216412">
          <h3>
            <a class="item" href="https://if50.substack.com/p/the-antagonists"
              >The Antagonists: The rise and fall of type-in text games</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 22:51:25</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37216412"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37215331">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2308.08401"
              >The Simplest Walking Robot: A bipedal robot with 1 actuator and 2
              rigid bodies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 21:03:13</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37215331"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37214693">
          <h3>
            <a
              class="item"
              href="https://www.advancedsciencenews.com/time-ran-slowly-in-the-early-universe-just-as-einstein-predicted/"
              >Cosmological time dilation in the early Universe</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 20:09:20</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37214693"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
