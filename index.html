<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35990552">
          <h3>
            <a
              class="item"
              href="https://openai.com/blog/introducing-the-chatgpt-app-for-ios"
              >OpenAI Brings ChatGPT to iOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 16:40:46</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35990552"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35990320">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35990320"
              >Tell HN: Today Is Global Accessibility Awareness Day</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 16:24:09</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35990320"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                One way we can all directly make impact is making a commitment
                to make our software accessible to all, starting with educating
                ourselves about common mistakes folks make when designing UI
                that produce software that can't be used by folks who have
                temporary or long term low vision, low hearing, neurological,
                and other disabilities.
              </p>
              <p>
                There are a ton of free educational events on accessibility
                going on today, and if you don't have time today, find a
                recording, or listen to a podcast, there is a huge opportunity
                to make impact once you better understand the challenges.
              </p>
              <p>
                A couple of years ago while doing research on accessibility I
                came across the Global Accessibility Awareness Day, and the GAAD
                foundation (https://accessibility.day/) - there are many such
                orgs, but if you consider yourself accessibility curious,
                today's a good day to get curious.
              </p>
              <p>/PSA</p>
            </div>
          </section>
        </section>
        <section id="35990182">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/uk-news/2023/may/17/in-london-there-is-no-space-at-all-the-rise-of-self-storage-as-rents-soar"
              >‘In London there is no space at all’: the rise of self-storage as
              rents soar</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 16:14:52</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35990182"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35989911">
          <h3>
            <a
              class="item"
              href="https://who.ldelossa.is/posts/unit-testing-ebpf/"
              >Unit Testing eBPF Programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 16:00:14</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35989911"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35989909">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/antirez/6ca04dd191bdb82aad9fb241013e88a8"
              >The first version of Redis, written in Tcl (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 16:00:06</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35989909"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35989696">
          <h3>
            <a
              class="item"
              href="https://software.rajivprab.com/2019/08/14/nuances-of-overloading-and-overriding-in-java/"
              >Nuances of Overloading and Overriding in Java</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 15:48:47</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35989696"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35989462">
          <h3>
            <a
              class="item"
              href="http://databasearchitects.blogspot.com/2023/04/the-great-cpu-stagnation.html"
              >The Great CPU Stagnation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 15:33:13</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35989462"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35989440">
          <h3>
            <a
              class="item"
              href="https://www.pcworld.com/article/1919392/spacetop-is-the-first-laptop-without-a-screen.html"
              >SpaceTop, an innovative laptop without a screen</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 15:32:08</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35989440"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35988604">
          <h3>
            <a
              class="item"
              href="https://rssdsaisection.substack.com/p/the-alan-turing-institute-has-failed"
              >The Alan Turing Institute has failed to develop modern AI in the
              UK</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 14:37:49</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35988604"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35988538">
          <h3>
            <a
              class="item"
              href="https://languagelog.ldc.upenn.edu/nll/?p=58724"
              >Quid Pro Crow</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 14:33:29</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35988538"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35988046">
          <h3>
            <a
              class="item"
              href="https://loro-dev.notion.site/crdt-richtext-Rust-implementation-of-Peritext-and-Fugue-c49ef2a411c0404196170ac8daf066c0"
              >CRDT-richtext: Rust implementation of Peritext and Fugue</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 14:00:42</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35988046"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35987550">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/GCC-MIPS-New-Maintainer"
              >New Maintainer Steps Up for GCC Compiler's MIPS CPU Port</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 13:26:04</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35987550"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35987413">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/langchain-and-cloudflare/"
              >Using LangChainJS and Cloudflare Workers together</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 13:16:25</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35987413"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35987376">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2023/05/18/tech/bt-job-cuts/index.html"
              >BT will shed as many as 55,000 workers by 2030</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 13:14:03</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35987376"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35986967">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-05-replication-room-temperature-superconductor-superconductivity.html"
              >Replication of room-temperature superconductor fails to show
              superconductivity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 12:29:23</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35986967"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35986956">
          <h3>
            <a
              class="item"
              href="https://finance.yahoo.com/news/legend-zelda-game-sells-10-172603983.html"
              >Legend of Zelda game sells 10M copies in three days</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 12:28:43</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35986956"
                  >Comments</a
                ><span class="descendants">: 388</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35986906">
          <h3>
            <a
              class="item"
              href="https://fortran-lang.discourse.group/t/scipy-there-is-interest-in-adopting-this-prima-implementation-but-little-appetite-for-taking-on-more-fortran-code/5821"
              >SciPy: Interested in adopting PRIMA, but little appetite for more
              Fortran code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 12:22:22</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35986906"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35986270">
          <h3>
            <a
              class="item"
              href="https://morepablo.com/2023/05/where-have-all-the-hackers-gone.html"
              >Where have all the hackers gone?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 10:49:28</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35986270"
                  >Comments</a
                ><span class="descendants">: 232</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35985590">
          <h3>
            <a
              class="item"
              href="https://blog.opensource.org/another-issue-with-the-cyber-resilience-act-european-standards-bodies-are-inaccessible-to-open-source-projects/"
              >European standards bodies are inaccessible to Open Source
              projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 09:03:08</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35985590"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35985285">
          <h3>
            <a
              class="item"
              href="https://www.quantable.com/analytics/who-wants-to-be-tracked/"
              >Who wants to be tracked?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 08:18:38</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35985285"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35985240">
          <h3>
            <a class="item" href="https://userinyerface.com/"
              >User In Yer Face, a worst-practise UI experiment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 08:13:03</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35985240"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35985224">
          <h3>
            <a
              class="item"
              href="https://www.neversaw.us/2021/04/02/the-case-for-bash/"
              >The Case for Bash (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 08:09:42</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35985224"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35985221">
          <h3>
            <a class="item" href="https://greatwavetoday.com"
              >Where can I see Hokusai's Great Wave today?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 08:08:50</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35985221"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35985085">
          <h3>
            <a
              class="item"
              href="https://garden.bradwoods.io/notes/design/user-driven-ui"
              >User Driven UI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 07:43:44</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35985085"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35984928">
          <h3>
            <a class="item" href="https://www.bbc.com/news/technology-65622403"
              >One million cancel broadband as living costs rise</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 07:13:02</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35984928"
                  >Comments</a
                ><span class="descendants">: 219</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35983866">
          <h3>
            <a
              class="item"
              href="https://www.downtowndougbrown.com/2023/05/what-happened-with-asus-routers-this-morning/"
              >What happened with ASUS routers this morning?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 03:29:10</span
              ><span class="points-container"
                >Points: <span class="points">618</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35983866"
                  >Comments</a
                ><span class="descendants">: 392</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35983707">
          <h3>
            <a
              class="item"
              href="https://blog.yenniejun.com/p/all-languages-are-not-created-tokenized"
              >Language models cost much more in some languages than others</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-18 @ 03:02:34</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35983707"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35981743">
          <h3>
            <a
              class="item"
              href="https://blog.gingerbeardman.com/2023/05/17/intelligentpad-component-based-drag-and-drop-software-creator/"
              >IntelligentPad (1989): a component-based drag-and-drop software
              creator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-17 @ 21:53:41</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35981743"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35976488">
          <h3>
            <a class="item" href="https://beepberry.sqfmi.com/"
              >Show HN: Beepberry – a portable e-paper computer for hackers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-17 @ 15:13:53</span
              ><span class="points-container"
                >Points: <span class="points">670</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35976488"
                  >Comments</a
                ><span class="descendants">: 212</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wanted to create a ‘weekend’ device that would let me stay in
                touch with friends and family, without the distractions of a
                full smartphone. I imagined a tiny, hackable e-paper screen with
                a physical keyboard, powered by a Raspberry Pi, that I could use
                to chat around my home…and pretty much nothing else.
              </p>
              <p>
                Before Beeper, the idea probably would not have gone anywhere.
                Most chat apps do not have an API, making it practically
                impossible to hack something like this together. Enter Beeper,
                with connections to 15+ chat networks. Built on top of Matrix,
                Beeper is fully hackable. You can write alternative fun clients
                [1], bots [2] and more!
              </p>
              <p>
                Today, sqfmi is starting to take pre-orders at
                <a href="https://beepberry.sqfmi.com"
                  >https://beepberry.sqfmi.com</a
                >
                for the first batch. It’s $79 (or $99 including a Pi Zero).
                Specs: Sharp Memory LCD (same display tech as in Pebble!), Pi
                Zero (BT/WIFI), physical keyboard, 2000mAh lipo.
              </p>
              <p>
                On top of being an amazing Beeper chat device, it’s basically an
                e-paper Cyberdeck that fits in your pocket. It’s a ton of fun to
                hack on. Keep in mind - THIS IS NOT A REAL FINISHED PRODUCT.
                It’s basically a devkit.
              </p>
              <p>
                More info in the blog post:
                <a href="https://blog.beeper.com/p/beeper-x-sqmfi-beepberry"
                  >https://blog.beeper.com/p/beeper-x-sqmfi-beepberry</a
                >, or join the Discord/Matrix channel
                <a
                  href="https://beepberry.sqfmi.com/docs/getting-started#join-the-beepberry-discord"
                  >https://beepberry.sqfmi.com/docs/getting-started#join-the-be...</a
                >. I’ll hang out a bit here to answer questions as well.
              </p>
              <p>
                [0] <a href="https://beeper.com">https://beeper.com</a> [1]
                <a href="https://github.com/tulir/gomuks"
                  >https://github.com/tulir/gomuks</a
                >
                [2]
                <a href="https://github.com/maubot/maubot"
                  >https://github.com/maubot/maubot</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="35973653">
          <h3>
            <a class="item" href="https://github.com/certik/fastGPT"
              >Fast GPT-2 inference written in Fortran</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-17 @ 11:04:42</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35973653"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
