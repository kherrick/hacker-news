<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36436474">
          <h3>
            <a
              class="item"
              href="https://github.com/noctuid/dotfiles/blob/master/emacs/editing.org"
              >Notes on Text Editing: Why Modality and Chording?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 18:18:48</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36436474"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36436375">
          <h3>
            <a
              class="item"
              href="https://almalinux.org/blog/impact-of-rhel-changes/"
              >Impact of RHEL Changes to AlmaLinux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 18:13:36</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36436375"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36436088">
          <h3>
            <a class="item" href="https://daily.jstor.org/tape-heads/"
              >The Mellotron, an electronic keyboard of recorded samples,
              changed pop music</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 17:54:26</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36436088"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36435698">
          <h3>
            <a
              class="item"
              href="https://www.nist.gov/news-events/news/2023/06/nist-lays-groundwork-future-ultra-precise-timing-links-geosynchronous"
              >Future ultra-precise timing links to geosynchronous satellites</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 17:29:29</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36435698"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36435559">
          <h3>
            <a
              class="item"
              href="https://stability.ai/blog/sdxl-09-stable-diffusion"
              >Stability AI Launches Stable Diffusion XL 0.9</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 17:21:06</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36435559"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36435498">
          <h3>
            <a
              class="item"
              href="https://theintercept.com/2023/06/20/lexisnexis-ice-surveillance-license-plates/"
              >LexisNexis is selling your personal data to ICE so it can try to
              predict crimes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 17:16:28</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36435498"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36434885">
          <h3>
            <a
              class="item"
              href="https://toot.cat/@dredmorbius/110588848407336816"
              >Now Reddit are coming for the individual personal subreddits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 16:41:45</span
              ><span class="points-container"
                >Points: <span class="points">306</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36434885"
                  >Comments</a
                ><span class="descendants">: 185</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36434852">
          <h3>
            <a
              class="item"
              href="https://changelog.com/posts/webassembly-runtimes-will-replace-container-runtimes-by-2030"
              >“WebAssembly runtimes will replace container-based runtimes by
              2030”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 16:40:13</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36434852"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36434578">
          <h3>
            <a
              class="item"
              href="https://bigthink.com/neuropsych/intelligent-people-slower-solve-hard-problems/"
              >Intelligent people take longer to solve hard problems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 16:25:10</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36434578"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36434173">
          <h3>
            <a
              class="item"
              href="https://twitter.com/USCGNortheast/status/1671907901542211584"
              >Debris field found in search for missing submersible</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 15:57:11</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36434173"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36433842">
          <h3>
            <a class="item" href="https://revolt.chat/"
              >Revolt: FOSS Discord Alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 15:38:47</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36433842"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36433262">
          <h3>
            <a
              class="item"
              href="https://code.visualstudio.com/blogs/2021/09/29/bracket-pair-colorization"
              >How VSCode made bracket pair colorization faster (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 15:06:13</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36433262"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36433212">
          <h3>
            <a
              class="item"
              href="https://alt-romes.github.io/posts/2023-06-21-haskell-unicode-syntax-vim.html"
              >Writing prettier Haskell with Unicode syntax and Vim</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 15:03:00</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36433212"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36432885">
          <h3>
            <a
              class="item"
              href="https://www.agwa.name/blog/post/last_weeks_lets_encrypt_downtime"
              >Last week's Let's Encrypt downtime</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 14:42:20</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36432885"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36432595">
          <h3>
            <a class="item" href="https://www.rssboard.org/rss-autodiscovery"
              >RSS Autodiscovery (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 14:21:21</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36432595"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36432369">
          <h3>
            <a class="item" href="https://github.com/aeon-toolkit/aeon"
              >Aeon: A unified framework for machine learning with time
              series</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 14:05:03</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36432369"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36432279">
          <h3>
            <a
              class="item"
              href="https://www.technologyreview.com/2023/06/22/1075405/the-people-paid-to-train-ai-are-outsourcing-their-work-to-ai/"
              >People paid to train AI are outsourcing their work to AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 13:59:07</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36432279"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36432272">
          <h3>
            <a class="item" href="https://svelte.dev/blog/svelte-4">Svelte 4</a>
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 13:58:40</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36432272"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36431917">
          <h3>
            <a class="item" href="https://nanochess.org/video_chess.html"
              >Video Chess disassembled and commented</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 13:33:27</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36431917"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36431826">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/documentation/visionOS"
              >VisionOS developer docs and Vision Pro SDK now available</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 13:26:54</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36431826"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36431493">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/world/americas/ancient-maya-city-discovered-mexican-jungle-2023-06-21/"
              >Ancient Maya city discovered in Mexican jungle</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 13:01:36</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36431493"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36431268">
          <h3>
            <a
              class="item"
              href="https://tinyempires.substack.com/p/4-mistakes-to-avoid-to-build-a-better"
              >Mistakes to avoid to build a better 1-person business</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 12:43:26</span
              ><span class="points-container"
                >Points: <span class="points">332</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36431268"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36431154">
          <h3>
            <a
              class="item"
              href="https://www.gregegan.net/DIDICOSM/Loops/Loops.html"
              >Loops Across Space</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 12:32:36</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36431154"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36431004">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36431004"
              >Launch HN: OpenMeter (YC W23) – Real-Time, Open Source Usage
              Metering</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 12:19:44</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36431004"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <a href="http://openmeter.io">http://openmeter.io</a>). We are
              building an open-source project to help engineers to meter and
              attribute AI and compute usage for billing and analytics use
              cases. Our GitHub is at
              <a href="https://github.com/openmeterio/openmeter"
                >https://github.com/openmeterio/openmeter</a
              >, and there’s a demo video here:
              <a
                href="https://www.loom.com/share/bc1cfa1b7ed94e65bd3a82f9f0334d04"
                >https://www.loom.com/share/bc1cfa1b7ed94e65bd3a82f9f0334d04</a
              >.
              <p>
                Why? Companies are increasingly adopting usage-based pricing
                models, requiring accurate metering. In addition, many SaaS
                products are expected to offer AI capabilities. To effectively
                cover costs and stay profitable, these companies must meter AI
                usage and attribute it to their customers.
              </p>
              <p>
                When I worked at Stripe, my job was to price and attribute
                database usage to product teams. You can think about it like
                internal usage-based pricing to keep teams accountable and the
                business in the margins. This was when I realized that it’s
                challenging to extract usage data from various cloud
                infrastructure components (execution time, bytes stored, query
                complexity, backup size, etc.), meter it accurately, and handle
                failure scenarios like backfills and meter resets. I was
                frustrated that no standard exists to meter cloud
                infrastructure, and we had to do this on our own.
              </p>
              <p>
                Usage metering requires accurately processing large volumes of
                events in real-time to power billing use cases and modern
                data-intensive applications. Imagine you want to meter and bill
                workload execution on a per-second granularity or meter the
                number of API calls you make to a third party and act instantly
                on events like a user hitting a billing threshold. The real-time
                aspect requires instant aggregations and queries; scalability
                means to able to ingest and process millions of usage events per
                second; it must be accurate—billing requires precise metering;
                and it must be fault tolerant, with built-in idempotency, event
                backfills, and meter resets.
              </p>
              <p>
                This is challenging to build out, and the obvious approaches
                don’t work well: writing to a database for each usage event is
                expensive; monitoring systems are cheaper but inaccurate and
                lack idempotency (distributed systems use at-least-once
                delivery); batch processing in the data warehouse has
                unacceptable latency.
              </p>
              <p>
                Companies also need to extract usage data from cloud
                infrastructure (Kubernetes, AWS, etc.), vendors (OpenAI, Twilio,
                etc.), and hardware components to attribute metered usage to
                their customers. Collecting usage in many cases requires writing
                custom code like measuring execution duration, listening to
                lifecycle events, scraping APIs periodically, parsing log
                streams, and attributing usage of shared and multi-tenant
                resources.
              </p>
              <p>
                OpenMeter leverages stream processing to be able to update
                meters in real-time while processing large volumes of events
                simultaneously. The core is written in Go and uses the
                CloudEvents format to describe usage, Kafka to ingest events,
                and ksqlDB to dedupe and aggregate meters. We are also working
                on a Postgres sink for long-term storage. Check out our GitHub
                to learn more:
                <a href="https://github.com/openmeterio/openmeter"
                  >https://github.com/openmeterio/openmeter</a
                >
              </p>
              <p>
                Other companies in the usage-based billing space are focused on
                payments and basically want to be Stripe replacements. With
                OpenMeter, we’re focusing instead on the engineering challenge
                of collecting usage data from cloud infrastructure and balancing
                tradeoffs between cost, scale, accuracy, and staleness. We’re
                not trying to be a payment platform—rather, we want to empower
                engineers to provide fresh and accurate usage data to Product,
                Sales, and Finance, helping them with billing, analytics, and
                revenue use cases.
              </p>
              <p>
                We’re building OpenMeter as an open-source project (Apache 2.0),
                with the goal of making it the standard to collect and share
                usage across many solutions and providers. In the future, we’ll
                offer a hosted / cloud version of OpenMeter with high
                availability guarantees and easy integrations to payment, CRM,
                and analytics solutions.
              </p>
              <p>
                What usage metering issues or experiences do you have? We would
                love to hear your feedback on OpenMeter and to learn from which
                sources you need to extract usage and how the metered data is
                leveraged. Looking forward to your comments!
              </p>
            </div>
          </section>
        </section>
        <section id="36430796">
          <h3>
            <a class="item" href="https://up.codes/careers"
              >UpCodes (YC S17) is doubling engineering and hiring other roles
              too</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 12:00:14</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36429988">
          <h3>
            <a
              class="item"
              href="https://www.pcgamer.com/discord-is-opening-the-monetization-floodgates-get-ready-for-microtransaction-stores-and-paid-exclusive-memes/"
              >Discord is opening the monetization floodgates with
              microtransaction stores</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 10:10:11</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36429988"
                  >Comments</a
                ><span class="descendants">: 253</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36427849">
          <h3>
            <a
              class="item"
              href="https://jasonfeifer.beehiiv.com/p/the-thing-that-seems-like-a-bad-idea-maybe-try-it"
              >How to do the thing you've been avoiding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 03:54:19</span
              ><span class="points-container"
                >Points: <span class="points">456</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36427849"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36423955">
          <h3>
            <a class="item" href="https://moretothat.com/money/"
              >Money is the megaphone of identity (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 20:29:47</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36423955"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36415891">
          <h3>
            <a
              class="item"
              href="https://dannybate.com/2022/11/21/the-almost-romance-languages/"
              >The Almost Romance Languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 08:24:51</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36415891"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36402341">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2023/nigerian-engineering-students-indian-youtubers/"
              >Nigerian engineering students’ favorite teachers are Indian
              YouTubers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 11:09:15</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36402341"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
