<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39143054">
          <h3>
            <a
              class="item"
              href="https://wasmcloud.com/blog/wasi-preview-2-officially-launches"
              >WASI 0.2.0 and Why It Matters</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 14:35:46</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39143054"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39143043">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/israel-gaza-genocide-court-south-africa-27cf84e16082cde798395a95e9143c06"
              >ICJ Orders Israel to Prevent Genocide Without Cease-Fire</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 14:35:06</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39143043"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39142748">
          <h3>
            <a class="item" href="https://github.com/oasislinux/oasis"
              >Oasis – a small, statically-linked Linux system</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 14:11:36</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39142748"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39142568">
          <h3>
            <a
              class="item"
              href="https://usetemper.com/learn/metabolic-step-by-step/"
              >Metabolic Step-by-Step: Stages of Fasting in the First 72hrs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 13:52:07</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39142568"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39142560">
          <h3>
            <a class="item" href="https://www.tinysa.org/wiki/"
              >TinySA – small spectrum analyzer and signal generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 13:51:13</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39142560"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39142295">
          <h3>
            <a class="item" href="https://mihaiolteanu.me/if-lisp-is-so-great"
              >If Lisp is so great</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 13:18:52</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39142295"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39142290">
          <h3>
            <a class="item" href="https://alzheimersbuddy.com/"
              >Show HN: Alzheimer's Buddy: Use Flashing Light and Sound at
              40Hz</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 13:18:35</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39142290"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wanted to try it myself, but was surprised how hard it was to
                find something free and easy to use to generate such pulses.
                Which is odd because I remember some freeware DOS program I
                tried back in the 90s which did all this kind of stuff (anyone
                know what I’m talking about? Google fails me…).
              </p>
              <p>
                So anyway, I made this tool in a couple hours and put it up as a
                public service so that older people can try this treatment now
                without waiting years for FDA trials to finish and without
                getting a diagnosis and expensive piece of medical equipment.
                The code is available here:
              </p>
              <p>
                <a
                  href="https://github.com/Dicklesworthstone/anti_alzheimers_flasher"
                  >https://github.com/Dicklesworthstone/anti_alzheimers_flasher</a
                >
              </p>
              <p>
                As an aside, I first tried making this in Rust, but gave up
                after finding it incredibly annoying to deal with the wgpu
                library with its ever changing and breaking API. This was a
                surprise because I generally find working in Rust to be quite
                pleasant.
              </p>
              <p>
                In contrast, doing it in JS was a total breeze, and I was
                impressed how well canvas and webaudio works nowadays. It also
                makes it easy to add documentation right there on the page, to
                distribute it, and to get it working on mobile phones
                automatically. Web development is pretty awesome!
              </p>
              <p>
                The best part is that, because I made it as a single html file
                on GitHub, I was able to deploy it without even setting up Nginx
                on a machine somewhere— I just used Cloudflare Pages and the
                whole thing took a couple minutes (getting the domain from
                Cloudflare made things even easier since they automatically
                handled everything with the certificate).
              </p>
              <p>
                I realize that there are limitations in using a computer screen
                for precise flashing given hardware refresh rates. I’d certainly
                welcome any PRs if people have ideas about how to improve it or
                make it more efficient without breaking it on mobile. I tried to
                do the flashing in a way that can be easily hardware accelerated
                in modern browsers. The hardest part was getting rid of the
                disconcerting popping artifacts when starting and stopping the
                low frequency audio, but I resolved it by ramping up and down
                the volume beforehand.
              </p>
            </div>
          </section>
        </section>
        <section id="39142048">
          <h3>
            <a
              class="item"
              href="https://www.cbc.ca/radio/asithappens/rat-selfies-1.7093886"
              >Artist trained rats to take selfies to make a point about social
              media</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 12:50:13</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39142048"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39141682">
          <h3>
            <a
              class="item"
              href="https://app.dover.io/Optery/careers/41840615-ceb2-4629-93a5-42d49fa8987d"
              >Optery (YC W22) is hiring a full-stack dev with Node experience
              (Latin America)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 12:00:07</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39140849">
          <h3>
            <a class="item" href="https://jacobfilipp.com/arvid-vhs/"
              >ArVid: Russians squeezed 4 hard drives into one VHS tape in the
              90s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 10:10:57</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39140849"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39140390">
          <h3>
            <a class="item" href="https://www.bbc.co.uk/news/business-68079300"
              >Post Office plan to sack Horizon IT reviewer kept secret,
              documents reveal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 09:13:14</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39140390"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39140135">
          <h3>
            <a
              class="item"
              href="https://greenallianceblog.org.uk/2023/12/22/my-heat-pump-a-personal-story-about-a-broken-heating-industry/"
              >My heat pump: a personal story about a broken heating industry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 08:30:07</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39140135"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39138755">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/959069/c96f34ed67a168e4/"
              >The things nobody wants to pay for</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 03:51:01</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39138755"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39138128">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/feeding-gods-hundreds-skulls-reveal-massive-scale-human-sacrifice-aztec-capital"
              >Skulls reveal scale of human sacrifice in Aztec capital</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 02:05:31</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39138128"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39138042">
          <h3>
            <a
              class="item"
              href="https://willcrichton.net/notes/portable-epubs/#epub-content%2FEPUB%2Findex.xhtml$"
              >Portable EPUBs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 01:53:11</span
              ><span class="points-container"
                >Points: <span class="points">381</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39138042"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39137755">
          <h3>
            <a class="item" href="https://www.peterkrautzberger.org/0136/"
              >I don't always use LaTeX, but when I do, I compile to HTML
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 01:13:21</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39137755"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39137502">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/AMD-XDNA-Linux-Driver-Ryzen-AI"
              >AMD Publishes XDNA Linux Driver: Support for Ryzen AI on Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 00:38:11</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39137502"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39136142">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/collection/kumanaki-kage/"
              >Clear Shadows (1867)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 22:16:00</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39136142"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39135779">
          <h3>
            <a class="item" href="https://www.improbableisland.com"
              >Improbable Island, one of the largest and longest-running online
              text adventures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 21:42:35</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39135779"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39134503">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20070309014113/http://www.amontobin.com/field/"
              >Amon Tobin – Foley Room site (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 20:08:54</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39134503"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39132453">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2024/01/apple-announces-changes-to-ios-safari-and-the-app-store-in-the-european-union/"
              >Apple announces changes to iOS, Safari, and the App Store in the
              European Union</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 18:03:26</span
              ><span class="points-container"
                >Points: <span class="points">1879</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39132453"
                  >Comments</a
                ><span class="descendants">: 2185</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39129680">
          <h3>
            <a
              class="item"
              href="https://www.rorvswild.com/blog/2024/ruby-on-rails-load-testing-habits"
              >Ruby on Rails load testing habits</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 14:07:24</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39129680"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39128902">
          <h3>
            <a
              class="item"
              href="https://twitter.com/graycrawford/status/1750225562281632048"
              >I realized chess pieces can be redesigned to be geometric attack
              directions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 12:36:24</span
              ><span class="points-container"
                >Points: <span class="points">688</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39128902"
                  >Comments</a
                ><span class="descendants">: 227</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39127157">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/tech/CPUIGPCoolingAdvantage"
              >The cooling advantage that CPU integrated graphics has</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 07:32:00</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39127157"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39125016">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/01/macintosh-at-40-the-oddest-and-rarest-macs-ever-built/"
              >Some strange Macintosh computers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 01:21:51</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39125016"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39124018">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/system/files/conference/woot15/woot15-paper-burgess.pdf"
              >Replication Prohibited: Attacking Restricted Keyways with 3D
              Printing [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 23:22:23</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39124018"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39123276">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/why-are-alaskas-rivers-turning-orange/"
              >Why are Alaska's rivers turning orange?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 22:11:56</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39123276"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39120687">
          <h3>
            <a
              class="item"
              href="https://inference-review.com/article/the-man-who-carried-computer-science-on-his-shoulders"
              >Edsger Dijkstra carried computer science on his shoulders
              (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 18:14:17</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39120687"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39119835">
          <h3>
            <a class="item" href="https://zed.dev/blog/zed-is-now-open-source"
              >Zed, a collaborative code editor, is now open source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 17:15:19</span
              ><span class="points-container"
                >Points: <span class="points">1474</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39119835"
                  >Comments</a
                ><span class="descendants">: 546</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39119198">
          <h3>
            <a
              class="item"
              href="https://softwaredoug.com/blog/2024/01/24/are-we-at-peak-vector-db"
              >Are we at peak vector database?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 16:23:52</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39119198"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
