<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37171149">
          <h3>
            <a class="item" href="https://github.com/IBM/fp-go"
              >Functional Programming Library for Golang by IBM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-18 @ 03:33:50</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37171149"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37170911">
          <h3>
            <a
              class="item"
              href="https://scienceswitch.com/2023/08/18/microplastics-detected-in-the-marine-air-from-norway-to-the-high-arctic/"
              >Microplastics Detected in the Marine Air from Norway to the High
              Arctic</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-18 @ 02:47:21</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37170911"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37170771">
          <h3>
            <a class="item" href="https://lwn.net/Articles/939981/"
              >GIL removal and the Faster CPython project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-18 @ 02:20:55</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37170771"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37170683">
          <h3>
            <a
              class="item"
              href="https://vermaden.wordpress.com/2023/08/18/freebsd-bhyve-virtualization/"
              >FreeBSD Bhyve Virtualization</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-18 @ 02:05:14</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37170683"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37170671">
          <h3>
            <a
              class="item"
              href="https://www.bristol.ac.uk/news/2023/august/sea-spider-had-started-to-diversify-by-jurassic.html"
              >The modern sea spider had started to diversify by the Jurassic,
              study finds</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-18 @ 02:03:30</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37170671"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37170669">
          <h3>
            <a class="item" href="https://www.eso.org/public/news/eso2313/"
              >New type of star gives clues to mysterious origin of magnetars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-18 @ 02:02:24</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37170669"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37170273">
          <h3>
            <a
              class="item"
              href="https://thibautbarrere.com/2022/09/09/implementing-a-disk-cache-for-elixir-req"
              >How to implement a disk cache plugin for Elixir's Req HTTP
              client?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-18 @ 00:52:32</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37170273"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37169696">
          <h3>
            <a class="item" href="https://us.starlabs.systems/pages/starlite"
              >StarLite 12.5-inch Linux tablet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 23:30:58</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37169696"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37169303">
          <h3>
            <a
              class="item"
              href="https://opensourcewatch.beehiiv.com/p/suse-go-private"
              >SUSE to Go Private</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 22:51:33</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37169303"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37169226">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/blog-post/aging-brain-misplaced-dna-blame"
              >The aging brain: is misplaced DNA to blame?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 22:43:11</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37169226"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37167922">
          <h3>
            <a
              class="item"
              href="https://www.armytimes.com/news/your-army/2020/02/25/how-the-army-tried-and-failed-to-build-a-bicycle-corps/"
              >How the Army tried and failed to build a bicycle corps (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 20:54:34</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37167922"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37167698">
          <h3>
            <a class="item" href="https://robopen.github.io/"
              >RoboAgent: A universal agent with 12 Skills</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 20:39:58</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37167698"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37167562">
          <h3>
            <a
              class="item"
              href="https://www.kentik.com/blog/dual-subsea-cable-cuts-disrupt-african-internet/"
              >An underwater landslide knocked out two critical submarine cables
              serving Africa</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 20:31:38</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37167562"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37166986">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/08/17/science/climate-paleontology-mammals.html"
              >Ancient fires drove large mammals extinct, study suggests</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 19:48:31</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37166986"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37166946">
          <h3>
            <a
              class="item"
              href="https://charity.wtf/2023/08/17/how-to-communicate-when-trust-is-low-without-digging-yourself-into-a-deeper-hole/"
              >How to communicate when trust is low without digging yourself
              into a deeper hole</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 19:44:47</span
              ><span class="points-container"
                >Points: <span class="points">422</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37166946"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37166880">
          <h3>
            <a class="item" href="https://consensus.app/"
              >Consensus: Use AI to find insights in research papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 19:40:32</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37166880"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37166478">
          <h3>
            <a class="item" href="https://www.jobcorps.gov/"
              >JobCorps.Gov: free job training, food, housing and living
              allowance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 19:07:45</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37166478"
                  >Comments</a
                ><span class="descendants">: 253</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37165042">
          <h3>
            <a class="item" href="https://blog.regehr.org/archives/213"
              >A Guide to Undefined Behavior in C and C++ (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 17:18:08</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37165042"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37164864">
          <h3>
            <a class="item" href="https://www.shadeform.ai/"
              >Show HN: Shadeform – Single Platform and API for Provisioning
              GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 17:07:21</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37164864"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.shadeform.ai/">https://www.shadeform.ai/</a
              >), a GPU marketplace to see live availability and prices across
              the GPU market, as well as to deploy and reserve on-demand
              instances. We have aggregated 8+ GPU providers into a single
              platform and API, so you can easily provision instances like A100s
              and H100s where they are available.
              <p>
                From our experience working at AWS and Azure, we believe that
                cloud could evolve from all-encompassing hyperscalers (AWS,
                Azure, GCP) to specialized clouds for high-performance use
                cases. After the launch of ChatGPT, we noticed GPU capacity
                thinning across major providers and emerging GPU and HPC clouds,
                so we decided it was the right time to build a single interface
                for IaaS across clouds.
              </p>
              <p>
                With the explosion of Llama 2 and open source models, we are
                seeing individuals, startups, and organizations struggling to
                access A100s and H100s for model fine-tuning, training, and
                inference.
              </p>
              <p>
                This encouraged us to help everyone access compute and increase
                flexibility with their cloud infra. Right now, we’ve built a
                platform that allows users to find GPU availability and launch
                instances from a unified platform. Our long term goal is to
                build a hardwareless GPU cloud where you can leverage managed ML
                services to train and infer in different clouds, reducing vendor
                lock-in.
              </p>
              <p>We shipped a few features to help teams access GPUs today:</p>
              <p>
                - a “single plane of glass” for GPU availability and prices;
              </p>
              <p>
                - a “single control plane” for provisioning GPUs in any cloud
                through our platform and API;
              </p>
              <p>
                - a reservation system that monitors real time availability and
                launches GPUs as soon as they become available.
              </p>
              <p>
                Next up, we’re building multi-cloud load balanced inference,
                streamlining self hosting open source models, and more.
              </p>
              <p>
                You can try our platform at
                <a href="https://platform.shadeform.ai"
                  >https://platform.shadeform.ai</a
                >. You can provision instances in your accounts by adding your
                cloud credentials and api keys, or you can leverage “ShadeCloud”
                and provision GPUs in our accounts. If you deploy in your
                account, it is free. If you deploy in our accounts, we charge a
                5% platform fee.
              </p>
              <p>
                We’d love your feedback on how we’re approaching this problem.
                What do you think?
              </p>
            </div>
          </section>
        </section>
        <section id="37163980">
          <h3>
            <a class="item" href="https://questdb.io/blog/fuzz-testing-questdb/"
              >Fuzz testing: the best thing to happen to our application
              tests</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 16:15:29</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37163980"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37163187">
          <h3>
            <a
              class="item"
              href="https://tokio.rs/blog/2023-01-03-announcing-turmoil"
              >Turmoil, a framework for developing and testing distributed
              systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 15:28:39</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37163187"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37162898">
          <h3>
            <a
              class="item"
              href="https://rachit.pl/post/you-have-built-a-compiler/"
              >I am afraid to inform you that you have built a compiler
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 15:10:50</span
              ><span class="points-container"
                >Points: <span class="points">214</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37162898"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37162774">
          <h3>
            <a class="item" href="https://www.fillandflush.com"
              >The Fill and Flush deplaning method</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 15:02:10</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37162774"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37160783">
          <h3>
            <a
              class="item"
              href="https://blog.jgc.org/2023/08/retrieving-1tb-of-data-from-faulty.html"
              >Retrieving 1TB of data from a faulty drive with the help of
              woodworking tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 12:51:00</span
              ><span class="points-container"
                >Points: <span class="points">455</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37160783"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37157747">
          <h3>
            <a
              class="item"
              href="https://airmail.news/issues/2023-7-29/highway-to-nowhere"
              >County Highway: print-only broadsheet magazine about America</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 05:51:38</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37157747"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37148490">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/av/magazine-20669507"
              >Unlocking the mathematical formula of juggling (2012) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 15:22:22</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37148490"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37148062">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Fred_Fish"
              >Fred Fish</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 14:56:18</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37148062"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37147724">
          <h3>
            <a
              class="item"
              href="https://www.cs.rpi.edu/academics/courses/spring11/proglang/handouts/lambda-calculus-chapter.pdf"
              >λ Calculus (2013) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 14:36:37</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37147724"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37143716">
          <h3>
            <a
              class="item"
              href="https://www.truckersnews.com/home/article/15305066/new-book-considers-the-impact-of-electronic-logging-devices-on-drivers"
              >New book considers the impact of electronic logging devices on
              drivers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 07:09:35</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37143716"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37140831">
          <h3>
            <a
              class="item"
              href="https://news.mongabay.com/2023/08/bali-rice-experiment-cuts-greenhouse-gas-emissions-and-increases-yields/"
              >Bali rice experiment cuts greenhouse gas emissions and increases
              yields</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 23:39:30</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140831"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
