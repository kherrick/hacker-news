<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42810737">
          <h3>
            <a
              class="item"
              href="https://www.motortrend.com/news/national-electric-code-revision-threatens-ev-charging/"
              >New Electrical Code Could Doom Most Common EV Charging</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-24 @ 05:21:44</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42810737"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42810646">
          <h3>
            <a class="item" href="https://www.RustDevFindJob.com"
              >New Rust Jobs Site</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-24 @ 04:54:21</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42810646"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42810300">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/ui-is-hell-four-function-calculators"
              >UI is hell: four-function calculators</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-24 @ 03:46:19</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42810300"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42810176">
          <h3>
            <a class="item" href="https://lwn.net/Articles/1002342/"
              >The State of Vim</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-24 @ 03:22:50</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42810176"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42810103">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/the-jagged-monstrous-function-that-broke-calculus-20250123/"
              >Weierstrass's Monster</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-24 @ 03:02:10</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42810103"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42809990">
          <h3>
            <a
              class="item"
              href="https://blog.vectorchord.ai/supercharge-vector-search-with-colbert-rerank-in-postgresql"
              >Supercharge vector search with ColBERT rerank in PostgreSQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-24 @ 02:28:10</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42809990"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42809578">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/sei/jobs/LeAtLYf-full-stack-engineer-typescript-react-gen-ai"
              >Sei (YC W22) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-24 @ 01:00:52</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42809268">
          <h3>
            <a
              class="item"
              href="https://mstdn.social/@isziaui/113874436953157913"
              >A QR code that sends you to a different destination – lenticular
              and adversarial</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 23:55:34</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42809268"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42809034">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/disabling-zen-5s-op-cache-and-exploring"
              >Disabling Zen 5's Op Cache and Exploring Its Clustered Decoder</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 23:14:46</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42809034"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42808889">
          <h3>
            <a class="item" href="https://github.com/runevision/Dither3D"
              >Surface-Stable Fractal Dithering</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 22:50:11</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42808889"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42808801">
          <h3>
            <a class="item" href="https://jprx.io/cve-2024-54507/"
              >Susctl CVE-2024-54507: A particularly 'sus' sysctl in the XNU
              kernel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 22:37:57</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42808801"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42806616">
          <h3>
            <a
              class="item"
              href="https://github.com/fal-ai-community/video-starter-kit"
              >Show HN: Open-source AI video editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 18:34:38</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42806616"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
            <div class="text">
              <p>
                It all started as an internal experiment but as we tackled some
                of the issues it was clear there could be some value sharing it
                with the open source community.
              </p>
              <p>Some of the key points and tech stack details:</p>
              <p>
                - It uses IndexedDb, so all data is local (i.e. no auth, no
                cloud db)
              </p>
              <p>
                - Multiple AI models for video, image, music and voice-over.
                APIs are provided by fal.ai
              </p>
              <p>- Built with the typical React+Next.js, Shadcn front-end</p>
              <p>
                - Used remotion.dev for the realtime video preview (this is such
                a great project, without it the codebase would be twice as
                large)
              </p>
              <p>
                - File uploads so you can bring your own media by
                uploadthing.com
              </p>
              <p>
                - ffmpeg for encoding the final video and also some ui tricks,
                like the audio waveform
              </p>
              <p>
                We deployed a version of it and for now it's free to use. We do
                plan to add some rate limiting and a bring your own API Key
                next, but it's open source and I'm curious about what the
                community will build on top of it, or derive from it. Customize
                your own video app and if you do, please share.
              </p>
              <p>If you have any questions, hit me up!</p>
            </div>
          </section>
        </section>
        <section id="42806486">
          <h3>
            <a class="item" href="https://www.guedelon.fr/en/"
              >Building a Medieval Castle from Scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 18:24:30</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42806486"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42806328">
          <h3>
            <a class="item" href="https://github.com/ggml-org/llama.vim"
              >Llama.vim – Local LLM-assisted text completion</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 18:06:42</span
              ><span class="points-container"
                >Points: <span class="points">385</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42806328"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42806301">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/introducing-operator/"
              >Operator research preview</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 18:03:40</span
              ><span class="points-container"
                >Points: <span class="points">352</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42806301"
                  >Comments</a
                ><span class="descendants">: 312</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42806247">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42806247"
              >Thank HN: My bootstrapped startup got acquired today</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 17:58:05</span
              ><span class="points-container"
                >Points: <span class="points">1541</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42806247"
                  >Comments</a
                ><span class="descendants">: 273</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm Paras Chopra, founder of VWO. We're an A/B testing platform
                that was born here as a Show HN in 2009:
                <a href="https://news.ycombinator.com/item?id=876141"
                  >https://news.ycombinator.com/item?id=876141</a
                >
              </p>
              <p>
                Today, I sold the company to a private equity firm for $200mn.
              </p>
              <p>
                It's covered on TechCrunch:
                <a
                  href="https://techcrunch.com/2025/01/23/everstone-acquires-bootstrapped-indian-startup-wingify-for-200m/"
                  >https://techcrunch.com/2025/01/23/everstone-acquires-bootstr...</a
                >
              </p>
              <p>
                I was a 22 year old fresh graduate when I launched VWO on HN and
                got initial users. Feedback from people like @patio11 helped me
                get to PMF. And now, 15 years later, "site:ycombinator.com" is
                what I appended when I wanted to search for advice on what to
                keep in mind while selling my company.
              </p>
              <p>
                Thank you HN for sharing inspiration and wisdom all along. I
                honestly don't think I would have been an entrepreneur had it
                not been for hacker news.
              </p>
              <p>
                Every single day, HN is the first website I open! I'm feeling
                very grateful towards the community. Thanks @dang, and thank you
                Paul Graham for your essays and for creating this beautiful
                corner of the internet!
              </p>
            </div>
          </section>
        </section>
        <section id="42805425">
          <h3>
            <a class="item" href="https://danluu.com/deconstruct-files/"
              >Working with Files Is Hard (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 16:28:34</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42805425"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42804835">
          <h3>
            <a class="item" href="https://github.com/yassinebenaid/bunster"
              >Bunster: Compile bash scripts to self contained executables</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 15:17:26</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42804835"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42804566">
          <h3>
            <a
              class="item"
              href="https://benpence.com/blog/post/psychedelic-graphics-0"
              >Psychedelic Graphics 0: Introduction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 14:49:43</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42804566"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42804434">
          <h3>
            <a class="item" href="https://dhruvvidyut.co.in/"
              >Turn any bicycle electric</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 14:38:09</span
              ><span class="points-container"
                >Points: <span class="points">269</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42804434"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42803279">
          <h3>
            <a class="item" href="https://samcurry.net/hacking-subaru"
              >Hacking Subaru: Tracking and controlling cars via the admin
              panel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 12:22:19</span
              ><span class="points-container"
                >Points: <span class="points">393</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42803279"
                  >Comments</a
                ><span class="descendants">: 243</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42800893">
          <h3>
            <a class="item" href="https://t4t.social/"
              >Show HN: I built an active community of trans people online</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-23 @ 05:07:35</span
              ><span class="points-container"
                >Points: <span class="points">376</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42800893"
                  >Comments</a
                ><span class="descendants">: 221</span></span
              >
            </h4>
            <div class="text">
              <p>
                Lex is not well liked by its users. Its software feels heavy and
                it is full of cash grabs and anti-patterns. It was recently
                acquired and is sure to only become more hostile to its users as
                it turns towards profit generation.
              </p>
              <p>
                With this in mind I built t4t, an alternative specially designed
                for not only queer people, but specifically trans people.
              </p>
              <p>
                It is an extremely lightweight service. I built it with my most
                ideal stack: Flutter, Svelte, Supabase, Posthog.
              </p>
              <p>
                It has grown in the last year to about 4,000 monthly active
                users. I think it could grow way beyond that this year.
              </p>
            </div>
          </section>
        </section>
        <section id="42797260">
          <h3>
            <a class="item" href="https://www.byran.ee/posts/creation/"
              >Show HN: I made an open-source laptop from scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-22 @ 20:41:52</span
              ><span class="points-container"
                >Points: <span class="points">2761</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42797260"
                  >Comments</a
                ><span class="descendants">: 308</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/Hello9999901/laptop"
                >https://github.com/Hello9999901/laptop</a
              >
            </div>
          </section>
        </section>
        <section id="42791465">
          <h3>
            <a
              class="item"
              href="http://0x80.pl/notesen/2025-01-21-loongarch64-highlights.html"
              >LoongArch64 Subjective Higlights</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-22 @ 11:07:45</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42791465"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42790902">
          <h3>
            <a
              class="item"
              href="https://bart.degoe.de/building-a-full-text-search-engine-150-lines-of-code/"
              >Building a full-text search engine in 150 lines of Python code
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-22 @ 09:34:50</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42790902"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42790536">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/tech/article/silicon-valley-disposition-auction-company-20039023.php"
              >How shut-down Bay Area tech companies ditch their fancy gear</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-22 @ 08:45:13</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42790536"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42789372">
          <h3>
            <a class="item" href="https://ivanbelenky.com/articles/capacitors"
              >Capacitors Meet Geometric Series</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-22 @ 05:34:15</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42789372"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42781578">
          <h3>
            <a class="item" href="https://ejmastnak.com/tutorials/arch/about/"
              >Find Your Footing After Installing Arch Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-21 @ 16:00:08</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42781578"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42777948">
          <h3>
            <a
              class="item"
              href="https://lmnt.me/blog/the-most-mario-colors.html"
              >The Most Mario Colors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-21 @ 09:10:13</span
              ><span class="points-container"
                >Points: <span class="points">354</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42777948"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42775422">
          <h3>
            <a
              class="item"
              href="https://www.doc.ic.ac.uk/~afd/papers/2025/ICST-Industry.pdf"
              >Compiler Fuzzing in Continuous Integration: A Case Study on Dafny
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-21 @ 01:38:57</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42775422"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
