<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38353784">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2023/11/20/advertiser-exodus-expected-to-deeply-impact-x-ad-revenue-analysis-indicates/"
              >Advertiser exodus expected to deeply impact X ad revenue,
              analysis indicates</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 20:05:26</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38353784"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38353473">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38353473"
              >Launch HN: Stralis (YC W23) – Hydrogen electric aircraft for
              medium-haul travel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 19:47:49</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38353473"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <a href="https://stralis.aero">https://stralis.aero</a>). We’re
              taking advantage of hydrogen electric propulsion technology to
              design a low cost, 50-seat aircraft that can replace a significant
              portion of the ubiquitous single-aisle (e.g. Boeing 737) market
              that makes up ~60% of commercial aircraft sold. We are starting
              out by developing the propulsion system for a 6-seat Beechcraft
              Bonanza. So far, we have installed and tested the electric motor
              and performed some benchtop fuel cell testing. Here’s a quick
              video showing what it looks like these days:
              <a href="https://vimeo.com/879966330"
                >https://vimeo.com/879966330</a
              >. Next step is to perform some system testing with a COTS fuel
              cell, whilst we progress our own fuel cell development. We are
              currently working through setting up our hydrogen electric
              propulsion test lab at Brisbane International Airport, which will
              allow us to rapidly prototype subsystems and generate the data we
              need for the 50 seat, SA-1, design. Quick fly through video of our
              facility here:
              <a href="https://vimeo.com/884325165"
                >https://vimeo.com/884325165</a
              >
              <p>
                Airlines are anticipating the need to de-carbonise, driven by
                legislation or by customer pressure, but there is not yet any
                emission-free aircraft solution that is practical and
                cost-effective to adopt. Other solutions are either too heavy,
                like batteries and automotive industry fuel cells, or too
                expensive and inefficient, like sustainable aviation fuel. It is
                important to get a low enough CASM (Cost per Available Seat
                Mile) to allow operators to switch to a sustainable solution
                without having to dramatically increase ticket prices.
              </p>
              <p>
                Bob and I met at a company called magniX, who develop high
                specific power electric motors. magniX quickly identified
                aerospace as a major market for their technology but at the
                time, most of the customers were working on battery electric
                solutions for de-carbonizing air travel. We were personally
                involved in 3 aircraft platforms (that have flown) that used our
                motors. Whilst we are super proud of what we achieved and
                overcoming the technical hurdles to fly those planes, it became
                clear that batteries were never going to be the solution to
                de-carbonising a significant portion of air travel. We went on
                to work at a few different sustainable aviation companies, and
                slowly became convinced that hydrogen would be the only
                technology that would have a chance of achieving the goal of
                sustainable aviation. There is a lot of public discourse on what
                is the best technology to solve this high-stakes problem, but
                instead of arguing about what can and can't work, we decided it
                would be best to dive into the technology and give our best go
                at what we think has the best chance.
              </p>
              <p>
                Our propulsion system is quite straightforward—we carry liquid
                hydrogen in a composite, vacuum insulated storage tank. We boil
                off the hydrogen and feed it into the fuel cell. We take air
                from outside the plane to supply the fuel cell with oxygen.
                Hydrogen and oxygen react in the fuel cell and produce
                electricity, with water vapor being the only by-product. The
                electricity then powers a lightweight electric motor that spins
                a propeller.
              </p>
              <p>
                Unlike most other fuel cell systems, we use the oxygen supply
                air to cool the fuel cell as well — removing the need for large,
                heavy and draggy external heat exchangers. This is achieved
                through our choice of fuel cell membrane with a much higher
                operating temperature (180 C). We remove the weight of the heat
                exchangers but also reduce the weight of the propulsion system
                as we don’t need to overcome the extra drag created by the
                radiators. All of this combines to reduce the fuel cell system
                weight by about 40%, which equates to a doubling of our payload
                capacity and, therefore, half the CASM, when compared to a
                conventional PEM fuel cell system.
              </p>
              <p>
                In addition to our tech, we are also approaching the market
                differently. We think that a 50-seat aircraft is the optimum
                size for an aircraft with our hydrogen electric propulsion. This
                is different from conventional turbofan technology where the
                optimum size appears to be about 200 seats. All of our
                competitors are working towards a family of aircraft going
                upwards of 200 seats (Airbus are only focusing on larger
                aircraft) but we think there are diminishing returns from
                building larger hydrogen electric aircraft. Instead, we are
                honing in on a 50-seat design, optimized for hydrogen electric
                and designed with automotive manufacture methods in mind. There
                could be a market demand for up to 50,000 aircraft within the
                next 25 years, driven by more efficient, point-to-point routes.
                Most other aircraft programs deliver around 1,000 units, which
                generally doesn't warrant a large amount of automation, and
                keeps unit costs high.
              </p>
              <p>
                Hydrogen fuel cells are not new, but we think the need to
                de-carbonise, the reduction in renewable energy costs, and the
                improvement in component technologies such as motors, power
                electronics, batteries etc. make today the best time to pursue
                this solution to sustainable air travel. We would love to hear
                from any of you who have worked in aerospace, sustainable
                aviation fuel (the biggest alternative to hydrogen) and the
                hydrogen industry. We would also like to hear from people who
                fly often, and airlines, to learn how important a switch to a
                sustainable solution is to you. Looking forward to reading all
                the comments!
              </p>
            </div>
          </section>
        </section>
        <section id="38353285">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2311.08516"
              >LLMs cannot find reasoning errors, but can correct them</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 19:35:27</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38353285"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38353146">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/legal/transactional/venmo-cash-app-users-sue-apple-over-peer-to-peer-payment-fees-2023-11-20/"
              >Venmo, Cash App users sue Apple over peer-to-peer payment fees</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 19:27:06</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38353146"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38352891">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/11/20/23969586/sam-altman-plotting-return-open-ai-microsoft"
              >Sam Altman is still trying to return as OpenAI CEO</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 19:11:21</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38352891"
                  >Comments</a
                ><span class="descendants">: 310</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38352794">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/LocalLLaMA/comments/17zo2ml/google_quietly_open_sourced_a_16_trillion/"
              >Google quietly open sourced a 1.6T parameter MOE model</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 19:06:08</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38352794"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38352484">
          <h3>
            <a
              class="item"
              href="https://www.itbrew.com/stories/2023/11/17/after-boeing-declines-to-pay-up-ransomware-group-leaks-45-gb-of-data"
              >After Boeing declines to pay up, ransomware group leaks 45 GB of
              data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 18:47:18</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38352484"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38352028">
          <h3>
            <a
              class="item"
              href="https://thezvi.wordpress.com/2023/11/20/openai-facts-from-a-weekend/"
              >OpenAI: Facts from a Weekend</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 18:21:45</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38352028"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38351497">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-11-20/us-seeks-more-than-4-billion-from-binance-to-end-criminal-case"
              >US Seeks More Than $4B from Binance to End Criminal Case</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 17:52:30</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38351497"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38351370">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38351370"
              >Ask HN: What's the state of the art for drawing math diagrams
              online?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 17:44:51</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38351370"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
            <div class="text">
              <p>
                Ideally I would be able to produce the diagrams in JS with KaTeX
                handling rendering the labels, but this doesn't seem to exist
                (I'm a software engineer so I'm wondering if I should try to
                make it...). Nice features also include having the diagram being
                controllable by JS or animatable, but that's not a requirement.
              </p>
              <p>What are other people using?</p>
              <p>Things I've considered:</p>
              <p>TikZ options:</p>
              <p>* TikZ exported to SVG</p>
              <p>
                * Writing the TikZ in something else, e.g. I found this library
                PyTikZ which is old but I could update things to it, that way at
                least I don't have to wrangle TikZ's horrible syntax much
                myself. I could theoretically write a JS version of this.
              </p>
              <p>
                * Maybe the same thing, JS -&gt; TikZ, but also run TikZ in
                WebAssembly so that the whole thing lives in the browser.
              </p>
              <p>
                * Writing TikZ but ... having ChatGPT do it so I don't have to
                learn to antiquated syntax.
              </p>
              <p>Non-TikZ options:</p>
              <p>* InkScape</p>
              <p>* JSXGraph, but it isn't very pretty</p>
              <p>* ???</p>
              <p>Thanks for your help!</p>
            </div>
          </section>
        </section>
        <section id="38351356">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/freshpaint/bfe56523-bff4-4ca3-936b-0ba15fb4e572?utm_source=hn"
              >Freshpaint (YC S19) Is Hiring Software Engineers to Protect
              Patient Privacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 17:44:21</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38351195">
          <h3>
            <a class="item" href="https://brandonspark.github.io/150/"
              >15-150: Principles of Functional Programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 17:34:50</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38351195"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38351194">
          <h3>
            <a
              class="item"
              href="https://www.collabora.com/news-and-blog/news-and-events/nvk-reaches-vulkan-conformance.html"
              >NVK reaches Vulkan 1.0 conformance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 17:34:39</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38351194"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38350341">
          <h3>
            <a
              class="item"
              href="https://www.fastcompany.com/90981005/airlines-fees-118-billion-dark-patterns"
              >Airlines will make record $118B in extra fees with website dark
              patterns</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 16:47:08</span
              ><span class="points-container"
                >Points: <span class="points">262</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38350341"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38349716">
          <h3>
            <a class="item" href="https://brandur.org/river"
              >River: A fast, robust job queue for Go and Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 15:54:03</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38349716"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38347868">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/openai-staff-walk-protest-sam-altman/"
              >OpenAI staff threaten to quit unless board resigns</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 13:41:27</span
              ><span class="points-container"
                >Points: <span class="points">1192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38347868"
                  >Comments</a
                ><span class="descendants">: 1082</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38347555">
          <h3>
            <a
              class="item"
              href="https://animals.howstuffworks.com/animal-facts/5-animals-whose-blood-isnt-red.htm"
              >Animals Whose Blood Isn't Red</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 13:20:34</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38347555"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38346869">
          <h3>
            <a
              class="item"
              href="https://stratechery.com/2023/openais-misalignment-and-microsofts-gain/"
              >OpenAI's misalignment and Microsoft's gain</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 12:10:25</span
              ><span class="points-container"
                >Points: <span class="points">404</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38346869"
                  >Comments</a
                ><span class="descendants">: 234</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38346862">
          <h3>
            <a class="item" href="https://www.roc-lang.org/"
              >Roc – A fast, friendly, functional language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 12:09:30</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38346862"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38345017">
          <h3>
            <a
              class="item"
              href="https://codemanship.wordpress.com/2023/11/20/the-bluffers-guide-to-the-mythical-man-month/"
              >The Bluffers Guide to the Mythical Man Month</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 08:54:16</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38345017"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38344973">
          <h3>
            <a
              class="item"
              href="http://fxrant.blogspot.com/2017/01/the-death-star-and-final-trench-run.html"
              >The Death Star and the Final Trench Run (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 08:50:53</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38344973"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38344196">
          <h3>
            <a
              class="item"
              href="https://twitter.com/satyanadella/status/1726509045803336122"
              >Sam Altman, Greg Brockman and others to join Microsoft</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 07:56:13</span
              ><span class="points-container"
                >Points: <span class="points">1650</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38344196"
                  >Comments</a
                ><span class="descendants">: 1190</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38343385">
          <h3>
            <a
              class="item"
              href="https://colinwalker.blog/blog/?date=2023-11-19"
              >RSS can be used to distribute all sorts of information</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 06:29:01</span
              ><span class="points-container"
                >Points: <span class="points">260</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38343385"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38342670">
          <h3>
            <a class="item" href="https://github.com/Acly/krita-ai-diffusion"
              >Krita AI Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 05:22:12</span
              ><span class="points-container"
                >Points: <span class="points">458</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38342670"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38342642">
          <h3>
            <a
              class="item"
              href="https://www.evanjones.ca/setenv-is-not-thread-safe.html"
              >Setenv Is Not Thread Safe and C Doesn't Want to Fix It</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 05:19:56</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38342642"
                  >Comments</a
                ><span class="descendants">: 263</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38338037">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/review/revolutionary-temper-robert-darnton-review"
              >'The Revolutionary Temper' by Robert Darnton Review</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 21:07:56</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38338037"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38332585">
          <h3>
            <a class="item" href="https://ssw.jku.at/Research/Books/Oberon2.pdf"
              >Object-Oriented Programming in Oberon-2 [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 13:47:34</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38332585"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38332226">
          <h3>
            <a
              class="item"
              href="https://mirror.clientvps.com/CTAN/macros/latex/contrib/microtype/microtype.pdf"
              >The microtype package: Subliminal refinements towards
              typographical perfection [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 12:54:59</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38332226"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38331782">
          <h3>
            <a class="item" href="https://librarycards.tripod.com/"
              >The Great Library Card Collection</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 11:52:40</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38331782"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38316002">
          <h3>
            <a
              class="item"
              href="https://github.com/tigerbeetle/tigerbeetle/blob/main/docs/DESIGN.md"
              >Tigerbeetle's Storage Fault Model</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 06:03:01</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38316002"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
