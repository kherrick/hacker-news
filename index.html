<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39877276">
          <h3>
            <a
              class="item"
              href="https://smunshi.net/kolmogorov-complexity-and-compression-distance.html"
              >Kolmogorov Complexity and Compression Distance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 18:20:35</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39877276"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39876952">
          <h3>
            <a
              class="item"
              href="https://www.high-capacity.com/p/how-china-uses-foreign-firms-to-turbocharge"
              >China uses foreign firms to turbocharge its industry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 17:46:26</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39876952"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39876817">
          <h3>
            <a
              class="item"
              href="https://www.righto.com/2024/03/idt-gate-array.html"
              >An unusual 7400-series chip implemented with a gate array</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 17:33:23</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39876817"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39876517">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/hadrius/jobs/1z3APsX-founding-engineer"
              >Hadrius (YC W23) – Founding Engineer for fastest growing
              compliance software</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 17:00:09</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39876447">
          <h3>
            <a
              class="item"
              href="https://www.sciencedirect.com/science/article/pii/S2667318524000023"
              >Benchmarking LLMs against human expert-curated biomedical
              knowledge graphs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 16:51:57</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39876447"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39876131">
          <h3>
            <a
              class="item"
              href="https://docs.kernel.org/userspace-api/landlock.html"
              >Landlock: Unprivileged Access Control</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 16:06:57</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39876131"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39876114">
          <h3>
            <a class="item" href="https://thegradient.pub/mamba-explained/"
              >Mamba Explained</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 16:04:53</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39876114"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39875822">
          <h3>
            <a
              class="item"
              href="https://tailscale.com/blog/tls-outage-20240307"
              >About the Tailscale.com outage on March 7, 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 15:34:58</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39875822"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39875473">
          <h3>
            <a
              class="item"
              href="http://craig-henderson.blogspot.com/2009/11/dewitt-and-stonebrakers-mapreduce-major.html"
              >DeWitt and Stonebraker's "MapReduce: A major step backwards"
              (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 14:57:51</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39875473"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39875225">
          <h3>
            <a
              class="item"
              href="https://news.sky.com/story/headless-dog-sized-robot-to-patrol-alaska-airport-to-prevent-bird-strikes-13104283"
              >Headless, dog-sized robot to patrol Alaska airport to prevent
              bird strikes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 14:29:22</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39875225"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39874931">
          <h3>
            <a class="item" href="https://www.irfanview.com/">IrfanView</a>
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 13:56:45</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39874931"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39874583">
          <h3>
            <a
              class="item"
              href="https://graphite.dev/blog/github-monopoly-on-code-hosting"
              >How GitHub replaced SourceForge as the dominant code hosting
              platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 13:18:12</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39874583"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39874303">
          <h3>
            <a class="item" href="https://wiki.c2.com/?TheKenThompsonHack"
              >The Ken Thompson Hack</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 12:41:35</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39874303"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39874066">
          <h3>
            <a
              class="item"
              href="https://www.llnl.gov/archives/1980s/brilliant-pebbles"
              >Brilliant Pebbles (2001)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 12:06:01</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39874066"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39873909">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2024/03/proteins-let-cells-remember-how-well-their-last-division-went/"
              >Proteins let cells remember how well their last division went</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 11:42:34</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39873909"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39873692">
          <h3>
            <a
              class="item"
              href="https://bitbashing.io/gc-for-systems-programmers.html"
              >Garbage Collection for Systems Programmers (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 11:03:54</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39873692"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39873272">
          <h3>
            <a class="item" href="https://github.com/tatut/pgprolog"
              >Prolog language for PostgreSQL proof of concept</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 09:36:53</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39873272"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39873169">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/web/FirefoxMediaAutoplaySettingsIV"
              >Some notes on Firefox’s media autoplay settings in practice as of
              Firefox 124</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 09:14:23</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39873169"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39872848">
          <h3>
            <a
              class="item"
              href="https://hereket.com/posts/x11_window_with_shaders/"
              >From scratch OpenGL and shaders with raw Xlib</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 08:08:57</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39872848"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39872804">
          <h3>
            <a
              class="item"
              href="https://archive.nytimes.com/opinionator.blogs.nytimes.com/2008/09/23/toms-essay/"
              >Tom's Essay (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 08:00:55</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39872804"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39872236">
          <h3>
            <a
              class="item"
              href="https://writings.stephenwolfram.com/2024/03/when-exactly-will-the-eclipse-happen-a-multimillennium-tale-of-computation/"
              >When will the eclipse happen? A multimillennium tale of
              computation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 06:01:32</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39872236"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39871913">
          <h3>
            <a class="item" href="https://bpfman.io/main/"
              >Bpfman: An eBPF Manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 04:49:45</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39871913"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39870929">
          <h3>
            <a
              class="item"
              href="https://dl.gi.de/server/api/core/bitstreams/7c7a8830-fd81-4e56-8507-cd4809020660/content"
              >Full-scale file system acceleration on GPU [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 01:21:14</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39870929"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39870717">
          <h3>
            <a
              class="item"
              href="https://www.cambridge.org/core/journals/cambridge-archaeological-journal/article/figurative-representations-in-the-north-european-neolithicare-they-there/1907EFA10388E86A93E41C366C280133"
              >Figurative Representations in the North European Neolithic–Are
              They There?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-30 @ 00:49:30</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39870717"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39867757">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39867757"
              >Launch HN: Lumona (YC W24) – Product search based on Reddit and
              YouTube reviews</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 19:04:04</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39867757"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
            <div class="text">
              <a href="https://lumona.ai">https://lumona.ai</a>), a product
              search engine that recommends products based on what people on
              social media—Reddit and YouTube, for now—are saying about them.
              <p>
                Rather than going through SEO-filled Google results or adding
                site:reddit.com to your search, we explain what makes a good
                product, show you the best products, and back it up with Reddit
                and YouTube reviews about the product. We’re starting with
                skincare products (more on that below) and plan to expand from
                there.
              </p>
              <p>
                Here’s a demo:
                <a
                  href="https://www.youtube.com/watch?v=C4kKjW2YkZ4&amp;lc=Ugzl94GP9SDBOvqA2Dd4AaABAg"
                  >https://www.youtube.com/watch?v=C4kKjW2YkZ4&amp;lc=Ugzl94GP9SDBO...</a
                >
              </p>
              <p>
                We started off with skincare because, growing up, we struggled
                with acne but had no clue what skincare products could actually
                help us. Going down the rabbit hole of endlessly scrolling
                r/SkincareAddiction and watching countless hours of videos about
                cystic acne was not fun.
              </p>
              <p>
                Lumona’s skincare search index was built by first scraping the
                internet for listings of skincare products, along with their
                ingredient lists, through a combination of SERP, Amazon’s API,
                and web page crawling. We then use a fine-tuned Mistral LLM to
                parse through a large number of Reddit threads and YouTube
                transcripts to extract opinions made by users, along with the
                context in which the opinions were made. These opinions are then
                matched with any relevant products through another fine-tuned
                LLM that looks at an opinion and any products that have a high
                cosine similarity as that of the opinion’s subject and decides
                whether that opinion is relevant to any of those products. Using
                a Mistral-7B FT trained on GPT-4 outputs allowed us to parse
                through hundreds of thousands of Reddit threads in a simple way
                with just hundreds of dollars of compute.
              </p>
              <p>
                If your query relates to a specific situation (e.g. “cleansers
                for my son who has inflamed acne on his forehead”), we search
                semantically through the opinions of Redditors and YouTubers to
                retrieve the products recommended by those who have dealt with a
                similar situation. If your query relates to a specific product
                (e.g. “iunik centella gel”), we instead go through the product
                listings themselves to return you the relevant products.
              </p>
              <p>
                We also use an LLM to analyze your search query to tell you what
                ingredients or effects are preferable for your skin concern.For
                example, if you searched for “inflamed forehead acne”,
                properties like “Oil-Control” and “Azelaic Acid” which are good
                for dealing with inflamed acne would be explained to you, and
                results containing those properties would be boosted and tagged
                in our results. You can also try out searches like “korean
                cleansers under $20 with Cica” to filter for certain ingredients
                and price points.
              </p>
              <p>
                While we think we’ve built a product search that would be pretty
                helpful for our teenage (and current!) selves, there are many
                improvements we’d like to make, such as getting opinions from
                Tiktok and other social media platforms and making our opinion
                extraction process more robust for edge cases (e.g. by using
                OCR, video transcription tools). We’re also planning on allowing
                our users to upload their own reviews and content and to expand
                our search across more products.
              </p>
              <p>
                The long-term potential is to be a go-to product for anyone
                looking for what other people think about anything subjective
                (products, restaurants, b2b products, vacation planning, etc.).
                We believe that the entire discovery experience can be
                revolutionized by making it as easy as searching on Google to
                find out what the people you care about think about something.
                On the individual level, we want to make sharing your opinions
                with your friends and the world as easy as posting a picture on
                Instagram.
              </p>
              <p>
                For now, if you have any skincare needs, whether it be to solve
                a skin concern, get rid of an annoying pimple, or just to find a
                good sunscreen, please give us a try:
                <a href="https://lumona.ai">https://lumona.ai</a> (We are an
                Amazon and Stylevana affiliate.)
              </p>
              <p>
                We’d love to hear your feedback on our search engine, whether
                that be how the skincare search performs, what you think is
                missing, what products you want to see there, or any technical
                suggestions!
              </p>
            </div>
          </section>
        </section>
        <section id="39866325">
          <h3>
            <a class="item" href="https://github.com/pojntfx/weron"
              >Overlay networks based on WebRTC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 17:00:07</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39866325"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39850340">
          <h3>
            <a class="item" href="https://www.nippon.com/en/in-depth/d00956/"
              >Mazda’s rotary engine in the age of the electric car</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 12:22:07</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39850340"
                  >Comments</a
                ><span class="descendants">: 258</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39849644">
          <h3>
            <a class="item" href="https://mobiusml.github.io/1bit_blog/"
              >Towards 1-bit Machine Learning Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 10:58:34</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39849644"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39837467">
          <h3>
            <a
              class="item"
              href="https://www.artnews.com/art-news/news/richard-serra-minimalist-sculptor-dead-1234701117/"
              >Richard Serra, minimalist sculptor whose steel creations awed
              viewers, has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-27 @ 10:46:47</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39837467"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39833337">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-03-team-acoustic-crystal-smooth-elastic.html"
              >A proposal for a novel acoustic crystal with continuous changes
              in elasticity</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 21:58:53</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39833337"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
