<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38509173">
          <h3>
            <a class="item" href="https://wildergardenaudio.com/maim/"
              >Show HN: Audio plugin for circuit-bent MP3 compression sounds</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 18:01:36</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38509173"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                The plugin lets you switch between two MP3 encoders, since under
                the MP3 standard, the specifics of what to lose in MP3 lossy
                compression is left up to the encoder. The encoders are LAME,
                the gold standard for open-source MP3 encoders, and BladeEnc, an
                old open-source MP3 encoder that has a really bubbly sound and
                was fun to work with.
              </p>
              <p>
                I'd love any feedback, and I'll be around to answer questions!
              </p>
            </div>
          </section>
        </section>
        <section id="38509011">
          <h3>
            <a
              class="item"
              href="https://kffhealthnews.org/news/article/medicare-advantage-payment-rates-friction/"
              >Medicare Advantage Popular with Seniors – But Not Hospitals and
              Doctors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 17:46:26</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38509011"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508993">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38508993"
              >Wise (formerly Transfer Wise) are asking me to send them photo of
              my ID</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 17:44:43</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508993"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wonder if anyone here knows how is Wise handling photos of ID
                when they request one.
              </p>
              <p>
                I'm Wise customer since 2012, used it without any problem
                multiple times and was happy with the service I was receiving.
              </p>
              <p>
                A few days ago I received an email asking me to send a photo of
                my ID and also photo of my face.
              </p>
              <p>
                I understand they are doing this to fulfill some regulations but
                on the other side I can't stop thinking what damage will it
                cause if they fall a victim of hackers attack and photo of my ID
                is stolen from them. In the country where I live you can take a
                loan based on information from ID.
              </p>
              <p>
                Please share if you have gone through that process or if you
                know what they do with those photos once they confirm the photo
                of face matches with the photo on ID. I asked them through
                e-mail and will post here if I hear back.
              </p>
              <p>--edit--</p>
              <p>
                I should have mentioned photos are uploaded through Wise web
                app, not through the e-mail, sorry if my explanation was
                confusing.
              </p>
            </div>
          </section>
        </section>
        <section id="38508779">
          <h3>
            <a class="item" href="https://github.com/mattwparas/steel"
              >Steel – An embeddable and extensible scheme dialect built in
              Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 17:24:18</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508779"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508571">
          <h3>
            <a
              class="item"
              href="https://ai.gopubby.com/unbelievable-run-70b-llm-inference-on-a-single-4gb-gpu-with-this-new-technique-93e2057c7eeb?gi=cbe7920f4cd2"
              >Run 70B LLM Inference on a Single 4GB GPU with This New
              Technique</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 17:04:07</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508571"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508532">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/motion/4f5f6a29-3af0-4d79-99a4-988ff7c5ba05?utm_source=hn"
              >Motion (YC W20) Is Hiring Front End Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 17:00:02</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508504">
          <h3>
            <a
              class="item"
              href="https://projects.propublica.org/killing-the-colorado/story/wasting-water-out-west-use-it-or-lose-it/"
              >Use It or Lose It: Exercising one's right to waste water
              (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 16:57:05</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508504"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508418">
          <h3>
            <a
              class="item"
              href="https://johnhawks.net/weblog/all-the-hominins-made-tools/"
              >All the hominins made tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 16:49:36</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508418"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508324">
          <h3>
            <a class="item" href="https://github.com/good-lly/lowstorage"
              >Lowstorage: JSON-based database for Cloudflare Workers and R2
              buckets</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 16:38:39</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508324"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508282">
          <h3>
            <a class="item" href="https://github.com/lobsters/lobsters"
              >Lobsters</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 16:34:49</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508282"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508276">
          <h3>
            <a class="item" href="https://github.com/aws/s2n-tls"
              >S2n-TLS – A C99 implementation of the TLS/SSL protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 16:34:21</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508276"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38507672">
          <h3>
            <a class="item" href="https://bbycroft.net/llm"
              >LLM Visualization</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 15:22:39</span
              ><span class="points-container"
                >Points: <span class="points">450</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38507672"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38507594">
          <h3>
            <a
              class="item"
              href="https://blog.scottlogic.com/2019/05/17/webassembly-compiler.html"
              >Build your own WebAssembly Compiler (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 15:11:29</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38507594"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38507381">
          <h3>
            <a
              class="item"
              href="http://twitchard.github.io/posts/2019-06-21-life-is-too-short-for-jenkins.html"
              >The worst thing about Jenkins is that it works (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 14:40:36</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38507381"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38507116">
          <h3>
            <a class="item" href="https://precondition.github.io/home-row-mods"
              >A guide to home row mods</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 13:58:17</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38507116"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38506900">
          <h3>
            <a class="item" href="https://www.onsites.fyi/"
              >Show HN: Onsites.fyi - Curated Big Tech Interview Experiences</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 13:29:53</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506900"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
            <div class="text">
              <p>
                While Glassdoor and other employment discussion boards offer
                valuable interview experience data, navigating it to prepare for
                interviews can be difficult.
              </p>
              <p>
                Onsites.fyi curates interview experiences and insights from Big
                Tech hiring across various positions and levels.
              </p>
              <p>
                Our collection currently includes interview experiences from
                top-tier companies like Apple, Google, Meta, Microsoft, and
                Amazon.
              </p>
              <p>
                Reviewing real interview experiences (rounds, questions, format)
                of others could be an invaluable preparation tool for
                interviews.
              </p>
              <p>Try it out and please share any feedback!</p>
            </div>
          </section>
        </section>
        <section id="38506835">
          <h3>
            <a
              class="item"
              href="https://github.com/ikatson/rqbit/releases/tag/v4.0.0"
              >Show HN: Rqbit – bittorent CLI and desktop app written in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 13:17:53</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506835"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38506705">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/quadruped-robot-wheels"
              >Wheel-Hand-Leg-Arms Open Doors Playfully</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 12:50:38</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506705"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38506488">
          <h3>
            <a
              class="item"
              href="https://www.occrp.org/en/narcofiles-the-new-criminal-order/inside-job-how-a-hacker-helped-cocaine-traffickers-infiltrate-europes-biggest-ports"
              >Inside Job: How a Hacker Helped Cocaine Traffickers Infiltrate
              Europe's Ports</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 12:09:15</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506488"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38506166">
          <h3>
            <a class="item" href="https://plant.max-richter.dev"
              >Show HN: Simulate 3D Plants in the Browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 10:55:35</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506166"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38506140">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2311.18805"
              >GPT-4 Can Almost Perfectly Handle Unnatural Scrambled Text</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 10:48:50</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506140"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38506078">
          <h3>
            <a class="item" href="http://brinch-hansen.net/papers/"
              >Concurrent Pascal and SuperPascal programming languages, and
              more</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 10:27:38</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506078"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38505138">
          <h3>
            <a class="item" href="https://ed-thelen.org/comp-hist/APL-hist.html"
              >A Personal History of APL (1982)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 05:46:18</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38505138"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38504787">
          <h3>
            <a class="item" href="https://www.ed-thelen.org/computer.html"
              >The analog computer for the Nike missile system (2001)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 04:14:52</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38504787"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38504134">
          <h3>
            <a
              class="item"
              href="https://rachelbythebay.com/w/2023/11/30/armv6/"
              >Clang now makes binaries an original Pi B+ can't run</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 02:07:21</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38504134"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38499619">
          <h3>
            <a
              class="item"
              href="http://backreaction.blogspot.com/2009/07/what-is-fundamental.html"
              >What Is Fundamental? (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-02 @ 16:16:11</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38499619"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38498866">
          <h3>
            <a class="item" href="https://sidecartridge.com/"
              >SidecarT – Atari ST/STE/Mega Cartridge Emulator on Raspberry Pi
              Pico Steroids</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-02 @ 14:35:33</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38498866"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38498109">
          <h3>
            <a class="item" href="https://mitxela.com/projects/candle"
              >Tiny volumetric display</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-02 @ 12:23:05</span
              ><span class="points-container"
                >Points: <span class="points">1418</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38498109"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38497963">
          <h3>
            <a
              class="item"
              href="https://justcreative.com/why-do-everyones-logo-fonts-look-the-same/"
              >Why do everyone's logo fonts look the same? (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-02 @ 11:56:02</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38497963"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38497549">
          <h3>
            <a
              class="item"
              href="https://blog.research.google/2023/12/unsupervised-speech-to-speech.html"
              >Unsupervised speech-to-speech translation from monolingual
              data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-02 @ 10:24:07</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38497549"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
