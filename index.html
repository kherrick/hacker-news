<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39504715">
          <h3>
            <a class="item" href="https://nekoweb.org/"
              >Show HN: Nekoweb – a retro static web hosting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 21:03:14</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39504715"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39504703">
          <h3>
            <a
              class="item"
              href="https://christitus.com/microsoft-is-driving-users-away/"
              >Microsoft Is Driving Users Away</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 21:01:04</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39504703"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39504702">
          <h3>
            <a
              class="item"
              href="https://github.com/denkspuren/BitboardC4/blob/master/BitboardDesign.md"
              >Bitboards and Connect Four</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 21:01:03</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39504702"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39504470">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39504470"
              >Ask HN: How to Overcome the Trough of Sorrow?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 20:34:34</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39504470"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                But I am saddened by the fact that I invest hundreds, thousands
                of hours of my personal time, spent 5 000$ on testing,
                experiments with advertising, quit my job, worked fulltime for
                the last year - and still still never managed to earn. My result
                is only $200. Heck, in all 4 years. I want to live this life, to
                see the beauty of the world - but instead I spend my life
                working hard and trying to pluck a star from the sky. I want to
                finally live this life. To be free.
              </p>
              <p>
                I have a question for the community? Where do you find the
                strength to keep going? What keeps you going and energizes you?
                I'm tired of trying, the work seems endless. I am grateful for
                everyone's advice.
              </p>
            </div>
          </section>
        </section>
        <section id="39504266">
          <h3>
            <a
              class="item"
              href="https://hackneybooks.co.uk/books/364/686/Pleasures.html"
              >Pleasures by Aldous Huxley (1920)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 20:09:46</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39504266"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39504200">
          <h3>
            <a
              class="item"
              href="https://github.com/functional-ui/functional-ui-kit"
              >Show HN: Functional UI Kit – twin Figma and React component
              libraries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 19:58:33</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39504200"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                I started out in design and later got into coding, so I
                understand both sides really well. I did UX Design for 12 years
                at startups, at my own studio and at Wix, and then worked as a
                front-end dev at Wix for 2 more years.
              </p>
              <p>
                I've noticed a common problem: most component libraries work
                great for devs but not so well for designers.
              </p>
              <p>
                In my experience working with big teams, I've felt this
                frustration firsthand. Instead of focusing on making products,
                we end up arguing over small details and terms.
              </p>
              <p>
                In Functional UI Kit, each comp has dedicated story in
                Storybook. Copy pasting from Dev Mode in Figma just works, Figma
                variables and CSS variables match, auto Layout is mirroring the
                same box model structure &amp; the CSS architecture shields you
                from style collisions.
              </p>
              <p>
                It leverages all the latest Figma features to the MAX. Including
                the latest: Annotations, and of course: Dark Mode.
              </p>
              <p>I hope you try it and let me know what you think.</p>
            </div>
          </section>
        </section>
        <section id="39504072">
          <h3>
            <a
              class="item"
              href="https://frontendmasters.com/blog/console-delight/"
              >Console.delight</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 19:43:38</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39504072"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39503941">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39503941"
              >Ask HN: Fighting back against Roku's forced arbitration?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 19:30:27</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39503941"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>https://docs.roku.com/published/disputeresolution/en/us</p>
              <p>
                The new terms are obviously skewed entirely in Roku's favor.
                They say that consumers can't sue Roku in court and can't
                participate in class-action lawsuits.
              </p>
              <p>
                You can opt-out, a detail they conveniently omitted in the
                notification email, but it has to be in writing within 30 days.
              </p>
              <p>
                It irritates me that Roku and other corporations are allowed to
                force millions of customers into spending an hour or so to read
                these new terms and send a letter in the mail.
              </p>
              <p>
                Are there things that I can do as a consumer to fight back
                against this bad behavior by Roku? In the long term, I'll
                support candidates and federal bills that make forced
                arbitration illegal, but in the short term, what can I do to
                discourage this behavior by Roku and other companies?
              </p>
            </div>
          </section>
        </section>
        <section id="39503777">
          <h3>
            <a
              class="item"
              href="https://matthewrocklin.com/write-dumb-code.html"
              >Write Dumb Code (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 19:14:02</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39503777"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39503522">
          <h3>
            <a class="item" href="https://github.com/mozilla/readability"
              >Readability.js</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 18:48:15</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39503522"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39503193">
          <h3>
            <a class="item" href="https://altair-viz.github.io/index.html"
              >Vega-Altair: Declarative Visualization in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 18:12:31</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39503193"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39502433">
          <h3>
            <a class="item" href="https://patterns.app/"
              >Patterns (YC S21) is hiring to automate analytics with LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 17:01:01</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39502276">
          <h3>
            <a
              class="item"
              href="https://www.chiark.greenend.org.uk/~sgtatham/coroutines.html"
              >Coroutines in C (2000)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 16:45:03</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39502276"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39502165">
          <h3>
            <a
              class="item"
              href="https://pubs.acs.org/doi/10.1021/acsomega.2c07780"
              >Efficient recovery and recycling of cobalt from spent lithium-ion
              batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 16:33:21</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39502165"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39501982">
          <h3>
            <a
              class="item"
              href="https://www.kolaayonrinde.com/blog/2024/02/11/mamba.html"
              >Mamba Explained: The State Space Model Taking On Transformers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 16:16:17</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39501982"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39501469">
          <h3>
            <a
              class="item"
              href="https://bigmedium.com/ideas/design-system-pace-layers-slow-fast.html"
              >Ship faster by building design systems slower (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 15:22:39</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39501469"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39501281">
          <h3>
            <a class="item" href="https://osquery.io/"
              >Osquery: An sqlite3 virtual table exposing operating system data
              to SQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 14:58:51</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39501281"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39501262">
          <h3>
            <a class="item" href="https://github.com/ochadenas/cpudefense"
              >Chip Defense</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 14:56:46</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39501262"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39501073">
          <h3>
            <a class="item" href="https://usoldering.com/switch-lite/"
              >Show HN: Reverse-Engineering a Switch Lite with 1,917 wires</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 14:27:54</span
              ><span class="points-container"
                >Points: <span class="points">304</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39501073"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
            <div class="text">
              <p>
                Most public boardviews are almost entirely the result of
                industrial espionage, other than a few encrypted subscription
                based software platforms that provide extensive access. The
                process output is released as donationware, as my main concern
                is that even released as a low-cost purchase, there is a very
                strong culture to share this type of information at no cost. I
                would like to have a more sophisticated suggested donation
                system adaptive to user country, but I wasn't able to find a
                good solution.
              </p>
              <p>
                In terms of 'good startup ideas', I don't think this is one of
                them. The very high level of soldering skill required makes it
                difficult to scale, and the prevailing piracy culture makes it
                challenging to monetize. My main advantage is that costs are
                very low now that I have the entire thing working. Other than
                forge ahead at a loss and hope for the best, or to pivot hard
                leveraging the imaging technology, I'm not sure what other
                options I have. It feels too complicated and repetitive for
                shoft-form video content. If you have any feedback, questions,
                suggestions, etc., I'd love to hear them.
              </p>
            </div>
          </section>
        </section>
        <section id="39501061">
          <h3>
            <a
              class="item"
              href="https://www.marginalia.nu/log/a_101_marginalia-3-years/"
              >Marginalia: 3 Years</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 14:25:34</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39501061"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39500500">
          <h3>
            <a
              class="item"
              href="https://computer.rip/2024-02-11-the-top-of-the-DNS-hierarchy.html"
              >The Top of the DNS Hierarchy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 13:10:46</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39500500"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39500397">
          <h3>
            <a
              class="item"
              href="https://www.aspiring.dev/fly-io-scheduler-part-2/"
              >Building a Fly.io-like scheduler with resource requirements</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 12:53:00</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39500397"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39500263">
          <h3>
            <a
              class="item"
              href="https://thehustle.co/originals/why-you-almost-never-see-a-clock-at-the-mall"
              >You almost never see a clock at the mall</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 12:31:38</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39500263"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39499167">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2006/08/09/technology/09aol.html"
              >A Face Is Exposed for AOL Searcher No. 4417749 (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 09:22:54</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39499167"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39499055">
          <h3>
            <a
              class="item"
              href="https://blog.mattsbit.co.uk/2024/02/22/gitlab-ephemeral-environments-for-pull-requests/"
              >My attempt at Gitlab PR review environments with Nomad</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-25 @ 09:06:34</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39499055"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39496224">
          <h3>
            <a
              class="item"
              href="https://keymaterial.net/2024/02/24/lattices-vs-cranks/"
              >Lattices vs. Cranks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-24 @ 23:54:01</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39496224"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39496160">
          <h3>
            <a
              class="item"
              href="https://github.com/Dicklesworthstone/the_lighthill_debate_on_ai"
              >The Lighthill Debate on AI from 1973: An Introduction and
              Transcript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-24 @ 23:41:57</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39496160"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39490740">
          <h3>
            <a
              class="item"
              href="https://astrid.tech/2024/02/24/0/conda-recipe-selector-abuse/"
              >Abusing Conda's Turing-Complete YAML Comments</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-24 @ 11:14:31</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39490740"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39490075">
          <h3>
            <a
              class="item"
              href="https://kirbysayshi.com/2020/03/21/considering-then-abandoning-jsx-for-structured-yaml-config.html"
              >Considering then abandoning JSX for structured YAML config</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-24 @ 08:26:47</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39490075"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39483753">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/books/under-review/a-memoirist-who-told-everything-and-repented-nothing"
              >A memoirist who told everything and repented nothing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-23 @ 17:45:01</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39483753"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
