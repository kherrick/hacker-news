<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42390236">
          <h3>
            <a
              class="item"
              href="https://water.usgs.gov/nawqa/pnsp/features/feature.php"
              >Atrazine, an endocrine-disrupting herbicide banned in EU,still
              widely used in US</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 17:25:25</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42390236"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42389895">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/charge-robotics/jobs/ml4f9l4-senior-mechanical-engineer"
              >Charge Robotics (YC S21) is hiring MechEs to build robots that
              build solar farms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 17:00:41</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42389532">
          <h3>
            <a
              class="item"
              href="https://www.sifive.com/blog/hifive-premier-p550-development-boards-with-ubuntu"
              >RISC-V HiFive Premier P550 Development Boards with Ubuntu Now
              Available</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 16:33:56</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42389532"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42388973">
          <h3>
            <a class="item" href="https://pgroll.com/"
              >Pgroll – Zero-downtime, reversible, schema changes for PostgreSQL
              (new website)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 15:51:22</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42388973"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42388901">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/blog/products/compute/trillium-tpu-is-ga"
              >Trillium TPU Is GA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 15:44:58</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42388901"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42388783">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/google-deepmind/google-gemini-ai-update-december-2024/"
              >Gemini 2.0: our new AI model for the agentic era</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 15:33:54</span
              ><span class="points-container"
                >Points: <span class="points">274</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42388783"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42388665">
          <h3>
            <a class="item" href="https://dioxuslabs.com/blog/release-060/"
              >Dioxus 0.6 – Crossplatform apps with Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 15:24:10</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42388665"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42388488">
          <h3>
            <a class="item" href="https://joinpeertube.org/news/peertube-app"
              >PeerTube mobile app: discover videos while caring for your
              attention</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 15:09:56</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42388488"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42388354">
          <h3>
            <a class="item" href="https://calebhearth.com/dont-get-distracted"
              >Don't Get Distracted</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 14:57:25</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42388354"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42388340">
          <h3>
            <a
              class="item"
              href="https://andyatkinson.com/django-python-postgres-busy-rails-developer"
              >Django and Postgres for the Busy Rails Developer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 14:56:29</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42388340"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42388273">
          <h3>
            <a
              class="item"
              href="https://www.scimex.org/newsfeed/being-overweight-overtakes-tobacco-smoking-as-the-leading-disease-risk-factor-in-2024"
              >Overweight overtakes tobacco smoking as the leading disease risk
              factor in 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 14:51:08</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42388273"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42388109">
          <h3>
            <a
              class="item"
              href="https://medium.com/graalvm/machine-learning-driven-static-profiling-for-native-image-d7fc13bb04e2"
              >Machine Learning-Driven Static Profiling for GraalVM Native
              Image</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 14:36:20</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42388109"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42388009">
          <h3>
            <a
              class="item"
              href="https://cowfreedom.de/#dot_product/introduction/"
              >The GPU is not always faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 14:28:42</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42388009"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42387519">
          <h3>
            <a class="item" href="https://github.com/marverix/gah"
              >Gah – CLI to install software from GitHub Releases</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 13:35:49</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42387519"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42387013">
          <h3>
            <a
              class="item"
              href="https://developers.redhat.com/articles/2024/12/11/making-memcpynull-null-0-well-defined"
              >Making memcpy(NULL, NULL, 0) well-defined</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 12:19:12</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42387013"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42386971">
          <h3>
            <a class="item" href="https://github.com/mherrmann/helium"
              >Helium: Lighter Web Automation with Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 12:11:28</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42386971"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42386025">
          <h3>
            <a
              class="item"
              href="https://www.ntietz.com/blog/evolving-ergo-setup/"
              >Evolving my ergonomic setup (or, my laptop with extra steps)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 08:56:50</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42386025"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42384921">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/12/10/business/media/the-onion-infowars-alex-jones.html"
              >Judge Refuses to Allow Sale of Infowars to The Onion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 04:53:54</span
              ><span class="points-container"
                >Points: <span class="points">367</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42384921"
                  >Comments</a
                ><span class="descendants">: 481</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42384768">
          <h3>
            <a
              class="item"
              href="https://gilkalai.wordpress.com/2024/12/09/the-case-against-googles-claims-of-quantum-supremacy-a-very-short-introduction/"
              >The Case Against Google's Claims of "Quantum Supremacy"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 04:22:10</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42384768"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42383136">
          <h3>
            <a
              class="item"
              href="https://electric-sql.com/blog/2024/12/10/electric-beta-release"
              >Electric (Postgres sync engine) beta release</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 00:04:41</span
              ><span class="points-container"
                >Points: <span class="points">277</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42383136"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42381637">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/12/10/gm-halts-funding-of-robotaxi-development-by-cruise.html"
              >GM exits robotaxi market, will bring Cruise operations in
              house</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 21:19:22</span
              ><span class="points-container"
                >Points: <span class="points">367</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42381637"
                  >Comments</a
                ><span class="descendants">: 548</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42378488">
          <h3>
            <a class="item" href="https://antirez.com/news/144"
              >From where I left</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 16:41:52</span
              ><span class="points-container"
                >Points: <span class="points">1112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42378488"
                  >Comments</a
                ><span class="descendants">: 408</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42377018">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42377018"
              >Launch HN: Double (YC W24) – Index Investing with 0% Expense
              Ratios</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 14:16:54</span
              ><span class="points-container"
                >Points: <span class="points">396</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42377018"
                  >Comments</a
                ><span class="descendants">: 391</span></span
              >
            </h4>
            <div class="text">
              <a href="https://double.finance">https://double.finance</a>).
              Double lets you invest in 50+ broad stock market indexes with 0%
              expense ratios. We handle all the management, including
              rebalancing and tax-loss harvesting—proactively selling losing
              stocks to potentially save on taxes—for $1/month.
              <p>
                Our goal is to bring the low fee trend pioneered by Robinhood to
                ETFs and mutual funds. We posted a Show HN about 3 months ago
                (<a href="https://news.ycombinator.com/item?id=41246686"
                  >https://news.ycombinator.com/item?id=41246686</a
                >) and since then have crossed $10M in AUM (Assets Under
                Management) [1].
              </p>
              <p>
                Here’s a demo video:
                <a
                  href="https://www.loom.com/share/10c9150ce4114f278e8c249f211e7ec8"
                  >https://www.loom.com/share/10c9150ce4114f278e8c249f211e7ec8</a
                >. Please note that none of this content should be treated as
                financial advice.
              </p>
              <p>
                Everyone knows that fees eat into your investing returns.
                Financial advisors generally charge 1% of AUM per year, and ETFs
                have a weighted average expense ratio of about 0.17%, although
                some go as low as 0.03% for VOO. Over a 30-year period on a
                $500k portfolio with $2k invested monthly, the money lost to
                those fees would be $1.30M for the financial advisor and $244k
                for the average ETF and even $42,951 for the low fee VOO.
              </p>
              <p>
                Double lets you index invest without paying any percentage-based
                fees - we charge just $1/month. It works by buying the
                individual stocks that make up popular indexes. By buying the
                individual positions, we can also customize and tax-loss harvest
                your account, something ETFs or Mutual Funds cannot do.
              </p>
              <p>
                Most ETFs and mutual funds today are not that complicated - they
                can be expressed as a CSV file with 2 columns - a ticker and a
                share number. You can find these holding csv files on most ETF
                pages (VOO[2], QQQ[3]). Right now there are about $9.1T of
                assets in ETFs[4] and $20T in Mutual Funds[5] in the US, with
                estimated revenue of $100B per year. We think this market is
                ripe for disruption.
              </p>
              <p>
                We offer 50+ strategies that track popular ETFs and are updated
                as stocks merge and indexes change. You can customize these by
                weighting sectors or stocks differently, or even build your own
                indexes from scratch using our stock/etf screening tools. Once
                you've chosen your strategy, simply set your target weights and
                deposit funds (we also support transferring existing stocks).
                Our engine then checks your portfolio daily for potential
                trades, optimizes for tax-loss harvesting, portfolio tracking,
                and redeploys any generated cash.
              </p>
              <p>
                I (JJ) started working on this after selling my last company.
                After using nearly every brokerage product out there and working
                with a financial advisor, I noticed a huge gap between the
                indexing capabilities of financial advisors and what individual
                investors could access. We wanted to bridge that gap and provide
                these powerful tools to everyone in a simple, low-cost way.
              </p>
              <p>
                There are a number of robo-advisor products out there, but none
                that we know of offer direct indexing without expense ratios or
                AUM fees. One similar product is M1 Finance, but Double is more
                powerful. We offer tax-loss harvesting, a wider range of
                indexes, and greater customization. For example, when building
                your own index, you can set weights down to 0.1% (compared to
                M1's 1%) and even weight by market cap.
              </p>
              <p>
                We also compete with robo-advisors like Wealthfront, but offer
                more control over your investments. And did I mention we don't
                charge AUM fees? You can see our strategies and play with the
                research page
                <a href="https://double.finance/p/explore"
                  >https://double.finance/p/explore</a
                >
                without creating an account.
              </p>
              <p>
                Over the past year we’ve learned a lot about the guts of
                building portfolio software. For example, stocks don’t really
                have persistent identifiers that are easy to model and pass
                around. We trade CUSIPs with our custodian Apex*, but these
                change all the time for stock splits or re-org’s that you would
                not think would lead to a new “stock”.
              </p>
              <p>
                We’ve also learned a lot about how tax loss harvesting (TLH) is
                best implemented on large direct index portfolios using a factor
                model as opposed to pairs based replacements which I initially
                thought might be the way to execute these. We do use a pairs
                strategy on smaller sized strategies. And how TLH and portfolio
                optimization generally is best expressed as a linear
                optimization problem with competing objectives (tracking vs. tax
                alpha vs. trading costs for example).
              </p>
              <p>
                If you have any thoughts on the product or our positioning as
                the low fee alternative I’d love to hear it. I think Robinhood
                has proved that you can build a strong business by getting rid
                of an industry wide cost (in their case commissions, in our
                expense ratios). We aim to do the same.
              </p>
              <p>
                [1]
                <a
                  href="https://www.axios.com/pro/fintech-deals/2024/12/10/direct-indexing-platform-double-finance-raises-seed?utm_source=editorial&amp;utm_medium=social&amp;utm_campaign=pro_edit_regwall_01-24&amp;utm_term=regwall"
                  >https://www.axios.com/pro/fintech-deals/2024/12/10/direct-in...</a
                >
                [2]
                <a
                  href="https://investor.vanguard.com/investment-products/etfs/profile/voo#portfolio-composition"
                  >https://investor.vanguard.com/investment-products/etfs/profi...</a
                >
                [3]
                <a href="https://www.invesco.com/qqq-etf/en/about.html"
                  >https://www.invesco.com/qqq-etf/en/about.html</a
                >
                [4]
                <a href="https://fred.stlouisfed.org/series/BOGZ1LM564090005Q"
                  >https://fred.stlouisfed.org/series/BOGZ1LM564090005Q</a
                >
                [5]
                <a href="https://fred.stlouisfed.org/series/BOGZ1LM654090000Q"
                  >https://fred.stlouisfed.org/series/BOGZ1LM654090000Q</a
                >
              </p>
              <p>
                * Edit to add a note on risk: If Double goes out of business,
                your assets are safe and held in your name at Apex Clearing.
                They have processes in place for these scenarios to help you
                access and transfer those assets. See more at
                <a href="https://news.ycombinator.com/item?id=42379135"
                  >https://news.ycombinator.com/item?id=42379135</a
                >
                below.
              </p>
            </div>
          </section>
        </section>
        <section id="42366753">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2024/how-whatsapp-for-business-changed-the-world/"
              >WhatsApp for Business Changed the World</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 14:57:01</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42366753"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42358214">
          <h3>
            <a
              class="item"
              href="https://worldhistory.substack.com/p/the-myth-of-bananaland"
              >The Myth of Bananaland: The Marketing and Reality of the United
              Fruit Company</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-08 @ 16:58:48</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42358214"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42357377">
          <h3>
            <a
              class="item"
              href="https://www.sapiens.org/culture/smartphones-cyborgs-phantom-limb/"
              >Phantom Vibrations of a Lost Smartphone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-08 @ 14:39:28</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42357377"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42357272">
          <h3>
            <a
              class="item"
              href="https://www.johndcook.com/blog/2024/12/03/bi-elliptic-transfer/"
              >Bi-elliptic transfer orbit maneuver</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-08 @ 14:16:38</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42357272"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42348716">
          <h3>
            <a class="item" href="https://github.com/Fajar-RahmadJaya/KeyTik"
              >Show HN: KeyTik: The All-in-One Automation Tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-07 @ 10:19:50</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42348716"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42348655">
          <h3>
            <a class="item" href="https://odinbook.com/"
              >Understanding the Odin Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-07 @ 10:08:34</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42348655"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42347571">
          <h3>
            <a
              class="item"
              href="https://filmstories.co.uk/features/we-all-took-the-dvd-boom-era-for-granted/"
              >We all took the DVD boom era for granted</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-07 @ 05:45:25</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42347571"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
