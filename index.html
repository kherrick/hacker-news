<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41612669">
          <h3>
            <a
              class="item"
              href="https://undeadly.org/cgi?action=article;sid=20240921181110"
              >OpenSSH 9.9 Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 21:04:52</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41612669"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41612641">
          <h3>
            <a class="item" href="https://grnh.se/d034f1ba5us"
              >Substack (YC W18) Is Hiring Machine Learning Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 21:00:41</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41612367">
          <h3>
            <a
              class="item"
              href="https://www.legalreader.com/tetris-game-shows-promise-in-reducing-ptsd-symptoms/"
              >Tetris Game Shows Promise in Reducing PTSD Symptoms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 20:09:54</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41612367"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41612334">
          <h3>
            <a class="item" href="https://lee-phillips.org/pluckit/#v0.2"
              >A plucked string simulator using Julia</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 20:03:40</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41612334"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41612254">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/health/2024/09/17/opioid-epidemic-purdue-pharma-family-mundipharma-global/"
              >In the US opioid-maker Purdue is bankrupt. Its global
              counterparts make millions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 19:54:15</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41612254"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41612154">
          <h3>
            <a class="item" href="https://blog.jim-nielsen.com/2024/sanding-ui/"
              >Sanding UI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 19:36:20</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41612154"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41612126">
          <h3>
            <a
              class="item"
              href="https://www.nextgov.com/artificial-intelligence/2024/09/house-representatives-adopts-baseline-policy-ai-use/399710/"
              >US House of Representatives adopts baseline policy for AI use</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 19:31:53</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41612126"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41612049">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/what-is-a-particle-20201112/"
              >What Is a Particle? (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 19:20:34</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41612049"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41612002">
          <h3>
            <a
              class="item"
              href="https://modern-json-schema.com/analyzing-the-openapi-tooling-ecosystem"
              >Analyzing the OpenAPI Tooling Ecosystem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 19:13:41</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41612002"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41611965">
          <h3>
            <a
              class="item"
              href="https://www.allaboutcircuits.com/news/infineons-co2-sensor-precisely-monitors-indoor-air-quality/"
              >Infineon's CO2 Sensor Monitors Indoor Air Quality</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 19:08:50</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41611965"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41611948">
          <h3>
            <a
              class="item"
              href="https://raymii.org/s/software/Logging_all_Cpp_destructors_poor_mans_run-time_tracing.html"
              >Logging all C++ destructors, poor mans run-time tracing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 19:06:31</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41611948"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41611681">
          <h3>
            <a
              class="item"
              href="https://ess.r-project.org/index.php?Section=home"
              >Emacs Speaks Statistics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 18:20:26</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41611681"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41611613">
          <h3>
            <a
              class="item"
              href="https://home.cern/news/press-release/physics/lhc-experiments-cern-observe-quantum-entanglement-highest-energy-yet"
              >LHC experiments at CERN observe quantum entanglement at the
              highest energy yet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 18:09:05</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41611613"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41611571">
          <h3>
            <a class="item" href="https://web.mit.edu/15.053/www/AMP.htm"
              >Applied Mathematical Programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 18:00:57</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41611571"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41611356">
          <h3>
            <a
              class="item"
              href="https://blog.coffinsec.com/0day/2024/08/30/exploiting-CVE-2024-20017-four-different-ways.html"
              >4 Exploits, 1 bug: exploiting cve-2024-20017 4 different ways</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 17:26:12</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41611356"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41610619">
          <h3>
            <a
              class="item"
              href="https://www.psypost.org/omega-3-fatty-acid-intake-counteracts-symptoms-of-stress-induced-anxiety-and-depression-in-mice/"
              >Omega-3 intake counteracts symptoms of anxiety and depression in
              mice</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 15:31:33</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41610619"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41610441">
          <h3>
            <a class="item" href="https://github.com/BitlyTwiser/zdotenv"
              >Zdotenv – Dotenv Loader for Zig</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 15:03:03</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41610441"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41609694">
          <h3>
            <a
              class="item"
              href="https://socialcommunication.truman.edu/attitudes-emotions/social-initiation/"
              >Social Initiation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 13:01:07</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41609694"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41609670">
          <h3>
            <a
              class="item"
              href="https://research.google/blog/scaling-up-linear-programming-with-pdlp/"
              >Scaling up linear programming with PDLP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 12:57:11</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41609670"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41609491">
          <h3>
            <a
              class="item"
              href="https://github.com/PuellaeMagicae/unix-in-lisp/blob/master/TUTORIAL.org"
              >Mount Unix system into Common Lisp image</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 12:18:55</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41609491"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41609393">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-02998-y"
              >Forget ChatGPT: why researchers now run small AIs on their
              laptops</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 11:52:15</span
              ><span class="points-container"
                >Points: <span class="points">387</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41609393"
                  >Comments</a
                ><span class="descendants">: 236</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41608648">
          <h3>
            <a
              class="item"
              href="https://www.rijksmuseum.nl/en/stories/operation-night-watch/story/ultra-high-resolution-image-of-the-night-watch"
              >Ultra high-resolution image of The Night Watch (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 09:08:20</span
              ><span class="points-container"
                >Points: <span class="points">432</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41608648"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41608350">
          <h3>
            <a class="item" href="https://github.com/basecamp/kamal-proxy"
              >Kamal Proxy – A minimal HTTP proxy for zero-downtime
              deployments</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 07:55:41</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41608350"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41608333">
          <h3>
            <a class="item" href="https://eshelyaron.com/kubed.html"
              >Kubed (Emacs-based Kubernetes interface) user manual, now with
              pretty images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 07:52:51</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41608333"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41608025">
          <h3>
            <a
              class="item"
              href="https://www.androidauthority.com/fcc-60-day-unlock-tmo-3483642/"
              >FCC wants all phones unlocked in sixty days, AT&amp;amp;T and
              T-Mobile aren't so keen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 06:52:22</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41608025"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41607781">
          <h3>
            <a
              class="item"
              href="https://johncarlosbaez.wordpress.com/2024/09/20/the-gravo-thermal-catastrophe/"
              >The Gravo-Thermal Catastrophe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 05:45:48</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41607781"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41578825">
          <h3>
            <a
              class="item"
              href="https://betterstack.com/community/guides/observability/opentelemetry-collector/"
              >A Beginner's Guide to the OpenTelemetry Collector</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-18 @ 12:21:55</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41578825"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41576956">
          <h3>
            <a class="item" href="https://github.com/pg-nano/pg-parser"
              >Show HN: Parse your Postgres queries into a fully-typed AST in
              TypeScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-18 @ 07:49:34</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41576956"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                1. Each CREATE statement needs to be in topological order, so
                pg-nano's dev command can execute them without issue.
              </p>
              <p>
                2. pg-nano has a plugin system like Vite that allows SQL
                generation based on the parsed schema.
              </p>
              <p>
                Probably to the surprise of no one, working with an untyped AST
                feels like you're back in the days of JavaScript, because
                well... you are. Most of you know by now just how great
                TypeScript and static types in general are, especially if you
                appreciate SQL.
              </p>
              <p>So why is this project worth sharing with you?</p>
              <p>
                Well, writing the AST type definitions by hand would have taken
                me way too much time. It would also be a bear to keep up-to-date
                as Postgres continues to evolve.
              </p>
              <p>
                To my surprise, I discovered that libpg_query, the C library
                used under-the-hood, includes JSON definitions in their
                /srcdata/ folder. I figured I could use them to
                <i>generate</i> the type definitions. Genius, right? Okay...
                maybe not <i>genius</i>, but still cool, I think.
              </p>
              <p>
                You see, those JSON definitions provided by libpg_query? They
                don't exactly contain the TypeScript definitions (was that
                obvious?). No, no. I had to <i>translate</i> them into
                TypeScript definitions. (I'm sure <i>you</i> could have done it,
                yes yes. But did you? No siree bob)
              </p>
              <p>
                It was pain-staking, but overall really not too hard.
                Time-consuming? Yes, but not as much as writing the type
                definitions by hand. So... was it worth it? Only time will tell.
                I hope you find it as useful as I do. And that's all I've got,
                so thanks for reading.
              </p>
              <p>
                P.S. The build for Windows is broken, so if anyone could lend a
                hand, you would be a true hero.
              </p>
              <p>
                [1]:
                <a href="https://github.com/pg-nano/pg-nano"
                  >https://github.com/pg-nano/pg-nano</a
                >
                (not ready for production use)
              </p>
            </div>
          </section>
        </section>
        <section id="41575867">
          <h3>
            <a
              class="item"
              href="https://www.gq.com/story/the-miraculous-resurrection-of-notre-dame"
              >The Miraculous Resurrection of Notre-Dame</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-18 @ 04:41:26</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41575867"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41573198">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cgmgg493ek8o"
              >Scientists find new blood group after 50-year mystery</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-17 @ 21:47:05</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41573198"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
