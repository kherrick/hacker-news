<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36945578">
          <h3>
            <a
              class="item"
              href="https://nypost.com/2023/07/31/paul-reubens-dead-pee-wee-herman-actor-was-70/"
              >Paul Reubens dead: Pee-wee Herman actor was 70</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 17:01:32</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36945578"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36945559">
          <h3>
            <a class="item" href="https://www.easypost.com/careers"
              >EasyPost (YC S13) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 17:00:28</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36945206">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=Tuzh9mHvzkk"
              >Building Nikola Tesla's Bladeless Turbine [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 16:37:34</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36945206"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36945177">
          <h3>
            <a
              class="item"
              href="https://eighty-twenty.org/2023/07/31/dns-as-a-cdn"
              >Show HN: File distribution over DNS: (ab)using DNS as a CDN</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 16:35:54</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36945177"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36945046">
          <h3>
            <a
              class="item"
              href="https://github.com/coding-horror/basic-computer-games"
              >A repository of “BASIC Computer Games” code in modern
              languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 16:26:50</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36945046"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36944978">
          <h3>
            <a
              class="item"
              href="https://news.ku.dk/all_news/2023/07/pay-dirt-for-ice-core-scientists-in-east-greenland-as-they-reach-bedrock/"
              >Researchers reached the bottom of ice sheet at -2670m after 7
              years of drilling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 16:22:28</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36944978"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36944947">
          <h3>
            <a
              class="item"
              href="https://www.vulture.com/2017/10/why-is-blade-runner-the-title-of-blade-runner.html"
              >Digging into the Odd History of Blade Runner’s Title</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 16:20:46</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36944947"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36944545">
          <h3>
            <a class="item" href="https://www.spicyweb.dev/farewell-jamstack/"
              >My Journey Away from the JAMstack</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 15:55:03</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36944545"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36944388">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36944388"
              >Ask HN: How do you monitor your systemd services?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 15:45:31</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36944388"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>Send a notifcation via notify-send</p>
              <p>Add `systemctl --failed` to my shell startup script</p>
              <p>Send myself emails</p>
              <p>
                None of these are quite ideal. Notifications are disruptive of
                the current workflow and ephemeral, meaning I might forget about
                it if I don't deal with it immediately. Similarly, reading
                `systemctl --failed` on every new terminal is also disruptive
                but at least it makes me not forget about it. Both of these are
                also not really applicable to server systems. Sending myself
                emails feels a bit wrong but has so far been the best solution.
              </p>
              <p>
                How are other people solving this? I did some research and I am
                surprised that there isn't a more rounded solution. I'd expect
                that pretty much every Linux user must run into this problem.
              </p>
            </div>
          </section>
        </section>
        <section id="36944223">
          <h3>
            <a
              class="item"
              href="https://www.baldurbjarnason.com/2023/the-floss-transition/"
              >Free and open source software projects are in transition</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 15:36:04</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36944223"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36944077">
          <h3>
            <a
              class="item"
              href="https://abroaden.substack.com/p/the-strange-way-airlines-are-actually"
              >The strange way airlines are actually central banks (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 15:27:13</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36944077"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36943866">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/rd/blog/2023-07-mastodon-distributed-decentralised-fediverse-activitypub"
              >BBC on Mastodon: experimenting with distributed and decentralised
              social media</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 15:15:06</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36943866"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36943495">
          <h3>
            <a
              class="item"
              href="https://www.sec.gov/news/press-release/2023-143"
              >SEC Charges Hex Founder Richard Heart with Misappropriating
              Millions of Dollars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 14:53:17</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36943495"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36943415">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-07-31/investors-are-happy-to-pay-premium-for-tech-but-not-for-ai"
              >Investors are happy to pay premium for tech, but not for AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 14:48:23</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36943415"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36943318">
          <h3>
            <a
              class="item"
              href="https://navidre.medium.com/which-vector-database-should-i-use-a-comparison-cheatsheet-cb330e55fca"
              >Comparison of vector databases</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 14:42:41</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36943318"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36943317">
          <h3>
            <a class="item" href="https://blog.dvsj.in/hashing/"
              >What's Hashing? (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 14:42:40</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36943317"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36942967">
          <h3>
            <a class="item" href="https://www.alanshawn.com/latex3-tutorial/"
              >LaTeX3: Programming in LaTeX with Ease (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 14:23:59</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36942967"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36942651">
          <h3>
            <a
              class="item"
              href="https://engineering.mercari.com/en/blog/entry/20230731-x86-is-dead-long-live-x86/"
              >x86 is dead, long live x86</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 14:05:25</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36942651"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36942526">
          <h3>
            <a
              class="item"
              href="https://aster.cloud/2023/06/16/happy-30th-freebsd-why-the-freebsd-open-source-project-has-endured/"
              >Happy 30th FreeBSD: Why FreeBSD open source project has
              endured</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 13:56:34</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36942526"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36942308">
          <h3>
            <a class="item" href="https://linkwarden.app"
              >Show HN: Linkwarden – An open source collaborative bookmark
              manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 13:41:21</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36942308"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <p>Please also visit/star our GitHub repo [1].</p>
              <p>
                Linkwarden was built using TypeScript and NextJS, backed by a
                PostgreSQL database for the lighter-weight data. The rest of the
                data can be chosen either to be stored on the filesystem, or
                stored on the cloud on Digital Ocean Space/AWS S3, the reason
                for the cloud storage solution was for the Cloud offering [2],
                we realized that the preserved webpages (archives) take up space
                pretty quickly and S3 was much more efficient for this task. On
                the front-end we used TailwindCSS for styling and Zustand for
                state management.
              </p>
              <p>
                You could either use our Cloud offering (with 14-day free trial)
                to directly support this project and experience Linkwarden, or
                you could self-host it on your own machine and have maximum
                flexibility.
              </p>
              <p>
                Feel free if you had any questions, we'll do our best to answer
                it.
              </p>
              <p>
                [1]:
                <a href="https://github.com/linkwarden/linkwarden"
                  >https://github.com/linkwarden/linkwarden</a
                >
              </p>
              <p>
                [2]:
                <a href="https://cloud.linkwarden.app/register"
                  >https://cloud.linkwarden.app/register</a
                >
                - Hosted in Digital Ocean's datacenter located here in Toronto,
                ON.
              </p>
            </div>
          </section>
        </section>
        <section id="36942166">
          <h3>
            <a
              class="item"
              href="https://archive.org/details/Cards_as_Weapons_-_Ricky_Jay_1977"
              >Cards as Weapons (1977)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 13:28:35</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36942166"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36942033">
          <h3>
            <a class="item" href="https://ianthehenry.com/posts/fibonacci/"
              >The Fibonacci Matrix</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 13:14:32</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36942033"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36941299">
          <h3>
            <a class="item" href="https://zknill.io/posts/edge-database/"
              >So, you want to deploy on the edge?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 11:54:00</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36941299"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36940916">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Alpine-Linux-Prolific-Packager"
              >The Most Prolific Packager for Alpine Linux Is Stepping Away</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 11:01:45</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36940916"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36940871">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36940871"
              >Ask HN: Is anyone using PyPy for real work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 10:53:38</span
              ><span class="points-container"
                >Points: <span class="points">425</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36940871"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
            <div class="text">
              <p>
                [0]
                <a href="https://www.pypy.org/contact.html"
                  >https://www.pypy.org/contact.html</a
                >
                [1]
                <a
                  href="https://www.pypy.org/posts/2022/11/pypy-and-conda-forge.html"
                  >https://www.pypy.org/posts/2022/11/pypy-and-conda-forge.html</a
                >
                [2]
                <a href="https://www.pypy.org/download.html"
                  >https://www.pypy.org/download.html</a
                >
                [3]
                <a href="https://www.pypy.org/contact.html"
                  >https://www.pypy.org/contact.html</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36940626">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/07/31/nasa_mistakenly_disconnects_voyager_2/"
              >NASA mistakenly severs communication to Voyager 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 10:15:50</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36940626"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36939145">
          <h3>
            <a class="item" href="https://www.learnlingo.dev"
              >Show HN: LearnLingo – Converse with an AI-powered language
              tutor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 05:36:47</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36939145"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've always found that the hardest part of learning a new
                language is finding someone to actually converse with. Even if a
                partner can be found, the pressure can mean that you are more
                focused on not making mistakes than on actually learning new
                grammar or vocabulary.
              </p>
              <p>
                The service that I have been working on allows you to practice
                with a language tutor via online chat messages, or you can have
                a turn-based voice conversation.
              </p>
              <p>
                I'm working on a number of other features that will be coming
                out shortly, including a few games for practising pronunciation
                and listening skills, as well as a plan to release some lesson
                plans for specific languages later on.
              </p>
              <p>Have a try, and let me know if you have any feedback!</p>
            </div>
          </section>
        </section>
        <section id="36934963">
          <h3>
            <a
              class="item"
              href="https://theamericanscholar.org/dont-forget-intuition/"
              >Don’t Forget Intuition: The art of doing science</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 19:24:52</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36934963"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36933512">
          <h3>
            <a class="item" href="https://explained.ai/matrix-calculus/"
              >The Matrix Calculus You Need for Deep Learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:18:12</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36933512"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36928605">
          <h3>
            <a
              class="item"
              href="https://www.imperialviolet.org/2023/07/29/voice-recognition.html"
              >Voice Recognition</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 07:03:47</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36928605"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
