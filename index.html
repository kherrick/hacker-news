<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39604745">
          <h3>
            <a
              class="item"
              href="https://www.cgchannel.com/2024/02/open-source-project-zluda-lets-cuda-apps-run-on-amd-gpus/"
              >Open-source project ZLUDA lets CUDA apps run on AMD GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 15:36:27</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39604745"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39604652">
          <h3>
            <a
              class="item"
              href="https://woodfromeden.substack.com/p/parent-shaming-causes-the-demographic"
              >Parent shaming causes the demographic collapse</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 15:31:49</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39604652"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39604590">
          <h3>
            <a class="item" href="https://downdetector.com/status/facebook/"
              >Facebook Offline</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 15:27:43</span
              ><span class="points-container"
                >Points: <span class="points">249</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39604590"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39603518">
          <h3>
            <a
              class="item"
              href="https://arbital.com/p/likelihoods_not_pvalues/?l=4xx"
              >Likelihood functions, p-values, and the replication crisis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 14:01:35</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39603518"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39603163">
          <h3>
            <a
              class="item"
              href="https://leaddev.com/team/generative-ai-and-widening-software-developer-knowledge-gap"
              >Generative AI and the widening software developer knowledge
              gap</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 13:34:06</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39603163"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39602472">
          <h3>
            <a class="item" href="https://shenlanguage.org/"
              >The Shen Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 12:30:22</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39602472"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39602343">
          <h3>
            <a class="item" href="https://jasongriffey.net/librarybox/"
              >LibraryBox</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 12:12:48</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39602343"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39602023">
          <h3>
            <a class="item" href="https://blog.cloudflare.com/firewall-for-ai"
              >Cloudflare Announces Firewall for AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 11:26:39</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39602023"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39601710">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2207.08815"
              >Why do tree-based models still outperform deep learning on
              tabular data? (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 10:44:01</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39601710"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39601201">
          <h3>
            <a class="item" href="http://libraryofjuggling.com/"
              >Library of Juggling</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 09:34:35</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39601201"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39600810">
          <h3>
            <a
              class="item"
              href="https://app.radicle.xyz/nodes/seed.radicle.garden/rad:z3gqcJUoA1n9HaHKufZs5FCSGazv5"
              >Radicle: Open-Source, Peer-to-Peer, GitHub Alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 08:39:10</span
              ><span class="points-container"
                >Points: <span class="points">452</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39600810"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39600031">
          <h3>
            <a class="item" href="https://github.com/ortuman/nuke"
              >Nuke: A memory arena implementation for Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 06:22:03</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39600031"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39599958">
          <h3>
            <a
              class="item"
              href="https://stability.ai/news/stable-diffusion-3-research-paper"
              >Stable Diffusion 3: Research Paper</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 06:05:05</span
              ><span class="points-container"
                >Points: <span class="points">283</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39599958"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39599175">
          <h3>
            <a class="item" href="https://nullprogram.com/blog/2024/03/05/"
              >Protecting paths in macro expansions by extending UTF-8</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 03:43:23</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39599175"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39598903">
          <h3>
            <a
              class="item"
              href="https://www.fundablestartups.com/blog/half-a-billion"
              >Sell for half a billion and get nothing (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 02:47:59</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39598903"
                  >Comments</a
                ><span class="descendants">: 248</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39598189">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/cars/2024/03/carmakers-must-bring-back-buttons-to-get-good-safety-scores-in-europe/"
              >European crash tester says carmakers must bring back physical
              controls</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 01:02:57</span
              ><span class="points-container"
                >Points: <span class="points">876</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39598189"
                  >Comments</a
                ><span class="descendants">: 548</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39598170">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/codecrafters/jobs/M2ELjtC-influencer-partnerships-manager"
              >CodeCrafters (YC S22) is hiring an influencer manager (interns
              welcome)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 01:00:08</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39597525">
          <h3>
            <a
              class="item"
              href="https://www.esquire.com/entertainment/music/a46871755/james-kaplan-miles-davis-3-shades-of-blue-excerpt/"
              >Miles Davis and the recording of Kind of Blue</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 23:22:47</span
              ><span class="points-container"
                >Points: <span class="points">228</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39597525"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39597131">
          <h3>
            <a
              class="item"
              href="https://www.bytesizego.com/blog/keeping-alive-with-go"
              >How I keep myself alive using Golang</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 22:42:04</span
              ><span class="points-container"
                >Points: <span class="points">584</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39597131"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39597030">
          <h3>
            <a class="item" href="https://github.com/HeyPuter/puter"
              >Show HN: 3 years and 1M users later, I just open-sourced my
              "Internet OS"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 22:31:15</span
              ><span class="points-container"
                >Points: <span class="points">1010</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39597030"
                  >Comments</a
                ><span class="descendants">: 255</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39592444">
          <h3>
            <a class="item" href="https://www.hillelwayne.com/post/graph-types/"
              >The hunt for the missing data type</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 16:42:14</span
              ><span class="points-container"
                >Points: <span class="points">607</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39592444"
                  >Comments</a
                ><span class="descendants">: 220</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39591972">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39591972"
              >Launch HN: Just words (YC W24) – Optimize your product's copy for
              user growth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 16:03:45</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39591972"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
            <div class="text">
              <a href="https://justwords.ai">https://justwords.ai</a>). We help
              companies gain users through product copy optimization across any
              app surface or webpage, using inferences from past performance
              data. Here’s a demo video:
              <a href="https://youtu.be/e6PuRzHad7M"
                >https://youtu.be/e6PuRzHad7M</a
              >, and a live playground:
              <a href="https://justwords.ai/live-demo"
                >https://justwords.ai/live-demo</a
              >.
              <p>
                “Copy” in this context means short-form content such as landing
                page titles or email subject lines. Small and seemingly
                insignificant changes to these can lead to massive growth gains.
                We observed this on many occasions while working at Twitter.
                Tweaking a push notification copy from “Jack tweeted” to “Jack
                just Tweeted” brought 800K additional users to Twitter.
              </p>
              <p>
                However, coming up with the copy, testing it, and optimizing
                different variants across users would take us forever—sometimes
                months. There was no methodical way to optimize copy on the fly
                and use what we learned for subsequent iterations. The entire
                process was managed ad hoc in docs and spreadsheets.
              </p>
              <p>
                After experiencing this pain at Twitter, we observed the same
                problem at other companies like Reddit. After years of this, we
                are convinced that there’s enough evidence for this pain across
                the industry.
              </p>
              <p>
                In our experience, the main challenges with copy optimization
                are:
              </p>
              <p>
                Engineering effort: Copies are hard-coded, either in code or
                config files. Every small change requires redeployment of the
                app. To run an A/B test, engineers must write if/else logic for
                each variant. As a result, one copy optimization becomes a
                2-week project on an engineer’s roadmap, and companies are only
                able to prioritize a small number of changes a year.
              </p>
              <p>
                Fragmented content: There is no copy repository, so companies
                lose track of the history of changes on a particular string,
                learnings from past experiments, and their occurrences across
                the product. With no systematic view, product teams make copy
                changes based on “vibes”. There is no way to fine-tune next
                iterations based on patterns obtained from previous experiments.
              </p>
              <p>
                Lack of context: Companies either test 1 copy change at a time
                for all users, or rotate a pool of copies randomly. In an ideal
                world, they should be able to present the best copy to different
                users based on their context.
              </p>
              <p>
                We built Just Words to solve these problems through 3 main
                features:
              </p>
              <p>
                No-code copy experimentation: You can change any copy, A/B test
                it, and ship it to production with zero code changes. All copy
                changes made in our UI get published to a dynamic config system
                that controls the production copy and the experimentation logic.
                This is a one-time setup with 3 lines of code. Once it’s done,
                all copy changes and experiments can be done via the UI, without
                code changes, deploys or app releases.
              </p>
              <p>
                Nucleus of all product copy: All product copy versioning,
                experiment learnings, and occurrences across the product are in
                one place. We are also building integrations to copywriting and
                experimentation tools like statsig, so the entire workflow from
                editing to shipping, can be managed and reviewed in one place.
                By storing all this in one place, we draw patterns across
                experiments to infer complex learnings over time and assist with
                future iterations.
              </p>
              <p>
                Smart copy optimization: We run contextual Bayesian optimization
                to automatically decide the best-performing copy across many
                variants. This helps product teams pick the winner in a short
                amount of time with one experiment, instead of running many
                sequential A/B tests.
              </p>
              <p>
                We are opening up our private beta with this launch. Our pricing
                is straightforward - a 60-day refundable pilot for $2000 (use
                discount code: CTJW24), for one of the following use cases:
                landing pages, push notifications, email subject lines, or paid
                ad text. We will show visible growth gains to give you a
                substantial ROI on your pilot and refund the amount if we fail
                to deliver on it. We are inviting companies with &gt;2K monthly
                users to try us out here:
                <a href="https://forms.gle/Q3xthubQFfZcXZe88"
                  >https://forms.gle/Q3xthubQFfZcXZe88</a
                >. (Sorry for the form link! We haven’t built out a signup
                interface yet because our focus is on the core product for the
                time being. We’ll add everything else later.)
              </p>
              <p>
                We would love to get feedback from the HN community on (1) the
                flavor of problems you have experienced in the world of copy
                changes, (2) how your or other companies are solving it (3)
                feedback on the product so far, or (4) anything you’d like to
                share!
              </p>
            </div>
          </section>
        </section>
        <section id="39588895">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Flexagon"
              >Flexagon</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 10:35:27</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39588895"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39588745">
          <h3>
            <a class="item" href="https://celso.io/posts/2024/03/03/c128-cpm/"
              >Running CP/M on the C128</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 10:08:32</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39588745"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39587535">
          <h3>
            <a
              class="item"
              href="https://quuxplusone.github.io/blog/2024/03/03/infinite-craft-theory/"
              >The algebraic structure of Infinite Craft</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 06:19:40</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39587535"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39581398">
          <h3>
            <a
              class="item"
              href="https://chloelist.substack.com/p/issue-12-mustard"
              >Mustard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-03 @ 15:25:51</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39581398"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39580647">
          <h3>
            <a class="item" href="https://arcinstitute.org/news/blog/evo"
              >Evo: DNA foundation modeling from molecular to genome scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-03 @ 13:18:03</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39580647"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39579480">
          <h3>
            <a
              class="item"
              href="https://themarkup.org/automated-censorship/2024/03/01/how-automated-content-moderation-works-even-when-it-doesnt-work"
              >How Automated Content Moderation Works (Even When It Doesn't)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-03 @ 08:47:23</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39579480"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39578796">
          <h3>
            <a class="item" href="http://www.velato.net/"
              >Velato: A programming language where source code must be a valid
              MIDI music file</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-03 @ 05:55:37</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39578796"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39572164">
          <h3>
            <a
              class="item"
              href="https://dmytrobaida.github.io/recursion-viewer/"
              >Recursion Viewer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-02 @ 12:39:19</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39572164"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
