<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45608887">
          <h3>
            <a
              class="item"
              href="https://blog.chriszacharias.com/a-conspiracy-to-kill-ie6"
              >A Conspiracy to Kill IE6 (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 18:22:08</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45608887"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45608795">
          <h3>
            <a class="item" href="https://status.test-ipv6.com"
              >test-ipv6.com will stay online!</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 18:13:21</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45608795"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45608456">
          <h3>
            <a class="item" href="https://www.felixstocker.com/blog/talent"
              >Talent</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 17:47:19</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45608456"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45608285">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/x86-Opcodes-Not-AMD-Or-Intel"
              >Mysterious Intrigue Around an x86 "Corporate Entity Other Than
              Intel/AMD"</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 17:36:18</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45608285"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45608260">
          <h3>
            <a class="item" href="https://www.howuselessareyou.com"
              >Show HN: How Useless Are You? A brutally honest skills check</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 17:34:44</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45608260"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                after noticing how hard it is to get honest feedback when
                applying to a YC startup or something else entirely.
              </p>
              <p>It's a custom 5-minute challenge that roasts you after.</p>
              <p>
                Added a leaderboard for those who want to see how they stack up.
              </p>
              <p>Roast us below.</p>
            </div>
          </section>
        </section>
        <section id="45607822">
          <h3>
            <a class="item" href="https://cognition.ai/blog/swe-grep"
              >SWE-Grep and SWE-Grep-Mini: RL for Fast Multi-Turn Context
              Retrieval</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 16:59:30</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45607822"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45607758">
          <h3>
            <a
              class="item"
              href="https://ricklamers.io/posts/gemini-3-spotted-in-the-wild/"
              >Gemini 3.0 spotted in the wild through A/B testing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 16:54:26</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45607758"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45607117">
          <h3>
            <a class="item" href="https://www.anthropic.com/news/skills"
              >Claude Skills</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 16:05:47</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45607117"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://www.anthropic.com/engineering/equipping-agents-for-the-real-world-with-agent-skills"
                >https://www.anthropic.com/engineering/equipping-agents-for-t...</a
              >
            </div>
          </section>
        </section>
        <section id="45606698">
          <h3>
            <a class="item" href="https://zed.dev/blog/codex-is-live-in-zed"
              >Codex Is Live in Zed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 15:36:39</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45606698"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45606602">
          <h3>
            <a
              class="item"
              href="https://www.itbrew.com/stories/2025/10/14/why-more-saas-companies-are-hiring-chief-trust-officers"
              >Why more SaaS companies are hiring chief trust officers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 15:29:06</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45606602"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45606394">
          <h3>
            <a
              class="item"
              href="https://www.eurogamer.net/ea-union-workers-rally-against-55bn-saudi-backed-private-acquisition-with-formal-petition-to-regulators"
              >Video game union workers rally against $55B private acquisition
              of EA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 15:12:19</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45606394"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45606070">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/improving-the-trustworthiness-of-javascript-on-the-web/"
              >Improving the Trustworthiness of JavaScript on the Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 14:50:04</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45606070"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45605921">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/interactive/2025/10/16/well/eat/ultraprocessed-food-junk-history.html"
              >How America got hooked on ultraprocessed foods</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 14:39:17</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45605921"
                  >Comments</a
                ><span class="descendants">: 182</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45605501">
          <h3>
            <a class="item" href="https://about.doordash.com/en-us/news/waymo"
              >DoorDash and Waymo launch autonomous delivery service in
              Phoenix</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 14:04:18</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45605501"
                  >Comments</a
                ><span class="descendants">: 235</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45605291">
          <h3>
            <a
              class="item"
              href="https://akarshc.com/post/phoenix-for-my-project.html"
              >Why I Chose Elixir Phoenix over Rails, Laravel, and Next.js</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 13:48:33</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45605291"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45605153">
          <h3>
            <a
              class="item"
              href="https://www.novaspivack.com/science/introducing-lace-a-new-kind-of-cellular-automata"
              >Lace: A New Kind of Cellular Automata Where Links Matter</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 13:33:45</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45605153"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45604779">
          <h3>
            <a
              class="item"
              href="https://www.chalmers.se/en/current/news/mc2-how-electricity-can-heal-wounds-three-times-as-fast/"
              >Electricity can heal wounds three times as fast (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 12:59:08</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45604779"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45604700">
          <h3>
            <a class="item" href="https://github.com/inkeep/agents"
              >Launch HN: Inkeep (YC W23) – Agent builder that works both
              visually and in code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 12:50:08</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45604700"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
            <div class="text">
              <a href="https://go.inkeep.com/video"
                >https://go.inkeep.com/video</a
              >.
              <p>
                As a developer, the flow is: 1) Build AI Chat Assistants or AI
                Workflows with the TypeScript SDK 2) Run `inkeep push` from your
                CLI to publish 3)Edit agents in the visual builder (or hand off
                to non-technical teams) 4) Run `inkeep pull to edit in code
                again.
              </p>
              <p>
                We built this because we wanted the accessibility of no-code
                workflow builders (n8n, Zapier), but the flexibility and devex
                of code-based agent frameworks (LangGraph, Mastra). We also
                wanted first-class support for chat assistants with interactive
                UIs, not just workflows. OpenAI got close, but you can only do a
                one-time export from visual builder to code and there’s vendor
                lock-in.
              </p>
              <p>
                How I've used it: I bootstrapped a few agents for our marketing
                and sales teams, then was able to hand off so they can maintain
                and create their own agents. This has enabled us to adopt agents
                across technical and non-technical roles in our company on a
                single platform.
              </p>
              <p>
                To try it, here’s the quickstart:
                <a href="https://go.inkeep.com/quickstart"
                  >https://go.inkeep.com/quickstart</a
                >.
              </p>
              <p>
                We leaned on open protocols to make it easy to use agents
                anywhere: An MCP endpoint, so agents can be used from
                Cursor/Claude/ChatGPT A Chat UI library with interactive
                elements you can customize in React An API endpoint compatible
                with the Vercel AI SDK `useChat` hook Support for Agent2Agent
                (A2A) so they work with other agent ecosystems
              </p>
              <p>
                We made some practical templates like a customer_support,
                deep_research, and docs_assistant. Deployment is easy with
                Vercel/Docker with a fair-code license and there's a traces UI
                and OTEL logs for observability.
              </p>
              <p>
                Under the hood, we went all-in on a multi-agent architecture.
                Agents are made up of LLMs, MCPs, and agent-to-agent
                relationships. We’ve found this approach to be easier to
                maintain and more flexible than traditional “if/else” approaches
                for complex workflows.
              </p>
              <p>
                The interoperability works because the SDK and visual builder
                share a common underlying representation, and the Inkeep CLI
                bridges it with a mix of LLMs and TypeScript syntactic sugar.
                Details in our docs:
                <a href="https://docs.inkeep.com">https://docs.inkeep.com</a>.
              </p>
              <p>
                We’re open to ideas and contributions! And would love to hear
                about your experience building agents - what works, hasn’t
                worked, what’s promising?
              </p>
            </div>
          </section>
        </section>
        <section id="45604673">
          <h3>
            <a class="item" href="https://hyperflask.dev/"
              >Hyperflask – Full stack Flask and Htmx framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 12:46:28</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45604673"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45604451">
          <h3>
            <a
              class="item"
              href="https://100x.bot/a/a-stateful-browser-agent-using-self-healing-dom-maps"
              >A stateful browser agent using self-healing DOM maps</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 12:21:36</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45604451"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45604372">
          <h3>
            <a
              class="item"
              href="https://journal.media-culture.org.au/index.php/mcjournal/article/view/3108"
              >Skibidi Toilet and the monstrous digital</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 12:11:18</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45604372"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45604308">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/44310"
              >Jiga (YC W21) Is Hiring Full Stacks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 12:00:45</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45602676">
          <h3>
            <a
              class="item"
              href="https://github.com/liquibase/liquibase/issues/7374"
              >Liquibase continues to advertise itself as "open source" despite
              license switch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 08:02:52</span
              ><span class="points-container"
                >Points: <span class="points">310</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45602676"
                  >Comments</a
                ><span class="descendants">: 268</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45601982">
          <h3>
            <a class="item" href="https://lwn.net/Articles/1039073/"
              >Upcoming Rust language features for kernel development</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 06:12:51</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45601982"
                  >Comments</a
                ><span class="descendants">: 171</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45601834">
          <h3>
            <a class="item" href="https://ollama.com/blog/coding-models"
              >New coding models and integrations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 05:46:50</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45601834"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45601750">
          <h3>
            <a
              class="item"
              href="https://www.propublica.org/article/inside-turbotax-20-year-fight-to-stop-americans-from-filing-their-taxes-for-free"
              >TurboTax’s 20-year fight to stop Americans from filing taxes for
              free (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 05:31:31</span
              ><span class="points-container"
                >Points: <span class="points">685</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45601750"
                  >Comments</a
                ><span class="descendants">: 362</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45554004">
          <h3>
            <a
              class="item"
              href="https://www.pnas.org/doi/10.1073/pnas.2503399122"
              >VOC injection into a house reveals large surface reservoir
              sizes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 00:23:35</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45554004"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45547891">
          <h3>
            <a class="item" href="https://ryan.freumh.org/eon.html"
              >Eon – An Effects-Based OCaml Nameserver</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 10:02:03</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45547891"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45545220">
          <h3>
            <a
              class="item"
              href="https://blog.gingerbeardman.com/2025/10/11/how-to-tame-a-user-interface-using-a-spreadsheet/"
              >How to tame a user interface using a spreadsheet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 00:11:59</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45545220"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45539079">
          <h3>
            <a class="item" href="https://justsketch.me"
              >JustSketchMe – Digital Posing Tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-10 @ 13:53:38</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45539079"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
