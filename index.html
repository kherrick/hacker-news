<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36118093">
          <h3>
            <a
              class="item"
              href="https://alentred.medium.com/cognitive-load-of-abstractions-in-the-source-code-20a889a106d4"
              >Death by design patterns, or On the cognitive load of
              abstractions in the code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 21:04:34</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118093"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118074">
          <h3>
            <a
              class="item"
              href="https://deep-ivy-ltd.breezy.hr/p/055a500d0e8701-ml-research-engineer?ref=upstract.com"
              >Ivy (YC W23) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 21:01:13</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36117950">
          <h3>
            <a
              class="item"
              href="https://austinhenley.com/blog/superoptimizer.html"
              >My first superoptimizer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 20:47:30</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36117950"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36117846">
          <h3>
            <a class="item" href="https://pypi.org/project/cost-of-code/"
              >How much would it have cost if GPT-4 had written your code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 20:39:16</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36117846"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36117558">
          <h3>
            <a
              class="item"
              href="https://www.interactions.org///press-release/lhc-experiments-see-first-evidence-rare-higgs-boson-decay"
              >LHC experiments see first evidence of a rare Higgs boson decay</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 20:10:36</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36117558"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36117037">
          <h3>
            <a class="item" href="https://minigdx.github.io/tiny/"
              >Show HN: Tiny – A 2D Game Engine in Kotlin Working with Lua</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 19:19:17</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36117037"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                The engine was created using Kotlin Multiplatform and can run on
                a JVM and JS. Funny things: Games can be created using the
                programming language Lua.
              </p>
              <p>
                Tiny is designed to help you create and test your ideas quickly
                and effectively. Not only can you run your games on your desktop
                computer, but you can also export them for the web, making it
                easy to share your creations with others.
              </p>
              <p>
                You can create games easily with the hot reload, small API and
                Lua, which is very easy to learn.
              </p>
              <p>
                If you want to test a game idea, to try to create your first
                game or just have fun, give it a try to Tiny.
              </p>
            </div>
          </section>
        </section>
        <section id="36116937">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/sections/health-shots/2023/05/29/1177914622/a-natural-death-may-be-preferable-for-many-than-enduring-cpr"
              >CPR's true survival rate is lower than many people think</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 19:09:59</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36116937"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36116762">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/gdp-is-the-wrong-tool-for-measuring-what-matters/"
              >GDP is the wrong tool for measuring what matters (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 18:54:53</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36116762"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36116091">
          <h3>
            <a
              class="item"
              href="https://china-journal.org/2016/03/14/filial-piety-in-chinese-culture/"
              >Filial Piety in Chinese Culture (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 17:36:23</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36116091"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36114896">
          <h3>
            <a
              class="item"
              href="https://www.catholicnewsagency.com/news/254032/wikipedia-had-the-wrong-vatican-city-flag-for-years-now-incorrect-flags-are-everywhere"
              >Wikipedia had wrong Vatican flag for years – now incorrect flags
              are everywhere</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 15:29:58</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114896"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36114775">
          <h3>
            <a
              class="item"
              href="https://www.rheinmetall.com/en/media/news-watch/news/2023/mai/2023-05-16-rheinmetall-launches-first-pilot-project-for-innovative-curb-stone-chargers"
              >Rheinmetall pilot project for curb stone chargers for EVs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 15:14:52</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114775"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36114562">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Johari_window"
              >The Johari Window</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 14:52:14</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114562"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36114147">
          <h3>
            <a
              class="item"
              href="https://interrupt.memfault.com/blog/cpp-17-for-embedded"
              >C++17’s useful features for embedded systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 14:09:58</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114147"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113828">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/XFS-Patch-For-Linux-6.3"
              >XFS Metadata Corruption on Linux 6.3 Tracked Down to One Missing
              One-Line Patch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 13:38:23</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113828"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113586">
          <h3>
            <a
              class="item"
              href="https://duncanlock.net/blog/2023/05/28/thanks-david-peter/"
              >Thanks, David Peter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 13:08:04</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113586"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113432">
          <h3>
            <a
              class="item"
              href="https://simonschreibt.de/gat/deus-ex-alpha-terrain/"
              >Deus Ex – Alpha Terrain</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 12:49:41</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113432"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113430">
          <h3>
            <a
              class="item"
              href="https://www.nray.dev/blog/300ms-faster-reducing-wikipedias-total-blocking-time/"
              >300ms Faster: Reducing Wikipedia's total blocking time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 12:49:11</span
              ><span class="points-container"
                >Points: <span class="points">370</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113430"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113324">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20050322021208/http://www.kuro5hin.org/story/2005/3/19/133129/548"
              >A Coder in Courierland (2005)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 12:31:26</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113324"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113215">
          <h3>
            <a
              class="item"
              href="https://mullvad.net/en/blog/2023/5/29/removing-the-support-for-forwarded-ports/"
              >Removing support for forwarded ports</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 12:17:54</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113215"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113115">
          <h3>
            <a class="item" href="http://akkartik.name/freewheeling"
              >Using computers more freely and safely</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 12:04:09</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113115"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36112834">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-05-fossil-tail-ancient-beast.html"
              >Fossil tells the 'tail' of an ancient beast</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 11:15:25</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36112834"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36112815">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2023-05-harvest-abundant-energy-thin-air.html"
              >Research on harvesting electricity from humidity in the air</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 11:12:58</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36112815"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36112080">
          <h3>
            <a
              class="item"
              href="https://plus.maths.org/content/circles-rolling-circles"
              >Circles rolling on circles (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 08:56:01</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36112080"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36112053">
          <h3>
            <a
              class="item"
              href="https://fasterthanli.me/articles/a-terminal-case-of-linux"
              >A terminal case of Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 08:51:42</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36112053"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36111878">
          <h3>
            <a class="item" href="https://github.com/clovaai/donut"
              >Donut: OCR-Free Document Understanding Transformer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 08:19:46</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36111878"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36111683">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/workers-tcp-socket-api-connect-databases/"
              >Connect() – a new API for creating TCP sockets from Cloudflare
              Workers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 07:44:15</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36111683"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36111596">
          <h3>
            <a
              class="item"
              href="https://methexis.substack.com/p/production-ai-systems-are-really"
              >Production AI systems are hard</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 07:27:20</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36111596"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36107619">
          <h3>
            <a
              class="item"
              href="https://chocolateclass.wordpress.com/2014/03/14/chocolate-and-the-steam-engine/"
              >Chocolate and the Steam Engine (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 20:45:00</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36107619"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36105603">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/cash-only-movement-apple-pay-paper-money-3814f75a"
              >Pro-cash movement warns that people could be losing more than
              they bargained for</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 16:39:07</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36105603"
                  >Comments</a
                ><span class="descendants">: 370</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36105398">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/a-rare-1914-silent-film-was-considered-lost-forever-a-professor-rescued-it-from-a-vault-9bfdc1f0"
              >A 1914 silent film considered lost was rescued from a vault</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 16:18:19</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36105398"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
