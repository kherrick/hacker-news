<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41094180">
          <h3>
            <a class="item" href="https://fakepaper.app/"
              >The Moon Is Made of Cheese</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 16:23:38</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41094180"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41094147">
          <h3>
            <a
              class="item"
              href="https://www.chicagomag.com/chicago-magazine/september-2010/dining-critic-tries-nutraloaf-the-prison-food-for-misbehaving-inmates/"
              >Dining Critic Tries Nutraloaf, the Prison Food for Misbehaving
              Inmates (2010]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 16:17:20</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41094147"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41093989">
          <h3>
            <a
              class="item"
              href="https://dimitris.cc/posts/an-ordinary-day-with-a-linux-mobile-device.html"
              >An ordinary day with a Linux mobile device</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 15:48:53</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41093989"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41093970">
          <h3>
            <a
              class="item"
              href="https://foundersconfidential418.substack.com/p/what-we-wouldve-done-differently"
              >What we would've done differently in the first year of
              bootstrapping our company</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 15:45:05</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41093970"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41093939">
          <h3>
            <a
              class="item"
              href="https://tecnica.substack.com/p/complex-systems-emerge-from-simple"
              >Complex systems emerge from simple rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 15:38:47</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41093939"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41093918">
          <h3>
            <a
              class="item"
              href="https://www.salon.com/2024/07/28/everlasting-jobstoppers-how-an-ai-bot-destroyed-the-online-job-market/"
              >An AI bot-war destroyed the online job market</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 15:35:25</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41093918"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41093916">
          <h3>
            <a
              class="item"
              href="https://blog.codingconfessions.com/p/simultaneous-multithreading"
              >How Simultaneous Multithreading Works Under the Hood</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 15:35:14</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41093916"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41093833">
          <h3>
            <a
              class="item"
              href="https://www.popularfintech.com/p/what-visa-earnings-really-tell-us"
              >What Visa earnings tell us about the state of the payments
              industry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 15:23:25</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41093833"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41092862">
          <h3>
            <a class="item" href="https://github.com/CelVoxes/ceLLama"
              >Show HN: CeLLama – Single cell annotation with local Large
              Language Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 12:56:55</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41092862"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              A simple R package which helps with annotation of single cell
              experiments such as single cell RNA-seq. With up and down
              regulated genes per cell cluster, the local LLM guesses the cell
              type annotation and creates an overall extensive report.
            </div>
          </section>
        </section>
        <section id="41092861">
          <h3>
            <a
              class="item"
              href="https://cprimozic.net/blog/tools-and-techniques-for-procedural-gamedev/"
              >My favorite tools and techniques for procedural gamedev</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 12:56:32</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41092861"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41092667">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/permitflow?departmentId=d33195eb-8978-4439-abc6-5a8a072de808"
              >PermitFlow (YC W22) Is Hiring Senior/Staff+ Engineers in NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 12:00:48</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41092168">
          <h3>
            <a class="item" href="https://honnibal.dev/blog/back-to-our-roots"
              >SpaCy team back to an independent-minded self-sufficient
              company</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 09:32:35</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41092168"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41091803">
          <h3>
            <a
              class="item"
              href="https://www.cambridge.org/core/journals/judgment-and-decision-making/article/irrational-hungry-judge-effect-revisited-simulations-reveal-that-the-magnitude-of-the-effect-is-overestimated/61CE825D4DC137675BB9CAD04571AE58"
              >Irrational hungry judge effect: magnitude is overestimated
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 07:35:11</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41091803"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41091163">
          <h3>
            <a class="item" href="https://github.com/StreamPot/StreamPot"
              >StreamPot: Run FFmpeg as an API with fluent-FFmpeg compatibility,
              queues and S3</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 04:09:04</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41091163"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41090658">
          <h3>
            <a
              class="item"
              href="https://github.com/ionworks/how-to-debug-your-battery"
              >How to debug your battery design</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 01:39:06</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41090658"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
            <div class="text">
              A guide to simulating the physics inside a battery to solve the
              curse of dimensionality when doing battery R&amp;amp;D using open
              source python tool PyBaMM
            </div>
          </section>
        </section>
        <section id="41090397">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=KqHgCx4Lk_w"
              >Fish in remote tank made into fractals with Video Feedback Device
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 00:33:19</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41090397"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41089911">
          <h3>
            <a
              class="item"
              href="https://bret.dk/intel-n100-radxa-x4-first-thoughts/"
              >Intel N100 Radxa X4 First Thoughts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 22:51:57</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41089911"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41089161">
          <h3>
            <a
              class="item"
              href="https://www.timeextension.com/features/interview-its-easy-to-get-a-bit-over-ambitious-roguecraft-devs-on-developing-for-amiga-in-2024"
              >Roguecraft Devs on Developing for Amiga in 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 20:35:40</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41089161"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41088895">
          <h3>
            <a
              class="item"
              href="https://johncarlosbaez.wordpress.com/2024/07/27/tritone-substitutions/"
              >Tritone Substitutions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 19:52:34</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41088895"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41088592">
          <h3>
            <a class="item" href="https://github.com/managarm/managarm"
              >Managarm: Pragmatic microkernel-based OS with asynchronous I/O</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 19:06:14</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41088592"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41088273">
          <h3>
            <a class="item" href="https://github.com/arunsupe/semantic-grep"
              >Show HN: Semantic Grep – A Word2Vec-powered search tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 18:02:58</span
              ><span class="points-container"
                >Points: <span class="points">322</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41088273"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
            <div class="text">
              Much improved new version. Search for words similar to the query.
              For example, "death" will find "death", "dying", "dead",
              "killing"... Incredibly useful for exploring large text datasets
              where exact matches are too restrictive.
            </div>
          </section>
        </section>
        <section id="41088013">
          <h3>
            <a class="item" href="https://cybernetic.dev/grid"
              >An experiment in UI density created with Svelte</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 17:23:55</span
              ><span class="points-container"
                >Points: <span class="points">772</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41088013"
                  >Comments</a
                ><span class="descendants">: 223</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41087429">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/how-one-german-city-developed-and-then-lost-generations-of-math-geniuses-106750"
              >Göttingen was one of the most productive centers of mathematics
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 16:08:26</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41087429"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41084795">
          <h3>
            <a
              class="item"
              href="https://web.stanford.edu/class/cs81n/command.txt"
              >In the Beginning Was the Command Line (1999)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 06:25:02</span
              ><span class="points-container"
                >Points: <span class="points">352</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41084795"
                  >Comments</a
                ><span class="descendants">: 216</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41074488">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2024-07-lightweight-neural-network-enables-realistic.html"
              >Small neural network enables realistic rendering of woven fabrics
              in real-time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-25 @ 23:23:34</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41074488"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41063823">
          <h3>
            <a class="item" href="https://electricgiraffe.com/"
              >Electric Giraffe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-25 @ 01:04:23</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41063823"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41061646">
          <h3>
            <a
              class="item"
              href="https://medium.com/message/the-secret-of-minecraft-97dfacb05a3c"
              >The secret of Minecraft (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 20:26:00</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41061646"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41060631">
          <h3>
            <a
              class="item"
              href="https://thereader.mitpress.mit.edu/the-rich-history-of-ham-radio-culture/"
              >The Rich History of Ham Radio Culture</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 19:05:11</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41060631"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41057088">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/travel/article/20240723-the-ridgway-hike-the-5000-year-old-pathway-thats-britains-oldest-road"
              >The Ridgway: Hike the 5k-year-old pathway that's Britain's oldest
              road</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 13:47:44</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41057088"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41045212">
          <h3>
            <a class="item" href="https://github.com/swimos/swim-rust"
              >Show HN: SwimOS Rust – A framework for real-time streaming data
              applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-23 @ 12:22:02</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41045212"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
