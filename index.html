<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40821007">
          <h3>
            <a
              class="item"
              href="https://www.supremecourt.gov/opinions/23pdf/22-451_7m58.pdf"
              >Supreme Court overrules Chevron deference [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 14:36:13</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40821007"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40820949">
          <h3>
            <a
              class="item"
              href="https://www.axios.com/2024/06/28/supreme-court-chevron-doctrine-ruling"
              >Supreme Court guts agency power in seismic Chevron ruling</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 14:31:12</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40820949"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40820063">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-02003-6"
              >New ways to catch gravitational waves</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 12:41:22</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40820063"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40819784">
          <h3>
            <a
              class="item"
              href="https://www.flightradar24.com/blog/is-cat-more-common/"
              >Is Clear Air Turbulence becoming more common?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 12:04:56</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40819784"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40819757">
          <h3>
            <a class="item" href="https://grnh.se/4f362fed5us"
              >Substack Is Hiring Systems Engineers to Build a New Economic
              Engine for Culture</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 12:00:14</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40819617">
          <h3>
            <a
              class="item"
              href="https://www.wits.ac.za/news/latest-news/general-news/2024/2024-06/a-novel-way-to-save-rhinos-.html"
              >A Novel way to curb poaching, injecting radioisotopes into 20
              live rhinoceros</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 11:35:34</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40819617"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40819440">
          <h3>
            <a
              class="item"
              href="https://tonyalicea.dev/blog/understanding-react-compiler/"
              >Understanding React Compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 11:05:40</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40819440"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40817852">
          <h3>
            <a class="item" href="https://anvaka.github.io/pm/"
              >Software galaxies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 04:54:53</span
              ><span class="points-container"
                >Points: <span class="points">379</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40817852"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40817644">
          <h3>
            <a class="item" href="https://pulsar-edit.dev/"
              >Pulsar – A Community-Led Hyper-Hackable Text Editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 04:13:49</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40817644"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40817430">
          <h3>
            <a
              class="item"
              href="https://x86.fr/investigating-ssmecs-state-micro-486s-with-the-uca/"
              >Investigating SSMEC's (State Micro) 486s with the UCA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 03:30:08</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40817430"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40817199">
          <h3>
            <a class="item" href="https://lwn.net/Articles/977987/"
              >Aeon: OpenSUSE for Lazy Developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 02:30:18</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40817199"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40817139">
          <h3>
            <a
              class="item"
              href="https://dps8m.gitlab.io/blog/posts/20240622_FPGA/"
              >Hardware FPGA DPS-8M Mainframe and FNP Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 02:14:05</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40817139"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40817079">
          <h3>
            <a
              class="item"
              href="https://www.apricitas.io/p/the-death-of-nyc-congestion-pricing"
              >The Death of NYC Congestion Pricing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 02:01:46</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40817079"
                  >Comments</a
                ><span class="descendants">: 237</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40816158">
          <h3>
            <a
              class="item"
              href="https://imbue.com/research/70b-infrastructure/"
              >Infrastructure set-up &amp;amp; open-source scripts to train a
              70B model from bare metal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 23:08:40</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40816158"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40814011">
          <h3>
            <a class="item" href="https://www.valve.computer/"
              >A modern 8 bit design, built using 1950s thermionic valves</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 19:18:10</span
              ><span class="points-container"
                >Points: <span class="points">371</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40814011"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40813369">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/politics/2024/06/27/purdue-pharma-supreme-court-opioid-bankruptcy/"
              >Supreme Court blocks controversial Purdue Pharma opioid
              settlement</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 18:13:51</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40813369"
                  >Comments</a
                ><span class="descendants">: 604</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40812879">
          <h3>
            <a
              class="item"
              href="https://kvrocks.apache.org/blog/kqir-query-engine/"
              >Redis Alternative at Apache Software Foundation Now Supports
              RediSearch and SQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 17:27:18</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40812879"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40812695">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/06/larry-finger-linux-wireless-hero-was-a-persistent-patient-coder-and-mentor/"
              >Remembering Larry Finger, who made Linux wireless work</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 17:09:37</span
              ><span class="points-container"
                >Points: <span class="points">676</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40812695"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40811785">
          <h3>
            <a
              class="item"
              href="https://www.noemamag.com/the-secret-magical-life-of-lithium/"
              >The Life Of Lithium</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 15:49:17</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40811785"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40811675">
          <h3>
            <a
              class="item"
              href="https://sixcolors.com/post/2024/06/review-moaan-inkpalm-plus-is-weird-cheap-small-and-my-kind-of-e-reader/"
              >Moaan InkPalm Plus is weird, cheap, small, and my kind of
              e-reader</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 15:40:23</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40811675"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40810986">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40810986"
              >Launch HN: Hatchet (YC W24) – Open-source task queue, now with a
              cloud version</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 14:35:34</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40810986"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
            <div class="text">
              <a href="https://hatchet.run">https://hatchet.run</a>). We’re
              building a modern task queue as an alternative to tools like
              Celery for Python and BullMQ for Node. Our open-source repo is at
              <a href="https://github.com/hatchet-dev/hatchet"
                >https://github.com/hatchet-dev/hatchet</a
              >
              and is 100% MIT licensed.
              <p>
                When we did a Show HN a few months ago (<a
                  href="https://news.ycombinator.com/item?id=39643136"
                  >https://news.ycombinator.com/item?id=39643136</a
                >), our cloud version was invite-only and we were focused on our
                open-source offering.
              </p>
              <p>
                Today we’re launching our self-serve cloud so that anyone can
                get started creating tasks on our platform - you can get started
                at
                <a href="https://cloud.onhatchet.run"
                  >https://cloud.onhatchet.run</a
                >, or you can use these credentials to access a demo (should be
                prefilled):
              </p>
              <p></p>
              <pre><code>  URL: https://demo.hatchet-tools.com 
  Email: hacker@news.ycombinator.com
  Password: HatchetDemo123!
</code></pre>
              People are currently using Hatchet for a bunch of use-cases:
              orchestrating RAG pipelines, queueing up user notifications,
              building agentic LLM workflows, or scheduling image generation
              tasks on GPUs.
              <p>
                We built this out of frustration with existing tools and a
                conviction that PostgreSQL is the right choice for a task queue.
                Beyond the fact that many developers are already using Postgres
                in their stack, which makes it easier to self-host Hatchet, it’s
                also easier to model higher-order concepts in Postgres, like
                chains of tasks (which we call workflows). In our system, the
                acknowledgement of the task, the task result, and the updates to
                higher-order models are done as part of the same Postgres
                transaction, which significantly reduces the risk of data
                loss/race conditions when compared with other task queues (which
                usually pass acknowledgements through a broker, storing the task
                results elsewhere, and only then figuring out the next task in
                the chain).
              </p>
              <p>
                We also became increasingly frustrated with tools like Celery
                and the challenges it introduces when using a modern Python
                stack (&gt; 3.5). We wrote up a list of these frustrations here:
                <a href="https://docs.hatchet.run/blog/problems-with-celery"
                  >https://docs.hatchet.run/blog/problems-with-celery</a
                >.
              </p>
              <p>
                Since our Show HN, we’ve (partially or completely) addressed the
                most common pieces of feedback from the post, which we’ll
                outline here:
              </p>
              <p>
                1. The most common ask was built-in support for fanout workflows
                — one task which triggers an arbitrary number of child tasks to
                run in parallel. We previously only had support for DAG
                executions. We generalized this concept and launched child
                workflows (<a
                  href="https://docs.hatchet.run/home/features/child-workflows"
                  >https://docs.hatchet.run/home/features/child-workflows</a
                >). This is the first step towards a developer-friendly model of
                durable execution.
              </p>
              <p>
                2. Support for HTTP-based triggers — we’ve built out support for
                webhook workers (<a
                  href="https://docs.hatchet.run/home/features/webhooks"
                  >https://docs.hatchet.run/home/features/webhooks</a
                >), which allow you to trigger any workflow over an HTTP
                webhook. This is particularly useful for apps on Vercel, who are
                dealing with timeout limits of 60s, 300s, or 900s (depending on
                your tier).
              </p>
              <p>
                3. Our RabbitMQ dependency — while we haven’t gotten rid of this
                completely, we’ve recently launched hatchet-lite (<a
                  href="https://docs.hatchet.run/self-hosting/hatchet-lite"
                  >https://docs.hatchet.run/self-hosting/hatchet-lite</a
                >), which allows you to run the various Hatchet components in a
                single Docker image that bundles RabbitMQ along with a migration
                process, admin CLI, our REST API, and our gRPC engine. Hopefully
                the lite was a giveaway, but this is meant for local development
                and low-volume processing, on the order of hundreds per minute.
              </p>
              <p>
                We’ve also launched more features, like support for global rate
                limiting, steps which only run on workflow failure, and custom
                event streaming.
              </p>
              <p>
                We’ll be here the whole day for questions and feedback, and look
                forward to hearing your thoughts!
              </p>
            </div>
          </section>
        </section>
        <section id="40810949">
          <h3>
            <a class="item" href="https://pketh.org/open-sourcing-kinopio.html"
              >Open Sourcing Kinopio</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 14:32:35</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40810949"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40810802">
          <h3>
            <a
              class="item"
              href="https://storage.googleapis.com/deepmind-media/gemma/gemma-2-report.pdf"
              >Gemma 2: Improving Open Language Models at a Practical Size
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 14:18:46</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40810802"
                  >Comments</a
                ><span class="descendants">: 159</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40805949">
          <h3>
            <a
              class="item"
              href="https://www.404media.co/id-verification-service-for-tiktok-uber-x-exposed-driver-licenses-au10tix/"
              >ID verification service for TikTok, Uber, X exposed driver
              licenses</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 00:05:05</span
              ><span class="points-container"
                >Points: <span class="points">344</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40805949"
                  >Comments</a
                ><span class="descendants">: 223</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40798939">
          <h3>
            <a class="item" href="http://www.spudguns.org/"
              >Spudguns: Potato Cannon Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 11:59:13</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40798939"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40798828">
          <h3>
            <a
              class="item"
              href="https://tech.popdata.org/Flame-Graphs-Performance-Tuning-Made-Easy/"
              >Flame Graphs: Making the opaque obvious (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 11:43:56</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40798828"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40798469">
          <h3>
            <a class="item" href="https://git-cliff.org/"
              >Git-cliff – Generate changelog from the Git history</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 10:43:45</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40798469"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40798025">
          <h3>
            <a
              class="item"
              href="https://actu.epfl.ch/news/moving-objects-precisely-with-sound-2/"
              >Moving objects precisely with sound</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 09:18:27</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40798025"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40796980">
          <h3>
            <a
              class="item"
              href="https://blog.apnic.net/2024/06/26/navigating-starlinks-fcc-paper-trail/"
              >Navigating Starlink's FCC Paper Trail</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 06:26:44</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40796980"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40796697">
          <h3>
            <a class="item" href="https://github.com/dorklyorg/dorkly/wiki"
              >Show HN: Dorkly – Open source feature flags</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 05:28:09</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40796697"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
            <div class="text">
              <p>
                Full disclosure: made by a former LaunchDarkly employee +
                current fan.
              </p>
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
