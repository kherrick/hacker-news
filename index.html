<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37063774">
          <h3>
            <a
              class="item"
              href="http://www.noveltyansweringmachine.com/audio/index.html"
              >Archive of novelty answering machine recordings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 15:02:40</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37063774"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37063576">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/8/9/23824562/slack-redesign-app-dms-activity-later"
              >Slack’s biggest redesign ever tries to tame the chaos of your
              workday</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 14:50:20</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37063576"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37063270">
          <h3>
            <a
              class="item"
              href="https://neurosciencenews.com/gluten-neuroinflammation-23773/"
              >Wheat gluten spurs brain inflammation in mice</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 14:31:41</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37063270"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37063238">
          <h3>
            <a class="item" href="https://github.com/zknill/sqledge"
              >SQLedge: Replicate Postgres to SQLite on the Edge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 14:29:49</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37063238"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37062650">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/opinions/2023/08/09/remote-work-offices-floorplan-privacy/"
              >Want employees to return to the office? Then give each one an
              office</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 13:52:33</span
              ><span class="points-container"
                >Points: <span class="points">345</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37062650"
                  >Comments</a
                ><span class="descendants">: 353</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37062579">
          <h3>
            <a
              class="item"
              href="https://newsroom.ucla.edu/releases/planetary-defense-nasa-dart-mission-asteroid"
              >Planetary defense test deflected an asteroid but unleashed a
              boulder swarm</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 13:47:56</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37062579"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37062547">
          <h3>
            <a
              class="item"
              href="https://www.guidepointsecurity.com/blog/tunnel-vision-cloudflared-abused-in-the-wild/"
              >Tunnel Vision: CloudflareD AbuseD in the Wild</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 13:45:18</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37062547"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37062422">
          <h3>
            <a
              class="item"
              href="https://github.com/hackclub/putting-the-you-in-cpu"
              >I'm 17 and wrote this guide on how CPUs run programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 13:33:59</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37062422"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37062233">
          <h3>
            <a
              class="item"
              href="https://wolfstreet.com/2023/08/09/the-collapse-of-the-ev-spacs-another-one-goes-bankrupt-others-on-the-verge/"
              >The Collapse of the EV SPACs: Another One Goes Bankrupt, Others
              on the Verge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 13:18:53</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37062233"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37062007">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37062007"
              >Show HN: Infracost (YC W21): Be proactive with your cloud
              costs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 13:01:14</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37062007"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                We launched in February 2021
                (https://news.ycombinator.com/item?id=26064588), and Infracost
                is now being actively used by over 3,000 companies. However,
                there is a shift happening in the cloud cost management space.
                New teams, called FinOps teams (a combination of "Finance" and
                "DevOps"), are being formed within companies to manage cloud
                costs.
              </p>
              <p>
                One of the first tasks assigned to these teams is to determine
                "who is using what" - that is, which teams, business units,
                products, etc. are spending the most on cloud. To accomplish
                this, they use tags. Tags are labels that all cloud resources
                should have and are key-value pairs. For example, a server could
                be tagged with: product=HackerNews; environment=production;
                team=blueTeam. So if resources are not tagged properly, then you
                can’t tell who is using what.
              </p>
              <p>
                However, FinOps teams face challenges because their tools are
                reactive. These tools begin by analyzing cloud bills and
                providing visibility of tags from there. This means that they
                are looking at resources that are already running in production
                and costing money. A customer recently shared, “I want all
                resources to be properly tagged. But if they are not, I would
                rather a resource not be tagged at all than be tagged
                incorrectly.”
              </p>
              <p>
                My "aha" moment! FinOps teams can define a tagging policy that
                can be validated in CI/CD before resources are launched. This is
                important because if code is shipped with the wrong tags, FinOps
                teams will have to fight for sprint time to fix them. Even if
                you shut down an untagged resource directly in the cloud, the
                next time Terraform runs, the resource will launch again with no
                tag. You need to fix the issue at its root.
              </p>
              <p>
                I’d love your feedback on our solution to the tagging problem.
                You define your tag key-value policy in our SaaS product, and
                Infracost checks all Terraform resources per change. If anything
                fails the policy, it posts a comment with the details of which
                resources need tags, and what the allowed values are. Once
                fixed, it will let the code be shipped to production.
              </p>
              <p>
                Try it out by going to https://dashboard.infracost.io/, setting
                up with the GitHub app or GitLab app, and defining your tagging
                policy. It will then scan your repository and inform you of any
                missing tags and their file and line number. You can use the
                free trial, but if you need more time, please message me and
                I’ll extend it for you.
              </p>
              <p>
                I would also love to hear how others ensure that the correct tag
                keys and values are applied to all resources, and whether this
                is done proactively or reactively. Additionally, I would be
                interested in hearing about any lessons learned in the process.
              </p>
              <p>Cheers</p>
            </div>
          </section>
        </section>
        <section id="37061694">
          <h3>
            <a
              class="item"
              href="https://www.assemblyai.com/blog/how-rlhf-preference-model-tuning-works-and-how-things-may-go-wrong/"
              >How RLHF Preference Model Tuning Works (and How Things May Go
              Wrong)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 12:33:53</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37061694"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37061352">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/tesorio/10de016f-be07-4707-ac5c-7029f0398a17"
              >Tesorio (YC S15) Is Hiring a Head of Marketing – join our 100%
              remote startup</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 12:00:30</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37060974">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2023/08/08/the-fear-of-ai-just-killed-a-very-useful-tool/"
              >Fear of AI just killed a useful tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 11:08:20</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37060974"
                  >Comments</a
                ><span class="descendants">: 201</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37060654">
          <h3>
            <a
              class="item"
              href="https://mullvad.net/en/blog/2023/8/9/infrastructure-audit-completed-by-radically-open-security/"
              >Infrastructure audit completed by Radically Open Security</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 10:18:46</span
              ><span class="points-container"
                >Points: <span class="points">377</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37060654"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37060269">
          <h3>
            <a class="item" href="https://1nt3r.net/j-cia/"
              >J-CIA64 – Modern spare part for Commodore 64, Commodore 128,
              SX-64</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 09:07:27</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37060269"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37060226">
          <h3>
            <a
              class="item"
              href="https://www.extremetech.com/gaming/intels-gpu-drivers-now-collect-telemetry-including-how-you-use-your-computer"
              >Intel's GPU Drivers Now Collect Telemetry, Including 'How You Use
              Your Computer'</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 09:01:23</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37060226"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37059857">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/recruitinghell/comments/15kj845/canonical_the_recruitment_process_really_is_that/"
              >Canonical’s recruitment process is long and complex</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 08:02:54</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37059857"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37059594">
          <h3>
            <a class="item" href="https://sahillavingia.com/reflecting"
              >Reflecting on my failure to build a billion-dollar company
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 07:16:37</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37059594"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37059487">
          <h3>
            <a
              class="item"
              href="https://nucleardiner.wordpress.com/2017/06/19/a-critical-problem/"
              >A Critical Problem (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 06:55:13</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37059487"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37059479">
          <h3>
            <a
              class="item"
              href="https://blog.briankitano.com/llama-from-scratch/"
              >Llama from scratch, or how to implement a paper without crying</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 06:54:31</span
              ><span class="points-container"
                >Points: <span class="points">321</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37059479"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37058674">
          <h3>
            <a class="item" href="http://omrelli.ug/g9/gallery/"
              >G9.js: Automatically Interactive Graphics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 04:24:56</span
              ><span class="points-container"
                >Points: <span class="points">466</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37058674"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37058278">
          <h3>
            <a class="item" href="https://kenschutte.com/python-swap-ints/"
              >Swap_8_and_9: A simple import can modify the Python
              interpreter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 03:07:50</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37058278"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37057866">
          <h3>
            <a class="item" href="https://github.com/dylanaraps/pure-bash-bible"
              >Pure Bash Bible (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 01:55:47</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37057866"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37057332">
          <h3>
            <a
              class="item"
              href="https://christianjmills.com/posts/arc-a770-testing/part-2/"
              >Testing Intel’s Arc A770 GPU for Deep Learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 00:35:40</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37057332"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37055941">
          <h3>
            <a class="item" href="https://literaryreview.co.uk/war-music"
              >War Music: Homer and His Iliad</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 21:52:13</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37055941"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37052586">
          <h3>
            <a class="item" href="https://downfall.page/">Downfall Attacks</a>
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 17:27:38</span
              ><span class="points-container"
                >Points: <span class="points">1201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37052586"
                  >Comments</a
                ><span class="descendants">: 306</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37040285">
          <h3>
            <a
              class="item"
              href="https://www.medievalists.net/2023/07/hidden-text-of-elizabethan-chronicler-revealed-by-imaging-technology/"
              >Text of Elizabethan chronicler revealed by imaging technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-07 @ 20:09:04</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37040285"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37037900">
          <h3>
            <a class="item" href="https://qalculate.github.io/"
              >Qalculate – A multi-purpose cross-platform desktop calculator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-07 @ 17:44:32</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37037900"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37036888">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/games/2023/aug/07/ultimate-rare-40-years-british-videogames-jet-pac-goldeneye-sea-of-thieves"
              >The Ultimate-Rare story: 40 years of brilliant British games</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-07 @ 16:40:14</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37036888"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37035981">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-08-china-human-lineage.html"
              >Remains found in China may belong to third human lineage</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-07 @ 15:41:29</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37035981"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
