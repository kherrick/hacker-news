<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44721403">
          <h3>
            <a
              class="item"
              href="https://wikimediafoundation.org/news/2025/07/17/wikimedia-foundation-challenges-uk-online-safety-act-regulations/"
              >Wikimedia Foundation Challenges UK Online Safety Act
              Regulations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 10:12:29</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44721403"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44721204">
          <h3>
            <a class="item" href="https://nothing-to-watch.port80.ch"
              >Nothing to watch – Experimental gallery visualizing 50k film
              posters</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 09:42:14</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44721204"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44720103">
          <h3>
            <a
              class="item"
              href="https://www.techradar.com/computing/cyber-security/the-eu-could-be-scanning-your-chats-by-october-2025-heres-everything-we-know"
              >The EU could be scanning your chats by October 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 07:15:05</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44720103"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44719413">
          <h3>
            <a class="item" href="https://www.ponylang.io/discover/"
              >Pony: An actor-model, capabilities-secure, high-performance
              programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 05:34:15</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44719413"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44718117">
          <h3>
            <a class="item" href="https://fintechdystopia.com/"
              >Fintech dystopia</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 01:57:44</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44718117"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44716414">
          <h3>
            <a class="item" href="https://www.pipervoice.com/"
              >Show HN: Companies use AI to take your calls. I built AI to make
              them for you</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 22:17:14</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44716414"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
            <div class="text">
              <p>
                So I built Piper: basically AI that makes phone calls for you.
                You tell it what you need (book appointment, check on an order,
                dispute some charge, whatever), and it handles the entire
                conversation while you do actual work. Right now it's a web app,
                Chrome extension is pending approval but soon you'll be able to
                click any phone number anywhere and just let Piper handle it.
              </p>
              <p>Technical stuff that was harder than expected:</p>
              <p>
                Latency - every millisecond counts in conversation, had to
                optimize around kv cache, got it down to ~1000ms to first word
                over PSTN for telephony, which feels pretty natural
              </p>
              <p>
                Keeping the voice agents on track - built custom context
                engineering logic that constantly updates the agent's
                situational awareness, so it knows when it's been transferred,
                when it's on hold, etc
              </p>
              <p>
                Done ~50 successful calls with early testers so far. Main
                failures are when they need complex verification or documents.
                Also had to take down our IVR navigation temporarily :/, found
                some edge cases that were causing unnecessary transfers but
                working on fixing that.
              </p>
              <p>
                I really think we're heading toward this world where AI talks to
                AI for most routine things, and phone calls might be the first
                real example of this happening at scale!
              </p>
              <p>
                you can check out the a voice demo on our website.
                <a href="https://pipervoice.com">https://pipervoice.com</a>
              </p>
            </div>
          </section>
        </section>
        <section id="44716106">
          <h3>
            <a class="item" href="https://use-their-id.com/"
              >Show HN: Use Their ID – Use your local UK MP’s ID for the Online
              Safety Act</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 21:49:10</span
              ><span class="points-container"
                >Points: <span class="points">737</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44716106"
                  >Comments</a
                ><span class="descendants">: 218</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's a small, silly protest at the stupidity of the Online
                Safety Act that just came into force.
              </p>
              <p>
                edit - My open AI credits got hugged to death, please use a
                known postcode (like one from Kier Starmer's constituency,
                WC2B6NH) in the meantime.
              </p>
            </div>
          </section>
        </section>
        <section id="44715966">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2025/08/04/the-vatican-observatory-looks-to-the-heavens"
              >The Vatican observatory looks to the heavens</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 21:34:40</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44715966"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44715391">
          <h3>
            <a
              class="item"
              href="https://tkdodo.eu/blog/the-useless-use-callback"
              >The Useless UseCallback</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 20:44:26</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44715391"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44715166">
          <h3>
            <a class="item" href="https://underpassapp.com/news/2025/7/5.html"
              >Sign in with Google in Chrome</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 20:24:38</span
              ><span class="points-container"
                >Points: <span class="points">396</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44715166"
                  >Comments</a
                ><span class="descendants">: 207</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44714914">
          <h3>
            <a
              class="item"
              href="https://themaister.net/blog/2025/06/16/i-designed-my-own-ridiculously-fast-game-streaming-video-codec-pyrowave/"
              >I designed my own fast game streaming video codec – PyroWave</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 20:01:26</span
              ><span class="points-container"
                >Points: <span class="points">354</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44714914"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44714223">
          <h3>
            <a class="item" href="https://ianto-cannon.github.io/clock.html"
              >Different Clocks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 19:05:47</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44714223"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44713757">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44713757"
              >Claude Code weekly rate limits</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 18:27:51</span
              ><span class="points-container"
                >Points: <span class="points">532</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44713757"
                  >Comments</a
                ><span class="descendants">: 625</span></span
              >
            </h4>
            <div class="text">
              <p>
                Next month, we're introducing new weekly rate limits for Claude
                subscribers, affecting less than 5% of users based on current
                usage patterns.
              </p>
              <p>
                Claude Code, especially as part of our subscription bundle, has
                seen unprecedented growth. At the same time, we’ve identified
                policy violations like account sharing and reselling access—and
                advanced usage patterns like running Claude 24/7 in the
                background—that are impacting system capacity for all. Our new
                rate limits address these issues and provide a more equitable
                experience for all users.
              </p>
              <p>
                What’s changing: Starting August 28, we're introducing weekly
                usage limits alongside our existing 5-hour limits: Current:
                Usage limit that resets every 5 hours (no change) New: Overall
                weekly limit that resets every 7 days New: Claude Opus 4 weekly
                limit that resets every 7 days As we learn more about how
                developers use Claude Code, we may adjust usage limits to better
                serve our community. What this means for you: Most users won't
                notice any difference. The weekly limits are designed to support
                typical daily use across your projects. Most Max 5x users can
                expect 140-280 hours of Sonnet 4 and 15-35 hours of Opus 4
                within their weekly rate limits. Heavy Opus users with large
                codebases or those running multiple Claude Code instances in
                parallel will hit their limits sooner. You can manage or cancel
                your subscription anytime in Settings. We take these decisions
                seriously. We're committed to supporting long-running use cases
                through other options in the future, but until then, weekly
                limits will help us maintain reliable service for everyone.
              </p>
              <p>
                We also recognize that during this same period, users have
                encountered several reliability and performance issues. We've
                been working to fix these as quickly as possible, and will
                continue addressing any remaining issues over the coming days
                and weeks.
              </p>
              <p>–The Anthropic Team</p>
            </div>
          </section>
        </section>
        <section id="44711745">
          <h3>
            <a
              class="item"
              href="https://shaneosullivan.wordpress.com/2025/07/28/on-designing-for-children/"
              >Simplify, then add delightness: On designing for children</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 15:21:13</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711745"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711519">
          <h3>
            <a class="item" href="https://github.com/9001/copyparty"
              >Copyparty – Turn almost any device into a file server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 14:57:55</span
              ><span class="points-container"
                >Points: <span class="points">814</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711519"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711306">
          <h3>
            <a
              class="item"
              href="https://mathstodon.xyz/@tao/114915604830689046"
              >Tao on “blue team” vs. “red team” LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 14:36:39</span
              ><span class="points-container"
                >Points: <span class="points">466</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711306"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711106">
          <h3>
            <a class="item" href="https://z.ai/blog/glm-4.5"
              >GLM-4.5: Reasoning, Coding, and Agentic Abililties</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 14:15:52</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711106"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44708270">
          <h3>
            <a
              class="item"
              href="https://blog.jim-nielsen.com/2025/how-to-make-websites-that-require-lots-of-time-and-energy/"
              >How to make websites that will require lots of your time and
              energy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 07:41:41</span
              ><span class="points-container"
                >Points: <span class="points">274</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44708270"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44705445">
          <h3>
            <a
              class="item"
              href="https://www.geoffreylitt.com/2025/07/27/enough-ai-copilots-we-need-ai-huds"
              >Enough AI copilots, we need AI HUDs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 22:51:28</span
              ><span class="points-container"
                >Points: <span class="points">879</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44705445"
                  >Comments</a
                ><span class="descendants">: 245</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44690914">
          <h3>
            <a class="item" href="https://github.com/launchbadge/sqlx"
              >SQLx – Rust SQL Toolkit</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-26 @ 02:54:46</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44690914"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44690158">
          <h3>
            <a
              class="item"
              href="https://hologram.page/blog/hologram-v0-5-0-released"
              >50x rendering speed improvements in Hologram (Elixir web
              framework)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-26 @ 00:27:54</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44690158"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44689453">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Truchet_tiles"
              >Truchet Tiles</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 22:53:50</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44689453"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44689402">
          <h3>
            <a
              class="item"
              href="https://cacm.acm.org/research-highlights/sram-has-no-chill-exploiting-power-domain-separation-to-steal-on-chip-secrets/"
              >SRAM Has No Chill: Exploiting Power Domain Separation to Steal
              On-Chip Secrets</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 22:47:52</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44689402"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44688738">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/world/2025/07/25/tour-france-bikes-hidden-motors/"
              >Tour de France confronts a new threat: Are cyclists using tiny
              motors?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 21:32:22</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44688738"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44686624">
          <h3>
            <a
              class="item"
              href="https://www.shellshore.com/review-rotring-600-ballpoint-pen/"
              >Rotring 600 Ballpoint Pen</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 18:35:22</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44686624"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44682885">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/culture/article/20190114-flix-nadar-the-worlds-first-celebrity-photographer"
              >Félix Nadar: the first celebrity photographer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 13:26:05</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44682885"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44682451">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/the-cells-that-breathe-two-ways-20250723/"
              >Cells that breathe oxygen and sulfur at the same time</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 12:38:31</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44682451"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44682450">
          <h3>
            <a
              class="item"
              href="https://blog.trailofbits.com/2025/07/25/exploiting-zero-days-in-abandoned-hardware/"
              >Exploiting zero days in abandoned hardware</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 12:38:30</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44682450"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44681858">
          <h3>
            <a
              class="item"
              href="https://www.androidauthority.com/linux-terminal-graphical-apps-3580905/"
              >Terminal app can now run full graphical Linux apps in the latest
              Android Canary</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 11:08:45</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44681858"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44681254">
          <h3>
            <a
              class="item"
              href="https://github.com/nabbonoushad/Chaotic-Rickroll-Machine"
              >Built a rickroll machine that rickrolls you with microservices</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 09:24:41</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44681254"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
