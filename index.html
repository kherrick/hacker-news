<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37432420">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/policyfly/jobs/32uV7Bg-senior-solutions-engineer"
              >PolicyFly (YC W22) Is Hiring a Senior Solutions Engineer
              (Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 12:00:41</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37432247">
          <h3>
            <a
              class="item"
              href="https://twitter.com/typesfast/status/1700092765798048093?s=46&amp;t=8Tb0Q2Q5idtWP7ImXKJ0rw"
              >Flexport Rescinding Job Offers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 11:39:07</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37432247"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37431962">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/us-news/2023/sep/08/new-york-police-tracking-voyager-labs-meta-contract"
              >NYPD spent millions to contract with firm banned by Meta for fake
              profiles</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 10:45:13</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37431962"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37431946">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02477-w"
              >Scientific sleuths spot dishonest ChatGPT use in papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 10:42:46</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37431946"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37431710">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/09/08/linux_on_the_thinkpad_x13s/"
              >Linux on the Arm-Based ThinkPad X13S: Getting There</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 10:08:33</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37431710"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37431644">
          <h3>
            <a class="item" href="http://touchpianist.com/">Touch Pianist</a>
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 09:56:08</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37431644"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37431560">
          <h3>
            <a
              class="item"
              href="https://jpcamara.com/2023/04/12/pgbouncer-is-useful.html"
              >PgBouncer is useful, important, and fraught with peril</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 09:43:22</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37431560"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37431474">
          <h3>
            <a class="item" href="https://librewolf.net/"
              >LibreWolf – custom version of Firefox, focused on privacy,
              security and freedom</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 09:29:59</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37431474"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37430595">
          <h3>
            <a class="item" href="https://napi.rs/"
              >Napi: Build compiled Node.js add-ons in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 07:27:12</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37430595"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37429938">
          <h3>
            <a
              class="item"
              href="https://github.com/leanprover/lean4/releases/tag/v4.0.0"
              >Lean 4.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 05:59:40</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37429938"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37429922">
          <h3>
            <a
              class="item"
              href="https://underjord.io/unpacking-elixir-syntax.html"
              >Unpacking Elixir: Syntax</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 05:57:27</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37429922"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37428505">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s42256-023-00652-2"
              >Federated benchmarking of medical artificial intelligence with
              MedPerf</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 02:28:36</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37428505"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37427854">
          <h3>
            <a class="item" href="https://txt.cohere.com/urzas-ai/"
              >We built an AI-powered Magic the Gathering card generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-08 @ 00:53:34</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37427854"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37427279">
          <h3>
            <a
              class="item"
              href="https://www.masteringemacs.org/article/whats-new-in-emacs-29-1"
              >What's new in Emacs 29.1</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 23:46:12</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37427279"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37427127">
          <h3>
            <a class="item" href="https://hackyournews.com/"
              >Show HN: HackYourNews – AI summaries of the top HN stories</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 23:30:33</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37427127"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wanted to share a pet project of mine. I built HackYourNews
                [1] to scratch a personal itch: Knowing which stories to focus
                on while browsing aimlessly (though there is a certain joy in
                that, as well!)
              </p>
              <p>
                HackYourNews uses OpenAI's gpt-3.5-turbo to summarize the
                destination article as well as the comments section.
                Summarization of the article is always cached, while summaries
                of the comments are regenerated if the comments count is &gt;10%
                (or &gt;10 comments) different.
              </p>
              <p>
                While I styled the homepage to welcome HNers, my preferred view
                is the Mobile view, accessed from the navbar. This no-frills
                view honors OS-level dark mode and is easy to skim on any
                device.
              </p>
              <p>
                Tried to keep the site minimal. The only JS is Cloudflare's
                privacy-preserving analytics [2], just to gauge interest.
              </p>
              <p>This is the first time I'm releasing something to the wild.</p>
              <p>Hope you find this useful!</p>
              <p>The frontend is pure HTML+CSS.</p>
              <p>
                The backend is NodeJS (Puppeteer) + Python with the excellent
                Microsoft Guidance [3] library to interface to OpenAI's API.
              </p>
              <p>
                [1]
                <a href="https://hackyournews.com/"
                  >https://hackyournews.com/</a
                >
              </p>
              <p>
                [2]
                <a href="https://www.cloudflare.com/web-analytics/"
                  >https://www.cloudflare.com/web-analytics/</a
                >
              </p>
              <p>
                [3]
                <a href="https://github.com/guidance-ai/guidance"
                  >https://github.com/guidance-ai/guidance</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37426132">
          <h3>
            <a
              class="item"
              href="https://www.cringely.com/2013/03/14/accidental-empires-chapter-11-font-wars/"
              >Accidental Empires, Chapter 11 – Font Wars (1992)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 21:55:05</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37426132"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37426116">
          <h3>
            <a
              class="item"
              href="https://buttondown.email/linotypebook/archive/lbp-issue-no-5-digging-through-a-morgue/"
              >Digging through the New York Times morgue</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 21:53:14</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37426116"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37426107">
          <h3>
            <a
              class="item"
              href="https://www.robinsloan.com/newsletters/what-would-a-wizard-read/#walking"
              >The thinking path</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 21:52:02</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37426107"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37425052">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-08-china-ancient-pipe-networks-communal.html"
              >China's ancient water pipe networks show no evidence of a
              centralized authority</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 20:25:09</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37425052"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37425007">
          <h3>
            <a
              class="item"
              href="https://citizenlab.ca/2023/09/blastpass-nso-group-iphone-zero-click-zero-day-exploit-captured-in-the-wild/"
              >NSO group iPhone zero-click, zero-day exploit captured in the
              wild</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 20:21:01</span
              ><span class="points-container"
                >Points: <span class="points">1240</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37425007"
                  >Comments</a
                ><span class="descendants">: 671</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37420831">
          <h3>
            <a
              class="item"
              href="https://blog.google/threat-analysis-group/active-north-korean-campaign-targeting-security-researchers/"
              >North Korean campaign targeting security researchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 15:53:23</span
              ><span class="points-container"
                >Points: <span class="points">536</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37420831"
                  >Comments</a
                ><span class="descendants">: 262</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37420812">
          <h3>
            <a class="item" href="http://www-formal.stanford.edu/jmc/facts.txt"
              >John McCarthy’s collection of numerical facts for use in elisp
              programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 15:52:09</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37420812"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37420628">
          <h3>
            <a
              class="item"
              href="https://blog.lancedb.com/llms-rag-the-missing-storage-layer-for-ai-28ded35fa984"
              >LLMs, RAG, and the missing storage layer for AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 15:41:38</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37420628"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37417358">
          <h3>
            <a class="item" href="https://github.com/guardian/typerighter"
              >The Guardian's Typerighter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 11:22:51</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37417358"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37417027">
          <h3>
            <a
              class="item"
              href="https://mathspp.com/blog/animations-from-first-principles-in-5-minutes"
              >Animations From First Principles (in 5 minutes)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 10:38:07</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37417027"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37416999">
          <h3>
            <a
              class="item"
              href="http://www.ws.binghamton.edu/fridrich/cube.html"
              >My speed cubing page</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 10:33:33</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37416999"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37415812">
          <h3>
            <a
              class="item"
              href="https://gal.hagever.com/posts/my-node-js-is-a-bit-rusty"
              >My Node.js is a bit Rusty</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 07:34:09</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37415812"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37415499">
          <h3>
            <a
              class="item"
              href="https://richardstartin.github.io/posts/wallclock-profiler"
              >Understanding Request Latency with Profiling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 06:39:30</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37415499"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37415494">
          <h3>
            <a class="item" href="https://howqueryengineswork.com/"
              >How Query Engines Work</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 06:38:55</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37415494"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37415356">
          <h3>
            <a
              class="item"
              href="https://www.tandfonline.com/doi/full/10.1080/01611194.2022.2160677"
              >Deciphering Mary Stuart’s lost letters from 1578-1584</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 06:17:13</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37415356"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
