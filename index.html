<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36793881">
          <h3>
            <a
              class="item"
              href="https://www.supervised.news/p/the-open-source-learning-curve-for"
              >The open source learning curve for AI researchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 21:43:17</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36793881"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36793694">
          <h3>
            <a class="item" href="http://schwarze.bsd.lv/1703_mandoc_markdown.7"
              >On why Markdown is not a good, or even a half-decent, markup
              language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 21:28:45</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36793694"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36793372">
          <h3>
            <a
              class="item"
              href="https://twitter.com/TimMLatimer/status/1681304496234991620"
              >Geothermal Ahead of Schedule</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 21:05:28</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36793372"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36793074">
          <h3>
            <a class="item" href="https://metastatus.com/whatsapp-business-api"
              >WhatsApp Is Down</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 20:46:52</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36793074"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36792968">
          <h3>
            <a
              class="item"
              href="https://boringappsec.substack.com/p/edition-21-a-framework-to-securely"
              >A framework to securely use LLMs in companies – Part 1: Overview
              of Risks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 20:40:51</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36792968"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36792566">
          <h3>
            <a
              class="item"
              href="https://fablestudio.github.io/showrunner-agents/?mc_cid=f9d1eb56dc&amp;mc_eid=bbcd57583d"
              >A full episode of South Park generated by AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 20:17:14</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36792566"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36792421">
          <h3>
            <a
              class="item"
              href="https://www.evalapply.org/posts/cold-restart-total-outage/index.html"
              >Cold restart whole system after total outage</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 20:06:29</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36792421"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36791566">
          <h3>
            <a class="item" href="https://clipdrop.co/stable-doodle"
              >Stable Doodle: Transform your doodles into real images in
              seconds</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 19:04:07</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36791566"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36791506">
          <h3>
            <a
              class="item"
              href="https://themer.dev/blog/the-single-most-important-factor-that-differentiates-front-end-frameworks"
              >The single most impor­tant factor that dif­fer­enti­ates
              front-end frame­works</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 19:00:45</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36791506"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36791434">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36791434"
              >Launch HN: Twenty.com (YC S23) – Open-source CRM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 18:54:50</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36791434"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
            <div class="text">
              <p>
                Seven years ago, I complained about Salesforce on HN. Somebody
                said: "one day, someone will do better". That stuck and today
                we're trying to be that “someone” with my co-founders Thomas
                (design) and Charles (eng like me). Our company is called Twenty
                and our repo is here:
                <a href="https://github.com/twentyhq/twenty"
                  >https://github.com/twentyhq/twenty</a
                >
              </p>
              <p>
                We want to fix two issues: most CRMs aren't enjoyable to use and
                they often clash with engineering teams.
              </p>
              <p>
                YC encouraged us to launch early. What you see now is about two
                months' worth of feature development. Our tool only does a small
                part of what big CRM players offer, but we focused on providing
                a great user experience on the basics, instead of spreading
                ourselves thin across a vast range of features and delivering
                them half-heartedly. Plus, we've found that many small companies
                like the product as it is because they don't need all the
                complex stuff.
              </p>
              <p>
                Once we have covered the basics, we’ll soon be working on three
                big features: - Moving to a robust metadata-driven architecture;
                - Providing innovating ways to extend the CRM with Typescript; -
                Making it easy to connect data sources, and fetch data in
                real-time like in BI tools.
              </p>
              <p>
                The startup world is littered with ghosts of so-called
                "Salesforce killers", so we know it sounds naive to pitch
                ourselves in a similar way. But we think that if someone ends up
                changing this market, it will most likely be through a
                community-led effort. And there hasn’t really been any serious
                attempt to start a great new open source CRM in the last decade.
              </p>
              <p>
                Twenty is built with Typescript, React, and NestJS with GraphQL,
                and licensed under AGPL. We plan to make money by offering a
                hosted version. Our docs are here:
                <a href="https://docs.twenty.com">https://docs.twenty.com</a>.
                Try on cloud:
                <a href="https://app.twenty.com">https://app.twenty.com</a>.
              </p>
              <p>
                Dev setup and demo:
                <a
                  href="https://www.loom.com/share/7b20b44d8d5146fea8923183511bb818"
                  >https://www.loom.com/share/7b20b44d8d5146fea8923183511bb818</a
                >
                (Loom said they couldn’t provide a transcript because they don’t
                support “language other than english” haha... apologies in
                advance!)
              </p>
              <p>
                We’re very eager to get your feedback as we haven’t launched
                anywhere before this post. What's your CRM story? What should we
                prioritize next?
              </p>
            </div>
          </section>
        </section>
        <section id="36790301">
          <h3>
            <a
              class="item"
              href="https://stanforddaily.com/2023/07/19/stanford-president-resigns-over-manipulated-research-will-retract-at-least-3-papers/"
              >Stanford president resigns over manipulated research, will
              retract 3 papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 17:43:19</span
              ><span class="points-container"
                >Points: <span class="points">732</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36790301"
                  >Comments</a
                ><span class="descendants">: 436</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36790280">
          <h3>
            <a
              class="item"
              href="https://fonts.google.com/knowledge/choosing_type/a_checklist_for_choosing_type"
              >A Checklist for Choosing Type</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 17:41:48</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36790280"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36790238">
          <h3>
            <a
              class="item"
              href="https://interrupt.memfault.com/blog/embedded-async-rust"
              >Asynchronous Rust on Cortex-M Microcontrollers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 17:39:08</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36790238"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36789010">
          <h3>
            <a class="item" href="https://www.vipshek.com/blog/interaction"
              >Beyond introvert vs. extrovert</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 16:26:31</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36789010"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36788783">
          <h3>
            <a class="item" href="https://minilanguage.com/"
              >Mini – The Minimal Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 16:13:12</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36788783"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36788274">
          <h3>
            <a
              class="item"
              href="https://triblive.com/news/children-relatives-of-alumni-no-longer-have-admissions-edge-at-carnegie-mellon-pitt/"
              >Children of alumni no longer have admissions edge at Carnegie
              Mellon, Pitt</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 15:44:24</span
              ><span class="points-container"
                >Points: <span class="points">426</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36788274"
                  >Comments</a
                ><span class="descendants">: 565</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36788210">
          <h3>
            <a class="item" href="https://infisical.com/"
              >Show HN: Infisical – open-source secret management platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 15:40:01</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36788210"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <a href="https://infisical.com/">https://infisical.com/</a>).
              <p>
                Excited to show you all the progress that we’ve made in the past
                few months after our Launch HN in February (<a
                  href="https://news.ycombinator.com/item?id=34955699"
                  >https://news.ycombinator.com/item?id=34955699</a
                >) and Show HN in December (<a
                  href="https://news.ycombinator.com/item?id=34055132"
                  >https://news.ycombinator.com/item?id=34055132</a
                >).
              </p>
              <p>
                During the previous Show HN and Launch HN, we received a ton of
                feedback which helped us improve Infisical. We’ve since
                released:
              </p>
              <p>
                - Secret scanning: a new toolset to block commits with hardcoded
                secrets and continuously monitor your code.
              </p>
              <p>
                - Folders: Deeper organizational structure within projects to
                accommodate for microservice architectures and storage of more
                secret types like user API keys and OAuth tokens.
              </p>
              <p>
                - Node and Python SDKs, Webhooks: More ways to integrate and
                start syncing secrets with Infisical across your infrastructure.
              </p>
              <p>
                - Integrations with Terraform, Supabase, Railway, Checkly,
                Cloudflare Pages, Azure Key Vault, Laravel Forge, and more.
              </p>
              <p>
                - Secret Referencing and Importing: to create a proper single
                source of truth.
              </p>
              <p>
                - 1-click deployments to AWS EC2, Digital Ocean, Render, Fly.io:
                More ways to self-host Infisical on your own infrastructure.
              </p>
              <p>
                In addition, the platform has become more stable and undergone a
                full-coverage penetration test; we’ve also begun the SOC 2 (Type
                II) certification process.
              </p>
              <p>
                Overall, we’re really lucky to have support of the developer
                community, and, in fact, Infisical has gathered over 7k GitHub
                stars, and now processes over 200 million secrets per month for
                everyone from solo developers to public enterprises.
              </p>
              <p>
                Our repo is published under the MIT license so any developer can
                use Infisical. Again, the goal is to not charge individual
                developers. We make money by charging a license fee for some
                enterprise features as well as providing a hosted version and
                support.
              </p>
              <p>
                Check out Infisical Cloud (<a href="https://infisical.com/"
                  >https://infisical.com/</a
                >) or self-host Infisical on your own infrastructure (<a
                  href="https://github.com/Infisical/infisical"
                  >https://github.com/Infisical/infisical</a
                >). We’d love to hear what you think!
              </p>
              <p>
                We’re excited to continue building Infisical, and keep shipping
                features for you. Please let us know if you have any thoughts,
                feedback, or feature suggestions!
              </p>
            </div>
          </section>
        </section>
        <section id="36788206">
          <h3>
            <a
              class="item"
              href="https://pencil.toast.cafe/bunker-labs/simply-parse-in-c"
              >Simply Parse in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 15:39:50</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36788206"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36787746">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/society/2023/jul/14/video-games-gambling-big-spenders"
              >‘No way out’: how video games use tricks from gambling to attract
              big spenders</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 15:10:10</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36787746"
                  >Comments</a
                ><span class="descendants">: 215</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36787473">
          <h3>
            <a class="item" href="https://gpux.ai/blog/sdxl_50_faster"
              >Use pytorch2+cu118 with ADA hardware for 50%+ speedup</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 14:55:54</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36787473"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36787200">
          <h3>
            <a
              class="item"
              href="https://www.cyberdemon.org/2023/07/19/bunch-of-bits.html"
              >A disk is a bunch of bits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 14:41:45</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36787200"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36787136">
          <h3>
            <a class="item" href="https://onesignal.com/careers/4247164006"
              >OneSignal (YC S11) Is Hiring Software Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 14:38:31</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36785005">
          <h3>
            <a
              class="item"
              href="https://github.com/dabeaz-course/python-mastery"
              >Advanced Python Mastery</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 12:08:11</span
              ><span class="points-container"
                >Points: <span class="points">561</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36785005"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36782638">
          <h3>
            <a
              class="item"
              href="https://www.transportation.gov/pnt/what-radio-spectrum"
              >What Is Radio Spectrum?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 06:05:52</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36782638"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36782201">
          <h3>
            <a class="item" href="https://jazz-library.com/articles/comping/"
              >Jazz Comping (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 04:41:40</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36782201"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36776939">
          <h3>
            <a class="item" href="https://venturehacks.com/pricing"
              >It's easy to underprice your product (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-18 @ 18:14:57</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36776939"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36776407">
          <h3>
            <a
              class="item"
              href="http://commonplace.online/article/saline-survivance/"
              >The life of salt and the limits of colonization in the
              southwest</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-18 @ 17:40:19</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36776407"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36770815">
          <h3>
            <a
              class="item"
              href="https://worldsensorium.com/green-oases-nycs-community-gardens/"
              >Green Oases: NYC’s Community Gardens</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-18 @ 11:51:03</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36770815"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36770047">
          <h3>
            <a
              class="item"
              href="https://blog.adafruit.com/2023/07/12/when-open-becomes-opaque-the-changing-face-of-open-source-hardware-companies/"
              >When open becomes opaque: The changing face of open-source
              hardware companies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-18 @ 09:59:51</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36770047"
                  >Comments</a
                ><span class="descendants">: 184</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36769565">
          <h3>
            <a
              class="item"
              href="https://cinemasojourns.com/2023/07/18/portable-grindhouse-the-lost-art-of-the-vhs-box/"
              >Portable Grindhouse: The Lost Art of the VHS Box</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-18 @ 08:42:23</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36769565"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
