<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35965253">
          <h3>
            <a
              class="item"
              href="https://sashachapin.substack.com/p/how-to-spot-cult-leader-personalities"
              >How to Spot Cult Leader Personalities</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 17:44:33</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35965253"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35964763">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-05-16/a-us-senator-just-used-chatgpt-for-opening-remarks-at-a-hearing"
              >US Senator Uses ChatGPT for Opening Remarks at a Hearing on AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 17:08:44</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35964763"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35964635">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/05/15/windows_10_21h2_support/"
              >Microsoft will upgrade Windows 10 21H2 users whether they like it
              or not</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 17:00:24</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35964635"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35964424">
          <h3>
            <a
              class="item"
              href="https://www.fforward.ai/blog/posts/the-data-deception-why-most-startups-are-doing-data-driven-decision-making-wrong"
              >Why Most Startups Are Doing Data-Driven Decision Making Wrong</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 16:46:30</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35964424"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35964397">
          <h3>
            <a class="item" href="https://leta.mullvad.net/"
              >Mullvad Leta (Search Engine)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 16:44:49</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35964397"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35963936">
          <h3>
            <a class="item" href="https://github.com/microsoft/guidance"
              >A guidance language for controlling LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 16:14:11</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35963936"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35962667">
          <h3>
            <a class="item" href="https://sha-mbles.github.io/"
              >Chosen-prefix collision for SHA-1 (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 14:50:32</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35962667"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35962213">
          <h3>
            <a class="item" href="https://sqlite.org/releaselog/3_42_0.html"
              >SQLite 3.42.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 14:16:12</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35962213"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35961817">
          <h3>
            <a
              class="item"
              href="https://www.thenewatlantis.com/publications/rational-magic"
              >Rational Magic</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 13:44:55</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35961817"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35961700">
          <h3>
            <a
              class="item"
              href="https://www.erlang.org/blog/otp-26-highlights/"
              >Erlang/OTP 26 Highlights</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 13:36:44</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35961700"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35961697">
          <h3>
            <a class="item" href="https://blog.cloudflare.com/updated-tos/"
              >Goodbye, section 2.8 and hello to Cloudflare’s new terms of
              service</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 13:36:34</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35961697"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35961590">
          <h3>
            <a
              class="item"
              href="https://github.com/hendricius/the-sourdough-framework"
              >The Sourdough Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 13:27:56</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35961590"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35961309">
          <h3>
            <a
              class="item"
              href="https://www.alcademics.com/index-of-ice-experiments-on-alcademics.html"
              >Experiments in Making Cocktail Ice</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 13:04:34</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35961309"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35960663">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/05/apple-previews-live-speech-personal-voice-and-more-new-accessibility-features/"
              >Apple previews Live Speech, Personal Voice, and more new
              accessibility features</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 12:07:00</span
              ><span class="points-container"
                >Points: <span class="points">447</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35960663"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35960662">
          <h3>
            <a class="item" href="https://death.andgravity.com/output"
              >Why you should still read the docs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 12:06:56</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35960662"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35960606">
          <h3>
            <a class="item" href="https://jobs.lever.co/buildzoom"
              >BuildZoom (better way to build custom homes) Is hiring a Growth
              Associate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 12:00:46</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35960125">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/openai-chief-goes-before-us-congress-propose-licenses-building-ai-2023-05-16/"
              >OpenAI chief goes before US Congress to propose licenses for
              building AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 11:06:54</span
              ><span class="points-container"
                >Points: <span class="points">278</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35960125"
                  >Comments</a
                ><span class="descendants">: 361</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35960018">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/widely-used-chemical-strongly-linked-parkinson-s-disease"
              >Widely used chemical strongly linked to Parkinson’s disease</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 10:52:47</span
              ><span class="points-container"
                >Points: <span class="points">557</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35960018"
                  >Comments</a
                ><span class="descendants">: 277</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35959991">
          <h3>
            <a
              class="item"
              href="https://fortran-lang.discourse.group/t/optimization-without-using-derivatives-the-prima-package-its-fortran-implementation-and-its-inclusion-in-scipy/5798"
              >Optimization Without Derivatives: Prima Fortran Version and
              Inclusion in SciPy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 10:49:29</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35959991"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35959482">
          <h3>
            <a
              class="item"
              href="https://redpanda.com/blog/why-fsync-is-needed-for-data-safety-in-kafka-or-non-byzantine-protocols"
              >Why `fsync()`: Losing unsynced data on a single node leads to
              global data loss</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 09:32:50</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35959482"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35958715">
          <h3>
            <a class="item" href="https://oblivus.com"
              >Show HN: Oblivus GPU Cloud – Affordable and scalable GPU servers
              from $0.29/hr</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 07:30:18</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35958715"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
            <div class="text">
              <p>
                This is Doruk from Oblivus, and I'm excited to announce the
                launch of our platform, Oblivus Cloud. After more than a year of
                beta testing, we're excited to offer you a platform where you
                can deploy affordable and scalable GPU virtual machines in as
                little as 30 seconds!
                <a href="https://oblivus.com/cloud"
                  >https://oblivus.com/cloud</a
                >
              </p>
              <p>- What sets Oblivus Cloud apart?</p>
              <p>
                At the start of our journey, we had two primary goals in mind:
                to democratize High-Performance Computing and make it as
                straightforward as possible. We understand that maintaining GPU
                servers through major cloud service providers can be expensive,
                with hidden fees adding to the burden of running and maintaining
                servers. Additionally, the cloud can sometimes be overly complex
                for individuals who don't have much knowledge but still require
                powerful computing resources. That's why we decided to create a
                platform that offers affordable pricing, easy usability, and
                high-quality performance.
              </p>
              <p>- Features</p>
              <p>
                1. Fully customizable infrastructure that lets you switch
                between CPU and GPU configurations to suit your needs.
              </p>
              <p>
                2. Transparent and affordable per-minute-based Pay-As-You-Go
                pricing with no hidden fees. Plus, free data ingress and egress.
                (Pricing:
                <a href="https://oblivus.com/pricing/"
                  >https://oblivus.com/pricing/</a
                >)
              </p>
              <p>
                3. Optimized cost with storage and IP address-only billing when
                the virtual machine is shut down.
              </p>
              <p>
                4. Each virtual machine comes with 10Gbps to 40Gbps public
                network connectivity.
              </p>
              <p>
                5. NVMe ($0.00011/GB/hr) and HDD ($0.00006/GB/hr) storage that
                is 3x replicated to fulfill your storage needs.
              </p>
              <p>
                6. Choose from a variety of cutting-edge CPUs and 10
                state-of-the-art GPU SKUs. (Availability:
                <a href="https://oblivus.com/availability/"
                  >https://oblivus.com/availability/</a
                >)
              </p>
              <p>
                7. OblivusAI OS images come with pre-installed ML libraries, so
                you can start training your models right away without the hassle
                of installing and configuring the necessary libraries.
              </p>
              <p>
                8. If you're working with a team, utilize our organization
                feature to simplify the billing process. Everyone in your
                organization uses the same billing profile, so you don't need to
                keep track of multiple accounts.
              </p>
              <p>
                9. No quotas or complex verification processes. Whether you
                represent a company, an institution, or you're a researcher, you
                have full access to our infrastructure without any limitations.
              </p>
              <p>
                10. Easy-to-use API with detailed documentation so that you can
                integrate your code with ours.
              </p>
              <p>- Pricing</p>
              <p>
                At Oblivus Cloud, we provide pricing that is affordable,
                transparent, and up to 80% cheaper than major cloud service
                providers. Here is a breakdown of our pricing:
              </p>
              <p>
                1. CPU-based virtual machines starting from just $0.019/hour.
              </p>
              <p>2. NVIDIA Quadro RTX 4000s starting from $0.27/hour.</p>
              <p>3. Tesla V100s starting from $0.51/hour.</p>
              <p>4. NVIDIA A40s and RTX A6000s starting from $1.41/hour.</p>
              <p>
                We also offer 6 other GPU SKUs to help you accurately size your
                workloads and only pay for what you need. Say goodbye to hidden
                fees and unpredictable costs.
              </p>
              <p>
                If you represent a company, be sure to register for a business
                account to access even better pricing rates.
              </p>
              <p>- Promo Code</p>
              <p>
                Join us in celebrating the launch of Oblivus Cloud by claiming
                your $1 free credit! This may sound small, but it's enough to
                get started with us and experience the power of our platform.
                With $1, you can get over 3 hours of computing on our most
                affordable GPU-based configuration, or over 50 hours of
                computing on our cheapest CPU-based configuration.
              </p>
              <p>
                To redeem this free credit, simply use the code HN_1 on the 'Add
                Balance' page after registration.
              </p>
              <p>
                Register now at
                <a href="https://console.oblivus.com/register"
                  >https://console.oblivus.com/register</a
                >
              </p>
              <p>- Quick Links</p>
              <p>
                Website: <a href="https://oblivus.com/">https://oblivus.com/</a>
              </p>
              <p>
                Console:
                <a href="https://console.oblivus.com/"
                  >https://console.oblivus.com/</a
                >
              </p>
              <p>
                Company Documentation:
                <a href="https://docs.oblivus.com/"
                  >https://docs.oblivus.com/</a
                >
              </p>
              <p>
                API Documentation:
                <a
                  href="https://documenter.getpostman.com/view/21699896/UzBtoQ3e"
                  >https://documenter.getpostman.com/view/21699896/UzBtoQ3e</a
                >
              </p>
              <p>
                If you have any questions, feel free to post them below and I'll
                be happy to assist you. You can also directly email me at
                doruk@oblivus.com!
              </p>
            </div>
          </section>
        </section>
        <section id="35957814">
          <h3>
            <a
              class="item"
              href="https://unchartedterritories.tomaspueyo.com/p/seaflooding"
              >Seaflooding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 04:40:41</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35957814"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35957811">
          <h3>
            <a class="item" href="https://sp23.datastructur.es/"
              >CS 61B Data Structures, Spring 2023 UC Berkeley</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-16 @ 04:40:32</span
              ><span class="points-container"
                >Points: <span class="points">270</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35957811"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35950921">
          <h3>
            <a
              class="item"
              href="https://heatmap.news/technology/so-how-do-you-actually-refill-an-aquifer"
              >So, How Do You Refill an Aquifer?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 16:37:24</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35950921"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35946279">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/united-states/2023/05/14/pinball-is-booming-in-america-thanks-to-nostalgia-and-canny-marketing"
              >Pinball is booming in America</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 10:59:42</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35946279"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35946181">
          <h3>
            <a
              class="item"
              href="https://orbitalhq.com/blog/2023-05-12-why-we-created-taxi"
              >Why we created Taxi, and why we felt the need for Another Schema
              Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 10:48:57</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35946181"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35944159">
          <h3>
            <a class="item" href="https://warms.maxbittker.repl.co/"
              >Pixpaint</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 05:23:13</span
              ><span class="points-container"
                >Points: <span class="points">591</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35944159"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35941369">
          <h3>
            <a
              class="item"
              href="https://blog.plover.com/notes/game-mechanics.html"
              >Notes on rarely-seen game mechanics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-14 @ 21:09:50</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35941369"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35937419">
          <h3>
            <a
              class="item"
              href="https://billydm.github.io/blog/daw-frontend-development-struggles/"
              >Digital Audio Workstation Front End Development Struggles</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-14 @ 12:17:03</span
              ><span class="points-container"
                >Points: <span class="points">322</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35937419"
                  >Comments</a
                ><span class="descendants">: 215</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35936828">
          <h3>
            <a
              class="item"
              href="https://austinkleon.com/2023/05/07/artists-must-be-allowed-to-make-bad-work/"
              >Artists must be allowed to make bad work</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-14 @ 10:03:59</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35936828"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
