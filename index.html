<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40303476">
          <h3>
            <a
              class="item"
              href="https://nymag.com/intelligencer/article/google-is-staring-down-its-first-serious-threats-in-years.html"
              >Google Is Staring Down Its First Serious Threats in Years</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 22:45:08</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40303476"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40303400">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/tech-industry/artificial-intelligence/stack-overflow-bans-users-en-masse-for-rebelling-against-openai-partnership-users-banned-for-deleting-answers-to-prevent-them-being-used-to-train-chatgpt"
              >Stack Overflow bans users en masse for rebelling against OpenAI
              partnership</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 22:33:03</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40303400"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40302731">
          <h3>
            <a
              class="item"
              href="https://research.google/blog/english-learners-can-now-practice-speaking-on-search/"
              >English learners can now practice speaking on Google Search</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 21:09:20</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40302731"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40302724">
          <h3>
            <a
              class="item"
              href="https://www.seriouseats.com/perfect-coffee-bubbles-signs-sounds-6824133"
              >A Scientific Run-Down of Coffee Blooming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 21:08:32</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40302724"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40302683">
          <h3>
            <a
              class="item"
              href="https://secretnyc.co/the-portal-connecting-nyc-to-dublin/"
              >A Portal Connecting NYC to Dublin Opens in Flatiron Today</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 21:03:04</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40302683"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40302665">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/empirical-health/jobs/1PW3OFe-engineering-lead"
              >Empirical Health (YC S23) is hiring engineering leads in NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 21:00:26</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40302201">
          <h3>
            <a class="item" href="https://hao-ai-lab.github.io/blogs/cllm/"
              >Consistency LLM: converting LLMs to parallel decoders accelerates
              inference 3.5x</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 19:55:07</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40302201"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40300482">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/introducing-the-model-spec"
              >OpenAI: Model Spec</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 17:11:18</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40300482"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40300454">
          <h3>
            <a class="item" href="https://chromakode.com/post/xkcd-machine/"
              >Development Notes from xkcd's "Machine"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 17:09:17</span
              ><span class="points-container"
                >Points: <span class="points">323</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40300454"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40300126">
          <h3>
            <a class="item" href="https://www.grafychat.com"
              >Show HN: I built a non-linear UI for ChatGPT</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 16:41:12</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40300126"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built this out of frustration of the evergrowing list of AI
                models and features to try and to fit my workflow.
              </p>
              <p>
                The visual approach clicks for me so i went with it, it provides
                more freedom and control of the outcome, because predictable
                results and increased productivity is what I’m after when using
                conversational AI.
              </p>
              <p>
                The app is packed with features, my most used are prompt
                library, voice input and text search, narration is useful too.
              </p>
              <p>
                The app is local-first and works right in the browser, no sign
                up needed and it's absolutely free to try.
              </p>
              <p>BYOAK – bring your own API Keys.</p>
              <p>Let me know what you think, any feedback is appreciated!</p>
            </div>
          </section>
        </section>
        <section id="40300023">
          <h3>
            <a
              class="item"
              href="https://pitchfork.com/news/steve-albini-storied-producer-and-icon-of-the-rock-underground-dies-at-61/"
              >Steve Albini has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 16:33:23</span
              ><span class="points-container"
                >Points: <span class="points">361</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40300023"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40299761">
          <h3>
            <a class="item" href="https://github.com/neondatabase/psql-describe"
              >Psql-describe: \d ported to JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 16:14:23</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40299761"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40299556">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40299556"
              >Launch HN: Baselit (YC W23) – Automatically Reduce Snowflake
              Costs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 15:54:54</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40299556"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
            <div class="text">
              <a href="https://baselit.ai/">https://baselit.ai/</a>), a tool
              that automatically optimizes Snowflake costs. Here’s a demo video:
              <a href="https://www.youtube.com/watch?v=Ls6VRzBQ-pQ"
                >https://www.youtube.com/watch?v=Ls6VRzBQ-pQ</a
              >.
              <p>
                Snowflake is one of the most widely used data warehouses today.
                It abstracts out the underlying compute infrastructure into
                “warehouses” for the user - compute units with t-shirt sizes
                (X-Small, Small, Medium etc.). In general, if you want to lower
                your data processing costs, the only thing you can do is to just
                process less data (i.e. query optimization). But Snowflake’s
                warehouse abstraction allows an extra dimension along which you
                can optimize - by minimizing the compute you need to process
                that same data (i.e. warehouse optimization). Baselit automates
                Snowflake warehouse optimization for you.
              </p>
              <p>
                While we were working on another idea last year (AI for SQL
                generation), users frequently shared with us how Snowflake costs
                had become a top concern, and cost optimization was now their
                business priority. Every few months, they would manually look
                for opportunities to cut down on costs (removing workloads or
                optimizing queries) - a time consuming process. We decided to
                build a solution that could automate cost optimization, and
                complement the manual effort of data teams.
              </p>
              <p>There are two key components of Baselit:</p>
              <p>
                1. Automated agents that cut down on warehouse idle time. This
                happens in one of two ways: cache optimization (when to suspend
                a warehouse vs letting it run idle) and cluster optimization
                (optimal spin down of clusters).
              </p>
              <p>
                You can easily find out how much these agents can save you.
                Here’s a SQL query that you can run on your Snowflake, and it
                will calculate your savings -
                <a href="https://baselit.ai/docs/savings-estimate"
                  >https://baselit.ai/docs/savings-estimate</a
                >
              </p>
              <p>
                2. Autoscaler that lets you create custom scaling policies for
                multi-cluster warehouses based on SLAs. Snowflake’s default
                policies (Economy and Standard) are not cost optimal in most
                cases, and they don’t give you any control.
              </p>
              <p>
                One use case for Autoscaler is that it helps you efficiently
                merge several warehouses into one multi-cluster warehouse - with
                a custom scaling policy that is optimal for a particular type of
                workload. In Autoscaler, you can set a parameter called “Allowed
                Queuing Time” that controls how fast a new cluster should spin
                up. For e.g. if you want to merge transformation workloads, you
                might want to set a higher queuing time. Baselit will slow down
                the cluster spin up, ensuring all clusters are running at a high
                utilization, and you’ll see a reduction in costs.
              </p>
              <p>
                We’ve built a bunch of other features that help in optimizing
                Snowflake costs: a dbt optimization feature that automatically
                picks the right warehouse size for dbt models through constant
                experimentation, a “cost lineage”, spend views by
                teams/roles/users, and automatic recommendations from scanning
                Snowflake metadata.
              </p>
              <p>
                Due to the nature of our product (access to Snowflake metadata
                required), we haven’t made Baselit self-serve yet. We invite you
                to run our savings query (<a
                  href="https://baselit.ai/docs/savings-estimate"
                  >https://baselit.ai/docs/savings-estimate</a
                >) and find out your potential savings. And if you’d like to
                know more about any of our features and get a live demo, you can
                book one at this link -
                <a href="https://calendly.com/baselit-sahil/baselit-demo"
                  >https://calendly.com/baselit-sahil/baselit-demo</a
                >
              </p>
              <p>
                We’d love to read your feedback and ideas on Snowflake
                optimization!
              </p>
            </div>
          </section>
        </section>
        <section id="40298927">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/ai/google-deepmind-isomorphic-alphafold-3-ai-model/"
              >AlphaFold 3 predicts the structure and interactions of life's
              molecules</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 15:07:10</span
              ><span class="points-container"
                >Points: <span class="points">690</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40298927"
                  >Comments</a
                ><span class="descendants">: 312</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40297946">
          <h3>
            <a class="item" href="https://github.com/google-research/timesfm"
              >TimesFM: Time Series Foundation Model for time-series
              forecasting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 13:34:34</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40297946"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40297748">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/marine/seabike-swimming-propeller/"
              >'Underwater bicycle' propels swimmers forward at superhuman
              speed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 13:13:22</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40297748"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40297280">
          <h3>
            <a class="item" href="https://github.com/google/zimtohrli"
              >Zimtohrli: A New Psychoacoustic Perceptual Metric for Audio
              Compression</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 12:30:17</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40297280"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40296429">
          <h3>
            <a class="item" href="https://github.com/irrustible/ointers"
              >Ointers: A library for representing pointers where bits have been
              stolen (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 10:42:02</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40296429"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40283954">
          <h3>
            <a
              class="item"
              href="https://www.core77.com/posts/132088/Fantastic-Industrial-Design-Student-Work-How-Long-Should-Objects-Last"
              >Industrial Design Student Work: "How Long Should Objects
              Last?"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 10:10:33</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40283954"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40283752">
          <h3>
            <a
              class="item"
              href="https://github.com/EtherDream/headphone-morse-transmitter"
              >Using AirPods as a Morse Transmitter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 09:31:44</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40283752"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40282706">
          <h3>
            <a
              class="item"
              href="https://www.collectorsweekly.com/articles/how-a-rare-set-of-japanese-trade-publications-helped-japan-form-a-new-graphic-identity/"
              >Japanese Trade Publications Helped Japan Form a New Graphic
              Identity (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 05:40:42</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40282706"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40282671">
          <h3>
            <a
              class="item"
              href="https://hakaimagazine.com/features/the-magnificent-lives-and-quiet-loss-of-muskrats/"
              >The Waning Reign of the Muskrat</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 05:34:07</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40282671"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40277945">
          <h3>
            <a class="item" href="https://github.com/galliumdata/adumbra"
              >Adumbra: A lightweight Java library for bitmap steganography</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 18:34:30</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40277945"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40276465">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=1fikd9NfsSA"
              >Largest model railway launches inductive Formula 1 circuit
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 16:31:05</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40276465"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40273772">
          <h3>
            <a class="item" href="https://github.com/build-cpp/cmkr"
              >Cmkr – a modern build system based on CMake and TOML</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 12:20:19</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40273772"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40273516">
          <h3>
            <a class="item" href="https://32by32.com/radius-full-page-display/"
              >Radius Full Page Display</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 11:51:30</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40273516"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40272514">
          <h3>
            <a
              class="item"
              href="https://ifesunmola.com/how-to-use-the-foreign-function-api-in-java-22-to-call-c-libraries/"
              >How to Use the Foreign Function API in Java 22 to Call C
              Libraries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 08:40:02</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40272514"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40272339">
          <h3>
            <a class="item" href="https://climbing.ai/"
              >Show HN: AI climbing coach – visualize how to climb any route
              based on your body</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 08:09:38</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40272339"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
            <div class="text">
              <p>
                You can see the demo here:
                <a href="https://www.youtube.com/watch?v=cnvNPWoYZz4"
                  >https://www.youtube.com/watch?v=cnvNPWoYZz4</a
                >
              </p>
              <p>
                Will be open sourcing the model, backend, and frontend codebase
                soon!
              </p>
            </div>
          </section>
        </section>
        <section id="40271797">
          <h3>
            <a class="item" href="https://faultlore.com/blah/abi-puns/"
              >Pair Your Compilers at the ABI Café</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 06:35:04</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40271797"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40263377">
          <h3>
            <a
              class="item"
              href="https://www.merriam-webster.com/wordplay/your-deadline-wont-kill-you"
              >The Bloody History of 'Deadline'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 09:23:54</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40263377"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
