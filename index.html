<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41602096">
          <h3>
            <a
              class="item"
              href="https://news.rice.edu/news/2024/rice-research-could-make-weird-ai-images-thing-past"
              >New AI diffusion model approach solves the aspect ratio
              problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 13:59:25</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41602096"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41602056">
          <h3>
            <a
              class="item"
              href="https://taylor.town/reactive-relational-algebra"
              >Reactive Relational Algebra</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 13:54:41</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41602056"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41601854">
          <h3>
            <a
              class="item"
              href="https://www.blopig.com/blog/2021/07/linux-horror-stories-and-protection-spells-volume-i/"
              >Linux Horror Stories and Protection Spells (Volume I)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 13:32:01</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41601854"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41601730">
          <h3>
            <a class="item" href="https://github.com/cupy/cupy"
              >CuPy: NumPy and SciPy for GPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 13:18:06</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41601730"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41601565">
          <h3>
            <a
              class="item"
              href="https://www.roadandtrack.com/news/a62283108/radar-detector-legend-michael-valentine-has-died/"
              >Radar Detector Legend Michael Valentine Has Died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 12:59:51</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41601565"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41601347">
          <h3>
            <a class="item" href="https://xn--treo-l3a.nz/"
              >Tō Reo – A Māori Spellchecker</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 12:30:11</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41601347"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41601141">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/permitflow?departmentId=d33195eb-8978-4439-abc6-5a8a072de808"
              >PermitFlow (YC W22) Is Hiring Senior/Staff+ Engineers and
              Designers in NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 12:01:20</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41600756">
          <h3>
            <a
              class="item"
              href="https://dmitry.gr/?r=05.Projects&amp;proj=35.%20Linux4004"
              >Linux/4004: booting Linux on Intel 4004 for fun, art, and no
              profit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 11:04:15</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41600756"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41600179">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2409.12917"
              >Training Language Models to Self-Correct via Reinforcement
              Learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 09:19:40</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41600179"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41600177">
          <h3>
            <a class="item" href="https://github.com/commaai/openpilot"
              >Openpilot – Operating system for robotics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 09:19:00</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41600177"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41600075">
          <h3>
            <a
              class="item"
              href="https://github.com/DavidBuchanan314/parallel-png-proposal"
              >Parallel PNG Proposal (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 08:53:12</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41600075"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41599109">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2409.07591"
              >A rigid but foldable indoor airship aerial system for cave
              exploration</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 05:41:23</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41599109"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41598119">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/contextual-retrieval"
              >Contextual Retrieval</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 01:57:22</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41598119"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41597929">
          <h3>
            <a
              class="item"
              href="https://travel.stackexchange.com/questions/26780/is-there-a-flight-search-engine-that-combines-flights-from-different-airlines"
              >A flight search engine that combines flights from different
              airlines? (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 01:20:32</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41597929"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41597250">
          <h3>
            <a class="item" href="https://kibty.town/blog/arc/"
              >Gaining access to anyones Arc browser without them even visiting
              a website</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 23:04:42</span
              ><span class="points-container"
                >Points: <span class="points">628</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41597250"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41596466">
          <h3>
            <a
              class="item"
              href="https://ianspence.com/blog/2024-09/github-email-hijack/"
              >GitHub notification emails used to send malware</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 21:16:39</span
              ><span class="points-container"
                >Points: <span class="points">394</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41596466"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41596336">
          <h3>
            <a
              class="item"
              href="https://www.anfractuosity.com/projects/cnc-microscopy/"
              >Show HN: CNC Microscopy for Fun</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 20:59:28</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41596336"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41595310">
          <h3>
            <a
              class="item"
              href="https://www.zombiezen.com/blog/2024/09/zb-early-stage-build-system/"
              >Zb: An Early-Stage Build System</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 19:16:04</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41595310"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41592552">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/5g-antenna-transparent-window"
              >Glass Antenna Turns windows into 5G Base Stations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 14:53:32</span
              ><span class="points-container"
                >Points: <span class="points">338</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41592552"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41591399">
          <h3>
            <a
              class="item"
              href="https://risk-engineering.org/concept/Rasmussen-practical-drift"
              >Drift towards danger and the normalization of deviance (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 12:58:18</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41591399"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41591018">
          <h3>
            <a class="item" href="https://github.com/MightyMoud/sidekick"
              >Show HN: A CLI tool I made to self-host any app with two commands
              on a VPS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 12:17:05</span
              ><span class="points-container"
                >Points: <span class="points">358</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41591018"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41590682">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41590682"
              >Show HN: Sourcetable – AI Spreadsheet and Data Platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 11:28:24</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41590682"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
            <div class="text">
              <a href="https://sourcetable.com">https://sourcetable.com</a>).
              <p>
                Sourcetable is an AI-native spreadsheet that syncs with all your
                data. Users pair with an AI copilot that helps them do their
                spreadsheet work, as well as more database-centric analysis and
                SQL.
              </p>
              <p>
                Soucetable syncs with databases including Postgres, MySQL, and
                MongoDB, and over 100+ business applications including Stripe,
                Zendesk, Hubspot, Quickbooks and Google Analytics. That data is
                available in a spreadsheet, and any models you build
                automatically update in near-real-time as new data flows in. The
                core primitives are AI + spreadsheet + data sync + storage +
                compute.
              </p>
              <p>
                If you want to play with Sourcetable today, the easiest way is
                to upload a CSV and start asking questions.
              </p>
              <p>
                Who is it for? Sourcetable is for analysts, operators and
                finance folk doing data-centric work in a spreadsheet.
                Sourcetable’s spreadsheet-based AI assistant understands
                workbook range selection and can adjust scope context to the
                datasets you are working with. You can talk directly to your
                database and SaaS integrations, which is great for analysis,
                data search and retrieval, SQL writing &amp; editing (including
                writing joins across different datasets), and automatic chart
                creation.
              </p>
              <p>
                Niching down, if you work in operations at a &lt;50 person
                startup or SMB and your company relies on a Postgres or MySQL
                database, Sourcetable is an affordable reporting tool with
                turnkey data infrastructure that doesn’t require code or
                engineers to set up.
              </p>
              <p>
                Spreadsheets are the most used analytical tool on the planet. AI
                is a platform shift with broad applications. We are staying
                open-minded about users and use cases since everything is so
                new.
              </p>
              <p>
                Backstory: I spent ten years working in de-facto operations and
                technical roles at startups. Sourcetable draws from that
                experience of needing better data tooling inside spreadsheets,
                and constantly hacking ad hoc solutions to fill the gap. Andrew
                (CTO / co-founder) previously had a deep learning company and
                was initially drawn to the idea that Sourcetable could be an
                operating system for the web. We’re both Aussie expats in the
                Bay Area, which is how we met. Internally, we think of
                Sourcetable as an application platform, with AI applications
                being a useful and interesting place to focus.
              </p>
              <p>
                Features &amp; Use Cases: Talk to your CSV files, spreadsheets,
                integrations, and datasets using LLMs. AI + data work:
                Text-to-SQL, search and retrieval from databases, LLM-based data
                analysis. (This is an entirely different experience to what
                Copilot/Gemini &amp; Excel/Sheets provide, since they are thin
                workbooks and not data platforms.) AI + spreadsheet work:
                formula assist, workbook analysis, data cleaning, chart
                creation, error handling, summarization, chat, etc. Automated
                reporting: data is synced, reports you build stay up to date.
                No-code data access: give the business team safe database access
                so they will leave you alone! Centralizing data for
                cross-channel reporting. (e.g. Postgres + Stripe + Mailchimp)
                Analyzing large CSV files: Sourcetable can handle multi-gigabit
                files. (Google Sheets can’t handle large data and the experience
                in Excel is rather cumbersome.)
              </p>
              <p>
                Technical Details: Sourcetable was built to be fast. It was also
                built to scale.
              </p>
              <p>
                AI: LLama 3 (via Groq), Claude, GPT-4o, LiteLLM, custom LLMs
              </p>
              <p>
                Frontend: DuckDB, React, ShadCN, AntV / Bizcharts, Plotly,
                CodeMirror, Hookstate
              </p>
              <p>
                Backend: DuckDB, Python, Cassandra, Redis, NGINX, Cloudflare
              </p>
              <p>
                Data Eng &amp; Transformations: Fivetran, DBT, Apache Arrow,
                SQLglot
              </p>
              <p>
                Distributed Computing &amp; Scaling: Daft, Ray, Cloud Formation
              </p>
              <p>Other: Linux Namespaces, Dill (U.Queensland)</p>
              <p>
                A huge thank you to the open source community, and a special
                shout-out to DuckDB for being so damn fast. Thank you also to
                Groq &amp; Anthropic for the rate limit increases in time for
                this ShowHN post!
              </p>
              <p>–</p>
              <p>Feedback: Product feedback is welcome! eoin@sourcetable.com</p>
            </div>
          </section>
        </section>
        <section id="41590466">
          <h3>
            <a class="item" href="https://larslofgren.com/forbes-marketplace/"
              >Forbes Marketplace: The Parasite SEO Company Trying to Devour Its
              Host</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 10:44:08</span
              ><span class="points-container"
                >Points: <span class="points">464</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41590466"
                  >Comments</a
                ><span class="descendants">: 192</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41589361">
          <h3>
            <a
              class="item"
              href="https://neilmadden.blog/2024/09/18/digital-signatures-and-how-to-avoid-them/"
              >Digital signatures and how to avoid them</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 07:12:16</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41589361"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41578440">
          <h3>
            <a class="item" href="http://www.mattmahoney.net/dc/text.html"
              >Large Text Compression Benchmark</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-18 @ 11:36:46</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41578440"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41565056">
          <h3>
            <a
              class="item"
              href="https://wunkolo.github.io/post/2024/09/gpu-debug-scopes/"
              >GPU Debug Scopes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-17 @ 06:59:52</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41565056"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41562506">
          <h3>
            <a
              class="item"
              href="https://placesjournal.org/article/julia-childs-kitchens/"
              >Julia Child's Kitchens</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-16 @ 23:54:56</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41562506"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41559404">
          <h3>
            <a
              class="item"
              href="https://www.zdnet.com/article/linus-torvalds-muses-about-maintainer-gray-hairs-and-the-next-king-of-linux/"
              >Linus Torvalds muses about maintainer gray hairs and the next
              'King of Linux'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-16 @ 19:08:17</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41559404"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41559024">
          <h3>
            <a class="item" href="https://hengyiwang.github.io/projects/spanner"
              >3D Reconstruction with Spatial Memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-16 @ 18:29:59</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41559024"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41550907">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=Bicjxl4EcJg"
              >The Cheating Device (ChatGPT on a TI-84) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-15 @ 22:15:22</span
              ><span class="points-container"
                >Points: <span class="points">296</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41550907"
                  >Comments</a
                ><span class="descendants">: 172</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
