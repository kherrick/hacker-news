<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41155996">
          <h3>
            <a
              class="item"
              href="https://www.cppstories.com/2024/enum-improvements/"
              >Enum class improvements for C++17, C++20 and C++23</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 20:09:37</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41155996"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41155214">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/dispatches-from-the-farm-upstate"
              >Dispatches from the farm upstate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 17:55:25</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41155214"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41155177">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/adtac/eb639d3c707b55a28f0ee9a420aa7e0c"
              >Using your Kindle as an e-ink monitor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 17:49:08</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41155177"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41155164">
          <h3>
            <a class="item" href="https://github.com/dessant/buster"
              >Buster: Captcha Solver for Humans</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 17:47:18</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41155164"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41154826">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/trellis/jobs/1ypWafM-founding-engineer-full-time-backend-ml-infra"
              >Trellis (YC W24) is hiring eng to build AI workflows for
              unstructured data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 17:01:59</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41154616">
          <h3>
            <a class="item" href="https://github.com/lvkv/whenfs"
              >WhenFS: Calender Is Now a File System</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 16:35:36</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41154616"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41154560">
          <h3>
            <a class="item" href="https://praise-me.fly.dev/"
              >Praise My GitHub Profile</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 16:28:22</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41154560"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41154410">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/adtac/eb639d3c707b55a28f0ee9a420aa7e0c"
              >Jailbroke my Kindle to use it as an e-ink monitor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 16:08:25</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41154410"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41154135">
          <h3>
            <a class="item" href="https://phoboslab.org/log/2024/08/high_impact"
              >Porting My JavaScript Game Engine to C for No Reason</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 15:26:34</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41154135"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41154053">
          <h3>
            <a
              class="item"
              href="https://blog.philosophicalsociety.org/2018/01/10/apprentice-journeyman-and-master-the-medieval-guild/"
              >Apprentice, Journeyman, and Master: The Medieval Guild (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 15:11:53</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41154053"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41153902">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/science/archaeology/china-reaches-back-in-time-to-challenge-the-west-way-way-back-236c4e90"
              >Chinese archaeologists are striking out along the Silk Road</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 14:50:00</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41153902"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41153892">
          <h3>
            <a class="item" href="https://github.com/hackclub/RAM-a-thon"
              >Written by a 16 year old, a book on how computers work</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 14:48:42</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41153892"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41153712">
          <h3>
            <a class="item" href="https://kittycal.net"
              >Show HN: KittyCal – minimalist PWA calendar app for couples</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 14:15:00</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41153712"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm happy to share with you KittyCal, an installable calendar
                web app I made over the past two months. Existing calendar apps
                often focus on scheduling and require many steps to create one
                event. KittyCal, on the other hand, removes hourly scheduling
                and keeps everything on one screen.
              </p>
              <p>
                How does it work? Just enter your email address, and we will
                send you a pair of calendar links (blue and red). There is no
                login process, click the magic link or scan the QR code to
                access your calendar. You can then add the page to home screen
                and use it like a native app.
              </p>
              <p>
                Last year, I built a bare bones version of KittyCal for my
                partner and myself because we wanted a private calendar that
                launches instantly for casual note-taking. It's worked well for
                us since, and I'm hoping this multi-tenant version can benefit
                more people with similar needs.
              </p>
              <p>Please try it out and let me know what you think!</p>
            </div>
          </section>
        </section>
        <section id="41153158">
          <h3>
            <a class="item" href="https://www.belenios.org/"
              >Belenios: Verifiable online voting system</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 12:41:33</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41153158"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41153093">
          <h3>
            <a
              class="item"
              href="https://www.politico.com/news/magazine/2024/08/04/us-spies-soviet-technology-00164126"
              >The Untold Story of How US Spies Sabotaged Soviet Technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 12:26:33</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41153093"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41153039">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2301.13142"
              >Self-Compressing Neural Networks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 12:17:16</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41153039"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41153035">
          <h3>
            <a class="item" href="https://candix.com"
              >Show HN: Candix, a confidential, reverse recruiting platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 12:15:37</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41153035"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's free for candidates, while we charge companies for access
                to the pool. They’re charged a subscription fee, not a
                traditional success fee, because it’s the only way to remain
                forever candidate-centric and not obsessed with placing profiles
                at any cost, like agencies are.
              </p>
              <p>
                I'm opposed to the AI trends in recruitment. Recruitment is
                opaque and needs more humanity in the process, not less.
                Consequently, we're stubborn about keeping humans involved at
                every level, from onboarding to support. This results in high
                operational costs, which we are working hard to streamline.
              </p>
              <p>
                Confidentiality is what truly sets Candix apart. It's a tricky
                concept in recruitment, though, as it needs to be balanced with
                recruiters' need to know about your background to make hiring
                decisions. Our approach is to protect access to the pool with
                NDAs and limit profile visibility to relevant companies only.
                Additionally, we limit points of access to one per company and
                thoroughly monitor all recruiter activity on the site to prevent
                any leakage.
              </p>
              <p>
                For those who are not open to receiving offers, one interesting
                feature is the option to mark your profile as unavailable.
                Interested companies won’t reach out, but they will be able to
                place an alert on your profile to be notified when this changes,
                effectively boosting your future search.
              </p>
              <p>
                We operate in the US and European markets, helping people
                connect with over seventy companies, such as OpenAI and Ramp.
              </p>
              <p>What do you think about the tool and its positioning?</p>
            </div>
          </section>
        </section>
        <section id="41152559">
          <h3>
            <a
              class="item"
              href="https://github.com/organicmaps/organicmaps/blob/master/docs/EXPERIMENTAL_PUBLIC_TRANSPORT_SUPPORT.md"
              >Organic maps: Experimental feed based public transport mapping</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 10:37:37</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41152559"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41152375">
          <h3>
            <a
              class="item"
              href="https://rabbitictranslator.com/contribute-to-kde-without-cpp/"
              >You can contribute to KDE with non-C++ code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 09:59:50</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41152375"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41151825">
          <h3>
            <a
              class="item"
              href="https://pypy.org/posts/2024/08/toy-knownbits.html"
              >A Knownbits Abstract Domain for the Toy Optimizer, Correctly</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 07:54:22</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41151825"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41151799">
          <h3>
            <a class="item" href="https://thephd.dev/improving-_generic-in-c2y"
              >Improving _Generic in C2y</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 07:46:11</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41151799"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41151476">
          <h3>
            <a class="item" href="https://github.com/ataradov/usb-sniffer-lite"
              >USB Sniffer Lite for RP2040</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 06:24:53</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41151476"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41151439">
          <h3>
            <a
              class="item"
              href="https://docs.racket-lang.org/rhombus/index.html"
              >Rhombus: Macro-extensible language with conventional syntax built
              on Racket</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 06:11:00</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41151439"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41151409">
          <h3>
            <a
              class="item"
              href="https://www.croatiaweek.com/tomatoes-croatian-island-taste/"
              >Tomato nostalgia as I relive my Croatian island childhood</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 05:58:37</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41151409"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41150317">
          <h3>
            <a
              class="item"
              href="https://nicholas.carlini.com/writing/2024/how-i-use-ai.html"
              >How I Use "AI"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 00:37:53</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41150317"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41150249">
          <h3>
            <a
              class="item"
              href="https://www.johndcook.com/blog/2024/08/03/polylog/"
              >Evaluating a class of infinite sums in closed form</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 00:20:10</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41150249"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41150095">
          <h3>
            <a class="item" href="https://farm.bot/"
              >Open Source Farming Robot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-03 @ 23:37:52</span
              ><span class="points-container"
                >Points: <span class="points">594</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41150095"
                  >Comments</a
                ><span class="descendants">: 302</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41134218">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Ken_Leishman"
              >Ken Leishman</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 22:18:10</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41134218"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41131860">
          <h3>
            <a class="item" href="https://www.thespacereview.com/article/4738/1"
              >Review of Dark Star: A New History of the Space Shuttle</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 18:09:23</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41131860"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41120789">
          <h3>
            <a
              class="item"
              href="https://news.lettersofnote.com/p/i-miss-lorina-bulwer"
              >I Miss Lorina Bulwer: A hand-stitched letter of note</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 16:42:12</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41120789"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
