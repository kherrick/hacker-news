<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42206556">
          <h3>
            <a
              class="item"
              href="https://grayduck.mn/2024/11/21/handling-cookies-is-a-minefield/"
              >Handling Cookies Is a Minefield</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 17:28:11</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42206556"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42206502">
          <h3>
            <a class="item" href="https://www.thenile.dev/blog/distributed-ddl"
              >Pg_karnak: Transactional schema migration across tenant
              databases</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 17:23:22</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42206502"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42204939">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42204939"
              >Launch HN: Fresco (YC F24) – AI Copilot for Construction
              Superintendents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 15:03:43</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42204939"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <a href="https://fresco-ai.com/">https://fresco-ai.com/</a>). We
              use AI to quickly create and manage documentation for construction
              superintendents. Here’s a demo video:
              <a href="https://www.youtube.com/watch?v=mKIQQKkjv_4"
                >https://www.youtube.com/watch?v=mKIQQKkjv_4</a
              >.
              <p>
                Superintendents are the busiest and most expensive people on
                construction sites. Just like doctors in a hospital, supers
                diagnose and triage issues, make observations about conditions,
                and delegate action items to their team. Also, like doctors,
                supers are responsible for an enormous amount of document
                generation, accounting for the work done in the field so that
                back office people can keep records for billing purposes.
              </p>
              <p>
                Right now, supers are taking 30-200 photos per day to document
                site progress (mostly for liability reasons, or in case of a
                dispute with the owner over delays and deliverables). At the end
                of the day, they'll spend a few hours uploading those photos
                into OneDrive, or project management software like Procore or
                ACC. They might transcribe those photos; few supers have time to
                do this thoroughly, so these photos aren’t very searchable. And
                supers might use those photos to create "daily logs", which are
                structured documents that account for the work done on site on
                any given day.
              </p>
              <p>
                Fresco uses generative AI to compile reports and punch lists for
                superintendents <i>during</i> their site walks, not after.
                Supers simply take short videos with voiceover, or upload
                photos, and Fresco does the rest, creating notes with
                transcription, photos, assignees, and due dates. Supers can
                easily text their crew action items, and receive texts back to
                keep informed of when tasks are done. We also route this to
                whatever project management software they're using with a single
                click.
              </p>
              <p>
                Right now, we charge per site per month, which includes
                unlimited users on any given construction project. The typical
                price is $1k/month, but we offer discounts for multi-month or
                multi-site commitments. If you want to try Fresco yourself, you
                can sign up for demo access at fresco-ai.com.
              </p>
              <p>
                We’ve also gotten some interest from other verticals where site
                walks are common, like commercial real estate. We’re hoping that
                in the future it may be possible to address these as well.
              </p>
              <p>
                If you’ve worked in the construction field, we’d love to hear
                your experiences and insights. We look forward to your comments
                and feedback!
              </p>
            </div>
          </section>
        </section>
        <section id="42203990">
          <h3>
            <a
              class="item"
              href="https://artuk.org/discover/stories/the-rectangular-cows-of-art-uk"
              >The Rectangular Cows of UK Art (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 13:12:04</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42203990"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42203895">
          <h3>
            <a class="item" href="https://github.com/DevER-M/yami"
              >Show HN: Yami – An Open Source Music Player with Spotdl
              Integration</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 12:57:44</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42203895"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42203635">
          <h3>
            <a class="item" href="https://near.blog/personality-basins/"
              >Personality Basins</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 12:25:07</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42203635"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42203543">
          <h3>
            <a
              class="item"
              href="https://www.icc-cpi.int/news/situation-state-palestine-icc-pre-trial-chamber-i-rejects-state-israels-challenges"
              >ICC issues warrants for Netanyahu, Gallant, and Hamas
              officials</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 12:13:17</span
              ><span class="points-container"
                >Points: <span class="points">417</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42203543"
                  >Comments</a
                ><span class="descendants">: 364</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42203456">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/handle-com/jobs/dRJJ0vK-senior-implementation-consultant"
              >Handle.com (YC W19) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 12:01:01</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42202834">
          <h3>
            <a
              class="item"
              href="https://laurentrdc.xyz/posts/typed-dimensions.html"
              >Scientific computing with confidence using typed dimensions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 10:26:19</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42202834"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42202670">
          <h3>
            <a class="item" href="https://www.php.net/releases/8.4/en.php"
              >PHP 8.4</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 09:56:52</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42202670"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42202397">
          <h3>
            <a
              class="item"
              href="https://bicycledutch.wordpress.com/2018/02/20/a-common-urban-intersection-in-the-netherlands/"
              >A common urban intersection in the Netherlands (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 08:59:02</span
              ><span class="points-container"
                >Points: <span class="points">294</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42202397"
                  >Comments</a
                ><span class="descendants">: 251</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42201936">
          <h3>
            <a class="item" href="https://richardt.io/stereo_stern/"
              >A binary tree of all Pythagorean triples</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 07:24:41</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42201936"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42201892">
          <h3>
            <a class="item" href="https://abenezer.org/blog/hyrum-law-in-golang"
              >Hyrum's Law in Golang</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 07:12:35</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42201892"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42201117">
          <h3>
            <a class="item" href="https://thematrix1999.github.io/"
              >The Matrix: Infinite-Horizon World Generation with Real-Time
              Interaction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 04:26:16</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42201117"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42200699">
          <h3>
            <a
              class="item"
              href="https://doomsdaymachines.net/p/the-meme-ification-of-the-demon-core"
              >The meme-ification of the "Demon Core"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 03:05:56</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42200699"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42200407">
          <h3>
            <a
              class="item"
              href="https://www.aps.org/apsnews/2024/11/mathematical-intuition-dirac-quantum-mechanics"
              >January 1928: Dirac equation unifies quantum mechanics and
              special relativity</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 02:17:49</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42200407"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42200209">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/mathematical-thinking-isnt-what-you-think-it-is-20241118/"
              >Everyone is capable of, and can benefit from, mathematical
              thinking</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 01:45:47</span
              ><span class="points-container"
                >Points: <span class="points">425</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42200209"
                  >Comments</a
                ><span class="descendants">: 255</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42200099">
          <h3>
            <a
              class="item"
              href="https://github.com/gtls64/MontyHome-Hackers-Guide"
              >Show HN: We open-sourced our compost monitoring tech</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 01:30:07</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42200099"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <p>
                One of the exciting things about our open-source compost
                monitoring tech is its flexibility. You can connect it to
                platforms like Raspberry Pi, Arduino, or other single-board
                computers to expand its capabilities or integrate it into your
                own projects.
              </p>
              <p>
                Our system includes sensors for: * Gas composition * Temperature
                * Moisture levels * Air pressure
              </p>
              <p>
                All data can be exported as CSV files for analysis. While it’s
                originally built for monitoring compost, the hardware and data
                capabilities are versatile and could be repurposed for other
                applications (IoT, environmental monitoring, etc.)
              </p>
              <p>
                Hacker’s Guide to Monty Tech:
                <a href="https://github.com/gtls64/MontyHome-Hackers-Guide"
                  >https://github.com/gtls64/MontyHome-Hackers-Guide</a
                >
              </p>
              <p>
                If you’re into data, sensors, or creative tech hacks, we’d love
                for you to check it out and let us know what you build!
              </p>
            </div>
          </section>
        </section>
        <section id="42199486">
          <h3>
            <a class="item" href="https://electrobun.dev/"
              >Electrobun: Cross-platform desktop applications written in
              TypeScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 23:58:20</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42199486"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42199447">
          <h3>
            <a
              class="item"
              href="https://www.ualberta.ca/en/folio/2024/11/weight-loss-drug-found-to-shrink-heart-muscle.html"
              >Weight-loss drug found to shrink muscle in mice, human cells</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 23:53:25</span
              ><span class="points-container"
                >Points: <span class="points">322</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42199447"
                  >Comments</a
                ><span class="descendants">: 364</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42198954">
          <h3>
            <a class="item" href="https://github.com/doxx/darkflare"
              >Doxx/Darkflare: DarkFlare TCPoCDN (TCP over CDN)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 22:49:41</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42198954"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42197754">
          <h3>
            <a class="item" href="https://trailimap.com/"
              >Show HN: Bike route planner that follows almost only official
              bike trails</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 20:23:55</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42197754"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
            <div class="text">
              <p>
                For each request you're shown what bike tracks/trails your route
                uses and can further explore them by showing them on map or
                going to the official trail route.
              </p>
              <p>
                The main idea for the app is to have a friendly and easy to use
                planner that would make heavy use of official bike trails data
                (mainly from OpenStreetMap) and make it easy to plan a longer
                trip using the best possible bike routes out there.
              </p>
              <p>
                Currently the app only works for the Euro region but I'm
                planning to add North America very soon and then rest of the
                world.
              </p>
              <p>
                Technical overview: Route finding - Graphhopper sitting in a
                docker container on a Hetzner server somewhere in Germany. It
                has 38 GB of graph data(Europe) loaded into RAM for a fast graph
                traversal.
              </p>
              <p>
                Web App - Next.js 14 with Typescript, backend on the newest
                version of .NET
              </p>
              <p>
                Map tiles - right now I'm using MapTiler their free tier but
                planning to switch to my own home server soon and host the maps
                on it.
              </p>
            </div>
          </section>
        </section>
        <section id="42196841">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/google-deepmind/alphaqubit-quantum-error-correction/"
              >AlphaQubit: AI to identify errors in Quantum Computers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 18:37:04</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42196841"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42196794">
          <h3>
            <a
              class="item"
              href="https://labs.ripe.net/author/emileaben/does-the-internet-route-around-damage-baltic-sea-cable-cuts/"
              >Does the Internet Route Around Damage? – Baltic Sea Cable Cuts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 18:30:59</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42196794"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42194327">
          <h3>
            <a
              class="item"
              href="https://www.construction-physics.com/p/how-good-are-american-roads"
              >How good are American roads?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 14:45:23</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42194327"
                  >Comments</a
                ><span class="descendants">: 453</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42193771">
          <h3>
            <a
              class="item"
              href="https://history.stackexchange.com/questions/57033/what-is-the-origin-of-the-lake-tank-image-that-has-become-a-meme"
              >What is the origin of the lake tank image that has become a meme?
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 13:30:03</span
              ><span class="points-container"
                >Points: <span class="points">582</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42193771"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42181803">
          <h3>
            <a class="item" href="https://zka.lc/">Cryptographic Calculator</a>
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 10:10:30</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42181803"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42170281">
          <h3>
            <a
              class="item"
              href="https://maskray.me/blog/2024-11-17-removing-global-state-from-lld"
              >Removing global state from LLD, the LLVM linker</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 06:38:22</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42170281"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42169594">
          <h3>
            <a
              class="item"
              href="https://www.telegraph.co.uk/books/authors/jm-coetzee-zbigniew-herbert-poetry-penguin-modern-classics/"
              >JM Coetzee on Zbigniew Herbert</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 03:56:30</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42169594"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42143731">
          <h3>
            <a class="item" href="https://teenage.engineering/products/op-xy"
              >Teenage Engineering OP–XY</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 03:29:24</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42143731"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
