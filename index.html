<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46456797">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2025/12/31/europe/finland-estonia-undersea-cable-ship-detained-intl"
              >Finland detains ship and its crew after critical undersea cable
              damaged</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 18:46:07</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46456797"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46456682">
          <h3>
            <a class="item" href="https://lethain.com/agents-coordinators/"
              >Building an internal agent: Code-driven vs. LLM-driven
              workflows</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 18:34:25</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46456682"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46456215">
          <h3>
            <a
              class="item"
              href="https://johnnysswlab.com/memory-subsystem-optimizations/"
              >Memory Subsystem Optimizations</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 17:52:30</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46456215"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46455872">
          <h3>
            <a class="item" href="https://ciechanow.ski/cameras-and-lenses/"
              >Cameras and Lenses (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 17:18:01</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46455872"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46455330">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/12/31/european_space_agency_hacked/"
              >European Space Agency hit again as cybercriminals claim 200 GB
              data up for sale</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 16:28:43</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46455330"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46455053">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/video-games/playstation/playstation-5-rom-keys-leaked-jailbreaking-could-be-made-easier-with-bootrom-codes"
              >Sony PS5 ROM keys leaked – jailbreaking could be made easier with
              BootROM codes</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:57:39</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46455053"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46455021">
          <h3>
            <a
              class="item"
              href="https://calendar.perfplanet.com/2025/the-curious-case-of-the-shallow-session-spas/"
              >The Curious Case of the Shallow Session SPAs</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:54:03</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46455021"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454968">
          <h3>
            <a
              class="item"
              href="https://centamori.com/index.php?slug=hierarchical-navigable-small-world-hnsw-php&amp;lang=en"
              >Implementing HNSW (Hierarchical Navigable Small World) Vector
              Search in PHP</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:48:31</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454968"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454958">
          <h3>
            <a class="item" href="https://github.com/fsmunoz/datastar-cl"
              >Common Lisp SDK for the Datastar Hypermedia Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:47:17</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454958"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454854">
          <h3>
            <a class="item" href="https://bugs.pwno.io/0014"
              >Heap Overflow in FFmpeg EXIF</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:31:24</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454854"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454763">
          <h3>
            <a
              class="item"
              href="https://www.acm.org/articles/bulletins/2026/january/acm-open-access"
              >ACM Is Now Open Access</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:19:26</span
              ><span class="points-container"
                >Points: <span class="points">281</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454763"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454693">
          <h3>
            <a
              class="item"
              href="https://openworkers.com/introducing-openworkers"
              >Show HN: OpenWorkers – Self-hosted Cloudflare workers in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:09:06</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454693"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
            <div class="text">
              <p>
                OpenWorkers lets you run untrusted JS in V8 isolates on your own
                infrastructure. Same DX as Cloudflare Workers, no vendor
                lock-in.
              </p>
              <p>
                What works today: fetch, KV, Postgres bindings, S3/R2, cron
                scheduling, crypto.subtle.
              </p>
              <p>Self-hosting is a single docker-compose file + Postgres.</p>
              <p>
                Would love feedback on the architecture and what feature you'd
                want next.
              </p>
            </div>
          </section>
        </section>
        <section id="46454587">
          <h3>
            <a
              class="item"
              href="https://zekcrates.quarto.pub/deep-learning-library/"
              >Build a Deep Learning Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 14:53:50</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454587"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454470">
          <h3>
            <a
              class="item"
              href="https://mkennedy.codes/posts/python-numbers-every-programmer-should-know/"
              >Python numbers every programmer should know</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 14:39:23</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454470"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454413">
          <h3>
            <a class="item" href="https://danwang.co/2025-letter/"
              >2025 Letter</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 14:32:12</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454413"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46453950">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/support/alternative-browser-engines-jp/"
              >iOS allows alternative browser engines in Japan</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 13:30:45</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46453950"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46453582">
          <h3>
            <a
              class="item"
              href="https://sherwood.news/tech/rather-than-fully-cracking-down-on-scam-ads-meta-worked-to-make-them-harder/"
              >Meta made scam ads harder to find instead of removing them</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 12:29:01</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46453582"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46453204">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/39c3-bluetooth-headphone-jacking-a-key-to-your-phone"
              >Bluetooth Headphone Jacking: A Key to Your Phone [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 11:17:18</span
              ><span class="points-container"
                >Points: <span class="points">347</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46453204"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46453062">
          <h3>
            <a class="item" href="https://github.com/buyukakyuz/rustmm"
              >Rust--: Rust without the borrow checker</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 10:53:12</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46453062"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46452937">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/australia-news/2025/may/02/hull-096-worlds-largest-electric-ship-battery-power-launched"
              >Worlds largest electric ship launched by Tasmanian boatbuilder</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 10:29:54</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46452937"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46452763">
          <h3>
            <a
              class="item"
              href="https://moultano.wordpress.com/2025/12/30/children-and-helical-time/"
              >Children and Helical Time</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 09:53:48</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46452763"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46449892">
          <h3>
            <a class="item" href="https://github.com/bshepp/RESIDUALS"
              >Show HN: Feature detection exploration in Lidar DEMs via
              differential decomp</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 00:29:45</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46449892"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                The core idea: if you systematically combine decomposition
                methods (Gaussian, bilateral, wavelet, morphological, etc.) with
                different upsampling techniques, each combination has
                characteristic "failure modes" that selectively preserve or
                eliminate certain features. The differences between outputs
                become feature-specific filters.
              </p>
              <p>
                The framework tests 25 decomposition × 19 upsampling methods
                across parameter ranges — about 40,000 combinations total. The
                visualization grid makes it easy to compare which methods work
                for what.
              </p>
              <p>
                Built in Cursor with Opus 4.5, NumPy, SciPy, scikit-image,
                PyWavelets, and OpenCV. Apache 2.0 licensed.
              </p>
              <p>
                I'd appreciate feedback from anyone who actually works with
                elevation data. What am I missing? What's obvious to
                practitioners that I wouldn't know?
              </p>
            </div>
          </section>
        </section>
        <section id="46449643">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2025/Dec/31/the-year-in-llms/"
              >2025: The Year in LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 23:54:46</span
              ><span class="points-container"
                >Points: <span class="points">800</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46449643"
                  >Comments</a
                ><span class="descendants">: 426</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46446815">
          <h3>
            <a
              class="item"
              href="https://austinhenley.com/blog/canceledbookdeal.html"
              >I canceled my book deal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 18:26:32</span
              ><span class="points-container"
                >Points: <span class="points">580</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46446815"
                  >Comments</a
                ><span class="descendants">: 325</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46407292">
          <h3>
            <a class="item" href="https://boxinsertdesigner.com/"
              >Show HN: I created a tool to design and create foamcore inserts
              for boardgames</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-28 @ 01:00:52</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46407292"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <a href="https://boxinsertdesigner.com/"
                >https://boxinsertdesigner.com/</a
              >
              <p>
                It lets you design a box insert in 2D and spits out a cutting
                list.
              </p>
              <p>
                I'm looking for feedback, bugs, feature ideas etc and figured
                this would be a good place to find it :)
              </p>
            </div>
          </section>
        </section>
        <section id="46403727">
          <h3>
            <a
              class="item"
              href="https://rajeeshknambiar.wordpress.com/2025/12/27/a-font-with-built-in-tex-syntax-highlighting/"
              >A font with built-in TeX syntax highlighting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-27 @ 18:01:44</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46403727"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46402202">
          <h3>
            <a
              class="item"
              href="https://blog.phronemophobic.com/easel-one-year.html"
              >Easel Turns One One year of building my own IDE in Clojure</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-27 @ 14:46:16</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46402202"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46401899">
          <h3>
            <a
              class="item"
              href="https://blog.rastrian.dev/post/beyond-the-nat-cgnat-bandwidth-and-practical-tunneling"
              >Beyond the Nat: Cgnat, Bandwidth, and Practical Tunneling</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-27 @ 13:59:16</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46401899"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46401763">
          <h3>
            <a
              class="item"
              href="https://nchagnet.pages.dev/blog/pokemon-team-optimization/"
              >Pokémon Team Optimization</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-27 @ 13:38:01</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46401763"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46392095">
          <h3>
            <a class="item" href="https://zelang-dev.github.io/c-events/"
              >C-events, yet another event loop, simpler, smaller, faster,
              safer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-26 @ 14:06:47</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46392095"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
