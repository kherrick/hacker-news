<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44747886">
          <h3>
            <a class="item" href="https://venki.dev/notes/engineering-buy-in"
              >Engineering Buy-In</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 17:24:34</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44747886"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44747870">
          <h3>
            <a class="item" href="https://words.filippo.io/assembly-mutation/"
              >Go Assembly Mutation Testing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 17:23:17</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44747870"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44747843">
          <h3>
            <a class="item" href="https://mjg59.dreamwidth.org/72892.html"
              >Secure boot certificate rollover is real but probably won't hurt
              you</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 17:21:07</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44747843"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44747809">
          <h3>
            <a
              class="item"
              href="http://spiff.rit.edu/classes/phys445/lectures/planetarium/xephem_howto.html"
              >Introduction to XEphem (Motif)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 17:17:25</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44747809"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44747728">
          <h3>
            <a
              class="item"
              href="https://trufflesecurity.com/blog/how-to-scan-force-pushed-commits-for-secrets"
              >How to Scan Force Pushed Commits for Secrets</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 17:10:21</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44747728"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44747699">
          <h3>
            <a class="item" href="https://multiterm.stelclementine.com"
              >Show HN: Astro dev blog template with 60 interactive
              colorschemes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 17:08:10</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44747699"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/panr/hugo-theme-terminal"
                >https://github.com/panr/hugo-theme-terminal</a
              >
              but supercharged with a modern redesign and the incredible
              features of Astro.
              <p>Features:</p>
              <p></p>
              <pre><code>  - Simple configuration file
  - Multiple theme modes (single, light/dark/auto, select)  
  - Giscus comments  
  - RSS feed  
  - SEO best practices + social card generation  
  - Markdown extensions (TOC, admonitions, reading time, etc)</code></pre>
            </div>
          </section>
        </section>
        <section id="44747625">
          <h3>
            <a class="item" href="https://www.kaizenautomation.com/jobs"
              >Kaizen (YC X25) is hiring engineers to build browser agents that
              work</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 17:00:56</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44747457">
          <h3>
            <a
              class="item"
              href="https://developers.googleblog.com/en/gemini-embedding-powering-rag-context-engineering/"
              >Gemini Embedding: Powering RAG and context engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 16:47:54</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44747457"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44747241">
          <h3>
            <a
              class="item"
              href="https://www.docuseal.com/blog/make-any-website-load-faster-with-6-lines-html"
              >The Chrome Speculation Rules API allows the browser to preload
              and prerender</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 16:27:10</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44747241"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44747204">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44747204"
              >Launch HN: Gecko Security (YC F24) – AI That Finds
              Vulnerabilities in Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 16:23:09</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44747204"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.gecko.security">https://www.gecko.security</a
              >). We're building a new kind of static analysis tool that uses
              LLMs to find complex business logic and multi-step vulnerabilities
              that current scanners miss. We’ve used it to find 30+ CVEs in
              projects like Ollama, Gradio, and Ragflow (<a
                href="https://www.gecko.security/research"
                >https://www.gecko.security/research</a
              >). You can try it yourself on any OSS repo at (<a
                href="https://app.gecko.security"
                >https://app.gecko.security</a
              >).
              <p>
                Anyone who’s used SAST (Static Application Security Testing)
                tools knows the issues of high false positives while missing
                entire classes of vulnerabilities like AuthN/Z bypasses or
                privilege escalations. This limitation is a result of their core
                architecture. By design, SAST tools parse code into a simplistic
                model like an AST or call graph, which quickly loses context in
                dynamically typed languages or across microservice boundaries,
                and limits coverage to only resolving basic call chains. When
                detecting vulnerabilities they rely on pattern matching with
                Regex or YAML rules, which can be effective for basic technical
                classes like (XSS, SQLi) but inadequate for logic flaws that
                don’t conform to well-known shapes and need long sequences of
                dependent operations to reach an exploitable state.
              </p>
              <p>
                My co-founder and I saw these limitations throughout our careers
                in national intelligence and military cyber forces, where we
                built automated tooling to defend critical infrastructure. We
                realised that LLMs, with the right architecture, could finally
                solve them.
              </p>
              <p>
                Vulnerabilities are contextual. What's exploitable depends
                entirely on each application's security model. We realized
                accurate detection requires understanding what's supposed to be
                protected and why breaking it matters. This meant embedding
                threat modeling directly into our analysis, not treating it as
                an afterthought.
              </p>
              <p>
                To achieve this, we first had to solve the code parsing problem.
                Our solution was to build a custom, compiler-accurate indexer
                inspired by GitHub's stack graphs approach to precisely navigate
                code, like an IDE. We build on the LSIF approach (<a
                  href="https://lsif.dev/"
                  >https://lsif.dev/</a
                >) but replace the verbose JSON with a compact protobuf schema
                to serialise symbol definitions and references in a binary
                format. We use language‑specific tools to parse and type‑check
                code, emitting a sequence of Protobuf messages that record a
                symbol’s position, definition, and reference information. By
                using Protobuf’s efficiency and strong typing, we can produce
                smaller indexes, but also preserve the compiler‑accurate
                semantic information required for detecting complex call chains.
              </p>
              <p>
                This is why most "SAST + LLM" tools that use AST parsing fail -
                they feed LLMs incomplete or incorrect code information from
                traditional parsers, making it difficult to accurately reason
                about security issues with missing context.
              </p>
              <p>
                With our indexer providing accurate code structure, we use an
                LLM to perform threat modeling by analyzing developer intent,
                data and trust boundaries, and exposed endpoints to generate
                potential attack scenarios. This is where LLMs' tendency to
                hallucinate becomes a breakthrough feature.
              </p>
              <p>
                For each potential attack path generated, we perform a
                systematic search, querying the indexer to gather all necessary
                context and reconstruct the full call chain from source to sink.
                To validate the vulnerability we use a Monte Carlo Tree
                Self-refine (MCTSr) algorithm and a 'win function' to determine
                the likelihood that a hypothesized attack could work. Once a
                finding is above a set practicality threshold it is confirmed as
                a true positive.
              </p>
              <p>
                Using this approach, we discovered vulnerabilities like
                CVE-2025-51479 in ONYX (an OSS enterprise search platform) where
                Curators could modify any group instead of just their assigned
                ones. The user-group API had a user parameter that should check
                permissions but never used it. Gecko inferred developers
                intended to restrict Curator access because both the UI and
                similar API functions properly validated this permission. This
                established "curators have limited scope" as a security
                invariant that this specific API violated. Traditional SAST
                can't detect this. Any rule to flag unused user parameters would
                drown you in false positives since many functions legitimately
                keep unused parameters. And more importantly, detecting this
                requires knowing which functions handle authorization,
                understanding ONYX's Curator permission model, and recognizing
                the validation pattern across multiple files - contextual
                reasoning that SAST simply cannot do.
              </p>
              <p>
                We have several enterprise customers using Gecko because it
                solves problems they couldn't address with traditional SAST
                tools. They're seeing 50% fewer false positives on the same
                codebases and finding vulnerabilities that previously only
                showed up in manual pentests.
              </p>
              <p>
                Digging into false positives, no static analysis tool will ever
                achieve perfect accuracy, AI or otherwise. We reduce them at two
                key points. First, our indexer eliminates any programmatic
                parsing errors that create incorrect call chains that
                traditional AST tools are susceptible to. Second, we avoid
                unwanted LLM hallucinations and reasoning errors by asking
                specific, contextual questions rather than open-ended ones. The
                LLM knows which security invariants need to hold and can make
                deterministic assessments based on the context. When we do flag
                something, manual review is quick because we provide complete
                source-to-sink dataflow analysis with proof-of-concept code and
                output findings based on confidence scores.
              </p>
              <p>
                We’d love to get any feedback from the community, ideas for
                future direction, or experiences in this space. I’ll be in the
                comments to respond!
              </p>
            </div>
          </section>
        </section>
        <section id="44746948">
          <h3>
            <a class="item" href="https://lwn.net/Articles/1029851/"
              >QUIC for the kernel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 15:57:32</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44746948"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44746821">
          <h3>
            <a class="item" href="https://worrydream.com/dbx/"
              >The Future of Programming (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 15:43:38</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44746821"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44746603">
          <h3>
            <a
              class="item"
              href="https://lazyadmin.nl/home-network/unifi-os-server/"
              >Ubiquiti launches UniFi OS Server for self-hosting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 15:24:05</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44746603"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44746415">
          <h3>
            <a class="item" href="https://streamnative.io/products/ursa"
              >Ursa: A Leaderless, Object Storage–Based Alternative to Kafka</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 15:01:08</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44746415"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44746321">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2507.22358"
              >Magentic-UI: Towards Human-in-the-Loop Agentic Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 14:54:27</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44746321"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44745984">
          <h3>
            <a class="item" href="https://docs.carbon-lang.dev/"
              >Carbon Language: An experimental successor to C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 14:23:40</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44745984"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44745897">
          <h3>
            <a
              class="item"
              href="https://manuel.bernhardt.io/posts/2025-07-24-macbook-pro-insomnia"
              >MacBook Pro Insomnia</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 14:16:07</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44745897"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44745347">
          <h3>
            <a
              class="item"
              href="https://www.nsw.gov.au/departments-and-agencies/fair-trading/dark-patterns"
              >NSW Fair Trading – Dark Patterns</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 13:17:35</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44745347"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44744715">
          <h3>
            <a
              class="item"
              href="https://digitalcourage.social/@echo_pbreyer/114946559233051667"
              >Many countries that said no to ChatControl in 2024 are now
              undecided</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 11:54:22</span
              ><span class="points-container"
                >Points: <span class="points">256</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44744715"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44744578">
          <h3>
            <a class="item" href="https://cmtext.com/"
              >Introduction to Computer Music</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 11:37:22</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44744578"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44744454">
          <h3>
            <a
              class="item"
              href="https://movies.stackexchange.com/questions/128020/how-was-the-universal-pictures-1936-opening-logo-created"
              >How was the Universal Pictures 1936 opening logo created?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 11:19:54</span
              ><span class="points-container"
                >Points: <span class="points">355</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44744454"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44744331">
          <h3>
            <a
              class="item"
              href="https://arxiviq.substack.com/p/gepa-reflective-prompt-evolution"
              >GEPA: Reflective prompt evolution can outperform reinforcement
              learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 10:57:58</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44744331"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44744324">
          <h3>
            <a
              class="item"
              href="https://www.spacebar.news/servo-undercover-web-browser-engine/"
              >I tried Servo</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 10:56:21</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44744324"
                  >Comments</a
                ><span class="descendants">: 174</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44739494">
          <h3>
            <a
              class="item"
              href="https://www.newstatesman.com/culture/books/book-of-the-day/2025/07/150-years-of-the-bizarre-hans-christian-andersen"
              >150 years of Hans Christian Andersen</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 21:07:13</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44739494"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.ph/10l96">https://archive.ph/10l96</a>
            </div>
          </section>
        </section>
        <section id="44724507">
          <h3>
            <a
              class="item"
              href="https://diziet.pages.torproject.net/rust-derive-deftly/latest/guide/"
              >Advanced Rust macros with derive-deftly</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 15:21:34</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44724507"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44718211">
          <h3>
            <a class="item" href="https://blog.bugsiki.dev/posts/zig-profilers/"
              >Zig Profiling on Apple Silicon</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 02:15:36</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44718211"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711163">
          <h3>
            <a class="item" href="https://lwn.net/Articles/1029307/"
              >Following Up on the Python JIT</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 14:23:19</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711163"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44710651">
          <h3>
            <a
              class="item"
              href="https://www.experimental-history.com/p/face-it-youre-a-crazy-person"
              >Face it: you're a crazy person</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 13:23:35</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44710651"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44710647">
          <h3>
            <a class="item" href="https://collabfund.com/blog/ferrari-status/"
              >Ferrari Status</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 13:23:14</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44710647"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44710256">
          <h3>
            <a class="item" href="https://eclipse.dev/sumo/"
              >Sumo – Simulation of Urban Mobility</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 12:39:52</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44710256"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
