<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43873679">
          <h3>
            <a
              class="item"
              href="https://www.roadtovr.com/beat-saber-instructed-motion-until-you-fall-inside-xr-design/"
              >VR Design Unpacked: The Secret to Beat Saber's Fun Isn't What You
              Think</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 19:16:38</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43873679"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43873604">
          <h3>
            <a
              class="item"
              href="https://terrytao.wordpress.com/2025/05/01/a-proof-of-concept-tool-to-verify-estimates/"
              >A proof of concept tool to verify estimates</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 19:09:22</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43873604"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43873531">
          <h3>
            <a
              class="item"
              href="https://www.leonarddavid.com/old-soviet-venus-descent-craft-nearing-earth-reentry/"
              >Images of Soviet Venus lander falling to Earth suggest its
              parachute may be out</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 19:02:01</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43873531"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43873465">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2025/05/05/mark-twain-ron-chernow-book-review"
              >The Impossible Contradictions of Mark Twain</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 18:55:42</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43873465"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43873074">
          <h3>
            <a class="item" href="https://anukari.com"
              >Show HN: I built a synthesizer based on 3D physics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 18:12:15</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43873074"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <p>
                So far I am only selling it direct on my website, which seems to
                be working well. I hope to turn it into a sustainable business,
                and ideally I'd have enough revenue to hire folks to help with
                it. So far it's been 99% a solo project, with (awesome)
                contractors brought in for some of the stuff that I'm bad at,
                like the 3D models and making instrument presets/videos.
              </p>
              <p>
                The official launch announcement video is here:
                <a href="https://www.youtube.com/watch?v=NYX_eeNVIEU"
                  >https://www.youtube.com/watch?v=NYX_eeNVIEU</a
                >
              </p>
              <p>
                But if you REALLY want to see what it can do, check out what
                Mick Cormick did with in on the first day:
                <a href="https://x.com/Mick_Gordon/status/1918146487948919222"
                  >https://x.com/Mick_Gordon/status/1918146487948919222</a
                >
              </p>
              <p>
                I've kept a fairly detailed developer log about my progress on
                the project since October 2023, which might be of interest to
                the hardcore technical folks here:
                <a href="https://anukari.com/blog/devlog"
                  >https://anukari.com/blog/devlog</a
                >
              </p>
              <p>
                I also gave a talk at Audio Developer Conference 2023 (ADC23)
                that goes deep into a couple of the problems I solved for
                Anukari:
                <a href="https://www.youtube.com/watch?v=lb8b1SYy73Q"
                  >https://www.youtube.com/watch?v=lb8b1SYy73Q</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43872946">
          <h3>
            <a class="item" href="https://www.hustwit.com/rams"
              >Rams is a documentary portrait of Dieter Rams (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 17:59:17</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43872946"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43872761">
          <h3>
            <a class="item" href="https://github.com/stanford-mast/blast"
              >Show HN: Blast – Fast, multi-threaded serving engine for web
              browsing AI agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 17:42:28</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43872761"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
            <div class="text">
              <p>
                BLAST is a high-performance serving engine for browser-augmented
                LLMs, designed to make deploying web-browsing AI easy, fast, and
                cost-manageable.
              </p>
              <p>
                The goal with BLAST is to ultimately achieve google search level
                latencies for tasks that currently require a lot of typing and
                clicking around inside a browser. We're starting off with
                automatic parallelism, prefix caching, budgeting (memory and LLM
                cost), and an OpenAI-Compatible API but have a ton of ideas in
                the pipe!
              </p>
              <p>
                Website &amp; Docs:
                <a href="https://blastproject.org/"
                  >https://blastproject.org/</a
                >
                <a href="https://docs.blastproject.org/"
                  >https://docs.blastproject.org/</a
                >
              </p>
              <p>
                MIT-Licensed Open-Source:
                <a href="https://github.com/stanford-mast/blast"
                  >https://github.com/stanford-mast/blast</a
                >
              </p>
              <p>
                Hope some folks here find this useful! Please let me know what
                you think in the comments or ping me on Discord.
              </p>
              <p>— Caleb (PhD student @ Stanford CS)</p>
            </div>
          </section>
        </section>
        <section id="43872625">
          <h3>
            <a class="item" href="https://matthewstrom.com/writing/album-art/"
              >The History of Album Art</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 17:30:08</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43872625"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43872275">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/toma/jobs"
              >Toma (YC W24) Is Hiring Engs #3-4 (AI for Automotive)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 17:00:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43872094">
          <h3>
            <a
              class="item"
              href="https://www.ubicloud.com/blog/building-burstables-cpu-slicing-with-cgroups"
              >Building Burstables: CPU slicing with cgroups</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 16:45:29</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43872094"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43871984">
          <h3>
            <a class="item" href="https://mechanical-library.org/"
              >Show HN: Exhibit and Site on Mechanisms for Students</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 16:37:00</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43871984"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                Sadly, kids don't get much tangible experience with machines
                anymore. Ideally, this exhibit will inspire some to explore
                engineering, even if they are not "book learners". The website
                provides content to back up the exhibit, with videos and 3D
                printing files.
              </p>
              <p>
                The project is inspired by engineering exhibits from the past.
                Check out the research page for more. The project will be
                open-sourced to enable people to make their own and extend it.
                If you want to collaborate, LMK.
              </p>
              <p>--Steve</p>
            </div>
          </section>
        </section>
        <section id="43870998">
          <h3>
            <a class="item" href="https://github.com/nathan-barry/gpt2-webgl"
              >Show HN: GPT-2 implemented using graphics shaders</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 15:21:49</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43870998"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              Back in the old days, people used to do general-purpose GPU
              programming by using shaders like GLSL. This is what inspired
              NVIDIA (and other companies) to eventually create CUDA (and
              friends). This is an implementation of GPT-2 using WebGL and
              shaders. Enjoy!
            </div>
          </section>
        </section>
        <section id="43870969">
          <h3>
            <a
              class="item"
              href="https://massivesci.com/articles/programming-math-language-python-women-in-science/"
              >The language brain matters more for programming than the math
              brain? (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 15:19:22</span
              ><span class="points-container"
                >Points: <span class="points">274</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43870969"
                  >Comments</a
                ><span class="descendants">: 278</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43870819">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/expanding-on-sycophancy/"
              >Expanding on what we missed with sycophancy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 15:07:29</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43870819"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43869794">
          <h3>
            <a
              class="item"
              href="https://support.google.com/googleplay/android-developer/thread/330114530/fewer-users-warning-hurting-specialized-and-new-apps-need-answers?hl=en"
              >Google is hurting new apps that have less users than
              competitors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 13:54:27</span
              ><span class="points-container"
                >Points: <span class="points">287</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43869794"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43869353">
          <h3>
            <a class="item" href="https://suno.com/explore/">Suno v4.5</a>
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 13:18:26</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43869353"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43869288">
          <h3>
            <a
              class="item"
              href="https://www.joanwestenberg.com/the-cannae-problem/"
              >The Cannae Problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 13:11:16</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43869288"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43868737">
          <h3>
            <a
              class="item"
              href="https://world-playground-deceit.net/blog/2025/03/a-common-lisp-jq-replacement.html"
              >A Common Lisp jq replacement</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 12:15:48</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43868737"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43868273">
          <h3>
            <a class="item" href="https://webflow.com/blog/gsap-becomes-free"
              >Webflow makes GSAP 100% free – plus more updates</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 11:09:52</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43868273"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43868231">
          <h3>
            <a
              class="item"
              href="https://www.goto10retro.com/p/altair-at-50-remembering-the-first"
              >Altair at 50: Remembering the first Personal Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 11:03:29</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43868231"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43868192">
          <h3>
            <a
              class="item"
              href="https://utsavmamoria.substack.com/p/how-to-live-an-intellectually-rich"
              >How to live an intellectually rich life</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 10:58:10</span
              ><span class="points-container"
                >Points: <span class="points">418</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43868192"
                  >Comments</a
                ><span class="descendants">: 224</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43868130">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20211117094441/https://www.vice.com/en/article/4w4kg3/the-totalitarian-buddhist-who-beat-sim-city"
              >The Totalitarian Buddhist Who Beat SIM City (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 10:46:26</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43868130"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43867211">
          <h3>
            <a class="item" href="https://www.abdisa.me/"
              >Just redesigned my personal site with a TTY-style interface</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 07:48:11</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43867211"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43866303">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2025/05/dont-watermark-your-legal-pdfs-with-purple-dragons-in-suits/"
              >Don't watermark your legal PDFs with purple dragons in suits</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 04:49:02</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43866303"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43864827">
          <h3>
            <a
              class="item"
              href="https://deeprootsmag.org/2017/09/18/over-there-when-americana-doesnt-mean-american/"
              >When Americana doesn't mean American</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 00:13:09</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43864827"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43864752">
          <h3>
            <a
              class="item"
              href="https://serpapi.com/blog/faster-regular-expression-engines-in-ruby/"
              >Fast(er) regular expression engines in Ruby</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 00:00:39</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43864752"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43858183">
          <h3>
            <a
              class="item"
              href="https://www.brendangregg.com/blog/2025-05-01/doom-gpu-flame-graphs.html"
              >Doom GPU Flame Graphs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-01 @ 14:30:42</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43858183"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43857313">
          <h3>
            <a
              class="item"
              href="https://martin.janiczek.cz/2025/05/01/elm-test-distributions.html"
              >Elm Test Distributions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-01 @ 13:19:38</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43857313"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43854337">
          <h3>
            <a
              class="item"
              href="https://inside.java/2025/05/01/strings-just-got-faster/"
              >Strings Just Got Faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-01 @ 06:33:45</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43854337"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43824297">
          <h3>
            <a
              class="item"
              href="https://kumo.ai/research/relational-graph-transformers/"
              >Relational Graph Transformers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-28 @ 18:13:17</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43824297"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
