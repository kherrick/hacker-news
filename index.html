<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45200593">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/bild-ai/jobs/m2ilR5L-founding-engineer-applied-ai"
              >Bild AI (YC W25) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 17:01:06</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45200118">
          <h3>
            <a
              class="item"
              href="https://status.anthropic.com/incidents/k6gkm2b8cjk9"
              >Anthropic Services Down</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 16:31:34</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45200118"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45200024">
          <h3>
            <a
              class="item"
              href="https://www.hollywoodreporter.com/business/business-news/no-tax-on-tips-guidance-creators-trump-treasury-1236366513/"
              >"No Tax on Tips" Includes Digital Creators, Too</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 16:26:07</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45200024"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45199931">
          <h3>
            <a
              class="item"
              href="https://sethpurcell.com/writing/screens-in-museums/"
              >I didn't bring my son to a museum to look at screens</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 16:20:55</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45199931"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45199760">
          <h3>
            <a
              class="item"
              href="https://www.thenexus.media/tiktok-won-now-everything-is-60-seconds/"
              >TikTok has turned culture into a feedback loop of impulse and
              machine learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 16:08:39</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45199760"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45199713">
          <h3>
            <a
              class="item"
              href="https://platform.openai.com/docs/guides/developer-mode"
              >ChatGPT Developer Mode</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 16:04:49</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45199713"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45199378">
          <h3>
            <a
              class="item"
              href="https://mergify.com/blog/the-origin-story-of-merge-queues"
              >The Origin Story of Merge Queues</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 15:43:43</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45199378"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45199191">
          <h3>
            <a
              class="item"
              href="https://learn.microsoft.com/en-us/windows/powertoys/"
              >Microsoft PowerToys</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 15:31:27</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45199191"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45199031">
          <h3>
            <a class="item" href="https://zoox.com/journal/las-vegas"
              >Zoox launches its robotaxi service to the public in Las Vegas</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 15:18:12</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45199031"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45198420">
          <h3>
            <a
              class="item"
              href="https://zettelkasten.de/posts/the-scam-called-you-dont-have-to-remember-anything/"
              >We can’t circumvent the work needed to train our minds</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 14:38:59</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45198420"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45197608">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-10/"
              >Performance Improvements in .NET 10</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 13:46:02</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45197608"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45197187">
          <h3>
            <a
              class="item"
              href="https://www.fastcompany.com/91396271/searcha-page-seekninja-diy-search-engines"
              >Guy running a Google rival from his laundry room</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 13:17:25</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45197187"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45196437">
          <h3>
            <a
              class="item"
              href="https://blog.cryptographyengineering.com/2025/09/10/kerberoasting/"
              >Kerberoasting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 12:01:30</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45196437"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45196173">
          <h3>
            <a
              class="item"
              href="https://supabase.com/blog/orioledb-patent-free"
              >OrioleDB Patent: now freely available to the Postgres
              community</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 11:31:55</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45196173"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45195520">
          <h3>
            <a
              class="item"
              href="https://www.greeneuropeanjournal.eu/made-for-people-not-cars-reclaiming-european-cities/"
              >Pontevedra, Spain declares its entire urban area a "reduced
              traffic zone"</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 10:08:14</span
              ><span class="points-container"
                >Points: <span class="points">502</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45195520"
                  >Comments</a
                ><span class="descendants">: 616</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45192963">
          <h3>
            <a class="item" href="https://github.com/juhovh/tailguard"
              >Show HN: TailGuard – Bridge your WireGuard router into Tailscale
              via a container</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 03:42:55</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45192963"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                The problem with WireGuard is that it requires handling key
                management oneself, and configuring the keys to every device you
                want to access it from. It also doesn't play nicely together
                with other VPNs, meaning I ended up connecting and disconnecting
                VPNs whenever I wanted to use them. This is especially evident
                on my phone, which only allows one VPN app at a time.
              </p>
              <p>
                I was already using Tailscale as an easy way to handle homelab
                access with SSO, even if some computers are behind ISP CGNAT,
                and came up with this idea of spinning up a Docker container to
                connect the two. I found some suggestions for it online, but
                nothing ready to use. It ended up being more work than I
                expected to fine tune the routing, IPv6, firewall settings,
                re-resolving the DNS of the router on IP address changes etc.
              </p>
              <p>
                I got it very stable eventually though, and wanted to share with
                everyone else. I think it's cool to have the WireGuard router
                looking like any other Tailscale node in my tailnet now.
              </p>
            </div>
          </section>
        </section>
        <section id="45192655">
          <h3>
            <a
              class="item"
              href="https://joshfonseca.com/blogs/animal-crossing-llm"
              >I replaced Animal Crossing's dialogue with a live LLM by hacking
              GameCube memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 02:59:48</span
              ><span class="points-container"
                >Points: <span class="points">743</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45192655"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/vuciv/animal-crossing-llm-mod"
                >https://github.com/vuciv/animal-crossing-llm-mod</a
              >
            </div>
          </section>
        </section>
        <section id="45192194">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2508.05004"
              >R-Zero: Self-Evolving Reasoning LLM from Zero Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 02:02:17</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45192194"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45191347">
          <h3>
            <a
              class="item"
              href="https://www.sciencedaily.com/releases/2025/08/250831112449.htm"
              >NASA finds Titan's lakes may be creating vesicles with primitive
              cell walls</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-10 @ 00:10:40</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45191347"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45186015">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2025/09/introducing-iphone-air-a-powerful-new-iphone-with-a-breakthrough-design/"
              >iPhone Air</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 18:12:51</span
              ><span class="points-container"
                >Points: <span class="points">855</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45186015"
                  >Comments</a
                ><span class="descendants">: 1749</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45185756">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/e-paper-display-modos"
              >E-paper display reaches the realm of LCD screens</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 17:57:35</span
              ><span class="points-container"
                >Points: <span class="points">578</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45185756"
                  >Comments</a
                ><span class="descendants">: 185</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45183029">
          <h3>
            <a
              class="item"
              href="https://xeiaso.net/notes/2025/we-dodged-a-bullet/"
              >We all dodged a bullet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 15:11:26</span
              ><span class="points-container"
                >Points: <span class="points">790</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45183029"
                  >Comments</a
                ><span class="descendants">: 450</span></span
              >
            </h4>
            <div class="text">
              <i>NPM debug and chalk packages compromised</i> -
              <a href="https://news.ycombinator.com/item?id=45169657"
                >https://news.ycombinator.com/item?id=45169657</a
              >
            </div>
          </section>
        </section>
        <section id="45182657">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/naep-reading-math-scores-12th-grade-c18d6e3fbc125f12948cc70cb85a520a"
              >US High school students' scores fall in reading and math</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 14:45:46</span
              ><span class="points-container"
                >Points: <span class="points">485</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45182657"
                  >Comments</a
                ><span class="descendants">: 935</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45182381">
          <h3>
            <a class="item" href="https://www.anthropic.com/news/create-files"
              >Claude now has access to a server-side container environment</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 14:25:55</span
              ><span class="points-container"
                >Points: <span class="points">621</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45182381"
                  >Comments</a
                ><span class="descendants">: 324</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45181535">
          <h3>
            <a class="item" href="https://github.com/mmulet/term.everything"
              >Show HN: Term.everything – Run any GUI app in the terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 13:16:30</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45181535"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://github.com/mmulet/term.everything/blob/main/resources/HowIDidIt.md"
                >https://github.com/mmulet/term.everything/blob/main/resource...</a
              >
            </div>
          </section>
        </section>
        <section id="45171733">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gaming/2025/09/all-54-lost-clickwheel-ipod-games-have-now-been-preserved-for-posterity/"
              >All clickwheel iPod games have now been preserved for
              posterity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-08 @ 18:09:25</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45171733"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45166655">
          <h3>
            <a
              class="item"
              href="https://justin.searls.co/posts/how-to-distribute-your-own-scripts-via-homebrew/"
              >Distributing your own scripts via Homebrew</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-08 @ 10:36:17</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45166655"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45163417">
          <h3>
            <a
              class="item"
              href="https://wrighter.xyz/blog/2023_08_17_flame_fractals_in_comp_shader"
              >Rendering flame fractals with a compute shader (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-08 @ 00:01:16</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45163417"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45155846">
          <h3>
            <a class="item" href="https://crates.io/crates/crabcamera"
              >Show HN: CrabCamera – Cross-platform camera plugin for Tauri
              desktop apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 06:19:52</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45155846"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p></p>
              <pre><code>  So I built CrabCamera – a Tauri plugin that handles all the camera complexity for you.

  What it does:

  - One API, three platforms: Same Rust code works on Windows (DirectShow), macOS (AVFoundation), and Linux (V4L2)
  - Permission handling: Automatically requests camera permissions on each platform
  - Format conversion: Takes care of the messy bits between platform formats and what your app needs
  - Error handling: Proper Rust error types instead of mysterious crashes
  - Hot-plugging: Detects when cameras are connected/disconnected

  The problem it solves:

  Before CrabCamera, adding camera support to a Tauri app meant:
  1. Writing separate native code for each platform
  2. Managing three different permission systems
  3. Handling format conversions manually
  4. Debugging platform-specific edge cases
  5. Maintaining it all as OS APIs change

  Now it's just:
  use crabcamera::Camera;

  let camera = Camera::new()?;
  let frame = camera.capture_frame().await?;

  Why I built it:

  I was working on a plant monitoring app (botanica) that needed reliable camera access for time-lapse photography. Existing solutions were either abandoned, platform-specific, or required complex native
  bindings.

  The Tauri ecosystem is growing fast, but camera support was this obvious gap. Every desktop app eventually needs camera access – video calls, document scanning, AR features, security monitoring.

  Technical highlights:

  - Uses nokhwa for the heavy lifting but wraps it in Tauri-friendly APIs
  - Proper async/await support throughout
  - Memory-efficient streaming for video capture
  - Built-in image processing pipeline
  - Extensible plugin architecture

  What's next:

  - WebRTC integration for video calls
  - Built-in barcode/QR code scanning
  - Face detection hooks
  - Performance optimizations for 4K streams

  The crate is MIT licensed and available on crates.io. I'd love feedback from other Tauri developers who've wrestled with camera integration.

  Links:
  - Crates.io: https://crates.io/crates/crabcamera
  - GitHub: https://github.com/Michael-A-Kuykendall/crabcamera
  - Documentation: https://docs.rs/crabcamera</code></pre>
            </div>
          </section>
        </section>
        <section id="45154088">
          <h3>
            <a
              class="item"
              href="https://www.robinsloan.com/lab/knowledge-and-memory/"
              >Knowledge and memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 00:15:59</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45154088"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
