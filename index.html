<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40508719">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/ex-openai-board-member-provides-her-first-detailed-account-ceo-ouster-2024-05-29/"
              >Ex-OpenAI board member provides her first detailed account of CEO
              ouster</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-29 @ 05:17:02</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40508719"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40508390">
          <h3>
            <a
              class="item"
              href="https://www.oreilly.com/radar/what-we-learned-from-a-year-of-building-with-llms-part-i/"
              >What We Learned from a Year of Building with LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-29 @ 04:14:16</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40508390"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40508278">
          <h3>
            <a
              class="item"
              href="https://www.washington.edu/news/2024/05/23/ai-headphones-noise-cancelling-target-speech-hearing/"
              >AI headphones let you listen to a single person in crowd, by
              looking at them</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-29 @ 03:52:36</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40508278"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40508241">
          <h3>
            <a
              class="item"
              href="https://www.abc.net.au/news/2024-05-27/wa-indigenous-app-linking-science-and-culture/103869762"
              >App designed by Indigenous people in W. Australia preserves
              language, culture</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-29 @ 03:45:44</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40508241"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40507391">
          <h3>
            <a
              class="item"
              href="https://www.EmbeddedRelated.com/showarticle/1668.php"
              >How to use I2C devices in (Apache) NuttX: Adding support for an
              I2C device</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-29 @ 01:36:21</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40507391"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40507319">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/NoteAfterNote/7a197233de3d60ff1e23ca90ed2f595a"
              >USB disk as /dev/sda on a not-rooted smartphone using Termux,
              QEMU, Alpine Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-29 @ 01:27:09</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40507319"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40507170">
          <h3>
            <a class="item" href="https://github.com/webview/webview"
              >webview: Tiny cross-platform webview library for C/C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-29 @ 01:00:37</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40507170"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40507039">
          <h3>
            <a class="item" href="https://github.com/2noise/ChatTTS"
              >ChatTTS-Best open source TTS Model</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-29 @ 00:37:58</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40507039"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40506913">
          <h3>
            <a class="item" href="https://github.com/getsavvyinc/savvy-cli"
              >Show HN: Savvy â€“ Create, Share and Run Runbooks from your
              Terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-29 @ 00:15:58</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40506913"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <p>
                Savvy(getsavvy.so) natively integrates with modern LLMs and
                reduces the time to create a great runbook from minutes and
                hours to seconds.
              </p>
              <p>
                Savvy supports creating runbooks entirely with AI(savvy ask) or
                a human in the loop(savvy record.)
              </p>
              <p>
                Savvy Ask: Generate entire runbooks or a single command using
                natural language.
              </p>
              <p>
                Savvy Record: This creates a new subshell that automatically
                expands all aliases before recording commands locally. These
                commands are then sent to an LLM, which generates the first
                version of your runbook.
              </p>
              <p>
                Savvy Record History: This command allows you to go back in time
                and select commands from your recent shell history. There's no
                need to repeat the work you've already done.
              </p>
              <p>
                Runbooks are private by default, but you can share them with
                your team using a link(for now) or export them to markdown.
              </p>
              <p>
                Savvy Explain: Savvy explain generates a simple and
                easy-to-understand explanation for any command or error message
                before you can say RTFM!
              </p>
              <p>
                Savvy Run: Use `savvy run` to search and run runbooks right from
                your terminal. Once you select a runbook, Savvy automatically
                fills in the next command to execute. Just press enter to run
                it.
              </p>
              <p>
                Savvy's README has more details and demos for everything I just
                mentioned.
              </p>
              <p>Savvy's free, and anyone can try it out today.</p>
              <p>
                Install Savvy by running: curl -fsSL
                <a href="https://install.getsavvy.so"
                  >https://install.getsavvy.so</a
                >
                | sh
              </p>
              <p>If you try Savvy, I'd love your feedback on the product.</p>
            </div>
          </section>
        </section>
        <section id="40506340">
          <h3>
            <a
              class="item"
              href="https://mail.openjdk.org/pipermail/jdk-dev/2024-May/009028.html"
              >Proposal to change default annotation processing policy in JDK
              23</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 22:36:59</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40506340"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40505213">
          <h3>
            <a
              class="item"
              href="https://tinlizzie.org/~ohshima/shadama2/live2017/"
              >Shadama: A particle simulation programming environment for
              everyone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 20:25:20</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40505213"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40505167">
          <h3>
            <a
              class="item"
              href="https://db.in.tum.de/~ellmann/theses/finished/24/pirhonen_writing_an_nvme_driver_in_rust.pdf"
              >Writing an NVMe Driver in Rust [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 20:21:36</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40505167"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40505099">
          <h3>
            <a
              class="item"
              href="https://aksh-garg.medium.com/llama-3v-building-an-open-source-gpt-4v-competitor-in-under-500-7dd8f1f6c9ee"
              >Llama 3-V: Matching GPT4-V with a 100x smaller model and 500
              dollars</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 20:16:19</span
              ><span class="points-container"
                >Points: <span class="points">350</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40505099"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40504756">
          <h3>
            <a class="item" href="https://jviide.iki.fi/http-redirects"
              >API Shouldn't Redirect HTTP to HTTPS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 19:42:34</span
              ><span class="points-container"
                >Points: <span class="points">440</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40504756"
                  >Comments</a
                ><span class="descendants">: 204</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40504481">
          <h3>
            <a
              class="item"
              href="https://github.com/brian-smith-github/ch32v003_stt"
              >Simple Speech-to-Text on the '10 Cents' CH32V003
              Microcontroller</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 19:20:38</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40504481"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40504265">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/paris-catacomb-mushrooms"
              >Paris's Catacomb Mushrooms (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 19:02:53</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40504265"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40503202">
          <h3>
            <a
              class="item"
              href="https://chrisbuilds.github.io/terminaltexteffects/showroom/"
              >TTE: Terminal Text Effects</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 17:31:48</span
              ><span class="points-container"
                >Points: <span class="points">1197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40503202"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40502956">
          <h3>
            <a class="item" href="https://github.com/openkoda/openkoda"
              >Show HN: Openkoda â€“ Openâ€“source, private, Salesforce
              alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 17:11:56</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40502956"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40502877">
          <h3>
            <a
              class="item"
              href="https://www.flickr.com/photos/jurvetson/albums/72157623704246792/"
              >Steve Jurvetson's personal collection of Apollo Lunar Module
              parts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 17:03:03</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40502877"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40502858">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/66397"
              >Linum (YC W23) is a hiring a founding AI engineer to train
              text-to-video models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 17:00:50</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40502090">
          <h3>
            <a
              class="item"
              href="https://github.com/karpathy/llm.c/discussions/481"
              >Reproducing GPT-2 in llm.c</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 15:58:46</span
              ><span class="points-container"
                >Points: <span class="points">458</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40502090"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40501561">
          <h3>
            <a
              class="item"
              href="https://blog.r-project.org/2024/05/17/generalizing-support-for-functional-oop-in-r/index.html"
              >Generalizing Support for Functional OOP in R</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 15:19:00</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40501561"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40501164">
          <h3>
            <a class="item" href="https://github.com/turbo9team/turbo9"
              >Turbo9 â€“ A Compact and Efficient Pipelined 6809 Microprocessor
              IP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 14:39:14</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40501164"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40501021">
          <h3>
            <a class="item" href="https://grooved.okat.best/"
              >Show HN: I made a free app to calibrate your turntable by simply
              playing a song</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 14:23:28</span
              ><span class="points-container"
                >Points: <span class="points">347</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40501021"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
            <div class="text">
              <p>
                I made a little app that lets you to calibrate your turntable by
                putting on any record and tapping a button. It's called Grooved
                and it uses your phone's microphone to see how fast your platter
                is going, almost like magic.
              </p>
              <p>
                You can see what it looks like in action here:
                <a
                  href="https://twitter.com/OKatBest/status/1795453042994680148"
                  >https://twitter.com/OKatBest/status/1795453042994680148</a
                >
              </p>
              <p>
                The app itself is free without ads, subscriptions, or trackers.
                It's a tool I built for myself, and I just thought someone else
                might want to use it too. I have never seen this technology
                being used before, all other apps require you to either print
                something and use the camera, or to place your phone on the
                spinning platter and use the accelerometer.
              </p>
              <p>
                You can grab it on the App Store, and I am working on an Android
                version I hope to release at some point in June.
              </p>
              <p>Would love to hear what you think about it!</p>
              <p>Ivan_</p>
            </div>
          </section>
        </section>
        <section id="40501015">
          <h3>
            <a
              class="item"
              href="https://eos.org/science-updates/an-air-quality-model-that-is-evolving-with-the-times"
              >An air quality model that is evolving with the times</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 14:22:52</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40501015"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40498580">
          <h3>
            <a class="item" href="https://www.file0.dev"
              >Show HN: File0 â€“ An easier way to manage files in serverless
              apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 08:17:00</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40498580"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
            <div class="text">
              <p>
                I can't be asked, so I built FILE0. It's for storing files but
                you don't need to complete an online course.
              </p>
            </div>
          </section>
        </section>
        <section id="40498533">
          <h3>
            <a
              class="item"
              href="https://developers.redhat.com/articles/2024/05/28/beginners-guide-shenandoah-garbage-collector"
              >Beginner's guide to the Shenandoah garbage collector</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 08:09:46</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40498533"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40497769">
          <h3>
            <a class="item" href="https://github.com/tan-ad/SignWave"
              >SignWave: Program to transcribe text, audio files into a sign
              language animation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 06:00:19</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40497769"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40496660">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-05-succeed-accurately-dating-year-prehistoric.html"
              >Researchers accurately dating a 7k-year-old settlement using
              cosmic rays</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 02:00:13</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40496660"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40491896">
          <h3>
            <a
              class="item"
              href="https://nymag.com/intelligencer/article/darling-58-american-chestnut-tree-mistake.html"
              >The problem with the Darling 58 genetically modified chestnut
              tree</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-27 @ 15:50:34</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40491896"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
