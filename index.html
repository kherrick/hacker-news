<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40001833">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/unveiling-the-modern-computer"
              >Herman Goldstine and the IAS Machine: Unveiling the Modern
              Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 13:21:08</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40001833"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40001597">
          <h3>
            <a
              class="item"
              href="https://www.oranlooney.com/post/angle-addition/"
              >Stacking Triangles for Fun and Profit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 12:57:18</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40001597"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40001414">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/24126502/humane-ai-pin-review"
              >Humane AI Pin review: not even close</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 12:31:28</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40001414"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40001209">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/fern/jobs/BfXHkk5-frontend-engineer"
              >Fern (YC W23) Is Hiring a Front End Engineer in Brooklyn, NY</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 12:00:32</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40001193">
          <h3>
            <a class="item" href="https://github.com/xenova/transformers.js"
              >Transformers.js â€“ Run Transformers directly in the browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 11:57:46</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40001193"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40001150">
          <h3>
            <a
              class="item"
              href="https://vadimkravcenko.com/shorts/mental-health-in-software-engineering/"
              >Mental Health in Software Engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 11:50:57</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40001150"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40000687">
          <h3>
            <a
              class="item"
              href="https://consumer.huawei.com/cn/laptops/matebook-x-pro-ultra-premium-edition/"
              >Huawei Releases Ultra 9 MateBook X Pro with 40W TDP in 980g</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 10:41:54</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40000687"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40000443">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/satellite-constellation-formation-flying-esa"
              >ESA Satellites to Test Razor-Sharp Formation Flying</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 10:05:55</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40000443"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40000397">
          <h3>
            <a class="item" href="https://github.com/baskerville/plato"
              >Plato Document Reader for Kobo E-Readers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 09:58:26</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40000397"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39998740">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41467-024-46016-1"
              >Roll-to-roll fabricated perovskite solar cells under ambient room
              conditions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 05:41:16</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39998740"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39998346">
          <h3>
            <a class="item" href="https://rachelbythebay.com/w/2024/04/10/rtc/"
              >Going in circles without a real-time clock</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 04:22:04</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39998346"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39996521">
          <h3>
            <a
              class="item"
              href="https://rednafi.com/misc/etag_and_http_caching/"
              >ETag and HTTP Caching</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 22:51:47</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39996521"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39995782">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/now-we-know-where-dead-went-did-grave-robbers-plunder-battlefields"
              >Did grave robbers plunder battlefields?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 21:13:17</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39995782"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39995725">
          <h3>
            <a class="item" href="https://github.com/paul-gauthier/aider"
              >Aider: AI pair programming in your terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 21:06:42</span
              ><span class="points-container"
                >Points: <span class="points">367</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39995725"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39994339">
          <h3>
            <a class="item" href="https://forge.soutade.fr/soutade/libgourou"
              >Libgourou: A Free Implementation of Adobe's Adept DRM on ePub/PDF
              Files</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 18:49:47</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39994339"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39993976">
          <h3>
            <a class="item" href="https://blog.val.town/blog/search-notes/"
              >Code search is hard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 18:15:08</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39993976"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39993626">
          <h3>
            <a
              class="item"
              href="https://github.com/google-deepmind/recurrentgemma"
              >Implementation of Google's Griffin Architecture â€“ RNN LLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 17:47:11</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39993626"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39992817">
          <h3>
            <a class="item" href="https://sonauto.ai/"
              >Show HN: Sonauto â€“ A more controllable AI music creator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 16:48:01</span
              ><span class="points-container"
                >Points: <span class="points">396</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39992817"
                  >Comments</a
                ><span class="descendants">: 207</span></span
              >
            </h4>
            <div class="text">
              <p>
                My cofounder and I trained an AI music generation model and
                after a month of testing we're launching 1.0 today. Ours is
                interesting because it's a latent diffusion model instead of a
                language model, which makes it more controllable:
                <a href="https://sonauto.ai/">https://sonauto.ai/</a>
              </p>
              <p>
                Others do music generation by training a Vector Quantized
                Variational Autoencoder like Descript Audio Codec (<a
                  href="https://github.com/descriptinc/descript-audio-codec"
                  >https://github.com/descriptinc/descript-audio-codec</a
                >) to turn music into tokens, then training an LLM on those
                tokens. Instead, we ripped the tokenization part off and
                replaced it with a normal variational autoencoder bottleneck
                (along with some other important changes to enable insane
                compression ratios). This gave us a nice, normally distributed
                latent space on which to train a diffusion transformer (like
                Sora). Our diffusion model is also particularly interesting
                because it is the first audio diffusion model to generate
                coherent lyrics!
              </p>
              <p>
                We like diffusion models for music generation because they have
                some interesting properties that make controlling them easier
                (so you can make <i>your own</i> music instead of just taking
                what the machine gives you). For example, we have a rhythm
                control mode where you can upload your own percussion line or
                set a BPM. Very soon you'll also be able to generate proper
                variations of an uploaded or previously generated song (e.g.,
                you could even sing into Voice Memos for a minute and upload
                that!). @Musicians of HN, try uploading your songs and using
                Rhythm Control/let us know what you think! Our goal is to enable
                more of you, not replace you.
              </p>
              <p>
                For example, we turned this drum line (<a
                  href="https://sonauto.ai/songs/uoTKycBghUBv7wA2YfNz"
                  >https://sonauto.ai/songs/uoTKycBghUBv7wA2YfNz</a
                >) into this full song (<a
                  href="https://sonauto.ai/songs/KSK7WM1PJuz1euhq6lS7"
                  >https://sonauto.ai/songs/KSK7WM1PJuz1euhq6lS7</a
                >
                skip to 1:05 if impatient) or this other song I like better (<a
                  href="https://sonauto.ai/songs/qkn3KYv0ICT9kjWTmins"
                  >https://sonauto.ai/songs/qkn3KYv0ICT9kjWTmins</a
                >
                - we accidentally compressed it with AAC instead of Opus which
                hurt quality, though)
              </p>
              <p>
                We also like diffusion models because while they're expensive to
                train, they're cheap to serve. We built our own efficient
                inference infrastructure instead of using those expensive
                inference as a service startups that are all the rage. That's
                why we're making generations on our site free and unlimited for
                as long as possible.
              </p>
              <p>
                We'd love to answer your questions. Let us know what you think
                of our first model!
                <a href="https://sonauto.ai/">https://sonauto.ai/</a>
              </p>
            </div>
          </section>
        </section>
        <section id="39990346">
          <h3>
            <a class="item" href="https://adsb.exposed/"
              >Show HN: ADS-B visualizer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 13:15:02</span
              ><span class="points-container"
                >Points: <span class="points">303</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39990346"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
            <div class="text">
              <a href="https://adsb.exposed/">https://adsb.exposed/</a>
              <p>
                Source code:
                <a href="https://github.com/ClickHouse/adsb.exposed/"
                  >https://github.com/ClickHouse/adsb.exposed/</a
                >
              </p>
              <p>
                The results significantly exceeded my expectations because the
                pictures are insanely beautiful, and the data is a treasure
                trove.
              </p>
              <p>
                It proves many statements that were not certain: - it is
                feasible to generate tiles by aggregation on a pixel level
                (instead of hexagons or rectangular grid); - it does not require
                JPG/PNG tiles - we can transfer raw bitmap data with zstd
                compression; - it is possible to do it in real time;
              </p>
            </div>
          </section>
        </section>
        <section id="39990004">
          <h3>
            <a class="item" href="https://awards.acm.org/about/2023-turing"
              >2023 ACM Turing Prize awarded to Avi Wigderson</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 12:36:43</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39990004"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39987735">
          <h3>
            <a
              class="item"
              href="https://begin.com/blog/posts/2024-04-08-introducing-enhance-wasm"
              >Enhance WASM: Back End Agnostic SSR for Web Components</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 06:56:40</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39987735"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39987158">
          <h3>
            <a class="item" href="https://urban-resources.net/untergunther.html"
              >Untergunther â€“ Restoration of the Pantheon Clock</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 05:10:53</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39987158"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39979408">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2024/04/08/1242346659/genetically-modified-bioluminescent-petunias-make-their-own-light"
              >Bioluminescent Petunias at Home</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 13:49:05</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39979408"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978423">
          <h3>
            <a class="item" href="https://celltypes.brain-map.org/data"
              >1.3k recordings and trace drawings of neurons</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 11:44:57</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978423"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39976640">
          <h3>
            <a class="item" href="https://qdiv.dev/posts/eth2/"
              >Show HN: I made a discrete logic network card</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 06:24:15</span
              ><span class="points-container"
                >Points: <span class="points">496</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39976640"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39976634">
          <h3>
            <a class="item" href="https://ohmygit.org/"
              >Oh My Git: An open source game about learning Git</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 06:22:43</span
              ><span class="points-container"
                >Points: <span class="points">321</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39976634"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39973088">
          <h3>
            <a class="item" href="https://github.com/wouterken/crystalruby"
              >Embed Crystal code directly in Ruby</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 19:53:07</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39973088"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39972586">
          <h3>
            <a class="item" href="https://github.com/larryboyko/dimityjones"
              >Show HN: Dimity Jones in Puzzle Castle: An Electronic Escape
              Novel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 18:47:31</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39972586"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
            <div class="text">
              <p>Think: escape room in the form of a novel.</p>
              <p>
                A computer, and rudimentary coding skills in a language of your
                choice, will be indispensable for performing the transformations
                -- and might help with the solving too!
              </p>
              <p>
                My wife, the author, passed away five years ago. This is not the
                last thing she wrote, but it is the most unusual,
                unapproachable, and personal of her major works. It is also, as
                the only novel of hers that I cannot breeze through in an
                afternoon (and despite my unflattering appearance in it), my
                favorite.
              </p>
              <p>
                Though _Dimity Jones_ was left unfinished, and perhaps
                abandoned, at the time of my wife's death, its elements were all
                there, on her hard disk, awaiting only a final compiling. My
                contribution to this text has therefore been little more than
                that of an occasional copyeditor (my wife was a meticulous
                speller and self-proofreader) and playtester.
              </p>
              <p>
                Before releasing this work more widely, I would love to have it
                test-driven by better coders and puzzlers than I.
              </p>
              <p>
                Any and all feedback is welcome, from positive to negative, from
                the sweeping to the picayune. Let me know what confuses or
                frustrates you -- and especially let me know if (where) you get
                stuck.
              </p>
              <p>
                Otherwise, there are no special instructions; it's all in the
                book.
              </p>
              <p>
                While _Dimity Jones_ is still in its debugging/proofreading
                phase, please refrain from sharing it or putting it any (other)
                public place. (Christine would have been horrified to see her
                work thus published before it was letter-perfect; but I have
                exhausted my pool of friends and colleagues both able and
                willing to tinker with it. This seems like the ideal community
                of potential testers.)
              </p>
              <p>Thanking you in advance. I hope you enjoy!</p>
            </div>
          </section>
        </section>
        <section id="39972047">
          <h3>
            <a
              class="item"
              href="https://www.thecollector.com/stolen-masterpieces-famous-artworks-missing/"
              >Stolen masterpieces that are still missing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 17:43:57</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39972047"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39970136">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20240408-00/?p=109627"
              >How does the classic Win32 ListView handle incremental
              searching?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 14:32:03</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39970136"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
