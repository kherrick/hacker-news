<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39772571">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/wisconsin-electric-vehicles-charging-stations-8f240084670b7b210d162f83b22168d9"
              >Governor signs bills creating EV charging station network across
              Wisconsin</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 22:07:23</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39772571"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39772468">
          <h3>
            <a
              class="item"
              href="https://store.steampowered.com/news/app/593110/view/4118051100641390121"
              >Valve Built An Orb: The making of the Steam Deck OLED launch
              trailer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 21:56:34</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39772468"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39772295">
          <h3>
            <a
              class="item"
              href="https://twitter.com/neuralink/status/1770563939413496146"
              >Neuralink patient controls games by thinking during interview</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 21:37:33</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39772295"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39771983">
          <h3>
            <a class="item" href="https://www.jitx.com"
              >JITX – The Fastest Way to Design Circuit Boards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 21:01:11</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39771983"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39771446">
          <h3>
            <a
              class="item"
              href="https://alumni.berkeley.edu/california-magazine/summer-2017-adaptation/starship-or-canoe-where-will-our-future-adaptations-be/"
              >The Starship or the Canoe: Where Will Our Future Adaptations Be?
              (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 20:11:02</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39771446"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39770908">
          <h3>
            <a class="item" href="https://github.com/getgrit/gritql"
              >Show HN: GritQL, a Rust CLI for rewriting source code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 19:23:11</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39770908"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’m excited to open source GritQL, a Rust CLI for searching and
                transforming source code.
              </p>
              <p>
                GritQL comes from my experiences with conducting large scale
                refactors and migrations.
              </p>
              <p>
                Usually, I would start exploring a codebase with grep. This is
                easy to start with, but most migrations end up accumulating
                additional requirements like ensuring the right packages are
                imported and excluding cases which don’t have a viable migration
                path.
              </p>
              <p>
                Eventually, to build a complex migration, I usually ended up
                having to write a full codemod program with a tool like
                jscodeshift. This comes with its own problems:
              </p>
              <p>
                - Most of the exploratory work has to be abandoned as you figure
                out how to represent your original regex search as an AST. -
                Reading/writing a codemod requires mentally translating from AST
                names back to what source code actually looks like. -
                Performance is often an afterthought, so iterating on a large
                codemod can be painfully slow. - Codemod frameworks are
                language-specific, so if you’re hopping between multiple
                languages—or trying to migrate a shared API—you have to learn
                different tools.
              </p>
              <p>
                GritQL is an attempt to develop a powerful middle ground: -
                Exploratory analysis is easy: just put a code snippet in
                backticks and use $metavariables for placeholders. -
                Incrementally add complexity by introducing side conditions with
                where clauses. - Reuse named patterns to avoid rebuilding
                queries, and use shared patterns from our standard library for
                common tasks like ensuring modules are imported. - Iterate on
                large codebases quickly: we use Rust for maximum performance
              </p>
              <p>
                GritQL has already been used on thousands of repositories for
                complex migrations[1] but we're excited to collaborate more with
                the open source community.
              </p>
              <p>
                [1] Ex.
                <a
                  href="https://github.com/openai/openai-python/discussions/742"
                  >https://github.com/openai/openai-python/discussions/742</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39770249">
          <h3>
            <a
              class="item"
              href="https://www.qamcom.com/look-into-qamcoms-research-on-5g/"
              >5GSimWaveform: Open Source Common Waveform Simulator for 5G
              Physical Layer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 18:24:31</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39770249"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39769708">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/03/20/openais-chatbot-store-is-filling-up-with-spam/"
              >OpenAI's chatbot store is filling up with spam</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 17:34:58</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39769708"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39769412">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39769412"
              >Launch HN: CamelQA (YC W24) – AI that tests mobile apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 17:13:07</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39769412"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
            <div class="text">
              <a href="https://camelqa.com/">https://camelqa.com/</a>). We’re
              building an AI agent that can automate mobile devices using
              computer vision. Our first use case is for mobile app QA. We
              convert natural language test cases into tests that run on real
              iOS and Android devices in our device farm.
              <p>
                Flaky UI tests suck. We want to create a solution where
                engineers don’t waste time maintaining fragile scripts.
              </p>
              <p>
                camelQA uses a combination of accessibility element data along
                with an in-house custom vision-only RCNN object detection model
                paired with Google Siglip for UI element classification (see a
                sample output here -
                <a href="https://camelqa.com/blog/sole-ui-element-detector.png"
                  >https://camelqa.com/blog/sole-ui-element-detector.png</a
                >). This way we’re able to detect elements even if they do not
                have accessibility elements associated with them.
              </p>
              <p>
                Under the hood the agent is using Appium to interface with the
                device. We use GPT-4V to reason at a high level and GPT-3.5 to
                execute the high-level actions. Check out a gif of our
                playground here (<a
                  href="https://camelqa.com/blog/sole-signup.gif"
                  >https://camelqa.com/blog/sole-signup.gif</a
                >)
              </p>
              <p>
                Since we’re vision based, we don’t need access to your source
                code and we work across all app types - SwiftUI and UIKit, React
                Native, Flutter.
              </p>
              <p>
                We built a demo for HN where you can use our model to control
                Wikipedia on a simulated iPhone. Check that out here (<a
                  href="https://demo.camelqa.com/"
                  >https://demo.camelqa.com/</a
                >). Try giving it a task like “Bookmark the wiki page for Ilya
                Sutskever“ or “Find San Francisco in the Places tab”. We only
                have 5 simulators running so there may be a wait. You get 5
                minutes once you enter your first command.
              </p>
              <p>
                If you want to see what our front end looks like, we made an
                account with some test runs. Use this login (Username:
                hackerNews Password: 1337hackerNews!) to view our sandboxed HN
                account (<a href="https://dash.camelqa.com/login"
                  >https://dash.camelqa.com/login</a
                >).
              </p>
              <p>
                Last year we left our corporate jobs to build in the AI space.
                It felt like we were endlessly testing our apps, even for minor
                updates, and we still shipped a bug that caused one of our apps
                to crash on subscribe (the app in question -
                <a
                  href="https://apps.apple.com/us/app/tldr-ai-summarizer/id6449304716"
                  >https://apps.apple.com/us/app/tldr-ai-summarizer/id644930471...</a
                >). That was the catalyst for camelQA.
              </p>
              <p>We’re excited to hear what you all think!</p>
            </div>
          </section>
        </section>
        <section id="39769263">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/fathom/jobs/TArBVR8-senior-site-reliability-engineer-remote"
              >Fathom AI Notetaker (YC W21) Is Hiring a Senior SRE (Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 17:01:18</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39768860">
          <h3>
            <a class="item" href="https://danluu.com/discontinuities/"
              >Suspicious discontinuities (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 16:31:14</span
              ><span class="points-container"
                >Points: <span class="points">267</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39768860"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39768604">
          <h3>
            <a
              class="item"
              href="https://news.northeastern.edu/2024/03/20/parrots-playing-tablet-games/"
              >Parrots love playing tablet games. That's helping researchers
              understand them</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 16:15:03</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39768604"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39768438">
          <h3>
            <a
              class="item"
              href="https://scholar.googleblog.com/2024/03/supercharge-your-pdf-reading-follow.html"
              >Google Scholar PDF Reader</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 16:03:59</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39768438"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39768434">
          <h3>
            <a
              class="item"
              href="https://www.flightradar24.com/blog/gps-jamming-map/"
              >Flightradar24's new GPS jamming map</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 16:03:21</span
              ><span class="points-container"
                >Points: <span class="points">563</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39768434"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39766893">
          <h3>
            <a
              class="item"
              href="https://rive.app/blog/rive-renderer-now-open-source-and-available-on-all-platforms"
              >Rive Renderer for real-time vector graphics is now open source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 14:16:52</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39766893"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39766236">
          <h3>
            <a
              class="item"
              href="https://myme.no/posts/2024-03-19-focus-by-automation.html"
              >Focus by Automation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 13:33:57</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39766236"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39766222">
          <h3>
            <a
              class="item"
              href="https://antithesis.com/blog/deterministic_hypervisor/"
              >So you think you want to write a deterministic hypervisor?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 13:32:41</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39766222"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39766170">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/eight-google-employees-invented-modern-ai-transformers-paper/"
              >The Google employees who created transformers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 13:29:02</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39766170"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39765718">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/03/20/us/politics/chips-act-grant-intel.html"
              >Intel to Receive $8.5B in Grants to Build Chip Plants</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 12:51:35</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39765718"
                  >Comments</a
                ><span class="descendants">: 345</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39765715">
          <h3>
            <a class="item" href="https://tavianator.com/2024/btrfs_bug.html"
              >Bug hunting in Btrfs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 12:51:12</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39765715"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39765692">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/03/17/realestate/paris-france-housing-costs.html"
              >Paris preserves its mixed society by pouring billions into public
              housing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 12:48:31</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39765692"
                  >Comments</a
                ><span class="descendants">: 539</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39765630">
          <h3>
            <a class="item" href="https://anchor.dev/blog/introducing-lcl-host"
              >Lcl.host: fast, easy HTTPS in your local dev environment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 12:42:16</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39765630"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39764992">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2024/homemade-ebike-battery-indonesia/"
              >Indonesia's e-bike shops are building their own batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 11:20:26</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39764992"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39764954">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/michel-talagrand-wins-abel-prize-for-work-wrangling-randomness-20240320/"
              >Michel Talagrand wins Abel Prize for work wrangling randomness</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 11:12:39</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39764954"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39763750">
          <h3>
            <a
              class="item"
              href="https://sethmlarson.dev/regex-$-matches-end-of-string-or-newline"
              >Regex character "$" doesn't mean "end-of-string"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 07:50:09</span
              ><span class="points-container"
                >Points: <span class="points">379</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39763750"
                  >Comments</a
                ><span class="descendants">: 300</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39763458">
          <h3>
            <a
              class="item"
              href="https://twitter.com/kenshirriff/status/1770188240777044079"
              >Space Shuttle teleprinter reverse engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 06:45:26</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39763458"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39748761">
          <h3>
            <a
              class="item"
              href="https://discover.lanl.gov/publications/actinide-research-quarterly/first-quarter-2023/hitting-the-jackpot-the-birth-of-the-monte-carlo-method/"
              >Hitting the Jackpot: The Birth of the Monte Carlo Method
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-18 @ 19:21:48</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39748761"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39745365">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-03-18/encyclopaedia-britannica-seeking-1-billion-valuation-in-ipo"
              >Encyclopaedia Britannica Seeking $1B Valuation in IPO</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-18 @ 14:51:40</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39745365"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39734094">
          <h3>
            <a class="item" href="https://eclipsetracks.org/">Eclipse Tracks</a>
          </h3>
          <section>
            <h4>
              <span>2024-03-17 @ 12:41:48</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39734094"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39733408">
          <h3>
            <a
              class="item"
              href="https://rubenerd.com/finally-got-my-ultimate-retro-kvm-setup-working/"
              >Got my ultimate retro KVM setup working</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-17 @ 10:41:54</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39733408"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
