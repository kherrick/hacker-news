<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42016478">
          <h3>
            <a
              class="item"
              href="https://www.tandfonline.com/doi/full/10.1080/00934690.2024.2409503#abstract"
              >Alexander the Great's tunic identified in royal tomb at
              Vergina</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-01 @ 12:54:14</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42016478"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42015284">
          <h3>
            <a
              class="item"
              href="https://martinfowler.com/articles/strangler-fig-mobile-apps.html"
              >Using the Strangler Fig with Mobile Apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-01 @ 09:30:13</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42015284"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42014650">
          <h3>
            <a class="item" href="https://oasis-model.github.io/"
              >Oasis: A Universe in a Transformer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-01 @ 07:02:48</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42014650"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42014642">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/pythagora-gpt-pilot/jobs/CNr5q8B-ux-designer-wanted-to-design-a-new-user-experience-for-developers-in-the-ai-world"
              >Pythagora (GPT Pilot) (YC W24) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-01 @ 07:01:09</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42013843">
          <h3>
            <a
              class="item"
              href="https://www.scattered-thoughts.net/writing/what-is-the-point-of-an-online-conference/"
              >What is the point of an online conference?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-01 @ 03:38:37</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42013843"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42013762">
          <h3>
            <a
              class="item"
              href="https://technicalwriting.dev/data/embeddings.html"
              >Embeddings are underrated</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-01 @ 03:24:17</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42013762"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42013091">
          <h3>
            <a
              class="item"
              href="https://www.cell.com/cell/fulltext/S0092-8674(24)01093-6?_returnURL=https%3A%2F%2Flinkinghub.elsevier.com%2Fretrieve%2Fpii%2FS0092867424010936%3Fshowall%3Dtrue"
              >A conserved fertilization complex bridges sperm and egg in
              vertebrates</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-01 @ 01:04:01</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42013091"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42011770">
          <h3>
            <a
              class="item"
              href="https://www.physicalintelligence.company/blog/pi0?blog"
              >Our First Generalist Policy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 21:34:34</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42011770"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42011239">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/995383/34dc5950cab5e739/"
              >An Update on Apple M1/M2 GPU Drivers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 20:36:53</span
              ><span class="points-container"
                >Points: <span class="points">487</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42011239"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42009196">
          <h3>
            <a
              class="item"
              href="https://www.sagelyhealth.com/blog-posts/cancers-magic-bullet-antibody-drug-conjugates"
              >Antibody Drug Conjugates: A frontier in cancer treatment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 17:35:11</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42009196"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42009089">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42009089"
              >Launch HN: Patched (YC S24) – AI workflows for post-code tasks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 17:27:41</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42009089"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <a href="https://patched.codes">https://patched.codes</a>). We
              help dev teams accelerate tasks like code reviews, docs, and
              patches through customizable, self-hostable workflows. Here’s a
              quick video walkthrough:
              <a href="https://youtu.be/5hvWGB5avVo"
                >https://youtu.be/5hvWGB5avVo</a
              >
              <p>
                There is a lot of excitement around code generation and the
                development inner loop. But having built DevSecOps startups
                previously, we know how the bottlenecks developers face often
                occur in the “outer loop”, especially after the code is written.
                With Patched, we want to help code get shipped as fast as it is
                generated.
              </p>
              <p>
                Patched has two core components. First is the workflow builder
                that switches seamlessly between no-code and full-code. Second
                is the chat-based query interface for your code, logs, and issue
                tracker. When used together, they can help orchestrate and
                automate the most painful parts of the software development
                lifecycle.
              </p>
              <p>
                Here is an example PR created by a patchflow that automates SDK
                generation with complex type information:
                <a href="https://github.com/stack-auth/stack/pull/300"
                  >https://github.com/stack-auth/stack/pull/300</a
                >.
              </p>
              <p>
                Under the hood, Patched is powered by our patchwork library (<a
                  href="https://github.com/patched-codes/patchwork"
                  >https://github.com/patched-codes/patchwork</a
                >) and an LLM optimization proxy(<a
                  href="https://github.com/codelion/optillm"
                  >https://github.com/codelion/optillm</a
                >) - both of which we have open-sourced. You can run these
                workflows within your CI/CD pipeline, or from the command line,
                completely independent of our platform. This gives you full
                control without being locked in, while allowing us to build a
                monetizable product around it.
              </p>
              <p>
                While there are some great point solutions for tackling
                individual tasks, we believe the real solution lies in an open,
                holistic approach—one that teams can tweak, extend, or
                self-host.
              </p>
              <p>
                You can try Patched at
                <a href="https://app.patched.codes/signin"
                  >https://app.patched.codes/signin</a
                >
                - we’d love to hear your feedback on our approach and the user
                experience.
              </p>
            </div>
          </section>
        </section>
        <section id="42008569">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/introducing-chatgpt-search/"
              >ChatGPT Search</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 16:41:22</span
              ><span class="points-container"
                >Points: <span class="points">1276</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42008569"
                  >Comments</a
                ><span class="descendants">: 1039</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42007649">
          <h3>
            <a class="item" href="https://claude.ai/download"
              >Claude for Desktop</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 15:04:27</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42007649"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42006698">
          <h3>
            <a
              class="item"
              href="https://blog.trailofbits.com/2024/10/31/fuzzing-between-the-lines-in-popular-barcode-software/"
              >Fuzzing between the lines in popular barcode software</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 13:28:31</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42006698"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42005601">
          <h3>
            <a
              class="item"
              href="https://illya.sh/the-codeumentary-blog/regular-expression-check-if-number-is-prime/"
              >Demystifying the regular expression that checks if a number is
              prime (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 11:11:52</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42005601"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42004133">
          <h3>
            <a class="item" href="https://hazel.org/"
              >Hazel: A live functional programming environment featuring typed
              holes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 06:57:35</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42004133"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42004069">
          <h3>
            <a
              class="item"
              href="https://acshist.scs.illinois.edu/bulletin_open_access/num10/num10%20p25-31.pdf"
              >Food Colorants Before Aniline Dyes (1991) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 06:40:48</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42004069"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41999923">
          <h3>
            <a
              class="item"
              href="https://sophiebits.com/2024/10/30/everyone-is-wrong-about-that-slack-flowchart"
              >Everyone is wrong about that Slack flowchart</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-30 @ 20:32:58</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41999923"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41999852">
          <h3>
            <a class="item" href="https://www.nandgame.com"
              >NandGame – Build a computer from scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-30 @ 20:27:12</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41999852"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41998838">
          <h3>
            <a
              class="item"
              href="https://kaleidawave.github.io/posts/sets-types-and-type-checking/"
              >Sets, types and type checking</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-30 @ 18:53:50</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41998838"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41996608">
          <h3>
            <a
              class="item"
              href="https://surfingcomplexity.blog/2024/10/29/the-carefulness-knob/"
              >The carefulness knob</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-30 @ 15:58:39</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41996608"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41995615">
          <h3>
            <a
              class="item"
              href="https://john.onolan.org/democratising-publishing/"
              >Democratising publishing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-30 @ 14:52:55</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41995615"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41989134">
          <h3>
            <a
              class="item"
              href="https://www.tandfonline.com/doi/full/10.1080/00029890.2024.2370240"
              >Five or ten new proofs of the Pythagorean Theorem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-29 @ 20:40:41</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41989134"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41975746">
          <h3>
            <a
              class="item"
              href="https://andrewpwheeler.com/2024/10/28/suits-money-laundering-and-linear-programming/"
              >Suits, money laundering, and linear programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-28 @ 20:19:01</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41975746"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41974168">
          <h3>
            <a class="item" href="https://paper.wf/binarycat/rtp"
              >RTP: One protocol to rule them all?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-28 @ 18:06:31</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41974168"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41973116">
          <h3>
            <a class="item" href="https://github.com/eshaz/wasm-audio-decoders"
              >Web Assembly audio decoders highly optimized for size and
              performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-28 @ 16:37:13</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41973116"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41972605">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2410.18280"
              >Crux, a Precise Verifier for Rust and Other Languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-28 @ 16:03:23</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41972605"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41972173">
          <h3>
            <a class="item" href="https://lectron.info/"
              >Lectron System, the Arduino Precursor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-28 @ 15:34:58</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41972173"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41969416">
          <h3>
            <a class="item" href="https://github.com/goblint/cil"
              >CIL: C Intermediate Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-28 @ 09:57:38</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41969416"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41963104">
          <h3>
            <a
              class="item"
              href="https://ruwix.com/blog/34x34x34-rubiks-cube-record/"
              >34x34x34 Rubik's Cube</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-27 @ 15:06:25</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41963104"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
