<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40485318">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/by-invitation/2024/05/26/ai-firms-mustnt-govern-themselves-say-ex-members-of-openais-board"
              >AI firms mustn’t govern themselves, say ex-members of OpenAI’s
              board</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 20:55:48</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40485318"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40485246">
          <h3>
            <a
              class="item"
              href="https://jakeseliger.com/2024/05/25/the-one-year-anniversary-of-my-total-glossectomy/"
              >The one-year anniversary of my total glossectomy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 20:46:50</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40485246"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40485185">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40485185"
              >Ask HN: How would you chunk a large Excel file?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 20:38:27</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40485185"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                Edit: Guys this is just an example. I'm looking for a general
                solution. It could be 10 million rows.
              </p>
            </div>
          </section>
        </section>
        <section id="40485053">
          <h3>
            <a
              class="item"
              href="https://lapcatsoftware.com/articles/2024/5/4.html"
              >macOS Sonoma silently enabled iCloud Keychain despite my
              precautions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 20:18:31</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40485053"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40484930">
          <h3>
            <a class="item" href="http://pcmicro.com/getdiz/file_id.html"
              >FILE_ID.DIZ Description (1994)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 20:04:59</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40484930"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40484591">
          <h3>
            <a
              class="item"
              href="https://www.nrk.no/tromsogfinnmark/this-is-what-the-damaged-svalbard-cable-looked-like-when-it-came-up-from-the-depths-1.16895904"
              >What the damaged Svalbard cable looked like when it came up from
              the depths</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 19:12:58</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40484591"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40484513">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Milk_watcher"
              >Milk Watcher</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 19:00:34</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40484513"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40484512">
          <h3>
            <a class="item" href="https://github.com/iyaja/llama-fs"
              >llama-fs: A self-organizing file system with llama 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 19:00:21</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40484512"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40484190">
          <h3>
            <a class="item" href="https://compcert.org/compcert-C.html"
              >The CompCert C Compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 18:15:41</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40484190"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40484168">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=v1SGDbpeFFg"
              >Launch from inside an Apollo capsule (restored in 4K/30 FPS)
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 18:11:15</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40484168"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40484007">
          <h3>
            <a
              class="item"
              href="https://redirect.cs.umbc.edu/courses/331/resources/papers/Evolution-of-Lisp.pdf"
              >The Evolution of Lisp (1993) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 17:48:59</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40484007"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40483882">
          <h3>
            <a class="item" href="https://github.com/harbaum/NanoMig"
              >Amiga Minimig Ported to Tang Nano 20k FPGA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 17:31:58</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40483882"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40483878">
          <h3>
            <a
              class="item"
              href="https://github.com/transcriptionstream/transcriptionstream"
              >Self-hosted offline transcription and diarization service with
              LLM summary</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 17:30:50</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40483878"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40483855">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=IXBC85SGC0Q"
              >Kernel dev writes a USB driver from scratch in 3h [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 17:28:12</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40483855"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40483752">
          <h3>
            <a
              class="item"
              href="https://blogs.lse.ac.uk/businessreview/2024/05/24/how-to-enhance-generative-ais-problem-solving-capabilities-and-boost-workplace-productivity/"
              >How to enhance generative AI's problem-solving capabilities,
              boost productivity</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 17:15:07</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40483752"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40483367">
          <h3>
            <a class="item" href="https://github.com/glebbash/LO"
              >LO – simple WASM native language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 16:28:56</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40483367"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40482833">
          <h3>
            <a
              class="item"
              href="https://workspaceupdates.googleblog.com/2024/05/google-meet-adaptive-audio.html"
              >Google Meet rolls out multi-device adaptive audio merging</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 15:22:02</span
              ><span class="points-container"
                >Points: <span class="points">258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40482833"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40482799">
          <h3>
            <a
              class="item"
              href="https://devonperoutky.super.site/blog-posts/mediocre-engineers-guide-to-https"
              >Mediocre Engineer's Guide to HTTPS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 15:17:48</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40482799"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40481887">
          <h3>
            <a class="item" href="https://elements.wlonk.com/"
              >Periodic Table of the Elements, in Pictures and Words</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 13:10:29</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40481887"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40481686">
          <h3>
            <a class="item" href="https://docland.io"
              >Show HN: I generated API documentation for all Java packages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 12:35:51</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40481686"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built Docland because I constantly found it frustrating to
                locate and view API definitions when programming. You'd have to
                Google the function/class name, skip all the SEO articles, find
                the page you want, yet the documentation might be poorly
                formatted or does not support searching.
              </p>
              <p>
                So I thought it would be really cool to create a documentation
                site dedicated for programming languages and libraries, so that
                you can find the docs all in one place with a uniform look.
                Docland currently only supports Java, but more programming
                languages can be supported thanks to its modular architecture.
              </p>
              <p>
                Please try it out and let me know what you think! Also, the
                process of building Docland was extremely fun and challenging.
                I'm happy to share about that too.
              </p>
              <p>Thank you!</p>
              <p>Martin</p>
            </div>
          </section>
        </section>
        <section id="40481578">
          <h3>
            <a class="item" href="https://github.com/DiscoGrad/DiscoGrad"
              >Show HN: Boldly go where Gradient Descent has never gone before
              with DiscoGrad</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 12:14:19</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40481578"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
            <div class="text">
              <p>
                We develped DiscoGrad, a tool for automatic differentiation
                through C++ programs involving input-dependent control flow
                (e.g., "if (f(x) &lt; c) { ... }", differentiating wrt. x) and
                randomness. Our initial motivation was to enable the use of
                gradient descent with simulations, which often rely heavily on
                such discrete branching. The latter makes plain autodiff mostly
                useless, since it can only account for the single path taken
                through the program. Our tool offers several backends that
                handle this situation, giving useful descent directions for
                optimization by accounting for alternative branches. Besides
                simulations, this problem arises in many other places, for
                example in deep learning when trying to combine imperative
                programs with neural networks.
              </p>
              <p>
                In a nutshell, DiscoGrad applies an (LLVM-based)
                source-to-source transformation to your C++ program, adding some
                calls to our header library, which then handles the gradient
                computation. What sets it apart from similar tools/estimators is
                that it's fully automatic (no need to come up with a
                differentiable problem formulation/reparametrization) and that
                the branching condition can be any function of the program
                inputs (no need to know upfront what distribution the condition
                follows).
              </p>
              <p>
                We're currently a team of two working on DiscoGrad as part of a
                research project, so don't expect to see production-grade code
                quality, but we do intend for it to be more than a throwaway
                research prototype. Use cases we've successfully tested include
                calibrating simulation models of epidemics or evacuation
                scenarios via gradient descent, and combining simulations with
                neural networks in an end-to-end trainable fashion.
              </p>
              <p>
                We hope you find this interesting and useful, and we're happy to
                answer questions!
              </p>
            </div>
          </section>
        </section>
        <section id="40481509">
          <h3>
            <a class="item" href="https://up.codes/careers?utm_source=HN"
              >UpCodes (YC S17) is hiring remote SWEs, PMs to automate
              construction compliance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 12:02:28</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480913">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2020/brain-reading-computer-code-1215"
              >To the brain, reading computer code is not the same as reading
              language (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 09:54:58</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480913"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480056">
          <h3>
            <a class="item" href="https://hurl.wtf/"
              >Hurl, the Exceptional Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 05:57:52</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480056"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480016">
          <h3>
            <a class="item" href="https://braid.org/"
              >Braid: Synchronization for HTTP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 05:44:47</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480016"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40478470">
          <h3>
            <a class="item" href="https://sre.google/sre-book/simplicity/"
              >Simplicity – Google SRE Handbook (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 23:01:29</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40478470"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40471419">
          <h3>
            <a class="item" href="https://andrewkchan.dev/posts/diffusion.html"
              >Diffusion Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-24 @ 23:35:26</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40471419"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40466814">
          <h3>
            <a
              class="item"
              href="http://scentofdawn.blogspot.com/2011/07/before-soul-dawn-helen-keller-on-her.html"
              >Helen Keller on her life before self-consciousness (1908)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-24 @ 14:48:45</span
              ><span class="points-container"
                >Points: <span class="points">584</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40466814"
                  >Comments</a
                ><span class="descendants">: 254</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40462780">
          <h3>
            <a
              class="item"
              href="https://placesjournal.org/article/social-history-of-the-cardboard-box/"
              >World in a Box</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-24 @ 04:22:43</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40462780"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40458142">
          <h3>
            <a class="item" href="http://cuda.dcc.ufmg.br/psyche-c/"
              >Psyche-C: automatic compilation of partially-available C
              programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 18:30:43</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40458142"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
