<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36131942">
          <h3>
            <a
              class="item"
              href="https://www.txnd.uscourts.gov/judge/judge-brantley-starr"
              >Federal Judge Requires "Mandatory Certification Regarding
              Generative AI"</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 22:31:45</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36131942"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36131549">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.16264"
              >Scaling Data-Constrained Language Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 22:01:02</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36131549"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36131450">
          <h3>
            <a
              class="item"
              href="https://github.com/FranxYao/chain-of-thought-hub"
              >Chain-of-Thought Hub: Measuring LLMs' Reasoning Performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 21:52:56</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36131450"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36131215">
          <h3>
            <a
              class="item"
              href="https://github.com/apitrakr/apitrakr/tree/main/packages/cli"
              >Show HN: I open sourced the CLI of my API Testing Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 21:35:57</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36131215"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36131200">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36131200"
              >Tell HN: Makers beware, Etsy will ruin your small business</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 21:34:55</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36131200"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <p>
                A friend of mine asked me to create a rather niche 3D printed
                part for him. That worked very well for him, so I thought about
                providing this part to others, too.
              </p>
              <p>
                As I'm good with technical things, but not so good with
                marketing, I turned to Etsy to sell these parts. They handle
                SEO, payments etc. pp. for you, so you can focus on creating.
              </p>
              <p>
                Now, for everyone who doesn't know it, Etsy is also FULL of
                people who just print articulated dragons and other
                "entertainment stuff", where copyright/proper CC-licensing is, I
                would say, seems to be handled rather lax.
              </p>
              <p>
                Anyway, I created all my models myself, so I'm safe on that.
              </p>
              <p>
                I set my store up, put up my parts and waited. Etsys SEO magic
                (and paid advertisements) did its work and after about two
                weeks, orders started coming in.
              </p>
              <p>
                And it was just not a single order, but one every two days or
                so, with a basket value of about 25 Euro (after Etsy
                commissions). Of course, that's not "big money", but it's nice
                money nevertheless for something that runs basically overnight.
              </p>
              <p>
                I also did everything "very nice" to try to be a good seller.
                Took care of proper packaging, clean labels, got some white
                shipment packages from Amazon to leave an overall good and
                professional impression.
              </p>
              <p>
                After the first six or seven orders, bank confirmation was still
                standing out on Etsys side, they just froze my account and all
                the funds within.
              </p>
              <p>No warning, nothing at all. No reason given, too.</p>
              <p>
                Just an ominous mail that I would have broken the TOS or rules
                of the house or whatnot. As with any service, these rules are so
                broad that they cover anything from praising satan to selling
                body parts.
              </p>
              <p>
                As I did nothing like that, I filed an appeal to this decision
                through their Zendesk.
              </p>
              <p>
                After _exactly_ 10 minutes I received an automated mail that my
                case was dismissed but I could reply to have it reviewed again.
              </p>
              <p>
                I obviously did that and I also added that I did the bank
                authorization, because I thought that would most likely be the
                reason for the account lock.
              </p>
              <p>
                Two weeks have passed now, no reply from Etsy at all but the
                ticket was closed yesterday, probably by another automated
                process.
              </p>
              <p>
                My 150 Euro revenue, which has some real value in printed parts
                and shipping costs etc. against it, has of course not been paid
                to me.
              </p>
              <p>
                Etsy has probably also not refunded the buyers, so they have
                kept the money of both parties, which looks like a good deal to
                me, at least from their perspective.
              </p>
              <p>
                Anybody out here with some connections who can help? Anybody out
                here who has made the same experiences and can advise on what to
                do next?
              </p>
              <p>Thanks!</p>
              <p>
                edit: What I wanted to say when making that comment about the
                dragons: I'm baffled that downloading a file from Thingiverse
                and printing and selling that hundred times is no problem at
                all, but creative and new designs get the ban hammer. If you
                want to sell articulated dragons, you're probably fine, but
                beware of anything else.
              </p>
              <p>
                edit2: The part in question is a little addition to the normal
                window locks. You can slide the part over the window lock handle
                and it will anchor itself between handle and window frame due to
                its geometry. My friend asked for this, so his children would
                not be able to open the windows and fall out.
              </p>
            </div>
          </section>
        </section>
        <section id="36130354">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2023/05/lawyer-cited-6-fake-cases-made-up-by-chatgpt-judge-calls-it-unprecedented/"
              >Lawyer cited 6 fake cases made up by ChatGPT; judge calls it
              “unprecedented”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 20:33:23</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36130354"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36130166">
          <h3>
            <a
              class="item"
              href="https://www.eff.org/deeplinks/2023/05/federal-judge-makes-history-holding-border-searches-cell-phones-require-warrant"
              >Federal Judge Makes History: Border Searches of Cell Phones
              Require Warrants</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 20:20:21</span
              ><span class="points-container"
                >Points: <span class="points">432</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36130166"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36129757">
          <h3>
            <a
              class="item"
              href="https://caymannewsservice.com/2023/05/new-horror-revealed-in-sargassum-blob/"
              >New horror revealed in sargassum blob</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 19:53:33</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36129757"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36129622">
          <h3>
            <a class="item" href="https://usehooks.com/"
              >UseHooks – A Collection of Server Component Safe React Hooks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 19:44:07</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36129622"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36129594">
          <h3>
            <a class="item" href="https://github.com/makeplane/plane"
              >Plane: Open-Source Alternative to Atlassian's Jira</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 19:42:22</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36129594"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36129373">
          <h3>
            <a
              class="item"
              href="https://www.france24.com/en/environment/20230530-tackling-plastic-pollution-we-can-t-recycle-our-way-out-of-this"
              >Tackling plastic pollution: ‘We can't recycle our way out of
              this’</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 19:26:39</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36129373"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36129227">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2304.09140"
              >A Sun-like star orbiting a boson star</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 19:15:49</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36129227"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36129199">
          <h3>
            <a
              class="item"
              href="https://fab.cba.mit.edu/classes/862.22/index.html"
              >MAS.862: The Physics of Information Technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 19:13:11</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36129199"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36128811">
          <h3>
            <a
              class="item"
              href="https://temporal.io/blog/saga-pattern-made-easy"
              >Saga Pattern Made Easy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 18:43:40</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36128811"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36128648">
          <h3>
            <a
              class="item"
              href="https://eclecticlight.co/2023/05/30/apples-big-test-of-data-integrity/"
              >Apple’s big test of data integrity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 18:33:17</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36128648"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36128618">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36128618"
              >Ask HN: Where have you found community outside of work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 18:30:35</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36128618"
                  >Comments</a
                ><span class="descendants">: 292</span></span
              >
            </h4>
            <div class="text">
              Asking for myself and those who are looking for what good
              communities often provide: feeling of connection, purpose, a place
              to go, etc.
            </div>
          </section>
        </section>
        <section id="36128617">
          <h3>
            <a class="item" href="https://kuenzi.dev/toothbrush/"
              >Hacking a Philips Sonicare Toothbrush</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 18:30:31</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36128617"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36128235">
          <h3>
            <a class="item" href="https://plato.stanford.edu/entries/camus/"
              >Albert Camus</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 18:03:30</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36128235"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36128082">
          <h3>
            <a class="item" href="https://github.com/kochrt/qr-designer"
              >Show HN: I open sourced the QR designer from my failed startup</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 17:53:00</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36128082"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              My designer is somewhat special, if I do say so myself, as it
              allows you to put arbitrary designs in the middle area of the QR
              while still being totally scannable.
            </div>
          </section>
        </section>
        <section id="36128067">
          <h3>
            <a
              class="item"
              href="https://www.bsdcan.org/events/bsdcan_2023/sessions/session/142/slides/58/20230520-memory-safe-desktop-compressed.pdf"
              >Creating a Memory-Safe Workstation with CheriBSD [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 17:52:18</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36128067"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36127703">
          <h3>
            <a class="item" href="https://jmap.io/"
              >JMAP – a modern email open standard</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 17:26:46</span
              ><span class="points-container"
                >Points: <span class="points">541</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36127703"
                  >Comments</a
                ><span class="descendants">: 188</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36127543">
          <h3>
            <a class="item" href="https://www.devever.net/~hl/backstage-cast"
              >Modern CPUs have a backstage cast</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 17:16:16</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36127543"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36127230">
          <h3>
            <a
              class="item"
              href="https://www.databricks.com/blog/welcoming-bit-io-databricks-investing-developer-experience"
              >Databricks acquires serverless Postgres vendor bit.io</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 16:53:58</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36127230"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36127058">
          <h3>
            <a
              class="item"
              href="https://www.lyft.com/rev/posts/lyfts-secret-plan-to-take-control-of-its-maps-and-its-future"
              >Lyft’s plan to take control of its maps and its future</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 16:42:24</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36127058"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36126097">
          <h3>
            <a
              class="item"
              href="https://twitter.com/dan_abramov/status/1663263814333153286"
              >React is 10 years old</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 15:36:32</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36126097"
                  >Comments</a
                ><span class="descendants">: 178</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36123766">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/mindsdb/accfd609-8453-42a5-a4c8-1386d954bc85"
              >MindsDB (YC W20) Is Hiring a Product Designer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 12:00:07</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36123651">
          <h3>
            <a
              class="item"
              href="https://www.cs.cmu.edu/~rwh/students/okasaki.pdf"
              >Purely Functional Data Structures (1996) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 11:43:46</span
              ><span class="points-container"
                >Points: <span class="points">301</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36123651"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36123082">
          <h3>
            <a class="item" href="https://www.safe.ai/statement-on-ai-risk"
              >Statement on AI Risk</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 10:08:15</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36123082"
                  >Comments</a
                ><span class="descendants">: 742</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36102419">
          <h3>
            <a class="item" href="https://github.com/lukneu/doom-teletext"
              >Play DOOM in Teletext</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 09:15:48</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36102419"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36101962">
          <h3>
            <a class="item" href="https://peteroupc.github.io/random.html"
              >Random Number Generator Recommendations for Applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 07:37:03</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36101962"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
