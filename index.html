<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44483081">
          <h3>
            <a
              class="item"
              href="https://mossandfog.com/luigi-lineri-the-man-who-collects-and-categorizes-stones/"
              >Luigi Lineri, the Man Who Collects and Categorizes Stones
              (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 18:53:09</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44483081"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44483077">
          <h3>
            <a class="item" href="https://t3x.org/mcl/index.html"
              >Micro Common Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 18:52:22</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44483077"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44482965">
          <h3>
            <a class="item" href="https://alpha.lisagui.com/"
              >Show HN: I wrote a "web OS" based on the Apple Lisa's UI, with
              1-bit graphics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 18:32:55</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44482965"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <a href="https://lisagui.com/info.html"
                >https://lisagui.com/info.html</a
              >
              <p>
                This is a web OS I wrote in vanilla JS that looks like the Apple
                Lisa Office System (1983-85), with other contemporaneous
                influences and additional improvements and features. It's
                currently in alpha and isn't remotely bug free. I had been
                holding off on posting this here until it was somewhat
                presentable and useful. Please note; the Lisa conforms more
                literally to the desktop metaphor than most modern GUIs - some
                of the important differences are mentioned in the readme.
              </p>
              <p>
                This is a complete recreation of the UI in JS; it all renders to
                a single canvas element. It's not a CSS theme, and not an
                emulator ported to JS. None of the code is written by Apple.
                I'll be happy to elaborate more in the comments, but the short
                version is the entire UI is defined outside the DOM using JS
                objects. Thus, every interface element - menus, windows,
                controls, and even typefaces - was recreated from scratch. There
                are no font files - I wrote my own typesetting system, which
                supports combining multiple text styles and generates new glyph
                variants on the fly.
              </p>
              <p>
                Many of the technical decisions I made were motivated by a
                desire to have this look the same in every browser. That's
                harder to do with the DOM and CSS, and why I moved as much logic
                as I could to JS. Also, the only part of the project outside of
                vanilla JS and standard web APIs is the Gulp toolkit, which I'm
                using as a minification/build tool. No vibe coding was used to
                make this!
              </p>
              <p>
                This is based on a UI from the 80s, and won't work well on your
                phone. If you insist on running it that way, turn on trackpad
                mode in the touchscreen settings panel of the preferences app.
                For best results, install it as a PWA (add it to your home
                screen). Also there are some odd Android bugs; the native
                touchscreen keyboard is currently broken, and there's an issue
                with the cursor when dragging windows.
              </p>
              <p>
                I realize there's not a whole lot to do within LisaGUI right
                now; I've got a big list of additional features and apps I'll be
                adding in the future. I've been working on this project for a
                while, and I'm eager to hear people's feedback and answer
                questions about it.
              </p>
            </div>
          </section>
        </section>
        <section id="44482709">
          <h3>
            <a class="item" href="https://indarktrees.com/misc/tal/"
              >Lessons from 863 episodes of This American Life</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 17:54:27</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44482709"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44482611">
          <h3>
            <a
              class="item"
              href="https://www.apa.org/pubs/journals/releases/xge-xge0001799.pdf"
              >Cool People [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 17:40:16</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44482611"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44482522">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/shit-in-shit-out-ai-is-coming-for-agriculture-but-farmers-arent-convinced-259997"
              >'Shit in, shit out', AI is coming for agriculture, but farmers
              aren’t convinced</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 17:29:36</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44482522"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44482504">
          <h3>
            <a class="item" href="https://github.com/sst/opencode"
              >opencode: AI coding agent, built for the terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 17:26:47</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44482504"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44482405">
          <h3>
            <a
              class="item"
              href="https://gbragafibra.github.io/2025/07/06/collatz_ant5.html"
              >Collatz's Ant and Σ(n)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 17:12:45</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44482405"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44482301">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/metriport/jobs/Rn2Je8M-software-engineer"
              >Metriport (YC S22) is hiring engineers to improve healthcare data
              exchange</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 17:00:02</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44481464">
          <h3>
            <a class="item" href="https://thenumb.at/Functions-are-Vectors/"
              >Functions Are Vectors (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 15:18:35</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44481464"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44481441">
          <h3>
            <a
              class="item"
              href="https://english.elpais.com/science-tech/2025-07-01/a-17-year-old-teen-refutes-a-mathematical-conjecture-proposed-40-years-ago.html"
              >Hannah Cairo has solved the Mizohata-Takeuchi conjecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 15:15:51</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44481441"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44481244">
          <h3>
            <a class="item" href="https://github.com/Yutarop/ga-pixel-art"
              >Show HN: Pixel Art Generator Using Genetic Algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 14:49:22</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44481244"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              This project is a simple but fun demonstration of a genetic
              algorithm applied to image generation. It starts with a population
              of random images and evolves them over generations to resemble a
              target image. The output is an animated GIF that shows the entire
              evolution process.
            </div>
          </section>
        </section>
        <section id="44481235">
          <h3>
            <a class="item" href="https://github.com/terryso/claude-auto-resume"
              >Claude Code Pro Limit? Hack It While You Sleep</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 14:48:37</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44481235"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44481135">
          <h3>
            <a class="item" href="https://nothing.pcarrier.com/posts/lag/"
              >Toys/Lag: Jerk Monitor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 14:33:34</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44481135"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44481066">
          <h3>
            <a class="item" href="https://github.com/ash80/RLHF_in_notebooks"
              >Reinforcement Learning from Human Feedback (RLHF) in Notebooks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 14:23:12</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44481066"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44480400">
          <h3>
            <a
              class="item"
              href="https://royeisen.github.io/OverclockingLLMReasoning-paper/"
              >Overclocking LLM Reasoning: Monitoring and Controlling LLM
              Thinking Path Lengths</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 12:53:13</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44480400"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44480223">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2025/07/get-the-location-of-the-iss-using-dns/"
              >Get the location of the ISS using DNS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 12:32:46</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44480223"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44478861">
          <h3>
            <a class="item" href="https://scottsexton.co/post/overthinking_gis/"
              >Overthinking GIS (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 08:26:10</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44478861"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44477768">
          <h3>
            <a
              class="item"
              href="https://multiverseemployeehandbook.com/blog/when-newton-explained-why-you-dont-float-away/"
              >July 5, 1687: When Newton explained why you don't float away</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 04:11:53</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44477768"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44476716">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2025/Jul/5/cgi-bin-performance/"
              >Serving 200M requests per day with a CGI-bin</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 00:32:18</span
              ><span class="points-container"
                >Points: <span class="points">266</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44476716"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44476297">
          <h3>
            <a
              class="item"
              href="https://interactions.acm.org/archive/view/july-august-2025/stop-hiding-my-controls-hidden-interface-controls-are-affecting-usability"
              >Hidden interface controls that affect usability</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-05 @ 23:10:03</span
              ><span class="points-container"
                >Points: <span class="points">527</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44476297"
                  >Comments</a
                ><span class="descendants">: 372</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44476115">
          <h3>
            <a class="item" href="https://mynoise.net/blog.php"
              >What a Hacker Stole from Me</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-05 @ 22:32:28</span
              ><span class="points-container"
                >Points: <span class="points">320</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44476115"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44475537">
          <h3>
            <a
              class="item"
              href="https://aginfer.bearblog.dev/how-to-network-as-an-introvert/"
              >How to Network as an Introvert</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-05 @ 21:06:41</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44475537"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44474759">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/these-cod-have-been-shrinking-dramatically-for-decades-now-scientists-say-theyve-solved-the-mystery-180986920/"
              >Eastern Baltic cod grow much smaller than they did due to
              overfishing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-05 @ 19:00:34</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44474759"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44472057">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/dumont-duoscopic-tv-set"
              >1945 TV Console Showed Two Programs at Once</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-05 @ 11:43:53</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44472057"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44467383">
          <h3>
            <a
              class="item"
              href="https://www.deadlanguagesociety.com/p/old-english-poetry"
              >How to get started with Old English poetry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 19:56:15</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44467383"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44463249">
          <h3>
            <a class="item" href="https://ryanfarley.co/ai-show-hn-data/"
              >More than 1 in 5 Show HN posts are now AI-related, get &amp;gt;
              half the votes/comments</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 10:35:04</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44463249"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44458532">
          <h3>
            <a class="item" href="https://nanochess.org/transputer_board.html"
              >Development of a transputer ISA board</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-03 @ 19:43:59</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44458532"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44453038">
          <h3>
            <a
              class="item"
              href="http://yummymelon.com/devnull/take-two-eshell.html"
              >Take Two: Eshell</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-03 @ 08:58:09</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44453038"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44447742">
          <h3>
            <a class="item" href="https://microship.com/meet-bionode/"
              >Meet Bionode</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-02 @ 19:18:50</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44447742"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
