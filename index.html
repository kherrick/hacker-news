<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43685714">
          <h3>
            <a
              class="item"
              href="https://machinelearning.apple.com/research/differential-privacy-aggregate-trends"
              >Understanding Aggregate Trends for Apple Intelligence Using
              Differential Privacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 20:04:58</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43685714"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43685304">
          <h3>
            <a
              class="item"
              href="https://github.com/Diffusion-Dynamics/watermark-segmentation"
              >Watermark segmentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 19:35:04</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43685304"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43685018">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/how-vietnam-earned-its-world-renowned-anticolonial-standing"
              >Shame and Revolution: Vietnamâ€™s potent and storied
              anticolonialism</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 19:14:17</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43685018"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43684560">
          <h3>
            <a class="item" href="https://jasonfantl.com/posts/What-is-Entropy/"
              >What Is Entropy?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 18:32:08</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43684560"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43684536">
          <h3>
            <a
              class="item"
              href="https://www.harvard.edu/president/news/2025/the-promise-of-american-higher-education/"
              >Harvard's response to federal government letter demanding
              changes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 18:28:50</span
              ><span class="points-container"
                >Points: <span class="points">713</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43684536"
                  >Comments</a
                ><span class="descendants">: 575</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43684492">
          <h3>
            <a class="item" href="https://upb-syssec.github.io/blog/2024/http2/"
              >Censors Ignore Unencrypted HTTP/2 Traffic (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 18:23:30</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43684492"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43684225">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/kaipod-learning/jobs/TgR2OZg-senior-product-manager"
              >KaiPod Learning (YC S21) Is Hiring a PM</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 17:59:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43684009">
          <h3>
            <a class="item" href="https://simplewebserver.org/"
              >Simple Web Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 17:43:32</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43684009"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43683907">
          <h3>
            <a class="item" href="https://zeyuet.github.io/AudioX/"
              >AudioX: Diffusion Transformer for Anything-to-Audio Generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 17:35:11</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43683907"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43683641">
          <h3>
            <a class="item" href="https://podman-desktop.io/blog/podman-quadlet"
              >Podman Quadlets with Podman Desktop</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 17:16:51</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43683641"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43683497">
          <h3>
            <a
              class="item"
              href="https://subalpinecircuits.com/ssd1306-and-font-rendering/"
              >SSD1306 display drivers and font rendering</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 17:08:24</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43683497"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43683410">
          <h3>
            <a class="item" href="https://openai.com/index/gpt-4-1/"
              >GPT-4.1 in the API</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 17:01:45</span
              ><span class="points-container"
                >Points: <span class="points">375</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43683410"
                  >Comments</a
                ><span class="descendants">: 321</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682686">
          <h3>
            <a
              class="item"
              href="https://medicalxpress.com/news/2025-04-scientists-protein-il-infection-brain.html"
              >Scientists: Protein IL-17 fights infection, acts on the brain,
              inducing anxiety</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:54:10</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682686"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682547">
          <h3>
            <a
              class="item"
              href="https://github.com/nathanhleung/protobuf-ts-types"
              >Show HN: Zero-codegen, no-compile TypeScript type inference from
              Protobufs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:41:03</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682547"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682088">
          <h3>
            <a
              class="item"
              href="https://github.com/deepseek-ai/open-infra-index/tree/main/OpenSourcing_DeepSeek_Inference_Engine"
              >The path to open-sourcing the DeepSeek inference engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:03:10</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682088"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682006">
          <h3>
            <a class="item" href="https://sqlite-internal.pages.dev"
              >SQLite File Format Viewer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 14:55:57</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682006"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43681990">
          <h3>
            <a class="item" href="https://thenumb.at/Sampling/"
              >Monte Carlo Crash Course: Sampling</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 14:54:51</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43681990"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43681287">
          <h3>
            <a
              class="item"
              href="https://www.geoffreylitt.com/2025/04/12/how-i-made-a-useful-ai-assistant-with-one-sqlite-table-and-a-handful-of-cron-jobs"
              >A hackable AI assistant using a single SQLite table and a handful
              of cron jobs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 13:52:58</span
              ><span class="points-container"
                >Points: <span class="points">411</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43681287"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43680957">
          <h3>
            <a
              class="item"
              href="https://www.axios.com/pro/tech-policy/2025/04/14/ftc-meta-antitrust-trial-kicks-off-in-federal-court"
              >Meta antitrust trial kicks off in federal court</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 13:18:19</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43680957"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43680899">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/ai/dolphingemma/"
              >DolphinGemma: How Google AI is helping decode dolphin
              communication</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 13:12:00</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43680899"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43680699">
          <h3>
            <a class="item" href="https://github.com/meilisearch/meilisearch"
              >Meilisearch â€“ search engine API bringing AI-powered hybrid
              search</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 12:46:45</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43680699"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43680477">
          <h3>
            <a
              class="item"
              href="https://github.com/DmitriBogdanov/UTL/blob/master/docs/module_profiler.md"
              >Show HN: Single-Header Profiler for C++17</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 12:16:03</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43680477"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                I often found myself wondering "how much does this code segment
                take in terms of total runtime" and it's often quite annoying to
                figure out with optimizations enabled, especially when working
                on something new or testing someone else's implementation
                without the proper tooling set up. Wanted to have a single
                include lib that would allow us to write something like:
              </p>
              <p>``` PROFILE("Loop 1") for (...) // some work ```</p>
              <p>
                and have the next expression automatically record time &amp;
                dump results to a table. Wrote a few macros to do exactly that a
                few months back, but they were primitive and basically unusable
                for recursive code.
              </p>
              <p>
                Tried to come up with a more generic solution that would build a
                call graph for nested profiler-macros, handle threads and etc.
                but doing so in a naive way would be super slow since we'd need
                some kind of a recursive map of nodes with callsites as a keys.
              </p>
              <p>
                Recently had a revelation that it is possible to use
                macro-generated thread_local's to associate callsites with
                integer IDs on the fly and with some effort call graph can be
                neatly encoded in a few contiguous arrays with all graph
                building &amp; traversal logic reduced to simple checks and
                array lookups. Realized threading can be quite easily supported
                too in an almost lock-free fashion.
              </p>
              <p>
                After a few days of effort ended up building what I believe is a
                very much usable single-header profiling lib. Couldn't find
                anything quite like it, so I'd like to present it here and hear
                some opinions on the product:
              </p>
              <p>
                <a
                  href="https://github.com/DmitriBogdanov/UTL/blob/master/docs/module_profiler.md"
                  >https://github.com/DmitriBogdanov/UTL/blob/master/docs/modul...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43679004">
          <h3>
            <a
              class="item"
              href="https://www.bigsandwoodworking.com/kezurou-kai-39/"
              >Kezurou-Kai #39</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 07:47:18</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43679004"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43678988">
          <h3>
            <a class="item" href="https://fi-le.net/stonks/"
              >The Whimsical Investor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 07:43:12</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43678988"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43662263">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/czd3ygd7mrno"
              >AI used for skin cancer checks at London hospital</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-12 @ 07:43:47</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43662263"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43660478">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/collection/katzensymphonie/"
              >Sheet Mewsic: Moritz von Schwind's Katzensymphonie (1868)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-12 @ 01:25:13</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43660478"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43658417">
          <h3>
            <a
              class="item"
              href="https://www.mikekohn.net/micro/w65c832_fpga.php"
              >W65C832 in an FPGA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-11 @ 20:52:32</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43658417"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43656267">
          <h3>
            <a
              class="item"
              href="https://www.wpr.org/news/wisconsin-cartographer-karen-wynn-fonstad-mapped-tolkien-fantasy-world-oshkosh"
              >The Wisconsin cartographer who mapped Tolkien's fantasy world</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-11 @ 17:26:49</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43656267"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43649781">
          <h3>
            <a
              class="item"
              href="https://bakpakin.com/writing/how-janets-peg-works.html"
              >How Janet's PEG module works</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-11 @ 02:04:52</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43649781"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646227">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/04/09/google-says-itll-embrace-anthropics-standard-for-connecting-ai-models-to-data/"
              >Hassabis Says Google DeepMind to Support Anthropic's MCP for
              Gemini and SDK</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 17:34:40</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646227"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
