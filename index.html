<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39977039">
          <h3>
            <a
              class="item"
              href="https://nypost.com/2024/04/08/business/teslas-cybertrucks-were-rushed-out-are-malfunctioning-at-astounding-rate/"
              >Tesla's Cybertrucks were 'rushed out,' are malfunctioning at
              astounding rate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 07:44:33</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39977039"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39977002">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/yanis-varoufakis-technofeudalism-interview/"
              >Welcome to the Age of Technofeudalism</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 07:38:35</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39977002"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39976640">
          <h3>
            <a class="item" href="https://qdiv.dev/posts/eth2/"
              >Show HN: I made a discrete logic network card</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 06:24:15</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39976640"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39976577">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=gipFvhEMB0I"
              >Viewing the 2024 Solar Eclipse with Commodore 64's 1984 Sky
              Travel [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 06:12:08</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39976577"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39976225">
          <h3>
            <a
              class="item"
              href="https://www.hezmatt.org/~mpalmer/blog/2024/04/09/how-i-tripped-over-the-debian-weak-keys-vuln.html"
              >How I Tripped Over the Debian Weak Keys Vulnerability</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 04:36:04</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39976225"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39976064">
          <h3>
            <a
              class="item"
              href="https://videofa.st/en/short-video/automatic-subtitles/"
              >Show HN: I created automatic subtitling app to boost short
              videos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 03:49:43</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39976064"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <a href="https://videofa.st">https://videofa.st</a>
              <p>
                This is a web app to add automatic subtitles/captions into your
                short videos,
              </p>
              <p>
                I created this app because I was wasting so much time to add
                subtitles manually into my own social short videos and the
                quality was poor, but now it's easy and fast!
              </p>
              <p>
                I also needed to pay my bills and so I thought: why not help
                others getting access to this time saver app? That's how I
                decided to make it becomes a Saas and to share it with you
                today!
              </p>
              <p>The link is videofa.st</p>
            </div>
          </section>
        </section>
        <section id="39975887">
          <h3>
            <a class="item" href="https://github.com/rastapasta/mapscii"
              >MapSCII – ASCII world map renderer for your console – enter
              =&amp;gt; telnet mapscii.me</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 02:58:18</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39975887"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39975865">
          <h3>
            <a
              class="item"
              href="https://www.trains.com/trn/news-reviews/news-wire/bart-to-offer-final-rides-on-original-equipment-on-april-20/"
              >BART to offer final rides on original equipment on April 20</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 02:52:33</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39975865"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39975596">
          <h3>
            <a class="item" href="https://kerkour.com/distributed-sqlite"
              >Distributed SQLite: Paradigm shift or hype?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 01:51:27</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39975596"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39975346">
          <h3>
            <a
              class="item"
              href="https://oztypewriter.blogspot.com/2011/08/on-this-day-in-typewriter-history_14.html"
              >Genesis of the “Golfball” Selectric</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 01:04:27</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39975346"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39975331">
          <h3>
            <a class="item" href="https://bellard.org/tsac/"
              >TSAC: Low Bitrate Audio Compression</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 01:00:06</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39975331"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39974646">
          <h3>
            <a
              class="item"
              href="https://images.wur.nl/digital/collection/coll13/search"
              >1.18k drawings of plant root systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 23:11:14</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39974646"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39974374">
          <h3>
            <a
              class="item"
              href="https://blog.allenai.org/hello-olmo-a-truly-open-llm-43f7e7359222?gi=760105621962"
              >Hello OLMo: A truly open LLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 22:26:57</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39974374"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39974340">
          <h3>
            <a class="item" href="https://up.codes/careers?utm_source=HN"
              >UpCodes (YC S17) hiring devs to automate construction
              compliance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 22:20:13</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39973467">
          <h3>
            <a class="item" href="https://github.com/karpathy/llm.c"
              >Llm.c – LLM training in simple, pure C/CUDA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 20:38:49</span
              ><span class="points-container"
                >Points: <span class="points">733</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39973467"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39973296">
          <h3>
            <a class="item" href="https://savannah.gnu.org/bugs/index.php?65569"
              >GNU Stow needs a co-maintainer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 20:20:13</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39973296"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39973150">
          <h3>
            <a class="item" href="https://github.com/shorebirdtech/shorebird"
              >Show HN: Shorebird 1.0, Flutter Code Push</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 20:01:45</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39973150"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
            <div class="text">
              <p>
                I founded Flutter and led the team for almost a decade. One of
                the constant questions we got was would we support code push
                like the web/react native:
                <a href="https://github.com/flutter/flutter/issues/14330"
                  >https://github.com/flutter/flutter/issues/14330</a
                >
                I left Google about a year ago and set out to build a company
                around Flutter and decided to start with code push.
              </p>
              <p>
                It took us a year to build. We had to build a new toolchain for
                Dart and a custom interpreter (for store compliance). But it
                works! Our beta has already been used by thousands of apps. Most
                (eventually all) of the code is open source on GitHub.
              </p>
              <p>
                I’ll be around all day to answer Flutter and Shorebird
                questions. We run our company in the public on Discord and are
                happy to take questions there too. Would love to hear your
                thoughts.
              </p>
            </div>
          </section>
        </section>
        <section id="39972780">
          <h3>
            <a
              class="item"
              href="https://www.hcn.org/issues/56-4/the-untold-history-of-japanese-american-bird-pins/"
              >Japanese American Bird Pins</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 19:14:42</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39972780"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39972603">
          <h3>
            <a class="item" href="https://gitlab.com/Screwtapello/isa65xx"
              >The 6502 instruction set as a database</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 18:49:47</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39972603"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39972152">
          <h3>
            <a class="item" href="https://arxiv.org/abs/1407.4895"
              >Nightfall: Can Kalgash Exist (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 17:56:04</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39972152"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39972036">
          <h3>
            <a
              class="item"
              href="https://colab.research.google.com/drive/1h5WIzhvT-GJCL3LHxMCLnc9qyOIqHubY?usp=sharing"
              >Colab notebook to create Magic cards from image with Claude</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 17:42:54</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39972036"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39971673">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/android/android-find-my-device/"
              >Find My Device on Android</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 17:03:54</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39971673"
                  >Comments</a
                ><span class="descendants">: 251</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39970915">
          <h3>
            <a
              class="item"
              href="https://every.to/the-crazy-ones/the-woman-that-tech-history-forgot"
              >Lore Harp McGovern built a microcomputer empire from her suburban
              home</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 15:48:48</span
              ><span class="points-container"
                >Points: <span class="points">442</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39970915"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39969174">
          <h3>
            <a
              class="item"
              href="https://dn790001.ca.archive.org/0/items/descriptionofdif00daverich/descriptionofdif00daverich.pdf"
              >A Description of the Differential Expansive Pumping Engine
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 12:51:00</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39969174"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39967709">
          <h3>
            <a class="item" href="https://thecoder08.github.io/hello-world.html"
              >Hello World</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 09:07:37</span
              ><span class="points-container"
                >Points: <span class="points">357</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39967709"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39966685">
          <h3>
            <a class="item" href="http://www.quartzpage.de/crs_twins.html"
              >Quartz Crystals – Twinning (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 06:08:03</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39966685"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39965966">
          <h3>
            <a
              class="item"
              href="https://www.nippon.com/en/japan-topics/c11602/"
              >Reviving an 800-Year-Old Japanese Tea Farm</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 03:29:23</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39965966"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39962615">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=UQuIVsNzqDk"
              >Re-creating Disney's sodium vapor process [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 18:20:34</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39962615"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39951459">
          <h3>
            <a
              class="item"
              href="https://codeconfessions.substack.com/p/why-do-python-lists-multiply-oddly"
              >Why Do Python Lists Multiply Oddly? Exploring the CPython Source
              Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-06 @ 10:34:13</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39951459"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39950186">
          <h3>
            <a
              class="item"
              href="https://nautil.us/the-marvelous-seamounts-of-the-southeast-pacific-542868/"
              >The Marvelous Seamounts of the Southeast Pacific</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-06 @ 05:21:24</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39950186"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
