<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46497712">
          <h3>
            <a class="item" href="https://tonsky.me/blog/tahoe-icons/"
              >It's hard to justify Tahoe icons</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 11:51:42</span
              ><span class="points-container"
                >Points: <span class="points">500</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46497712"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46497164">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/annas-archive-loses-org-domain-after-surprise-suspension/"
              >Anna's Archive Loses .Org Domain After Surprise Suspension</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 10:23:32</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46497164"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46496494">
          <h3>
            <a class="item" href="https://www.dlp.rip/decorative-cryptography"
              >Decorative Cryptography</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 08:29:38</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46496494"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46496103">
          <h3>
            <a
              class="item"
              href="https://www.cs.cmu.edu/~pavlo/blog/2026/01/2025-databases-retrospective.html"
              >Databases in 2025: A Year in Review</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 07:14:30</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46496103"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46496054">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/11/08/science/biggest-spiderweb-sulfur-cave.html"
              >A spider web unlike any seen before</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 07:06:22</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46496054"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46495539">
          <h3>
            <a class="item" href="http://mpaxos.com/blog/rusty-cpp.html"
              >Building a Rust-style static analyzer for C++ with AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 05:11:59</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46495539"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46494734">
          <h3>
            <a
              class="item"
              href="https://sparkbox.com/foundry/helene_and_mobile_web_performance"
              >During Helene, I just wanted a plain text website</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 02:36:20</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46494734"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46494061">
          <h3>
            <a class="item" href="https://www.openpa.net/nextstep_pa-risc.html"
              >NeXTSTEP on Pa-RISC</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 00:48:44</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46494061"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46492063">
          <h3>
            <a
              class="item"
              href="https://www.pentestpartners.com/security-blog/eurostar-ai-vulnerability-when-a-chatbot-goes-off-the-rails/"
              >Eurostar AI vulnerability: When a chatbot goes off the rails</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 20:52:52</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46492063"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46491821">
          <h3>
            <a
              class="item"
              href="https://stats.stackexchange.com/questions/674129/why-does-a-linear-least-squares-fit-appear-to-have-a-bias-when-applied-to-simple"
              >Why does a least squares fit appear to have a bias when applied
              to simple data?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 20:25:30</span
              ><span class="points-container"
                >Points: <span class="points">267</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46491821"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46491749">
          <h3>
            <a class="item" href="https://github.com/huseyinbabal/taws"
              >Show HN: Terminal UI for AWS</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 20:17:22</span
              ><span class="points-container"
                >Points: <span class="points">337</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46491749"
                  >Comments</a
                ><span class="descendants">: 174</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46491486">
          <h3>
            <a
              class="item"
              href="https://granda.org/en/2026/01/02/claude-code-on-the-go/"
              >Claude Code On-the-Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 19:48:20</span
              ><span class="points-container"
                >Points: <span class="points">369</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46491486"
                  >Comments</a
                ><span class="descendants">: 227</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46491244">
          <h3>
            <a
              class="item"
              href="https://github.com/nibzard/awesome-agentic-patterns"
              >Agentic Patterns</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 19:24:47</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46491244"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46490323">
          <h3>
            <a class="item" href="https://ripplegame.app/"
              >Ripple, a puzzle game about 2nd and 3rd order effects</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 17:50:04</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46490323"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46488819">
          <h3>
            <a class="item" href="https://addyosmani.com/blog/21-lessons/"
              >Lessons from 14 years at Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 15:23:54</span
              ><span class="points-container"
                >Points: <span class="points">1372</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46488819"
                  >Comments</a
                ><span class="descendants">: 601</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46488654">
          <h3>
            <a class="item" href="https://howbrowserswork.com/"
              >Show HN: An interactive guide to how browsers work</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 15:08:02</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46488654"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46488576">
          <h3>
            <a
              class="item"
              href="https://ma.ttias.be/web-development-is-fun-again/"
              >Web development is fun again</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 15:00:18</span
              ><span class="points-container"
                >Points: <span class="points">430</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46488576"
                  >Comments</a
                ><span class="descendants">: 517</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46488355">
          <h3>
            <a
              class="item"
              href="https://candost.blog/the-unbearable-joy-of-sitting-alone-in-a-cafe/"
              >The unbearable joy of sitting alone in a café</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 14:37:58</span
              ><span class="points-container"
                >Points: <span class="points">687</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46488355"
                  >Comments</a
                ><span class="descendants">: 399</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46488278">
          <h3>
            <a class="item" href="https://fabiensanglard.net/sf2_warrier/"
              >Street Fighter II, the World Warrier (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 14:30:29</span
              ><span class="points-container"
                >Points: <span class="points">402</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46488278"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46472930">
          <h3>
            <a
              class="item"
              href="https://robotsinplainenglish.com/e/2025-12-27-roomba.html"
              >Revisiting the original Roomba and its simple architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-03 @ 04:53:20</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46472930"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46469877">
          <h3>
            <a
              class="item"
              href="https://idiallo.com/blog/18000-dollars-static-web-page"
              >I charged $18k for a Static HTML Page (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-02 @ 21:54:56</span
              ><span class="points-container"
                >Points: <span class="points">359</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46469877"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46465866">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46465866"
              >Ask HN: Help with LLVM</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-02 @ 15:44:24</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46465866"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                I need to know if there's a way to prevent LLVM from linking in
                CRT symbols entirely. The goal is to make a new runtime.
              </p>
              <p>
                I have a stub library written in my language, when I go to
                compile the library in .lib form, I keep running into a wall
                where LLVM forcefully brings in <i>_fltused</i>, causing my
                definition to get flagged with an error saying _fltused already
                exists.
              </p>
              <p>
                There is nothing in the .ll IR file other than the _fltused
                definition, the one that I want to have end up in the final
                .lib.
              </p>
              <p>
                I have Googled and asked AI for days now what compiler/linker
                flags I can use to get LLVM to bypass the CRT entirely so I can
                develop my own runtime, and Clang, MinGW, and LLVM are all
                aggressively linking in the CRT no matter what flags I add.
              </p>
              <p>
                I'm pulling my hair out over here. I can't convert my .ll file
                directly to .as because the LLVM compiler is getting in the way,
                otherwise I'd have my library by now.
              </p>
            </div>
          </section>
        </section>
        <section id="46457488">
          <h3>
            <a
              class="item"
              href="https://mehmetince.net/the-story-of-a-perfect-exploit-chain-six-bugs-that-looked-harmless-until-they-became-pre-auth-rce-in-a-security-appliance/"
              >Six Harmless Bugs Lead to Remote Code Execution</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 20:02:09</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46457488"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46456787">
          <h3>
            <a
              class="item"
              href="https://alexyorke.github.io/2025/09/13/monads-in-c-sharp-part-2-result/"
              >Monads in C# (Part 2): Result</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 18:45:02</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46456787"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454085">
          <h3>
            <a class="item" href="https://logicaffeine.com/guide"
              >Logos Language Guide: Compile English to Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 13:48:27</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454085"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46452696">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/scientists-uncover-the-universal-geometry-of-geology-20201119/"
              >Scientists Uncover the Universal Geometry of Geology (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 09:42:02</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46452696"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46448356">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/travel/article/20250417-the-baffling-purple-honey-found-only-in-north-carolina"
              >Baffling purple honey found only in North Carolina</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 21:06:16</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46448356"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46445412">
          <h3>
            <a
              class="item"
              href="https://github.com/lets-all-be-stupid-forever/circuit-artist"
              >Show HN: Circuit Artist – Circuit simulator with propagation
              animation, rewind</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 16:12:20</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46445412"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                Circuit Artist is a game about drawing digital circuits as pixel
                art — like MS Paint, but pixels are wires and little triangles
                are NANDs. Hit play and the simulation runs in real time. It's
                fully white-box: every wire's state is visible.
              </p>
              <p>
                I launched it last year with a unit-delay simulation that ran
                until convergence on each update. It worked, but I realized it
                had some fundamental problems:
              </p>
              <p>
                (i) It hid what was actually happening. Players couldn't tell
                the difference between a ripple carry adder and a look-ahead
                adder — everything just resolved instantly.
              </p>
              <p>
                (ii) Design bugs became "game bugs." When players had
                non-converging wires (like A = not(A)), the game couldn't
                explain why or where the error was.
              </p>
              <p>
                (iii) Layout didn't matter. A NAND on one side of the map would
                instantly propagate to the opposite side, making spatial
                decisions meaningless. Unit delay probably works better for
                schematic-based simulators like Logisim, not a layout-focused
                game like this.
              </p>
              <p>
                (iv) Propagation visualization couldn't be added on top of the
                unit-delay engine — there was no notion of direction or
                distance.
              </p>
              <p>
                So I rebuilt the engine with variable-delay event-based
                simulation using an adaptation of Elmore delay. The delay for
                each wire depends on distance and fanout — longer wires are
                slower, higher fanout adds delay, branching wires are faster.
              </p>
              <p>
                For the implementation: I compute Elmore delay over wire trees.
                Each pixel has resistance and capacitance, with NAND inputs as
                nodes to account for fanout. For non-tree wire graphs, I build a
                Dijkstra-based spanning tree (driver as root) and interpolate
                for edges outside the tree. I calculate the delay for each node
                and project it back to the image so every pixel has a distance.
              </p>
              <p>
                This lets me animate propagation with a glow effect during
                simulation. The shader knows when each wire was triggered, the
                current time, and the Elmore distance of each pixel, so it
                resolves state per-pixel in real time.
              </p>
              <p>On top of that:</p>
              <p>
                - Time rewind: the simulation is now delta-based, so players can
                freeze and scrub backwards to debug. Super useful for cyclic
                circuits.
              </p>
              <p>
                - Layers: since timing matters now, I added up to 3 layers.
                NANDs only go on the bottom layer, upper layers propagate faster
                (lower capacitance). Lets you route wires above dense NAND
                areas.
              </p>
              <p>
                The game has a campaign for learning from scratch, though it's
                still incomplete and in progress. I'm working toward Steam
                Workshop support so people can create their own campaigns to
                teach different concepts or cover more advanced topics.
              </p>
              <p>
                GitHub (full source):
                <a
                  href="https://github.com/lets-all-be-stupid-forever/circuit-artist"
                  >https://github.com/lets-all-be-stupid-forever/circuit-artist</a
                >
              </p>
              <p>
                Steam:
                <a
                  href="https://store.steampowered.com/app/3139580/Circuit_Artist/"
                  >https://store.steampowered.com/app/3139580/Circuit_Artist/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46442282">
          <h3>
            <a class="item" href="https://queue.acm.org/detail.cfm?id=3534854"
              >Linear Address Spaces: Unsafe at any speed (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 07:57:53</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46442282"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46440188">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=XDg73E1n5-g"
              >How to translate a ROM: The mysteries of the game cartridge
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 01:10:05</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46440188"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
