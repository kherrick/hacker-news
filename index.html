<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38085417">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/education/interactive/2023/homeschooling-growth-data-by-district/"
              >Home schooling's rise from fringe to fastest-growing form of
              education</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 14:29:51</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38085417"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38085289">
          <h3>
            <a
              class="item"
              href="https://www.nolo.com/legal-encyclopedia/working-from-home-in-california-does-my-employer-have-to-reimburse-me-for-utilities-or-other-expenses.html"
              >CA employers must reimburse remote workers for all necessary
              expenses</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 14:22:22</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38085289"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084737">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=fxMKuv0A6z4"
              >Penn and Teller's Lab Scam [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 13:46:58</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084737"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084572">
          <h3>
            <a class="item" href="https://www.beep.blog/io/"
              >.io considered harmful</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 13:35:04</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084572"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084516">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2023/10/us-harbors-prolific-malicious-link-shortening-service/"
              >.us harbors prolific malicious link shortening service</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 13:29:56</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084516"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084337">
          <h3>
            <a
              class="item"
              href="https://www.itpro.com/security/ransomware/coalition-of-nations-agree-to-end-ransomware-payments-to-hackers"
              >US-led coalition of nations agrees to end ransomware payments to
              hackers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 13:15:16</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084337"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084314">
          <h3>
            <a
              class="item"
              href="https://www.techspot.com/news/100663-windows-11-extends-support-archive-formats-thanks-open.html"
              >Windows 11 adds native support for RAR, 7-Zip, Tar and other
              archive formats</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 13:13:12</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084314"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084244">
          <h3>
            <a
              class="item"
              href="https://josem.co/the-beauty-of-finished-software/"
              >The beauty of finished software</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 13:07:25</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084244"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084098">
          <h3>
            <a
              class="item"
              href="https://github.com/eugene-khyst/postgresql-event-sourcing"
              >Show HN: Light implementation of Event Sourcing using PostgreSQL
              as event store</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 12:56:43</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084098"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                If you have a Java Spring Boot application with a PostgreSQL
                database, you can implement Event Sourcing without introducing
                new specialized databases or frameworks.
              </p>
              <p>
                If you have an application dealing with an entity called Order,
                you should adopt Event Sourcing to keep track of all changes,
                and know how the Order got into the current state.
              </p>
              <p>Event Sourcing gives you:</p>
              <p>1. the true history of the system (audit and traceability),</p>
              <p>
                2. the ability to put the system in any prior state (debugging),
              </p>
              <p>
                3. the ability to create read projections from events as needed
                to respond to new demands.
              </p>
              <p>
                There are several well-known specialized frameworks and
                databases for Event Sourcing: EventStoreDB, Marten, Eventuate,
                to name a few. But adopting a new framework or database you are
                not familiar with may stop you from trying the Event Sourcing
                pattern in your project. But you can actually implement Event
                Sourcing with a few classes and use PostgreSQL as an event
                store.
              </p>
              <p>
                The "postgresql-event-sourcing" project is a reference
                implementation of an event-sourced system that uses PostgreSQL
                as an event store built with Spring Boot. Fork the repository
                and use it as a template for your projects. Or clone the
                repository and run end-to-end tests to see how everything works
                together.
              </p>
              <p>The project describes in detail:</p>
              <p>- database model for storing events,</p>
              <p>- synchronous and asynchronous event handlers,</p>
              <p>- CQRS,</p>
              <p>- Transactional Outbox pattern,</p>
              <p>- Polling Publisher pattern,</p>
              <p>
                - optimized publisher that uses PostgreSQL LISTEN/NOTIFY
                capabilities,
              </p>
              <p>- and more.</p>
              <p>
                This project can be easily extended to comply with your domain
                model.
              </p>
              <p>
                The source code is available on GitHub &lt;<a
                  href="https://github.com/eugene-khyst/postgresql-event-sourcing"
                  >https://github.com/eugene-khyst/postgresql-event-sourcing</a
                >&gt;.
              </p>
            </div>
          </section>
        </section>
        <section id="38084007">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/treble-ai/jobs/tL8GeWc-full-stack-software-engineer"
              >Treble.ai (YC S19) Is Hiring Spainish Speaking Engineers in
              NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 12:49:56</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38083588">
          <h3>
            <a class="item" href="https://fullystacked.net/posts/av1/"
              >AV1 video codec gains broader hardware support</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 12:16:35</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38083588"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38083484">
          <h3>
            <a class="item" href="https://darkhotels.co"
              >I've overlayed stays on a light pollution satellite map</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 12:04:58</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38083484"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38083045">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Bcachefs-Merged-Linux-6.7"
              >Bcachefs Merged into the Linux 6.7 Kernel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 11:19:30</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38083045"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38082980">
          <h3>
            <a
              class="item"
              href="https://www.sciencedaily.com/releases/2023/10/231030110005.htm"
              >The genetic heritage of the Denisovans have left its mark on our
              mental health</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 11:13:05</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38082980"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38082621">
          <h3>
            <a class="item" href="https://github.com/formbricks/formbricks"
              >Show HN: Formbricks – Open-source alternative to Typeform and
              Sprig</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 10:27:09</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38082621"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38082067">
          <h3>
            <a class="item" href="https://filtra.io/rust-ochagavia-oct-23"
              >Contributing to Rust as a Novice</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 09:14:21</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38082067"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38081633">
          <h3>
            <a
              class="item"
              href="https://stackdiary.com/german-court-bans-linkedin-from-ignoring-do-not-track-signals/"
              >German court bans LinkedIn from ignoring "Do Not Track"
              signals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 08:22:42</span
              ><span class="points-container"
                >Points: <span class="points">855</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38081633"
                  >Comments</a
                ><span class="descendants">: 414</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38080367">
          <h3>
            <a
              class="item"
              href="https://flak.tedunangst.com/post/two-hackers-one-keyboard-two-ways"
              >Two hackers one keyboard two ways</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 04:35:14</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38080367"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38080234">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/miscellanies/cleopatras-daughter"
              >Cleopatra's Daughter (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 04:19:08</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38080234"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38079512">
          <h3>
            <a
              class="item"
              href="https://people.ischool.berkeley.edu/~nick/aaronson-oracle/"
              >Can you use your "free will"? Try your hand</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 02:36:23</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38079512"
                  >Comments</a
                ><span class="descendants">: 201</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38079381">
          <h3>
            <a class="item" href="https://ekaitz.elenq.tech/bootstrapGcc8.html"
              >Bootstrapping GCC in RISC-V: Milestone: MesCC builds TinyCC and
              fun C errors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 02:20:36</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38079381"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38078143">
          <h3>
            <a
              class="item"
              href="https://www.nme.com/news/gaming-news/xbox-will-block-third-party-controllers-to-preserve-the-console-experience-3525752"
              >Xbox will block third-party controllers to "preserve the console
              experience"</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 00:35:15</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38078143"
                  >Comments</a
                ><span class="descendants">: 281</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38078063">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/10/apple-unveils-m3-m3-pro-and-m3-max-the-most-advanced-chips-for-a-personal-computer/"
              >Apple unveils M3, M3 Pro, and M3 Max</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 00:30:14</span
              ><span class="points-container"
                >Points: <span class="points">848</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38078063"
                  >Comments</a
                ><span class="descendants">: 894</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38077889">
          <h3>
            <a
              class="item"
              href="https://opensource.googleblog.com/2023/10/android-and-risc-v-what-you-need-to-know.html"
              >Android and RISC-V: What you need to know to be ready</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 00:12:08</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38077889"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38076530">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-10-30/23andme-will-give-gsk-access-to-consumer-dna-data"
              >Drugmakers are set to pay 23andMe to access consumer DNA</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 21:59:45</span
              ><span class="points-container"
                >Points: <span class="points">301</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38076530"
                  >Comments</a
                ><span class="descendants">: 365</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38075973">
          <h3>
            <a
              class="item"
              href="https://rylandscollections.com/2023/06/21/a-new-view-of-the-manchester-computer/"
              >A new view of the Manchester Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 21:15:36</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38075973"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074992">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/gmail/gmail-security-authentication-spam-protection/"
              >Gmail, Yahoo announce new 2024 authentication requirements for
              bulk senders</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 20:07:07</span
              ><span class="points-container"
                >Points: <span class="points">529</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074992"
                  >Comments</a
                ><span class="descendants">: 378</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074701">
          <h3>
            <a class="item" href="https://youglish.com/"
              >Use YouTube to improve your English pronunciation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 19:47:10</span
              ><span class="points-container"
                >Points: <span class="points">491</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074701"
                  >Comments</a
                ><span class="descendants">: 297</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38071920">
          <h3>
            <a
              class="item"
              href="https://www.eetimes.com/nvidia-trains-llm-on-chip-design/"
              >Nvidia Trains LLM on Chip Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 16:43:13</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38071920"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38069623">
          <h3>
            <a
              class="item"
              href="https://www.youtube.com/playlist?list=PLcGZbzUhfcJbEazYYKUgdnEskZa5PX86N"
              >Building and programming a 16-bit Intel x86 breadboard computer
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 14:06:21</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38069623"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
