<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35719937">
          <h3>
            <a
              class="item"
              href="https://github.com/deepdoctection/deepdoctection"
              >DeepDoctection</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 21:00:46</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35719937"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35719928">
          <h3>
            <a class="item" href="https://withcompound.com/company/about"
              >Compound (YC S19) is hiring to build a modern wealth manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 21:00:23</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35719283">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-04-25/boe-economist-says-uk-people-need-to-accept-they-re-worse-off"
              >BOE Chief Economist Says Britons ‘Need to Accept’ They’re Worse
              Off</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 20:08:56</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35719283"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35719100">
          <h3>
            <a
              class="item"
              href="https://bitbanksoftware.blogspot.com/2023/04/building-pocket-co2-project.html"
              >Building the Pocket CO2 Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 19:55:58</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35719100"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35718417">
          <h3>
            <a
              class="item"
              href="https://www.linen.dev/s/linen/t/10511167/linen-dev-the-500kb-slack-alternative"
              >Linen.dev: A 500 kb Slack alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 19:00:51</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35718417"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35717871">
          <h3>
            <a class="item" href="https://github.com/deep-floyd/IF"
              >DeepFloyd IF: open-source text-to-image model</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 18:15:48</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35717871"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35717692">
          <h3>
            <a
              class="item"
              href="https://release.com/blog/training-chatgpt-with-custom-libraries-using-extensions"
              >Creating AI assistant with GPT and Ruby and Redis using
              embeddings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 18:02:27</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35717692"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35717344">
          <h3>
            <a
              class="item"
              href="https://blog.eq8.eu/til/update-millions-of-records-in-rails.html"
              >Update millions of records in Rails</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 17:36:04</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35717344"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35717106">
          <h3>
            <a class="item" href="https://xhuangcv.github.io/hdr-nerf/"
              >HDR-NeRF: High Dynamic Range Neural Radiance Fields</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 17:19:34</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35717106"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35716963">
          <h3>
            <a
              class="item"
              href="https://ottertune.com/blog/the-part-of-postgresql-we-hate-the-most/"
              >The part of Postgres we hate the most: Multi-version concurrency
              control</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 17:10:38</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35716963"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35716872">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/space/spacex-rogers-connect-mobiles-phones-satellites-remote-canadian-areas-2023-04-26/"
              >SpaceX, Rogers to connect mobiles phones to satellites in remote
              Canadian areas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 17:03:38</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35716872"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35716216">
          <h3>
            <a
              class="item"
              href="https://www.moderndescartes.com/essays/why_brain/"
              >Why did Google Brain exist?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 16:22:39</span
              ><span class="points-container"
                >Points: <span class="points">278</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35716216"
                  >Comments</a
                ><span class="descendants">: 172</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35714347">
          <h3>
            <a
              class="item"
              href="https://www.memorysafety.org/blog/sudo-and-su/"
              >Bringing Memory Safety to sudo and su</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 14:39:30</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35714347"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35714294">
          <h3>
            <a
              class="item"
              href="https://www.wivb.com/news/colorado-becomes-1st-to-pass-right-to-repair-for-farmers/"
              >Colorado becomes first to pass ‘right to repair’ for farmers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 14:36:07</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35714294"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35713524">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/long-before-trees-overtook-the-land-earth-was-covered-by-giant-mushrooms-13709647/"
              >Long before trees overtook the land, Earth was covered by
              prototaxites (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 13:42:04</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35713524"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35713518">
          <h3>
            <a
              class="item"
              href="https://www.nango.dev/blog/why-is-oauth-still-hard"
              >Why is OAuth still hard in 2023?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 13:41:47</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35713518"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35712625">
          <h3>
            <a
              class="item"
              href="https://www.lenfestinstitute.org/solution-set/i-canceled-22-digital-newspaper-subscriptions-heres-what-i-learned-about-digital-retention-strategies/"
              >What I learned unsubscribing from 22 newspapers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 12:30:32</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35712625"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35712238">
          <h3>
            <a class="item" href="https://renewables-map.robinhawkes.com"
              >Show HN: An interactive map showing live wind farm generation in
              Great Britain</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 11:53:09</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35712238"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's an interactive map showing live generation for major wind
                farms in Great Britain, showing what each wind farm is
                generating both now and in the past, and where that generation
                is physically located.
              </p>
              <p>
                Animated weather data is from WeatherLayers and shows current
                and historic wind conditions on the map, providing context to
                wind generation around the country.
              </p>
              <p>
                History mode allows you to go back in time and see wind
                generation and weather conditions for a particular date and
                time. It's great for exploring days of record generation, such
                as the 21.6GW record on January 10th, 2023!
              </p>
              <p>
                Prediction mode lets you see what wind farms are estimated to be
                generating using current wind conditions and model based on
                historic generation and wind speeds. Is a wind farm generating
                as you expect, or is there something to look into?
              </p>
              <p>
                An experimental feature allows you to see what future wind farms
                could be generating today (or in the past!) if they were already
                built and operational. If you click the "sparkle" button on the
                map you'll get to see what the upcoming 3.6GW Dogger Bank wind
                farm is estimated to generate if it was operational today.
              </p>
              <p>
                There's an "About" section on the site that goes into detail on
                the various public data sources and how some of the features
                work. I also document a lot of this on my Twitter @robhawkes if
                you're curious.
              </p>
              <p>
                This is just the start and there are many more features to come!
              </p>
              <p>Please let me know your comments and suggestions.</p>
            </div>
          </section>
        </section>
        <section id="35711968">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-04-26/microsoft-s-69-billion-activision-deal-blocked-by-uk-watchdog"
              >UK Blocks Microsoft’s $69B Activision Deal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 11:17:28</span
              ><span class="points-container"
                >Points: <span class="points">541</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35711968"
                  >Comments</a
                ><span class="descendants">: 484</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35710269">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-04-25/netflix-loses-1-million-users-in-spain-over-password-policing"
              >Netflix loses 1M users in Spain over password policing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-26 @ 06:44:29</span
              ><span class="points-container"
                >Points: <span class="points">537</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35710269"
                  >Comments</a
                ><span class="descendants">: 706</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35699017">
          <h3>
            <a class="item" href="https://github.com/bradleyboy/tuql"
              >Tuql: Automatically create a GraphQL server from a SQLite
              database</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-25 @ 11:35:28</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35699017"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35698354">
          <h3>
            <a class="item" href="http://redump.org/"
              >Redump Milestone – 100k Discs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-25 @ 09:47:29</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35698354"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35697627">
          <h3>
            <a class="item" href="https://e2eml.school/transformers.html"
              >Transformers from Scratch (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-25 @ 07:42:34</span
              ><span class="points-container"
                >Points: <span class="points">529</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35697627"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35697349">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/news/amd-ryzen-7000-burning-out-root-cause-identified-expo-and-soc-voltages-to-blame"
              >AMD Ryzen 7000 Burning Out: Impacts all 7000 processors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-25 @ 06:58:58</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35697349"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35697310">
          <h3>
            <a
              class="item"
              href="https://boredzo.org/blog/archives/2023-04-24/moving-away-from-algorithmic-curation"
              >Moving away from algorithmic curation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-25 @ 06:52:19</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35697310"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35696787">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/IPv6OurPassiveExposure"
              >Thinking about our passive exposure to IPv6 issues</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-25 @ 05:21:02</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35696787"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35685685">
          <h3>
            <a
              class="item"
              href="https://admiralcloudberg.medium.com/highway-to-ruin-the-crash-of-southern-airways-flight-242-7eb1433281fe"
              >Highway to Ruin: The crash of Southern Airways flight 242
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-24 @ 10:19:31</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35685685"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35684228">
          <h3>
            <a class="item" href="https://lwn.net/Articles/928026/"
              >The shrinking role of semaphores</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-24 @ 06:12:49</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35684228"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35684103">
          <h3>
            <a
              class="item"
              href="https://signalprocessingjobs.com/docs/blogs/articles/colosseum/"
              >Colosseum – A quick overview of the most powerful RF emulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-24 @ 05:51:04</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35684103"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35684002">
          <h3>
            <a
              class="item"
              href="https://tldp.org/HOWTO/Assembly-HOWTO/index.html"
              >Linux Assembly How to (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-24 @ 05:34:48</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35684002"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
