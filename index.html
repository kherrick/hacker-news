<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44202110">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44202110"
              >Ask HN: Any good tools for viewing congressional bills?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 15:54:52</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44202110"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                It comes in two formats: One is a text document with with column
                size restrictions that makes it very hard to read, worse than
                the text version of an IETF RFC. The second is a machine
                readable XML document which itself isn't easily read.
              </p>
              <p>
                Are there any good tools for viewing these? I did find
                GovTrack.us but it seems to be down so I'm not sure if it solves
                this problem.
              </p>
              <p>
                [1]:
                https://www.congress.gov/bill/119th-congress/house-bill/1/text
              </p>
            </div>
          </section>
        </section>
        <section id="44201975">
          <h3>
            <a
              class="item"
              href="https://about.gitlab.com/blog/2025/06/05/how-we-decreased-gitlab-repo-backup-times-from-48-hours-to-41-minutes/"
              >Decreasing Gitlab repo backup times from 48 hours to 41
              minutes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 15:43:05</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201975"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44201901">
          <h3>
            <a
              class="item"
              href="https://www.breathbelly.com/exercises/4-7-8-breathing"
              >4-7-8 Breathing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 15:36:00</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201901"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44201872">
          <h3>
            <a
              class="item"
              href="https://www.mozillafoundation.org/en/campaigns/meta-shut-down-your-invasive-ai-discover-feed-now/"
              >Meta: Shut Down Your Invasive AI Discover Feed. Now</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 15:33:10</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201872"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44201857">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/major-vpn-providers-ordered-to-block-pirate-sports-streaming-sites-250516/"
              >VPN providers in France ordered to block pirate sports IPTV</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 15:31:18</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201857"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44201829">
          <h3>
            <a
              class="item"
              href="https://links.fabiomanganiello.com/share/683ee70d0409e6.66273547"
              >Why Bell Labs Worked</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 15:27:00</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201829"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44201812">
          <h3>
            <a
              class="item"
              href="https://blocksandfiles.com/2025/06/06/sandia-turns-on-brain-like-storage-free-supercomputer/"
              >Sandia turns on brain-like storage-free supercomputer – Blocks
              and Files</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 15:24:44</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201812"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44201802">
          <h3>
            <a
              class="item"
              href="https://www.neowin.net/news/apple-warns-australia-against-joining-eu-in-mandating-iphone-app-sideloading/"
              >Apple warns Australia against joining EU in mandating iPhone app
              sideloading</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 15:23:34</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201802"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44201785">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2025/06/openai-confronts-user-panic-over-court-ordered-retention-of-chatgpt-logs/"
              >OpenAI is retaining all ChatGPT logs "indefinitely." Here's who's
              affected</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 15:21:24</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201785"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44201762">
          <h3>
            <a
              class="item"
              href="https://mattrighetti.com/2025/06/04/too-many-files-open"
              >Too Many Open Files</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 15:18:46</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201762"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44201748">
          <h3>
            <a class="item" href="https://zju3dv.github.io/freetimegs/"
              >Free Gaussian Primitives at Anytime Anywhere for Dynamic Scene
              Reconstruction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 15:16:58</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201748"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44201583">
          <h3>
            <a
              class="item"
              href="https://blog.sagyamthapa.com.np/interactive-guide-to-rate-limiting"
              >An Interactive Guide to Rate Limiting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 14:58:17</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201583"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44201072">
          <h3>
            <a
              class="item"
              href="https://www.oregonlive.com/silicon-forest/2025/06/top-researchers-leave-intel-to-build-startup-with-the-biggest-baddest-cpu.html"
              >Top researchers leave Intel to build startup with 'the biggest,
              baddest CPU'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 14:07:28</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44201072"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44200895">
          <h3>
            <a
              class="item"
              href="https://sebastiano.tronto.net/blog/2025-06-06-webdev/"
              >A masochist's guide to web development</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 13:48:52</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44200895"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44200870">
          <h3>
            <a class="item" href="https://esham.io/2025/05/shell-history"
              >Curate Your Shell History</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 13:46:17</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44200870"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44200866">
          <h3>
            <a class="item" href="https://odyc.dev"
              >Odyc.js – A tiny JavaScript library for narrative games</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 13:46:01</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44200866"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44200797">
          <h3>
            <a class="item" href="https://ratfactor.com/cards/pl-small"
              >Small Programs and Languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 13:38:31</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44200797"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44200101">
          <h3>
            <a class="item" href="https://github.com/ThornWalli/web-workbench"
              >ThornWalli/web-workbench: Old operating system as homepage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 12:19:46</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44200101"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44199967">
          <h3>
            <a class="item" href="https://deepnote.com/join-us"
              >Deepnote (YC S19) is hiring engineers to build an AI-powered data
              notebook</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 12:01:16</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44199770">
          <h3>
            <a
              class="item"
              href="https://edm115.dev/blog/2025/01/22/how-to-send-dtmf-on-android"
              >How to (actually) send DTMF on Android without being the default
              call app</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 11:29:11</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44199770"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44199699">
          <h3>
            <a
              class="item"
              href="https://layer22.com/swift-and-cute-framework-setting-up-a-project-with-cmake"
              >Swift and Cute 2D Game Framework: Setting Up a Project with
              CMake</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 11:15:16</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44199699"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44199597">
          <h3>
            <a
              class="item"
              href="https://boostsecurity.io/blog/weaponizing-dependabot-pwn-request-at-its-finest"
              >Weaponizing Dependabot: Pwn Request at its finest</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 10:55:17</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44199597"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44199592">
          <h3>
            <a
              class="item"
              href="https://jepsen.io/analyses/tigerbeetle-0.16.11"
              >Jepsen: TigerBeetle 0.16.11</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 10:53:51</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44199592"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44199437">
          <h3>
            <a
              class="item"
              href="https://dfarq.homeip.net/coleco-adam-computer/"
              >The Coleco Adam Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 10:25:39</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44199437"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44197932">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2025/self-hosting-your-own-media-considered-harmful"
              >Self-hosting your own media considered harmful according to
              YouTube</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 04:59:58</span
              ><span class="points-container"
                >Points: <span class="points">1298</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44197932"
                  >Comments</a
                ><span class="descendants">: 548</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44196945">
          <h3>
            <a class="item" href="https://github.com/wey-gu/py-pglite"
              >Test Postgres in Python Like SQLite</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 00:56:20</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44196945"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44196850">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/response-to-nyt-data-demands/"
              >How we’re responding to The NYT’s data demands in order to
              protect user privacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-06 @ 00:35:17</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44196850"
                  >Comments</a
                ><span class="descendants">: 241</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44195961">
          <h3>
            <a
              class="item"
              href="https://scalingintelligence.stanford.edu/blogs/tokasaurus/"
              >Tokasaurus: An LLM inference engine for high-throughput
              workloads</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 21:27:07</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44195961"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44191620">
          <h3>
            <a
              class="item"
              href="https://crookedtimber.org/2025/06/05/occasional-paper-the-impossible-predicament-of-the-death-newts/"
              >The impossible predicament of the death newts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 13:40:48</span
              ><span class="points-container"
                >Points: <span class="points">534</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44191620"
                  >Comments</a
                ><span class="descendants">: 178</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44189329">
          <h3>
            <a
              class="item"
              href="https://networkedartifacts.com/airlab/simulator"
              >Show HN: Air Lab – A portable and open air quality measuring
              device</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-05 @ 07:42:25</span
              ><span class="points-container"
                >Points: <span class="points">438</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44189329"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’ve been working on an air quality measuring device called Air
                Lab for the past three years. It measures CO2, temperature,
                relative humidity, air pollutants (VOC, NOx), and atmospheric
                pressure. You can log and analyze the data directly on the
                device — no smartphone or laptop needed.
              </p>
              <p>
                To better show what the device can do and how it feels like, I
                spent the past week developing a web-based simulator using
                Emscripten. It runs the stock firmware with most features
                available except for networking. Check it out and let me know
                what you think!
              </p>
              <p>
                The firmware will be open-source and available once the first
                batch of devices ships. We’re currently finishing up our
                crowdfunding campaign on CrowdSupply. If you want to get one,
                now is the time to support the project:
                <a
                  href="https://www.crowdsupply.com/networked-artifacts/air-lab"
                  >https://www.crowdsupply.com/networked-artifacts/air-lab</a
                >
              </p>
              <p>
                We started building the Air Lab because most air quality
                measuring devices we found were locked-down or hard to tinker
                with. Air quality is a growing concern, and we’re hoping a more
                open, playful approach can help make the topic more accessible.
                It is important to us that there is a low bar for customizing
                and extending the Air Lab. Until we ship, we plan to create rich
                documentation and further tools, like the simulator, to make
                this as easy as possible.
              </p>
              <p>
                The technical: The device is powered by the popular ESP32S3
                microcontroller, equipped with a precise CO2, temperature, and
                relative humidity sensor (SCD41) as well as a VOC/NOx (SGP41)
                and atmospheric pressure sensor (LPS22). The support circuitry
                provides built-in battery charging, a real-time clock, an RGB
                LED, buzzer, an accelerometer, and capacitive touch, which makes
                Air Lab a powerful stand-alone device. The firmware itself is
                written on top of esp-idf and uses LVGL for rendering the UI.
              </p>
              <p>
                If you seek more high-level info, here are also some videos
                covering the project: -
                <a href="https://www.youtube.com/watch?v=oBltdMLjUyg"
                  >https://www.youtube.com/watch?v=oBltdMLjUyg</a
                >
                (Introduction) -
                <a href="https://www.youtube.com/watch?v=_tzjVYPm_MU"
                  >https://www.youtube.com/watch?v=_tzjVYPm_MU</a
                >
                (Product Update)
              </p>
              <p>
                Would love your feedback — on the device, hardware choices,
                potential use cases, or anything else worth improving. If you
                want to get notified on project updates, subscribe on Crowd
                Supply.
              </p>
              <p>Happy to answer any questions!</p>
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
