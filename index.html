<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43683410">
          <h3>
            <a class="item" href="https://openai.com/index/gpt-4-1/"
              >GPT-4.1 in the API</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 17:01:45</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43683410"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43683071">
          <h3>
            <a
              class="item"
              href="https://www.wheresyoured.at/openai-is-a-systemic-risk-to-the-tech-industry-2/"
              >OpenAI Is a Systemic Risk to the Tech Industry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 16:28:53</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43683071"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682686">
          <h3>
            <a
              class="item"
              href="https://medicalxpress.com/news/2025-04-scientists-protein-il-infection-brain.html"
              >Scientists: Protein IL-17 fights infection, acts on the brain,
              inducing anxiety</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:54:10</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682686"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682615">
          <h3>
            <a class="item" href="https://socketcluster.io"
              >Socketcluster: Highly scalable pub/sub and RPC SDK</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:45:45</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682615"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682547">
          <h3>
            <a
              class="item"
              href="https://github.com/nathanhleung/protobuf-ts-types"
              >Show HN: Zero-codegen, no-compile TypeScript type inference from
              Protobufs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:41:03</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682547"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682541">
          <h3>
            <a
              class="item"
              href="https://jerf.org/iri/post/2025/fp_lessons_conclusion/"
              >Functional Programming Lessons Conclusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:40:40</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682541"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682369">
          <h3>
            <a
              class="item"
              href="https://phase.dev/blog/chacha-and-aes-simplicity-in-cryptography/"
              >AES and ChaCha</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:28:07</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682369"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682088">
          <h3>
            <a
              class="item"
              href="https://github.com/deepseek-ai/open-infra-index/tree/main/OpenSourcing_DeepSeek_Inference_Engine"
              >The Path to Open-Sourcing the DeepSeek Inference Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:03:10</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682088"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682006">
          <h3>
            <a class="item" href="https://sqlite-internal.pages.dev"
              >SQLite File Format Viewer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 14:55:57</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682006"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43681936">
          <h3>
            <a
              class="item"
              href="https://www.brooks.team/posts/how-to-bike-across-the-country/"
              >How to Bike Across the Country</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 14:49:42</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43681936"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43681679">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-03-dead-trees-large-amounts-carbon.html"
              >Dead trees keep surprisingly large amounts of carbon out of
              atmosphere</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 14:23:22</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43681679"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43681287">
          <h3>
            <a
              class="item"
              href="https://www.geoffreylitt.com/2025/04/12/how-i-made-a-useful-ai-assistant-with-one-sqlite-table-and-a-handful-of-cron-jobs"
              >A hackable AI assistant using a single SQLite table and a handful
              of cron jobs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 13:52:58</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43681287"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43680899">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/ai/dolphingemma/"
              >DolphinGemma: How Google AI is helping decode dolphin
              communication</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 13:12:00</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43680899"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43680699">
          <h3>
            <a class="item" href="https://github.com/meilisearch/meilisearch"
              >Meilisearch â€“ search engine API bringing AI-powered hybrid
              search</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 12:46:45</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43680699"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43680477">
          <h3>
            <a
              class="item"
              href="https://github.com/DmitriBogdanov/UTL/blob/master/docs/module_profiler.md"
              >Show HN: Single-Header Profiler for C++17</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 12:16:03</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43680477"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                I often found myself wondering "how much does this code segment
                take in terms of total runtime" and it's often quite annoying to
                figure out with optimizations enabled, especially when working
                on something new or testing someone else's implementation
                without the proper tooling set up. Wanted to have a single
                include lib that would allow us to write something like:
              </p>
              <p>``` PROFILE("Loop 1") for (...) // some work ```</p>
              <p>
                and have the next expression automatically record time &amp;
                dump results to a table. Wrote a few macros to do exactly that a
                few months back, but they were primitive and basically unusable
                for recursive code.
              </p>
              <p>
                Tried to come up with a more generic solution that would build a
                call graph for nested profiler-macros, handle threads and etc.
                but doing so in a naive way would be super slow since we'd need
                some kind of a recursive map of nodes with callsites as a keys.
              </p>
              <p>
                Recently had a revelation that it is possible to use
                macro-generated thread_local's to associate callsites with
                integer IDs on the fly and with some effort call graph can be
                neatly encoded in a few contiguous arrays with all graph
                building &amp; traversal logic reduced to simple checks and
                array lookups. Realized threading can be quite easily supported
                too in an almost lock-free fashion.
              </p>
              <p>
                After a few days of effort ended up building what I believe is a
                very much usable single-header profiling lib. Couldn't find
                anything quite like it, so I'd like to present it here and hear
                some opinions on the product:
              </p>
              <p>
                <a
                  href="https://github.com/DmitriBogdanov/UTL/blob/master/docs/module_profiler.md"
                  >https://github.com/DmitriBogdanov/UTL/blob/master/docs/modul...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43680232">
          <h3>
            <a class="item" href="https://omnom.zone/?src=hn"
              >Omnom: Self-hosted bookmarking with searchable, wysiwyg snapshots
              [showcase]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 11:42:13</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43680232"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43679781">
          <h3>
            <a class="item" href="https://github.com/codr7/hacktical-c"
              >Hacktical C: practical hacker's guide to the C programming
              language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 10:20:42</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43679781"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43679707">
          <h3>
            <a
              class="item"
              href="https://www.openmymind.net/Zigs-New-LinkedList-API/"
              >Zig's new LinkedList API (it's time to learn fieldParentPtr)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 10:06:33</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43679707"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43679004">
          <h3>
            <a
              class="item"
              href="https://www.bigsandwoodworking.com/kezurou-kai-39/"
              >Kezurou-Kai #39</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 07:47:18</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43679004"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43677917">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/04/13/books/review/mario-vargas-llosa-appraisal.html"
              >Mario Vargas Llosa has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 03:52:56</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43677917"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43677909">
          <h3>
            <a
              class="item"
              href="https://christopherdrum.github.io/posts/2025/04/porting-infocom-with-cosmo"
              >Show HN: Resurrecting Infocom's Unix Z-Machine with
              Cosmopolitan</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 03:51:55</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43677909"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
            <div class="text">
              <p>
                There is also a detailed write-up about the state of the
                original source code, the porting process, and the invaluable
                role Justine Tunney's Cosmpolitan project played in bringing the
                Zork trilogy (and more) to Windows/Mac/Linux/bsd for arm/x86
                machines over the course of a lazy Sunday.
              </p>
            </div>
          </section>
        </section>
        <section id="43677067">
          <h3>
            <a
              class="item"
              href="https://www.pillar.security/blog/new-vulnerability-in-github-copilot-and-cursor-how-hackers-can-weaponize-code-agents"
              >New Vulnerability in GitHub Copilot, Cursor: Hackers Can
              Weaponize Code Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 00:51:42</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43677067"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43676837">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2503.24322"
              >NoProp: Training neural networks without back-propagation or
              forward-propagation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 00:03:51</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43676837"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43676771">
          <h3>
            <a
              class="item"
              href="https://blog.sshh.io/p/everything-wrong-with-mcp"
              >Everything wrong with MCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-13 @ 23:53:35</span
              ><span class="points-container"
                >Points: <span class="points">404</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43676771"
                  >Comments</a
                ><span class="descendants">: 184</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43675248">
          <h3>
            <a class="item" href="https://www.signalbloom.ai/news/"
              >Show HN: I made a free tool that analyzes SEC filings and posts
              detailed reports</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-13 @ 19:33:24</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43675248"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
            <div class="text">
              <p>
                Currently does it for 1000+ US companies and specifically
                earnings related filings. By US companies, I mean the ones that
                are obliged to file SEC filings.
              </p>
              <p>
                This was the result of almost a year long effort and hundreds of
                prototypes :)
              </p>
              <p>
                It currently auto-publishes for 1000 ish US companies by market
                cap, relies on 8-K filing as a trigger.
              </p>
              <p>
                e.g.
                <a href="https://www.signalbloom.ai/news/NVDA"
                  >https://www.signalbloom.ai/news/NVDA</a
                >
                will take you to NVDA earnings
              </p>
              <p>
                Would be grateful to get some feedback. Especially if you follow
                a company, check its reports out. Thank you!
              </p>
              <p>
                Some examples:
                <a
                  href="https://www.signalbloom.ai/news/AAPL/apple-q1-eps-beats-despite-revenue-miss-china-woes"
                  >https://www.signalbloom.ai/news/AAPL/apple-q1-eps-beats-desp...</a
                >
              </p>
              <p>
                <a
                  href="https://www.signalbloom.ai/news/NVDA/nvidia-revenue-soars-margin-headwinds-emerge"
                  >https://www.signalbloom.ai/news/NVDA/nvidia-revenue-soars-ma...</a
                >
              </p>
              <p>
                <a
                  href="https://www.signalbloom.ai/news/JPM/jpm-beats-estimates-on-cib-strength"
                  >https://www.signalbloom.ai/news/JPM/jpm-beats-estimates-on-c...</a
                >
                (JPM earnings from Friday)
              </p>
              <p>
                Hallucination note:
                <a href="https://www.signalbloom.ai/hallucination-benchmark"
                  >https://www.signalbloom.ai/hallucination-benchmark</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43675126">
          <h3>
            <a
              class="item"
              href="https://github.com/jlevy/og-equity-compensation"
              >Open guide to equity compensation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-13 @ 19:13:37</span
              ><span class="points-container"
                >Points: <span class="points">569</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43675126"
                  >Comments</a
                ><span class="descendants">: 258</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43658089">
          <h3>
            <a class="item" href="https://nerdy.dev/ex-googler"
              >Googler... ex-Googler</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-11 @ 20:19:11</span
              ><span class="points-container"
                >Points: <span class="points">789</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43658089"
                  >Comments</a
                ><span class="descendants">: 694</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43649781">
          <h3>
            <a
              class="item"
              href="https://bakpakin.com/writing/how-janets-peg-works.html"
              >How Janet's PEG module works</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-11 @ 02:04:52</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43649781"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43648649">
          <h3>
            <a
              class="item"
              href="https://www.fda.gov/drugs/science-and-research-drugs/cure-id-app-lets-clinicians-report-novel-uses-existing-drugs"
              >Cure ID App Lets Clinicians Report Novel Uses of Existing
              Drugs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 22:34:54</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43648649"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646227">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/04/09/google-says-itll-embrace-anthropics-standard-for-connecting-ai-models-to-data/"
              >Hassabis Says Google DeepMind to Support Anthropic's MCP for
              Gemini and SDK</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 17:34:40</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646227"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
