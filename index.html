<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39560413">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/La_Bougie_du_Sapeur"
              >La Bougie Du Sapeur</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 10:20:19</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39560413"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39560250">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/photoroom/fb70ca3c-632f-4b1b-b6e2-004f0240011d?lever-origin=applied&amp;lever-source%5B%5D=yc"
              >Photoroom (YC S20) Is Hiring a Frontend State Architect in Paris
              (Mobx, React)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 09:50:20</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39560033">
          <h3>
            <a
              class="item"
              href="https://www.theolognion.com/p/company-forgets-why-they-exist-after-11-week-migration-to-kubernetes"
              >Company forgets why they exist after 11-week migration to
              Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 09:08:47</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39560033"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39559667">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Kappa_Beta_Phi"
              >Kappa Beta Phi</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 08:07:47</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39559667"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39559517">
          <h3>
            <a
              class="item"
              href="https://hbr.org/2018/02/if-youre-so-successful-why-are-you-still-working-70-hours-a-week"
              >If You're So Successful, Why Are You Still Working 70 Hours a
              Week?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 07:37:30</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39559517"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39559411">
          <h3>
            <a
              class="item"
              href="https://cacm.acm.org/news/cacm-is-now-open-access-2/"
              >CACM Is Now Open Access</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 07:19:15</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39559411"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39559390">
          <h3>
            <a class="item" href="https://hal.science/hal-03603294/"
              >New Applications of Clifford's Geometric Algebra</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 07:15:57</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39559390"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39559318">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/02/hdmi-forum-to-amd-no-you-cant-make-an-open-source-hdmi-2-1-driver/"
              >You can't make an open source HDMI 2.1 driver</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 07:02:12</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39559318"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39559281">
          <h3>
            <a
              class="item"
              href="https://cloudinary.com/blog/jpeg-xl-and-the-pareto-front"
              >JPEG XL and the Pareto Front</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 06:55:59</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39559281"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39557188">
          <h3>
            <a
              class="item"
              href="https://struct.ai/blog/introducing-the-struct-chat-platform"
              >Show HN: Struct – A Feed-Centric Chat Platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 00:49:07</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39557188"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
            <div class="text">
              <p>
                At Struct, we're frustrated by the clutter, distractions, and
                inefficiencies plaguing existing chat platforms like Slack and
                Discord.
              </p>
              <p>
                We've built a radical new chat platform that leverages threads,
                feeds, and AI to help alleviate these problems, and give you
                back more time in your day.
              </p>
              <p>
                Struct uses a thread-first approach to keep conversations
                on-topic. It applies AI-generated titles and summaries to help
                you decide what's worth your attention. Threads are then
                organized in a real-time feed, keeping all your conversations
                up-to-date and at the ready, eliminating the need for channel
                hopping.
              </p>
              <p>
                Comprehensive search tools make finding things a breeze, and
                Strucbot, our AI assistant can answer questions based on what
                it’s learned from prior threads. It can even proactively respond
                when it notices repeat requests, providing quick answers so you
                don’t have to. Structbot is fully GPT-4 enabled, so you can riff
                with Chat GPT and your peers (generate code, ask questions, all
                the good stuff) without ever switching apps.
              </p>
              <p>
                Struct is available on Linux, Windows, Mac, and even works as a
                Slack interface. Give us a try and let us know what you think.
              </p>
            </div>
          </section>
        </section>
        <section id="39557098">
          <h3>
            <a
              class="item"
              href="https://apps.apple.com/us/app/offlinellm/id6478590762"
              >Show HN: OfflineLLM – a Vision Pro app running TinyLlama on
              device</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 00:33:23</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39557098"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
            <div class="text">
              Hey, I built this in a day while at Founders Inc Apple Vision Pro
              residency. Try it out, let me know what you think.
            </div>
          </section>
        </section>
        <section id="39557055">
          <h3>
            <a
              class="item"
              href="https://people.eecs.berkeley.edu/~matei/papers/2013/sosp_sparrow.pdf"
              >Sparrow: Distributed, Low Latency Scheduling (2013) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 00:27:14</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39557055"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39556956">
          <h3>
            <a
              class="item"
              href="https://www.adamgrant.info/tiny-predictive-text"
              >Show HN: Predictive text using only 13kb of JavaScript. no LLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 00:11:39</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39556956"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39555675">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2310.18166"
              >Functional ownership through fractional uniqueness</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 21:52:13</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39555675"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39555493">
          <h3>
            <a class="item" href="https://maximullaris.com/gc_less_java.html"
              >Experimenting with GC-less (heap-less) Java</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 21:37:14</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39555493"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39554874">
          <h3>
            <a
              class="item"
              href="https://www.micahlerner.com/2023/07/23/defcon-preventing-overload-with-graceful-feature-degradation.html"
              >Defcon: Preventing overload with graceful feature degradation
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 20:50:50</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39554874"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39554539">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39554539"
              >Ask HN: Did you encounter any leap year bugs today?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 20:22:43</span
              ><span class="points-container"
                >Points: <span class="points">440</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39554539"
                  >Comments</a
                ><span class="descendants">: 414</span></span
              >
            </h4>
            <div class="text">
              <p>
                All test suites are passing now, and SRE has scheduled a
                postmortem after the QA confirms the fix in 2028.
              </p>
            </div>
          </section>
        </section>
        <section id="39553967">
          <h3>
            <a
              class="item"
              href="https://vickiboykis.com/2024/02/28/gguf-the-long-way-around/"
              >GGUF, the Long Way Around</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 19:36:44</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39553967"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39553801">
          <h3>
            <a
              class="item"
              href="https://www.bitsaboutmoney.com/archive/financial-systems-take-a-holiday/"
              >Financial systems take a holiday</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 19:21:48</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39553801"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39550124">
          <h3>
            <a
              class="item"
              href="https://ferrous-systems.com/blog/lock-free-ring-buffer/"
              >A lock-free ring-buffer with contiguous reservations (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 14:57:03</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39550124"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39549486">
          <h3>
            <a
              class="item"
              href="https://gaultier.github.io/blog/you_inherited_a_legacy_cpp_codebase_now_what.html"
              >You've just inherited a legacy C++ codebase, now what?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 14:11:59</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39549486"
                  >Comments</a
                ><span class="descendants">: 258</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39549215">
          <h3>
            <a
              class="item"
              href="https://www.talesfromtheopsside.com/blog/how-a-leap-second-caused-havoc-with-the-internet/"
              >How a leap second caused havoc with the Internet (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 13:47:28</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39549215"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39548410">
          <h3>
            <a
              class="item"
              href="https://jamesg.blog/2024/02/29/linux-manual-pages/"
              >Serving my blog posts as Linux manual pages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 12:18:20</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39548410"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39548130">
          <h3>
            <a class="item" href="https://github.com/Eventual-Inc/Daft"
              >Daft: Distributed DataFrame for Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 11:40:18</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39548130"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39547355">
          <h3>
            <a
              class="item"
              href="https://nicf.net/articles/curvature-of-polyhedra/"
              >Curvature of Polyhedra (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 08:09:54</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39547355"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39547118">
          <h3>
            <a
              class="item"
              href="https://www.linuxfromscratch.org/blfs/view/stable-systemd/index.html"
              >Beyond Linux from Scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 07:25:14</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39547118"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39546497">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/out-margins/beware-lides-march"
              >Beware the Lides of March</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 04:53:09</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39546497"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39546174">
          <h3>
            <a class="item" href="https://www.strchr.com/hash_functions"
              >Hash functions: An empirical comparison (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 03:38:23</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39546174"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39544498">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Antarctic_English"
              >Antarctic English</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 22:48:51</span
              ><span class="points-container"
                >Points: <span class="points">294</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39544498"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39532550">
          <h3>
            <a
              class="item"
              href="https://williamjbowman.com/resources/geller2023-wasm-prechk-current-preprint.pdf"
              >Indexed types for a statically safe WebAssembly [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 01:03:44</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39532550"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
