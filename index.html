<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36047209">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/sante/jobs/Beng31R-founding-engineer-full-stack"
              >Santé (YC S23) Is Hiring – Building a Modern POS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 17:00:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36046999">
          <h3>
            <a
              class="item"
              href="https://www.hhs.gov/surgeongeneral/priorities/youth-mental-health/social-media/index.html"
              >Social Media and Youth Mental Health</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 16:49:30</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36046999"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36046830">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.12234"
              >The Damage to Lunar Orbiting Spacecraft Caused by the Ejecta of
              Lunar Landers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 16:39:21</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36046830"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36046293">
          <h3>
            <a class="item" href="https://coryd.dev/posts/2023/i-block-ads/"
              >I Block Ads</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 16:04:31</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36046293"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36046222">
          <h3>
            <a
              class="item"
              href="https://developers.redhat.com/articles/2023/05/23/podman-desktop-now-generally-available"
              >Podman Desktop 1.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 15:59:13</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36046222"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36045938">
          <h3>
            <a
              class="item"
              href="https://www.openrobotics.org/blog/2023/5/23/ros-2-iron-irwini-released"
              >ROS 2 Iron Irwini Release</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 15:41:14</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36045938"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36045919">
          <h3>
            <a
              class="item"
              href="https://edconway.substack.com/p/watching-paint-dry"
              >Watching Paint Dry: The unexpectedly interesting story of car
              coatings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 15:40:03</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36045919"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36045671">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/cars/2023/05/ev-advocates-join-tech-groups-and-automakers-to-oppose-am-radio-mandate/"
              >Congress wants AM radio in all new cars – trade groups say that’s
              a mistake</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 15:25:19</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36045671"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36045526">
          <h3>
            <a
              class="item"
              href="https://blogs.windows.com/windowsdeveloper/2023/05/23/bringing-the-power-of-ai-to-windows-11-unlocking-a-new-era-of-productivity-for-customers-and-developers-with-windows-copilot-and-dev-home/"
              >Bringing the power of AI to Windows 11</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 15:17:13</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36045526"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36044977">
          <h3>
            <a
              class="item"
              href="https://www.macrumors.com/2023/05/23/apple-announces-deal-to-make-components-in-the-usa/"
              >Apple announces multibillion deal with Broadcom to make
              components in the USA</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 14:39:15</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36044977"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36044744">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-05-23/how-to-get-a-job-in-2023-young-workers-eye-finance-with-tech-struggling"
              >Almost 200k Job Cuts in Tech Pushes New Grads to Wall Street</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 14:21:33</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36044744"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36044591">
          <h3>
            <a
              class="item"
              href="https://www.lariatdata.com/blog/continuous-data-quality-athena"
              >A Guide to Continuous Data Quality Monitoring for AWS Athena</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 14:12:34</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36044591"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36044561">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/05/23/well/family/social-media-mental-health-surgeon-general.html"
              >Social media can be a ‘profound risk’ to youth, surgeon general
              warns</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 14:10:13</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36044561"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36044543">
          <h3>
            <a
              class="item"
              href="https://blog.pypi.org/posts/2023-05-23-removing-pgp/"
              >Removing PGP from PyPI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 14:09:20</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36044543"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36044362">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/elephants-may-be-domesticating-themselves"
              >Elephants may be domesticating themselves</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 13:56:51</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36044362"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36044112">
          <h3>
            <a class="item" href="https://dylibso.com/blog/wasm-udf/"
              >WebAssembly is eating the database?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 13:39:51</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36044112"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36043944">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36043944"
              >Launch HN: Common Paper (YC W23) – SAFEs for Commercial
              Contracts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 13:28:53</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36043944"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
            <div class="text">
              <a href="https://commonpaper.com">https://commonpaper.com</a>). We
              provide standard, open-source contracts and a platform for getting
              them signed quickly. See
              <a href="https://youtu.be/f7maIapJpU4"
                >https://youtu.be/f7maIapJpU4</a
              >
              for an overview, and
              <a href="https://youtu.be/A1PWjWiheFk"
                >https://youtu.be/A1PWjWiheFk</a
              >
              for a demo of sending and signing a contract.
              <p>
                I (Jake) was a co-founder of two B2B SaaS companies, RJMetrics
                (where Ben and I met), and Stitch. Everything about contracts
                was frustrating, both at those startups and the larger companies
                that acquired us.
              </p>
              <p>
                Way too often, the contracting process with a customer got
                adversarial—arguing over whose template to use, emailing Word
                docs back and forth, huge legal fees, and unpredictable delays
                that made it hard to know if a deal would ever close. Then, when
                we finally got the customer to sign, we had to keep track of all
                of the promises embedded in the contract. This is difficult when
                you have hundreds of customers and contract PDFs full of
                unstructured text.
              </p>
              <p>
                The breaking point came when one of our customers was acquired
                by Oracle. They wanted to keep using our product, but had to
                move from our original contract to the one that Oracle uses. In
                exchange for this, they were willing to increase the price they
                were paying from $6,000 to $24,000 per year.
              </p>
              <p>
                It took us 9 months to get the new contract in place, just to
                enable them to keep using the product. We spent more on
                attorneys than we gained from the upsell. And there was
                basically nothing we could do to improve that process as a
                single company operating in a system where standards don’t
                exist.
              </p>
              <p>
                Contrast that to the standardization that the SAFE, or Simple
                Agreement for Future Equity, brought to seed investments, and
                the potential is obvious. (Past discussion of the SAFE at
                <a href="https://news.ycombinator.com/item?id=33639191"
                  >https://news.ycombinator.com/item?id=33639191</a
                >)
              </p>
              <p>
                If you’re a startup raising money on a SAFE, the process is
                simple, whether you’re raising $10k from an angel or $1M from a
                VC. Everyone already uses, or at least is familiar with, the
                same basic contract. There are a few variables that change on a
                deal-by-deal basis, but the transactions are vastly more
                efficient because everyone is on the same standard contract.
              </p>
              <p>
                If you start with standard contracts, you can build very
                different software to manage them compared to traditional
                contracts. Our business model is to provide the standard
                contracts for free and charge money from companies who use our
                software to sell to their customers (more on this below).
              </p>
              <p>
                The standard contracts we create are all related to buying and
                selling B2B software. This includes a non-disclosure agreement,
                (<a href="https://commonpaper.com/standards/mutual-nda/"
                  >https://commonpaper.com/standards/mutual-nda/</a
                >), sales contract (<a
                  href="https://commonpaper.com/standards/cloud-service-agreement/"
                  >https://commonpaper.com/standards/cloud-service-agreement/</a
                >), SLA, DPA, ToS, etc. The full list is at
                <a href="https://commonpaper.com/standards/"
                  >https://commonpaper.com/standards/</a
                >.
              </p>
              <p>
                The process for creating and revising the contracts is modeled
                after an open-source software project, and they are released for
                free (as in both speech and beer) under the Creative Commons CC
                BY 4.0 license.
              </p>
              <p>
                We have a committee of 40+ attorneys from tech companies and law
                firms who are analogous to code contributors (<a
                  href="https://commonpaper.com/committee"
                  >https://commonpaper.com/committee</a
                >). An attorney on our team, who you can think about like a
                maintainer, collects all of their feedback and synthesizes it
                into a version for release (eg the Design Partner Agreement
                v1.0). We post the agreements as DOCX, PDF, and HTML on our
                website and host markdown on Github.
              </p>
              <p>
                Most of the usage of the agreements happens outside of our
                platform, and we don’t have any visibility into that unless
                people choose to tell us. However, we do know that thousands of
                companies have signed the agreements, and millions of dollars
                worth of deals have been closed on them.
              </p>
              <p>
                Each agreement is split into two sections: the standard terms,
                which are the same across all instances, and a cover page, with
                variables that can be customized for a particular company and
                deal. The latter is basically a schema for each agreement type,
                and that leads to the fundamental trade-off in how we build our
                software. We have less flexibility around types of contracts
                (because we’re focused on the standard agreements, not arbitrary
                DOCX files), but in exchange, every agreement type has a
                consistent data model, which means that we can build
                integrations and features that work across all customers. This
                gain is huge.
              </p>
              <p>
                For example, we can use the data in the fees section of our
                standard Cloud Service Agreement to automatically generate
                invoices and subscriptions using Stripe. Similarly, it’s trivial
                to use our API (<a href="https://api.commonpaper.com/docs"
                  >https://api.commonpaper.com/docs</a
                >) to check if an active NDA is in place before sharing
                confidential information or to keep a spreadsheet up to date
                with the SLA obligations for different customers.
              </p>
              <p>
                Traditional contract management tools are built around adding
                electronic signatures to documents full of unstructured text
                and/or creating a custom data model from a particular company’s
                bespoke contract. There’s no way they can offer features like
                this without a custom project for each particular contract. It’s
                basically the difference between custom software and a software
                product.
              </p>
              <p>
                Part of our feature set overlaps with the traditional tools. We
                can do things like send a contract to the other side, propose
                changes, approve, and sign. But our negotiation model is
                different in that it encourages both sides to keep changes
                narrowly scoped to the variables in the cover page. That makes
                it faster both to propose the changes and for each side to
                understand, and accept or reject, the changes proposed by their
                counterparty.
              </p>
              <p>
                We believe that, just as with SAFEs in the investment world, the
                potential efficiency gains and positive side effects of this
                model are so big that the transition is inevitable. We’d love
                for you all to try it out and let us know your feedback and
                suggestions. The agreements are free forever, and our software
                is free as well until you use it to close deals with 5
                customers.
                <a href="https://commonpaper.com/product/"
                  >https://commonpaper.com/product/</a
                >.
              </p>
              <p>
                We’re interested to hear about any experiences you’ve had with
                contracts and how you’ve worked with them. We look forward to
                your comments!
              </p>
            </div>
          </section>
        </section>
        <section id="36043716">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-01708-4"
              >A mental health crisis in science</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 13:08:53</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36043716"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36043398">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/investigates/special-report/crypto-binance-money/"
              >Binance commingled customer funds and company revenue, former
              insiders say</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 12:38:45</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36043398"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36043327">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2023/05/23/meta-sells-giphy-to-shutterstock-for-53m-after-uk-divestment-order/"
              >Following UK antitrust order, Meta sells Giphy to Shutterstock
              for $53M</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 12:29:03</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36043327"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36043322">
          <h3>
            <a
              class="item"
              href="https://blog.waymo.com/2023/05/waymo-and-uber-partner-to-bring-waymos.html"
              >Waymo and Uber partner to bring autonomous driving technology to
              Uber</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 12:28:39</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36043322"
                  >Comments</a
                ><span class="descendants">: 257</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36042732">
          <h3>
            <a
              class="item"
              href="https://metalintheory.com/metallica-master-of-puppets/"
              >Microtiming in Metallica's “Master of Puppets” (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 11:22:51</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36042732"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36042213">
          <h3>
            <a
              class="item"
              href="https://www.geoffchappell.com/notes/windows/archive/aard/drdos/index.htm"
              >The AARD Code and DR DOS (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 10:24:44</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36042213"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36041432">
          <h3>
            <a class="item" href="https://www.ableton.com/en/push/"
              >Ableton Push 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 08:16:18</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36041432"
                  >Comments</a
                ><span class="descendants">: 187</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36038950">
          <h3>
            <a
              class="item"
              href="https://www.rockpapershotgun.com/simcity-4-the-greatest-citybuilder-of-all-time-was-released-20-years-ago"
              >SimCity 4 was released 20 years ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 02:04:56</span
              ><span class="points-container"
                >Points: <span class="points">283</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36038950"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36035748">
          <h3>
            <a class="item" href="https://erkin.party/emacs/"
              >Emacs Web Buttons</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 19:41:29</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36035748"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36030979">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-05-humanity-earliest-mesopotamia-years.html"
              >Humanity's earliest recorded kiss occurred in Mesopotamia 4,500
              years ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 13:10:15</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36030979"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36022731">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Ithkuil"
              >Ithkuil, the Most Complicated Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 16:54:20</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36022731"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36021770">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/05/18/magazine/somatic-therapy.html"
              >The Rise of Somatic Therapy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 15:10:44</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36021770"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36020670">
          <h3>
            <a
              class="item"
              href="https://web.mit.edu/2.998/www/QuaternionReport1.pdf"
              >Quaternions, Interpolation and Animation (1998) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 13:30:58</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36020670"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
