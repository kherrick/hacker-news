<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36673280">
          <h3>
            <a class="item" href="https://www.trythrow.com"
              >Show HN: Throw – A space for asking and answering questions
              anonymously</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 21:34:48</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36673280"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
            <div class="text">
              <p>
                For the past two years we’ve been working on this disruptive new
                thing. It’s about people, community, communication and truth.
              </p>
              <p>
                Throw is the new space for asking and answering questions
                anonymously. We believe that in today’s world (both online and
                offline) content in communication exchanges is strongly
                influenced by the personas, profiles and façades people
                maintain/upkeep/safeguard socially, ideologically and on
                relationships.
              </p>
              <p>
                From the way people post on Instagram the life they want others
                to believe they have, or the way people behave on thanksgiving
                with family, or at work, or with friends; on every social
                setting and interaction to some degree acting and behaving
                according to that setting and the people they interact with.
                These dynamics influence the content itself, as people don’t
                just respond to a question like computers do. What ends up
                happening is that the responder comes up with the answer by
                blending the possibly objective answer with feelings, setting,
                desires, commitments, ideologies, fears, insecurities, etc
                (social pressure or social agenda).
              </p>
              <p>
                Something is missing between social media and the traditional
                Q&amp;A…
              </p>
              <p>
                Throw addresses this by creating a space free from this social
                agenda. Thus focusing strictly on the content exchanged and
                providing a safe, comfortable and unbiased space where people
                can ask and answer anything freely with no bias, fears or
                strings attached.
              </p>
              <p>
                We've put key components of social media, Q&amp;A and surveying
                industries into one platform.
              </p>
              <p>
                Not only may Throw be used for personal and private questions
                and answers. But the power of crowdsourcing allows for a great
                variety of use cases like market research, validation of content
                and ideas, trivia, and much more. Serious matters and also just
                for fun…
              </p>
              <p>
                It’s a query marketplace which means that “throwers” (people who
                ask questions) pay a fee proportional to the answers they need
                and in turn “catchers” (who catch them and respond) get
                compensated. This way we guarantee every user gets as many
                responses as he/she needs.
              </p>
              <p>
                As for dealing with anonymity, we have built a sophisticated
                moderation protocol to neutralize and quickly ban people that
                contribute negatively as it is a priority people feel safe and
                comfortable in this community.
              </p>
              <p>
                We have worked very hard to create a delightful product and are
                basically launching today!
              </p>
              <p>
                If this is something that may be of your interest or you’d like
                to be one of the first to test it out download our app and play
                around with it.
                <a href="https://www.trythrow.com">https://www.trythrow.com</a>
              </p>
              <p>
                Also, if you have questions there is additional information in
                the FAQs section on our web page that could be of help.
              </p>
              <p>
                Finally, we really appreciate any feedback we can get (of any
                kind). So if there's anything you like, don't like, or any other
                thought about Throw, we'd love to hear about it! You may post a
                comment below or through the contact section on the web page.
              </p>
              <p>Be curious and dare to know!</p>
              <p>Thank you!</p>
            </div>
          </section>
        </section>
        <section id="36673224">
          <h3>
            <a class="item" href="https://github.com/immich-app/immich"
              >Self-hosted photo and video backup solution directly from your
              mobile phone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 21:28:40</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36673224"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36672957">
          <h3>
            <a class="item" href="https://github.com/mkirchner/hamt"
              >Show HN: A hash array-mapped trie implementation in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 21:06:55</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36672957"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                Kind of aiming to be "the libavl for HAMTs". That is obviously a
                high and aspirational bar but a distinct possibility if it stirs
                up a little interest and/or contribution.
              </p>
              <p>
                Anyways, it's time for this to go out, collect feedback and
                maybe even some use outside of toy projects. Let me know how it
                goes.
              </p>
            </div>
          </section>
        </section>
        <section id="36672888">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/fathom/jobs/OVTRjXb-staff-engineer-full-stack-remote"
              >Fathom AI Notetaker (YC W21) is hiring a staff engineer
              (remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 21:00:06</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36672447">
          <h3>
            <a class="item" href="https://anicetnougaret.fr/blog/farswap-xp"
              >Postmortem: Co-founding a Web3 startup as a crypto skeptic young
              dev</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 20:24:58</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36672447"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36672192">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41538-019-0061-9"
              >Linoleic acid–good or bad for the brain?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 20:05:10</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36672192"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36672115">
          <h3>
            <a
              class="item"
              href="https://articles.59.ca/doku.php?id=em:20482030"
              >2048 Bit RSA and the Year 2030</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 19:58:01</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36672115"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36670328">
          <h3>
            <a
              class="item"
              href="https://github.com/markmal/freeship-plus-in-lazarus"
              >FreeShip Plus in Lazarus – an open-source software for boat and
              hull design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 17:58:30</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36670328"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36669249">
          <h3>
            <a class="item" href="https://rauno.me/craft/interaction-design"
              >Invisible Details of Interaction Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 17:02:42</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36669249"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36668964">
          <h3>
            <a
              class="item"
              href="https://jvns.ca/blog/2023/07/10/lima--a-nice-way-to-run-linux-vms-on-mac/"
              >Lima: A nice way to run Linux VMs on Mac</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 16:44:09</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36668964"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36668732">
          <h3>
            <a
              class="item"
              href="https://github.com/zhuowei/VisionOSStereoScreenshots/tree/alvr"
              >Apple VisionOS Simulator streaming wirelessly to Meta Quest
              headset</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 16:30:34</span
              ><span class="points-container"
                >Points: <span class="points">258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36668732"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36668472">
          <h3>
            <a class="item" href="https://gamehistory.org/87percent/"
              >New study reveals most classic video games are unavailable</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 16:15:20</span
              ><span class="points-container"
                >Points: <span class="points">432</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36668472"
                  >Comments</a
                ><span class="descendants">: 397</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36667848">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/first-u-s-ban-on-sale-of-cellphone-location-data-might-be-coming-fbe47e53"
              >First U.S. ban on sale of cellphone location data might be
              coming</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 15:28:43</span
              ><span class="points-container"
                >Points: <span class="points">366</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36667848"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36667374">
          <h3>
            <a class="item" href="https://github.com/danswer-ai/danswer"
              >Show HN: Danswer – Open-source question answering across all your
              docs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 14:55:26</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36667374"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <p>
                It is an open source, self-hosted search tool that allows you to
                ask questions and get answers across common workspace apps AND
                your personal documents (via file upload / web scraping)! Full
                demo here:
                <a href="https://www.youtube.com/watch?v=geNzY1nbCnU&amp;t=2s"
                  >https://www.youtube.com/watch?v=geNzY1nbCnU&amp;t=2s</a
                >.
              </p>
              <p>
                The code (<a href="https://github.com/danswer-ai/danswer"
                  >https://github.com/danswer-ai/danswer</a
                >) is open source and permissively licensed (MIT). If you want
                to try it out, you can set it up locally with just a couple of
                commands (more details in our docs -
                <a href="https://docs.danswer.dev/introduction"
                  >https://docs.danswer.dev/introduction</a
                >). We hope that someone out there finds this useful
              </p>
              <p>
                We’d love to hear from you in our Slack (<a
                  href="https://join.slack.com/t/danswer/shared_invite/zt-1u3h3ke3b-VGh1idW19R8oiNRiKBYv2w"
                  >https://join.slack.com/t/danswer/shared_invite/zt-1u3h3ke3b-...</a
                >) or Discord (<a href="https://discord.gg/TDJ59cGV2X"
                  >https://discord.gg/TDJ59cGV2X</a
                >). Let us know what other features would be useful for you!
              </p>
            </div>
          </section>
        </section>
        <section id="36667278">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/the-physicist-who-bets-that-gravity-cant-be-quantized-20230710/"
              >A physicist who bets that gravity can’t be quantized</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 14:48:55</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36667278"
                  >Comments</a
                ><span class="descendants">: 204</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36667192">
          <h3>
            <a
              class="item"
              href="https://zukunft-der-sub.de/for-a-library-with-a-future"
              >Saving a German Library as an interface between research and
              infrastructure</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 14:43:29</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36667192"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36666782">
          <h3>
            <a class="item" href="https://hocus.dev/blog/qemu-vs-firecracker/"
              >We replaced Firecracker with QEMU</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 14:15:04</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36666782"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36666702">
          <h3>
            <a class="item" href="https://github.com/Shelf-nu/shelf.nu"
              >Shelf – open-source asset management software</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 14:10:34</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36666702"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36666260">
          <h3>
            <a
              class="item"
              href="https://electroagenda.com/en/hilbert-transform/"
              >Hilbert Transform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 13:39:45</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36666260"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36666116">
          <h3>
            <a
              class="item"
              href="https://wiki.tilde.institute/w/firefox-address-bar-tips"
              >Firefox address bar</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 13:30:05</span
              ><span class="points-container"
                >Points: <span class="points">814</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36666116"
                  >Comments</a
                ><span class="descendants">: 264</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36664604">
          <h3>
            <a
              class="item"
              href="https://alexplescan.com/posts/2023/07/08/easy-svg-sparklines/"
              >Easy SVG sparklines</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 10:59:47</span
              ><span class="points-container"
                >Points: <span class="points">293</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36664604"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36664221">
          <h3>
            <a
              class="item"
              href="https://nick-lane.net/wp-content/uploads/2020/12/Lane-Nature-review-of-Zimmer.pdf"
              >Beyond the Gene (2018) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 10:15:04</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36664221"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36663498">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41467-023-38876-w"
              >A biological camera that captures and stores images directly into
              DNA</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 08:26:03</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36663498"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36663060">
          <h3>
            <a
              class="item"
              href="https://github.com/kubernetes/kubernetes/pull/116429"
              >Kubernetes SidecarContainers feature is merged</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 07:18:16</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36663060"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36662899">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/programming/InheritanceSeparateAspects"
              >Polymorphism and other important aspects of inheritance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 06:47:58</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36662899"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36662339">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/the-night-17-million-precious-military-records-went-up-in-smoke/"
              >Fifty years ago, a fire ripped through the National Personnel
              Records Center</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 05:04:31</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36662339"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36654372">
          <h3>
            <a class="item" href="https://www.emproof.com/"
              >Bypassing Readout Protection in Nordic Semiconductor
              Microcontrollers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-09 @ 13:40:11</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36654372"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36653169">
          <h3>
            <a class="item" href="https://github.com/marcoheisig/Petalisp"
              >Petalisp: Elegant High Performance Computing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-09 @ 10:08:36</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36653169"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36652394">
          <h3>
            <a
              class="item"
              href="https://cornellmath.wordpress.com/2008/01/26/convergence-of-infinite-products/"
              >Convergence of Infinite Products (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-09 @ 07:23:18</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36652394"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36650062">
          <h3>
            <a
              class="item"
              href="http://oldvcr.blogspot.com/2023/07/making-potato-webcam-with-commodore-128.html"
              >Making a potato livecam with the Commodore 128 VDC and
              ComputerEyes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-09 @ 00:13:56</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36650062"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
