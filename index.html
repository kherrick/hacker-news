<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44545858">
          <h3>
            <a
              class="item"
              href="https://www.medrxiv.org/content/10.1101/2025.06.20.25329961v1"
              >Light exposure at night predicts incidence of cardiovascular
              diseases</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 22:48:14</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44545858"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44544388">
          <h3>
            <a
              class="item"
              href="https://www.tu-darmstadt.de/universitaet/aktuelles_meldungen/einzelansicht_512064.en.jsp"
              >'Starter packs' have played a central role in Bluesky's rapid
              growth</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 19:22:40</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44544388"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44544266">
          <h3>
            <a class="item" href="https://0x44.xyz/blog/web-request-blocking/"
              >Bypassing Google's big anti-adblock update</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 19:06:09</span
              ><span class="points-container"
                >Points: <span class="points">411</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44544266"
                  >Comments</a
                ><span class="descendants">: 349</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543913">
          <h3>
            <a class="item" href="https://github.com/jtang613/GhidrAssistMCP"
              >A better Ghidra MCP server – GhidrAssistMCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 18:21:33</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543913"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543865">
          <h3>
            <a class="item" href="https://ellsberg.substack.com/p/free-speech"
              >Supreme Court's ruling practically wipes out free speech for sex
              writing online</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 18:14:37</span
              ><span class="points-container"
                >Points: <span class="points">422</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543865"
                  >Comments</a
                ><span class="descendants">: 547</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543508">
          <h3>
            <a class="item" href="https://github.com/MoonshotAI/Kimi-K2"
              >Kimi k2 largest open source SOTA model?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 17:26:24</span
              ><span class="points-container"
                >Points: <span class="points">228</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543508"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543368">
          <h3>
            <a
              class="item"
              href="https://www.independent.co.uk/news/health/arizona-plague-death-cases-b2787325.html"
              >Arizona resident dies from the plague less than 24 hours after
              showing symptoms</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 17:05:14</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543368"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543240">
          <h3>
            <a
              class="item"
              href="https://inventwithpython.com/blog/lost-av-chapter.html"
              >Lost Chapter of Automate the Boring Stuff: Audio, Video, and
              Webcams in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 16:45:45</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543240"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543156">
          <h3>
            <a
              class="item"
              href="https://github.com/efecan0/binaryrpc-framework"
              >Show HN: BinaryRPC – Lightweight WebSocket-based RPC framework in
              modern C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 16:32:12</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543156"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’m a recent CS graduate. During the past few months I wrote
                BinaryRPC, an open-source RPC framework in modern C++20 focused
                on low-latency, binary WebSocket messaging.
              </p>
              <p>
                Why I built it * Wanted first-class session support, pluggable
                QoS levels and a simple middleware chain (global, specific,
                multi handler) without extra JSON/XML parsing. * Easy developer
                experience
              </p>
              <p>
                A quick feature list * Binary WebSocket frames – minimal
                overhead * Built-in session layer (login / reconnect /
                heartbeat) * QoS1 / QoS2 with automatic ACK &amp; retry * Plugin
                system – rooms, msgpack, etc. can be added in one line *
                Thread-safe core: RAII + folly
              </p>
              <p>
                Still early (solo project), so any feedback on design,
                concurrency model or missing must-have features would help a
                lot.
              </p>
              <p>Thanks for reading!</p>
              <p>
                also see "Chat Server in 5 Minutes with BinaryRPC":
                <a
                  href="https://medium.com/@efecanerdem0907/building-a-chat-server-in-5-minutes-with-binaryrpc-qos2-session-management-and-room-plugin-ccb66d722466"
                  >https://medium.com/@efecanerdem0907/building-a-chat-server-i...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44543150">
          <h3>
            <a
              class="item"
              href="https://skyandtelescope.org/astronomy-news/proposed-noaa-budget-kills-program-to-prevent-satellite-collisions/"
              >Proposed NOAA Budget Kills Program Designed to Prevent Satellite
              Collisions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 16:31:03</span
              ><span class="points-container"
                >Points: <span class="points">303</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543150"
                  >Comments</a
                ><span class="descendants">: 178</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44542880">
          <h3>
            <a
              class="item"
              href="https://atomic14.substack.com/p/vibe-coding-a-pcb-surprisingly-good"
              >Vibe-Coding a PCB – surprisingly good</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 15:47:26</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44542880"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44542578">
          <h3>
            <a class="item" href="https://www.designarena.ai/"
              >Show HN: DesignArena – crowdsourced benchmark for AI-generated
              UI/UX</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 15:07:46</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44542578"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.designarena.ai/vote"
                >https://www.designarena.ai/vote</a
              >
              <p>
                /vote: Your prompt will be answered by four random, anonymous
                models. You pick the one you prefer and crown the winner,
                tournament-style.
              </p>
              <p>
                /leaderboard: See the current winning models, as dictated by
                voter preferences.
              </p>
              <p>
                /play: Iterate quickly by seeing four models respond to the same
                input and pressing space to regenerate the results you don’t
                lock-in.
              </p>
              <p>
                We were especially impressed with the quality of DeepSeek and
                Grok, and variance between categories (To judge by the results
                so far, OpenAI is very good for game dev, but seems to suck
                everywhere else).
              </p>
              <p>
                We’ve learned a lot, and are curious to hear your comments and
                questions. Excited to make this better!
              </p>
            </div>
          </section>
        </section>
        <section id="44541576">
          <h3>
            <a
              class="item"
              href="https://nautil.us/is-this-new-swim-stroke-the-fastest-yet-235511/"
              >The fish kick may be the fastest subsurface swim stroke yet
              (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 12:25:28</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44541576"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44541565">
          <h3>
            <a
              class="item"
              href="https://jollygoodsw.wordpress.com/2025/03/13/working-through-writing-a-c-compiler/"
              >Working through 'Writing A C Compiler'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 12:23:33</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44541565"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44541458">
          <h3>
            <a class="item" href="https://sievedata.com/about/jobs"
              >Sieve (YC X25) is hiring researchers to build large video
              datasets for AI labs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 12:00:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44540402">
          <h3>
            <a
              class="item"
              href="https://blog.decryption.net.au/posts/macpaint.html"
              >MacPaint Art from the Mid-80s Still Looks Great Today</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 08:45:15</span
              ><span class="points-container"
                >Points: <span class="points">766</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44540402"
                  >Comments</a
                ><span class="descendants">: 171</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44540241">
          <h3>
            <a class="item" href="https://jsdate.wtf"
              >New Date("wtf") – How well do you know JavaScript's Date
              class?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 08:14:02</span
              ><span class="points-container"
                >Points: <span class="points">282</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44540241"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44539879">
          <h3>
            <a
              class="item"
              href="https://patchstack.com/articles/critical-malware-found-in-gravityforms-official-plugin-site/"
              >Malware found in official gravityforms plugin indicating supply
              chain breach</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 06:41:59</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44539879"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44537631">
          <h3>
            <a
              class="item"
              href="https://www.ty-penguin.org.uk/~auj/blog/2025/03/25/fake-jpeg/"
              >Faking a JPEG</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 22:57:25</span
              ><span class="points-container"
                >Points: <span class="points">377</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44537631"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44536988">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/openai/705999/google-windsurf-ceo-openai"
              >OpenAI’s Windsurf deal is off, and Windsurf’s CEO is going to
              Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 21:35:31</span
              ><span class="points-container"
                >Points: <span class="points">958</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44536988"
                  >Comments</a
                ><span class="descendants">: 617</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44536459">
          <h3>
            <a class="item" href="https://www.bbc.co.uk/news/live/cx20p2x9093t"
              >Preliminary report into Air India crash released</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 20:23:18</span
              ><span class="points-container"
                >Points: <span class="points">372</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44536459"
                  >Comments</a
                ><span class="descendants">: 739</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://aaib.gov.in/What%27s%20New%20Assets/Preliminary%20Report%20VT-ANB.pdf"
                >https://aaib.gov.in/What%27s%20New%20Assets/Preliminary%20Re...</a
              >
            </div>
          </section>
        </section>
        <section id="44535637">
          <h3>
            <a
              class="item"
              href="https://ethz.ch/en/news-and-events/eth-news/news/2025/07/a-language-model-built-for-the-public-good.html"
              >ETH Zurich and EPFL to release a LLM developed on public
              infrastructure</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 18:45:10</span
              ><span class="points-container"
                >Points: <span class="points">655</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44535637"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44516055">
          <h3>
            <a
              class="item"
              href="https://walkmontreal.com/curiosities/depanneurs/"
              >Dépanneurs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 00:22:17</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44516055"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44514559">
          <h3>
            <a
              class="item"
              href="https://www.tbray.org/ongoing/When/202x/2025/07/07/Epsilon-Wrangling"
              >QRS: Epsilon Wrangling</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 20:45:19</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44514559"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44508726">
          <h3>
            <a class="item" href="https://github.com/Nonannet/pyhoff"
              >Show HN: Pyhoff – Connect Python ML Models to Beckhoff/WAGO IO
              Hardware</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 11:33:09</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44508726"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'd love to hear your use cases, feature ideas and PLC toolchain
                stories ;)
              </p>
              <p>
                Docs:
                <a href="https://nonannet.github.io/pyhoff"
                  >https://nonannet.github.io/pyhoff</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44508580">
          <h3>
            <a
              class="item"
              href="https://www.gutenberg.org/files/32032/32032-h/32032-h.htm"
              >Second Variety, by Philip K. Dick</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 11:14:14</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44508580"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44508068">
          <h3>
            <a
              class="item"
              href="https://nlp.elvissaravia.com/p/context-engineering-guide"
              >Context Engineering Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 09:59:48</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44508068"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44507799">
          <h3>
            <a
              class="item"
              href="https://erisa.dev/exposing-a-web-service-with-cloudflare-tunnel/"
              >Exposing a web service with Cloudflare Tunnel (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 09:08:34</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44507799"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44501417">
          <h3>
            <a
              class="item"
              href="https://bradley.chatha.dev/blog/linux-speedrun-timer-dlang/post/"
              >Making a Speedrun Timer in D</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 16:14:02</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44501417"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44500815">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/c89e872jdjxo"
              >First malaria treatment for babies approved for use</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 15:16:33</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44500815"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
