<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36305271">
          <h3>
            <a class="item" href="https://hackcompute.com/hacking-epp-servers/"
              >Hacking root EPP servers to take control of zones</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 04:22:46</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36305271"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36304979">
          <h3>
            <a class="item" href="https://waabi.ai/oyster/"
              >Oyster: Towards Unsupervised Object Detection from Lidar Point
              Clouds</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 03:48:31</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36304979"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36304716">
          <h3>
            <a class="item" href="https://snap-research.github.io/SnapFusion/"
              >SnapFusion: Text-to-Image Diffusion Model on Mobile Devices
              Within Two Seconds</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 03:16:07</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36304716"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36304685">
          <h3>
            <a
              class="item"
              href="https://www.dkriesel.com/en/blog/2013/0802_xerox-workcentres_are_switching_written_numbers_when_scanning"
              >Xerox scanners randomly alter numbers in scanned documents
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 03:11:00</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36304685"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36304143">
          <h3>
            <a
              class="item"
              href="https://github.com/ggerganov/llama.cpp/pull/1827"
              >Llama.cpp: Full CUDA GPU Acceleration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 01:55:08</span
              ><span class="points-container"
                >Points: <span class="points">396</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36304143"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36303955">
          <h3>
            <a class="item" href="https://vintagenatgeographic.tumblr.com/"
              >Vintage National Geographic Photos</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 01:30:22</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36303955"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36303371">
          <h3>
            <a class="item" href="https://apps.apple.com/us/story/id1435835881"
              >BBEdit: Where Respect Is Due</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 00:23:14</span
              ><span class="points-container"
                >Points: <span class="points">406</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36303371"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36302805">
          <h3>
            <a
              class="item"
              href="https://github.com/mackyle/sqlite/blob/18cf47156abe94255ae1495ba2da84517dce6081/src/os.h"
              >Why sqlite3 temp files were renamed 'etilqs_*' (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 23:20:28</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36302805"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36302448">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/a-new-experiment-casts-doubt-on-the-leading-theory-of-the-nucleus-20230612/"
              >A new experiment casts doubt on the leading theory of the
              nucleus</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 22:49:35</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36302448"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36302231">
          <h3>
            <a
              class="item"
              href="https://newsletter.mollywhite.net/p/but-the-sec-let-us-go-public-and"
              >“But the SEC let us go public” and other flawed arguments in
              Coinbase's defense</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 22:32:12</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36302231"
                  >Comments</a
                ><span class="descendants">: 304</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36302002">
          <h3>
            <a
              class="item"
              href="https://ericwbailey.website/published/dont-use-custom-css-scrollbars/"
              >Don't use custom CSS scrollbars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 22:12:39</span
              ><span class="points-container"
                >Points: <span class="points">258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36302002"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36301974">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/food/article/anchor-brewing-co-ends-national-distribution-18148141.php"
              >Anchor Brewing Company ends national distribution, kills
              Christmas Ale</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 22:09:45</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36301974"
                  >Comments</a
                ><span class="descendants">: 231</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36301758">
          <h3>
            <a
              class="item"
              href="https://sashachapin.substack.com/p/in-praise-of-blowing-up-your-life"
              >In praise of blowing up your life</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 21:54:16</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36301758"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36301337">
          <h3>
            <a class="item" href="https://zsync.xyz/"
              >Show HN: Zsync, a Reddit Alternative with the Goal to Reward
              Quality Comments</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 21:21:33</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36301337"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
            <div class="text">
              <p>
                The main goal of zsync is to foster high quality content and
                discussion. That's it. If it can't accomplish that, then to me
                it is a failure. I watched Reddit go from having high quality
                discussion in 2008-9 to devolving into the PC meme dumpster it
                is today [1]. HN still has the highest discussion quality of any
                "forum" I know of, but (1) it can sometimes randomly be very
                hostile/toxic to new tech, the most glaring example being
                crypto. (2) HN is basically a single subreddit mostly geared
                towards tech and startups. It'd be nice to have an equivalent of
                "subreddits"
              </p>
              <p>
                Zsync's version of subreddits are tags. You can tag your posts.
                Instead of viewing a subreddit for, let's say neuroscience, you
                view the tag for neuroscience. This eliminates the need to
                submit the same post multiple times to many different
                subreddits.
              </p>
              <p>
                The core challenge is incentivizing/rewarding high quality
                content (I don't believe in censorship). Users can have custom
                avatars and links to their personal website and Twitter next to
                their username, which I believe provides a little more incentive
                to write a more thoughtful comment vs. your post merely showing
                up next to an anonymous handle with some autogenerated alien
                avatar (which you're free to still do if you prefer).
              </p>
              <p>
                Anyone who connects an ethereum wallet to their account will
                also have a (non-invasive) "Tip" option at the bottom of their
                comment, allowing anyone to directly tip commenters
                cryptocurrency (no middleman taking a cut here), offering a
                financial incentive. I was thinking of some other ideas to use
                crypto to reward quality, but I wouldn't want to implement
                anything that could be gamed or exploited ultimately defeating
                its purpose. Open to ideas though.
              </p>
              <p>
                In the future, we could use ML to offer options to sort comments
                in more useful ways, such as by sorting by "most insightful". We
                could determine based on your upvote history the type of content
                you'd be most likely to enjoy. Anyways I admittedly didn't
                implement this ML stuff yet, those are just ideas for future
                improvement.
              </p>
              <p>
                Anyways would love to hear your thoughts. What do you think of
                this idea, and what would it take to accomplish its mission?
                Regardless of whether my little project amounts to anything or
                not, I hope something like this will be made to exist. And thank
                you HN for not deteriorating in quality even remotely to the
                extent that Reddit has. It was really sad watching Reddit
                devolve into what it is today (way before all this recent
                stuff). We can do better, and now is a better time than ever to
                shake up the status quo and start envisioning what better
                platforms for online communities can look like.
              </p>
              <p>
                [1]
                <a
                  href="https://jsavage.xyz/2022/03/13/the-downfall-of-reddit-why-reddit-sucks-and-how-to-fix-it/"
                  >https://jsavage.xyz/2022/03/13/the-downfall-of-reddit-why-re...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36301276">
          <h3>
            <a
              class="item"
              href="https://www.robkhenderson.com/p/what-is-social-status"
              >What is Social Status?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 21:17:25</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36301276"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36300958">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2023/06/08/us-patent-office-proposes-rule-to-make-it-much-harder-to-kill-bad-patents/"
              >US Patent Office proposes rule to make it much harder to kill bad
              patents</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 20:55:03</span
              ><span class="points-container"
                >Points: <span class="points">463</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36300958"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36300539">
          <h3>
            <a
              class="item"
              href="https://benjcal.space/posts/the-adventures-of-writing-a-chip8-emulator-part-1/"
              >The Adventures of Writing a CHIP8 Emulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 20:28:50</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36300539"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36300439">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/podcast/episode/mdma-moves-from-club-drug-to-real-therapy/"
              >MDMA moves from club drug to real therapy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 20:22:40</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36300439"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36300410">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/odni-commercially-available-information-report/"
              >The US government is buying troves of data about Americans</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 20:21:08</span
              ><span class="points-container"
                >Points: <span class="points">402</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36300410"
                  >Comments</a
                ><span class="descendants">: 191</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36299543">
          <h3>
            <a
              class="item"
              href="https://spritely.institute/news/hoot-wireworld-live-in-browser.html"
              >Lisp Game Jam – “Wireworld” in WebAssembly Using Spritely's Hoot
              Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 19:25:01</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36299543"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36299246">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2306.02707"
              >Orca: Progressive Learning from Complex Explanation Traces of
              GPT-4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 19:04:59</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36299246"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36299029">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-06-extinct-world.html"
              >Remains of an extinct world of organisms discovered</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 18:52:52</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36299029"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36298962">
          <h3>
            <a
              class="item"
              href="https://social.treehouse.systems/@marcan/110494017883893557"
              >Apple Silicon Mac Pro uses PCIe switches to support all slots</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 18:48:53</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36298962"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36298953">
          <h3>
            <a
              class="item"
              href="https://www.space.com/tatooine-exoplanet-binary-systeim-twin-suns"
              >New exoplanet found orbiting twin suns</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 18:48:26</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36298953"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36298038">
          <h3>
            <a
              class="item"
              href="https://paulrobertlloyd.com/2023/162/a1/css_day/"
              >The continuing tragedy of CSS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 17:59:34</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36298038"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36297476">
          <h3>
            <a class="item" href="https://justine.lol/sorting/"
              >Understanding DeepMind's sorting algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 17:30:54</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36297476"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36296882">
          <h3>
            <a
              class="item"
              href="https://www.marginalia.nu/log/82_killing_community"
              >Killing Community</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 17:02:59</span
              ><span class="points-container"
                >Points: <span class="points">455</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36296882"
                  >Comments</a
                ><span class="descendants">: 305</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36296695">
          <h3>
            <a class="item" href="https://non.io"
              >Show HN: Non.io, a Reddit-like platform Ive been working on for
              the last 4 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 16:54:38</span
              ><span class="points-container"
                >Points: <span class="points">1728</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36296695"
                  >Comments</a
                ><span class="descendants">: 518</span></span
              >
            </h4>
            <div class="text">
              <p>How non.io works:</p>
              <p>1. Free to browse, paid to interact.</p>
              <p>
                2. Minimum subscription is $2 (though you can choose more). I
                take $1 to run the servers, everything left gets split evenly
                between everything you upvote that month.
              </p>
              <p>
                It's a simple model, but I hope it's a better one than the
                freemium model we've been relying on for the last few years.
                Fundamentally I feel like any ad-supported network doesn't have
                alignment between the needs of the users and the needs of the
                platform, which is what drove me to make this.
              </p>
              <p>
                Because this is a soft launch, if you do subscribe I'd encourage
                you <i>not</i> to pay for the time being. I'm still testing the
                distribution algorithm for returning funds - you won't get
                overcharged or anything, but I just want to guarantee your funds
                are properly distributed at the end of the month. I've opened up
                free accounts to post and interact in the meantime. If you want
                to try a test account, use this login:
              </p>
              <p>login: hackernews pw: helloworld</p>
              <p>
                Edit: Loginless browsing here:
                <a href="https://non.io/#all">https://non.io/#all</a>
              </p>
              <p>If you want to browse the code or the api:</p>
              <p><a href="https://api.non.io">https://api.non.io</a></p>
              <p>
                <a href="https://github.com/jjcm/nonio"
                  >https://github.com/jjcm/nonio</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36289682">
          <h3>
            <a
              class="item"
              href="https://www.hackster.io/news/miniature-macintosh-with-raspberry-pi-cbff147ed047"
              >Miniature Macintosh with Raspberry Pi</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 07:31:50</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36289682"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36289580">
          <h3>
            <a
              class="item"
              href="https://underjord.io/scripting-with-elixir.html"
              >Scripting with Elixir</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 07:20:18</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36289580"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
