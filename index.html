<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40809926">
          <h3>
            <a
              class="item"
              href="https://www.chinadaily.com.cn/a/202406/25/WS667a5675a31095c51c50ab4d.html"
              >CATL electric plane to support 2000 km (1200 miles) flight</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 12:49:10</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40809926"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40809924">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-024-07522-w"
              >Language is primarily a tool for communication rather than
              thought</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 12:49:09</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40809924"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40809889">
          <h3>
            <a
              class="item"
              href="https://www.fortinet.com/blog/threat-research/growing-threat-of-malware-concealed-behind-cloud-services"
              >The Growing Threat of Malware Concealed Behind Cloud Services</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 12:46:07</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40809889"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40809641">
          <h3>
            <a
              class="item"
              href="https://www.caranddriver.com/news/a61423917/rimac-autonomous-verne-robotaxi/"
              >Hypercar Maker Rimac Reveals the Fully Autonomous Verne
              Robotaxi</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 12:13:11</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40809641"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40809457">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/hawaii/article/hawaii-home-built-on-wrong-lot-to-be-torn-down-19541255.php"
              >Hawaii home mistakenly built on Bay Area woman's land to be torn
              down</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 11:47:54</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40809457"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40809301">
          <h3>
            <a
              class="item"
              href="https://gothamist.com/news/why-it-takes-nyc-nearly-10-years-to-install-500-feet-of-pipes"
              >Why it takes NYC nearly 10 years to install 500 feet of pipes –
              Gothamist</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 11:23:05</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40809301"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40809276">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/transport/cargo-conveyor-auto-logistics/"
              >310-mile automated cargo conveyor will replace 25,000 trucks in
              Japan</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 11:17:46</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40809276"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40809069">
          <h3>
            <a
              class="item"
              href="https://www.karlsnotes.com/fuggerei-the-worlds-first-public-housing/"
              >The Fuggerei – the world’s first public housing (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 10:38:51</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40809069"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40809033">
          <h3>
            <a
              class="item"
              href="https://mlops.systems/posts/2024-06-25-evaluation-finetuning-manual-dataset.html"
              >How to think about creating a dataset for LLM fine-tuning
              evaluation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 10:29:06</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40809033"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40808999">
          <h3>
            <a class="item" href="https://backprop.co/environments/open-sora"
              >Open-Sora does pretty good video generation on consumer GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 10:20:40</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40808999"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40808979">
          <h3>
            <a
              class="item"
              href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n3280.htm"
              >The C Standard charter was updated, now with security principles
              as well</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 10:16:50</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40808979"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40808969">
          <h3>
            <a class="item" href="https://dashboard.flowfuse.com/"
              >Dashboard and UIs for Node-Red</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 10:13:43</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40808969"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40808933">
          <h3>
            <a
              class="item"
              href="https://www.ams.org/notices/199701/comm-rota.pdf"
              >Ten Lessons I Wish I Had Been Taught [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 10:06:18</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40808933"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40808820">
          <h3>
            <a
              class="item"
              href="https://web.dev/case-studies/google-sheets-wasmgc"
              >Why Google Sheets ported its calculation worker from JavaScript
              to WasmGC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 09:34:09</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40808820"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40808808">
          <h3>
            <a
              class="item"
              href="https://www.lawgazette.co.uk/news/post-office-lawyers-held-secret-meeting-with-judge-to-stop-disclosure/5119593.article"
              >Post Office lawyers held secret meeting with judge to stop
              disclosure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 09:31:56</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40808808"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40808110">
          <h3>
            <a
              class="item"
              href="https://coryrylan.com/blog/flow-charts-with-css-anchor-positioning"
              >Flow Charts with CSS Anchor Positioning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 07:07:08</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40808110"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40807923">
          <h3>
            <a
              class="item"
              href="https://lars.ingebrigtsen.no/2024/06/26/a-new-package-for-making-charts-in-emacs-eplot/"
              >Eplot: A new package for making charts in Emacs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 06:33:44</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40807923"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40806356">
          <h3>
            <a
              class="item"
              href="https://www.readmargins.com/p/doordash-and-pizza-arbitrage"
              >DoorDash and Pizza Arbitrage (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 01:16:52</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40806356"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40805351">
          <h3>
            <a class="item" href="https://github.com/corcel/corcel"
              >Corcel – Use WordPress backend with Laravel or any PHP
              application</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 22:33:59</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40805351"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40804489">
          <h3>
            <a
              class="item"
              href="https://www.govexec.com/pay-benefits/2024/06/federal-whistleblowers-are-entitled-damages-missed-future-pay-court-rules/397638/"
              >Federal whistleblowers are entitled to damages of missed future
              pay, court rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 20:54:08</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40804489"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40804122">
          <h3>
            <a class="item" href="http://mynor.org/my4th_forthdeck.htm"
              >The Forth Deck mini: a portable Forth computer with a discrete
              CPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 20:12:31</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40804122"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40803783">
          <h3>
            <a class="item" href="https://fabric8labs.com"
              >Next gen 3D metal printing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 19:41:14</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40803783"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40802676">
          <h3>
            <a class="item" href="https://www.figma.com/slides/"
              >Figma Slides</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 18:04:34</span
              ><span class="points-container"
                >Points: <span class="points">407</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40802676"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40802557">
          <h3>
            <a class="item" href="https://alpha.reconquer.online"
              >Show HN: I built an indie, browser-based MMORPG</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 17:53:22</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40802557"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
            <div class="text">
              <p>Here are the major open source technologies that I use:</p>
              <p>
                Blender - 3D modeling software for creating the overall
                environment and every game object. I've gotten a lot of CC and
                Public Domain assets from
                <a href="https://poly.pizza">https://poly.pizza</a>
              </p>
              <p>
                GLTF - I export assets from blender to the GLTF asset format
              </p>
              <p>
                JSON - I write a JSON config for every game object that
                describes things like its name, its interactions, its
                collisions, etc.
              </p>
              <p>
                Node.js exporter - I iterate over the environment and every
                asset to create a scene hierarchy. I use gltf-transform for
                processing all GLTF files, compressing them, removing
                redundancies, etc.
              </p>
              <p>
                Node.js server - Uses express and socket.io to process game
                state updates. It keeps track of every client's game state and
                issues delta's at each game tick (currently 600ms). The client
                can send interactions with different objects. The server
                validates those and updates the game state accordingly.
              </p>
              <p>
                HTML/CSS/JavaScript/Three.js client - I use regular web
                technologies for the UI elements and three.js for the 3D rending
                on the browser. The client is responsible for rending the world
                state and providing the client with different interactions. All
                code is written in JavaScript which means less context
                switching. Performance seems to be good enough, and I figure I
                can always optimize the server code in C++ if necessary.
              </p>
              <p>
                I am currently running two cheap shared instances but based on
                my testing, they can likely support about 200 users each. This
                is a low-poly browser based game so it should be compatible
                across many devices. The data a user needs to download to play,
                including all 3d assets, is approximately 2 MB, even though
                there are hundreds of assets.
              </p>
              <p>
                Overall, it's been a fun project. Web development and open
                source software have progressed to the point that this is no
                longer an incredibly difficult feat. I feel like development is
                going pretty well and in a year or so there will be plenty of
                good content to play.
              </p>
            </div>
          </section>
        </section>
        <section id="40800869">
          <h3>
            <a class="item" href="https://onemillioncheckboxes.com/"
              >One Million Checkboxes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 15:02:38</span
              ><span class="points-container"
                >Points: <span class="points">840</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40800869"
                  >Comments</a
                ><span class="descendants">: 277</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40797763">
          <h3>
            <a class="item" href="https://susam.net/winpopup.html"
              >Winpopup (2001)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 08:42:16</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40797763"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40796770">
          <h3>
            <a
              class="item"
              href="https://onlinelibrary.wiley.com/doi/full/10.1002/adfm.202313516"
              >Tough and Ductile Architected Nacre-Like Cementitious
              Composites</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-26 @ 05:43:05</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40796770"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40774833">
          <h3>
            <a
              class="item"
              href="https://developers.redhat.com/articles/2022/09/17/gccs-new-fortification-level"
              >GCC's new fortification level: The gains and costs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 11:42:03</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40774833"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40769663">
          <h3>
            <a class="item" href="https://janmaarten.com/gaad-2023/"
              >Socks, Lies, and Accessibility</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-23 @ 18:53:23</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40769663"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40767676">
          <h3>
            <a
              class="item"
              href="https://blog.stuffedcow.net/2018/04/ras-microbenchmarks/"
              >Microbenchmarking Return Address Branch Prediction (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-23 @ 14:21:49</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40767676"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
