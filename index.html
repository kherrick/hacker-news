<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40623332">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40623332"
              >Tell HN: Domain migrated from Google to Squarespace went down
              after 1 month</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 10:10:33</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40623332"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                After more than 1 month, it randomly went down, at the worst
                time possible (the weekend, when it's the busiest time for my
                platform and when all the engineers are off). My company's main
                domain and email have been down for more than 12 hours and
                customer support is now asking for us to wait even more.
              </p>
              <p>
                Not very hopeful posting here will help, but thought people
                should know.
              </p>
              <p>Here's the timeline:</p>
              <p>
                (1) Saturday, 6PM UTC - our customers start reaching out that
                they cannot load our platform.
              </p>
              <p>
                DNS requests are returning `ns1.unknown-nameservers.com` and
                `ns2.unknown-nameservers.com` as the name servers.
              </p>
              <p>
                I send an email to from my personal inbox to my work inbox. It
                doesn't arrive. So not only my platform is down, most of our
                customer emails don't arrive too!
              </p>
              <p>
                Trying to access Squarespace account just shows a message that
                says "This account is currently unavailable. Please contact
                Customer Care."
              </p>
              <p>
                Panic ensues and me and my co-founder start trying to reach out
                to customer support via email, their helpdesk, Twitter,
                Facebook, Linkedin. Even have someone we know who knows a PM at
                Squarespace escalate our case.
              </p>
              <p>
                Squarespace says they have 24/7 support but we cannot get anyone
                to respond. Various Facebook and Twitter messages indicate that
                this happens to others too.
              </p>
              <p>
                (2) Saturday, 11:00 PM UTC - it's been 5 hours. Whatever users
                were able to access the platform will likely have had their DNS
                caches updated by now. My co-founder and I decide it's time to
                migrate to a different domain. So I spend the next 30 minutes
                deploying and updating third party services with our new domain
                name. I set up our voicemail to tell people to use the new
                domain while the main one is down. Hopefully they will find our
                number even if the main domain is down.
              </p>
              <p>
                (3) Saturday, 11:30 PM UTC - Squarespace still has not responded
                on any of the channels. But now I notice they changed the name
                server to `ns-cloud-a1.googledomains.com.`. That's almost
                correct, but before they were randomly changed by Squarespace,
                they actually were `ns-cloud-e1.googledomains.com.` (with e
                instead of a)
              </p>
              <p>
                Next 30 minutes I spend playing the lottery: I keep creating new
                Cloud DNS zones on GCP hoping that it would be assigned
                `ns-cloud-a1.googledomains.com.` as the name server (instead of
                b1, c1, e1 or d1). No luck. Seems GCP is now reserving
                `ns-cloud-a1.googledomains.com.` so I will need Squarespace to
                undo whatever they did for this to work.
              </p>
              <p>
                I then send GCP an email asking them to create us a zone with
                `ns-cloud-a1.googledomains.com.` name server. It seems like
                their API for creating zones has a parameter called
                nameServerSets which may help (but the parameter documentation
                says to contact account manager if we want to use it).
              </p>
              <p>
                (4) Sunday, 01:10 AM UTC - Squarespace finally responds on
                Facebook and Twitter. They suggest
                `ns-cloud-a1.googledomains.com.` is a default Squarespace name
                server and that it shouldn't matter whether it's e1 or a1.
              </p>
              <p>
                They say it doesn't matter, but they refuse to change it back.
              </p>
              <p>
                What's even more frustrating is that I can run `dig
                @ns-cloud-a1.googledomains.com mydomain.com` and `dig
                @ns-cloud-e1.googledomains.com mydomain.com` and see that the
                former doesn't work and the latter does work.
              </p>
              <p>
                They send me a form to submit for account recovery. I submit the
                form.
              </p>
              <p>
                (5) Sunday, 02:05 AM UTC - Squarespace responds via email to the
                form I submitted to gain access to my account. They say it will
                take 1 business day to get a response.
              </p>
              <p>
                (6) Sunday, 10:00 AM UTC - I managed to get some sleep.
                Squarespace is not responding. All the while thousands of
                customers are not able to access our platform and missing out on
                their sales. At least now that I know I've exhausted all the
                options, I can write this rant.
              </p>
            </div>
          </section>
        </section>
        <section id="40622799">
          <h3>
            <a
              class="item"
              href="https://diamondgeezer.blogspot.com/2024/06/londons-high-streets.html"
              >How many High Streets are there in London?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 08:10:23</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40622799"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40622759">
          <h3>
            <a class="item" href="https://www.williamhalaw.com/post/8/"
              >Remember When You Named Your Girlfriend as a Beneficiary? He
              Didn't Either</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 08:00:47</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40622759"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40622704">
          <h3>
            <a class="item" href="https://github.com/piku/piku"
              >piku: The tiniest PaaS you've ever seen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 07:40:25</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40622704"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40622189">
          <h3>
            <a class="item" href="https://betula.mycorrhiza.wiki/"
              >Betula – federated bookmarking software for the independent
              web</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 05:07:06</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40622189"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40622022">
          <h3>
            <a class="item" href="https://decentpatterns.com/"
              >Decent Patterns</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 04:22:39</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40622022"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40621534">
          <h3>
            <a
              class="item"
              href="https://www.downtowndougbrown.com/2024/06/fixing-a-knockoff-altera-usb-blaster-that-never-worked/"
              >Fixing a knockoff Altera USB Blaster that never worked</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 02:13:49</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40621534"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40621085">
          <h3>
            <a class="item" href="https://teodev.io"
              >Next-generation web framework Teo, supports Node.js, Python and
              Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 00:32:09</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40621085"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40620955">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2406.02528"
              >Scalable MatMul-Free Language Modeling</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 00:00:48</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40620955"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40620739">
          <h3>
            <a
              class="item"
              href="https://www.ox.ac.uk/news/2024-06-07-sildenafil-viagra-improves-brain-blood-flow-and-could-help-prevent-dementia"
              >Viagra improves brain blood flow and could help to prevent
              dementia</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 22:55:13</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40620739"
                  >Comments</a
                ><span class="descendants">: 190</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40620472">
          <h3>
            <a class="item" href="https://joshdata.me/iceberger.html"
              >Draw an iceberg and see how it will float</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 22:04:24</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40620472"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40620056">
          <h3>
            <a
              class="item"
              href="https://cosmosmagazine.com/science/biology/gene-therapy-restores-hearing-to-children-with-inherited-deafness/"
              >Gene therapy restores hearing to children with inherited
              deafness</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 20:40:16</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40620056"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40620048">
          <h3>
            <a class="item" href="https://www.bbc.com/news/business-38905963"
              >What makes gambling wrong but insurance right? (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 20:37:58</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40620048"
                  >Comments</a
                ><span class="descendants">: 196</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40619752">
          <h3>
            <a
              class="item"
              href="https://mas-bandwidth.com/creating-a-matchmaker-for-your-multiplayer-game/"
              >Creating a matchmaker for your multiplayer game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 19:38:53</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40619752"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40618766">
          <h3>
            <a
              class="item"
              href="https://omarshehata.substack.com/p/my-favorite-1980s-canadian-tv-show"
              >My favorite 1980's Canadian TV show: Bits and Bytes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 16:43:46</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40618766"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40618459">
          <h3>
            <a class="item" href="https://fobes.dev/ps2/detecting-emu-vu-floats"
              >Detecting a PS2 Emulator: When 1*X does not equal X</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 16:05:45</span
              ><span class="points-container"
                >Points: <span class="points">258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40618459"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40618079">
          <h3>
            <a
              class="item"
              href="https://blog.archive.org/2024/06/01/the-backrooms-of-the-internet-archive/"
              >The Backrooms of the Internet Archive</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 15:17:53</span
              ><span class="points-container"
                >Points: <span class="points">581</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40618079"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40617082">
          <h3>
            <a class="item" href="https://github.com/SilasMarvin/lsp-ai"
              >LSP-AI: open-source language server serving as back end for AI
              code assistance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 12:24:58</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40617082"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40616966">
          <h3>
            <a class="item" href="https://ieeexplore.ieee.org/document/9520328"
              >Garbage collect your technical debt (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 11:54:08</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40616966"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40616778">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-05-tiny-fern-largest-genome-earth.html"
              >Tiny fern has the largest genome of any organism on Earth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 11:02:32</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40616778"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40616632">
          <h3>
            <a
              class="item"
              href="https://hamatti.org/posts/what-does-it-feel-like-to-read-rss-feeds/"
              >What does it feel like to read RSS feeds?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 10:31:19</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40616632"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40616504">
          <h3>
            <a
              class="item"
              href="https://starkeblog.com/bios/menuetos/2022/09/22/reverse-engineering-menuetos.html"
              >StarkeBlog – Reverse Engineering MenuetOS 64 – Primary Boot
              Loader</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 10:01:56</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40616504"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40615808">
          <h3>
            <a class="item" href="https://mion.yosei.fi/BES/"
              >BES – OSS Windows software to control per-process CPU usage</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 06:58:36</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40615808"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40615708">
          <h3>
            <a
              class="item"
              href="https://webdeveloper.beehiiv.com/p/opensourced-keyecho-fastresponsive-keyboard-sounds-every-keystroke-using-tauri"
              >I Open-Sourced KeyEcho: Fast-Responsive Keyboard Sounds with
              Every Keystroke</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 06:30:57</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40615708"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40615666">
          <h3>
            <a
              class="item"
              href="http://msinilo.pl/blog2/post/compilers-are-too-smart/"
              >Compilers Are (Too) Smart</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 06:18:04</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40615666"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40609753">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/in-highly-connected-networks-theres-always-a-loop-20240607/"
              >In highly connected networks, there's always a loop</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-07 @ 15:45:09</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40609753"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40608555">
          <h3>
            <a class="item" href="https://vulkan-tutorial.com/"
              >Vulkan Tutorial</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-07 @ 13:34:01</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40608555"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40607897">
          <h3>
            <a
              class="item"
              href="https://makegathergrow.com/blog/regenerative-no-till-gardening"
              >The regenerative urban garden I: No-till gardening</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-07 @ 12:11:17</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40607897"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40601098">
          <h3>
            <a class="item" href="https://queue.acm.org/detail.cfm?id=3664645"
              >Zero Tolerance for Bias</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 18:58:20</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40601098"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40597904">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/06/06/arts/film-photography-negatives.html"
              >The Lost Art of the Negative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 14:35:09</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40597904"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
