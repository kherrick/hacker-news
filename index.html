<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35652852">
          <h3>
            <a
              class="item"
              href="https://www.undeadly.org/cgi?action=article;sid=20230421124221"
              >OpenBSD: Viogpu(4), a VirtIO GPU driver, added to -current</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 12:42:52</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35652852"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35652733">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2023/04/man-battling-google-wins-500k-for-search-result-links-calling-him-a-pedophile/"
              >Man battling Google wins $500K for search result links calling
              him a pedophile</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 12:31:07</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35652733"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35652655">
          <h3>
            <a
              class="item"
              href="https://joshuamo876.bearblog.dev/can-rust-beat-javascript-in-2023/"
              >Can Rust Beat JavaScript in 2023?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 12:23:36</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35652655"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35652541">
          <h3>
            <a class="item" href="https://revive-machines.com/index-en.html"
              >Atari 800XL Remake</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 12:11:03</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35652541"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35652452">
          <h3>
            <a class="item" href="https://www.giskard.ai/safegpt"
              >SafeGPT: New tool to detect LLMs' hallucinations, biases and
              privacy issues</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 11:59:45</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35652452"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35652444">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/interactive/science-and-technology/2023/04/22/large-creative-ai-models-will-transform-how-we-live-and-work"
              >Large, creative AI models will transform lives and labour
              markets</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 11:58:13</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35652444"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35652434">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/how-much-chatgpt-costs-openai-to-run-estimate-report-2023-4"
              >ChatGPT could cost over $700k per day to operate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 11:57:39</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35652434"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35651871">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/null-island-is-one-of-the-most-visited-places-on-earth-too-bad-it-doesnt-exist"
              >Null Island Is One of the Most Visited Places on Earth. Too Bad
              It Doesn’t Exist</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 10:32:50</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35651871"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35651791">
          <h3>
            <a class="item" href="https://github.com/realyixuan/gsubpy"
              >Show HN: Gsubpy, an interpreter for subset of Python, written in
              Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 10:17:32</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35651791"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              Recently, I write an interpreter for subset of Python using Go. I
              haven't seen source code of CPython, all is just written according
              to my understanding of Python so there may be some unusual things.
              Hope you can play fun with it. Any suggestion is welcome, glad to
              get some feedback.
            </div>
          </section>
        </section>
        <section id="35650699">
          <h3>
            <a class="item" href="https://president.mn/mng/"
              >Office of the President of Mongolia (top to bottom text on the
              web)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 07:20:07</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35650699"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35650663">
          <h3>
            <a
              class="item"
              href="https://inkscape.org/news/2023/04/17/inkscape-hiring-accelerating-gtk4-migration/"
              >Inkscape is hiring: Accelerating the GTK4 migration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 07:16:02</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35650663"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35650563">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/memfault/730541eb-637f-4d9d-9526-8949432f9a34"
              >Memfault (YC W19) Is Hiring Their First Product Designer in
              Berlin</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 07:00:07</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35649935">
          <h3>
            <a
              class="item"
              href="https://thedriven.io/2023/04/21/worlds-largest-battery-maker-announces-major-breakthrough-in-battery-density/"
              >World’s largest battery maker announces major breakthrough in
              energy density</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 04:54:39</span
              ><span class="points-container"
                >Points: <span class="points">520</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35649935"
                  >Comments</a
                ><span class="descendants">: 418</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35649729">
          <h3>
            <a class="item" href="https://guessthe.game">Guess the Game</a>
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 04:06:18</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35649729"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35649496">
          <h3>
            <a class="item" href="https://lxe.co/wasmgpt/"
              >Show HN: WasmGPT – “ChatGPT” in the browser, no WebGPU and no
              server needed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 03:24:43</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35649496"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <p>Tested in x86 Chrome and Firefox, Apple Silicon Safari</p>
              <p>
                Run it yourself:
                <a href="https://github.com/lxe/ggml/tree/wasm-demo"
                  >https://github.com/lxe/ggml/tree/wasm-demo</a
                >
              </p>
              <p>
                Thanks,
                <a href="https://github.com/ggerganov/ggml"
                  >https://github.com/ggerganov/ggml</a
                >,
              </p>
            </div>
          </section>
        </section>
        <section id="35649459">
          <h3>
            <a class="item" href="https://lwn.net/Articles/926882/"
              >Standardizing BPF</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 03:19:07</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35649459"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35649245">
          <h3>
            <a class="item" href="https://www.newgrounds.com/portal/view/881533"
              >Show HN: Thoughts on Flash in 2023, in Flash, in 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 02:48:05</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35649245"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
            <div class="text">
              Spent the past few days making this - something halfway between a
              demoscene program and an experimental film. I wanted to celebrate
              the unique computer-y aesthetics of flash, while showing off some
              weird and obscure tricks I've picked up over the years since it's
              been deprecated. (Also, some maybe-not-subtle commentary about
              AI-art and the tools of the future)
            </div>
          </section>
        </section>
        <section id="35648805">
          <h3>
            <a class="item" href="https://aolserver.github.io/"
              >AOLserver is America Online's Open-Source web server (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 01:28:24</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35648805"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35648544">
          <h3>
            <a class="item" href="https://www.kmeans.org/"
              >WebGPU GPT Model Demo</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 00:54:10</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35648544"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              <a href="https://twitter.com/willdepue/status/1649147091573432321"
                >https://twitter.com/willdepue/status/1649147091573432321</a
              >
            </div>
          </section>
        </section>
        <section id="35646199">
          <h3>
            <a class="item" href="https://x.st/spinning-diagrams-with-css/"
              >Spinning Diagrams with CSS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 20:57:54</span
              ><span class="points-container"
                >Points: <span class="points">845</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35646199"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35644468">
          <h3>
            <a
              class="item"
              href="https://kelteseth.com/post/20-04-2023-current-issues-with-the-qt-project-from-the-outside-looking-in/"
              >Current issues with the Qt project from the outside looking in</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 18:51:23</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35644468"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35643432">
          <h3>
            <a
              class="item"
              href="https://alexkondov.com/use-databases-without-putting-domain-logic-in-them/"
              >Use databases without putting domain logic in them</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 17:38:47</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35643432"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35640894">
          <h3>
            <a
              class="item"
              href="https://davidlaprade.github.io/give-a-lot-of-notice"
              >Career advice no one gave me: Give a lot of notice when you
              quit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 14:46:30</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35640894"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35639370">
          <h3>
            <a class="item" href="https://www.legittorrents.info/"
              >Shutting down my legal torrent site after 17 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 13:09:13</span
              ><span class="points-container"
                >Points: <span class="points">706</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35639370"
                  >Comments</a
                ><span class="descendants">: 367</span></span
              >
            </h4>
            <div class="text">
              I ran Legit Torrents for ~17 years and shut it down recently. The
              homepage is now a nostalgic look back at that time.
            </div>
          </section>
        </section>
        <section id="35636118">
          <h3>
            <a
              class="item"
              href="https://blogs.bl.uk/music/2023/03/preserving-bach.html"
              >Preserving Bach's Manuscripts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 03:42:46</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35636118"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35635654">
          <h3>
            <a
              class="item"
              href="https://zachsim.one/blog/2023/4/19/introducing-glucomate"
              >Glucomate: an app for people who record, track, and monitor their
              blood glucose</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 02:31:19</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35635654"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35634963">
          <h3>
            <a class="item" href="https://raag-hindustani.com/Rhythm.html"
              >Rhythm (taal) in Indian Classical Music (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 00:28:32</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35634963"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35633999">
          <h3>
            <a class="item" href="https://fictionalbrandsarchive.com/"
              >Fictional Brands Archive</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-19 @ 22:14:38</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35633999"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35633481">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-04-sharper-m87-black-hole.html"
              >Taking a sharper look at the M87 black hole</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-19 @ 21:21:37</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35633481"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35626891">
          <h3>
            <a
              class="item"
              href="https://www.vice.com/en/article/v7beyj/car-thieves-tech-hidden-old-nokia-phones-bluetooth-speakers-emergency-engine-start-keyless"
              >Car thieves using tech disguised inside old Nokia phones and
              Bluetooth speakers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-19 @ 11:33:55</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35626891"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
