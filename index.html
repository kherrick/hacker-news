<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38570732">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/12/8/23991092/homes-need-to-be-built-for-better-internet"
              >Homes need to be built for better internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 16:20:26</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570732"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38570677">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2023/12/08/judge-allows-major-right-to-repair-lawsuit-against-john-deere-to-move-forward/"
              >Judge Allows Major 'Right to Repair' Lawsuit Against John Deere
              to Move Forward</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 16:15:45</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570677"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38570624">
          <h3>
            <a class="item" href="https://www.warpbuild.com/"
              >Show HN: WarpBuild – x86-64 and arm GitHub Action runners for 30%
              faster builds</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 16:11:20</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570624"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                WarpBuild provides fast, secure `x86-64` and `arm64` Github
                actions runners. This speeds up your workloads by 30%, at half
                the cost, and takes ~2mins to get started.
              </p>
              <p>
                We’ve been seeing pretty good results since we opened up signups
                a week ago and I’ve shared some numbers publicly here [1].
              </p>
              <p>
                Currently, we support linux runners for Github organizations
                (not personal accounts) and MacOS support is coming soon (~Jan).
              </p>
              <p>
                The way the runners work is deceptively simple: Runners are
                assigned to hardware that is ideal for build workloads with fast
                NVMe disks and high single-core performance.
              </p>
              <p>
                The runners are allocated on VMs, not containers. This provides
                faster performance and enables use cases requiring (1) nested
                virtualization for running firecracker and other hypervisors,
                (2) k8s without relying on kind, and (3) Android emulators on
                `arm64` instances in test workflows.
              </p>
              <p>
                We also have released a Github Action called `Action-Debugger`
                that allows you to SSH into a running workflow for simplifying
                pesky debugging[2].
              </p>
              <p>
                The same set of packages that you’d get on Github hosted runners
                are pre-configured (on x86-64 runners) so everything works out
                of the box with no modifications needed.
              </p>
              <p>
                A very minor detail that I’m rather proud of, and I’d love your
                thoughts on improving it further, is the onboarding flow for the
                ease of moving workflows to WarpBuild. We’ve also put in a lot
                of effort into making the workflow start up time where we are as
                fast or faster than Github.
              </p>
              <p>
                [1]
                <a href="https://x.com/suryaoruganti/status/1732932591001735419"
                  >https://x.com/suryaoruganti/status/1732932591001735419</a
                >
                [2]
                <a href="https://github.com/WarpBuilds/action-debugger"
                  >https://github.com/WarpBuilds/action-debugger</a
                >, h/t to tmate
              </p>
              <p>
                Making builds faster by providing optimal hardware and
                configurations across CI providers is the first step in our
                mission to make build engineering better.
              </p>
              <p>
                I’d love your feedback on the product and thoughts on other CI
                pain points we could solve to enable better collaboration and
                developer experience.
              </p>
            </div>
          </section>
        </section>
        <section id="38570537">
          <h3>
            <a
              class="item"
              href="https://twitter.com/MistralAI/status/1733150512395038967"
              >Mistral "Mixtral" 8x7B 32k model [magnet]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 16:03:00</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570537"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38570110">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/features/2023-worlds-richest-families/"
              >The wealth of the 25 richest families in the world soared 43% in
              the last year</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 15:25:14</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570110"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38570035">
          <h3>
            <a
              class="item"
              href="https://www.akamai.com/blog/security-research/spoofing-dns-by-abusing-dhcp"
              >Spoofing DNS records abusing Microsoft DHCP server running in 40%
              of datacenters</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 15:18:50</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570035"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38569608">
          <h3>
            <a class="item" href="https://onyxlang.io/"
              >The Onyx Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 14:43:46</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38569608"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38569240">
          <h3>
            <a class="item" href="https://github.com/kellyjonbrazil/jc"
              >jc: Converts the output of popular command-line tools to JSON</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 14:12:03</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38569240"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38569129">
          <h3>
            <a class="item" href="https://www.nongnu.org/txr/txr-lisp.html"
              >TXR Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 14:02:06</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38569129"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38568468">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/ai/2023/12/the-real-research-behind-the-wild-rumors-about-openais-q-project/"
              >How to think about OpenAI's rumored (and overhyped) Q* project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 12:58:49</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38568468"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38568264">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2307.09444"
              >No distributed quantum advantage for approximate graph
              coloring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 12:35:28</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38568264"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38568252">
          <h3>
            <a
              class="item"
              href="https://supabase.com/blog/postgres-language-server-implementing-parser"
              >Postgres Language Server: Implementing the Parser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 12:33:41</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38568252"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38568121">
          <h3>
            <a
              class="item"
              href="https://forum.developer.samsung.com/t/test-confirmation-rejected-too-expensive/28238"
              >Problems on the Galaxy Store</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 12:19:15</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38568121"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38568076">
          <h3>
            <a
              class="item"
              href="https://archlinux.org/news/bugtracker-migration-to-gitlab-completed/"
              >Arch Linux bugtracker migration to Gitlab completed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 12:14:32</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38568076"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38567944">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/rollstack-2/jobs"
              >Rollstack (YC W23) is hiring a senior software engineer in
              Brazil</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 12:00:09</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38567687">
          <h3>
            <a
              class="item"
              href="https://badcyber.com/dieselgate-but-for-trains-some-heavyweight-hardware-hacking/"
              >Dieselgate, but for trains – some heavyweight hardware hacking</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 11:20:36</span
              ><span class="points-container"
                >Points: <span class="points">495</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38567687"
                  >Comments</a
                ><span class="descendants">: 197</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38567149">
          <h3>
            <a
              class="item"
              href="https://asset-group.github.io/disclosures/5ghoul/"
              >5Ghoul: 5G Modem Firmware CVEs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 09:51:36</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38567149"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38567074">
          <h3>
            <a
              class="item"
              href="https://yuelangx.github.io/gaussianheadavatar/"
              >Gaussian Head Avatar: Ultra High-Fidelity Head Avatar via Dynamic
              Gaussians</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 09:38:44</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38567074"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38566235">
          <h3>
            <a class="item" href="https://overreacted.io/goodbye-clean-code/"
              >Goodbye, clean code (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 07:12:15</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38566235"
                  >Comments</a
                ><span class="descendants">: 257</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38565629">
          <h3>
            <a
              class="item"
              href="https://sts10.github.io/2022/12/14/antix-on-2008-macbook-5-1.html"
              >Reviving decade-old Macs with antiX and MX Linux (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 04:59:34</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38565629"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38565314">
          <h3>
            <a
              class="item"
              href="https://staysaasy.com/management/2023/12/07/accelerating-product-velocity.html"
              >Practical Ways to Increase Product Velocity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 04:05:07</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38565314"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38564808">
          <h3>
            <a
              class="item"
              href="https://www.lighthousereports.com/methodology/how-we-investigated-frances-mass-profiling-machine/"
              >We investigated France's mass profiling machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 02:45:28</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38564808"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38564286">
          <h3>
            <a class="item" href="http://www.sol-1.org/index.php"
              >Show HN: Homebrew 16bit CPU from 74HC logic with C compiler and
              Unix-like OS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 01:32:39</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38564286"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">
              This is a 16bit CPU+Minicomputer from pure 74 series logic. It has
              user/kernel modes, virtual memory, prioritized IRQ's and DMA. It
              has a full C compiler and a unix-like OS. It's still in
              development.
            </div>
          </section>
        </section>
        <section id="38562939">
          <h3>
            <a
              class="item"
              href="https://www.astralcodexten.com/p/defying-cavity-lantern-bioworks-faq"
              >A genetically modified bacterium that outcompetes bacteria
              causing tooth decay</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-07 @ 22:55:44</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38562939"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38559607">
          <h3>
            <a class="item" href="https://daniel.do/article/making-noisy-svgs/"
              >Making noisy SVGs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-07 @ 18:04:56</span
              ><span class="points-container"
                >Points: <span class="points">449</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38559607"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38558423">
          <h3>
            <a
              class="item"
              href="https://twitter.com/laurenancona/status/1731900441800155459"
              >A lost X-Files song</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-07 @ 16:36:10</span
              ><span class="points-container"
                >Points: <span class="points">400</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38558423"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38555655">
          <h3>
            <a
              class="item"
              href="https://www.nagoya-u.ac.jp/researchinfo/result-en/2023/12/20231207-01.html"
              >Electric eel’s zap can transfer genes to nearby animals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-07 @ 12:36:01</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38555655"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38555294">
          <h3>
            <a
              class="item"
              href="https://medium.com/@yourfuse/exploring-quantum-computing-with-javascript-a-beginners-guide-d29a4af15ec7"
              >Exploring Quantum Computing with JavaScript: A Beginner's
              Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-07 @ 11:34:15</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38555294"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38555115">
          <h3>
            <a
              class="item"
              href="https://www.ifixit.com/News/87664/fairphone-5-keeping-it-10-10"
              >Fairphone 5: Keeping it 10/10?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-07 @ 11:04:26</span
              ><span class="points-container"
                >Points: <span class="points">437</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38555115"
                  >Comments</a
                ><span class="descendants">: 444</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38544729">
          <h3>
            <a class="item" href="https://deepmind.google/technologies/gemini/"
              >Gemini AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-06 @ 15:03:47</span
              ><span class="points-container"
                >Points: <span class="points">2059</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38544729"
                  >Comments</a
                ><span class="descendants">: 1579</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
