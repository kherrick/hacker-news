<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36968273">
          <h3>
            <a class="item" href="https://github.com/DTolm/VkFFT"
              >VkFFT: Vulkan/CUDA/Hip/OpenCL/Level Zero/Metal Fast Fourier
              Transform Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 08:06:50</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36968273"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36968218">
          <h3>
            <a
              class="item"
              href="https://twitter.com/DanNeidle/status/1686643943432232962"
              >HMRC (UK Tax Authority) Persuing Uber for £386M (~$487M) Vat</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 07:59:01</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36968218"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36967873">
          <h3>
            <a class="item" href="https://bitmovin.com/careers/"
              >Bitmovin (YC S15) Is Hiring in Austria</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 07:01:12</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36967829">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/when-beetle-gets-eaten-frog-it-forces-its-way-out-back-door-180975484/"
              >The Beetle That Heads for the ‘Back Door’ When Eaten by a Frog</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 06:52:45</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36967829"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36967594">
          <h3>
            <a class="item" href="https://austinhenley.com/blog/90percent.html"
              >Stopping at 90%</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 06:16:57</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36967594"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36967579">
          <h3>
            <a class="item" href="https://eol.org/">Encyclopedia of Life</a>
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 06:15:09</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36967579"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36967205">
          <h3>
            <a class="item" href="https://www.beatandraise.com/"
              >Reading SEC filings using LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 05:17:04</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36967205"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36966653">
          <h3>
            <a class="item" href="https://catskull.net/html.html"
              >I'm betting on HTML</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 03:31:57</span
              ><span class="points-container"
                >Points: <span class="points">478</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36966653"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36966116">
          <h3>
            <a class="item" href="https://github.com/dsrw/enu"
              >Enu – 3D live coding, implemented in Nim</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 02:12:25</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36966116"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36965993">
          <h3>
            <a class="item" href="https://eugeneyan.com/writing/llm-patterns/"
              >Patterns for building LLM-based systems and products</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 01:54:26</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36965993"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36965545">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2308.00676"
              >Electronic Structure of LK-99</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 00:57:46</span
              ><span class="points-container"
                >Points: <span class="points">350</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36965545"
                  >Comments</a
                ><span class="descendants">: 278</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36964300">
          <h3>
            <a
              class="item"
              href="https://rachelbythebay.com/w/2020/04/11/pengrun/"
              >Bored? How about trying a Linux speedrun? (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 22:46:06</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36964300"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36964107">
          <h3>
            <a
              class="item"
              href="https://twitter.com/zebulgar/status/1686498517227814912"
              >Unconfirmed video showing potential LK-99 sample exhibiting the
              Meissner effect</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 22:28:55</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36964107"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36961996">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2307.08378"
              >eGPU: A 750 MHz Class Soft GPGPU for FPGA</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 20:11:26</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36961996"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36961734">
          <h3>
            <a
              class="item"
              href="https://www.inferse.com/660551/hardware-hacker-mods-an-m1-mac-mini-to-receive-power-over-ethernet-instead-of-the-ac-input/"
              >Hacker mods an M1 Mac mini to receive power over Ethernet instead
              of AC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 19:54:46</span
              ><span class="points-container"
                >Points: <span class="points">344</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36961734"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36961445">
          <h3>
            <a
              class="item"
              href="https://www.nullpt.rs/evading-anti-debugging-techniques"
              >Evading JavaScript anti-debugging techniques</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 19:35:45</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36961445"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36960625">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/08/pixar-adobe-apple-autodesk-and-nvidia-form-alliance-for-openusd/"
              >Pixar, Adobe, Apple, Autodesk, and Nvidia form alliance for
              OpenUSD</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 18:51:09</span
              ><span class="points-container"
                >Points: <span class="points">566</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36960625"
                  >Comments</a
                ><span class="descendants">: 213</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36960309">
          <h3>
            <a
              class="item"
              href="https://howardism.org/Technical/Emacs/new-window-manager.html"
              >Emacs is my new window manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 18:31:31</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36960309"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36960244">
          <h3>
            <a class="item" href="https://github.com/ReagentX/imessage-exporter"
              >Show HN: imessage-exporter, a CLI app and library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 18:27:34</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36960244"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36958731">
          <h3>
            <a class="item" href="https://magicloops.dev"
              >Show HN: Magic Loops – Combine LLMs and code to create simple
              automations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 16:57:08</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36958731"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
            <div class="text">
              <p>
                We created it after getting frustrated with the inability of
                LLMs to deal with numbers and the various hoops we had to jump
                through to make ChatGPT output repeatable.
              </p>
              <p>
                At the core, Magic Loops are just a series of "blocks" (JSON)
                that can be triggered with different inputs (email, time,
                webhook), then operate on those inputs using a combination of
                LLMs and code, and then output those results (email, text,
                webhook). Under the hood, the LLM calls are using GPT-4 via
                OpenAI and the code is run in sandboxed (no internet) Docker
                containers in AWS.
              </p>
              <p>
                You have full control over each step of the loop, but you can
                also create (or attempt to create) a Magic Loop by simply
                describing what you want. We use GPT-4 to break that request
                into feasible steps, and then create a Magic Loop scaffold. Of
                course, you should still validate the loop before publishing it!
              </p>
              <p>We've seen some neat use cases already:</p>
              <p>
                - "Text me when the tide is less than 1ft between 7am and 7pm at
                Fort Funston"
              </p>
              <p>
                - "Summarize an email using this format and forward it to this
                address"
              </p>
              <p>
                - "Text me every time our store does more than $1000/day in
                volume on Shopify"
              </p>
              <p>
                - "Take specific data from Cloudflare, format it, and send it to
                Mixpanel every hour"
              </p>
              <p>
                We hope you enjoy what's essentially an experiment at this
                point. If folks like the concept, we're thinking about open
                sourcing it so you can run the loops locally with the code
                runtimes you wish (rather than in our code runners).
              </p>
              <p>
                Let us know what you think, and more importantly, what you wish
                to build or automate!
              </p>
              <p>Cheers, Adam &amp; Mihai</p>
            </div>
          </section>
        </section>
        <section id="36957678">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/blog-post/room-temperature-superconductor-new-developments"
              >A room-temperature superconductor? New developments</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 15:52:57</span
              ><span class="points-container"
                >Points: <span class="points">1086</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36957678"
                  >Comments</a
                ><span class="descendants">: 717</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36957204">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36957204"
              >Launch HN: Tiptap (YC S23) – Toolkit for developing collaborative
              editors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 15:24:51</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36957204"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
            <div class="text">
              <a href="https://tiptap.dev/">https://tiptap.dev/</a>), an open
              source developer toolkit for building collaborative editing apps.
              Our editor framework, based on ProseMirror, is at
              <a href="https://github.com/ueberdosis/tiptap"
                >https://github.com/ueberdosis/tiptap</a
              >, and our real-time collaboration backend, based on Yjs, is at
              <a href="https://github.com/ueberdosis/hocuspocus"
                >https://github.com/ueberdosis/hocuspocus</a
              >.
              <p>
                Building editor interfaces like Notion or Google Docs in your
                web app takes a lot of work and time. Our open source tools and
                cloud services let you build collaborative content editing
                faster—in days or weeks, rather than months or years. And this
                is just for the editor. If you want real-time collaboration or
                other advanced features like version history in your editor, the
                overall workload quickly escalates—you will need a robust and
                serious backend infrastructure that requires even more time to
                set up and maintain. This doesn’t make sense for most frontend
                developers or most startups.
              </p>
              <p>
                We spent eight years as a digital agency developing applications
                with complex content editing functionality. We learned the hard
                way how limited the existing editors were. After building Tiptap
                as a headless editor framework with an extension-based
                architecture, we needed to allow multiple users to edit content
                simultaneously, which got complicated. There was no simple
                solution that could be integrated quickly. So we built that too.
              </p>
              <p>
                The Tiptap editor is based on the JS framework ProseMirror,
                which is a good foundation for editors. The learning curve for
                ProseMirror is steep because it's complicated to understand and
                lacks simple APIs and documentation. It takes a lot of code
                around ProseMirror to develop a modern user experience. We’ve
                taken care of that for you.
              </p>
              <p>
                Tiptap is headless, so it will work with whatever frontend or
                design you have in mind—we make no assumptions about your UI.
                You can use it to develop block-based editors like Notion,
                classic interfaces like Google Docs, or whatever you need. It's
                also framework agnostic, so you can use it with React, Vue,
                etc., or vanilla JavaScript. And it's highly customizable
                through our extension architecture. We also provide an API to
                access ProseMirror's internals through Tiptap if you want to dig
                deep into the core.
              </p>
              <p>
                Adding real-time collaboration to your editor is as easy as
                installing and configuring an extension. Our collaboration
                backend, called Hocuspocus, uses Yjs. This is a widely used
                implementation of CRDTs (conflict- free replicated data type).
                Hocuspocus makes it easy to set up a Node.js websocket server to
                handle communication between multiple peers to synchronize data.
                Like the Tiptap editor, Hocuspocus is designed to be extensible
                according to your needs. Also, Hocuspocus can work independently
                of Tiptap with other editors like Lexical or Slate.
              </p>
              <p>
                An earlier version of Tiptap got discussed a couple years ago at
                <a href="https://news.ycombinator.com/item?id=26901975"
                  >https://news.ycombinator.com/item?id=26901975</a
                >. We’ve been enjoying wider adoption since then. For example,
                Substack uses Tiptap for their editor that allows creators to
                write content on substack.com, and YC uses Tiptap in their
                Bookface forum (which is basically HN for YC alums).
              </p>
              <p>
                With the Tiptap Cloud, we offer managed backend services if you
                don't want to build and maintain every feature yourself. For
                real-time collaboration, we provide a cloud infrastructure with
                multiple datacenter regions where you can deploy Hocuspocus. The
                Tiptap AI integration beta is a service where you connect your
                OpenAI API key to our backend and install the Tiptap editor AI
                extension to get AI writing experience in your editor. Here’s a
                demo:
                <a href="https://ai-demo.tiptap.dev/"
                  >https://ai-demo.tiptap.dev/</a
                >
              </p>
              <p>
                We invite you to explore Tiptap's capabilities in your app,
                contribute to its open source development, and (hopefully!) join
                our welcoming community. We'd love to hear what you've already
                built with Tiptap or what's stopping you from creating something
                with it :-) We look forward to all of your comments!
              </p>
            </div>
          </section>
        </section>
        <section id="36954805">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Nuffield_Science_Project"
              >Nuffield Science Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 11:43:51</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36954805"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36947930">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/what-is-spaghetti-squash"
              >The history of spaghetti squash in America</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 19:56:31</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36947930"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36944611">
          <h3>
            <a
              class="item"
              href="https://hackaday.com/2023/07/30/an-open-source-free-circuit-simulator/"
              >An open-source, free circuit simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 15:59:02</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36944611"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36943091">
          <h3>
            <a
              class="item"
              href="https://sophiehoulden.com/randomstuff/epitime/?revised"
              >Epicycle Clock</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 14:30:40</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36943091"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36941885">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-07-supermoons-august-stargazing-fun.html"
              >Two supermoons in August</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 12:56:37</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36941885"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36941878">
          <h3>
            <a
              class="item"
              href="https://nautil.us/scientists-watch-broken-metal-heal-itself-356873/"
              >Scientists Watch Broken Metal Heal Itself</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 12:55:38</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36941878"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36941720">
          <h3>
            <a
              class="item"
              href="https://max.levch.in/post/724289457144070144/shamir-secret-sharing"
              >Shamir Secret Sharing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 12:40:07</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36941720"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36941551">
          <h3>
            <a class="item" href="https://github.com/SteveRidout/flashdown"
              >Flashdown: A terminal based Flashcard app using plain text
              files</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 12:24:51</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36941551"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
