<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38990755">
          <h3>
            <a
              class="item"
              href="https://www.cybercollective.org/blog/how-to-delete-your-data-from-data-brokers"
              >How to Delete Your Data from Data Brokers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 14:34:23</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38990755"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38990709">
          <h3>
            <a
              class="item"
              href="https://magazine.sebastianraschka.com/p/understanding-and-coding-self-attention"
              >Coding Self-Attention, Multi-Head Attention, Cross-Attention,
              Causal-Attention</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 14:29:47</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38990709"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38990561">
          <h3>
            <a
              class="item"
              href="https://www.anandtech.com/show/21208/amd-unveils-ryzen-8000g-series-processors-zen-4-apus-for-desktop-with-ryzen-ai"
              >AMD Unveils Ryzen 8000G Series Processors: Zen 4 APUs for Desktop
              with Ryzen AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 14:13:53</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38990561"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38990148">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38990148"
              >Ask HN: AI that allows you to make phone calls in a language you
              don't speak?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 13:22:02</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38990148"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                This idea came to me during my travels in Japan and China, where
                English is not commonly spoken in many places. It's incredibly
                challenging to navigate without knowing the language. We often
                had to rely on our hotel's front desk to assist us with
                reservations and contacting support services.
              </p>
              <p>
                I can envision other applications for this technology, such as
                in call centers, for international business calls, meetings,
                etc.
              </p>
              <p>What do you guys think? Thanks in advance!</p>
            </div>
          </section>
        </section>
        <section id="38989672">
          <h3>
            <a class="item" href="https://jobs.lever.co/buildzoom"
              >BuildZoom (better way to build custom homes) Is hiring a Growth
              Associate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 12:04:20</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38989254">
          <h3>
            <a
              class="item"
              href="https://well-typed.com/blog/2024/01/when-blocked-indefinitely-is-not-indefinite/"
              >When "blocked indefinitely" is not indefinite</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 10:41:25</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38989254"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38988982">
          <h3>
            <a
              class="item"
              href="https://bernsteinbear.com//blog/typed-c-extensions/"
              >Type information for faster Python C extensions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 09:48:48</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38988982"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38988960">
          <h3>
            <a
              class="item"
              href="https://devopscycle.com/blog/the-ultimate-docker-cheat-sheet/"
              >The Ultimate Docker Cheat Sheet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 09:45:24</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38988960"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38988948">
          <h3>
            <a
              class="item"
              href="https://qsantos.fr/2024/01/04/dynamic-programming-is-not-black-magic/"
              >Dynamic Programming is not Black Magic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 09:42:15</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38988948"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38988944">
          <h3>
            <a
              class="item"
              href="https://ico.org.uk/about-the-ico/media-centre/news-and-blogs/2024/01/ico-fines-hellofresh-140-000-for-spam-texts-and-emails/"
              >ICO fines HelloFresh £140k for spam texts and emails</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 09:40:21</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38988944"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38988238">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/10.1145/3593856.3595909"
              >Towards Modern Development of Cloud Applications (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 07:17:36</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38988238"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38988019">
          <h3>
            <a class="item" href="https://github.com/every-day-things/citadel"
              >Citadel, a Calibre-compatible eBook management app</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 06:22:40</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38988019"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38987383">
          <h3>
            <a class="item" href="https://posthog.com/blog/slack-closure"
              >Posthog is closing their Slack community in favor of forum</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 04:12:56</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38987383"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38987109">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/adtac/595b5823ef73b329167b815757bbce9f"
              >Show HN: #!/usr/bin/env docker run</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 03:20:05</span
              ><span class="points-container"
                >Points: <span class="points">385</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38987109"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38986546">
          <h3>
            <a
              class="item"
              href="https://dpldocs.info/this-week-in-d/Blog.Posted_2024_01_01.html"
              >OpenD, a D language fork that is open to your contributions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 01:34:59</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38986546"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38985152">
          <h3>
            <a
              class="item"
              href="https://johnthenerd.com/blog/local-llm-assistant/"
              >Building a fully local LLM voice assistant to control my smart
              home</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 22:12:10</span
              ><span class="points-container"
                >Points: <span class="points">563</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38985152"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38984096">
          <h3>
            <a
              class="item"
              href="https://unix.stackexchange.com/questions/4126/what-is-the-exact-difference-between-a-terminal-a-shell-a-tty-and-a-con"
              >What is the difference between a terminal, a shell, a TTY and a
              console? (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 20:16:37</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38984096"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38981639">
          <h3>
            <a
              class="item"
              href="https://github.com/razetime/ngn-k-tutorial/blob/main/12-thinking-in-k.md"
              >Thinking in an array language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 16:43:29</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38981639"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38981254">
          <h3>
            <a class="item" href="https://github.com/Stellarium/stellarium"
              >Stellarium: Software which renders realistic skies in real
              time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 16:12:45</span
              ><span class="points-container"
                >Points: <span class="points">677</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38981254"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38979370">
          <h3>
            <a class="item" href="https://schollz.com/tinker/primitives/"
              >Painting from Primitives (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 12:31:20</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38979370"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38977422">
          <h3>
            <a
              class="item"
              href="https://tedium.co/2024/01/12/isdn-history-retrospective/"
              >What Was ISDN?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 04:49:05</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38977422"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38966430">
          <h3>
            <a
              class="item"
              href="https://getreuer.info/posts/keyboards/index.html"
              >QMK and Keyboards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 10:39:19</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38966430"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38966257">
          <h3>
            <a class="item" href="http://www.terse.com/ddj.pdf"
              >Terse: A language with hi-level look-and-feel, low-level control
              (1995) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 10:17:01</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38966257"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38965603">
          <h3>
            <a
              class="item"
              href="https://www.incomparable.design/blog/what-bed-linen-can-teach"
              >What Bed Linen Can Teach Us About Usability</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 08:39:45</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38965603"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38965375">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/ef42e78f-e578-450b-9e43-36fbd1e20d01"
              >The young people sifting through the internet's worst horrors</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 08:03:40</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38965375"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38965268">
          <h3>
            <a class="item" href="https://github.com/sshirokov/pydvice"
              >Pydvice: An attempt at bringing (defadvice) from Elisp to
              Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 07:49:21</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38965268"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38964884">
          <h3>
            <a
              class="item"
              href="https://www.asus.com/us/laptops/for-home/zenbook/asus-zenbook-duo-2024-ux8406/"
              >Asus Zenbook Duo 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 06:55:15</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38964884"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38964575">
          <h3>
            <a
              class="item"
              href="https://www.digitalcameraworld.com/news/worlds-first-ever-smart-binoculars-can-identify-up-to-9000-birds-thanks-built-in-ai"
              >Smart binoculars can identify 9k birds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 06:14:12</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38964575"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38964572">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/01/11/panama-canal-drought-moves-maersk-to-start-using-land-bridge-for-cargo.html"
              >Panama Canal drought forces Maersk to start using land bridge for
              Oceania cargo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 06:13:51</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38964572"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38964378">
          <h3>
            <a class="item" href="https://arxiv.org/abs/1901.01973"
              >Looking back at Postgres (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 05:43:25</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38964378"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
