<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39868679">
          <h3>
            <a
              class="item"
              href="https://inside.java/2024/03/24/openjdk-wakefield/"
              >Project Wayfield – The JDK Wayland Desktop on Linux [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 20:31:04</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39868679"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39868254">
          <h3>
            <a class="item" href="https://pieeg.com/"
              >EEG channels with low-cost PiEEG device</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 19:49:51</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39868254"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39867757">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39867757"
              >Launch HN: Lumona (YC W24) – Product search based on Reddit and
              YouTube reviews</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 19:04:04</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39867757"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
            <div class="text">
              <a href="https://lumona.ai">https://lumona.ai</a>), a product
              search engine that recommends products based on what people on
              social media—Reddit and YouTube, for now—are saying about them.
              <p>
                Rather than going through SEO-filled Google results or adding
                site:reddit.com to your search, we explain what makes a good
                product, show you the best products, and back it up with Reddit
                and YouTube reviews about the product. We’re starting with
                skincare products (more on that below) and plan to expand from
                there.
              </p>
              <p>
                Here’s a demo:
                <a
                  href="https://www.youtube.com/watch?v=C4kKjW2YkZ4&amp;lc=Ugzl94GP9SDBOvqA2Dd4AaABAg"
                  >https://www.youtube.com/watch?v=C4kKjW2YkZ4&amp;lc=Ugzl94GP9SDBO...</a
                >
              </p>
              <p>
                We started off with skincare because, growing up, we struggled
                with acne but had no clue what skincare products could actually
                help us. Going down the rabbit hole of endlessly scrolling
                r/SkincareAddiction and watching countless hours of videos about
                cystic acne was not fun.
              </p>
              <p>
                Lumona’s skincare search index was built by first scraping the
                internet for listings of skincare products, along with their
                ingredient lists, through a combination of SERP, Amazon’s API,
                and web page crawling. We then use a fine-tuned Mistral LLM to
                parse through a large number of Reddit threads and YouTube
                transcripts to extract opinions made by users, along with the
                context in which the opinions were made. These opinions are then
                matched with any relevant products through another fine-tuned
                LLM that looks at an opinion and any products that have a high
                cosine similarity as that of the opinion’s subject and decides
                whether that opinion is relevant to any of those products. Using
                a Mistral-7B FT trained on GPT-4 outputs allowed us to parse
                through hundreds of thousands of Reddit threads in a simple way
                with just hundreds of dollars of compute.
              </p>
              <p>
                If your query relates to a specific situation (e.g. “cleansers
                for my son who has inflamed acne on his forehead”), we search
                semantically through the opinions of Redditors and YouTubers to
                retrieve the products recommended by those who have dealt with a
                similar situation. If your query relates to a specific product
                (e.g. “iunik centella gel”), we instead go through the product
                listings themselves to return you the relevant products.
              </p>
              <p>
                We also use an LLM to analyze your search query to tell you what
                ingredients or effects are preferable for your skin concern.For
                example, if you searched for “inflamed forehead acne”,
                properties like “Oil-Control” and “Azelaic Acid” which are good
                for dealing with inflamed acne would be explained to you, and
                results containing those properties would be boosted and tagged
                in our results. You can also try out searches like “korean
                cleansers under $20 with Cica” to filter for certain ingredients
                and price points.
              </p>
              <p>
                While we think we’ve built a product search that would be pretty
                helpful for our teenage (and current!) selves, there are many
                improvements we’d like to make, such as getting opinions from
                Tiktok and other social media platforms and making our opinion
                extraction process more robust for edge cases (e.g. by using
                OCR, video transcription tools). We’re also planning on allowing
                our users to upload their own reviews and content and to expand
                our search across more products.
              </p>
              <p>
                The long-term potential is to be a go-to product for anyone
                looking for what other people think about anything subjective
                (products, restaurants, b2b products, vacation planning, etc.).
                We believe that the entire discovery experience can be
                revolutionized by making it as easy as searching on Google to
                find out what the people you care about think about something.
                On the individual level, we want to make sharing your opinions
                with your friends and the world as easy as posting a picture on
                Instagram.
              </p>
              <p>
                For now, if you have any skincare needs, whether it be to solve
                a skin concern, get rid of an annoying pimple, or just to find a
                good sunscreen, please give us a try:
                <a href="https://lumona.ai">https://lumona.ai</a> (We are an
                Amazon and Stylevana affiliate.)
              </p>
              <p>
                We’d love to hear your feedback on our search engine, whether
                that be how the skincare search performs, what you think is
                missing, what products you want to see there, or any technical
                suggestions!
              </p>
            </div>
          </section>
        </section>
        <section id="39867702">
          <h3>
            <a class="item" href="https://guacamole.apache.org/"
              >Apache Guacamole: a clientless remote desktop gateway</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 18:59:50</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39867702"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39867632">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Banner_blindness"
              >Banner blindness</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 18:53:33</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39867632"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39867616">
          <h3>
            <a class="item" href="https://blog.ubavic.rs/9/"
              >Porting the GCLC to the Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 18:52:05</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39867616"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39867551">
          <h3>
            <a class="item" href="https://qwenlm.github.io/blog/qwen-moe/"
              >Qwen1.5-Moe: Matching 7B Model Performance with 1/3 Activated
              Parameters</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 18:45:31</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39867551"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39867270">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/muon-collider-could-revolutionize-particle-physics-if-it-can-be-built"
              >A muon collider could revolutionize particle physics, if it can
              be built</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 18:18:03</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39867270"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39866795">
          <h3>
            <a
              class="item"
              href="https://www.bigtechnology.com/p/can-demis-hassabis-save-google"
              >Can Demis Hassabis save Google?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 17:35:20</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39866795"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39866325">
          <h3>
            <a class="item" href="https://github.com/pojntfx/weron"
              >Overlay networks based on WebRTC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 17:00:07</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39866325"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39866111">
          <h3>
            <a class="item" href="http://www.skeeve.com/awk-sys-prog.html"
              >Awk as a major systems programming language, revisited (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 16:42:47</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39866111"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39865810">
          <h3>
            <a
              class="item"
              href="https://www.openwall.com/lists/oss-security/2024/03/29/4"
              >Backdoor in upstream xz/liblzma leading to SSH server
              compromise</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 16:16:50</span
              ><span class="points-container"
                >Points: <span class="points">2173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39865810"
                  >Comments</a
                ><span class="descendants">: 772</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39864412">
          <h3>
            <a
              class="item"
              href="https://english.elpais.com/international/2024-03-29/philanthropist-group-buys-up-large-tracts-of-land-in-romania-to-create-european-yellowstone.html"
              >Group buys up large tracts of land in Romania to create 'European
              Yellowstone'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 14:18:56</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39864412"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39864210">
          <h3>
            <a class="item" href="https://alecmuffett.com/article/109513"
              >Ross Anderson has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 14:01:13</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39864210"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39863445">
          <h3>
            <a
              class="item"
              href="https://harpers.org/archive/2013/10/bartoks-monster/"
              >Bartók's Monster – Stalking the dead composer through
              Transylvania (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 12:50:29</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39863445"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39863001">
          <h3>
            <a
              class="item"
              href="https://defoe.sourceforge.net/folio/knuth-plass.html"
              >Knuth and Plass line-breaking revisited (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 12:02:16</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39863001"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39862828">
          <h3>
            <a
              class="item"
              href="https://blog.research.google/2024/03/autobnn-probabilistic-time-series.html?m=1"
              >AutoBNN: Probabilistic Time Series Forecasting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 11:37:27</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39862828"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39861680">
          <h3>
            <a class="item" href="https://m6n.io/@fuzzychef/112172393647826741"
              >Simon Riggs has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 08:08:54</span
              ><span class="points-container"
                >Points: <span class="points">803</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39861680"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39861367">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/capi-money/jobs/OTaPesL-senior-fullstack-engineer"
              >Capi Money (YC S23) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 07:00:52</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39850340">
          <h3>
            <a class="item" href="https://www.nippon.com/en/in-depth/d00956/"
              >Mazda's rotary engine in the age of the electric car</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 12:22:07</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39850340"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39849644">
          <h3>
            <a class="item" href="https://mobiusml.github.io/1bit_blog/"
              >Towards 1-bit Machine Learning Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 10:58:34</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39849644"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39849528">
          <h3>
            <a class="item" href="https://lmatteis.github.io/react-behavioral/"
              >Behavioral Programming (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 10:38:07</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39849528"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39849071">
          <h3>
            <a
              class="item"
              href="https://pages.cs.wisc.edu/~bart/fuzz/Foreword1.html"
              >How fuzz testing was invented (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 09:12:23</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39849071"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39848126">
          <h3>
            <a
              class="item"
              href="https://www.lrb.co.uk/the-paper/v46/n07/michael-ledger-lomas/the-call-of-the-weird"
              >The Call of the Weird</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 05:46:38</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39848126"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39847940">
          <h3>
            <a
              class="item"
              href="https://www.multicians.org/thvv/hellandizing.html"
              >Hellandizing (1998)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 05:01:17</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39847940"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39844439">
          <h3>
            <a
              class="item"
              href="https://www.enterprisedb.com/blog/finding-memory-leaks-postgres-c-code"
              >Finding memory leaks in Postgres C code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-27 @ 20:50:39</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39844439"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39841601">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20171014122847/http://www.pilotonline.com/app/media/content/pilotonline/2014/04/marvel/marvel.html"
              >Building the Chesapeake Bay Bridge-Tunnel (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-27 @ 16:55:18</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39841601"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39841126">
          <h3>
            <a
              class="item"
              href="https://pedtsr.ca/2024/solving-domino-fit-using-constraint-programming.html"
              >Solving domino fit using constraint programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-27 @ 16:14:06</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39841126"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39831002">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/topologists-tackle-the-trouble-with-poll-placement-20240326/"
              >Topologists tackle the trouble with poll placement</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 18:14:06</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39831002"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39821712">
          <h3>
            <a
              class="item"
              href="https://www.chicagotribune.com/1985/12/02/a-lavish-lifestyle-strains-credibility/"
              >A lavish lifestyle strains credibility (1985)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 21:58:21</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39821712"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
