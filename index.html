<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43007862">
          <h3>
            <a
              class="item"
              href="https://ktla.com/news/california/thousands-of-danes-sign-petition-to-buy-california-from-u-s/amp/"
              >Danes sign petition to buy California from U.S.</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-11 @ 01:29:56</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43007862"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43007769">
          <h3>
            <a
              class="item"
              href="http://jackkelly.name/blog/archives/2025/02/06/how_copyover_mud_servers_worked/"
              >How Copyover MUD Servers Worked</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-11 @ 01:19:14</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43007769"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43007628">
          <h3>
            <a
              class="item"
              href="https://silent.org.pl/home/2022/06/13/the-floppotron-3-0/"
              >The Floppotron 3.0 (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-11 @ 01:02:48</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43007628"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43007424">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/us-news/2025/feb/10/v-fluence-pesticide-critics"
              >'social network' attacking pesticide critics shuts down after
              investigation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-11 @ 00:44:57</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43007424"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43006536">
          <h3>
            <a class="item" href="https://pydong.org/posts/KwArgs/"
              >Fun with C++26 reflection: Keyword Arguments</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 23:16:33</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43006536"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43006390">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/graphics/2025-hedge-fund-investment-fees/"
              >Hedge Funds Are Pocketing Much of Their Clients' Gains with 'No
              Limit' Fees</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 22:57:31</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43006390"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43006350">
          <h3>
            <a
              class="item"
              href="https://plato.stanford.edu/entries/qm-relational/"
              >Relational Quantum Mechanics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 22:53:40</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43006350"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43005096">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43005096"
              >Fly.io (YC W20) Is Hiring a Customer Support Director</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 21:00:29</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                CS at Fly.io is a challenging, demanding job: we’re supporting
                every kind of application on every stack as our customers boot
                things up on a new cloud. Our CS team needs machine sympathy not
                just for Fly.io’s own infrastructure, but for every quirk of
                every app a customer tries to run.
              </p>
              <p>
                We hire engineers for CS. We’ve been managing them as engineers.
                Now we’re going to do something different: we’re bringing on a
                Customer Support Director, to manage the team and, more
                importantly, set strategy.
              </p>
              <p>
                This is a very senior role in a part of Fly.io that is
                critically important to our success. It comes with a lot of
                autonomy, an opportunity to have an outsized impact on our
                business, and intense visibility and exposure to a vibrant
                community of developers shipping apps.
              </p>
              <p>
                If you’ve done this kind of work before, and have takes on how
                it can be done better, we’d like to talk to you.
              </p>
              <p>
                <a href="https://fly.io/jobs/support-director/"
                  >https://fly.io/jobs/support-director/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43004889">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/markets/deals/elon-musk-led-group-makes-974-billion-bid-control-openai-wsj-reports-2025-02-10/"
              >Musk-led group makes $97B bid for control of OpenAI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 20:42:18</span
              ><span class="points-container"
                >Points: <span class="points">509</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43004889"
                  >Comments</a
                ><span class="descendants">: 579</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43004435">
          <h3>
            <a class="item" href="https://github.com/tinycorelinux/tinyx"
              >TinyX: Small Featured X Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 19:52:02</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43004435"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43004416">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2502.05171"
              >Scaling up test-time compute with latent reasoning: A recurrent
              depth approach</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 19:50:20</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43004416"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43004334">
          <h3>
            <a
              class="item"
              href="https://zknill.io/posts/patterns-for-building-realtime/"
              >Patterns for Building Realtime Features</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 19:42:02</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43004334"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43002906">
          <h3>
            <a
              class="item"
              href="https://www.abortretry.fail/p/work-at-the-mill"
              >Work at the Mill Or, the Story of Digital Equipment
              Corporation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 17:39:28</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43002906"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43002511">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/undergraduate-upends-a-40-year-old-data-science-conjecture-20250210/"
              >Undergraduate shows that searches within hash tables can be much
              faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 17:05:09</span
              ><span class="points-container"
                >Points: <span class="points">549</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43002511"
                  >Comments</a
                ><span class="descendants">: 249</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43002440">
          <h3>
            <a
              class="item"
              href="https://www.pcgamer.com/gaming-industry/a-2023-study-concluded-captchas-are-a-tracking-cookie-farm-for-profit-masquerading-as-a-security-service-that-made-us-spend-819-billion-hours-clicking-on-traffic-lights-to-generate-nearly-usd1-trillion-for-google/"
              >CAPTCHAs: 'a tracking cookie farm for profit masquerading as a
              security service'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 16:59:27</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43002440"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43001688">
          <h3>
            <a class="item" href="https://topography.jessekv.com"
              >Show HN: Global 3D topography explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 15:54:45</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43001688"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
            <div class="text">
              <p>
                Click anywhere on the map to get a polygon, and then click
                "generate".
              </p>
              <p>
                It should work at most scales, but if your watershed or region
                selection is too large, the result can be less exciting because
                it's so flat.
              </p>
              <p>
                As a warning, the 3D models can sometimes be too much for my
                phone. It's nicer on desktop. I'm still working better on mobile
                support.
              </p>
              <p>
                The land cover data I'm using gives a cool effect, but at some
                point I'd like to add in global imagery and clouds.
              </p>
              <p>
                The backend is a Python thread running on an old Lenovo
                Thinkcentre in my closet, so if it goes down, this is why. (I
                also sometimes need to restart it when the network card stops
                working... I really should figure out why sometime.)
              </p>
              <p>
                If you find a really cool island or watershed, let me know and I
                can add it to the "favorites".
              </p>
            </div>
          </section>
        </section>
        <section id="43000529">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/the-anthropic-economic-index"
              >The Anthropic Economic Index</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 14:14:22</span
              ><span class="points-container"
                >Points: <span class="points">426</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43000529"
                  >Comments</a
                ><span class="descendants">: 191</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43000316">
          <h3>
            <a
              class="item"
              href="https://blog.plover.com/lang/etym/nickname-names.html"
              >Surnames from nicknames nobody has any more</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 13:54:38</span
              ><span class="points-container"
                >Points: <span class="points">720</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43000316"
                  >Comments</a
                ><span class="descendants">: 352</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43000303">
          <h3>
            <a
              class="item"
              href="https://github.com/desgeeko/pdfsyntax/blob/main/docs/browse.md"
              >Show HN: HTML visualization of a PDF file's internal structure</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 13:52:53</span
              ><span class="points-container"
                >Points: <span class="points">329</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43000303"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
            <div class="text">
              Hi, I've just finished a rebuild of this function and added a lot
              of new features: info, page index, minimap, inverted index,... I
              think it may be useful for inspection, debugging or just as a
              learning resource showcasing the PDF file format. This is a pet
              project and I would be happy to receive some feedback! Regards
            </div>
          </section>
        </section>
        <section id="43000275">
          <h3>
            <a
              class="item"
              href="https://engineering.mit.edu/engage/ask-an-engineer/why-hasnt-commercial-air-travel-gotten-any-faster-since-the-1960s/"
              >Why hasn't commercial air travel gotten any faster since the
              1960s? (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 13:50:40</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43000275"
                  >Comments</a
                ><span class="descendants">: 270</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42996671">
          <h3>
            <a
              class="item"
              href="https://www.ncregister.com/blog/face-of-aquinas-revealed-after-750-years"
              >Thomas Aquinas' skull reveals appearance and cause of death</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 03:38:29</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42996671"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42989635">
          <h3>
            <a class="item" href="https://scroll-driven-animations.style/"
              >Scroll-Driven Animations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-09 @ 09:51:51</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42989635"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42976623">
          <h3>
            <a
              class="item"
              href="https://onlinelibrary.wiley.com/doi/10.1002/ece3.70786"
              >Genetic Evidence of Killer Whale Predation on White Sharks in
              Australia</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 19:40:36</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42976623"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42975366">
          <h3>
            <a class="item" href="https://www.wordlecharts.crtez.dev/"
              >Show HN: Wordle Charts – insights about Wordle you don't need</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 17:45:01</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42975366"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                There's a grand total of 7 visualizations, with some fun little
                touches here and there. My favorite is probably "Clairvoyant
                Guesses," which shows some (to put it nicely) suspicious
                day-to-day guessing patterns. There's also a fun little easter
                egg when you type "cat" and then enter a word into the "Find
                Word:" box. Let me know if you have any suggestions, and any
                feedback at all :)
              </p>
              <p>
                Github Repo:
                <a
                  href="https://github.com/crtez/is_wordle_harder_or_am_i_just_stupid"
                  >https://github.com/crtez/is_wordle_harder_or_am_i_just_stupi...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42973189">
          <h3>
            <a class="item" href="https://cerncourier.com/a/the-other-99/"
              >The other 99% – CERN Courier</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 14:48:42</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42973189"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42971038">
          <h3>
            <a
              class="item"
              href="https://www.nuanced.dev/blog/system-wide-context"
              >Memory profilers, call graphs, exception reports, and
              telemetry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 09:57:57</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42971038"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42970847">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/environment/2024/dec/18/if-a-million-germans-have-them-there-must-be-something-in-it-how-balcony-solar-is-taking-off"
              >Balcony solar is taking off</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 09:23:49</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42970847"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42970169">
          <h3>
            <a
              class="item"
              href="https://www.mend.io/blog/fake-vs-code-extension-on-npm-spreads-multi-stage-malware/"
              >Fake VS Code Extension on NPM Spreads Multi-Stage Malware</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 06:58:10</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42970169"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42969993">
          <h3>
            <a
              class="item"
              href="https://www.nbcnews.com/tech/innovation/indigenous-engineers-are-using-ai-preserve-culture-rcna176012"
              >Indigenous engineers are using AI to preserve their culture</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 06:23:36</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42969993"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42969038">
          <h3>
            <a
              class="item"
              href="https://hms.harvard.edu/news/ancient-dna-study-identifies-originators-indo-european-language-family"
              >Ancient-DNA study identifies originators of Indo-European
              language family</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 03:30:10</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42969038"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
