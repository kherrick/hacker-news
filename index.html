<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45587289">
          <h3>
            <a
              class="item"
              href="https://stefan-marr.de/2025/10/can-we-know-whether-a-profiler-is-accurate/"
              >Can We Know Whether a Profiler Is Accurate?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-15 @ 02:04:26</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45587289"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45587280">
          <h3>
            <a class="item" href="https://diskprices.com/?locale=us"
              >Disk Prices</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-15 @ 02:02:32</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45587280"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45587072">
          <h3>
            <a
              class="item"
              href="https://www.governance.fyi/p/the-pentagons-best-schools-and-safest"
              >Why The Pentagon run the best schools and the safest nuclear
              program</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-15 @ 01:29:39</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45587072"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45586962">
          <h3>
            <a
              class="item"
              href="https://www.nhpr.org/nh-news/2025-10-06/new-englands-last-coal-plant-has-stopped-operating-according-to-its-owners"
              >New England's last coal plant has stopped operating, according to
              its owners</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-15 @ 01:10:50</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45586962"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45586776">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2025/Oct/14/nvidia-dgx-spark/"
              >Nvidia DGX Spark: great hardware, early days for the ecosystem</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-15 @ 00:49:25</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45586776"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45586423">
          <h3>
            <a
              class="item"
              href="https://ally-petitt.com/en/posts/2024-05-07_how-i-became-a-hacker-before-i-finished-high-school/"
              >Ally Petitt: Youngest OSCP at 16yo. Over 11 CVEs by 18</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 23:57:59</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45586423"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45586339">
          <h3>
            <a class="item" href="https://www.fsf.org/news/librephone-project"
              >FSF announces Librephone project</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 23:47:08</span
              ><span class="points-container"
                >Points: <span class="points">430</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45586339"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45585869">
          <h3>
            <a
              class="item"
              href="https://www.androidauthority.com/graphene-os-major-android-oem-partnership-3606853/"
              >GrapheneOS is ready to break free from Pixels</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 22:36:40</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45585869"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45584498">
          <h3>
            <a
              class="item"
              href="https://www.lighthousereports.com/investigation/surveillance-secrets/"
              >Surveillance data challenges what we thought we knew about
              location tracking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 20:36:01</span
              ><span class="points-container"
                >Points: <span class="points">339</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45584498"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45584281">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/unpacking-cloudflare-workers-cpu-performance-benchmarks/"
              >Unpacking Cloudflare Workers CPU Performance Benchmarks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 20:17:44</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45584281"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45584226">
          <h3>
            <a
              class="item"
              href="https://www.benedelman.org/applovin-nonconsensual-installs/"
              >AppLovin nonconsensual installs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 20:13:53</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45584226"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45583787">
          <h3>
            <a
              class="item"
              href="https://tidbits.com/2025/10/09/how-to-turn-liquid-glass-into-a-solid-interface/"
              >How to turn liquid glass into a solid interface</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 19:27:41</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45583787"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45583574">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/research/economic-policy-responses"
              >Preparing for AI's economic impact: exploring policy responses</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 19:06:27</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45583574"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45583336">
          <h3>
            <a
              class="item"
              href="https://ourworldindata.org/does-the-news-reflect-what-we-die-from"
              >What Americans die from vs. what the news reports on</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 18:40:23</span
              ><span class="points-container"
                >Points: <span class="points">455</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45583336"
                  >Comments</a
                ><span class="descendants">: 253</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45583180">
          <h3>
            <a class="item" href="https://boydkane.com/essays/boss"
              >Beliefs that are true for regular software but false when applied
              to AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 18:26:00</span
              ><span class="points-container"
                >Points: <span class="points">281</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45583180"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45582758">
          <h3>
            <a class="item" href="https://smolbsd.org"
              >SmolBSD – build your own minimal BSD system</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 17:43:33</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45582758"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45582462">
          <h3>
            <a
              class="item"
              href="https://excamera.substack.com/p/how-bad-can-a-297-adc-be"
              >How bad can a $2.97 ADC be?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 17:12:10</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45582462"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45581735">
          <h3>
            <a class="item" href="https://accent-explorer.boldvoice.com/"
              >How AI hears accents: An audible visualization of accent
              clusters</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 16:07:37</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45581735"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45580771">
          <h3>
            <a class="item" href="https://github.com/metorial/metorial"
              >Show HN: Metorial (YC F25) – Vercel for MCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 14:49:56</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45580771"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <a href="https://metorial.com">https://metorial.com</a>), an
              integration platform that connects AI agents to external tools and
              data using MCP.
              <p>
                The Problem: While MCP works great locally (e.g., Cursor or
                Claude Desktop), server-side deployments are painful. Running
                MCP servers means managing Docker configs, per-user OAuth flows,
                scaling concurrent sessions, and building observability from
                scratch. This infrastructure work turns simple integrations into
                weeks of setup.
              </p>
              <p>
                Metorial handles all of this automatically. We maintain an open
                catalog of ~600 MCP servers (GitHub, Slack, Google Drive,
                Salesforce, databases, etc.) that you can deploy in three
                clicks. You can also bring your own MCP server or fork existing
                ones.
              </p>
              <p>
                For OAuth, just provide your client ID and secret and we handle
                the entire flow, including token refresh. Each user then gets an
                isolated MCP server instance configured with their own OAuth
                credentials automatically.
              </p>
              <p>
                What makes us different is that our serverless runtime
                hibernates idle MCP servers and resumes them with sub-second
                cold starts while preserving the state and connection. Our
                custom MCP engine is capable of managing thousands of concurrent
                connections, giving you a scalable service with per-user
                isolation. Other alternatives either run shared servers
                (security issues) or provision separate VMs per user (expensive
                and slow to scale).
              </p>
              <p>
                Our Python and TypeScript SDKs let you connect LLMs to MCP tools
                in a single function call, abstracting away the protocol
                complexity. But if you want to dig deep, you can just use
                standard MCP and our REST API (<a
                  href="https://metorial.com/api"
                  >https://metorial.com/api</a
                >) to connect to our platform.
              </p>
              <p>
                You can self-host (<a
                  href="https://github.com/metorial/metorial"
                  >https://github.com/metorial/metorial</a
                >) or use the managed version at
                <a href="https://metorial.com">https://metorial.com</a>.
              </p>
              <p>
                So far, we see enterprise teams use Metorial to have a central
                integration hub for tools like Salesforce, while startups use it
                to cut weeks of infra work on their side when building AI agents
                with integrations.
              </p>
              <p>
                Demo video:
                <a href="https://www.youtube.com/watch?v=07StSRNmJZ8"
                  >https://www.youtube.com/watch?v=07StSRNmJZ8</a
                >
              </p>
              <p>
                Our Repos: Metorial:
                <a href="https://github.com/metorial/metorial"
                  >https://github.com/metorial/metorial</a
                >, MCP Containers:
                <a href="https://github.com/metorial/mcp-containers"
                  >https://github.com/metorial/mcp-containers</a
                >
              </p>
              <p>
                SDKs: Node/TypeScript:
                <a href="https://github.com/metorial/metorial-node"
                  >https://github.com/metorial/metorial-node</a
                >, Python:
                <a href="https://github.com/metorial/metorial-python"
                  >https://github.com/metorial/metorial-python</a
                >
              </p>
              <p>
                We'd love to hear feedback, especially if you've dealt with
                deploying MCP at scale!
              </p>
            </div>
          </section>
        </section>
        <section id="45580699">
          <h3>
            <a
              class="item"
              href="https://www.mpg.de/25518363/1007-asph-astronomers-image-a-mysterious-dark-object-in-the-distant-universe-155031-x"
              >Astronomers 'image' a mysterious dark object in the distant
              Universe</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 14:45:02</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45580699"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45578540">
          <h3>
            <a class="item" href="https://ktye.github.io/"
              >Zoo of array languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 11:01:43</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45578540"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45578383">
          <h3>
            <a class="item" href="https://adsb.exposed/">ADS-B Exposed</a>
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 10:38:48</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45578383"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/ClickHouse/adsb.exposed/"
                >https://github.com/ClickHouse/adsb.exposed/</a
              >
              <p>
                <i>Show HN: ADS-B visualizer</i> -
                <a href="https://news.ycombinator.com/item?id=39990346"
                  >https://news.ycombinator.com/item?id=39990346</a
                >
                - April 2024 (76 comments)
              </p>
            </div>
          </section>
        </section>
        <section id="45544500">
          <h3>
            <a
              class="item"
              href="https://retrogamecoders.com/printing-petscii-faster/"
              >Printing Petscii Faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-10 @ 22:20:57</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45544500"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45544235">
          <h3>
            <a class="item" href="https://mazzo.li/posts/value-speculation.html"
              >Beating the L1 cache with value speculation (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-10 @ 21:54:43</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45544235"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45529534">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/interviewing-intels-chief-architect"
              >Interviewing Intel's Chief Architect of x86 Cores</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-09 @ 16:00:03</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45529534"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45515915">
          <h3>
            <a class="item" href="https://writings.agg.im/posts/hacking_ai_pin/"
              >Hacking the Humane AI Pin</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 13:24:53</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45515915"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45508462">
          <h3>
            <a
              class="item"
              href="https://turso.tech/blog/beyond-the-single-writer-limitation-with-tursos-concurrent-writes"
              >Beyond the SQLite single-writer limitation with concurrent
              writes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 20:32:55</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45508462"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45504902">
          <h3>
            <a
              class="item"
              href="https://webdev.bryanhogan.com/miscellaneous/styling-markdown/"
              >CSS for Styling a Markdown Post</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 16:05:01</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45504902"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45498887">
          <h3>
            <a
              class="item"
              href="https://www.trthaber.com/foto-galeri/karahantepede-12-bin-yil-oncesine-ait-insan-yuzlu-dikili-tas-bulundu/73912.html"
              >A 12,000-year-old obelisk with a human face was found in Karahan
              Tepe</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 02:43:03</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45498887"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45490737">
          <h3>
            <a
              class="item"
              href="https://mrkaran.dev/posts/ai-home-cooked-software/"
              >AI and Home-Cooked Software</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 12:41:52</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45490737"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
