<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42465661">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/openlayer/jobs/yIE9WI3-customer-engineer"
              >Openlayer (YC S21) is looking for a customer engineer to join our
              rocketship</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 21:00:59</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42465535">
          <h3>
            <a
              class="item"
              href="https://research.google/blog/satellite-powered-estimation-of-global-solar-potential/"
              >Satellite powered estimation of global solar potential</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 20:44:46</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42465535"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42465378">
          <h3>
            <a
              class="item"
              href="https://github.com/kooscode/srgh-matrix-trinity/blob/main/README.md"
              >Hardware Security Exploit Research – Xbox 360</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 20:26:33</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42465378"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42465109">
          <h3>
            <a class="item" href="http://weavesilk.com/"
              >Silk – Interactive Generative Art</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 19:55:48</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42465109"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42464966">
          <h3>
            <a class="item" href="https://mayhul.com/posts/type-driven-design/"
              >How types make hard problems easy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 19:38:00</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42464966"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42464557">
          <h3>
            <a
              class="item"
              href="https://roelsworld.eu/blog-music/music-geometry-intervals-scales/"
              >Music and Geometry: Intervals and Scales</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 18:52:43</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42464557"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42464310">
          <h3>
            <a class="item" href="https://mizu.sh"
              >Show HN: Mizu.js – Lightweight HTML templating library for
              any-side rendering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 18:25:55</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42464310"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'd like to share a fun project I've been working on: mizu.js.
              </p>
              <p>
                It's a js library that add functional attributes support into
                your html, designed to be a simple and flexible alternative to
                fully-fledged web frameworks (such as Vue, React, and Angular),
                while offering more capabilities than other lightweight options
                (like Alpine.js and htmx).
              </p>
              <p>
                As it's written using modern ES features and due to its
                isomorphic nature, it can be run in both browsers and runtimes
                (Node, Deno, Bun) without any changes. This makes it ideal for
                client-side and server-side rendering, as well as static site
                generation, whichever environment you prefer.
              </p>
              <p>
                Just include the script in any web page (or backend) to get
                started. You can template content, bind attributes, add
                interactivity, handle HTTP interactions, create custom
                components, and much more — all out of the box, without any
                configuration, transpilation steps, or builds.
              </p>
              <p>
                I hope you'll find mizu.js as exciting and useful as I do and
                I'd love to get your feedback! You can learn more about it at
                <a href="https://mizu.sh">https://mizu.sh</a>!
              </p>
              <p>
                Online playground:
                <a href="https://mizu.sh/playground"
                  >https://mizu.sh/playground</a
                >
                Custom builder:
                <a href="https://mizu.sh/build">https://mizu.sh/build</a> Code
                coverage:
                <a href="https://mizu.sh/coverage">https://mizu.sh/coverage</a>
                GitHub:
                <a href="https://github.com/lowlighter/mizu"
                  >https://github.com/lowlighter/mizu</a
                >
              </p>
              <p>## Motivation ##</p>
              <p>
                Nowadays, setting up a complete environment and installing
                thousands of packages is often required just to create a simple
                "Hello World" page. Yet, with the current ECMAScript standard,
                vanilla JS has never been more powerful. It offers built-in
                custom HTML components, proxies for changes tracking, weak
                references for better memory management, and many new data
                structures and methods.
              </p>
              <p>So why is web development still insanely complex?</p>
              <p>
                mizu.js aims to avoid adding bloat on top of native features,
                and instead focus on providing convenience helpers. It's
                basically "glue" around all these native features with added
                sugar, a recipe for a lightweight yet powerful utility.
              </p>
              <p>
                All evaluated expressions are interpreted as vanilla JavaScript,
                and you add your instructions directly into your HTML. So if you
                know already know about JS/HTML, then you're already 80% know of
                how to use mizu.js (add an extra 10% if you've used Vue,
                Alpine.js or htmx in the past as some syntax and concepts are
                inspired by it), the rest is basically just remembering the
                directive names. The learning curve is that small.
              </p>
              <p>
                Also, you may have heard of
                <a href="https://matcha.mizu.sh">https://matcha.mizu.sh</a>, a
                CSS stylesheet to instantly make your web page stylized. Well,
                it's a great companion to mizu.js. With both of them, you can
                create MVPs for your projects super fast!
              </p>
            </div>
          </section>
        </section>
        <section id="42464138">
          <h3>
            <a
              class="item"
              href="https://www.speakandregret.michaelinzlicht.com/p/revisiting-stereotype-threat"
              >Revisiting Stereotype Threat</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 18:08:29</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42464138"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42463943">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2412.13435"
              >Lightweight Safety Classification Using Pruned Language Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 17:49:07</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42463943"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                We prove that the intermediate hidden layers in transformers are
                robust feature extractors for text classification.
              </p>
              <p>
                On content safety, LEC models achieved a 0.96 F1 score vs
                GPT-4o's 0.82 and Llama Guard 8B's 0.71.The LEC models were able
                to outperform the other models with only 15 training examples
                for binary classification and 50 examples for multi-class
                classification across 66 categories.
              </p>
              <p>
                On prompt injection,LEC models achieved a 0.98 F1 score vs
                GPT-4o's 0.92 and deBERTa v3 Prompt Injection v2's 0.73. LEC
                models were able to outperform deBERTa with only 5 training
                examples and GPT-4o with only 55 training examples.
              </p>
              <p>
                Read the full paper and our approach here:
                <a href="https://arxiv.org/abs/2412.13435"
                  >https://arxiv.org/abs/2412.13435</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42463525">
          <h3>
            <a
              class="item"
              href="https://gnikoloff.github.io/webgpu-sponza-demo/"
              >WebGPU Tech Demo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 17:14:02</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42463525"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
            <div class="text">
              WebGPU tech demo running in modern browsers showcasing various
              rendering techniques like deferred rendering with 400+ dynamic
              lights, Hi-Z screen space reflections and cascaded shadow mapping.
            </div>
          </section>
        </section>
        <section id="42463315">
          <h3>
            <a class="item" href="https://huggingface.co/blog/modernbert"
              >A Replacement for BERT</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 16:53:58</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42463315"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42463295">
          <h3>
            <a
              class="item"
              href="https://www.chicagomag.com/chicago-magazine/january-2024/a-knife-forged-in-fire/"
              >A Knife Forged in Fire</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 16:51:32</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42463295"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42463123">
          <h3>
            <a class="item" href="https://www.nicbarker.com/clay"
              >Clay – UI Layout Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 16:36:54</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42463123"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42462348">
          <h3>
            <a class="item" href="https://github.com/LoSinCos/movie-iris"
              >Show HN: Movie Iris - Visualizing Films Through Color
              Extraction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 15:29:15</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42462348"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
            <div class="text">
              <p>
                Lots of things I would do differently now haha, but anyway,
                figured someone here might find it interesting.
              </p>
            </div>
          </section>
        </section>
        <section id="42461964">
          <h3>
            <a class="item" href="https://github.com/randombit/botan"
              >Botan: Crypto and TLS for Modern C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 14:58:30</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42461964"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42461860">
          <h3>
            <a class="item" href="https://github.com/retis-org/retis"
              >Tracing packets in the Linux kernel networking stack and
              friends</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 14:48:35</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42461860"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42461688">
          <h3>
            <a class="item" href="https://github.com/apankrat/nullboard"
              >Nullboard: Kanban board in a single HTML file</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 14:29:18</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42461688"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42460494">
          <h3>
            <a
              class="item"
              href="https://vintagetek.org/dvst-graphic-terminals/"
              >DVST Graphic Terminals</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 11:35:31</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42460494"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42460132">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41598-024-70633-x"
              >Cannabis pollen dispersal across the United States</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 10:17:56</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42460132"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42460131">
          <h3>
            <a
              class="item"
              href="https://github.com/tide-foundation/tidecloak-gettingstarted"
              >Show HN: TideCloak – Decentralized IAM for security and user
              sovereignty</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 10:17:52</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42460131"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                After 6 years of R&amp;D, our small team is excited to share our
                project TideCloak - an IAM designed to help developers move fast
                without worrying about catastrophic breaches or overpowered
                admins with keys to the kingdom.
              </p>
              <p>
                Traditional IAMs rely on centralized authority - admins, root
                certificates, and decryption keys - which create glaring
                vulnerabilities in a breach. To address this, we’ve integrated
                Keycloak (Red Hat’s IAM) with a decentralized key architecture
                powered by our (academically validated) Ineffable Cryptography.
              </p>
              <p>
                Here’s the idea: keys are split across a decentralized network
                (our Cybersecurity Fabric) so no one ever holds the full key.
                Even in a breach or F$%k up, there’s no unchecked authority
                exposed.
              </p>
              <p>
                Right now, TideCloak uses the Cybersecurity Fabric as an IdP,
                meaning users authenticate without their credentials being
                stored or shared. Essentially, users bring their own authority -
                without needing to trust anyone else to keep it safe.
              </p>
              <p>
                Coming soon: - Identity Governance Administration to prevent
                super admin abuse. - User-sovereign digital assets, where assets
                are secured with unique decentralized keys to protect against
                mass breaches.
              </p>
              <p>
                We’ve just launched a free developer sandbox, and we’d love your
                feedback:
                <a
                  href="https://github.com/tide-foundation/tidecloak-gettingstarted"
                  >https://github.com/tide-foundation/tidecloak-gettingstarted</a
                >
              </p>
              <p>
                It’s still early stages, and your input will help us improve.
              </p>
              <p>Thanks for taking a look - ask us anything!</p>
            </div>
          </section>
        </section>
        <section id="42460107">
          <h3>
            <a class="item" href="https://github.com/e7h4n/ccstate"
              >Show HN: CCState is a semantic, strict, and flexible state
              management library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 10:14:15</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42460107"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                The name of CCState comes from three basic data types: computed,
                command, and state.
              </p>
            </div>
          </section>
        </section>
        <section id="42458752">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/research/alignment-faking"
              >Alignment faking in large language models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 05:43:29</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42458752"
                  >Comments</a
                ><span class="descendants">: 257</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42454359">
          <h3>
            <a class="item" href="https://github.com/pwr-Solaar/Solaar"
              >Solaar is a Linux manager for many Logitech keyboards, mice, and
              other devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 19:57:58</span
              ><span class="points-container"
                >Points: <span class="points">605</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42454359"
                  >Comments</a
                ><span class="descendants">: 241</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42453939">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/investigates/special-report/usa-hackers-appin/"
              >How an Indian startup hacked the world (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 19:26:53</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42453939"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42453207">
          <h3>
            <a
              class="item"
              href="https://www.elevationlab.com/blogs/news/introducing-timecapsule"
              >A 10-Year Battery for AirTag</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 18:17:17</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42453207"
                  >Comments</a
                ><span class="descendants">: 213</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42441502">
          <h3>
            <a
              class="item"
              href="https://www.macrumors.com/2024/12/16/black-magic-3d-vision-pro-camera/"
              >Blackmagic Debuts $30K 3D Camera for Capturing Video for Vision
              Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 14:18:53</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42441502"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42440496">
          <h3>
            <a
              class="item"
              href="https://scholar.harvard.edu/files/mickens/files/thenightwatch.pdf"
              >The Night Watch [pdf] (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 11:29:26</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42440496"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42440121">
          <h3>
            <a
              class="item"
              href="https://main-horse.github.io/posts/visualizing-6d/"
              >Visualizing 6D Mesh Parallelism</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 10:26:36</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42440121"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42429646">
          <h3>
            <a
              class="item"
              href="https://nilam.ca/2024/11/02/time-for-a-code-yellow-a-blunt-instrument-that-works/"
              >Time for a Code-Yellow?: A Blunt Instrument That Works</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 10:09:25</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42429646"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42425770">
          <h3>
            <a
              class="item"
              href="https://mascontext.com/issues/trace/kowloon-walled-city-heterotopia-in-a-space-of-disappearance"
              >Kowloon Walled City: Heterotopia in a Space of Disappearance
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 20:30:04</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42425770"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
