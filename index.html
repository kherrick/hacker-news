<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42150443">
          <h3>
            <a
              class="item"
              href="https://www.roadandtrack.com/news/a62919131/tesla-has-highest-fatal-accident-rate-of-all-auto-brands-study/"
              >Tesla has the highest fatal accident rate of all auto brands,
              study finds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 20:15:08</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42150443"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42150376">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/11/i-too-installed-an-open-source-garage-door-opener-and-am-loving-it/"
              >Installed an open source garage door opener, and I'm loving it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 20:06:12</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42150376"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42150278">
          <h3>
            <a
              class="item"
              href="https://anderegg.ca/2024/11/15/maybe-bluesky-has-won"
              >Maybe Bluesky has "won"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 19:56:21</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42150278"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42150206">
          <h3>
            <a
              class="item"
              href="https://simondobson.org/2024/06/21/c%2B%2B-template-macroprogramming-versus-lisp-macros/"
              >C++ Template Macroprogramming versus Lisp Macros</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 19:47:18</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42150206"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42149785">
          <h3>
            <a class="item" href="https://www.cyph.com/"
              >Cyph – A cryptographically secure messaging and social networking
              service</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 19:00:31</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42149785"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42149694">
          <h3>
            <a
              class="item"
              href="https://slimsaas.com/blog/django-scaling-performance/"
              >The Practical Guide to Scaling Django</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 18:49:32</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42149694"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42149580">
          <h3>
            <a class="item" href="https://libretto.fm"
              >Show HN: Libretto – Simple recording and editing, an alternative
              to Descript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 18:34:36</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42149580"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>What makes Libretto unique:</p>
              <p>
                Local recording for high-quality audio/video: Libretto records
                media locally on each participant’s device and uploads it in the
                background, ensuring pristine quality even under poor network
                conditions. This works like double-ended recording but entirely
                within your browser.
              </p>
              <p>
                Powerful yet simple editing tools: Transcript-based editing:
                Edit audio/video as if you’re editing text. Automatic filler
                word removal: Get rid of "uhs" and "ums" with one click. Core
                editing tools like splitting, trimming, and cropping are
                intuitive for non-professionals.
              </p>
              <p>
                Collaborative and browser-based: No downloads required –
                everything runs in the browser. Teams can work together, sharing
                projects and edits in real time.
              </p>
              <p>Built with:</p>
              <p>
                LiveKit for webRTC infrastructure, Deepgram for transcriptions,
                Rendley’s video editing SDK and Liveblocks for real time shared
                state.
              </p>
              <p>
                Libretto is free to try, and we’d love your feedback to make it
                better. If you’re curious, check it out. Questions, thoughts, or
                suggestions? We’re here to listen!
              </p>
            </div>
          </section>
        </section>
        <section id="42149433">
          <h3>
            <a
              class="item"
              href="https://www.nps.gov/gaar/learn/nature/wood-frog-page-2.htm"
              >Biological Miracle – Wood Frog</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 18:16:08</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42149433"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42149044">
          <h3>
            <a class="item" href="https://closingwtf.com"
              >Show HN: Free mortgage analysis tool to avoid getting screwed by
              closing costs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 17:38:49</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42149044"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42148808">
          <h3>
            <a class="item" href="https://gliimly.github.io/"
              >Gliimly is a programming language for web services</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 17:15:23</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42148808"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42148543">
          <h3>
            <a class="item" href="https://github.com/thomasschafer/scooter"
              >Show HN: Scooter – Interactive find and replace in the
              terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 16:45:46</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42148543"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42148220">
          <h3>
            <a class="item" href="https://github.com/pex-tool/pex"
              >Pex: A tool for generating .pex (Python EXecutable) files, lock
              files and venvs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 16:13:47</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42148220"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42148163">
          <h3>
            <a
              class="item"
              href="https://mackey.substack.com/p/building-lawstar"
              >Building LawStar – a year long indie hacking journey</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 16:09:25</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42148163"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42147934">
          <h3>
            <a class="item" href="https://github.com/noneback/go-taskflow"
              >Go-taskflow: A taskflow-like General-purpose Task-parallel
              Programming Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 15:49:07</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42147934"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42147675">
          <h3>
            <a
              class="item"
              href="https://www.vice.com/en/article/fishermen-hunting-for-halibut-caught-a-us-nuclear-sub/"
              >Norwegian fishermen hunting for halibut caught a US nuclear
              sub</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 15:21:02</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42147675"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42146957">
          <h3>
            <a
              class="item"
              href="https://www.privatdozent.co/p/the-battle-line-at-louvain-1914"
              >The Battle Line at Louvain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 13:55:15</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42146957"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42146338">
          <h3>
            <a class="item" href="https://github.com/epasveer/seer"
              >Seer: A GUI front end to GDB for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 12:36:09</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42146338"
                  >Comments</a
                ><span class="descendants">: 151</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42146131">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/moderntreasury/269a944a-64e6-4dd1-b539-c9d5828ef0fe?utm_source=yYPEbOqnBd"
              >Modern Treasury (YC S18) Is Hiring a Product Designer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 12:00:33</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42145935">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/why-i-want-my-deaf-daughter-to-have-the-best-of-both-worlds"
              >The cochlear implant question</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 11:26:18</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42145935"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42145419">
          <h3>
            <a class="item" href="https://onair.io/"
              >Show HN: OnAir – create link, receive calls</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 09:58:11</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42145419"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
            <div class="text">
              <p>
                This is bootstrapped/indie hacker-ish. Would appreciate
                feedback.
              </p>
              <p>
                What it is: You create a link (e.g. onair/yourname), and anyone
                can call you from it. Caller uses a web browser to make the call
                (not dedicated app). You can create as many links as you want,
                and can direct calls to colleagues in a round-robin or
                escalation manner.
              </p>
              <p>
                In a way, it's like the "opposite of Calendly"; whereas Calendly
                is about meetings in the future, OnAir is about immediate
                meetings.
              </p>
              <p>
                Motivation behind it: One of our SaaS products was struggling to
                grow. We believed that if we provide more "hand holding" to
                visitors on the landing page, it will increase conversion. It's
                like speaking to the guy behind the counter before making a
                purchase. That idea/experiment, over time, became OnAir.
              </p>
              <p>
                Feedback: Identifying the perfect use case / customer has not
                been easy. E-Commerce store owners, which I thought would be
                ideal customer profile, are not responding as expected (e.g.
                "why use this instead of a WhatsApp button?"). The value of
                branded links, round-robin, recording/transcription, lead
                capture, etc does not seem to matter much to them. Ideas are
                welcome.
              </p>
            </div>
          </section>
        </section>
        <section id="42145329">
          <h3>
            <a class="item" href="https://www.nomodes.com/history/pub-manual"
              >Manual for PUB (a markup language in 1971) – Larry Tesler</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 09:42:02</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42145329"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42141761">
          <h3>
            <a
              class="item"
              href="https://computerhistory.org/blog/in-memoriam-thomas-e-kurtz-1928-2024/"
              >Thomas E. Kurtz has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-14 @ 22:12:09</span
              ><span class="points-container"
                >Points: <span class="points">428</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42141761"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42138289">
          <h3>
            <a class="item" href="https://dynomight.substack.com/p/chess"
              >Something weird is happening with LLMs and chess</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-14 @ 17:05:40</span
              ><span class="points-container"
                >Points: <span class="points">619</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42138289"
                  >Comments</a
                ><span class="descendants">: 416</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42135520">
          <h3>
            <a
              class="item"
              href="https://jan.miksovsky.com/posts/2024/11-12-momboard"
              >MomBoard: E-ink display for a parent with amnesia</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-14 @ 12:20:40</span
              ><span class="points-container"
                >Points: <span class="points">1801</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42135520"
                  >Comments</a
                ><span class="descendants">: 224</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42116038">
          <h3>
            <a class="item" href="https://github.com/nimrag-b/emiT-C"
              >Emit-C: A time travelling programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 15:10:25</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42116038"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42113557">
          <h3>
            <a
              class="item"
              href="https://tangchq74.github.io/FBDetect-SOSP24.pdf"
              >FBDetect: Catching Tiny Performance Regressions at Hyperscale
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 07:42:34</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42113557"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42108663">
          <h3>
            <a
              class="item"
              href="https://www.jstage.jst.go.jp/article/pjab/100/9/100_pjab.100.035/_article"
              >Incorporation of photosynthetically active algal chloroplasts in
              mammalian cells</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-11 @ 17:09:37</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42108663"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42099413">
          <h3>
            <a class="item" href="https://nullprogram.com/blog/2024/04/14/"
              >Speculations on arenas and custom strings in C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 10:13:41</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42099413"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42095134">
          <h3>
            <a
              class="item"
              href="https://www.cell.com/iscience/fulltext/S2589-0042(24)02416-7"
              >Chimpanzees' performance on computer tasks changes when people
              watching them</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-09 @ 16:08:35</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42095134"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42063617">
          <h3>
            <a
              class="item"
              href="https://dustri.org/b/upcoming-hardening-in-php.html"
              >Upcoming Hardening in PHP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 15:18:02</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42063617"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
