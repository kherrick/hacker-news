<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36296826">
          <h3>
            <a class="item" href="https://www.easypost.com/careers"
              >EasyPost (YC S13) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 17:00:43</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36296185">
          <h3>
            <a
              class="item"
              href="https://buttondown.email/anmonteiro/archive/melange-hits-v10/"
              >Melange 1.0: Compile OCaml / ReasonML to JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 16:28:51</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36296185"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36295557">
          <h3>
            <a class="item" href="https://libreplanet.org/wiki/Going_NoPhone"
              >Going NoPhone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 15:52:26</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36295557"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36295460">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36295460"
              >Launch HN: DevCycle (YC W14) – a feature flag platform built for
              developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 15:46:48</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36295460"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <a href="https://devcycle.com">https://devcycle.com</a>). DevCycle
              is a feature flag platform focused on developer experience, speed
              of delivery and long-term maintainability.
              <p>
                To give the platform a shot, anyone can sign up and use DevCycle
                for free here:
                <a href="https://devcycle.com">https://devcycle.com</a>
              </p>
              <p>
                Here’s a general platform demo video if you’re interested:
                <a href="https://www.youtube.com/watch?v=bZD-pyKGwR4"
                  >https://www.youtube.com/watch?v=bZD-pyKGwR4</a
                >
              </p>
              <p>
                Feature flagging is a technique that lets developers switch
                features on or off in a software application without redeploying
                it, enhancing testing and rollback capabilities. At their core,
                feature flagging platforms solve the problem of separating
                production code deploys from feature releases to users. While
                DevCycle solves that same general pain, we also aim to solve
                core problems in developer experience and code maintainability
                that hold developers back from fully adopting feature flagging
                into their workflow.
              </p>
              <p>
                In traditional feature flagging platforms, extended flag usage
                increases code complexity over time. Most engineers with feature
                flagging experience are worried about the build-up of stale
                flags and their code being filled with unnecessary conditionals.
                Dealing with this problem is important because if an engineer is
                worried about this increasing complexity, they are likely to
                avoid using feature flags.
              </p>
              <p>
                We came upon this problem when we were building Taplytics, the
                startup we joined YC with. We experienced it not only from our
                own struggles with feature flagging and transitioning to
                continuous deployment but also from our time spent with
                Taplytics customers who were often on the same journey.
              </p>
              <p>
                Given this experience, we developed DevCycle with a few core
                differences in how we solve these problems.
              </p>
              <p>
                Features, Not Just Flags: Many in-house and competitive feature
                flag systems operate on the simple idea that features exist in a
                binary state - they are either ‘ON’ or ‘OFF.’ In reality,
                software is never this simple. DevCycle treats features the same
                way you do in every other context, by attaching
                highly-extensible remote configuration to every feature in your
                product, allowing multiple flags to be combined under the
                context of a single feature and configured together.
              </p>
              <p>
                Developer Experience: To get the benefits of feature flagging
                you need broad adoption by all developers touching a codebase.
                Our primary goal is to provide the best developer experience
                possible. Providing tools and integrations so we can get out of
                developers’ way. For example, to address the problem of
                long-running feature flags that build up over time, we offer
                developer-facing features to easily track, detect (deploy
                pipeline actions), and eventually remove unnecessary technical
                debt (CLI code cleanup commands).
              </p>
              <p>
                Given that we are building this as a developer-first product,
                we’d love your feedback on whether our approach better fits your
                workflow and any other thoughts on our solution. Thanks so much!
              </p>
            </div>
          </section>
        </section>
        <section id="36295427">
          <h3>
            <a class="item" href="https://news.un.org/en/story/2023/05/1136667"
              >WHO advises against use of artificial sweeteners</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 15:45:15</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36295427"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36295364">
          <h3>
            <a
              class="item"
              href="https://www.neowin.net/news/edge-sends-images-you-view-online-to-microsoft-here-is-how-to-disable-that/"
              >Edge sends images you view online to Microsoft</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 15:40:47</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36295364"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36295227">
          <h3>
            <a
              class="item"
              href="https://generalrobots.substack.com/p/dimension-hopper-part-1"
              >Show HN: Stable Diffusion powered level editor for a 2D game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 15:31:55</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36295227"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              Hey folks, I’ve been working on using control-net to take in a
              video game level (input as a depth image) and output a beautiful
              illustration of that level. Play with it here: dimensionhopper.com
              or read the blog post about what it took to get it to work. Been a
              super fun project.
            </div>
          </section>
        </section>
        <section id="36295136">
          <h3>
            <a
              class="item"
              href="https://climatecasino.net/2023/06/wtf-is-happening-an-overview/"
              >WTF is Happening?: The concurrence of three climatic events</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 15:26:09</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36295136"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36294750">
          <h3>
            <a class="item" href="https://www.cloudflarestatus.com"
              >Cloudflare Is Having Issues</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 14:59:30</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36294750"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36294373">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36294373"
              >Ask HN: Dang, what do HN's traffic numbers look like today?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 14:43:50</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36294373"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text"><p>Can you provide any insights?</p></div>
          </section>
        </section>
        <section id="36294244">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36294244"
              >Reddit.com appears to be having an outage</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 14:37:59</span
              ><span class="points-container"
                >Points: <span class="points">557</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36294244"
                  >Comments</a
                ><span class="descendants">: 480</span></span
              >
            </h4>
            <div class="text">
              <p>&gt;Something went wrong. Just don't panic.</p>
              <p>&gt; Sorry, we couldn't load posts for this page. [RETRY]</p>
            </div>
          </section>
        </section>
        <section id="36293986">
          <h3>
            <a class="item" href="https://thewalrus.ca/canadarm/"
              >Canada’s Big Flex in Space</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 14:25:47</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36293986"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36293752">
          <h3>
            <a
              class="item"
              href="http://thomasburette.com/blog/2014/06/25/the-power-of-keeping-a-coding-journal/"
              >The power of keeping a coding journal (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 14:13:09</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36293752"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36293026">
          <h3>
            <a class="item" href="https://github.com/StevenBlack/hosts"
              >Block Adware and Malware with /etc/hosts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 13:24:38</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36293026"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36292831">
          <h3>
            <a
              class="item"
              href="https://www.thinkpenguin.com/gnu-linux/penguin-t4-gnulinux-laptop"
              >Penguin T4 GNU/Linux Laptop</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 13:08:41</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36292831"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36292522">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/legal/us-supreme-courts-dog-toy-ruling-puts-parody-products-notice-2023-06-12/"
              >US Supreme Court's dog toy ruling puts parody products on
              notice</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 12:44:09</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36292522"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36292413">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/conference/usenixsecurity23/presentation/rohlmann"
              >Every Signature Is Broken: Insecurity of Microsoft Office’s Ooxml
              Signatures</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 12:34:57</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36292413"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36292078">
          <h3>
            <a class="item" href="https://communitywiki.org/wiki/SmolNet"
              >The “smolnet”, build for friends and friends of friends</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 11:59:22</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36292078"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36291304">
          <h3>
            <a
              class="item"
              href="https://johnpweiss.com/blog/187270/life-is-so-terrible-and-beautiful-at-the-same-time"
              >Life Is So Terrible and Beautiful at the Same Time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 10:37:28</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36291304"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36291169">
          <h3>
            <a
              class="item"
              href="https://privsec.dev/posts/linux/desktop-linux-hardening/"
              >Desktop Linux Hardening (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 10:23:35</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36291169"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36290505">
          <h3>
            <a class="item" href="https://two-wrongs.com/why-perl.html"
              >Why Perl?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 09:13:01</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36290505"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36290467">
          <h3>
            <a
              class="item"
              href="https://digest.browsertech.com/archive/browsertech-digest-9801/"
              >Douglas Crockford on JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 09:07:22</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36290467"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36289424">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=6hJBko3-oV4"
              >Early 1980s Datsun/Nissan Voice Alert phonograph unit [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 07:02:54</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36289424"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36288834">
          <h3>
            <a
              class="item"
              href="https://stackoverflow.blog/2023/06/07/self-healing-code-is-the-future-of-software-development/"
              >Self-healing code is the future of software development</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 05:35:36</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36288834"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36288294">
          <h3>
            <a
              class="item"
              href="https://stable-diffusion-art.com/video-to-video/"
              >Video to video with Stable Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 03:59:15</span
              ><span class="points-container"
                >Points: <span class="points">382</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36288294"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36287809">
          <h3>
            <a
              class="item"
              href="https://vadimkravcenko.com/shorts/proper-documentation/"
              >The Surprising Power of Documentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 02:30:22</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36287809"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36287392">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2023/jun/10/who-needs-the-metaverse-meet-the-people-still-living-on-second-life"
              >Who needs the Metaverse? Meet the people still living on Second
              Life</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 01:06:55</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36287392"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36282843">
          <h3>
            <a class="item" href="http://jugglinglab.org/anim?915"
              >Juggling Lab GIF Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-11 @ 16:32:49</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36282843"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36281245">
          <h3>
            <a
              class="item"
              href="https://blog.metaobject.com/2023/06/mojo-is-much-better-without-c-than.html"
              >Mojo is a much better “Objective-C without the C” than Swift ever
              was</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-11 @ 13:37:39</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36281245"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36281178">
          <h3>
            <a
              class="item"
              href="https://www.bassi.io/articles/2017/08/10/dev-v-ops/"
              >Dev vs. Ops (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-11 @ 13:28:21</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36281178"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
