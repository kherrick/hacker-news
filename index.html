<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39763751">
          <h3>
            <a
              class="item"
              href="https://jmduke.com/posts/essays/weird-tests-tacit-knowledge/"
              >Use weird tests to capture tacit knowledge</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 07:50:24</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39763751"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39763750">
          <h3>
            <a
              class="item"
              href="https://sethmlarson.dev/regex-$-matches-end-of-string-or-newline"
              >Regex character "$" doesn't mean "end-of-string"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 07:50:09</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39763750"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39763595">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/health/wellness/world-happiness-report-americans-top-20-0f59cf98"
              >U.S. No Longer Ranks Among 20 Happiest Countries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 07:16:10</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39763595"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39763545">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-03-19/climate-change-speeds-up-as-major-indicators-blow-off-the-charts-wmo-warns"
              >Climate Change Speeds Up as Major Indicators Blow Off the Charts,
              WMO Warns</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 07:05:44</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39763545"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39763524">
          <h3>
            <a
              class="item"
              href="https://www.ashbyhq.com/careers?utm_source=hn&amp;ashby_jid=7458d4e9-da2e-47bd-98cb-adfda43d42b2"
              >Ashby (YC W19) Is Hiring Engineering Managers in EMEA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 07:00:37</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39763221">
          <h3>
            <a
              class="item"
              href="https://www.honest-broker.com/p/they-praised-ai-at-sxswand-the-audience"
              >They Praised AI at SXSW–and the Audience Started Booing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 05:51:45</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39763221"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39763104">
          <h3>
            <a
              class="item"
              href="https://act.eff.org/action/tell-congress-we-can-t-afford-more-bad-patents"
              >EFF: Tell Congress: We Can't Afford More Bad Patents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 05:28:18</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39763104"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39763074">
          <h3>
            <a
              class="item"
              href="https://simon.peytonjones.org/build-systems-a-la-carte-theory-and-practice/"
              >Build systems a la carte: theory and practice (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 05:22:00</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39763074"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39762890">
          <h3>
            <a class="item" href="https://github.com/diamondburned/dissent"
              >Dissent – A GTK4 Discord client written in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 04:35:24</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39762890"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39762807">
          <h3>
            <a
              class="item"
              href="https://benw.is/posts/how-i-improved-my-rust-compile-times-by-seventy-five-percent"
              >I Improved My Rust Compile Times by 75%</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 04:14:35</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39762807"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39762776">
          <h3>
            <a
              class="item"
              href="https://www.sciencenews.org/article/long-covid-brain-fog-blood-brain-barrier-damage"
              >Long Covid brain fog may be due to damaged blood vessels in the
              brain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 04:06:55</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39762776"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39762588">
          <h3>
            <a
              class="item"
              href="https://plantbasednews.org/news/science/fermented-foods-human-brain-growth/"
              >Study puts fermented foods, not fire, as pivotal moment in human
              brain growth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 03:20:28</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39762588"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39762495">
          <h3>
            <a
              class="item"
              href="https://www.jonashietala.se/blog/2024/03/19/lets_create_a_tree-sitter_grammar/"
              >Let's create a Tree-sitter grammar</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 02:55:25</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39762495"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39762315">
          <h3>
            <a class="item" href="https://thevahidal.github.io/soul/"
              >Soul: A SQLite REST and Realtime Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 02:14:53</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39762315"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39762128">
          <h3>
            <a
              class="item"
              href="https://github.com/cfusting/conditional-growth"
              >Show HN: Iteratively Building Virtual Creatures in Minecraft</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 01:35:00</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39762128"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                What I like about this work: iteratively finding solutions has a
                long and colorful history of doing things well: gradient
                boosting, ResNets, Stable Diffusion, etc. We're after some end
                optimal state and usually try to get right to it via some flavor
                of SGD. Baking in improvements as part of the problem structure
                is helpful. I like to think of this as solving the derivative of
                the solution with respect to time and then integrating over
                time. The Minecraft environment naturally prevents overfitting
                because you can spawn creatures in a diverse array of
                environments and train one policy over them all.
              </p>
              <p>
                What I don't like about this work: Minecraft was chosen for
                computational reasons but doesn't make cool creatures that walk
                around and look like cheetahs or whatever. I've compared it
                against nothing, but it works real good! &lt;g&gt;. Videos in
                the README.
              </p>
              <p>
                You can install / run with Docker and observe metrics with
                Tensorboard. Should be plug and play. If not comment. Enjoy!
              </p>
            </div>
          </section>
        </section>
        <section id="39761283">
          <h3>
            <a
              class="item"
              href="https://www.escmid.org/fileadmin/src/media/PDFs/2News_Discussions/Press_activities/2024/HIVCRISPRV4_1_.pdf"
              >HIV in cell culture can be completely eliminated using CRISPR-Cas
              gene editing [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 23:12:27</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39761283"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39761265">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2403.11207"
              >MindEye2: Shared-Subject Models Enable fMRI-to-Image with 1 Hour
              of Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 23:09:01</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39761265"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39760496">
          <h3>
            <a
              class="item"
              href="https://ginerlukas.com/publications/papers/WebGPUAttacks.pdf"
              >Generic and Automated Drive-By GPU Cache Attacks from the Browser
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 21:35:08</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39760496"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39760379">
          <h3>
            <a
              class="item"
              href="https://hrmacbeth.github.io/math2001/index.html"
              >The Mechanics of Proof</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 21:23:55</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39760379"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39760333">
          <h3>
            <a
              class="item"
              href="https://medicalxpress.com/news/2024-03-root-alzheimer-fat-buildup-brain.html"
              >Root cause of Alzheimer's may be fat buildup in brain cells,
              research suggests</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 21:19:38</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39760333"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39759906">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/featup-algorithm-unlocks-high-resolution-insights-computer-vision-0318"
              >New algorithm unlocks high-resolution insights for computer
              vision</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 20:28:09</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39759906"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39759693">
          <h3>
            <a class="item" href="https://brickinsights.com/statistics/ppp"
              >Lego price per part over the years</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 20:01:24</span
              ><span class="points-container"
                >Points: <span class="points">298</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39759693"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39759627">
          <h3>
            <a class="item" href="https://github.com/microsoft/retina"
              >Retina – eBPF distributed networking observability tool for
              Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 19:54:56</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39759627"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39759325">
          <h3>
            <a class="item" href="https://github.com/ynqa/jnv"
              >Show HN: jnv: interactive JSON filter using jq</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 19:23:23</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39759325"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39758667">
          <h3>
            <a class="item" href="https://nanochess.org/emulator.html"
              >Intel 8080 emulator. 19th IOCCC. Best of Show</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 18:15:29</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39758667"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39757665">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41593-024-01607-5"
              >Natural language instructions induce generalization in networks
              of neurons</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 16:47:29</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39757665"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39755927">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39755927"
              >Launch HN: Okapi (YC W24) – A new, flexible CRM with good UX</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 14:14:24</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39755927"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
            <div class="text">
              <p>
                We’re Ulysse and Ned from Okapi. We’re making a modern CRM. It's
                kind of like if Airtable/Notion built Salesforce today.
                <a href="https://okapicrm.com">https://okapicrm.com</a>
              </p>
              <p>
                When I was fresh out of college, working for startups,
                Salesforce was this big mystery to me. It's the perpetual second
                screen for everyone in sales. They were building this gigantic
                obelisk downtown. What was this thing? And why did every
                salesperson I knew seem to live in it all day, and yet hate it
                so much?
              </p>
              <p>
                Turns out Salesforce is basically PhpMyAdmin for salespeople.
                It's just basically two things:
              </p>
              <p>
                1. A really generic database, and a UI for CRUDing your data.
              </p>
              <p>2. An API and ecosystem of integrations.</p>
              <p>
                In other words, it's the back-office CRUD app to end all
                back-office CRUD apps. People call the result a "CRM" (Customer
                Relationship Management).
              </p>
              <p>
                Salesforce is slow and clunky. And that doesn’t matter because
                people don’t buy Salesforce to be delighted. They buy Salesforce
                to avoid being screwed over.
              </p>
              <p>
                SObjects are how Salesforce does that. It’s the best idea
                Salesforce ever had: make everything in your product be built
                upon a generic data layer that your users can configure. Just
                like how you can add a new sheet or column in a spreadsheet, in
                Salesforce you can add new objects and fields. You can CRUD,
                report on, and do automations on top of custom data in exactly
                the same way you do it for built-in data.
              </p>
              <p>
                The graveyard of wannabe Salesforces is littered with people who
                forgot about this key insight.
              </p>
              <p>
                We think the way you win in CRM in 2024 is by keeping the
                flexibility of SObjects, and then tacking on modern UX. That
                first part takes engineering discipline, but the second part is
                much easier than Salesforce had it 25 years ago. Just about
                every part of a modern SaaS product has dozens of vendors that
                do most of the work for you.
              </p>
              <p>
                We're really excited to get feedback from HN on what we have.
                Here’s a video demo:
                <a href="https://www.youtube.com/watch?v=4uRBf_9CRyM"
                  >https://www.youtube.com/watch?v=4uRBf_9CRyM</a
                >
                - and you can try it yourself:
              </p>
              <p>
                <a href="https://app.okapicrm.com">https://app.okapicrm.com</a>
              </p>
              <p>Email: hn.login.user@okapicrm.com</p>
              <p>Password: sk9ueEAfhXP9j4cuxLCVmw7.</p>
              <p>
                You can test out our email integration, send an email to:
                hn.demo@okapicrm.com
              </p>
              <p>
                And see that email (up to ~10min latency):
                <a href="https://app.okapicrm.com/objects/emails/records"
                  >https://app.okapicrm.com/objects/emails/records</a
                >
              </p>
              <p>
                We’re very eager for your honest feedback. What do you think
                we're missing? One thing we can’t decide if it’s a need-to-have
                is Apex -- is having in-transaction custom scripting really
                necessary for a CRM? Or is that just something they tacked on as
                Salesforce became more of an app platform and less of a focused
                CRM product?
              </p>
            </div>
          </section>
        </section>
        <section id="39751509">
          <h3>
            <a
              class="item"
              href="https://voltagedivide.com/2024/03/18/unconventional-uses-of-fpgas/"
              >Unconventional Uses of FPGAs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-18 @ 23:59:45</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39751509"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39745900">
          <h3>
            <a
              class="item"
              href="https://nautil.us/the-speediest-creatures-on-earth-532660/"
              >The Speediest Creatures on Earth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-18 @ 15:31:06</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39745900"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39744920">
          <h3>
            <a class="item" href="https://www.physics.uci.edu/node/14126"
              >Frederick Reines – A singing UCI Nobel Laureate who nearly bombed
              Nevada</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-18 @ 14:19:37</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39744920"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
