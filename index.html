<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37673494">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/lifeandstyle/2023/sep/24/lego-abandons-effort-to-make-bricks-from-recycled-plastic-bottles"
              >Lego abandons effort to make bricks from recycled plastic
              bottles</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 12:10:01</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37673494"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37673409">
          <h3>
            <a class="item" href="https://blog.roboflow.com/gpt-4-vision/"
              >First Impressions with GPT-4V(ision)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 12:01:18</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37673409"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37673300">
          <h3>
            <a
              class="item"
              href="https://www.bemyeyes.com/blog/announcing-be-my-ai"
              >Be My Eyes’ AI assistant starts rolling out</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 11:48:36</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37673300"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37672937">
          <h3>
            <a
              class="item"
              href="https://medium.com/@ErikKannike/building-a-defence-startup-6-lessons-ive-learned-11619b3a514e"
              >Building a defence startup</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 11:02:21</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37672937"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37672692">
          <h3>
            <a
              class="item"
              href="https://blog.appsignal.com/2023/09/27/an-introduction-to-litestack-for-ruby-on-rails.html"
              >An Introduction to LiteStack for Ruby on Rails</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 10:21:57</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37672692"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37671991">
          <h3>
            <a
              class="item"
              href="https://ariel-miculas.github.io/How-I-got-robbed-of-my-first-kernel-contribution/"
              >I got robbed of my first kernel contribution</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 08:58:04</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37671991"
                  >Comments</a
                ><span class="descendants">: 206</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37671565">
          <h3>
            <a
              class="item"
              href="https://www.nationalaffairs.com/publications/detail/the-truth-about-college-costs"
              >The Truth about College Costs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 08:03:32</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37671565"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37671419">
          <h3>
            <a class="item" href="https://nakst.gitlab.io/essence"
              >Essence: A desktop OS built from scratch, for control and
              simplicity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 07:44:37</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37671419"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37671341">
          <h3>
            <a class="item" href="https://github.com/laurentpayot/verticalize"
              >Show HN: A JavaScript function that looks and behaves like a pipe
              operator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 07:31:43</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37671341"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37670938">
          <h3>
            <a
              class="item"
              href="https://www.timdbg.com/posts/writing-a-debugger-from-scratch-part-5/"
              >Writing a debugger from scratch: Breakpoints</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 06:31:25</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37670938"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37670740">
          <h3>
            <a class="item" href="https://nullprogram.com/blog/2023/09/27/"
              >Arena allocator tips and tricks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 05:59:55</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37670740"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37669706">
          <h3>
            <a class="item" href="https://xrain.info/data/"
              >Show HN: XRain – Explore rainfall statistics around the world</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 03:36:23</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37669706"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
            <div class="text">
              <p>
                The business model is to sell "extreme precipitation" data that
                can be used for flood modelling. Unfortunately, after a year I
                still haven't made a single sale. I've tried various ways of
                advertising, mainly via messaging people on LinkedIn who would
                actually have a use for it. I'm still proud of what I've built,
                even if it's a flop!
              </p>
              <p>The tech stack is SolidJS with a Django API backend.</p>
              <p>
                Fun feature: jump to a completely random part of the world by
                clicking the "Random" button.
              </p>
              <p>
                I'd love feedback on anything, such as how to improve the UI/UX
                of the mobile view of the map page.
              </p>
            </div>
          </section>
        </section>
        <section id="37667731">
          <h3>
            <a
              class="item"
              href="https://go.dev/blog/deconstructing-type-parameters"
              >Deconstructing Go Type Parameters</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 00:05:45</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37667731"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37667450">
          <h3>
            <a
              class="item"
              href="https://radar.com/blog/introducing-radar-maps-platform"
              >Radar Maps Platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 23:38:48</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37667450"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37666773">
          <h3>
            <a
              class="item"
              href="https://github.com/merlinmann/wisdom/blob/master/wisdom.md"
              >Merlin's Wisdom Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 22:38:55</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37666773"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37665988">
          <h3>
            <a class="item" href="https://kapouay.eu.org/notes/sysclean-intro/"
              >Introduction to sysclean(8)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 21:24:09</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37665988"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37665946">
          <h3>
            <a
              class="item"
              href="https://www.gamedeveloper.com/blogs/my-40-years-in-the-game-industry"
              >Warren Spector – 40 years and I'm still here</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 21:18:48</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37665946"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37663270">
          <h3>
            <a class="item" href="https://raverie-us.github.io/raverie-engine/"
              >Show HN: Unity like game editor running in pure WASM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 17:58:47</span
              ><span class="points-container"
                >Points: <span class="points">591</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37663270"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
            <div class="text">
              <p>
                We’re building off a previous engine that we worked on for
                DigiPen Institute of Technology called the Zero Engine with a
                similar component based design architecture to Unity. Our engine
                had a unique feature called Spaces: separate worlds/levels that
                you can instantiate and run at the same time, which became super
                useful for creating UI overlays using only game objects, running
                multiple simulations, etc. The lighting and rendering engine is
                scriptable, and the default deferred rendering implementation is
                based on the Unreal physically based rendering (PBR) approach.
                The physics engine was built from the ground up to handle both
                2D and 3D physics together. The scripting language was also
                built in house to be a type safe language that binds to C++
                objects and facilitates auto-complete (try it in editor!)
              </p>
              <p>
                This particular fork by Raverie builds both the engine and
                editor to WebAssembly using only clang without Emscripten. We
                love Emscripten and in fact borrowed a tiny bit of exception
                code that we’d love to see up-streamed into LLVM, however we
                wanted to create a pure WASM binary without Emscripten bindings.
                We also love WASI too though we already had our own in memory
                virtual file system, hence we don’t use the WASI imports. All
                WASM imports and exports needed to run the engine are defined
                here:
                <a
                  href="https://github.com/raverie-us/raverie-engine/blob/main/Code/Foundation/Platform/PlatformCommunication.hpp"
                  >https://github.com/raverie-us/raverie-engine/blob/main/Code/...</a
                >
              </p>
              <p>
                The abstraction means that in the future, porting to other
                platforms that can support a WASM runtime should be trivial.
                It’s our dream to be able to export a build of your game to any
                platform, all from inside the browser. Our near term road-map
                includes getting the sound engine integrated with WebAudio,
                getting the script debugger working (currently freezes), porting
                our networking engine to WebRTC and WebSockets, and getting
                saving/loading from a database instead of browser local storage.
              </p>
              <p>
                Our end goal is to use this engine to create an online
                Flash-like hub for games that people can share and remix, akin
                to Scratch or Tinkercad.
              </p>
              <p>
                <a href="https://github.com/raverie-us/raverie-engine"
                  >https://github.com/raverie-us/raverie-engine</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37662655">
          <h3>
            <a class="item" href="https://fabiensanglard.net/st/index.html"
              >Exploring Linux command-line space time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 17:21:12</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37662655"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37658208">
          <h3>
            <a
              class="item"
              href="https://jackevansevo.github.io/my-unhealthy-relationship-with-keyboards.html"
              >My Unhealthy Relationship with Keyboards</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 12:22:21</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37658208"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37658151">
          <h3>
            <a class="item" href="https://bt.ht/x220/">The X220 ThinkPad</a>
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 12:15:59</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37658151"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37657672">
          <h3>
            <a class="item" href="https://github.com/nbittich/adana"
              >Show HN: Adding dynamic library loading to my pet programming
              language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 11:25:20</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37657672"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37656993">
          <h3>
            <a
              class="item"
              href="https://hackaday.com/2017/01/18/forrest-mims-radio-shack-and-the-notebooks-that-launched-a-thousand-careers/"
              >Forrest Mims and RadioShack (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 10:06:39</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37656993"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37655758">
          <h3>
            <a class="item" href="https://github.com/cymonsgames/ASCIIpOrtal"
              >ASCIIpOrtal: A Portal Game You Can Play in Your Terminal
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 07:35:30</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37655758"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37655298">
          <h3>
            <a
              class="item"
              href="https://www.lrb.co.uk/the-paper/v08/n22/ian-hacking/knowledge"
              >Knowledge (1986)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 06:42:25</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37655298"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37650402">
          <h3>
            <a
              class="item"
              href="https://www.cambridgeblog.org/2023/05/a-journey-into-the-shaken-baby-syndrome-abusive-head-trauma-controversy/"
              >A journey into the shaken baby syndrome/abusive head trauma
              controversy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 20:49:09</span
              ><span class="points-container"
                >Points: <span class="points">664</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37650402"
                  >Comments</a
                ><span class="descendants">: 348</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37647467">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/quest-for-the-golden-owl-hidden-treasure"
              >The possibly never-ending quest for the golden owl</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 17:24:49</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37647467"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37644493">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-09-donated-artifacts-treasure-trove-neanderthal.html"
              >Box of donated artifacts turns out to be treasure trove of
              Neanderthal bones</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 14:35:22</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37644493"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37632513">
          <h3>
            <a
              class="item"
              href="https://thehustle.co/one-mans-quest-to-end-cheating-in-virtual-cycling/"
              >One man’s quest to end cheating in virtual cycling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-24 @ 12:32:06</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37632513"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37630758">
          <h3>
            <a
              class="item"
              href="https://medium.com/@paulmorrishill/building-a-string-art-machine-eeee386a38db"
              >Building a string art machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-24 @ 06:52:48</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37630758"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
