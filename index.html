<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45492564">
          <h3>
            <a class="item" href="https://getgrapevine.ai/"
              >Launch HN: Grapevine (YC S19) – A company GPT that actually
              works</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 15:39:59</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45492564"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <a href="https://getgrapevine.ai">https://getgrapevine.ai</a>), a
              knowledge search system for AI agents that connects Slack, GDrive,
              Notion, codebases, and more. Our first app is a company GPT that
              significantly outperforms existing alternatives.
              <p>
                Anyone can setup a Grapevine Slack bot and have it respond to
                and optionally proactively answer questions that require company
                context. Here’s a demo video with examples:
                <a href="https://youtu.be/_nrfbZzvxU8"
                  >https://youtu.be/_nrfbZzvxU8</a
                >
              </p>
              <p>
                We built Grapevine because we were interested in a ChatGPT that
                fully understands your company. We'd tried many of the existing
                tools (including expensive enterprise ones), but while they were
                good at answering “what is X team’s Q4 goal,” they weren’t good
                at the day-to-day questions that actually blocked people.
              </p>
              <p>
                So, our founders and early engineers created a set of 100+
                representative questions, from hard technical questions to
                company-specific knowledge questions. At first, the
                state-of-the-art “enterprise search” products were getting about
                50% of them correct, and our in-house system was getting 35%.
                But as we solved details in data processing, search algorithm,
                and more, we eventually achieved 85%. (For reference, the best
                human score our founders got was 70%)
              </p>
              <p>
                It’s changed the way we work: popular engineering channels that
                have 5+ questions / day are fully answered proactively by AI,
                and people across departments go to the bot first for bug
                reports, incidents, and support tickets. Dozens of our beta
                customers have been consistently surprised by the quality of the
                answers, too.
              </p>
              <p>
                Security is obviously super important for a product like this.
                We will never train on your data. In addition, your data is
                encrypted at rest, in an isolated database from other customers,
                and the system is SOC 2 compliant with regularly scheduled pen
                tests. We built it to Gather’s (<a href="https://gather.town/"
                  >https://gather.town/</a
                >) SOC 2 Type II standards - that’s the original virtual office
                product we launched (and still maintain) out of YC, but we’ve
                since pivoted to Grapevine.
              </p>
              <p>
                We put a lot of effort into making Grapevine easy to set up. You
                can try it now, for free, at
                <a href="https://getgrapevine.ai">https://getgrapevine.ai</a>
              </p>
            </div>
          </section>
        </section>
        <section id="45492410">
          <h3>
            <a
              class="item"
              href="https://pluralistic.net/2025/10/06/rogue-capitalism/#orphaned-syrian-refugees-need-not-apply"
              >Apple's Unlawful Evil</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 15:25:12</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45492410"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45492086">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/report/791213/xbox-cloud-gaming-free-ad-supported-version"
              >Microsoft is about to launch free Xbox Cloud Gaming with ads</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 14:53:46</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45492086"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45491621">
          <h3>
            <a class="item" href="https://github.com/jdx/mise/discussions/6564"
              >Mise: Monorepo Tasks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 14:07:46</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45491621"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45491609">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/swatson555/8cc36d8d022d7e5cc44a5edb2c4f7d0b"
              >Show HN: Kent Dybvig's Scheme Machine in 400 Lines of C
              (Heap-Memory Model)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 14:06:29</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45491609"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45490703">
          <h3>
            <a class="item" href="https://etn.se/72494"
              >AI has found 50 bugs in cURL. "AI-native SASTs work well"</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 12:37:52</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45490703"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45490578">
          <h3>
            <a class="item" href="https://write-it-down.com"
              >Show HN: Write It Down – Personal finance tracker</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 12:23:40</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45490578"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
            <div class="text">
              <p>
                In 2020, I made it to track my own finances for income,
                expenses, savings, yearly summaries etc. I shared it once on
                Reddit, forgot about it for a year… When I checked back, it had
                over 130k views and I was honestly stoked!
              </p>
              <p>
                No launch. No funding. No AI. Just a spreadsheet people actually
                stick with and find useful.
              </p>
              <p>
                I finally gave it a proper home: write-it-down.com Now, more
                than 2,300 people use it.
              </p>
              <p>It’s intentionally boring and that’s why it works.</p>
              <p>
                People don’t always need AI. They just need something that
                actually solves their problem. This isn’t a billion-dollar
                startup of course, but it taught me more about building products
                than almost anything else.
              </p>
              <p>
                Build something useful. Solve a real problem. Even if it’s just
                a simple spreadsheet.
              </p>
              <p>
                So, what’s the most “boring” thing you’ve built that found
                unexpected traction?
              </p>
            </div>
          </section>
        </section>
        <section id="45490549">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/amd-signs-ai-chip-supply-deal-with-openai-gives-it-option-take-10-stake-2025-10-06/"
              >AMD signs AI chip-supply deal with OpenAI, gives it option to
              take a 10% stake</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 12:17:59</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45490549"
                  >Comments</a
                ><span class="descendants">: 185</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45490439">
          <h3>
            <a
              class="item"
              href="https://www.codedge.de/posts/modern-messaging-running-your-own-xmpp-server"
              >Modern messaging: Running your own XMPP server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 12:02:45</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45490439"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45489581">
          <h3>
            <a
              class="item"
              href="https://0xmm.in/posts/peer-to-peer-windows-part1/"
              >Build a VPN Tunnel with Wintun on Windows – Part 1</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 09:49:33</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45489581"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45489533">
          <h3>
            <a
              class="item"
              href="https://www.nobelprize.org/prizes/medicine/2025/press-release/"
              >Nobel Prize in Physiology or Medicine 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 09:41:16</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45489533"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45489174">
          <h3>
            <a class="item" href="https://demodesk.com/careers"
              >Demodesk (YC W19) Is Hiring a Ruby on Rails Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 08:49:30</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45488713">
          <h3>
            <a class="item" href="https://batteringram.eu/"
              >Battering RAM – Low-Cost Interposer Attacks on Confidential
              Computing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 07:47:17</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45488713"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45488441">
          <h3>
            <a class="item" href="https://www.flightcontrol.dev/"
              >Flightcontrol: AWS PaaS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 07:07:11</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45488441"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45488261">
          <h3>
            <a class="item" href="https://structuredprocrastination.com"
              >Structured Procrastination (1995)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 06:35:36</span
              ><span class="points-container"
                >Points: <span class="points">353</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45488261"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45487771">
          <h3><a class="item" href="https://gem.coop/">Gem.coop</a></h3>
          <section>
            <h4>
              <span>2025-10-06 @ 04:59:39</span
              ><span class="points-container"
                >Points: <span class="points">236</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45487771"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45487476">
          <h3>
            <a class="item" href="https://blog.archive.org/trillion/"
              >1 Trillion Web Pages Archived</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 03:48:34</span
              ><span class="points-container"
                >Points: <span class="points">497</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45487476"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45487044">
          <h3>
            <a class="item" href="https://vgel.me/posts/seahorse/"
              >Why do LLMs freak out over the seahorse emoji?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 02:20:05</span
              ><span class="points-container"
                >Points: <span class="points">598</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45487044"
                  >Comments</a
                ><span class="descendants">: 307</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45485736">
          <h3>
            <a class="item" href="https://kenparkerarchtops.com"
              >Ken Parker, famed luthier, has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 22:10:15</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45485736"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45485546">
          <h3>
            <a
              class="item"
              href="https://joinreboot.org/p/lighthouses-in-the-sky"
              >The dangerous intimacy of social location sharing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 21:44:01</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45485546"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45483924">
          <h3>
            <a class="item" href="https://fi-le.net/oss/"
              >What GPT-OSS leaks about OpenAI's training data</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 18:28:16</span
              ><span class="points-container"
                >Points: <span class="points">308</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45483924"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45483386">
          <h3>
            <a
              class="item"
              href="https://koreajoongangdaily.joins.com/news/2025-10-01/national/socialAffairs/NIRS-fire-destroys-governments-cloud-storage-system-no-backups-available/2412936"
              >Fire destroys S. Korean government's cloud storage system, no
              backups available</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 17:20:39</span
              ><span class="points-container"
                >Points: <span class="points">1849</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45483386"
                  >Comments</a
                ><span class="descendants">: 825</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://www.chosun.com/english/national-en/2025/10/02/FPWGFSXMLNCFPIEGWKZF3BOQ3M/"
                >https://www.chosun.com/english/national-en/2025/10/02/FPWGFS...</a
              >
            </div>
          </section>
        </section>
        <section id="45481892">
          <h3>
            <a
              class="item"
              href="https://www.abortretry.fail/p/the-qnx-operating-system"
              >The QNX Operating System</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 14:47:13</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45481892"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45465824">
          <h3>
            <a
              class="item"
              href="https://www.inkandswitch.com/ink/notes/ink-deformation-review/"
              >Ink Deformation – A Review</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 18:01:59</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45465824"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45465821">
          <h3>
            <a class="item" href="https://github.com/fleximus/pfjson"
              >CLI tool to convert OpenBSD Packet Filter config files to JSON
              and vice versa</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 18:01:48</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45465821"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45459466">
          <h3>
            <a
              class="item"
              href="https://www.matheusmoreira.com/articles/delimited-continuations-in-lone-lisp"
              >Delimited Continuations in Lone Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 05:52:06</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45459466"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45456965">
          <h3>
            <a class="item" href="https://web.evanchen.cc/napkin.html"
              >Basic Math Textbook: The Napkin Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-02 @ 23:46:40</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45456965"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45453818">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/ironcub-jet-powered-flying-robot"
              >IRonCub: A Humanoid Robot Designed to Fly Like Iron Man</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-02 @ 18:54:12</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45453818"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45448747">
          <h3>
            <a
              class="item"
              href="https://magic-wormhole.readthedocs.io/en/latest/welcome.html"
              >Magic Wormhole: Get things from one computer to another,
              safely</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-02 @ 12:25:41</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45448747"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45447226">
          <h3>
            <a class="item" href="https://www.srb2.org/"
              >Sonic Robo Blast 2: 25 year old continuously developed DOOM
              engine-based fangame</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-02 @ 07:50:36</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45447226"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
