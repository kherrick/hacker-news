<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38078063">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/10/apple-unveils-m3-m3-pro-and-m3-max-the-most-advanced-chips-for-a-personal-computer/"
              >Apple unveils M3, M3 Pro, and M3 Max, the most advanced chips for
              a PC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 00:30:14</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38078063"
                  >Comments</a
                ><span class="descendants">: 457</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38077889">
          <h3>
            <a
              class="item"
              href="https://opensource.googleblog.com/2023/10/android-and-risc-v-what-you-need-to-know.html"
              >Android and RISC-V: What you need to know to be ready</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 00:12:08</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38077889"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38077684">
          <h3>
            <a
              class="item"
              href="https://news.artnet.com/opinion/devon-rodriguez-parasocial-aesthetics-2380960"
              >World's most popular painter sent his followers after me because
              of my review</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 23:52:38</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38077684"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38077521">
          <h3>
            <a class="item" href="https://together.ai/blog/redpajama-data-v2"
              >RedPajama v2 Open Dataset with 30T Tokens for Training LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 23:38:01</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38077521"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38077502">
          <h3>
            <a
              class="item"
              href="https://omarkama.li/blog/web-scraping-data-for-everyone"
              >Web Scraping: Data for Everyone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 23:36:21</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38077502"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38077341">
          <h3>
            <a
              class="item"
              href="https://www.nationalaffairs.com/publications/detail/the-education-of-robert-putnam"
              >The Education of Robert Putnam</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 23:19:41</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38077341"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38077315">
          <h3>
            <a
              class="item"
              href="https://www.publicbooks.org/i-began-with-sound/"
              >I Began with Sound</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 23:17:07</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38077315"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38077262">
          <h3>
            <a
              class="item"
              href="https://newcriterion.com/blogs/dispatch/ever-enduring-durer"
              >Ever-Enduring DÃ¼rer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 23:12:19</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38077262"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38076886">
          <h3>
            <a class="item" href="https://grugbrain.dev/"
              >The Grug Brained Developer (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 22:33:26</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38076886"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38076636">
          <h3>
            <a
              class="item"
              href="https://www.sec.gov/news/press-release/2023-227"
              >SEC Charges SolarWinds and CISO with Fraud, Internal Control
              Failures</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 22:08:52</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38076636"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38075973">
          <h3>
            <a
              class="item"
              href="https://rylandscollections.com/2023/06/21/a-new-view-of-the-manchester-computer/"
              >A new view of the Manchester Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 21:15:36</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38075973"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38075924">
          <h3>
            <a
              class="item"
              href="https://knowingmachines.org/knowing-legal-machines/legal-explainer/questions/can-i-remove-my-personal-data-from-genai-training-datasets"
              >Can I remove my personal data from GenAI training datasets?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 21:12:55</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38075924"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074992">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/gmail/gmail-security-authentication-spam-protection/"
              >Gmail, Yahoo announce new 2024 authentication requirements for
              bulk senders</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 20:07:07</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074992"
                  >Comments</a
                ><span class="descendants">: 261</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074739">
          <h3>
            <a
              class="item"
              href="https://jacobbartlett.substack.com/p/through-the-ages-apple-cpu-architecture"
              >Apple CPU Architecture Through the Ages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 19:51:03</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074739"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074701">
          <h3>
            <a class="item" href="https://youglish.com/"
              >Use YouTube to improve your English pronunciation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 19:47:10</span
              ><span class="points-container"
                >Points: <span class="points">331</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074701"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074406">
          <h3>
            <a
              class="item"
              href="https://datenlord.github.io/xline-home/#/blog/2023-08-18-Introduction-to-CURP-Protocol"
              >Introduction to CURP Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 19:23:41</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074406"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38073512">
          <h3>
            <a class="item" href="https://kartproject.org/"
              >Kart: DVC for geospatial and tabular data. Git for GIS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 18:22:18</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38073512"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38072278">
          <h3>
            <a class="item" href="http://recursivedrawing.com/"
              >Recursive Drawing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 17:06:28</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38072278"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38072277">
          <h3>
            <a
              class="item"
              href="https://zilliz.com/learn/approximate-nearest-neighbor-oh-yeah-ANNOY"
              >Approximate Nearest Neighbor Oh Yeah (Annoy)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 17:06:28</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38072277"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38072218">
          <h3>
            <a
              class="item"
              href="https://www.afr.com/technology/google-brain-founder-says-big-tech-is-lying-about-ai-human-extinction-danger-20231027-p5efnz"
              >Google Brain founder says big tech is lying about AI danger</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 17:03:37</span
              ><span class="points-container"
                >Points: <span class="points">319</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38072218"
                  >Comments</a
                ><span class="descendants">: 329</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38072012">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41565-023-01527-8"
              >DNA turbine powered by a transmembrane potential across a
              nanopore</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 16:49:30</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38072012"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38071552">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38071552"
              >Show HN: Unlogged â open-source record and replay for Java</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 16:17:41</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38071552"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                Both Parth and I come from an e-commerce/payments background
                where production bugs meant heavy financial losses. Big billion
                days/Black Friday sales meant months of code freezes with low
                productivity. Before committing the code, we wanted to replay
                production traffic and know the breaking changes right away,
                like in sub-second. Kind of like unit+integration tests on
                steroids.
              </p>
              <p>
                So, we built an SDK that adds probes to the code in compile
                time. The SDK logs code execution, in detail.
              </p>
              <p>Git: https://github.com/unloggedio/unlogged-sdk</p>
              <p>
                We also built an IDE plugin that keeps monitoring code changes,
                hot reloads these changes, replays the relevant methods, and
                alerts on failing replays. It also lets developers call Java
                methods directly, mock downstream methods in run time, highlight
                code coverage in real-time, and show performance numbers for
                methods with inlay hints. (right above each method)
              </p>
              <p>Git: https://github.com/unloggedio/intellij-java-plugin</p>
              <p>
                We are excited to launch the first version of our product that
                replays with assertions + mocking + code coverage reports right
                inside the IDE.
              </p>
              <p>
                Link to our IntelliJ plugin:
                https://plugins.jetbrains.com/plugin/18529-unlogged/
              </p>
              <p>
                Record and Replay Demo:
                https://www.youtube.com/watch?v=muCyE-doEB0
              </p>
              <p>
                Define Assertions on Replay:
                https://www.youtube.com/watch?v=YKsi1p634-M
              </p>
              <p>
                Track Code Coverage: https://www.youtube.com/watch?v=NMmp954kfaU
              </p>
              <p>
                Generate JUnit Test Cases:
                https://www.youtube.com/watch?v=rTUmg5b1Z_Q
              </p>
              <p>
                Mocking when replaying:
                https://www.youtube.com/watch?v=O_aqU1u-Kmw
              </p>
              <p>Documentation: http://read.unlogged.io/</p>
              <p>Roadmap:</p>
              <p>1. Create a production logger</p>
              <p>-So that the performance impact is minimal</p>
              <p>-out of the box masking PII from production logs</p>
              <p>
                -creating meaningful input/return value combinations from
                production traffic to be replayed locally.
              </p>
              <p>
                2. Creating a CI test runner that can integrate with CI/CD
                pipelines.
              </p>
              <p>3. Auto-Replaying API endpoints of only the changed code.</p>
              <p>
                4. Real-time alerts for the performance impact of code changes.
              </p>
              <p>5. Creating a dashboard with reports, email/slack alerts.</p>
            </div>
          </section>
        </section>
        <section id="38070001">
          <h3>
            <a
              class="item"
              href="https://engineering.fb.com/2023/10/24/data-infrastructure/automating-dead-code-cleanup/"
              >Automating Dead Code Cleanup</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 14:41:35</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38070001"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38069974">
          <h3>
            <a class="item" href="https://quic.video/blog/replacing-webrtc/"
              >Replacing WebRTC: real-time latency with WebTransport and
              WebCodecs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 14:38:36</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38069974"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38069915">
          <h3>
            <a
              class="item"
              href="https://robertovitillo.com/costs-of-microservices/"
              >The costs of microservices (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 14:33:41</span
              ><span class="points-container"
                >Points: <span class="points">323</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38069915"
                  >Comments</a
                ><span class="descendants">: 325</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38069710">
          <h3>
            <a
              class="item"
              href="https://ludic.mataroa.blog/blog/i-accidentally-saved-half-a-million-dollars/"
              >I accidentally saved my company half a million dollars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 14:15:07</span
              ><span class="points-container"
                >Points: <span class="points">823</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38069710"
                  >Comments</a
                ><span class="descendants">: 365</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38069659">
          <h3>
            <a
              class="item"
              href="https://odigos.io/blog/ebpf-instrumentation-faster-than-manual"
              >eBPF-based auto-instrumentation outperforms manual
              instrumentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 14:10:22</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38069659"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38069197">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/ideas/archive/2023/10/private-equity-publicly-traded-companies/675788/"
              >Private equity is devouring the U.S. economy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 13:25:47</span
              ><span class="points-container"
                >Points: <span class="points">336</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38069197"
                  >Comments</a
                ><span class="descendants">: 371</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38067822">
          <h3>
            <a
              class="item"
              href="https://gregoryszorc.com/blog/2023/10/30/my-user-experience-porting-off-setup.py/"
              >My User Experience Porting Off Setup.py</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 10:51:56</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38067822"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38067494">
          <h3>
            <a
              class="item"
              href="https://www.sciencedaily.com/releases/2023/10/231026131628.htm"
              >People with autism less likely to succumb to bystander effect,
              research finds</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 10:05:37</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38067494"
                  >Comments</a
                ><span class="descendants">: 207</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
