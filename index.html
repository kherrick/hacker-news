<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37760486">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/features/2023-09-28/google-user-data-is-police-s-top-shortcut-for-solving-crimes"
              >Google User Data Is Police's Top Shortcut for Solving Crimes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 03:22:52</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37760486"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37760363">
          <h3>
            <a
              class="item"
              href="https://twitter.com/ben_fry/status/1709400641456501020"
              >Ben Fry Resigns from the Processing Foundation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 03:02:18</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37760363"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37760309">
          <h3>
            <a
              class="item"
              href="https://www.motherjones.com/crime-justice/2023/10/supreme-court-pulsifer-criminal-justice-drug-definitions/"
              >Does “and” Mean “and”? Or “Or”? The Supreme Court Will Decide</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 02:54:11</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37760309"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37760130">
          <h3>
            <a class="item" href="https://robotics-transformer-x.github.io/"
              >RT-X: the largest open-source robot dataset</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 02:24:01</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37760130"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37759873">
          <h3>
            <a
              class="item"
              href="https://moxie.org/2013/01/07/career-advice.html"
              >Pretty good career and life advice</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 01:37:29</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37759873"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37759871">
          <h3>
            <a
              class="item"
              href="https://darnell.day/bbc-gives-up-on-threads-by-instagram-sticks-with-mastodon"
              >BBC gives up on Threads, sticks with Mastodon</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 01:37:03</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37759871"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37759668">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2307.08197"
              >Self-Assembling Artificial Neural Networks Through Neural
              Developmental Programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 01:04:25</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37759668"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37759366">
          <h3>
            <a
              class="item"
              href="https://www.openculture.com/2020/10/daisugi.html"
              >Daisugi, the Japanese technique of growing trees out of other
              trees (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 00:18:01</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37759366"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37759177">
          <h3>
            <a
              class="item"
              href="https://github.com/fastbootstrap/atlassian-design-for-bootstrap"
              >Show HN: Atlassian Design for Bootstrap v5</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 00:00:01</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37759177"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              Atlassian Design for Bootstrap 5. Beautifully crafted Bootstrap
              components ready for your next project.
            </div>
          </section>
        </section>
        <section id="37758911">
          <h3>
            <a
              class="item"
              href="https://frame.work/blog/reviews-of-framework-laptop-13-amd-ryzen-7040-series-are-live"
              >Press Reviews of the AMD Ryzen 7040 Framework Laptop 13</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 23:23:38</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37758911"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37758788">
          <h3>
            <a
              class="item"
              href="https://theness.com/neurologicablog/index.php/passive-solar-water-desalination/"
              >Passive Solar Water Desalination</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 23:07:08</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37758788"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37758772">
          <h3>
            <a class="item" href="https://semver.org/"
              >Semantic Versioning 2.0 (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 23:05:30</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37758772"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37758099">
          <h3>
            <a class="item" href="https://roadsaudio.com/"
              >Show HN: An app to create asynchronous micro podcasts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 21:52:53</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37758099"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              Share thoughts and stories with friends worldwide, on your time.
            </div>
          </section>
        </section>
        <section id="37757595">
          <h3>
            <a class="item" href="https://www.jsongenerator.io/"
              >Show HN: Generate JSON mock data for testing/initial app
              development</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 21:07:36</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37757595"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37757516">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/gym-class-by-irl-studios/jobs/ADcM4ZV-lead-backend-engineering"
              >Gym Class VR (YC W22) is Hiring a Lead Back End Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 21:00:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37756895">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2309.17453"
              >StreamingLLM: Efficient streaming technique enable infinite
              sequence lengths</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 20:10:46</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37756895"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37756656">
          <h3>
            <a
              class="item"
              href="https://blog.cr.yp.to/20231003-countcorrectly.html"
              >Debunking NIST's calculation of the Kyber-512 security level</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 19:49:47</span
              ><span class="points-container"
                >Points: <span class="points">312</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37756656"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37756632">
          <h3>
            <a
              class="item"
              href="https://georgek.github.io/blog/posts/multiple-web-projects-traefik/"
              >Working on Multiple Web Projects with Docker Compose and
              Traefik</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 19:46:47</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37756632"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37756281">
          <h3>
            <a class="item" href="https://github.com/NVIDIA/MatX"
              >MatX: Efficient C++17 GPU numerical computing library with
              Python-like syntax</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 19:20:19</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37756281"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37754489">
          <h3>
            <a
              class="item"
              href="https://jamiemagee.co.uk/blog/honey-i-shrunk-the-npm-package/"
              >Honey, I shrunk the NPM package</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 16:55:55</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37754489"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37753791">
          <h3>
            <a class="item" href="https://www.wildmoose.ai/"
              >Show HN: Wild Moose – Autonomous agent for production
              debugging</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 16:08:50</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37753791"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today's GenAI devtools, such as Copilot, are limited: they are
                great for writing code, but we all know that programming is only
                20% coding, and 80% debugging.
              </p>
              <p>
                So how can GenAI be used for debugging? As opposed to code
                completion or test automation, production debugging is not about
                generating text. Debugging is mostly about root-cause analysis.
                We realized two things:
              </p>
              <p>
                1) Generative AI is drastically changing the way we work with
                data, thanks to its ability to not only generate queries, but
                also run code and analyze unstructured data. This enables
                building better data-exploration experiences with far more
                intuitive interfaces.
              </p>
              <p>
                2) RCA is all about exploring different types of data. When you
                don’t know why a transaction was dropped or which customers are
                affected – you explore metrics, logs, your code, other people’s
                code, old slack messages, and whatnot, to figure out what’s
                broken.
              </p>
              <p>
                Putting those two together, we built an autonomous agent that
                helps debug production issues. Our LLM "moose" (ok, it's corny
                but we like it) connects to your logs, metrics, and other
                observability data, and lets you extract and analyze them by
                conversing with it. Once it gets a task, it will start
                reasoning, invoking APIs, and running code, until it comes back
                with an answer.
              </p>
              <p>
                For example, when requested to “show me IDs of transactions that
                took over 1 minute today”, it will fetch those transactions from
                Datadog for you. You might then ask it if long-running
                transactions correlate with a metric such as DB CPU load. It
                will fetch the metric values, visualize them on a graph
                alongside the long transaction frequency, and give you the
                answer.
              </p>
              <p>
                Our software both runs code and invokes API calls; the interplay
                between these is nontrivial to design and a fertile ground for
                innovation. There are “textbook” solutions to let agents write
                and run code (open sourced by, for example, Open Interpreter),
                and also to invoke tools/APIs (for example, Gorilla). But doing
                both together is harder, and yet required. We welcome your
                thoughts on this!
              </p>
              <p>
                Try our tool with your Datadog’s logs and metrics &gt;&gt;
                <a href="https://app.wildmoose.ai/slack/install"
                  >https://app.wildmoose.ai/slack/install</a
                >
              </p>
              <p>
                Setup demo &gt;&gt;
                <a href="https://tinyurl.com/mvaj8emf"
                  >https://tinyurl.com/mvaj8emf</a
                >
              </p>
              <p>
                If you want to see other integrations, or have ideas for
                features, or you’ve spotted behaviors that seem off - we’d love
                to hear. Hit us up in the comments!
              </p>
            </div>
          </section>
        </section>
        <section id="37753442">
          <h3>
            <a class="item" href="https://github.com/google/graph-mining"
              >Graph Mining Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 15:46:07</span
              ><span class="points-container"
                >Points: <span class="points">260</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37753442"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37752632">
          <h3>
            <a
              class="item"
              href="https://github.com/vitoplantamura/OnnxStream/tree/846da873570a737b49154e8f835704264864b0fe"
              >Running Stable Diffusion XL 1.0 in 298MB of RAM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 14:43:10</span
              ><span class="points-container"
                >Points: <span class="points">438</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37752632"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37752622">
          <h3>
            <a class="item" href="https://lethain.com/building-prestige/"
              >Building personal and organizational prestige</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 14:42:19</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37752622"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37752272">
          <h3>
            <a
              class="item"
              href="https://resobscura.substack.com/p/translating-latin-demonology-manuals"
              >Translating Latin demonology manuals with GPT-4 and Claude</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 14:13:35</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37752272"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37750859">
          <h3>
            <a
              class="item"
              href="https://serce.me/posts/02-10-2023-hey-computer-make-me-a-font"
              >Hey, computer, make me a font</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 12:17:33</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37750859"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37746341">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/archaeologists-uncover-9500-year-old-woven-baskets-and-europes-oldest-sandals-180983001/"
              >Archaeologists Uncover 9,500-Year-Old Woven Baskets and Europe’s
              Oldest Sandals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 00:24:40</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37746341"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37741254">
          <h3>
            <a
              class="item"
              href="https://www.philipsteadman.com/blog/greek-temples-made-of-wood/"
              >Greek Temples Made of Wood</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 17:13:50</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37741254"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37738543">
          <h3>
            <a
              class="item"
              href="https://themarkup.org/prediction-bias/2023/10/02/predictive-policing-software-terrible-at-predicting-crimes"
              >Predictive policing software terrible at predicting crimes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 14:24:44</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37738543"
                  >Comments</a
                ><span class="descendants">: 304</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37736853">
          <h3>
            <a
              class="item"
              href="https://erikwernquist.com/one-revolution-per-minute"
              >One Revolution per Minute [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 11:35:09</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37736853"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
