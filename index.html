<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46038143">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/pc-components/ddr5/64gb-of-ddr5-memory-now-costs-more-than-an-entire-ps5-even-after-a-discount-trident-z5-neo-kit-jumps-to-usd600-due-to-dram-shortage-and-its-expected-to-get-worse-into-2026"
              >PS5 now costs less than 64GB of DDR5 memory. RAM jumps to $600
              due to shortage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 19:29:12</span
              ><span class="points-container"
                >Points: <span class="points">333</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46038143"
                  >Comments</a
                ><span class="descendants">: 210</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46038099">
          <h3>
            <a
              class="item"
              href="https://www.xda-developers.com/your-unpowered-ssd-is-slowly-losing-your-data/"
              >Unpowered SSDs slowly lose data</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 19:25:25</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46038099"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46038047">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/engineering/advanced-tool-use"
              >Claude Advanced Tool Use</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 19:21:35</span
              ><span class="points-container"
                >Points: <span class="points">429</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46038047"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46037637">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/claude-opus-4-5"
              >Claude Opus 4.5</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 18:53:05</span
              ><span class="points-container"
                >Points: <span class="points">864</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46037637"
                  >Comments</a
                ><span class="descendants">: 393</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://platform.claude.com/docs/en/about-claude/models/whats-new-claude-4-5"
                >https://platform.claude.com/docs/en/about-claude/models/what...</a
              >
            </div>
          </section>
        </section>
        <section id="46037626">
          <h3>
            <a
              class="item"
              href="https://ericmigi.com/blog/pebble-watch-software-is-now-100percent-open-source"
              >Pebble Watch software is now 100% open source</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 18:52:12</span
              ><span class="points-container"
                >Points: <span class="points">812</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46037626"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46037591">
          <h3>
            <a
              class="item"
              href="https://www.androidauthority.com/aluminium-os-android-for-pcs-3619092/"
              >Google's new 'Aluminium OS' project brings Android to PC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 18:49:47</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46037591"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46037343">
          <h3>
            <a class="item" href="https://www.sawyerhood.com/blog/llm-extension"
              >The Bitter Lesson of LLM Extensions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 18:32:27</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46037343"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46037267">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-025-03714-0"
              >Mind-reading devices can now predict preconscious thoughts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 18:26:09</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46037267"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46036908">
          <h3>
            <a class="item" href="https://news.ysimulator.run/news"
              >Show HN: I built an interactive HN Simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 17:52:43</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46036908"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
            <div class="text">
              <p>
                You can submit text posts and links, just like the real HN. But
                on HN Simulator, all of the comments are generated by LLMs +
                generate instantly.
              </p>
              <p>
                The best way to use it (IMHO) is to submit a text post or a
                curl-able URL here:
                <a href="https://news.ysimulator.run/submit"
                  >https://news.ysimulator.run/submit</a
                >. You don't need an account to post.
              </p>
              <p>
                When you do that, various prompts will be built from a library
                of commenter archetypes, moods, and shapes. The AI commenters
                will actually respond to your text post and/or submitted link.
              </p>
              <p>
                I really wanted it to feel real, and I think the project mostly
                delivers on that. When I was developing it, I kept getting
                confused between which tab was the "real" HN and which was the
                simulator, and accidentally submitted some junk to HN. (Sorry
                dang and team – I did clean up after myself).
              </p>
              <p>
                The app itself is built with Node + Express + Postgres, and all
                of the inference runs on Replicate.
              </p>
              <p>
                Speaking of Replicate, they generously loaded me up with some
                free credits for the inference – so shoutout to the team there.
              </p>
              <p>
                The most technically interesting part of the app is how the
                comments work. You can read more about it here, as well as
                explore all of the available archetypes, moods, and shapes that
                get combined into prompts:
                <a href="https://news.ysimulator.run/comments.html"
                  >https://news.ysimulator.run/comments.html</a
                >
              </p>
              <p>
                I hope you all have as much fun playing with it as I did making
                it!
              </p>
            </div>
          </section>
        </section>
        <section id="46036895">
          <h3>
            <a
              class="item"
              href="https://github.com/Swordfish90/cool-retro-term"
              >Cool-retro-term: terminal emulator which mimics look and feel of
              CRTs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 17:52:01</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46036895"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46036878">
          <h3>
            <a
              class="item"
              href="https://twitter.com/karpathy/status/1993010584175141038"
              >Implications of AI to schools</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 17:51:02</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46036878"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
            <div class="text">
              <a href="https://xcancel.com/karpathy/status/1993010584175141038"
                >https://xcancel.com/karpathy/status/1993010584175141038</a
              >
            </div>
          </section>
        </section>
        <section id="46036222">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46036222"
              >Corvus Robotics (YC S18): Hiring Head of Mfg/Ops, Next Door to YC
              Mountain View</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 17:00:33</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                Our fleet of flying warehouse drones is 5x-ing in 2026, and I'm
                looking for a generalist ex-founder or manufacturing leader in
                the SF Bay Area who wants to get their hands dirty massively
                scaling manufacturing operations in the US and overseas.
              </p>
              <p>
                We need someone who has worked on hardware products (not just
                SaaS), communicates clearly, and is relentlessly resourceful.
                Mandarin proficiency and leading a product through EVT/DVT/PVT
                is an added bonus.
              </p>
              <p>
                If this resonates with you, DM me, or send a super short email
                to a@ our url with: - why you’re interested - what was the
                biggest manufacturing fuckup you've recovered from - your target
                comp
              </p>
              <p>
                PS - Please reshare our LinkedIn post!
                <a
                  href="https://www.linkedin.com/posts/mhkabirr_at-corvus-robotics-were-scaling-the-largest-activity-7397916377002500096-WiLm"
                  >https://www.linkedin.com/posts/mhkabirr_at-corvus-robotics-w...</a
                >
              </p>
              <p>Thanks, Jackie</p>
            </div>
          </section>
        </section>
        <section id="46033330">
          <h3>
            <a class="item" href="https://issues.chromium.org/issues/40168998"
              >Chrome Jpegxl Issue Reopened</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 12:23:02</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46033330"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46032539">
          <h3>
            <a
              class="item"
              href="https://helixguard.ai/blog/malicious-sha1hulud-2025-11-24"
              >Shai-Hulud Returns: Over 300 NPM Packages Infected</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 10:40:22</span
              ><span class="points-container"
                >Points: <span class="points">898</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46032539"
                  >Comments</a
                ><span class="descendants">: 703</span></span
              >
            </h4>
            <div class="text">
              https://www.aikido.dev/blog/shai-hulud-strikes-again-hitting-zapier-ensdomains
            </div>
          </section>
        </section>
        <section id="46032230">
          <h3>
            <a class="item" href="https://github.com/DotFox/edn.c"
              >A fast EDN (Extensible Data Notation) reader written in C11 with
              SIMD boost</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 09:51:45</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46032230"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46032148">
          <h3>
            <a
              class="item"
              href="https://lesleylai.info/en/fifty_shades_of_oop/"
              >Fifty Shades of OOP</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 09:40:32</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46032148"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46031220">
          <h3>
            <a
              class="item"
              href="https://kmicinski.com/functional-programming/2025/11/23/build-a-language/"
              >Build a Compiler in Five Projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 07:14:55</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46031220"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46030799">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/11/23/technology/openai-chatgpt-users-risks.html"
              >What OpenAI did when ChatGPT users lost touch with reality</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 05:58:08</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46030799"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46019898">
          <h3>
            <a
              class="item"
              href="https://www.oneusefulthing.org/p/three-years-from-gpt-3-to-gemini"
              >Three Years from GPT-3 to Gemini 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-23 @ 01:25:17</span
              ><span class="points-container"
                >Points: <span class="points">236</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46019898"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46016104">
          <h3>
            <a
              class="item"
              href="https://andrewpwheeler.com/2025/11/21/advice-for-crime-analyst-to-break-into-data-science/"
              >Advice for crime analyst to break into data science</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-22 @ 16:53:06</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46016104"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46015467">
          <h3>
            <a
              class="item"
              href="https://www.tweag.io/blog/2025-11-20-migrating-bazel-symbolic-macros/"
              >Migrating to Bazel symbolic macros</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-22 @ 15:26:44</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46015467"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46015095">
          <h3>
            <a
              class="item"
              href="https://gaultier.github.io/blog/a_million_ways_to_data_race_in_go.html"
              >A million ways to die from a data race in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-22 @ 14:33:57</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46015095"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46013478">
          <h3>
            <a
              class="item"
              href="https://altermag.com/articles/the-secret-history-of-indian-science-fiction"
              >The history of Indian science fiction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-22 @ 09:41:46</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46013478"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46010540">
          <h3>
            <a
              class="item"
              href="https://christopherkrapu.com/blog/2025/antigravity-stat-mech/"
              >Using Antigravity for Statistical Physics in JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-21 @ 23:53:42</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46010540"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46006891">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/blog/products/containers-kubernetes/how-we-built-a-130000-node-gke-cluster/"
              >Building the largest known Kubernetes cluster</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-21 @ 17:56:50</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46006891"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46006104">
          <h3>
            <a class="item" href="https://www.ocrarena.ai/battle"
              >Show HN: OCR Arena – A playground for OCR models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-21 @ 16:44:45</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46006104"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <p>
                Upload any doc, measure accuracy, and (optionally) vote for the
                models on a public leaderboard.
              </p>
              <p>
                It currently has Gemini 3, dots.ocr, DeepSeek, GPT5, olmOCR 2,
                Qwen, and a few others. If there's any others you'd like
                included, let me know!
              </p>
            </div>
          </section>
        </section>
        <section id="46005910">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20251028-00/?p=111733"
              >How did the Windows 95 user interface code get to the Windows NT
              code base?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-21 @ 16:23:50</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46005910"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45989284">
          <h3>
            <a
              class="item"
              href="https://blog.cuongle.dev/p/inside-rusts-std-and-parking-lot-mutexes-who-win"
              >Inside Rust's std and parking_lot mutexes – who wins?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 05:32:13</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45989284"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45981568">
          <h3>
            <a
              class="item"
              href="https://www.degruyterbrill.com/document/doi/10.1515/nanoph-2025-0312/html"
              >Random lasers from peanut kernel doped with birch leaf–derived
              carbon dots</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-19 @ 16:31:44</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45981568"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45980474">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/OpenBSDToFreeBSDMove"
              >Moving from OpenBSD to FreeBSD for firewalls</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-19 @ 15:07:35</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45980474"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
