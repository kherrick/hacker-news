<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46077106">
          <h3>
            <a
              class="item"
              href="https://www.spinellis.gr/pubs/conf/2015-MSR-Unix-History/html/Spi15c.html"
              >A Repository with 44 Years of Unix Evolution</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 09:32:38</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46077106"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46077038">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/tech/ai/tech-titans-amass-multimillion-dollar-war-chests-to-fight-ai-regulation-88c600e1"
              >Tech Titans Amass Multimillion-Dollar War Chests to Fight AI
              Regulation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 09:21:55</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46077038"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46075882">
          <h3>
            <a class="item" href="https://github.com/NullPxl/banrays"
              >Show HN: Glasses to detect smart-glasses that have cameras</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 05:52:38</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46075882"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've written a bunch more on the link (+photos are there), but
                essentially this uses 2 fingerprinting approaches: -
                retro-reflectivity of the camera sensor by looking at IR
                reflections. mixed results here. - wireless traffic (primarily
                BLE, also looking into BTC and wifi)
              </p>
              <p>
                For the latter, I'm currently just using an ESP32, and I can
                consistently detect when the Meta Raybans are 1) pairing, 2)
                first powered on, 3) (less consistently) when they're taken out
                of the charging case. When they do detect something, it plays a
                little jingle next to your ear.
              </p>
              <p>
                Ideally I want to be able to detect them when they're in use,
                and not just at boot. I've come across the nRF52840, which seems
                like it can follow directed BLE traffic beyond the initial
                broadcast, but from my understanding it would still need to
                catch the first CONNECT_REQ event regardless. On the bluetooth
                classic side of things, all the hardware looks really expensive!
                Any ideas are appreciated. Thanks!
              </p>
            </div>
          </section>
        </section>
        <section id="46075746">
          <h3>
            <a
              class="item"
              href="https://popovicu.com/posts/how-to-use-linux-vsock-for-fast-vm-communication/"
              >How to use Linux vsock for fast VM communication</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 05:19:45</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46075746"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46075616">
          <h3>
            <a class="item" href="https://github.com/steveyegge/beads"
              >Beads – A memory upgrade for your coding agent</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 04:50:57</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46075616"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46075462">
          <h3>
            <a
              class="item"
              href="https://posit.co/blog/positron-migration-guides"
              >Migrating to Positron, a next-generation data science IDE for
              Python and R</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 04:15:34</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46075462"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46075320">
          <h3>
            <a class="item" href="https://pocketbase.io/"
              >Pocketbase – open-source realtime back end in 1 file</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 03:45:04</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46075320"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46075219">
          <h3>
            <a
              class="item"
              href="https://blog.ellipticc.com/posts/what-is-shors-algorithm-and-why-its-the-single-biggest-threat-to-classical-cryptography/"
              >Shor's algorithm: the one quantum algo that ends RSA/ECC
              tomorrow</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 03:19:51</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46075219"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46074362">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/culture/article/20241205-how-charles-m-schulz-created-charlie-brown-and-snoopy"
              >How Charles M Schulz created Charlie Brown and Snoopy (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 00:10:38</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46074362"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46074111">
          <h3>
            <a class="item" href="https://vsora.com/products/jotunn-8/"
              >Vsora Jotunn-8 5nm European inference chip</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-27 @ 23:30:11</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46074111"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46073855">
          <h3>
            <a
              class="item"
              href="https://www.energy-storage.news/250mwh-sand-battery-to-start-construction-in-finland-for-both-heating-and-ancillary-services/"
              >250MWh 'Sand Battery' to start construction in Finland</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-27 @ 22:48:44</span
              ><span class="points-container"
                >Points: <span class="points">269</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46073855"
                  >Comments</a
                ><span class="descendants">: 183</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46073817">
          <h3>
            <a
              class="item"
              href="https://tigerbeetle.com/blog/2022-11-23-a-friendly-abstraction-over-iouring-and-kqueue/"
              >A programmer-friendly I/O abstraction over io_uring and kqueue
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-27 @ 22:41:06</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46073817"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46072786">
          <h3>
            <a
              class="item"
              href="https://github.com/deepseek-ai/DeepSeek-Math-V2/blob/main/DeepSeekMath_V2.pdf"
              >DeepSeekMath-V2: Towards Self-Verifiable Mathematical Reasoning
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-27 @ 20:03:25</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46072786"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46070668">
          <h3>
            <a
              class="item"
              href="https://www.qualcomm.com/developer/blog/2025/10/same-day-snapdragon-8-elite-gen-5-upstream-linux-support"
              >Same-day upstream Linux support for Snapdragon 8 Elite Gen 5</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-27 @ 16:19:03</span
              ><span class="points-container"
                >Points: <span class="points">416</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46070668"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46070203">
          <h3>
            <a
              class="item"
              href="https://about.gitlab.com/blog/gitlab-discovers-widespread-npm-supply-chain-attack/"
              >GitLab discovers widespread NPM supply chain attack</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-27 @ 15:36:56</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46070203"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46069048">
          <h3>
            <a
              class="item"
              href="https://www.uncoveralpha.com/p/the-chip-made-for-the-ai-inference"
              >TPUs vs. GPUs and why Google is positioned to win AI race in the
              long term</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-27 @ 13:28:34</span
              ><span class="points-container"
                >Points: <span class="points">370</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46069048"
                  >Comments</a
                ><span class="descendants">: 272</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46066522">
          <h3>
            <a
              class="item"
              href="https://mixpanel.com/blog/sms-security-incident/"
              >Mixpanel Security Breach</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-27 @ 07:02:40</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46066522"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46065955">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46065955"
              >Tell HN: Happy Thanksgiving</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-27 @ 05:21:16</span
              ><span class="points-container"
                >Points: <span class="points">720</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46065955"
                  >Comments</a
                ><span class="descendants">: 178</span></span
              >
            </h4>
            <div class="text">
              <p>Thank you @dang and @tomhow.</p>
              <p>Here's to another year.</p>
            </div>
          </section>
        </section>
        <section id="46058471">
          <h3>
            <a class="item" href="https://another.rodeo/feedback/"
              >Feedback doesn't scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-26 @ 15:40:14</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46058471"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46057266">
          <h3>
            <a class="item" href="https://computer.rip/2025-11-11-dot-us.html"
              >Memories of .us</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-26 @ 13:36:19</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46057266"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46054661">
          <h3>
            <a
              class="item"
              href="https://www.datahaskell.org/blog/2025/11/25/a-tale-of-two-kernels.html"
              >Comparing xeus-Haskell and ihaskell kernels</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-26 @ 06:13:26</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46054661"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46038684">
          <h3>
            <a
              class="item"
              href="https://www.collabora.com/news-and-blog/blog/2025/11/24/implementing-bluetooth-le-audio-and-auracast-on-linux-systems/"
              >Implementing Bluetooth LE Audio and Auracast on Linux Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 20:15:53</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46038684"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46035819">
          <h3>
            <a class="item" href="https://retrogamecoders.com/maxduino-review/"
              >Maxduino Review: Tape Cassette Emulator for Multiple Retro
              Computers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 16:26:22</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46035819"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46031552">
          <h3>
            <a
              class="item"
              href="https://fabiensanglard.net/quake_indicators/index.html"
              >Quake Engine Indicators</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 08:10:11</span
              ><span class="points-container"
                >Points: <span class="points">262</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46031552"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46026343">
          <h3>
            <a
              class="item"
              href="https://signoregalilei.com/2025/11/22/designing-a-mechanical-calculator/"
              >Designing a Mechanical Calculator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-23 @ 19:09:17</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46026343"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46024302">
          <h3>
            <a
              class="item"
              href="https://danijelavrzan.com/posts/2025/11/indie-dev/"
              >Indie, alone, and figuring it out</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-23 @ 15:33:22</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46024302"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46022203">
          <h3>
            <a class="item" href="https://twdev.blog/2025/11/robin_hood/"
              >Experimenting with Robin Hood Hashing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-23 @ 10:05:32</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46022203"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46020561">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=bR9EN3kUlfg"
              >How to make precise sheet metal parts (photochemical machining)
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-23 @ 03:37:49</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46020561"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46018159">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-11-physicists-antihydrogen-breakthrough-cern-technique.html"
              >Physicists drive antihydrogen breakthrough at CERN</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-22 @ 20:54:06</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46018159"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46012803">
          <h3>
            <a class="item" href="https://github.com/hexagonal-sun/moss"
              >Moss: a Rust Linux-compatible kernel in 26,000 lines of code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-22 @ 07:11:59</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46012803"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
