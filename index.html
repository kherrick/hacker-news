<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41469040">
          <h3>
            <a
              class="item"
              href="https://www.mux.com/blog/php-is-the-new-javascript"
              >PHP is the new JavaScript?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 19:33:04</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41469040"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41468667">
          <h3>
            <a
              class="item"
              href="https://www.gamedeveloper.com/programming/godot-founders-had-desperately-hoped-unity-wouldn-t-blow-up-"
              >Godot founders had desperately hoped Unity wouldn't 'blow up'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 18:41:06</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41468667"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41467816">
          <h3>
            <a class="item" href="https://www.nango.dev/jobs"
              >Nango (YC W23, Product Integrations Platform) Is Hiring a Product
              Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 17:00:20</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41467704">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41467704"
              >Show HN: Infinity – Realistic AI characters that can speak</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 16:47:04</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41467704"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
            <div class="text">
              <a href="https://infinity.ai/">https://infinity.ai/</a>). We've
              trained our own foundation video model focused on people. As far
              as we know, this is the first time someone has trained a video
              diffusion transformer that’s driven by audio input. This is cool
              because it allows for expressive, realistic-looking characters
              that actually speak. Here’s a blog with a bunch of examples:
              <a href="https://toinfinityai.github.io/v2-launch-page/"
                >https://toinfinityai.github.io/v2-launch-page/</a
              >
              <p>
                If you want to try it out, you can either (1) go to
                <a href="https://studio.infinity.ai/try-inf2"
                  >https://studio.infinity.ai/try-inf2</a
                >, or (2) post a comment in this thread describing a character
                and we’ll generate a video for you and reply with a link. For
                example: “Mona Lisa saying ‘what the heck are you smiling at?’”:
                <a href="https://bit.ly/3z8l1TM">https://bit.ly/3z8l1TM</a> “A
                3D pixar-style gnome with a pointy red hat reciting the
                Declaration of Independence”:
                <a href="https://bit.ly/3XzpTdS">https://bit.ly/3XzpTdS</a>
                “Elon Musk singing Fly Me To The Moon by Sinatra”:
                <a href="https://bit.ly/47jyC7C">https://bit.ly/47jyC7C</a>
              </p>
              <p>
                Our tool at Infinity allows creators to type out a script with
                what they want their characters to say (and eventually, what
                they want their characters to do) and get a video out. We’ve
                trained for about 11 GPU years (~$500k) so far and our model
                recently started getting good results, so we wanted to share it
                here. We are still actively training.
              </p>
              <p>
                We had trouble creating videos of good characters with existing
                AI tools. Generative AI video models (like Runway and Luma)
                don’t allow characters to speak. And talking avatar companies
                (like HeyGen and Synthesia) just do lip syncing on top of the
                previously recorded videos. This means you often get facial
                expressions and gestures that don’t make sense with the audio,
                resulting in the “uncanny” look you can’t quite put your finger
                on. See blog.
              </p>
              <p>
                When we started Infinity, our V1 model took the lip syncing
                approach. In addition to mismatched gestures, this method had
                many limitations, including a finite library of actors (we had
                to fine-tune a model for each one with existing video footage)
                and an inability to animate imaginary characters.
              </p>
              <p>
                To address these limitations in V2, we decided to train an
                end-to-end video diffusion transformer model that takes in a
                single image, audio, and other conditioning signals and outputs
                video. We believe this end-to-end approach is the best way to
                capture the full complexity and nuances of human motion and
                emotion. One drawback of our approach is that the model is slow
                despite using rectified flow (2-4x speed up) and a 3D VAE
                embedding layer (2-5x speed up).
              </p>
              <p>
                Here are a few things the model does surprisingly well on: (1)
                it can handle multiple languages, (2) it has learned some
                physics (e.g. it generates earrings that dangle properly and
                infers a matching pair on the other ear), (3) it can animate
                diverse types of images (paintings, sculptures, etc) despite not
                being trained on those, and (4) it can handle singing. See blog.
              </p>
              <p>
                Here are some failure modes of the model: (1) it cannot handle
                animals (only humanoid images), (2) it often inserts hands into
                the frame (very annoying and distracting), (3) it’s not robust
                on cartoons, and (4) it can distort people’s identities
                (noticeable on well-known figures). See blog.
              </p>
              <p>
                Try the model here:
                <a href="https://studio.infinity.ai/try-inf2"
                  >https://studio.infinity.ai/try-inf2</a
                >
              </p>
              <p>We’d love to hear what you think!</p>
            </div>
          </section>
        </section>
        <section id="41467522">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-02858-9"
              >Cough or sneeze? How the brain knows what to unleash</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 16:23:18</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41467522"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41466963">
          <h3>
            <a
              class="item"
              href="https://mailman.nginx.org/pipermail/nginx-announce/2024/ITL3AOQSAJANFJXMM3VOVOIGOUADWFFK.html"
              >Nginx has moved to GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 15:17:02</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41466963"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41465900">
          <h3>
            <a class="item" href="https://inertiajs.com/"
              >Inertia.js – Build React, Vue, or Svelte apps with server-side
              routing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 13:15:35</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41465900"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41465735">
          <h3>
            <a class="item" href="https://wealthfolio.app"
              >Show HN: Wealthfolio: Private, open-source investment tracker</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 12:56:15</span
              ><span class="points-container"
                >Points: <span class="points">499</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41465735"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
            <div class="text">
              <p>
                - The app is a simple desktop application that works on macOS,
                Windows, and Ubuntu.
              </p>
              <p>
                - I developed this app for my own needs. Getting tired of SaaS
                app subscriptions and privacy concerns.
              </p>
              <p>
                - For now, the activities are logged manually or imported from a
                CSV file. No integration with Plaid or other platforms.
              </p>
              <p>
                - No monetization is planned for now (only a "buy me a coffee"
                if you use and appreciate the app).
              </p>
            </div>
          </section>
        </section>
        <section id="41465081">
          <h3>
            <a
              class="item"
              href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4945566"
              >Effects of Gen AI on High Skilled Work: Experiments with Software
              Developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 11:21:57</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41465081"
                  >Comments</a
                ><span class="descendants">: 167</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41463809">
          <h3>
            <a
              class="item"
              href="https://blog.nuclearsecrecy.com/2024/09/04/did-sandia-use-a-thermonuclear-secondary-in-a-product-logo/"
              >Did Sandia use a thermonuclear secondary in a product logo?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 07:27:06</span
              ><span class="points-container"
                >Points: <span class="points">522</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41463809"
                  >Comments</a
                ><span class="descendants">: 174</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41463734">
          <h3>
            <a
              class="item"
              href="https://exercism.org/blog/september-2024-restructure"
              >2M users but no money in the bank</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 07:16:38</span
              ><span class="points-container"
                >Points: <span class="points">308</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41463734"
                  >Comments</a
                ><span class="descendants">: 209</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41462574">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2024/what-happens-when-you-touch-pickle-am-radio-tower"
              >What happens when you touch a pickle to an AM radio tower</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 03:16:20</span
              ><span class="points-container"
                >Points: <span class="points">321</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41462574"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41461373">
          <h3>
            <a
              class="item"
              href="https://www.inkandswitch.com/beehive/notebook/"
              >Beehive lab notebook: Local-first access control</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 23:37:21</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41461373"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41459373">
          <h3>
            <a
              class="item"
              href="https://felipefarinon.com/articles/qt-widgets-layout/"
              >Understanding the Layout Process in Qt Widgets</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 18:44:01</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41459373"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41458512">
          <h3>
            <a
              class="item"
              href="https://charanvasu.com/posts/debugging-a-memory-leak-in-a-clojure-service/"
              >Debugging a memory leak in a Clojure service</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 17:03:04</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41458512"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41456635">
          <h3>
            <a class="item" href="https://blancas.io/blog/html-minify-for-llm/"
              >Minifying HTML for GPT-4o: Remove all the HTML tags</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 13:51:22</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41456635"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41453264">
          <h3>
            <a class="item" href="https://iamdan.me/better-dotfiles"
              >Better Dotfiles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 03:43:41</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41453264"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41448347">
          <h3>
            <a
              class="item"
              href="https://binarysolo.blog/decommissioning-my-first-commercial-product/"
              >Decommissioning my first commercial product</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-04 @ 17:34:55</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41448347"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41446248">
          <h3>
            <a class="item" href="https://github.com/bjornbytes/lovr"
              >LÖVR – A simple Lua framework for rapidly building VR
              experiences</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-04 @ 14:27:47</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41446248"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41444855">
          <h3>
            <a class="item" href="https://github.com/nuno-faria/tetris-sql"
              >Show HN: Using SQL's Turing completeness to build Tetris</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-04 @ 12:28:20</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41444855"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41444590">
          <h3>
            <a class="item" href="https://tomhazledine.com/cosine-similarity/"
              >How does cosine similarity work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-04 @ 11:52:41</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41444590"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41443414">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2409.01296"
              >Fibonacci Partial Sums Tricks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-04 @ 08:58:00</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41443414"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41440275">
          <h3>
            <a
              class="item"
              href="https://www.michaelpj.com/blog/2024/09/03/lsp-good-bad-ugly.html"
              >LSP: The Good, the Bad, and the Ugly</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-03 @ 23:17:23</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41440275"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41436734">
          <h3>
            <a
              class="item"
              href="https://www.leadedsolder.com/2024/09/03/msx-megarom-oyanami.html"
              >Oya, I've heard of mega-ROMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-03 @ 16:50:26</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41436734"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41436009">
          <h3>
            <a
              class="item"
              href="https://storymaps.arcgis.com/stories/41d4bd6029044afbb1b9ad805a4731d8"
              >Mapping 20k ships that sank during WW II</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-03 @ 15:38:11</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41436009"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41435444">
          <h3>
            <a
              class="item"
              href="https://landsat.gsfc.nasa.gov/apps/YourNameInLandsat-main/index.html"
              >Your Name in Landsat</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-03 @ 14:43:01</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41435444"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41434062">
          <h3>
            <a
              class="item"
              href="https://www.chemistryworld.com/careers/will-open-science-change-chemistry/4020023.article"
              >Will open science change chemistry?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-03 @ 11:59:56</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41434062"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41431463">
          <h3>
            <a
              class="item"
              href="https://github.com/gritzko/librdx/blob/master/ABC.md"
              >Handling complexity without abstraction: Algebraic Bricklaying
              C</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-03 @ 05:07:26</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41431463"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41426828">
          <h3>
            <a
              class="item"
              href="https://medium.com/@yonatanzunger/advanced-python-achieving-high-performance-with-code-generation-796b177ec79"
              >Achieving high Python performance with code generation (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-02 @ 16:38:14</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41426828"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41424533">
          <h3>
            <a
              class="item"
              href="https://www.cam.ac.uk/stories/hawking-archive-for-all"
              >Hawking Archive made available to historians and researchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-02 @ 11:36:45</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41424533"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
