<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41768658">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/us-antitrust-case-against-amazon-move-forward-2024-10-07/"
              >US antitrust case against Amazon to move forward</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 17:40:22</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41768658"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41768457">
          <h3>
            <a
              class="item"
              href="https://www.nodejs-security.com/blog/do-not-use-secrets-in-environment-variables-and-here-is-how-to-do-it-better"
              >Do not use secrets in environment variables</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 17:25:32</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41768457"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41768143">
          <h3>
            <a class="item" href="https://grnh.se/d034f1ba5us"
              >Substack (YC W18) Is Hiring Machine Learning Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 17:01:12</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41767886">
          <h3>
            <a class="item" href="https://github.com/whiletruelearn/termichess"
              >Show HN: Termichess – Play chess in your terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 16:43:18</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41767886"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <p>
                I have been trying to build a terminal based app for sometime
                now and this is an attempt at trying to build a chess app that
                one can play right inside terminal.
              </p>
              <p>
                I was inspired by `chess-tui`[1] which is a rust based project
                and was looking to build something similar using python. Luckily
                I stumbled upon textual[2] recently and it made my task of
                building this far more easier than I thought.
              </p>
              <p>
                [1]
                <a href="https://github.com/thomas-mauran/chess-tui"
                  >https://github.com/thomas-mauran/chess-tui</a
                >
                [2]
                <a href="https://github.com/textualize/textual"
                  >https://github.com/textualize/textual</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41767852">
          <h3>
            <a
              class="item"
              href="https://www.signalfire.com/blog/devrel-for-startups"
              >Unlocking the 'aha' moment: Developer relations for startups</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 16:40:30</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41767852"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41767690">
          <h3>
            <a class="item" href="https://postalagent.com"
              >Show HN: PostalAgent – Send Postcards online by circling areas on
              a Google Map</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 16:28:18</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41767690"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              <a href="https://PostalAgent.com">https://PostalAgent.com</a>, a
              site that lets you easily send highly targeted postcards to
              specific neighborhoods.
              <p>
                I originally built this site 5 years ago but shut it down when
                my full time engineering job became too demanding, but recently
                I did a full rewrite with many new features.
              </p>
              <p>
                To start you can select an area using a City, State, or even by
                circling specific areas on a Google Map. Then, you can refine
                your results and filter on specific demographics, like household
                income, home value, rental status, etc
              </p>
              <p>
                You can also search for Businesses rather than consumers, and
                even filter by franchise type, presence of email, IRS tax code,
                Franchise Type, etc.
              </p>
              <p>
                I was able to get a few clients signed up very quickly, mostly
                home services type businesses and real estate agents, but I
                think it could be used by many types of businesses. I have a few
                customers that are only using the mailing list feature without
                sending postcards, likely for cold email or other marketing
                outreach.
              </p>
              <p>I'm looking for a bit of feedback from the community.</p>
            </div>
          </section>
        </section>
        <section id="41767648">
          <h3>
            <a
              class="item"
              href="https://twitter.com/notengoprisa/status/1842550658102079556"
              >Nearly all of the Google images results for "baby peacock" are AI
              generated</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 16:25:03</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41767648"
                  >Comments</a
                ><span class="descendants">: 187</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41767644">
          <h3>
            <a class="item" href="https://wasmer.io/posts/clang-in-browser"
              >Show HN: Compiling C in the browser using WebAssembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 16:24:32</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41767644"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41767150">
          <h3>
            <a class="item" href="https://www.ptxdist.org/"
              >Ptxdist – "Professional Embedded Linux Made Easy"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 15:44:37</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41767150"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41766882">
          <h3>
            <a
              class="item"
              href="https://jakelazaroff.com/words/building-a-single-page-app-with-htmx/"
              >Building a single-page app with Htmx</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 15:19:09</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766882"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41766610">
          <h3>
            <a
              class="item"
              href="https://www.bleepingcomputer.com/news/security/atandt-verizon-reportedly-hacked-to-target-us-govt-wiretapping-platform/"
              >AT&amp;amp;T, Verizon reportedly hacked to target US govt
              wiretapping platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 14:53:33</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766610"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41766515">
          <h3>
            <a
              class="item"
              href="https://blog.appsignal.com/2024/10/07/whats-new-in-ruby-on-rails-8.html"
              >What's New in Ruby on Rails 8</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 14:45:12</span
              ><span class="points-container"
                >Points: <span class="points">345</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766515"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41766293">
          <h3>
            <a
              class="item"
              href="https://www.dreamsongs.com/RiseOfWorseIsBetter.html"
              >The Rise of Worse Is Better (1991)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 14:22:45</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766293"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41766144">
          <h3>
            <a class="item" href="https://github.com/THUDM/LongWriter"
              >Longwriter – Increase llama3.1 output to 10k words</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 14:05:05</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766144"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765939">
          <h3>
            <a class="item" href="https://nutritionprices.com/"
              >Show HN: A Website for Comparing Protein Powder Prices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 13:42:59</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765939"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <p>
                Buying protein powder is a mess, and comparing different
                products is frustrating, since all brands choose their own
                serving sizes. By collecting nutrition facts, and normalizing
                the serving to contain 25 grams of protein, we can properly
                compare price/nutrients per serving.
              </p>
              <p>
                Inspired by diskprices.com, the idea is to provide an equally
                functional interface to compare products. The prices are
                collected once a day, currently from iHerb US. Aiming to improve
                the coverage soon.
              </p>
              <p>
                Any tips / suggestions / other feedback more than welcome :)
              </p>
              <p>
                ...and if you rather want to contact me directly, feel free to
                reach me at elina@nutritionprices.com
              </p>
            </div>
          </section>
        </section>
        <section id="41765904">
          <h3>
            <a
              class="item"
              href="https://carstenfuehrmann.org/lectures/computability-10.pdf"
              >Abacus Machines [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 13:39:23</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765904"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765734">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/10/14/silicon-valley-the-new-lobbying-monster"
              >Silicon Valley, the new lobbying monster</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 13:21:54</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765734"
                  >Comments</a
                ><span class="descendants">: 216</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765716">
          <h3>
            <a
              class="item"
              href="https://www.da.vidbuchanan.co.uk/blog/dram-emfi.html"
              >Can you get root with only a cigarette lighter?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 13:20:19</span
              ><span class="points-container"
                >Points: <span class="points">325</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765716"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765580">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/fukushima-reactor"
              >Fukushima Reactor: TEPCO robot aims to extract nuclear fuel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 13:01:09</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765580"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765409">
          <h3>
            <a class="item" href="https://github.com/archiewood/gosql"
              >Show HN: GoSQL – A query engine in 319 LoC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 12:39:15</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765409"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>So I built a minimum viable SQL engine in Go.</p>
              <p>- Supports CSV files as tables</p>
              <p>- Supports SELECT, FROM, WHERE, LIMIT</p>
              <p>It's very simple:</p>
              <p>1. Parses query string</p>
              <p>2. Converts it into an AST representation</p>
              <p>3. Executes the query against the CSV</p>
              <p>4. Returns the results</p>
            </div>
          </section>
        </section>
        <section id="41765395">
          <h3>
            <a class="item" href="https://serverlessai.dev/"
              >Show HN: ServerlessAI – Build, scale, and monetize AI apps
              without back end</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 12:37:38</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765395"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’ve always loved building frontend-only apps—those you can
                prototype over a weekend, host for free on GitHub Pages, and
                scale to millions of users. Unfortunately, AI-enabled apps
                complicate things, as exposing your OpenAI key to the world is
                obviously a no-go. This also means mobile developers often have
                to run their own servers.
              </p>
              <p>
                That’s why I built ServerlessAI, an API gateway that lets you
                securely call multiple AI providers directly from client side
                using OpenAI-compatible APIs. You can authenticate users through
                any identity provider, like Google or Apple, and set per-user
                request or spending quotas. You can also define an allowlist for
                endpoints and models. To monetize, you can apply different
                quotas for various user tiers.
              </p>
              <p>
                To start, I recommend checking out our tutorials, where we walk
                you through building a complete, deployment-ready AI app in 5
                minutes. We’ve got tutorials for React, Next.js, and iOS:
                <a href="https://serverlessai.dev/docs/tutorials/"
                  >https://serverlessai.dev/docs/tutorials/</a
                >
              </p>
              <p>
                Our long term vision is to offer the best toolkit for AI
                developers at every stage of their project’s lifecycle. If
                OpenAI / Anthropic / etc are AWS, we want to be the Supabase /
                Upstash / etc. We are building optional out-of-box tools for
                authentication and payment management, so you can roll out your
                prototype faster. In the future, we want to provide the best
                prompt engineering tools for fine-tuning, A/B testing, and
                backtesting, as well as the best observability tools.
              </p>
              <p>We’d love to hear your feedback. Thanks for stopping by!</p>
            </div>
          </section>
        </section>
        <section id="41764635">
          <h3>
            <a
              class="item"
              href="https://chromewebstore.google.com/detail/aria-devtools/dneemiigcbbgbdjlcdjjnianlikimpck"
              >Show HN: Visualization of website accessibility tree</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 10:38:36</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41764635"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've spend two months delivering a tool that is easy to
                understand and helps catching accessibility issues on my apps. A
                few years later it's pretty popular despite being mostly
                abandoned.
              </p>
              <p>
                I will be happy to work on this further but honestly lost my
                enthusiasm some time ago. I'd love to get in touch with some
                company in the accessibility testing space and discuss how to
                improve it.
              </p>
            </div>
          </section>
        </section>
        <section id="41764486">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/this-homemade-ai-drone-software-finds-bodies-when-search-and-rescue-teams-cant/"
              >Homemade AI Drone Software Finds People When Search and Rescue
              Teams Can't</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 10:12:42</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41764486"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41763242">
          <h3>
            <a
              class="item"
              href="https://15721.courses.cs.cmu.edu/spring2019/papers/17-hashjoins/richter-vldb2015.pdf"
              >A seven-dimensional analysis of hashing methods [pdf] (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 06:16:33</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41763242"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41757940">
          <h3>
            <a
              class="item"
              href="https://r.ena.to/blog/optimizing-postgres-table-layout-for-maximum-efficiency/"
              >Optimizing Postgres table layout for maximum efficiency</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-06 @ 15:50:52</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41757940"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41756432">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41756432"
              >Ask HN: What's the "best" book you've ever read?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-06 @ 11:42:33</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41756432"
                  >Comments</a
                ><span class="descendants">: 512</span></span
              >
            </h4>
            <div class="text">
              <p>
                What's the "best" book you've ever read? By "best", in means
                whatever you mean.
              </p>
            </div>
          </section>
        </section>
        <section id="41756219">
          <h3>
            <a
              class="item"
              href="https://nickb.website/blog/virtualizing-ios-on-apple-silicon"
              >Virtualizing iOS on Apple Silicon</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-06 @ 10:44:34</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41756219"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41756205">
          <h3>
            <a class="item" href="https://johncostella.com/magic/"
              >The magic (image resampling) kernel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-06 @ 10:40:07</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41756205"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41748519">
          <h3>
            <a class="item" href="https://github.com/cepa/aegir-gps-tracker"
              >Show HN: I built a Iridium/LTE satellite GPS tracker and took it
              to the Arctic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 08:36:31</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41748519"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41729765">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/hubble-space-telescope-re-invention"
              >NASA Made the Hubble Telescope to Be Remade</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 11:49:56</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41729765"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
