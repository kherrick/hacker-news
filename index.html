<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40907155">
          <h3>
            <a class="item" href="https://paulgraham.com/persistence.html"
              >The Right Kind of Stubborn</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 17:05:08</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40907155"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40906401">
          <h3>
            <a class="item" href="https://github.com/Osiris-Team/1JPM"
              >1JPM: A Maven/Gradle alternative in a single Java file</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 15:45:40</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40906401"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40906148">
          <h3>
            <a class="item" href="https://conduition.io/coding/ticketmaster/"
              >Reverse Engineering Ticketmaster's Rotating Barcodes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 15:14:06</span
              ><span class="points-container"
                >Points: <span class="points">466</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40906148"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40906112">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/publications/loginonline/understanding-software-dynamics"
              >Understanding Software Dynamics [book review]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 15:09:43</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40906112"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40905899">
          <h3>
            <a class="item" href="https://pomb.us/build-your-own-react/"
              >Build your own React (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 14:45:24</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40905899"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40905891">
          <h3>
            <a
              class="item"
              href="https://dublog.net/blog/so-many-python-package-managers/"
              >Python Has Too Many Package Managers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 14:44:20</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40905891"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40905849">
          <h3>
            <a class="item" href="https://words.filippo.io/dispatches/geomys/"
              >Geomys, a blueprint for a sustainable open-source maintenance
              firm</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 14:39:35</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40905849"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40905719">
          <h3>
            <a class="item" href="https://github.com/victrixsoft/bashbro"
              >Bashbro – Make Any Comp a Web-Based File Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 14:24:24</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40905719"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40905706">
          <h3>
            <a
              class="item"
              href="https://www.theglobeandmail.com/canada/alberta/article-for-the-first-time-in-more-than-150-years-albertas-electricity-is-coal/"
              >For the first time in more than 150 years, Alberta's electricity
              is coal free</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 14:23:17</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40905706"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40905686">
          <h3>
            <a class="item" href="https://swift-ai.vercel.app/"
              >Show HN: A fast OSS voice assistant</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 14:21:05</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40905686"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40905295">
          <h3>
            <a class="item" href="https://github.com/incidentalhq/incidental"
              >Show HN: I am building an open-source incident management
              platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 13:34:58</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40905295"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been working on it for the past couple of months as a
                hobby, and now it's at a state where I'm comfortable sharing it.
                This is also my first open source project.
              </p>
              <p>
                Features: - Custom roles - Custom severities - Integrated with
                Slack - Web interface
              </p>
              <p>Todos: - Custom fields - Custom workflows</p>
              <p>
                Website:
                <a href="https://incidental.dev">https://incidental.dev</a>
                Github:
                <a href="https://github.com/incidentalhq/incidental"
                  >https://github.com/incidentalhq/incidental</a
                >
              </p>
              <p>I'd love to hear your feedback.</p>
              <p>Thanks!</p>
            </div>
          </section>
        </section>
        <section id="40904862">
          <h3>
            <a class="item" href="https://github.com/onlook-dev/studio"
              >Show HN: Open-sourced Webflow for your own app</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 12:36:10</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40904862"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
            <div class="text">
              <p>
                Technical details: This is technically a web browser that can
                point to your localhost, which injects some CSS into the page
                that allows you to select, drag, and drop DOM elements, then
                track and translate those changes back into React code.
                Theoretically, you could do this with any compiled framework but
                I wanted a reasonable scope for the launch (the first version
                was actually in Svelte).
              </p>
              <p>
                Some interesting challenges: 1. There is a React parser that is
                used to parse, insert the style, and serialize it back to code
                2. There is a React pre-processor that traces the DOM elements
                to the corresponding code 3. There's also CSS parsing,
                injection, and converting to Tailwind 4. This is also an
                Electron app so there’s a browser within a browser within a node
                app which makes message passing… interesting
              </p>
              <p>
                What’s next? We’ve already built a proof-of-concept for
                inspecting and selecting layers, dragging to reorder, and
                inserting new DOM elements that I’m working on porting over from
                our private codebase. We’re also exploring opening more tabs in
                new frames in order to A/B test the changes before committing to
                code. There’s a long tail of exciting features we can do but I
                want to put this out there first and see what others would need.
              </p>
              <p>
                Let me know what you think/feedback. It's been a blast working
                on this so far and I think it’s just neat :)
              </p>
            </div>
          </section>
        </section>
        <section id="40904654">
          <h3>
            <a
              class="item"
              href="https://finchwench.wordpress.com/2011/09/06/cosmoquails/"
              >Birds in Space II: Quails in the Cosmos (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 12:09:21</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40904654"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40904587">
          <h3>
            <a class="item" href="https://up.codes/careers?utm_source=HN"
              >UpCodes (YC S17) is hiring remote SWEs, PMs to help make
              buildings cheap</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 12:00:34</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40903870">
          <h3>
            <a class="item" href="https://github.com/Xpra-org/xpra"
              >Xpra: Persistent Remote Applications for X11</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 09:15:47</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40903870"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40902749">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/07/08/boeing-to-plead-guilty-to-criminal-fraud-charge-stemming-from-737-max-crashes.html"
              >Boeing to plead guilty to criminal fraud charge stemming from 737
              MAX crashes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 05:06:34</span
              ><span class="points-container"
                >Points: <span class="points">441</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40902749"
                  >Comments</a
                ><span class="descendants">: 453</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40902740">
          <h3>
            <a
              class="item"
              href="https://brooker.co.za/misc-blog/2024/01/23/skis.html"
              >Do Skis Get Blunt?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 05:04:58</span
              ><span class="points-container"
                >Points: <span class="points">214</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40902740"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40902012">
          <h3>
            <a
              class="item"
              href="https://dgerrells.com/blog/how-fast-is-javascript-simulating-20-000-000-particles"
              >Show HN: Simulating 20M Particles in JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 01:52:54</span
              ><span class="points-container"
                >Points: <span class="points">458</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40902012"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
            <div class="text">
              <p>Skip to the end to play around with the final app.</p>
              <p>
                Open to ideas on how to simulate more whilst staying in js land.
              </p>
            </div>
          </section>
        </section>
        <section id="40901623">
          <h3>
            <a
              class="item"
              href="https://noamzeise.com/2024/07/05/mini-monitor.html"
              >A Mini Monitor for a Pi</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 00:27:58</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40901623"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40899393">
          <h3>
            <a
              class="item"
              href="http://www.righto.com/2024/07/pentium-standard-cells.html"
              >Standard cells: Looking at individual gates in the Pentium
              processor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-07 @ 18:19:49</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40899393"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40899309">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2407.02678"
              >Reasoning in Large Language Models: A Geometric Perspective</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-07 @ 18:09:25</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40899309"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40899242">
          <h3>
            <a class="item" href="https://satyrn.app/"
              >Show HN: A modern Jupyter client for macOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-07 @ 17:59:31</span
              ><span class="points-container"
                >Points: <span class="points">554</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40899242"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
            <div class="text">
              <p>
                It starts up really fast (faster time-to-execution than VS Code
                or JupyterLab), you can launch notebooks right from the Finder,
                and the design is super minimalist. It's got an OpenAI
                integration (use your own API key) for multi-cell generation
                with your notebook as context (I'll add other LLMs soon). And
                many more useful features like a virtual environment management
                UI, Black code formatting, and easy image/table copy buttons.
              </p>
              <p>
                Full disclosure: it's built with Electron. I originally wrote it
                in Swift but couldn't get the editor experience to where I
                wanted it. Now it supports autocomplete, multi-cursor editing,
                and moving the cursor between cells just like you'd expect from
                JupyterLab or VS Code.
              </p>
              <p>
                Satyrn sits on top of the jupyter-server, so it works with all
                your existing python kernels, Jupyter configuration, and ipynb
                files. It only works with local files at the moment, but I'm
                planning to extend it to support remote servers as well.
              </p>
              <p>
                I'm an indie developer, and I will try to monetize at some
                point, but it's free while in alpha. If you're interested,
                please try it out!
              </p>
              <p>
                I'd love your feedback in the comments, or you can contact me at
                jack-at-satyrn-dot-app.
              </p>
            </div>
          </section>
        </section>
        <section id="40897506">
          <h3>
            <a
              class="item"
              href="https://notes.eatonphil.com/2024-07-07-systems-meetups.html"
              >A reawakening of systems programming meetups</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-07 @ 13:20:37</span
              ><span class="points-container"
                >Points: <span class="points">352</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40897506"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40891372">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/06/28/cold-shipping-might-be-the-next-industry-that-batteries-disrupt/"
              >Cold shipping might be the next industry that batteries
              disrupt</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-06 @ 16:16:47</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40891372"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40887516">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=1idSEhUT4PM"
              >Modifying the OG Xbox to have 256M of RAM [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-06 @ 01:22:25</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40887516"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40884998">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-07-common-english-words-dont-boy.html"
              >Five common English words we don't know the origins of–including
              'boy' and 'dog'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 18:37:10</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40884998"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40884917">
          <h3>
            <a class="item" href="https://dl.acm.org/doi/10.1145/3656404"
              >Refined Input, Degraded Output: The Counterintuitive World of
              Compiler Behavior</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 18:25:29</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40884917"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40880302">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/detect-migrating-birds-with-sound"
              >Detect Migrating Birds with a Plastic Dish and a Cheap
              Microphone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 06:41:50</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40880302"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40873726">
          <h3>
            <a
              class="item"
              href="https://lu.sagebl.eu/notes/can-i-save-space-with-grayscale-jpegs/"
              >Do grayscale images take less space?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 10:10:45</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40873726"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40864085">
          <h3>
            <a
              class="item"
              href="https://mathshistory.st-andrews.ac.uk/Extras/Euler_letters/"
              >Leonhard Euler's Letters to a German Princess</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 08:57:23</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40864085"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
