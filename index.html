<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45583129">
          <h3>
            <a
              class="item"
              href="https://www.cam.ac.uk/research/news/new-lab-grown-human-embryo-model-produces-blood-cells"
              >New lab-grown human embryo model produces blood cells</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 18:22:04</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45583129"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45582462">
          <h3>
            <a
              class="item"
              href="https://excamera.substack.com/p/how-bad-can-a-297-adc-be"
              >How bad can a $2.97 ADC be?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 17:12:10</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45582462"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45582268">
          <h3>
            <a
              class="item"
              href="https://github.com/ashtonsix/perf-portfolio/tree/main/delta"
              >Prefix sum: 20 GB/s (2.6x baseline)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 16:53:24</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45582268"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45581761">
          <h3>
            <a
              class="item"
              href="https://mtlynch.io/notes/hold-off-on-litestream-0.5.0/"
              >Hold Off on Litestream 0.5.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 16:10:27</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45581761"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45581146">
          <h3>
            <a
              class="item"
              href="https://tosc.iacr.org/index.php/ToSC/article/view/10302"
              >Subverting Telegram's end-to-end encryption (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 15:23:09</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45581146"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45581029">
          <h3>
            <a
              class="item"
              href="https://www.thalamusgme.com/blogs/cortex-core-clerkship-grades-and-transcript-normalization"
              >GPT-5o-mini hallucinates medical residency applicant grades</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 15:12:21</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45581029"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45580771">
          <h3>
            <a class="item" href="https://github.com/metorial/metorial"
              >Show HN: Metorial (YC F25) – Vercel for MCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 14:49:56</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45580771"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <a href="https://metorial.com">https://metorial.com</a>), an
              integration platform that connects AI agents to external tools and
              data using MCP.
              <p>
                The Problem: While MCP works great locally (e.g., Cursor or
                Claude Desktop), server-side deployments are painful. Running
                MCP servers means managing Docker configs, per-user OAuth flows,
                scaling concurrent sessions, and building observability from
                scratch. This infrastructure work turns simple integrations into
                weeks of setup.
              </p>
              <p>
                Metorial handles all of this automatically. We maintain an open
                catalog of ~600 MCP servers (GitHub, Slack, Google Drive,
                Salesforce, databases, etc.) that you can deploy in three
                clicks. You can also bring your own MCP server or fork existing
                ones.
              </p>
              <p>
                For OAuth, just provide your client ID and secret and we handle
                the entire flow, including token refresh. Each user then gets an
                isolated MCP server instance configured with their own OAuth
                credentials automatically.
              </p>
              <p>
                What makes us different is that our serverless runtime
                hibernates idle MCP servers and resumes them with sub-second
                cold starts while preserving the state and connection. Our
                custom MCP engine is capable of managing thousands of concurrent
                connections, giving you a scalable service with per-user
                isolation. Other alternatives either run shared servers
                (security issues) or provision separate VMs per user (expensive
                and slow to scale).
              </p>
              <p>
                Our Python and TypeScript SDKs let you connect LLMs to MCP tools
                in a single function call, abstracting away the protocol
                complexity. But if you want to dig deep, you can just use
                standard MCP and our REST API (<a
                  href="https://metorial.com/api"
                  >https://metorial.com/api</a
                >) to connect to our platform.
              </p>
              <p>
                You can self-host (<a
                  href="https://github.com/metorial/metorial"
                  >https://github.com/metorial/metorial</a
                >) or use the managed version at
                <a href="https://metorial.com">https://metorial.com</a>.
              </p>
              <p>
                So far, we see enterprise teams use Metorial to have a central
                integration hub for tools like Salesforce, while startups use it
                to cut weeks of infra work on their side when building AI agents
                with integrations.
              </p>
              <p>
                Demo video:
                <a href="https://www.youtube.com/watch?v=07StSRNmJZ8"
                  >https://www.youtube.com/watch?v=07StSRNmJZ8</a
                >
              </p>
              <p>
                Our Repos: Metorial:
                <a href="https://github.com/metorial/metorial"
                  >https://github.com/metorial/metorial</a
                >, MCP Containers:
                <a href="https://github.com/metorial/mcp-containers"
                  >https://github.com/metorial/mcp-containers</a
                >
              </p>
              <p>
                SDKs: Node/TypeScript:
                <a href="https://github.com/metorial/metorial-node"
                  >https://github.com/metorial/metorial-node</a
                >, Python:
                <a href="https://github.com/metorial/metorial-python"
                  >https://github.com/metorial/metorial-python</a
                >
              </p>
              <p>
                We'd love to hear feedback, especially if you've dealt with
                deploying MCP at scale!
              </p>
            </div>
          </section>
        </section>
        <section id="45580699">
          <h3>
            <a
              class="item"
              href="https://www.mpg.de/25518363/1007-asph-astronomers-image-a-mysterious-dark-object-in-the-distant-universe-155031-x"
              >Astronomers 'image' a mysterious dark object in the distant
              Universe</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 14:45:02</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45580699"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45580315">
          <h3>
            <a
              class="item"
              href="https://nuxx.net/blog/2025/10/14/wireshark-4-6-0-supports-macos-pktap-metadata-pid-process-name-etc/"
              >Wireshark 4.6.0 Supports macOS Pktap Metadata (PID, Process Name,
              etc.)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 14:18:14</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45580315"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45579708">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-025-03307-x"
              >CRISPR-like tools that finally can edit mitochondria DNA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 13:21:03</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45579708"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45579275">
          <h3>
            <a class="item" href="https://pyrefly.org/?featured_on=talkpython"
              >Pyrefly: Python type checker and language server in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 12:33:01</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45579275"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45578990">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/kyber/jobs/BQRRSrZ-enterprise-account-executive-ae"
              >Kyber (YC W23) Is Hiring an Enterprise AE</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 12:00:56</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45578540">
          <h3>
            <a class="item" href="https://ktye.github.io/"
              >Zoo of Array Languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 11:01:43</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45578540"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45578467">
          <h3>
            <a
              class="item"
              href="https://www.nexperia.com/about/news-events/press-releases/update-on-company-developments"
              >Nexperia – Update on Company Developments</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 10:52:33</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45578467"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45578383">
          <h3>
            <a class="item" href="https://adsb.exposed/">ADS-B Exposed</a>
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 10:38:48</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45578383"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45578117">
          <h3>
            <a class="item" href="https://kde.org/fundraisers/yearend2025/"
              >KDE celebrates the 29th birthday and kicks off the yearly
              fundraiser</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 09:54:53</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45578117"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45576502">
          <h3>
            <a
              class="item"
              href="https://transactional.blog/copy-and-patch/tutorial"
              >Copy-and-Patch: A Copy-and-Patch Tutorial</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 05:14:26</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45576502"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45575391">
          <h3>
            <a
              class="item"
              href="https://satcom.sysnet.ucsd.edu/docs/dontlookup_ccs25_fullpaper.pdf"
              >Don’t Look Up: Sensitive internal links in the clear on GEO
              satellites [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 01:48:56</span
              ><span class="points-container"
                >Points: <span class="points">482</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45575391"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45574393">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2025/10/ddos-botnet-aisuru-blankets-us-isps-in-record-ddos/"
              >DDoS Botnet Aisuru Blankets US ISPs in Record DDoS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-13 @ 23:21:23</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45574393"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45568915">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/business/2025/10/13/manufacturing-artificial-intelligence/"
              >America is getting an AI gold rush instead of a factory boom</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-13 @ 14:48:47</span
              ><span class="points-container"
                >Points: <span class="points">407</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45568915"
                  >Comments</a
                ><span class="descendants">: 564</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45568613">
          <h3>
            <a class="item" href="https://herman.bearblog.dev/being-present/"
              >Smartphones and being present</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-13 @ 14:20:33</span
              ><span class="points-container"
                >Points: <span class="points">394</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45568613"
                  >Comments</a
                ><span class="descendants">: 237</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45567770">
          <h3>
            <a class="item" href="https://sqliteonline.com/"
              >Show HN: SQLite Online – 11 years of solo development, 11K daily
              users</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-13 @ 12:46:52</span
              ><span class="points-container"
                >Points: <span class="points">443</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45567770"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45566644">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2025/10/13/dutch-government-takes-control-of-chinese-owned-chipmaker-nexperia.html"
              >Dutch government takes control of Chinese-owned chipmaker
              Nexperia</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-13 @ 10:03:11</span
              ><span class="points-container"
                >Points: <span class="points">675</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45566644"
                  >Comments</a
                ><span class="descendants">: 579</span></span
              >
            </h4>
            <div class="text">
              Related:
              https://www.scmp.com/news/china/diplomacy/article/3328726/chinas-wingtech-says-dutch-court-freezes-control-nexperia-amid-national-security-dispute
            </div>
          </section>
        </section>
        <section id="45530533">
          <h3>
            <a class="item" href="https://lwn.net/Articles/1038715/"
              >The phaseout of the mmap() file operation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-09 @ 17:19:37</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45530533"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45525168">
          <h3>
            <a
              class="item"
              href="https://www.stavros.io/posts/why-is-everything-so-scalable/"
              >Why is everything so scalable?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-09 @ 08:53:30</span
              ><span class="points-container"
                >Points: <span class="points">277</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45525168"
                  >Comments</a
                ><span class="descendants">: 270</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45521032">
          <h3>
            <a
              class="item"
              href="https://www.rollingstone.com/culture/culture-news/chatgpt-palisades-fire-suspect-1235443216/"
              >Palisades Fire suspect's ChatGPT history to be used as
              evidence</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 21:53:34</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45521032"
                  >Comments</a
                ><span class="descendants">: 211</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45514378">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20251007-how-ultrasound-is-ushering-a-new-era-of-surgery-free-cancer-treatment"
              >Ultrasound is ushering a new era of surgery-free cancer
              treatment</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 10:18:58</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45514378"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45512351">
          <h3>
            <a
              class="item"
              href="https://github.com/toredash/automatic-zone-placement"
              >Automatic K8s pod placement to match external service zones</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 05:21:27</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45512351"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45508462">
          <h3>
            <a
              class="item"
              href="https://turso.tech/blog/beyond-the-single-writer-limitation-with-tursos-concurrent-writes"
              >Beyond the SQLite Single-Writer Limitation with Concurrent
              Writes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 20:32:55</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45508462"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45498887">
          <h3>
            <a
              class="item"
              href="https://www.trthaber.com/foto-galeri/karahantepede-12-bin-yil-oncesine-ait-insan-yuzlu-dikili-tas-bulundu/73912.html"
              >A 12,000-year-old obelisk with a human face was found in Karahan
              Tepe</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 02:43:03</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45498887"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
