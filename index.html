<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36526827">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20221215015113/https://pastebin.com/raw/irj4Fyd5"
              >The Gentleperson's Guide to Forum Spies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 21:16:38</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36526827"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36526726">
          <h3>
            <a
              class="item"
              href="https://abstractexpr.com/2023/06/29/structures-in-c-from-basics-to-memory-alignment/"
              >Structures in C: From Basics to Memory Alignment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 21:08:31</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36526726"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36526645">
          <h3>
            <a
              class="item"
              href="https://www.themarginalian.org/2014/12/30/why-do-men-stupefy-themselves-leo-tolstoy/"
              >Why do men stupefy themselves? Leo Tolstoy on why we drink
              (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 21:01:22</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36526645"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36526389">
          <h3>
            <a
              class="item"
              href="https://www.local10.com/news/local/2023/06/28/fort-lauderdale-saves-nearly-350k-after-repurposing-seaweed-into-planting-soil/"
              >Fort Lauderdale saves nearly $350K after repurposing seaweed into
              planting soil</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 20:38:59</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36526389"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36525950">
          <h3>
            <a class="item" href="https://github.com/karust/openserp"
              >Now you can search on Google for free: Solution with API</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 20:04:15</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36525950"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36525940">
          <h3>
            <a
              class="item"
              href="https://github.com/teslamotors/fleet-telemetry"
              >Tesla Fleet Telemetry</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 20:03:25</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36525940"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36525455">
          <h3>
            <a
              class="item"
              href="https://drexel.edu/news/archive/2023/June/Drexel-Physicists-Produce-New-Images-of-Milky-Way-Galaxy"
              >Physicists Produce Neutrino Images of Milky Way Galaxy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 19:22:56</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36525455"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36525015">
          <h3>
            <a
              class="item"
              href="https://www.qt.io/blog/the-kde-free-qt-foundation-25-years-of-celebration"
              >The KDE Free Qt Foundation: 25 Years of Celebration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 18:52:01</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36525015"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36524662">
          <h3>
            <a
              class="item"
              href="https://www.ctvnews.ca/politics/google-set-to-remove-news-links-in-canada-meta-ends-contract-for-journalism-fellowship-as-bill-c-18-fallout-continues-1.6461557"
              >Bill C-18: Google to remove news links in Canada over online news
              law</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 18:27:54</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36524662"
                  >Comments</a
                ><span class="descendants">: 273</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36524078">
          <h3>
            <a class="item" href="https://github.com/gorilla-llm/gorilla-cli"
              >Gorilla-CLI: LLMs for CLI including K8s/AWS/GCP/Azure/sed and
              1500 APIs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 17:52:45</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36524078"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36523843">
          <h3>
            <a class="item" href="https://github.com/status"
              >Github.com is down</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 17:40:15</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36523843"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36523762">
          <h3>
            <a
              class="item"
              href="https://www.micahlerner.com/2023/06/29/towards-an-adaptable-systems-architecture-for-memory-tiering-at-warehouse-scale.html"
              >Towards an Adaptable Systems Architecture for Memory Tiering at
              Warehouse-Scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 17:35:47</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36523762"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36523647">
          <h3>
            <a class="item" href="https://cleanlab.ai/blog/prompt-selection/"
              >Beware of Unreliable Data in Model Evaluation: A LLM Prompt
              Selection Case Study</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 17:28:34</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36523647"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36523571">
          <h3>
            <a
              class="item"
              href="https://morepablo.com/2023/06/creatives-industries.html"
              >Being “rockstars”: when software was a talents/creatives
              industry</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 17:23:48</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36523571"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36523480">
          <h3>
            <a
              class="item"
              href="https://martinfowler.com/articles/building-boba.html"
              >Building Boba AI: Lessons learnt in building an LLM-powered
              application</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 17:19:01</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36523480"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36523300">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/freshpaint/bfe56523-bff4-4ca3-936b-0ba15fb4e572?utm_source=hn"
              >Freshpaint (YC S19) is hiring software engineers to build a HIPAA
              data platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 17:06:36</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36521699">
          <h3>
            <a class="item" href="https://github.com/wolfia-app/gpt-code-search"
              >Show HN: Open-source code search with OpenAI's function
              calling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 15:25:31</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36521699"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                All you need to do is to install the package with `pip install
                gpt-code-search`, set up your `OPENAI_API_KEY` as an environment
                variable, and start asking questions with `gpt-code-search query
                &lt;your question&gt;`.
              </p>
              <p>
                E.g. You can ask questions like "How do I use the analytics
                module?" or "Document all the API routes related to
                authentication."
              </p>
              <p>
                This is still early and hacked together in the past week, but we
                wanted to get it out there and get feedback.
              </p>
              <p>
                We utilize OpenAI's function calling to let GPT-4 call certain
                predefined functions in our library. You do not need to
                implement any of these functions yourself. These functions are
                designed to interact with your codebase and return enough
                context for the LLM to perform code searches without
                pre-indexing it or uploading your repo to a third party other
                than OpenAI. So, you only need to run the tool from the
                directory you want to search.
              </p>
              <p>The functions currently available for the LLM to call are:</p>
              <p>
                `search_codebase` - searches the codebase using a TF-IDF
                vectorizer
              </p>
              <p>`get_file_tree` - provides the file tree of the codebase</p>
              <p>`get_file_contents` - provides the contents of a file</p>
              <p>
                These functions are implemented in `gpt-code-search` and are
                triggered by chat completions. The LLM is prompted to utilize
                the search_codebase and get_file_tree function as needed to find
                the necessary context to answer your query and then loops as
                needed to collect more context with the get_file_contents until
                the LLM responds.
              </p>
              <p>
                A couple of limitations of this approach, GPT cannot load
                context across multiple files in a single prompt since we are
                passing in the contents of a single file in each function call.
                So, GPT repeatedly calls the get_file_contents function to load
                context from multiple files. This increases the latency and cost
                of the tool.
              </p>
              <p>
                Another thing we realized as we were building is that the level
                of search and retrieval is limited by the context window, which
                refers to the scope of the search conducted by the tool, meaning
                that we can only search five levels deep in the file system and
                can only pass in the contents of one file at a time. So it would
                be best to run the tool from the package/directory closest to
                the code you want to search.
              </p>
              <p>
                We plan to add support for local vector embeddings to improve
                search and retrieval. Combining the vector embeddings with
                function calling should result in much faster and higher quality
                results.
              </p>
              <p>
                Also, support for other models, chat interactions in the command
                line, and generating code is already on our backlog!
              </p>
              <p>
                Please check out gpt-code-search and let me know your thoughts,
                feedback, or suggestions.
              </p>
            </div>
          </section>
        </section>
        <section id="36520985">
          <h3>
            <a class="item" href="https://github.com/rabbibotton/clog"
              >Clog – The Common Lisp Omnificent GUI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 14:40:17</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36520985"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36520925">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02167-7"
              >Monster gravitational waves spotted for first time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 14:36:21</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36520925"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36520658">
          <h3>
            <a
              class="item"
              href="https://www.latimes.com/politics/story/2023-06-29/supreme-court-strikes-down-affirmative-action-in-college-admissions"
              >Supreme Court strikes down affirmative action in college
              admissions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 14:16:31</span
              ><span class="points-container"
                >Points: <span class="points">616</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36520658"
                  >Comments</a
                ><span class="descendants">: 987</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36520410">
          <h3>
            <a
              class="item"
              href="https://www.windmill.dev/blog/knowledge-base-discord-bot"
              >Show HN: Build a discord/Slack bot to answer questions with your
              docs and GPT4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 13:54:14</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36520410"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                You will also need pgvector (here hosted on supabase) and of
                course a GPT4 api key.
              </p>
              <p>
                It showcases an approval step so that you only provide answers
                you are confident giving to your users, which feels less
                robotic.
              </p>
              <p>
                All the building blocks are scripts that you can reuse outside
                of windmill and you could build this in any other workflow
                engines (although less conveniently).
              </p>
              <p>
                We use it for our own needs on discord [2] and thoughts this was
                a common need for any product having community support on slack
                or discord.
              </p>
              <p>
                [1]:
                <a href="https://github.com/windmill-labs/windmill"
                  >https://github.com/windmill-labs/windmill</a
                >
              </p>
              <p>
                [2]:
                <a href="https://discord.com/invite/V7PM2YHsPB"
                  >https://discord.com/invite/V7PM2YHsPB</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36519942">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/society/2023/jun/29/aspartame-artificial-sweetener-possible-cancer-risk-carcinogenic"
              >Aspartame sweetener to be declared possible cancer risk by WHO,
              say reports</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 13:16:22</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36519942"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36519497">
          <h3>
            <a
              class="item"
              href="https://whileydave.com/2023/06/27/programming-languages-going-above-and-beyond/"
              >Programming languages going above and beyond</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 12:29:19</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36519497"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36517651">
          <h3>
            <a
              class="item"
              href="https://github.com/ParthJadhav/Tkinter-Designer"
              >Tkinter Designer: Quickly Turn Figma Design to Python Tkinter
              GUI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 07:55:33</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36517651"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36517525">
          <h3>
            <a class="item" href="https://awk.dev/"
              >The Awk Programming Language, Second Edition</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-29 @ 07:34:55</span
              ><span class="points-container"
                >Points: <span class="points">467</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36517525"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36499884">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-06-approach-properties-turbulence.html"
              >A new approach to controlling the properties of turbulence</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 23:00:07</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36499884"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36499875">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-06-atomic-nucleus.html"
              >Researcher discovers new isotope of astatine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 22:59:17</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36499875"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36498432">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=zXPiqk0-zDY"
              >A 32-Bit Computer Inside Terraria [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 20:49:16</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36498432"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36497285">
          <h3>
            <a
              class="item"
              href="https://www.sciencedirect.com/science/article/pii/S0305440323000559"
              >Accelerating the discovery of new Nasca geoglyphs using deep
              learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 19:04:11</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36497285"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36493191">
          <h3>
            <a
              class="item"
              href="https://bastian.rieck.me/blog/posts/2023/writing_why/"
              >Why write?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 14:20:48</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36493191"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
