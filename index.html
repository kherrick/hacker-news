<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45161702">
          <h3>
            <a
              class="item"
              href="https://antongolub.substack.com/p/how-did-tether-profit-13-billion"
              >How did Tether profit $13B in 2024 from USDT?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 20:11:06</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45161702"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45161229">
          <h3>
            <a
              class="item"
              href="https://www.csiro.au/en/news/All/Articles/2025/August/Metals-out-of-martian-dirt"
              >How to make metals from Martian dirt</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 19:09:45</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45161229"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45160780">
          <h3>
            <a class="item" href="https://www.submarinecablemap.com/"
              >Submarine Cable Map</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 18:17:29</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45160780"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45160774">
          <h3>
            <a
              class="item"
              href="https://allan.reyes.sh/posts/keeping-secrets-out-of-logs/"
              >Keeping secrets out of logs (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 18:16:30</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45160774"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45158968">
          <h3>
            <a
              class="item"
              href="https://twitter.com/samhenrigold/status/1964428927159382261"
              >The MacBook has a sensor that knows the exact angle of the screen
              hinge</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 15:20:29</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45158968"
                  >Comments</a
                ><span class="descendants">: 176</span></span
              >
            </h4>
            <div class="text">
              <a href="https://hachyderm.io/@samhenrigold/115159295473019599"
                >https://hachyderm.io/@samhenrigold/115159295473019599</a
              >,
              <a
                href="https://bsky.app/profile/samhenri.gold/post/3ly7252lx422d"
                >https://bsky.app/profile/samhenri.gold/post/3ly7252lx422d</a
              >
              <p>
                Theremin Mode:
                <a
                  href="https://twitter.com/samhenrigold/status/1964464940049453153"
                  >https://twitter.com/samhenrigold/status/1964464940049453153</a
                >
              </p>
              <p>
                Github:
                <a href="https://github.com/samhenrigold/LidAngleSensor"
                  >https://github.com/samhenrigold/LidAngleSensor</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="45158814">
          <h3>
            <a
              class="item"
              href="https://www.tcl-lang.org/community/tcl2017/assets/talk93/Paper.html"
              >SQLite's Use of Tcl</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 15:03:46</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45158814"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45158523">
          <h3>
            <a
              class="item"
              href="https://twitter.com/grapheneos/status/1964561043906048183"
              >Delayed Security Patches for AOSP (Android Open Source
              Project)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 14:36:32</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45158523"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45157906">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Belling_the_Cat"
              >Belling the Cat</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 13:15:35</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45157906"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45157466">
          <h3>
            <a
              class="item"
              href="https://www.relax.software/blog/flix-effects-intro/"
              >Algebraic Effects in Practice with Flix</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 12:07:50</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45157466"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45157223">
          <h3>
            <a class="item" href="https://github.com/BeaconBay/ck"
              >Show HN: Semantic grep for Claude Code (local embeddings)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 11:20:37</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45157223"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45157110">
          <h3>
            <a class="item" href="https://serverlesshorrors.com/"
              >Serverless Horrors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 11:00:03</span
              ><span class="points-container"
                >Points: <span class="points">493</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45157110"
                  >Comments</a
                ><span class="descendants">: 353</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45157020">
          <h3>
            <a class="item" href="https://molecheck.info/"
              >Show HN: I'm a dermatologist and I vibe coded a skin cancer
              learning app</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 10:38:29</span
              ><span class="points-container"
                >Points: <span class="points">258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45157020"
                  >Comments</a
                ><span class="descendants">: 171</span></span
              >
            </h4>
            <div class="text">
              <p>
                Single file including all html/js/css, Vanilla JS, no backend,
                scores persisted with localStorage.
              </p>
              <p>
                Deployed using ubuntu/apache2/python/flask on a £5 Digital Ocean
                server (but could have been hosted on a static hosting provider
                as it's just a single page with no backend).
              </p>
              <p>Images / metadata stored in an AWS S3 bucket.</p>
            </div>
          </section>
        </section>
        <section id="45155877">
          <h3>
            <a
              class="item"
              href="https://eli.thegreenplace.net/2016/the-expression-problem-and-its-solutions/"
              >The Expression Problem and its solutions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 06:28:04</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45155877"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45155682">
          <h3>
            <a class="item" href="https://lwn.net/Articles/1034121/"
              >The "impossibly small" Microdot web framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 05:38:30</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45155682"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45154857">
          <h3>
            <a class="item" href="https://github.com/ccheshirecat/flint"
              >Show HN: Lightweight tool for managing Linux virtual machines</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 02:30:16</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45154857"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
            <div class="text">
              hey guys. the other day i was migrating hosting providers and i
              just needed something not too heavy and convenient to spin up my
              backups for awhile and realised there is almost nothing out there.
              kimchi hasn't been updated for years and cockpit is heavy. so
              here's something i came up with in a couple hours because of a
              sudden urge, nothing fancy just basic creation with cloud init,
              lifecycle management and image/storage, but it's modern-ish and it
              compiles to a 8.4mb binary inclusive of the embedded web UI, CLI
              and API, and only dep is libvirt.
            </div>
          </section>
        </section>
        <section id="45154501">
          <h3>
            <a class="item" href="https://stlab.cc/tips/about-mvc.html"
              >The key to getting MVC correct is understanding what models
              are</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 01:26:44</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45154501"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45152940">
          <h3>
            <a class="item" href="https://kanadojo.com"
              >Show HN: I'm making an open-source platform for learning
              Japanese</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 21:19:30</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45152940"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
            <div class="text">
              <p>
                Unfortunately, pretty much all language learning apps are
                closed-sourced and paid these days, and the ones that are free
                have unfortunately been abandoned.
              </p>
              <p>
                But of course, just creating yet another language learning app
                was not enough - there has to be a unique selling point. And
                then I thought to myself: why not make it crazy and do what no
                other language learning app ever did by adding a gazillion
                different color themes and fonts, to really hit it home and
                honor the app's original inspiration, Monkeytype?
              </p>
              <p>
                And so I did. Now, I'm looking to find contributors and testers
                for the early stages of the app.
              </p>
              <p>
                Why? Because weebs and otakus deserve to have a 100% free,
                beautiful, quality language learning app too！
              </p>
              <p>
                For anyone interested, you can check it out at --&gt;
                <a href="https://kanadojo.com">https://kanadojo.com</a> and let
                me know what you think ^ ^
              </p>
            </div>
          </section>
        </section>
        <section id="45152779">
          <h3>
            <a
              class="item"
              href="https://www.righto.com/2025/09/marilou-schultz-navajo-555-weaving.html"
              >A Navajo weaving of an integrated circuit: the 555 timer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 20:57:27</span
              ><span class="points-container"
                >Points: <span class="points">342</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45152779"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45152066">
          <h3>
            <a
              class="item"
              href="https://dti.domaintools.com/inside-the-kimsuky-leak-how-the-kim-dump-exposed-north-koreas-credential-theft-playbook/"
              >How the “Kim” dump exposed North Korea's credential theft
              playbook</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 19:14:26</span
              ><span class="points-container"
                >Points: <span class="points">383</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45152066"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45136367">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/conference/atc25/presentation/landsberg"
              >IRHash: Efficient Multi-Language Compiler Caching by IR-Level
              Hashing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-05 @ 08:43:01</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45136367"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45132488">
          <h3>
            <a class="item" href="https://www.sqlite.org/fileformat.html"
              >SQLite's File Format</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-04 @ 21:36:03</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45132488"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45131784">
          <h3>
            <a
              class="item"
              href="https://voltrondata.com/blog/the-race-to-build-a-distributed-gpu-runtime"
              >The race to build a distributed GPU runtime</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-04 @ 20:18:47</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45131784"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45131121">
          <h3>
            <a class="item" href="https://steelcake.com/blog/nvme-zig/"
              >Hitting Peak File IO Performance with Zig</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-04 @ 19:15:10</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45131121"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45123328">
          <h3>
            <a
              class="item"
              href="https://www.tokyocowboy.co/articles/purikura-the-grandmother-of-the-selfie"
              >Purikura: The Japanese Grandmother of the Selfie</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-04 @ 03:46:10</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45123328"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45121776">
          <h3>
            <a
              class="item"
              href="https://www.core77.com/posts/138379/The-Best-Way-to-Address-Product-Design-Failure"
              >Way to Address Product Design Failure</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-03 @ 23:59:15</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45121776"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45121010">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/08/27/science/biology-trees-microbiomes.html"
              >Like humans, every tree has its own microbiome, a new study has
              found</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-03 @ 22:21:38</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45121010"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.ph/FqrQ9">https://archive.ph/FqrQ9</a>
            </div>
          </section>
        </section>
        <section id="45120381">
          <h3>
            <a
              class="item"
              href="https://www.goto10retro.com/p/action-was-the-best-8-bit-programming"
              >Action was the best 8-bit programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-03 @ 21:01:05</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45120381"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45119310">
          <h3>
            <a
              class="item"
              href="https://www.swinog.ch/wp-content/uploads/2025/06/Liam-Taylor-David-Lloyd-Exa-A-Technical-Update-on-Submarine-Cables.pdf"
              >A Technical Update on Submarine Cables [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-03 @ 19:01:36</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45119310"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45118286">
          <h3>
            <a
              class="item"
              href="https://www.macrumors.com/2025/09/03/garmin-satellite-smartwatch/"
              >Garmin Beats Apple to Market with Satellite-Connected
              Smartwatch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-03 @ 17:18:09</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45118286"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45116551">
          <h3>
            <a
              class="item"
              href="https://commonreader.wustl.edu/a-queasy-selling-of-the-family-heirlooms/"
              >A queasy selling of the family heirlooms</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-03 @ 14:55:31</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45116551"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
