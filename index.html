<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37652479">
          <h3>
            <a
              class="item"
              href="https://www.epsilontheory.com/the-united-states-of-bed-bath-beyond/"
              >The United States of Bed Bath &amp;amp; Beyond</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 00:01:01</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37652479"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37652456">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/obituaries/2023/09/25/burkey-belser-designer-of-ubiquitous-nutrition-facts-label-dies-at-76/"
              >Burkey Belser, designer of the nutrition facts label, has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 23:58:21</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37652456"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37651962">
          <h3>
            <a
              class="item"
              href="https://kotaku.com/sony-playstation-hack-breach-ransomware-ransomed-vc-1850870993"
              >‘All of Sony Systems’ Allegedly Hacked by New Ransomware Group</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 23:03:11</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37651962"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37651260">
          <h3>
            <a
              class="item"
              href="https://maa.org/press/maa-reviews/is-math-real"
              >Is Math Real?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 21:55:07</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37651260"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37651171">
          <h3>
            <a
              class="item"
              href="https://theaviationgeekclub.com/the-sr-71-blackbird-astro-nav-system-aka-r2-d2-worked-by-tracking-the-stars-and-was-so-powerful-that-it-could-see-the-stars-even-in-daylight/"
              >The SR-71 Blackbird Astro-Nav System worked by tracking the
              stars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 21:47:42</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37651171"
                  >Comments</a
                ><span class="descendants">: 187</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37650533">
          <h3>
            <a class="item" href="https://www.svix.com/careers/"
              >Svix (YC W21) Is Hiring a Technical Lead (US Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 21:00:42</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37650040">
          <h3>
            <a
              class="item"
              href="https://eclecticlight.co/2023/09/25/postscripts-sudden-death-in-sonoma/"
              >PostScript’s sudden death in Sonoma</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 20:20:55</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37650040"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37649841">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/09/pixel-8-leak-promises-7-years-of-os-updates-even-more-than-an-iphone/"
              >Pixel 8 leak promises 7 years of OS updates</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 20:07:43</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37649841"
                  >Comments</a
                ><span class="descendants">: 151</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37649708">
          <h3>
            <a
              class="item"
              href="https://thalein.medium.com/trust-arrives-on-foot-and-leaves-on-horseback-aacde6e69163"
              >Trust arrives on foot and leaves on horseback (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 19:58:17</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37649708"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37649594">
          <h3>
            <a
              class="item"
              href="https://howtomarketagame.com/2023/09/25/john-romero-on-his-book-doom-guy-and-developing-games-at-a-small-scale/"
              >John Romero on his book “Doom Guy” and developing games at a
              small scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 19:50:03</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37649594"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37649448">
          <h3>
            <a class="item" href="https://www.dji.com/mini-4-pro"
              >DJI Mini 4 Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 19:40:54</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37649448"
                  >Comments</a
                ><span class="descendants">: 210</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37649353">
          <h3>
            <a
              class="item"
              href="https://www.thedrive.com/the-war-zone/f-35a-has-flown-from-a-highway-for-the-first-time"
              >F-35A has flown from a highway for the first time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 19:34:11</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37649353"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37648415">
          <h3>
            <a class="item" href="https://github.com/EscherMoore/DitchTheBell"
              >Show HN: DitchTheBell – Linux-based desktop notifier for RSS/Atom
              feeds</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 18:28:13</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37648415"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                I developed this program because I wanted a single, centralized
                location to easily manage my desktop notifications for all of
                the various websites I want to get updates from. Before creating
                this application, I found existing solutions unsatisfactory due
                to the following reasons:
              </p>
              <p>
                - Built-In Notification Services: Some websites offer built-in
                desktop notification services, but these often require an
                account, staying signed in, and running a browser service worker
                continuously on your PC.
              </p>
              <p>
                - RSS Readers: While existing RSS readers with notification
                support provide a simple solution, these project balance
                numerous aspects of reader development. Notifications and their
                configurations are usually not the priority in these projects.
              </p>
              <p>
                - Custom Scripting: Implementing custom scripts using
                general-purpose notification tools like notify-send or
                GObject-Introspection is viable but becomes a maintenance
                headache as more granular control is introduced.
              </p>
              <p>
                These alternatives are sufficient for basic notifications but
                lack the lightweight nature and advanced configurability that
                power users desire. Ditch The Bell fills this gap, offering
                granular control over your RSS feed notifications without the
                limitations of the approaches mentioned above.
              </p>
              <p>
                Check it out!:
                <a href="https://github.com/EscherMoore/DitchTheBell"
                  >https://github.com/EscherMoore/DitchTheBell</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37648098">
          <h3>
            <a class="item" href="https://github.com/byronka/minum"
              >Show HN: Minum – A minimal Java web framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 18:07:24</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37648098"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
            <div class="text">
              <p>
                <a href="http://github.com/byronka/minum"
                  >http://github.com/byronka/minum</a
                >
              </p>
              <p>
                You will be hard-pressed to find another modern project as
                obsessively minimalistic. Other frameworks will claim simplicity
                and minimalism and then, casually, mention they are built on a
                multitude of libraries. This follows self-imposed constraints,
                predicated on a belief that smaller and lighter is long-term
                better.
              </p>
              <p>
                Caveat emptor: This is a project by and for developers who know
                and like programming (rather than, let us say, configuring). It
                is written in Java, and presumes familiarity with the HTTP/HTML
                paradigm.
              </p>
              <p>Driving paradigms of this project:</p>
              <p>
                * ease of use * maintainability / sustainability * simplicity *
                performance * good documentation * good testing
              </p>
              <p>It requires Java 21, for its virtual threads (Project Loom)</p>
            </div>
          </section>
        </section>
        <section id="37648068">
          <h3>
            <a class="item" href="http://farewell.bostonunitygroup.com/"
              >Unity's oldest community announces dissolution</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 18:05:07</span
              ><span class="points-container"
                >Points: <span class="points">432</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37648068"
                  >Comments</a
                ><span class="descendants">: 284</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37646964">
          <h3>
            <a class="item" href="https://www.fieggen.com/shoelace/"
              >Ian's Shoelace Site</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 16:55:54</span
              ><span class="points-container"
                >Points: <span class="points">403</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37646964"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37645945">
          <h3>
            <a
              class="item"
              href="http://sainthelenaisland.info/communications.htm"
              >Saint Helena Island Communications</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 15:55:44</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37645945"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37644952">
          <h3>
            <a
              class="item"
              href="https://forum.kerbalspaceprogram.com/topic/219607-ksp2-is-spamming-the-windows-registry-over-weeksmonths-until-the-game-will-stop-working-permanently/"
              >KSP2 is spamming the Windows Registry until the game stops
              working</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 15:00:33</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37644952"
                  >Comments</a
                ><span class="descendants">: 240</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37642671">
          <h3>
            <a
              class="item"
              href="https://github.com/davidhampgonsalves/life-dashboard"
              >Show HN: E-Ink Day Schedule</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 12:31:07</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37642671"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37642610">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Rhythm_0"
              >Rhythm 0</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 12:26:24</span
              ><span class="points-container"
                >Points: <span class="points">342</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37642610"
                  >Comments</a
                ><span class="descendants">: 241</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37642335">
          <h3>
            <a
              class="item"
              href="https://openai.com/blog/chatgpt-can-now-see-hear-and-speak"
              >We are beginning to roll out new voice and image capabilities in
              ChatGPT</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 11:57:28</span
              ><span class="points-container"
                >Points: <span class="points">1040</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37642335"
                  >Comments</a
                ><span class="descendants">: 803</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37642076">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37642076"
              >Ask HN: Android low latency audio in 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 11:24:16</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37642076"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                On March 11th of the first link, the author talks about using a
                MIDI device to be able to focus mainly on the output latency
                only, does that mean using another input device other than the
                screen can generally get Android output latency down to 20ms or
                lower!?
              </p>
              <p>Any clarification gratefully received.</p>
              <p>
                <a href="https://news.ycombinator.com/item?id=26388441"
                  >https://news.ycombinator.com/item?id=26388441</a
                >
              </p>
              <p>
                <a href="https://news.ycombinator.com/item?id=18199290"
                  >https://news.ycombinator.com/item?id=18199290</a
                >
              </p>
              <p>
                <a
                  href="https://chromium.googlesource.com/external/github.com/google/oboe/+/refs/heads/devicelist/docs/Devices.md"
                  >https://chromium.googlesource.com/external/github.com/google...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37641590">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/blog/products/infrastructure/introducing-the-nuvem-subsea-cable/"
              >Nuvem, a subsea cable to connect Portugal, Bermuda, and the
              U.S.</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 10:21:12</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37641590"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37641416">
          <h3>
            <a
              class="item"
              href="https://hothardware.com/reviews/intel-meteor-lake-architecture"
              >Intel Meteor Lake Architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 09:49:15</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37641416"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37640643">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2023/09/23/intels-ponte-vecchio-chiplets-gone-crazy/"
              >Intel’s Ponte Vecchio: Chiplets Gone Crazy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 07:39:03</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37640643"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37639267">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/09/17/opinion/sports-zen-mental-subtraction.html"
              >When I stopped trying to self-optimize, I got better</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 03:04:38</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37639267"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37638328">
          <h3>
            <a
              class="item"
              href="https://blog.britishnewspaperarchive.co.uk/2023/09/21/understanding-the-open-air-schools-of-the-1900s/"
              >Open Air Schools of the 1900s</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 00:02:15</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37638328"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37630589">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/culture/2023/09/21/tiktok-is-changing-the-way-books-are-recommended-and-sold"
              >TikTok is changing the way books are recommended and sold</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-24 @ 06:18:45</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37630589"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37630543">
          <h3>
            <a
              class="item"
              href="https://iai.tv/articles/time-doesnt-belong-to-physics-jimena-canales-auid-2607"
              >Time Doesn’t Belong to Physics – When Bergson met Einstein</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-24 @ 06:07:38</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37630543"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37622512">
          <h3>
            <a class="item" href="https://csurgay.com/syggen/"
              >Show HN: Online oscilloscope with waveform generators</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-23 @ 12:03:52</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37622512"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
