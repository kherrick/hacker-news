<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41799016">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/41dd7994-3b1f-4562-a59f-11879b5e3f68"
              >Portugal seeks to become low-tax haven for young people</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 14:10:10</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41799016"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41799011">
          <h3>
            <a
              class="item"
              href="https://asahilinux.org/2024/10/aaa-gaming-on-asahi-linux/"
              >AAA Gaming on Asahi Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 14:09:34</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41799011"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41798615">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/10/thunderbird-android-client-is-k-9-mail-reborn-and-its-in-solid-beta/"
              >Thunderbird Android client is K-9 Mail reborn, and it's in solid
              beta</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 13:31:31</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41798615"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41798477">
          <h3>
            <a class="item" href="https://tenno.app"
              >Show HN: Tenno – Markdown and JavaScript = an Hybrid of Word and
              Excel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 13:15:38</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41798477"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <p>
                This is still an early version but I wanted to get some feedback
                from HN on what could be nice features to add.
              </p>
              <p>
                Check out the Docs and examples page, it has a ton of (in my
                humble opinion) cool stuff!
              </p>
              <p>
                Why did I build this? I was building some estimation for cloud
                costs in Google Sheets and I quickly ended up with a mess. I
                realized that if I wanted to analyze how a certain thing changes
                wrt to multiple variables by plotting it, I had to create a
                bunch of copies of data and copy my formulas everywhere... a SWE
                nightmare!
              </p>
              <p>
                Tenno simplifies this because you can essentially define a
                function you are interested in, and only the analyzing it using
                plots that explore various dimensions.
              </p>
              <p>
                BTW, you can also use Tenno to build dashboards by pulling data
                from APIs, checkout the weather data example.
              </p>
            </div>
          </section>
        </section>
        <section id="41798259">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/us-news/2024/sep/15/fossils-los-angeles-high-school"
              >'Entire ecosystem' of fossils 8.7M years old found under Los
              Angeles high school</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 12:46:18</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41798259"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41798027">
          <h3>
            <a
              class="item"
              href="https://quoteinvestigator.com/2019/04/23/bank/"
              >Owe Your Banker £1k You Are at His Mercy; Owe Him £1M the
              Position Is Reversed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 12:08:36</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41798027"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41797719">
          <h3>
            <a
              class="item"
              href="https://weirdgloop.org/blog/why-were-helping-more-wikis-move-away-from-fandom"
              >Why we're helping more wikis move away from Fandom</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 11:21:53</span
              ><span class="points-container"
                >Points: <span class="points">254</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41797719"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41797462">
          <h3>
            <a
              class="item"
              href="https://theorangeduck.com/page/animation-quality"
              >Let's talk about Animation Quality</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 10:38:23</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41797462"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41797041">
          <h3>
            <a
              class="item"
              href="https://nixiesearch.substack.com/p/nixiesearch-running-lucene-over-s3"
              >Nixiesearch: Running Lucene over S3, and why we're building a new
              search engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 09:11:26</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41797041"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41797009">
          <h3>
            <a
              class="item"
              href="https://rethinkingsoftware.substack.com/p/scrums-product-owner-problem"
              >Scrum's “Product Owner” Problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 09:06:32</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41797009"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41795919">
          <h3>
            <a
              class="item"
              href="https://www.os2museum.com/wp/os-2-tcpbeui-name-resolution/"
              >OS/2 TCPBEUI Name Resolution</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 05:46:43</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41795919"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41795561">
          <h3>
            <a
              class="item"
              href="https://roborooter.com/post/wasm-is-the-new-cgi/"
              >WASM Is the New CGI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 04:38:58</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41795561"
                  >Comments</a
                ><span class="descendants">: 211</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41795218">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Ratan_Tata"
              >Indian entrepreneur, industrialist, and philanthropist, Ratan
              Tata, dead at 86</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 03:29:17</span
              ><span class="points-container"
                >Points: <span class="points">266</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41795218"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41794735">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/wafer-scale-trilogy-systems-part"
              >Wafer Scale and Trilogy Systems: Part 1</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 01:53:02</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41794735"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41794577">
          <h3>
            <a class="item" href="https://github.com/Fredolx/open-tv"
              >Open-TV: Ultra-fast, simple and powerful cross-platform IPTV
              app</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-10 @ 01:14:40</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41794577"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41793597">
          <h3>
            <a
              class="item"
              href="https://beeps.website/blog/2024-10-09-why-govuk-exit-this-page-doesnt-use-escape/"
              >Why Gov.uk's Exit this Page component doesn't use the Escape
              key</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-09 @ 22:45:26</span
              ><span class="points-container"
                >Points: <span class="points">326</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41793597"
                  >Comments</a
                ><span class="descendants">: 174</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41792500">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/10/9/24266419/internet-archive-ddos-attack-pop-up-message"
              >Internet Archive: Security breach alert</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-09 @ 20:54:26</span
              ><span class="points-container"
                >Points: <span class="points">915</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41792500"
                  >Comments</a
                ><span class="descendants">: 513</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41790619">
          <h3>
            <a class="item" href="https://github.com/andrearaponi/dito"
              >Dito – an advanced Layer 7 reverse proxy server written in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-09 @ 17:44:31</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41790619"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41790295">
          <h3>
            <a class="item" href="https://www.dookiedemastered.com/"
              >Dookie Demastered</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-09 @ 17:18:19</span
              ><span class="points-container"
                >Points: <span class="points">702</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41790295"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41789242">
          <h3>
            <a
              class="item"
              href="https://www.arnaldur.be/writing/about/an-n-ball-between-n-balls"
              >An n-ball Between n-balls</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-09 @ 15:50:00</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41789242"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41789176">
          <h3>
            <a class="item" href="https://finetunedb.com"
              >Show HN: FinetuneDB – AI fine-tuning platform to create custom
              LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-09 @ 15:44:53</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41789176"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
            <div class="text">
              <a href="https://finetunedb.com/">https://finetunedb.com/</a>), an
              LLM fine-tuning platform. It enables teams to easily create and
              manage high-quality datasets, and streamlines the entire workflow
              from fine-tuning to serving and evaluating models with domain
              experts. You can check out our docs here: (<a
                href="https://docs.finetunedb.com/"
                >https://docs.finetunedb.com/</a
              >)
              <p>
                FinetuneDB exists because creating and managing high-quality
                datasets is a real bottleneck when fine-tuning LLMs. The quality
                of your data directly impacts the performance of your fine-tuned
                models, and existing tools didn’t offer an easy way for teams to
                build, organize, and iterate on their datasets. We’ve been
                working closely with our pilot customers, both AI startups and
                more traditional businesses like a large newspaper, which is
                fine-tuning models on their articles to automate content
                generation in their tone of voice.
              </p>
              <p>
                The platform is built with an end-to-end workflow in mind, from
                dataset building, fine-tuning, serving, and evaluating outputs.
                The centerpiece is a version-controlled, no-code dataset manager
                where you can upload existing datasets in JSONL, use production
                data, or collaborate with domain experts to create high-quality
                datasets for custom use cases. We also offer evaluation
                workflows that allow non-technical contributors to annotate
                data, review model outputs, and refine responses (LLM-as-judge
                also available).
              </p>
              <p>We offer:</p>
              <p>
                - A free tier for developers and hobbyists who want to
                streamline dataset management.
              </p>
              <p>
                - Business-tier with full feature access for teams, using
                per-seat pricing.
              </p>
              <p>
                - A custom tier for model hosting, custom integrations, and
                self-hosting.
              </p>
              <p>
                Most users still use OpenAI models, but if you're working with
                open-source LLMs, we offer pay-as-you-go pricing for serverless
                inference for Llama and Mistral models with up to €100 in free
                credits to get started.
              </p>
              <p>
                We're in public beta right now, so any feedback—whether it’s
                about features, usability, or anything else—would be incredibly
                valuable.
              </p>
              <p>
                If you've worked on fine-tuning models before or are curious
                about custom LLMs, we’d love to hear from you. Our goal is to
                make the fine-tuning process more accessible and help more
                companies leverage their data and domain experts to create
                custom LLMs.
              </p>
              <p>Thanks for checking it out!</p>
            </div>
          </section>
        </section>
        <section id="41787798">
          <h3>
            <a
              class="item"
              href="https://resobscura.substack.com/p/on-17th-century-cocaine"
              >On 17th century "cocaine"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-09 @ 13:33:01</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41787798"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41769275">
          <h3>
            <a
              class="item"
              href="https://xnacly.me/posts/2024/fun-with-iterators/"
              >Fun with Go Iterators</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 18:27:49</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41769275"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765594">
          <h3>
            <a
              class="item"
              href="https://hardcoresoftware.learningbyshipping.com/p/222-automating-processes-with-software"
              >Automating Processes with Software Is Hard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 13:02:59</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765594"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765127">
          <h3>
            <a class="item" href="https://luckymike.dev/posts/warm-handoffs/"
              >Warm Handoffs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 11:59:11</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765127"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765006">
          <h3>
            <a
              class="item"
              href="https://www.foodandwine.com/california-bans-sell-by-dates-8723111"
              >California Bans Sell-By Dates</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 11:39:03</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765006"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41764163">
          <h3>
            <a class="item" href="https://zod.dev/"
              >Zod: TypeScript-first schema validation with static type
              inference</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 09:18:59</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41764163"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41762483">
          <h3>
            <a
              class="item"
              href="https://github.com/google/mozc-devices/tree/master/mozc-doublesided"
              >Gboard Double Sided Version</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 03:23:56</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41762483"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41757701">
          <h3>
            <a class="item" href="https://blog.regehr.org/archives/1307"
              >The Strict Aliasing Situation Is Pretty Bad (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-06 @ 15:16:41</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41757701"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41753626">
          <h3>
            <a class="item" href="https://scottaaronson.blog/?p=8375"
              >Quantum Advantage for NP Approximation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 23:27:23</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41753626"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
