<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42011193">
          <h3>
            <a class="item" href="https://www.waituntil8th.org"
              >Wait Until 8th</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 20:32:03</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42011193"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42010712">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/10/31/openai-ceo-sam-altman-says-lack-of-compute-is-delaying-the-companys-products/"
              >Sam Altman says lack of compute is delaying the company's
              products</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 19:43:52</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42010712"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42010653">
          <h3>
            <a
              class="item"
              href="https://research.ibm.com/blog/euv-center-albany-nstc"
              >The United States' NSTC EUV Accelerator Is Coming to Albany</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 19:37:54</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42010653"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42010130">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/tech/article/ghost-jobs-california-tech-industry-19871249.php"
              >Ghost jobs are wreaking havoc on tech workers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 18:49:14</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42010130"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42009290">
          <h3>
            <a
              class="item"
              href="https://www.qodo.ai/blog/announcing-support-for-claude-sonnet-3-5-openai-o1-and-gemini-1-5-pro/"
              >Support for Claude Sonnet 3.5, OpenAI O1 and Gemini 1.5 Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 17:41:13</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42009290"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42009196">
          <h3>
            <a
              class="item"
              href="https://www.sagelyhealth.com/blog-posts/cancers-magic-bullet-antibody-drug-conjugates"
              >Antibody Drug Conjugates: A frontier in cancer treatment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 17:35:11</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42009196"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42009089">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42009089"
              >Launch HN: Patched (YC S24) – AI workflows for post-code tasks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 17:27:41</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42009089"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <a href="https://patched.codes">https://patched.codes</a>). We
              help dev teams accelerate tasks like code reviews, docs, and
              patches through customizable, self-hostable workflows. Here’s a
              quick video walkthrough:
              <a href="https://youtu.be/5hvWGB5avVo"
                >https://youtu.be/5hvWGB5avVo</a
              >
              <p>
                There is a lot of excitement around code generation and the
                development inner loop. But having built DevSecOps startups
                previously, we know how the bottlenecks developers face often
                occur in the “outer loop”, especially after the code is written.
                With Patched, we want to help code get shipped as fast as it is
                generated.
              </p>
              <p>
                Patched has two core components. First is the workflow builder
                that switches seamlessly between no-code and full-code. Second
                is the chat-based query interface for your code, logs, and issue
                tracker. When used together, they can help orchestrate and
                automate the most painful parts of the software development
                lifecycle.
              </p>
              <p>
                Here is an example PR created by a patchflow that automates SDK
                generation with complex type information:
                <a href="https://github.com/stack-auth/stack/pull/300"
                  >https://github.com/stack-auth/stack/pull/300</a
                >.
              </p>
              <p>
                Under the hood, Patched is powered by our patchwork library (<a
                  href="https://github.com/patched-codes/patchwork"
                  >https://github.com/patched-codes/patchwork</a
                >) and an LLM optimization proxy(<a
                  href="https://github.com/codelion/optillm"
                  >https://github.com/codelion/optillm</a
                >) - both of which we have open-sourced. You can run these
                workflows within your CI/CD pipeline, or from the command line,
                completely independent of our platform. This gives you full
                control without being locked in, while allowing us to build a
                monetizable product around it.
              </p>
              <p>
                While there are some great point solutions for tackling
                individual tasks, we believe the real solution lies in an open,
                holistic approach—one that teams can tweak, extend, or
                self-host.
              </p>
              <p>
                You can try Patched at
                <a href="https://app.patched.codes/signin"
                  >https://app.patched.codes/signin</a
                >
                - we’d love to hear your feedback on our approach and the user
                experience.
              </p>
            </div>
          </section>
        </section>
        <section id="42008772">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/defragmenter/archive/decoupling-design-from-engineering/"
              >Decoupling design from engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 17:01:46</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42008772"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42008768">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/activeloop/jobs/kCU6ZNq-python-backend-engineer"
              >Activeloop (YC S18) seeks Python back end engineers to build a
              database for AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 17:01:30</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42008569">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/introducing-chatgpt-search/"
              >ChatGPT Search</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 16:41:22</span
              ><span class="points-container"
                >Points: <span class="points">561</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42008569"
                  >Comments</a
                ><span class="descendants">: 464</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42007649">
          <h3>
            <a class="item" href="https://claude.ai/download"
              >Claude for Desktop</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 15:04:27</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42007649"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42006698">
          <h3>
            <a
              class="item"
              href="https://blog.trailofbits.com/2024/10/31/fuzzing-between-the-lines-in-popular-barcode-software/"
              >Fuzzing between the lines in popular barcode software</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 13:28:31</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42006698"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42004976">
          <h3>
            <a
              class="item"
              href="https://entropicthoughts.com/probability-generating-functions"
              >Probability-generating functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 09:36:18</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42004976"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42004133">
          <h3>
            <a class="item" href="https://hazel.org/"
              >Hazel: A live functional programming environment featuring typed
              holes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 06:57:35</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42004133"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42002757">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2024/oct/25/legal-bid-for-ecuador-forest-to-be-recognised-as-song-co-creator"
              >Legal bid for Ecuador forest to be recognised as song
              co-creator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 02:12:23</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42002757"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41999923">
          <h3>
            <a
              class="item"
              href="https://sophiebits.com/2024/10/30/everyone-is-wrong-about-that-slack-flowchart"
              >Everyone is wrong about that Slack flowchart</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-30 @ 20:32:58</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41999923"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41999852">
          <h3>
            <a class="item" href="https://www.nandgame.com"
              >NandGame – Build a computer from scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-30 @ 20:27:12</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41999852"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41999840">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/10.1145/3662010.3663452"
              >Nulls: Revisiting null representation in modern columnar
              formats</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-30 @ 20:26:02</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41999840"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41998838">
          <h3>
            <a
              class="item"
              href="https://kaleidawave.github.io/posts/sets-types-and-type-checking/"
              >Sets, types and type checking</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-30 @ 18:53:50</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41998838"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41996608">
          <h3>
            <a
              class="item"
              href="https://surfingcomplexity.blog/2024/10/29/the-carefulness-knob/"
              >The carefulness knob</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-30 @ 15:58:39</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41996608"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41995615">
          <h3>
            <a
              class="item"
              href="https://john.onolan.org/democratising-publishing/"
              >Democratising publishing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-30 @ 14:52:55</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41995615"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41989134">
          <h3>
            <a
              class="item"
              href="https://www.tandfonline.com/doi/full/10.1080/00029890.2024.2370240"
              >Five or ten new proofs of the Pythagorean Theorem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-29 @ 20:40:41</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41989134"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41987349">
          <h3>
            <a
              class="item"
              href="https://xeiaso.net/blog/2024/stealth-mountain-returns/"
              >The Return of Stealth Mountain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-29 @ 17:46:55</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41987349"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41975746">
          <h3>
            <a
              class="item"
              href="https://andrewpwheeler.com/2024/10/28/suits-money-laundering-and-linear-programming/"
              >Suits, money laundering, and linear programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-28 @ 20:19:01</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41975746"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41974168">
          <h3>
            <a class="item" href="https://paper.wf/binarycat/rtp"
              >RTP: One protocol to rule them all?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-28 @ 18:06:31</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41974168"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41973116">
          <h3>
            <a class="item" href="https://github.com/eshaz/wasm-audio-decoders"
              >Web Assembly audio decoders highly optimized for size and
              performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-28 @ 16:37:13</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41973116"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41968024">
          <h3>
            <a
              class="item"
              href="https://zverok.space/blog/2024-10-21-global_functions.html"
              >There is no such thing as a global method in Ruby</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-28 @ 05:11:09</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41968024"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41963667">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/sport/athletics/articles/cn8y4mky8v9o"
              >A day and night running round a track</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-27 @ 16:20:43</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41963667"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41960003">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41960003"
              >Tell HN: Robots.txt pitfalls – what I learned the hard way</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-27 @ 05:09:23</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41960003"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                A few days ago, while reading about SEO, I came across the
                concept of a "crawl budget." Apparently, Google allocates a
                specific crawl budget to your indexed site, and the more useless
                content it has to index and store on its servers, the more it
                affects your site—resulting in delays for new content indexing,
                favicon updates, and robots.txt crawling.
              </p>
              <p>
                Being a minimalist and utilitarian, I decided to prevent
                indexing of the `/uploads/` directory on my site since it mostly
                contained images used in my articles. I thought blocking this
                "useless content" would free up more crawling budget for my
                primary content, i.e., articles. So, I added this directory to
                my site's robots.txt:
              </p>
              <p></p>
              <pre><code>  # Group 1
  User-agent: *
  Disallow: /public/
  Disallow: /drafts/
  Disallow: /theme/
  Disallow: /page*
  Disallow: /uploads/

  Sitemap: https://prahladyeri.github.io/sitemap.xml

</code></pre>
              The way search engines work means there's typically a 5-7 day gap
              between updating the robots.txt file and crawlers processing it.
              After about a week, I noticed that my site's favicon disappeared
              from SERPs on mobile browsers! Instead, there was a bland (empty)
              icon in its place. That’s when I realized that my favicons also
              resided in the `/uploads/` directory. After I recently optimized
              the favicon format by switching from WEBP to PNG, Google was
              unable to crawl and index the new favicon at all!
              <p>
                Once I realized this mistake, I removed the blocking of
                `/uploads/` from the robots.txt and requested a recrawl. But who
                knows how long it will take for Google's systems to sync this
                change and start showing the site's favicon back in SERPs! Two
                lessons learned:
              </p>
              <p>
                1. The robots.txt file is highly sensitive; avoid modifying it
                if possible. 2. Applying SEO is like steering an extremely large
                ship or vessel. You pull a lever now, and the ship only moves
                after several days!
              </p>
            </div>
          </section>
        </section>
        <section id="41959897">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/immortal-lichen-growing-in-cemeteries"
              >Lichens in cemetaries and a scientist who studies them</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-27 @ 04:38:36</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41959897"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
