<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36144674">
          <h3>
            <a class="item" href="https://github.com/OAI/moonwalk"
              >OpenAPI v4 (aka Moonwalk) Proposal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 21:38:04</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36144674"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36144450">
          <h3>
            <a class="item" href="https://github.com/lancedb/lance"
              >Show HN: Lance – Alternative to Parquet for ML data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 21:16:58</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36144450"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36144241">
          <h3>
            <a
              class="item"
              href="https://technomancers.ai/japan-goes-all-in-copyright-doesnt-apply-to-ai-training/"
              >Japan Goes All In: Copyright Doesn’t Apply to AI Training</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 20:58:13</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36144241"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36144211">
          <h3>
            <a class="item" href="https://codeberg.org/teddit/teddit"
              >Teddit – An alternative Reddit front-end focused on privacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 20:55:26</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36144211"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36144033">
          <h3>
            <a
              class="item"
              href="https://www.instructables.com/DIY-Pure-Sine-Wave-Inverter/"
              >1000W 12V –&amp;gt; 220V Inverter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 20:40:13</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36144033"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36142763">
          <h3>
            <a class="item" href="https://hamel.dev/blog/posts/nbdev/"
              >I decided not to commercialize nbdev</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 19:19:16</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36142763"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36141544">
          <h3>
            <a class="item" href="https://humanloop.com/blog/open_ai_talk"
              >OpenAI's plans according to sama</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 18:05:03</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36141544"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36141170">
          <h3>
            <a class="item" href="https://pgp.governikus.de/?lang=EN"
              >You can link an OpenPGP key to a German eID</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:40:44</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36141170"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36141083">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/apolloapp/comments/13ws4w3/had_a_call_with_reddit_to_discuss_pricing_bad/"
              >Had a call with Reddit to discuss pricing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:30:39</span
              ><span class="points-container"
                >Points: <span class="points">858</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36141083"
                  >Comments</a
                ><span class="descendants">: 644</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36140916">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36140916"
              >Launch HN: Onu (YC W23) – Turn scripts into internal tools in
              minutes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:19:40</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140916"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
            <div class="text">
              <a href="https://joinonu.com">https://joinonu.com</a>). Onu lets
              you write scripts and turn them into internal tools suitable for
              use by non-technical teammates. We built Onu to help you spend
              more time coding and less time running scripts for ops or customer
              support. Unlike no-code/low-code products, we’re code-first and
              let you use your preferred tools. We take care of the annoying
              parts for you: most importantly the frontend, but also auditing,
              permissions, and 3rd party integrations (e.g. Slack, email, Jira,
              Pagerduty).
              <p>
                We’ve put up a few sample screenshots at
                <a href="https://joinonu.com/examples"
                  >https://joinonu.com/examples</a
                >, and a demo video here:
                <a href="https://www.youtube.com/watch?v=4XMnBRsktsw"
                  >https://www.youtube.com/watch?v=4XMnBRsktsw</a
                >.
              </p>
              <p>
                Many engineers lose hours a week fielding requests from other
                teams. While most companies have a home-grown internal dashboard
                (or are using a third party tool builder for this such as
                Retool), there is still a long tail of scripts that engineers
                have to run regularly for their ops and CX teammates, either
                locally or by SSHing into prod. Maybe a user’s account got stuck
                in a weird state, or you have a script to manually onboard new
                customers to your B2B product, or you have to run a custom
                provisioning script each time you add a bike to your e-bike
                fleet (something we experienced at Lyft).
              </p>
              <p>
                We experienced these problems while working on engineering teams
                at Lyft and Stripe. Our teams needed internal tooling, but we
                didn’t have time to build feature-rich dashboards. Stripe had a
                homegrown tool that allowed engineers to quickly spin up simple
                internal tools without writing any frontend code. When we
                started working on Onu with a different idea we immediately felt
                the pain of not having a similar tool. We pivoted to working on
                our current product instead because we already knew how powerful
                it can be for speeding up engineering teams.
              </p>
              <p>
                Internal tool builders mostly take a no code/low code approach
                that requires engineers to duplicate a lot of business logic in
                the browser. This leads to brittle internal apps that are hard
                to keep in sync with the business logic in your codebase, and
                difficult to maintain as you scale. In addition, such tools
                subject you to point-and-click / drag-and-drop workflows that
                just aren’t the sweet spot for programmers. We don’t like
                working that way ourselves, so we focus on a code-first
                approach, allowing you to hand scripts to non-technical
                teammates to own and run without engineering oversight.
              </p>
              <p>
                Onu works with your existing dev workflow. You write scripts in
                your editor of choice—not the browser—and deploy tasks the same
                way you deploy any other code. We can host your scripts if you
                prefer, but you can also add Onu to your existing Express server
                and our frontend will handle routing requests to the correct
                script. We currently have a Node SDK and are rolling out Python
                next.
              </p>
              <p>
                You can try Onu now by heading to
                <a href="https://auth.joinonu.com/signup"
                  >https://auth.joinonu.com/signup</a
                >
                and signing up for an account. It’s free for personal use cases
                and for teams of up to 5 people.
              </p>
              <p>We’re looking forward to your thoughts and feedback!</p>
            </div>
          </section>
        </section>
        <section id="36140861">
          <h3>
            <a
              class="item"
              href="https://openai.com/research/improving-mathematical-reasoning-with-process-supervision"
              >Improving mathematical reasoning with process supervision</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:15:59</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140861"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36140639">
          <h3>
            <a
              class="item"
              href="https://provision-software.notion.site/Provision-is-Hiring-8b53cc10bbd04af39bf3d3c7ab181cac"
              >Provision (YC S22) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:00:04</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36140177">
          <h3>
            <a
              class="item"
              href="https://linuxfoundation.eu/newsroom/rise-project-launches-to-accelerate-development-of-risc-v"
              >RISE: Accelerate the development of open source software for
              RISC-V</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 16:22:48</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140177"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36139852">
          <h3>
            <a
              class="item"
              href="https://aisnakeoil.substack.com/p/is-avoiding-extinction-from-ai-really"
              >The greatest risk of AI is from the people who control it, not
              the tech itself</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 15:58:38</span
              ><span class="points-container"
                >Points: <span class="points">493</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36139852"
                  >Comments</a
                ><span class="descendants">: 365</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36139729">
          <h3>
            <a class="item" href="https://www.theprompt.io/p/ai-camera-no-lens"
              >AI camera with no lens</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 15:49:22</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36139729"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36139349">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-01780-w"
              >AI intensifies fight against ‘paper mills’ that churn out fake
              research</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 15:18:04</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36139349"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36138642">
          <h3>
            <a
              class="item"
              href="https://neon.tech/blog/when-limit-9-works-but-limit-10-hangs"
              >When LIMIT 9 works but LIMIT 10 hangs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 14:11:49</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36138642"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36138304">
          <h3>
            <a class="item" href="https://cs.uwaterloo.ca/~csk/slide/"
              >Slide to Unlock</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 13:41:55</span
              ><span class="points-container"
                >Points: <span class="points">560</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36138304"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36137897">
          <h3>
            <a
              class="item"
              href="https://www.ai21.com/blog/human-or-not-results"
              >AI21 Labs concludes largest Turing Test experiment to date</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 13:05:03</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36137897"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36137530">
          <h3>
            <a
              class="item"
              href="https://www.colorado.edu/today/2023/05/24/these-tiny-medical-robots-could-one-day-travel-through-your-body"
              >A new class of tiny, self-propelled robots that can zip through
              liquid at speed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 12:28:32</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36137530"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36136819">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20230531105653/https://rarbg.to/index80.php"
              >Rarbg Is No More</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 10:56:14</span
              ><span class="points-container"
                >Points: <span class="points">992</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36136819"
                  >Comments</a
                ><span class="descendants">: 510</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36136179">
          <h3>
            <a
              class="item"
              href="https://www.reproof.app/blog/notes-apps-help-us-forget"
              >Notes apps are where ideas go to die (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 09:11:37</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36136179"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36135955">
          <h3>
            <a class="item" href="https://zealdocs.org/"
              >Zeal is an offline documentation browser for software
              developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 08:38:49</span
              ><span class="points-container"
                >Points: <span class="points">295</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36135955"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36135844">
          <h3>
            <a
              class="item"
              href="https://spritely.institute/news/scheme-to-wasm-lambdas-recursion.html"
              >Directly compiling Scheme to WebAssembly: lambdas, recursion,
              iteration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 08:20:24</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36135844"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36135683">
          <h3>
            <a class="item" href="https://micro.mu/"
              >Show HN: Micro Chat – Private group chat</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 07:55:55</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36135683"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm Asim. I'm an engineer who's been hacking on an open source
                project called Micro for the past eight years (<a
                  href="https://micro.dev"
                  >https://micro.dev</a
                >). In that time I've done a lot of things, all Dev related but
                ultimately most of my career was spent working on platforms for
                consumer products. After many attempts I've decided the path
                forward is to focus on building something that solves my own
                problem. Micro Chat is a solution to some of the social media
                problems I've been having.
              </p>
              <p>
                What I've been looking for most of my life is a community. A
                place to belong. I scoured the internet for that with strangers.
                But I think that's wrong. The public forums are also the wrong
                place to find that connection. What we need to do is focus on
                smaller communities starting with real connections. We need to
                strip away a lot of the addictive behaviours and issues created
                by social media. I think things like hackernews are great
                because it's very simple text based, with no notification and
                centers around conversations about topics of interest. I think
                that's how group chat should also be. The difference here is, I
                want a place to build small private communities e.g micro
                communities. Most real groups lose their value beyond a certain
                size. For me that's around 20 people. As an introvert I really
                care about strong connections with a handful of people.
                Unfortunately those real world connections are now spread
                globally as people moved away and while we have private slacks
                or WhatsApp grojps to stay in touch it just feels like the wrong
                setup for that. If anything I want to consolidate it into one
                place.
              </p>
              <p>
                Anyway I'm sharing this now to get some feedback. I think the
                tech and the product will evolve but only by finding out if
                others feel the same.
              </p>
              <p><a href="https://micro.mu">https://micro.mu</a></p>
            </div>
          </section>
        </section>
        <section id="36134423">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2018/11/03/obituaries/hardy-fox-dead.html"
              >Hardy Fox, of the avant-garde band The Residents (maybe)
              (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 04:21:55</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36134423"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36133917">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/05/29/world/asia/van-gogh-china-buyer.html"
              >The Mystery of the Disappearing van Gogh</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 02:47:29</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36133917"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36131210">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=6yrYWjjuIOs"
              >Rde: A configuration framework for GNU Guix [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 21:35:45</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36131210"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36128617">
          <h3>
            <a class="item" href="https://kuenzi.dev/toothbrush/"
              >Hacking my “smart” toothbrush</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 18:30:31</span
              ><span class="points-container"
                >Points: <span class="points">664</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36128617"
                  >Comments</a
                ><span class="descendants">: 261</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36121556">
          <h3>
            <a
              class="item"
              href="https://www.firstthings.com/article/2023/06/kafkas-trials"
              >The Diaries of Franz Kafka</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 05:57:27</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36121556"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
