<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42468318">
          <h3>
            <a class="item" href="https://htmhell.dev/adventcalendar/2024/20/"
              >My favourite colour is Chuck Norris red</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 04:35:49</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42468318"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42468214">
          <h3>
            <a class="item" href="https://distill.pub/2021/gnn-intro/"
              >A Gentle Introduction to Graph Neural Networks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 04:10:42</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42468214"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42467449">
          <h3>
            <a class="item" href="https://gribstream.com"
              >Show HN: Gribstream.com â€“ Historical Weather Forecast API</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 01:27:42</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42467449"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <a href="https://gribstream.com">https://gribstream.com</a>
              <p>
                It is an API to extract weather forecasting data from the
                National Blend of Models (NBM)
                <a href="https://vlab.noaa.gov/web/mdl/nbm"
                  >https://vlab.noaa.gov/web/mdl/nbm</a
                >
                and the Global Forecast System (GFS)
                <a
                  href="https://www.ncei.noaa.gov/products/weather-climate-models/global-forecast"
                  >https://www.ncei.noaa.gov/products/weather-climate-models/gl...</a
                >
                . The data is freely available from AWS S3 in grib2 format which
                can be great but also really hard (and resource intensive) to
                work with, especially if you want to extract timeseries over
                long periods of time based on a few coordinates. Being able to
                query and extract only what you want out of terabytes of data in
                just an http request is really nice.
              </p>
              <p>
                What is cool about this dataset is that it has hourly data with
                full forecast history so you can use the dataset to train and
                forecast other parameters and have proper backtesting because
                you can see the weather "as of" points in time in the past. It
                has a free tier so you can play with it. There is a long list of
                upcoming features I intend to implement and I would very much
                appreciate both feedback on what is currently available and on
                what features you would be most interested in seeing. Like...
                I'm not sure if it would be better to support a few other
                datasets or focus on supporting aggregations.
              </p>
              <p>Features include:</p>
              <p>
                - A free tier to help you get started - Full history of weather
                forecasts - Extract timeseries for thousands of coordinates, for
                months at a time, at hourly resolution in a single http request
                taking only seconds. - Supports as-of/time-travel, indispensable
                for proper backtesting of derivative models - Automatic gap
                filling of any missing data with the next best (most recent)
                forecast.
              </p>
              <p>Please try it out and let me know what you think :)</p>
            </div>
          </section>
        </section>
        <section id="42467194">
          <h3>
            <a
              class="item"
              href="https://www.home-assistant.io/blog/2024/12/19/voice-preview-edition-the-era-of-open-voice/"
              >The era of open voice assistants</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 00:29:57</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42467194"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42466676">
          <h3>
            <a
              class="item"
              href="https://win-vector.com/2024/12/19/kelly-cant-fail/"
              >Kelly Can't Fail</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 23:07:15</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42466676"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42465661">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/openlayer/jobs/yIE9WI3-customer-engineer"
              >Openlayer (YC S21) is looking for a customer engineer to join our
              rocketship</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 21:00:59</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42465535">
          <h3>
            <a
              class="item"
              href="https://research.google/blog/satellite-powered-estimation-of-global-solar-potential/"
              >Satellite powered estimation of global solar potential</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 20:44:46</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42465535"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42465378">
          <h3>
            <a
              class="item"
              href="https://github.com/kooscode/srgh-matrix-trinity/blob/main/README.md"
              >Hardware Security Exploit Research â€“ Xbox 360</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 20:26:33</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42465378"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42465109">
          <h3>
            <a class="item" href="http://weavesilk.com/"
              >Silk â€“ Interactive Generative Art (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 19:55:48</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42465109"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42464557">
          <h3>
            <a
              class="item"
              href="https://roelsworld.eu/blog-music/music-geometry-intervals-scales/"
              >Music and Geometry: Intervals and Scales</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 18:52:43</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42464557"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42464310">
          <h3>
            <a class="item" href="https://mizu.sh"
              >Show HN: Mizu.js â€“ Lightweight HTML templating library for
              any-side rendering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 18:25:55</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42464310"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'd like to share a fun project I've been working on: mizu.js.
              </p>
              <p>
                It's a js library that add functional attributes support into
                your html, designed to be a simple and flexible alternative to
                fully-fledged web frameworks (such as Vue, React, and Angular),
                while offering more capabilities than other lightweight options
                (like Alpine.js and htmx).
              </p>
              <p>
                As it's written using modern ES features and due to its
                isomorphic nature, it can be run in both browsers and runtimes
                (Node, Deno, Bun) without any changes. This makes it ideal for
                client-side and server-side rendering, as well as static site
                generation, whichever environment you prefer.
              </p>
              <p>
                Just include the script in any web page (or backend) to get
                started. You can template content, bind attributes, add
                interactivity, handle HTTP interactions, create custom
                components, and much more â€” all out of the box, without any
                configuration, transpilation steps, or builds.
              </p>
              <p>
                I hope you'll find mizu.js as exciting and useful as I do and
                I'd love to get your feedback! You can learn more about it at
                <a href="https://mizu.sh">https://mizu.sh</a>!
              </p>
              <p>
                Online playground:
                <a href="https://mizu.sh/playground"
                  >https://mizu.sh/playground</a
                >
                Custom builder:
                <a href="https://mizu.sh/build">https://mizu.sh/build</a> Code
                coverage:
                <a href="https://mizu.sh/coverage">https://mizu.sh/coverage</a>
                GitHub:
                <a href="https://github.com/lowlighter/mizu"
                  >https://github.com/lowlighter/mizu</a
                >
              </p>
              <p>## Motivation ##</p>
              <p>
                Nowadays, setting up a complete environment and installing
                thousands of packages is often required just to create a simple
                "Hello World" page. Yet, with the current ECMAScript standard,
                vanilla JS has never been more powerful. It offers built-in
                custom HTML components, proxies for changes tracking, weak
                references for better memory management, and many new data
                structures and methods.
              </p>
              <p>So why is web development still insanely complex?</p>
              <p>
                mizu.js aims to avoid adding bloat on top of native features,
                and instead focus on providing convenience helpers. It's
                basically "glue" around all these native features with added
                sugar, a recipe for a lightweight yet powerful utility.
              </p>
              <p>
                All evaluated expressions are interpreted as vanilla JavaScript,
                and you add your instructions directly into your HTML. So if you
                know already know about JS/HTML, then you're already 80% know of
                how to use mizu.js (add an extra 10% if you've used Vue,
                Alpine.js or htmx in the past as some syntax and concepts are
                inspired by it), the rest is basically just remembering the
                directive names. The learning curve is that small.
              </p>
              <p>
                Also, you may have heard of
                <a href="https://matcha.mizu.sh">https://matcha.mizu.sh</a>, a
                CSS stylesheet to instantly make your web page stylized. Well,
                it's a great companion to mizu.js. With both of them, you can
                create MVPs for your projects super fast!
              </p>
            </div>
          </section>
        </section>
        <section id="42463295">
          <h3>
            <a
              class="item"
              href="https://www.chicagomag.com/chicago-magazine/january-2024/a-knife-forged-in-fire/"
              >A Knife Forged in Fire</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 16:51:32</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42463295"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42463123">
          <h3>
            <a class="item" href="https://www.nicbarker.com/clay"
              >Clay â€“ UI Layout Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 16:36:54</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42463123"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42462863">
          <h3>
            <a
              class="item"
              href="https://www.writingruxandrabio.com/p/on-clinical-trial-abundance"
              >How to Test More Drugs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 16:13:50</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42462863"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42461688">
          <h3>
            <a class="item" href="https://github.com/apankrat/nullboard"
              >Nullboard: Kanban board in a single HTML file</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 14:29:18</span
              ><span class="points-container"
                >Points: <span class="points">337</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42461688"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42461530">
          <h3>
            <a
              class="item"
              href="https://harpers.org/archive/2025/01/the-ghosts-in-the-machine-liz-pelly-spotify-musicians/"
              >Ghost artists on Spotify</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 14:12:05</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42461530"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42460494">
          <h3>
            <a
              class="item"
              href="https://vintagetek.org/dvst-graphic-terminals/"
              >DVST Graphic Terminals</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 11:35:31</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42460494"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42460132">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41598-024-70633-x"
              >Cannabis pollen dispersal across the United States</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 10:17:56</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42460132"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42458752">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/research/alignment-faking"
              >Alignment faking in large language models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 05:43:29</span
              ><span class="points-container"
                >Points: <span class="points">276</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42458752"
                  >Comments</a
                ><span class="descendants">: 307</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42454359">
          <h3>
            <a class="item" href="https://github.com/pwr-Solaar/Solaar"
              >Solaar is a Linux manager for many Logitech keyboards, mice, and
              other devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 19:57:58</span
              ><span class="points-container"
                >Points: <span class="points">642</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42454359"
                  >Comments</a
                ><span class="descendants">: 247</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42453207">
          <h3>
            <a
              class="item"
              href="https://www.elevationlab.com/blogs/news/introducing-timecapsule"
              >A 10-Year Battery for AirTag</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 18:17:17</span
              ><span class="points-container"
                >Points: <span class="points">388</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42453207"
                  >Comments</a
                ><span class="descendants">: 354</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42442820">
          <h3>
            <a
              class="item"
              href="https://theanimatronicmenagerie.wordpress.com/"
              >The Animatronic Menagerie</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 16:41:19</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42442820"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42441772">
          <h3>
            <a
              class="item"
              href="https://www.earthdata.nasa.gov/learn/data-in-action/global-navigation-satellite-system-data-brings-forth-guardian"
              >Using GPS satellites to detect tsunamis via ionospheric
              ionization waves</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 14:50:01</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42441772"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42441502">
          <h3>
            <a
              class="item"
              href="https://www.macrumors.com/2024/12/16/black-magic-3d-vision-pro-camera/"
              >Blackmagic Debuts $30K 3D Camera for Capturing Video for Vision
              Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 14:18:53</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42441502"
                  >Comments</a
                ><span class="descendants">: 235</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42440496">
          <h3>
            <a
              class="item"
              href="https://scholar.harvard.edu/files/mickens/files/thenightwatch.pdf"
              >The Night Watch [pdf] (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 11:29:26</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42440496"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42439956">
          <h3>
            <a
              class="item"
              href="https://www.camras.nl/en/blog/2024/dwingeloo-telescope-receives-signals-from-voyager-1/"
              >HAM radio operators receive signals from Voyager 1 on Dwingeloo
              telescope</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 09:56:04</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42439956"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42432736">
          <h3>
            <a
              class="item"
              href="https://512pixels.net/2024/12/the-power-mac-4400/"
              >The Power Mac 4400</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 16:47:38</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42432736"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42429646">
          <h3>
            <a
              class="item"
              href="https://nilam.ca/2024/11/02/time-for-a-code-yellow-a-blunt-instrument-that-works/"
              >Time for a code-yellow?: A blunt instrument that works</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 10:09:25</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42429646"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42428290">
          <h3>
            <a class="item" href="https://pyherald.com/articles/16_12_2024/"
              >Conda: A Package Management Disaster?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 05:47:47</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42428290"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42425770">
          <h3>
            <a
              class="item"
              href="https://mascontext.com/issues/trace/kowloon-walled-city-heterotopia-in-a-space-of-disappearance"
              >Kowloon Walled City: Heterotopia in a Space of Disappearance
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 20:30:04</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42425770"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
