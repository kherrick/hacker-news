<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35402539">
          <h3>
            <a
              class="item"
              href="https://www.euronews.com/next/2023/03/31/man-ends-his-life-after-an-ai-chatbot-encouraged-him-to-sacrifice-himself-to-stop-climate-"
              >AI chatbot 'encouraged' man to sacrifice himself to stop climate
              change</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 18:12:30</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35402539"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35402225">
          <h3>
            <a
              class="item"
              href="https://www.pine64.org/2023/04/01/march-update-tablet-bonanza/"
              >Pine64 March Update: Tablet Bonanza</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 17:40:34</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35402225"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35401968">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/science-environment-65148876"
              >Deepest fish ever caught on camera off Japan</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 17:10:40</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35401968"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35400511">
          <h3>
            <a
              class="item"
              href="https://finance.yahoo.com/news/salesforce-shuttering-slack-remote-research-004925901.html"
              >Salesforce is shuttering Slack’s remote work research group
              Future Forum</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 14:19:29</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35400511"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35400253">
          <h3>
            <a class="item" href="https://one-from-nippon.ghost.io/indo-curry/"
              >The surprising roots of Japan's Indian curry</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 13:44:02</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35400253"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35400047">
          <h3>
            <a
              class="item"
              href="https://raphlinus.github.io/rust/2023/04/01/rust-to-cpp.html"
              >Moving from Rust to C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 13:12:30</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35400047"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35399603">
          <h3>
            <a
              class="item"
              href="https://www.exhypothesi.com/clocks-and-causality/"
              >Clocks and Causality – Ordering Events in Distributed Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 12:11:13</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35399603"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35399590">
          <h3>
            <a class="item" href="https://dragon863.github.io/blog/alexa.html"
              >“Alexa, what is my WiFi password?”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 12:08:35</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35399590"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35399218">
          <h3>
            <a class="item" href="https://github.com/fipso/ccurl.sh"
              >Show HN: Use cookies from Chrome (CDP) in cURL without copy
              pasting</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 11:03:10</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35399218"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35398999">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20150516094013/http://www.the-tls.co.uk/tls/public/article1555487.ece"
              >Cities on the Bay: The Ancient Roman Predecessor of Naples
              (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 10:16:55</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35398999"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35398643">
          <h3>
            <a class="item" href="https://www.winehq.org/announce/8.5"
              >Wine 8.5</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 09:16:31</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35398643"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35398480">
          <h3>
            <a class="item" href="https://www.coursem8.com/"
              >Show HN: Coursemate, connect with other self learners</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 08:38:51</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35398480"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
            <div class="text">
              <p>
                My name is Collin, 18 years old and doing a gap year after
                finishing high school last year.
              </p>
              <p>
                This was my first real project after starting to learn web
                development around 5 months ago.
              </p>
              <p>
                I came up with this idea as it was a real pain for me to find
                other people from my country and especially my age, learning and
                taking online courses about the same stuff online. Lots of these
                online courses include their own discord communities and forums,
                but I still found it very hard to connect with other people in
                there.
              </p>
              <p>Thats why I built Coursemate.</p>
              <p>I would love to get your feedback on it! :)</p>
            </div>
          </section>
        </section>
        <section id="35398252">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2023/04/01/amds-hd-6950-vs-rx-6900-xt-what-does-adding-50-do/"
              >AMD’s HD 6950 vs. RX 6900 XT: What Does Adding 50 Do?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 08:03:33</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35398252"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35398235">
          <h3>
            <a class="item" href="http://mynor.org/my4th.htm"
              >My4TH – A minimalistic Forth computer with discrete CPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 08:00:43</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35398235"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35397427">
          <h3>
            <a
              class="item"
              href="https://linuxjedi.co.uk/2023/03/31/this-pc-keyboard-hides-an-interesting-secret/"
              >PC keyboard hides an interesting secret</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 05:31:06</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35397427"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35397418">
          <h3>
            <a
              class="item"
              href="https://worldcoin.org/blog/engineering/humanness-in-the-age-of-ai"
              >Humanness in the Age of AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 05:27:52</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35397418"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35397135">
          <h3>
            <a
              class="item"
              href="http://web.mit.edu/outland/share/doc/xine/hackersguide/hackersguide.html"
              >The xine hacker's guide (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 04:26:01</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35397135"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35397071">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/03/google-drive-does-a-surprise-rollout-of-file-limits-locking-out-some-users/"
              >Google Drive does a surprise rollout of file limits, locking out
              some users</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 04:16:46</span
              ><span class="points-container"
                >Points: <span class="points">324</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35397071"
                  >Comments</a
                ><span class="descendants">: 250</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35397051">
          <h3>
            <a class="item" href="https://en.hexatrek.com"
              >France's Long Distance Trail</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 04:14:02</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35397051"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35396696">
          <h3>
            <a class="item" href="https://aplcart.info/"
              >APLcart – Find your way in APL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 03:10:56</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35396696"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35393284">
          <h3>
            <a
              class="item"
              href="https://github.com/ggerganov/llama.cpp/pull/613"
              >Llama.cpp 30B runs with only 6GB of RAM now</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 20:37:50</span
              ><span class="points-container"
                >Points: <span class="points">1152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35393284"
                  >Comments</a
                ><span class="descendants">: 344</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35391433">
          <h3>
            <a
              class="item"
              href="https://blog.twitter.com/engineering/en_us/topics/open-source/2023/twitter-recommendation-algorithm"
              >Twitter's Recommendation Algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 18:42:16</span
              ><span class="points-container"
                >Points: <span class="points">1500</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35391433"
                  >Comments</a
                ><span class="descendants">: 1035</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35389110">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35389110"
              >Launch HN: Inri (YC W23) – Wealthfront for Investing in India</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 16:02:50</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35389110"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.goinri.com/">https://www.goinri.com/</a>), an
              investment platform for Indian expats to diversify capital in
              India, without any taxation or repatriation hassles. Super excited
              to be launching on HN, the platform that I personally nerd on and
              has helped me discover some of my favorite products early.
              <p>
                My cofounder Hemant (@hemantgangolia) has been living in the US
                since 6 years and has tried multiple times to invest in India.
                He couldn't go ahead with the process because bank account
                opening was a challenge and the process after that wasn't clear.
                There is complexity around taxation, moving money back and a
                general lack of clarity on where to invest.
              </p>
              <p>
                Even though there are currently over 30 million Indian expats
                globally, there are no digital, full-service solutions offered
                for them specifically. US solutions focus only on US investments
                and Indian solutions focus only on Indian customers—this makes
                the India &lt;&gt; US belt underserved. Indian banks with
                overseas branches offer these services, but investors don’t
                trust these banks because of conflict of interest. There are
                other small players in the market but they expect customers to
                do their own service, which is not what customers want, based on
                our learnings.
              </p>
              <p>
                We found a lot of other Indian expats in the same situation as
                us - wanting to invest in India for financial and emotional
                reasons, but unable to do so easily or consistently. We wished a
                simple product existed to solve for this online. We couldn’t
                find one, so we built it.
              </p>
              <p>
                Inri is like Wealthfront for your India investments. It is a web
                platform that offers curated mutual fund portfolios and solves
                for all tax compliance and repatriation needs online. We have
                curated the funds based on performance, history and compliance
                based on your resident country, and funds are selected based on
                your risk preference, similarly to Wealthfront. We facilitate
                investments through central platforms like National Stock
                Exchange and show the holdings via a dashboard on the platform
                once the investments are done. Additionally, we do this while
                making tax compliance and repatriation easy.
              </p>
              <p>
                Just log in to the platform, upload your documents, approve the
                emails with details confirmation and you’re sorted. Currently,
                only people with a PAN card (Indian financial identity document)
                can invest.
              </p>
              <p>
                Our early customers are all people who have tried doing this
                before, but gave up because of all the hassle. The fact that
                they could get invested in just 2 days vs weeks for traditional
                alternatives was unheard of to them.
              </p>
              <p>
                We know this is a bit of a niche product for HN but we also know
                that there are quite a few Indian expats like us here, who could
                make use of it—and we hope it makes interesting enough reading
                for everybody else. We would love to get your feedback! Thank
                you!
              </p>
            </div>
          </section>
        </section>
        <section id="35386948">
          <h3>
            <a
              class="item"
              href="https://www.dylanpaulus.com/posts/postgres-is-a-graph-database/"
              >Postgres as a graph database</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 13:35:36</span
              ><span class="points-container"
                >Points: <span class="points">550</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35386948"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35385952">
          <h3>
            <a
              class="item"
              href="https://medium.com/erlang-battleground/erlang-otp-garbage-collector-48bb28767b87"
              >Erlang/OTP: Garbage Collector</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 12:19:00</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35385952"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35385868">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/features/2023-03-30/dungeons-and-dragons-movie-gives-hasbro-a-golden-opportunity"
              >Dungeons and Dragons Embarks on an Epic Quest to Finally Make
              Money</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 12:12:18</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35385868"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35384947">
          <h3>
            <a
              class="item"
              href="https://www.infoq.com/articles/wonders-of-postgres-logical-decoding-messages/"
              >The Wonders of Postgres Logical Decoding Messages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 10:32:37</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35384947"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35384789">
          <h3>
            <a
              class="item"
              href="https://hansonkd.medium.com/building-beautiful-binary-parsers-in-elixir-1bd7f865bf17"
              >Visual Programming with Elixir: Learning to Write Binary Parsers
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 10:08:14</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35384789"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35383527">
          <h3>
            <a
              class="item"
              href="https://lifehacker.com/a-new-beginning-for-lifehacker-1850278940"
              >A New Beginning for LifeHacker</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-31 @ 06:44:56</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35383527"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35378109">
          <h3>
            <a class="item" href="https://iliana.fyi/blog/acropalypse-now/"
              >The undocumented Android change that led to aCropalypse was
              reported during beta</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 20:01:15</span
              ><span class="points-container"
                >Points: <span class="points">310</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35378109"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
