<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43721379">
          <h3>
            <a class="item" href="https://github.com/terror/val"
              >Show HN: val – An arbitrary precision calculator language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 19:51:31</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43721379"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>Such a nice DX combo for writing new languages.</p>
              <p>Still a work in progress, but I thought I'd share :)</p>
            </div>
          </section>
        </section>
        <section id="43721228">
          <h3>
            <a class="item" href="https://github.com/waj/shell-secrets"
              >Shell-secrets – GPG-encrypted environment variables</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 19:39:42</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43721228"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43721206">
          <h3>
            <a class="item" href="https://lpiccinelli-eth.github.io/pub/unik3d/"
              >UniK3D: Universal Camera Monocular 3D Estimation – Luigi
              Piccinelli</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 19:38:08</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43721206"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43720845">
          <h3>
            <a
              class="item"
              href="https://developers.googleblog.com/en/start-building-with-gemini-25-flash/"
              >Gemini 2.5 Flash</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 19:03:39</span
              ><span class="points-container"
                >Points: <span class="points">265</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43720845"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43720767">
          <h3>
            <a
              class="item"
              href="https://onetake-ai.github.io/hackernews-watercooler/"
              >Show HN: HN Watercooler – listen to HN threads as an audio
              conversation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 18:54:13</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43720767"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
            <div class="text">
              <p>
                It takes any HN thread and turns it into an audio conversation
                so you can listen to the thread while doing other things.
              </p>
              <p>
                I've seen many previous attempts to turn HN threads into
                podcasts, but they all shared a common issue IMO: trying to
                reduce the very rich back-and-forth into a single-thread
                single-reader boring podcast. Instead, I wanted to hear the
                actual debate from the actual thread!
              </p>
              <p>
                So I asked Claude 3.7 to build this for me as a browser-only
                app. It just needs a thread URL and an Elevenlabs API key (this
                all remains in your browser, you can check the source code, it's
                only 3 files, there is no server storage of anything).
              </p>
              <p>
                To make the resulting audio experience as natural as possible,
                each commenter has a different voice.
              </p>
              <p>
                Commenters who appear multiple times in the thread have the same
                voice, and introduce themselves. A bit of context is also
                introduced when coming back "up" from deeply nested comments.
              </p>
              <p>
                You can play the resulting audio or download it for later
                listening. I'm planning to later add the ability to load
                multiple threads so I can have a playlist generated for
                listening in the gym!
              </p>
              <p>Any comments or improvement suggestions are appreciated!</p>
            </div>
          </section>
        </section>
        <section id="43720457">
          <h3>
            <a
              class="item"
              href="https://www.carlos-menezes.com/single-param-functions/"
              >N-Params vs. Single Param</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 18:23:23</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43720457"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43719926">
          <h3>
            <a
              class="item"
              href="https://salmagundi.skidmore.edu/articles/75-on-jane-jacobs"
              >On Jane Jacobs (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 17:35:33</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43719926"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43719830">
          <h3>
            <a
              class="item"
              href="https://misfra.me/2025/sqlite-transactions-and-virtual-tables/"
              >SQLite Transactions and Virtual Tables</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 17:28:31</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43719830"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43719522">
          <h3>
            <a class="item" href="https://www.easypost.com/careers"
              >EasyPost (YC S13) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 17:01:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43719447">
          <h3>
            <a class="item" href="https://github.com/coder/agentapi"
              >Show HN: AgentAPI – HTTP API for Claude Code, Goose, Aider, and
              Codex</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 16:54:58</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43719447"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43719280">
          <h3>
            <a class="item" href="https://www.dwarkesh.com/p/ege-tamay"
              >AGI Is Still 30 Years Away – Ege Erdil and Tamay Besiroglu</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 16:42:13</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43719280"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43718809">
          <h3>
            <a
              class="item"
              href="https://quagmirerepair.com/milwaukee-m18-battery-reverse-engineering"
              >Milwaukee M18 Battery Reverse Engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 16:07:21</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43718809"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43717705">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/04/17/technology/google-ad-tech-antitrust-ruling.html"
              >Google is illegally monopolizing online advertising tech, judge
              rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 14:47:46</span
              ><span class="points-container"
                >Points: <span class="points">527</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43717705"
                  >Comments</a
                ><span class="descendants">: 274</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43717606">
          <h3>
            <a
              class="item"
              href="https://sharpletters.net/2025/04/16/hdr-emoji/"
              >HDR‑Infused Emoji</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 14:42:07</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43717606"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43717377">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2025-04-stainless-steel-technique-submicron-anti.html"
              >Stainless steel strengthened: Twisting creates submicron
              'anti-crash wall'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 14:28:07</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43717377"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43716856">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2025/04/17/openai-looked-at-cursor-before-considering-deal-with-rival-windsurf.html"
              >OpenAI looked at buying Cursor creator before turning to
              Windsurf</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 13:51:49</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43716856"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43716526">
          <h3>
            <a
              class="item"
              href="https://nvd.nist.gov/vuln/detail/CVE-2025-32433"
              >Unauthenticated Remote Code Execution in Erlang/OTP SSH</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 13:29:44</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43716526"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43716058">
          <h3>
            <a
              class="item"
              href="https://maknee.github.io/blog/2025/3FS-Performance-Journal-1/"
              >An intro to DeepSeek's distributed file system</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 12:50:37</span
              ><span class="points-container"
                >Points: <span class="points">389</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43716058"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43715884">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cjr75wypg0vo"
              >Discord's face scanning age checks 'start of a bigger shift'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 12:34:38</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43715884"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43714619">
          <h3>
            <a
              class="item"
              href="https://www.tokyoweekender.com/art_and_culture/japanese-culture/oda-ujiharu-the-weakest-samurai-warlord/"
              >Oda Ujiharu: Why the ‘weakest Samurai warlord’ is admired</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 09:30:43</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43714619"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43714476">
          <h3>
            <a
              class="item"
              href="https://www.goto10retro.com/p/the-atari-1200xl-fiasco"
              >The Atari 1200XL Fiasco</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 09:01:07</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43714476"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43710761">
          <h3>
            <a class="item" href="https://jsomers.net/vivarium/"
              >Vivarium: The keeper of a lab's animals stumbles onto a secret
              [fiction]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 21:46:10</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43710761"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <p>
                The contrast hit me most vividly during the pandemic when I was
                writing an article about the immune system. [1] One of the
                scientists I spoke to told me about putting hamsters on warming
                plates, picking them up gently — in general, caring for and
                about them — and then feeling grief at their deaths. But of
                course understanding the immune response during infection with
                covid was a worthy cause. I felt no judgement towards this
                scientist; they are in a difficult position.
              </p>
              <p>
                There was another more direct bit of inspiration, when I read
                this article [2], in 2023, about the toll that caring for
                laboratory animals could take on people’s mental health:
              </p>
              <p>
                &gt;
                <i
                  >Besides the symptoms Sessions experienced, those who handle
                  lab animals may face insomnia, chronic physical ailments,
                  zombielike lack of empathy, and, in extreme cases, severe
                  depression, substance abuse, and thoughts of suicide. As many
                  as nine in 10 people in the profession will suffer from
                  compassion fatigue at some point during their careers,
                  according to recent research, more than twice the rate of
                  those who work in hospital intensive care units. It’s one of
                  the leading reasons animal care workers quit.</i
                >
              </p>
              <p>
                That left an impression on me, and also armed me with a
                character: the forgotten-about, somewhat miserable vivarium
                worker.
              </p>
              <p>
                The story obviously takes many liberties with fact — it is
                fiction — but I also tried to ground it in reality, and stuff
                that you might think I made up (the guillotine, the crazy VR
                sphere in the first paragraph), I did not.
              </p>
              <p>
                I hope you enjoy! If nothing else I expect you’ll appreciate the
                illustrations, done by my friend Ben Smith [3].
              </p>
              <p>
                [1]:
                <a
                  href="https://www.newyorker.com/magazine/2020/11/09/how-the-coronavirus-hacks-the-immune-system"
                  >https://www.newyorker.com/magazine/2020/11/09/how-the-corona...</a
                >
              </p>
              <p>
                [2]:
                <a
                  href="https://www.science.org/content/article/suffering-silence-caring-research-animals-can-take-severe-mental-toll"
                  >https://www.science.org/content/article/suffering-silence-ca...</a
                >
              </p>
              <p>
                [3]:
                <a href="https://www.stephenbonesproductions.com/"
                  >https://www.stephenbonesproductions.com/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43704382">
          <h3>
            <a
              class="item"
              href="https://www.afterbabel.com/p/industrial-scale-snapchat"
              >Snapchat is harming children at an industrial scale?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 12:12:17</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43704382"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43704364">
          <h3>
            <a class="item" href="https://pwy.io/posts/marching-events/"
              >Marching Events: What does iCalendar have to do with ray
              marching?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 12:10:33</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43704364"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43692746">
          <h3>
            <a
              class="item"
              href="https://www.tdk.com/en/about_tdk/innovation/spin-photo-detector/index.html"
              >Ultrafast Optical Detector</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 13:56:32</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43692746"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43691230">
          <h3>
            <a
              class="item"
              href="https://github.com/pydantic/pydantic-ai/tree/main/mcp-run-python"
              >MCP Run Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 11:09:30</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43691230"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43687494">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/family/archive/2025/04/how-to-load-dishwasher/682425/"
              >There are two types of dishwasher people</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 23:43:54</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43687494"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43685072">
          <h3>
            <a
              class="item"
              href="https://nautil.us/what-my-stroke-taught-me-236544/"
              >What my stroke taught me (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 19:17:16</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43685072"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43678144">
          <h3>
            <a class="item" href="https://www.makingsoftware.com/"
              >Making Software</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 04:48:54</span
              ><span class="points-container"
                >Points: <span class="points">549</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43678144"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43678074">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2412.12578"
              >Our quantum assembly parser got updated to the QASM 3.0 spec</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 04:31:04</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43678074"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
