<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37304370">
          <h3>
            <a class="item" href="https://mjg59.dreamwidth.org/67402.html"
              >Unix sockets, Cygwin, SSH agents, and sadness</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 07:11:09</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37304370"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37304167">
          <h3>
            <a
              class="item"
              href="https://fractalfir.github.io/generated_html/rustc_codegen_clr_v0_0_1.html"
              >Compiling Rust for .NET, using only tea and stubbornness</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 06:39:59</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37304167"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37304153">
          <h3>
            <a
              class="item"
              href="https://9to5google.com/2023/08/28/google-pixel-8-android-os-updates/"
              >Source: Google Pixel 8 will get more Android OS updates</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 06:35:54</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37304153"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37304125">
          <h3>
            <a
              class="item"
              href="https://birchtree.me/blog/a-note-to-young-folks-download-the-videos-you-love/"
              >A note to young folks: download the things you love</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 06:30:17</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37304125"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37303960">
          <h3>
            <a class="item" href="https://github.com/btpf/Alexandria"
              >Alexandria: A minimalistic cross-platform eBook reader</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 05:55:40</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37303960"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37303868">
          <h3>
            <a
              class="item"
              href="https://reason.com/2023/08/25/presence-of-forever-chemicals-in-paper-straws-highlights-the-inanity-of-plastic-straw-bans/"
              >Paper Straws Have Higher 'Forever Chemical' Concentration Than
              Plastic Straws</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 05:33:35</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37303868"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37303695">
          <h3>
            <a
              class="item"
              href="https://superfastpython.com/numpy-share-array-processes/"
              >How to share a NumPy array between processes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 04:57:35</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37303695"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37303569">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/autos-transportation/toyota-halts-operations-12-japan-factories-due-system-failure-nhk-2023-08-29/"
              >Toyota to halt operations at all Japan assembly plants due to
              system failure</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 04:28:35</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37303569"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37303364">
          <h3>
            <a
              class="item"
              href="https://www.vector-logic.com/blog/posts/implementing-neighbour-based-recommendations-in-ruby"
              >Implementing Nearest-Neighbour Recommendations in Ruby</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 03:49:42</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37303364"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37302816">
          <h3>
            <a
              class="item"
              href="https://hagakure.substack.com/p/the-hagakure-64-the-heart-of-w-edwards"
              >The Heart of W. Edwards Deming</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 02:23:56</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37302816"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37302284">
          <h3>
            <a class="item" href="https://padlet.jobs"
              >Padlet (YC W13) is hiring in San Francisco and Singapore</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 01:00:15</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37301991">
          <h3>
            <a class="item" href="https://webllm.mlc.ai/"
              >WebLLM: Llama2 in the Browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 00:19:54</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37301991"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37301400">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/graphic-detail/2023/08/22/the-sudden-demise-of-indian-vultures-killed-thousands-of-people"
              >The sudden demise of Indian vultures killed thousands of
              people</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 22:50:55</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37301400"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37299986">
          <h3>
            <a class="item" href="https://www.oneearth.org/bioregions-2023/"
              >Bioregions 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 20:27:03</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37299986"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37298665">
          <h3>
            <a
              class="item"
              href="https://trohan.com/2023/08/20/raise-less-build-more/"
              >Raise less, build more</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 18:42:01</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37298665"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37298506">
          <h3>
            <a
              class="item"
              href="https://www.tindie.com/products/aaafnraa/serial-adapter-reboot-controller-for-apple-m1m2/"
              >Serial adapter/reboot controller for Apple M1/M2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 18:29:27</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37298506"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37298441">
          <h3>
            <a class="item" href="https://go.dev/blog/rebuild"
              >Perfectly Reproducible, Verified Go Toolchains</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 18:24:15</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37298441"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37297362">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/a-lost-edith-wharton-play-is-performed-for-the-first-time-180982795/"
              >A lost Edith Wharton play debuts on stage</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 17:13:51</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37297362"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37297304">
          <h3>
            <a
              class="item"
              href="https://openai.com/blog/introducing-chatgpt-enterprise"
              >ChatGPT Enterprise</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 17:09:47</span
              ><span class="points-container"
                >Points: <span class="points">724</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37297304"
                  >Comments</a
                ><span class="descendants">: 400</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37296153">
          <h3>
            <a class="item" href="https://applied-langua.ge/~hayley/swcl-gc.pdf"
              >Parallel garbage collection for SBCL [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 15:59:07</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37296153"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37295409">
          <h3>
            <a
              class="item"
              href="https://research.usc.edu/news/2023/08/usc-supported-startup-receives-major-grant-for-clinical-trial-of-a-promising-eye-treatment/"
              >Startup receives grant for clinical trial of a promising eye
              treatment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 15:14:26</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37295409"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37295149">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37295149"
              >Launch HN: HyLight (YC S23) – Hydrogen airships to inspect energy
              infrastructure</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 15:00:59</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37295149"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.hylight.aero">https://www.hylight.aero</a>).
              We build and operate autonomous hydrogen airships to inspect
              energy infrastructure like pipelines and power lines. Here’s a
              video:
              <a href="https://www.youtube.com/watch?v=SuW5ur8ER7A"
                >https://www.youtube.com/watch?v=SuW5ur8ER7A</a
              >.
              <p>
                Energy infrastructure operators (utility companies) struggle
                with conducting precise inspections of their assets. It is
                extremely important for them because they need to make sure that
                the network is in good condition to avoid outages and leaks.
                This infrastructure has big impacts when it is malfunctioning.
                For instance, methane leaks from oil and gas infrastructure
                represent 4% of global carbon emissions every year (and approx.
                $7B worth of losses in Northern America and Europe).
              </p>
              <p>
                Gas and power networks are physically so large (more than 47M
                miles globally) that millions of miles of inspections must be
                done each year. Currently the most used solution is helicopters
                (used on 90% of inspections). Helicopters are dangerous, have a
                high carbon footprint and are costly to use. Plus, helicopter
                service providers have to go as fast as they can to save their
                margins. So the data quality is not optimal at all.
              </p>
              <p>
                Our airship (the “HyLighter”) does exactly what is needed to
                gather a lot of precise information from the air. It flies
                slowly and can hover almost indefinitely, it consumes little
                energy, allowing great range for inspections. It can
                simultaneously mount all the sensors that are required for the
                inspections (HQ cameras, LiDAR, infrared, leak detection
                devices...). Plus, due to its size, we can write stuff on it to
                tell nearby residents what we are doing.
              </p>
              <p>
                How does it work? It is basically a drone airship. We use a
                lighter-than-air gas in the envelope (helium or hydrogen) for
                buoyancy. We have a H2 tank and fuel cell transforming H2 into
                power for all the systems. In terms of engines we built 2 gyros
                (gyroscopes engines) at the rear and front of the airship. They
                allow us to have vectorial thrust and therefore to be extremely
                maneuverable. The sensors are fixed under the HyLighter on
                gimbals and can easily “follow” the linear infrastructure that
                is inspected.
              </p>
              <p>
                When we began working on H2 and drones, we quickly realized that
                there was a problem with the weight of H2 tanks. The tanks have
                to be very strong to contain enough H2 which is extremely low in
                density. Then, we realized that we could use the "problem"
                inherent to H2 (very low density) to our advantage. We simply
                needed to use H2 as a lifting gas and power source. The envelope
                of the airship becomes the tank!
              </p>
              <p>
                The HyLighter is more efficient than other current solutions. As
                mentioned, helicopters are the most-used at present. Compared to
                those, we use less energy, emit less GHG, have better data
                quality, and less risks for human beings as the HyLighter is
                unmanned. Compared to quad drones, we have longer flight time
                and more payload, allowing for various simultaneous sensors
                collecting data—we can simultaneously mount all the sensors that
                are required for the inspections (HQ cameras, LiDAR, infrared,
                leak detection devices). Compared to plane drones, our flight
                speed is lower so we can collect better data and less ground
                risk. Compared to satellites, we have a lot more precision
                (actually they can't even be used for most of our operational
                use cases).
              </p>
              <p>
                The genesis of HyLight is that Théo wanted to work on new uses
                of H2 and drones when he was at school. He was joined by Martin
                who studied in the same engineering school, then by Josef who's
                Martin's BFF and then by me. I met Théo when we finished our
                studies in UC Berkeley last year and we all launched HyLight
                together. As we kept working on it, we gained more and more
                interest from pipeline and power line operators and we realized
                that there was indeed a big problem.
              </p>
              <p>
                HyLight is at the stage where we have our first POCs. Our first
                paid flight is in the coming weeks. Our business model is
                straightforward: inspection as a service. We charge a price per
                kilometer depending on length, location and type of data
                collected.
              </p>
              <p>
                I discovered HN not too long ago and I’m impressed with the
                engagement in tech and innovation of this community! I’m very
                interested to get your opinion on HyLight. Maybe some people
                work in the energy industry and know a thing or two about energy
                infra inspections that we could learn from? If so please tell us
                what you think, be it red flags or positive stuff! Also, as
                individuals, how would you feel seeing a big drone airship
                flying in the air near your home? We look forward to any and all
                comments!
              </p>
            </div>
          </section>
        </section>
        <section id="37295066">
          <h3>
            <a
              class="item"
              href="https://questdb.io/blog/concurrent-lockfree-datastructure-design-walkthrough/"
              >Designing a new concurrent data structure</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 14:56:19</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37295066"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37291962">
          <h3>
            <a
              class="item"
              href="https://www.atariarchives.org/bcc2/showpage.php?page=10"
              >The $2.98 Computer Library (1977)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 10:17:33</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37291962"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37290625">
          <h3>
            <a class="item" href="http://spoonplanet.com/"
              >Souvenir Spoons Museum</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 06:41:20</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37290625"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37289756">
          <h3>
            <a
              class="item"
              href="https://hakaimagazine.com/features/loose-lips-save-sunken-ships/"
              >Loose lips save sunken ships</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-28 @ 04:24:54</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37289756"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37284472">
          <h3>
            <a
              class="item"
              href="https://xeiaso.net/talks/unix-philosophy-logical-extreme-wasm"
              >Reaching the Unix philosophy's logical extreme with
              WebAssembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-27 @ 16:58:49</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37284472"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37279895">
          <h3>
            <a
              class="item"
              href="https://southseattleemerald.com/2023/08/26/can-a-worker-owned-restaurant-work/"
              >Can a worker-owned restaurant work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-27 @ 06:16:31</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37279895"
                  >Comments</a
                ><span class="descendants">: 357</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37279651">
          <h3>
            <a
              class="item"
              href="https://begriffs.com/posts/2021-11-28-practical-parsing.html"
              >Practical parsing with Flex and Bison (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-27 @ 05:25:34</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37279651"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37259204">
          <h3>
            <a class="item" href="https://watchsage.uc.r.appspot.com/"
              >Explore the Genealogy of Timepieces</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-25 @ 07:51:16</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37259204"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
