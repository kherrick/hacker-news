<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41399224">
          <h3>
            <a
              class="item"
              href="https://pieeg.com/news/low-cost-16-eeg-channels-cap-hat-available-for-buy-all-in-one/"
              >Low-cost 16 EEG channels cap (hat) for PiEEG</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 09:54:52</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41399224"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41399047">
          <h3>
            <a class="item" href="https://rulebasedintegration.org/"
              >Rubi: Symbolic integrator based on an extensive system of
              integration rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 09:25:13</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41399047"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41398925">
          <h3>
            <a
              class="item"
              href="https://digitalpreservation-blog.nb.no/blog/2024-08-28-rearchiving-2-million-hours-of-digital-radio/"
              >Rearchiving 2M hours of digital radio, a comprehensive process</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 08:59:07</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41398925"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41398780">
          <h3>
            <a class="item" href="https://github.com/duneroadrunner/scpptool"
              >Scpptool â€“ a tool to enforce a memory and data race safe subset
              of C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 08:29:04</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41398780"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41398351">
          <h3>
            <a
              class="item"
              href="https://www.iacr.org/cryptodb/data/paper.php?pubkey=34281"
              >Time-Memory Trade-Offs Sound the Death Knell for GPRS and GSM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 07:06:34</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41398351"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41397873">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/pdf/10.1145/63039.63045"
              >Calendar Queues: A Fast O(1) Priority Queue Implementation
              (1998)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 05:07:15</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41397873"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41397498">
          <h3>
            <a class="item" href="https://github.com/algora-io/tv"
              >Open Source Twitch for Developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 03:28:27</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41397498"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41396641">
          <h3>
            <a
              class="item"
              href="http://consulting.m3047.net/dubai-letters/balkanized-internet.html"
              >I'm blocking connections from AWS to my on-prem services</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 00:15:51</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41396641"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41396501">
          <h3>
            <a class="item" href="https://bletchleypark.org.uk/"
              >Visit Bletchley Park</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 23:46:25</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41396501"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41396260">
          <h3>
            <a class="item" href="https://github.com/libsdl-org/SDL/pull/9312"
              >SDL3 new GPU API merged</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 23:04:32</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41396260"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41396206">
          <h3>
            <a
              class="item"
              href="https://www.haskellforall.com/2024/08/firewall-rules-not-as-secure-as-you.html"
              >Firewall rules: not as secure as you think</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 22:56:27</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41396206"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41395925">
          <h3>
            <a class="item" href="https://github.com/google/closure-library"
              >Google Closure Library has been archived</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 22:22:12</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41395925"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41395921">
          <h3>
            <a
              class="item"
              href="https://github.com/anthropics/courses/tree/master/prompt_engineering_interactive_tutorial"
              >Anthropic's Prompt Engineering Interactive Tutorial</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 22:21:55</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41395921"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41395893">
          <h3>
            <a
              class="item"
              href="https://rattvisan.blog/2024/07/28/yes-i-was-poisoned-by-my-wife-a-software-engineer-of-top3-us-company/"
              >Blood Disorder: Unveiling the Mystery of My Poisoning in
              Sweden</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 22:19:48</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41395893"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41395413">
          <h3>
            <a
              class="item"
              href="https://eieio.games/essays/the-secret-in-one-million-checkboxes/"
              >The secret inside One Million Checkboxes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 21:20:12</span
              ><span class="points-container"
                >Points: <span class="points">1455</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41395413"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41395226">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/poly/jobs/L4ObRgn-founding-platform-full-stack-front-end-engineer"
              >Poly (YC S22) is hiring Rust experts in SF to build "Arc browser
              for files"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 21:00:51</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41394797">
          <h3>
            <a
              class="item"
              href="https://www.elastic.co/blog/elasticsearch-is-open-source-again"
              >Elasticsearch is open source, again</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 20:10:02</span
              ><span class="points-container"
                >Points: <span class="points">583</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41394797"
                  >Comments</a
                ><span class="descendants">: 287</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41393458">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41393458"
              >Launch HN: CodeViz (YC S24) â€“ Visual maps of your codebase in VS
              Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 17:50:23</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41393458"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
            <div class="text">
              <a href="https://codeviz.ai">https://codeviz.ai</a>). We're
              building a VS Code extension that generates interactive diagrams
              of codebases, from system architecture down to function call
              graphs. Hereâ€™s a demo where we analyze OpenHands, uv, and webviz:
              <a href="https://www.youtube.com/watch?v=fgfDXUtWzRk"
                >https://www.youtube.com/watch?v=fgfDXUtWzRk</a
              >.
              <p>
                The extension is public if you want to try it on your own repos:
                <a
                  href="https://marketplace.visualstudio.com/items?itemName=CodeViz.codeviz"
                  >https://marketplace.visualstudio.com/items?itemName=CodeViz....</a
                >
              </p>
              <p>
                Will and I started CodeViz because we wanted more intuitive
                representations of software. During our time at Tesla, we
                encountered a common problem: software engineers spend very
                little time actually typing code. Most development time was
                spent navigating convoluted files and building a mental map for
                each task. At the same time, whiteboard sessions were proof that
                code could be expressed intuitively.
              </p>
              <p>
                We started with autogenerated technical documentation. Of
                course, long markdown docs are not a good solution for long
                files of code. We realized we needed diagrams that (a) help
                grasp large quantities of code and (b) can be filtered according
                to the developerâ€™s task. So, we built a graph-based VS Code
                extension. It generates diagrams directly within VS Code,
                illustrating connections between functions and providing
                overviews of system architecture. These visualizations update as
                code changes.
              </p>
              <p>CodeViz appears as a side panel in VS Code with two views:</p>
              <p>
                (1) Call graph: as you click on functions, we show a chain of
                upstream and downstream references. You can navigate your
                codebase using the call stack and see, in one view, everywhere
                your functions are called. We generate this call graph using the
                language servers developers have already installed in VS Code
              </p>
              <p>
                (2) Architecture diagram: we create a C4 diagram of your system,
                so you can see a top-level view of your codebase and click into
                the component layer. We were surprised to find that a small
                fraction of code can generate a very accurate representation of
                the system. We detect these important files, then use LLMs to
                build nested architecture diagrams at the container and
                component level
              </p>
              <p>
                Developers are mainly using our extension to navigate spaghetti
                code, onboard new devs, and interpret open source repos. We're
                still figuring out our pricing. Currently, we offer basic
                features for free, with a paid tier for more resource-intensive
                tools like detailed architecture diagrams. Open to suggestions
                on this approach.
              </p>
              <p>
                CodeViz is in active development and our main focus over the
                next couple of days is to make the call graph much easier to
                view and navigate. We're continuously working to make it better,
                so your honest feedback, suggestions, and wishes would be very
                helpful. Looking forward to hearing any and all thoughts,
                whether about the current extension, general problem space, or
                something else!
              </p>
            </div>
          </section>
        </section>
        <section id="41393005">
          <h3>
            <a class="item" href="https://hn.trieve.ai/"
              >Show HN: A discovery-focused search engine for Hacker News</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 17:08:20</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41393005"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <p>- no-JS version (hnnojs.trieve.ai)</p>
              <p>- site:{required_site} and site:{negated-site} filters</p>
              <p>- public analytics</p>
              <p>- LLM generated query suggestions based on random stories</p>
              <p>- recommendations</p>
              <p>- dense vector semantic search</p>
              <p>- SPLADE fulltext search</p>
              <p>- RAG AI chat</p>
              <p>- order by descendant count</p>
              <p>
                client code (FOSS self-hostable) -
                <a href="https://github.com/devflowinc/trieve-hn-discovery"
                  >https://github.com/devflowinc/trieve-hn-discovery</a
                >
              </p>
              <p>
                engine code (BSL source-available) -
                <a href="https://github.com/devflowinc/trieve"
                  >https://github.com/devflowinc/trieve</a
                >
              </p>
              <p>
                There is an extended about page with detailed information on
                features, how much it costs to run, etc. here -
                <a href="https://hn.trieve.ai/about"
                  >https://hn.trieve.ai/about</a
                >.
              </p>
            </div>
          </section>
        </section>
        <section id="41392128">
          <h3>
            <a class="item" href="https://ian.sh/tsa"
              >Bypassing airport security via SQL injection</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 15:53:08</span
              ><span class="points-container"
                >Points: <span class="points">1654</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41392128"
                  >Comments</a
                ><span class="descendants">: 352</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41391822">
          <h3>
            <a
              class="item"
              href="https://github.com/rscott2049/pico-rmii-ethernet_nce"
              >Raspberry Pi Pico does line rate 100M Ethernet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 15:29:13</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41391822"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41391412">
          <h3>
            <a class="item" href="https://brave.com/blog/related-website-sets/"
              >Chrome is entrenching third-party cookies that will mislead
              users</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 14:53:15</span
              ><span class="points-container"
                >Points: <span class="points">397</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41391412"
                  >Comments</a
                ><span class="descendants">: 206</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41390884">
          <h3>
            <a
              class="item"
              href="https://unchartedterritories.tomaspueyo.com/p/can-solar-costs-keep-shrinking"
              >Can solar costs keep shrinking?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-29 @ 13:57:51</span
              ><span class="points-container"
                >Points: <span class="points">306</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41390884"
                  >Comments</a
                ><span class="descendants">: 467</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41378443">
          <h3>
            <a
              class="item"
              href="https://outlandishclaims.substack.com/p/seven-glass-beads"
              >Glass Beads</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 11:44:58</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41378443"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41376893">
          <h3>
            <a
              class="item"
              href="https://liorsinai.github.io/machine-learning/2024/07/27/micrograd-1-chainrules.html"
              >Micrograd.jl</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 07:24:42</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41376893"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41368583">
          <h3>
            <a
              class="item"
              href="https://www.bly.com/Pages/documents/STIKFS.html"
              >Marketing to Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 15:23:04</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41368583"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41368239">
          <h3>
            <a class="item" href="https://bpfquery.com/?showing=kprobe"
              >Show HN: bpfquery â€“ experimenting with compiling SQL to
              bpf(trace)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 14:55:09</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41368239"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/zmaril/bpfquery"
                >https://github.com/zmaril/bpfquery</a
              >. It's a very minimal sql to bpftrace compiler that lets you
              explore what's going on with your systems. It implements queries,
              expressions, and filters/wheres/predicates, and has a streaming
              pivot table interface built on
              <a href="https://perspective.finos.org"
                >https://perspective.finos.org</a
              >. I am still figuring out how to do windows, aggregations and
              joins though, but the pivot table interface actually lets you get
              surprisingly far. I hope you enjoy it!
            </div>
          </section>
        </section>
        <section id="41364715">
          <h3>
            <a
              class="item"
              href="https://harpers.org/archive/2024/09/the-thin-purple-line-jasper-craven-private-security-guard/"
              >The Thin Purple Line</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 05:09:24</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41364715"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41356775">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/geoffreylitt/archive/your-pie-doesnt-need-to-be-original-unless-you/"
              >Pie doesn't need to be original (unless you claim it so)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 13:11:07</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41356775"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41356279">
          <h3>
            <a
              class="item"
              href="https://blog.colinbreck.com/predicting-the-future-of-distributed-systems/"
              >Predicting the future of distributed systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 11:56:19</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41356279"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
