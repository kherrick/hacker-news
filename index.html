<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37757516">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/gym-class-by-irl-studios/jobs/ADcM4ZV-lead-backend-engineering"
              >GCVR (YC W22, Top Rated on Quest) Hiring Lead Back End
              Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 21:00:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37756964">
          <h3>
            <a class="item" href="https://poppler.freedesktop.org/"
              >Poppler is a PDF rendering library based on the xpdf-3.0 code
              base</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 20:16:22</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37756964"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37756714">
          <h3>
            <a
              class="item"
              href="https://www.calculatedriskblog.com/2023/10/update-lumber-prices-down-11-yoy.html"
              >Update: Lumber Prices Down 11% YoY</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 19:55:18</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37756714"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37756678">
          <h3>
            <a class="item" href="https://linkcollect.io"
              >Show HN: Bookmark in Public – Curate and Share Collections of
              Links Easily</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 19:51:39</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37756678"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37756656">
          <h3>
            <a
              class="item"
              href="https://blog.cr.yp.to/20231003-countcorrectly.html"
              >Debunking NIST's calculation of the Kyber-512 security level</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 19:49:47</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37756656"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37756632">
          <h3>
            <a
              class="item"
              href="https://georgek.github.io/blog/posts/multiple-web-projects-traefik/"
              >Working on Multiple Web Projects with Docker Compose and
              Traefik</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 19:46:47</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37756632"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37756357">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Glibc-LD-Nasty-Root-Bug"
              >Glibc Dynamic Loader Hit by a Nasty Local Privilege Escalation
              Vulnerability</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 19:25:35</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37756357"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37755942">
          <h3>
            <a
              class="item"
              href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9517068/"
              >Study Finds Hybrid Work Improves Mental Health Compared to Remote
              or In-Office</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 18:49:10</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37755942"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37755785">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2023/oct/03/techscape-geofence-warrants"
              >How police use location/search data to find suspects - not always
              the right ones</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 18:34:28</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37755785"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37755648">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/business/retail/amazon-used-secret-project-nessie-algorithm-to-raise-prices-6c593706"
              >Amazon Used Secret ‘Project Nessie’ Algorithm to Raise Prices</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 18:23:22</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37755648"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37754489">
          <h3>
            <a
              class="item"
              href="https://jamiemagee.co.uk/blog/honey-i-shrunk-the-npm-package/"
              >Honey, I shrunk the NPM package</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 16:55:55</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37754489"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37753791">
          <h3>
            <a class="item" href="https://www.wildmoose.ai/"
              >Show HN: Wild Moose – Autonomous agent for production
              debugging</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 16:08:50</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37753791"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                Try our tool with your Datadog’s logs and metrics &gt;&gt;
                <a href="https://app.wildmoose.ai/slack/install"
                  >https://app.wildmoose.ai/slack/install</a
                >
              </p>
              <p>
                Setup demo &gt;&gt;
                <a href="https://tinyurl.com/mvaj8emf"
                  >https://tinyurl.com/mvaj8emf</a
                >
              </p>
              <p>
                Today's GenAI devtools, such as Copilot, are limited: they are
                great for writing code, but we all know that programming is only
                20% coding, and 80% debugging.
              </p>
              <p>
                So how can GenAI be used for debugging? As opposed to code
                completion or test automation, production debugging is not about
                generating text. Debugging is mostly about root-cause analysis.
                We realized two things:
              </p>
              <p>
                1) Generative AI is drastically changing the way we work with
                data, thanks to its ability to not only generate queries, but
                also run code and analyze unstructured data. This enables
                building better data-exploration experiences with far more
                intuitive interfaces.
              </p>
              <p>
                2) RCA is all about exploring different types of data. When you
                don’t know why a transaction was dropped or which customers are
                affected – you explore metrics, logs, your code, other people’s
                code, old slack messages, and whatnot, to figure out what’s
                broken.
              </p>
              <p>
                Putting those two together, we built an autonomous agent that
                helps debug production issues. Our LLM "moose" (ok, it's corny
                but we like it) connects to your logs, metrics, and other
                observability data, and lets you extract and analyze them by
                conversing with it. Once it gets a task, it will start
                reasoning, invoking APIs, and running code, until it comes back
                with an answer.
              </p>
              <p>
                For example, when requested to “show me IDs of transactions that
                took over 1 minute today”, it will fetch those transactions from
                Datadog for you. You might then ask it if long-running
                transactions correlate with a metric such as DB CPU load. It
                will fetch the metric values, visualize them on a graph
                alongside the long transaction frequency, and give you the
                answer.
              </p>
              <p>
                Our software both runs code and invokes API calls; the interplay
                between these is nontrivial to design and a fertile ground for
                innovation. There are “textbook” solutions to let agents write
                and run code (open sourced by, for example, Open Interpreter),
                and also to invoke tools/APIs (for example, Gorilla). But doing
                both together is harder, and yet required. We welcome your
                thoughts on this!
              </p>
              <p>
                If you want to see other integrations, or have ideas for
                features, or you’ve spotted behaviors that seem off - we’d love
                to hear. Hit us up in the comments!
              </p>
            </div>
          </section>
        </section>
        <section id="37753442">
          <h3>
            <a class="item" href="https://github.com/google/graph-mining"
              >Graph Mining Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 15:46:07</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37753442"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37752632">
          <h3>
            <a
              class="item"
              href="https://github.com/vitoplantamura/OnnxStream/tree/846da873570a737b49154e8f835704264864b0fe"
              >Running Stable Diffusion XL 1.0 in 298MB of RAM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 14:43:10</span
              ><span class="points-container"
                >Points: <span class="points">344</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37752632"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37752622">
          <h3>
            <a class="item" href="https://lethain.com/building-prestige/"
              >Building Personal and Organizational Prestige</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 14:42:19</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37752622"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37752406">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2023/10/03/sam-bankman-fried-criminal-trial-starts-today-heres-whats-at-stake.html"
              >$8B Sam Bankman-Fried criminal trial starts today</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 14:24:16</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37752406"
                  >Comments</a
                ><span class="descendants">: 151</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37752366">
          <h3>
            <a
              class="item"
              href="https://xata.io/blog/pgroll-schema-migrations-postgres"
              >Pgroll: zero-downtime, reversible schema migrations for
              Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 14:20:56</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37752366"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37751311">
          <h3>
            <a class="item" href="https://github.com/orhun/daktilo"
              >Daktilo: Turn Your Keyboard into a Typewriter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 13:05:40</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37751311"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37751140">
          <h3>
            <a
              class="item"
              href="https://www.fox2detroit.com/news/detroit-man-steals-800-gallons-using-bluetooth-to-hack-gas-pumps-at-station"
              >Detroit man steals 800 gallons using Bluetooth to hack gas pumps
              at station</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 12:47:37</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37751140"
                  >Comments</a
                ><span class="descendants">: 343</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37751041">
          <h3>
            <a class="item" href="https://leporello.tech"
              >Show HN: Leporello.js – interactive functional programming IDE
              for JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 12:36:45</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37751041"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                It records an IO trace of your program, which is then
                transparently replayed during subsequent program executions.
                This allows you to instantly reexecute your code after making
                small tweaks, thereby tightening your feedback loop.
              </p>
              <p>
                Furthermore, Leporello.js can serve as an interactive notebook.
                You have the flexibility to utilize any JavaScript libraries to
                visualize your data directly within your code.
              </p>
              <p>
                For a more detailed walkthrough, please watch the product video.
                Currently, Leporello.js is available as a free online
                application that you can try right in your browser. My goal is
                to build the Leporello.js standalone Electron app and a VSCode
                plugin, both with TypeScript support. Additionally, I plan to
                add Node.js support (currently, Leporello.js is only for HTML5
                apps). In the VSCode plugin, Leporello.js will sit on top of the
                built-in TypeScript/JavaScript mode, utilizing its code analysis
                information to enhance the default VSCode experience with unique
                Leporello.js features.
              </p>
              <p>
                I am building Leporello.js as a single independent developer.
                Leporello.js is funded solely by donations. Support me on Github
                Sponsors [0] and be the first to gain access to the Leporello.js
                Visual Studio Code plugin with TypeScript support.
              </p>
              <p>I'll be delighted to answer any questions you may have.</p>
              <p>
                [0]
                <a href="https://github.com/sponsors/leporello-js"
                  >https://github.com/sponsors/leporello-js</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37750982">
          <h3>
            <a
              class="item"
              href="https://joshua.hu/gaining-root-with-logrotate-sudo-ubuntu"
              >root with a single command: sudo logrotate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 12:31:28</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37750982"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37750859">
          <h3>
            <a
              class="item"
              href="https://serce.me/posts/02-10-2023-hey-computer-make-me-a-font"
              >Hey, Computer, Make Me a Font</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 12:17:33</span
              ><span class="points-container"
                >Points: <span class="points">214</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37750859"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37750763">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37750763"
              >Show HN: Trigger.dev V2 – a Temporal alternative for TypeScript
              devs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 12:07:19</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37750763"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
            <div class="text">
              <a href="https://news.ycombinator.com/item?id=34610686"
                >https://news.ycombinator.com/item?id=34610686</a
              >). This was v1 of Trigger.dev.
              <p>
                During the months since, we’ve gathered a lot of feedback from
                early users and realized that what developers actually wanted
                was more like an easier-to-use Temporal with integrations.
              </p>
              <p>Here’s what we’ve learned so far:</p>
              <p>
                - Serverless timeouts make it hard for anyone to write reliable
                background jobs. So our current product makes that easy for
                Next.js and other full-stack React frameworks. Long-running
                server support is coming soon.
              </p>
              <p>
                - We simplified the architecture to make it far easier to
                self-host. This was the most common comment in our previous Show
                HN.
              </p>
              <p>
                - We made it much easier to contribute to. You can now add new
                API integrations for any service we don’t already support.
                Either publicly (we appreciate PRs) or privately in your
                existing codebase.
              </p>
              <p>
                We’re open about what we’re building (<a
                  href="https://trigger.dev/changelog"
                  >https://trigger.dev/changelog</a
                >) and what we’re planning on doing next (<a
                  href="https://trigger.dev#roadmap"
                  >https://trigger.dev#roadmap</a
                >) as we believe community feedback ensures that we’re solving
                real problems.
              </p>
              <p>So here’s where we’re at, and where we’re headed:</p>
              <p></p>
              <pre><code>  [x] Easy self-hosting.
  
  [x] Serverless. Long-running Jobs on your serverless backend.
  
  [x] Integration kit. Build your own integrations, or use ours.
  
  [x] Bring-Your-Own-Auth. You can now authenticate integrations as your users.
  
  [x] Dashboard. View every Task in every Run.
  
  [x] Cloud service. No deployment required.
  
  [x] React hooks. Easily update your UI with Job progress.
  
  [x] React frameworks. Support for Next.js, Astro, Remix, Express.
  
  [ ] More frameworks. Support for SvelteKit, Nuxt.js, Fastify, Redwood.
  
  [ ] Background functions. Offload long or intense tasks to our infrastructure.
  
  [ ] Long-running servers. Use Trigger.dev from your long-running backend.
  
  [ ] Polling Triggers. Subscribe to changes without webhooks.
  
  [ ] And lots more…
</code></pre>
              I’d love to hear your thoughts on background jobs. Have we missed
              anything off the list? What should we be building next?
              <p>
                <a href="https://github.com/triggerdotdev/trigger.dev"
                  >https://github.com/triggerdotdev/trigger.dev</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37744627">
          <h3>
            <a
              class="item"
              href="https://worldhistory.substack.com/p/faces-of-death"
              >Faces of Death: Ancient Burial Masks, from Egypt to Peru</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 21:25:19</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37744627"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37741254">
          <h3>
            <a
              class="item"
              href="https://www.philipsteadman.com/blog/greek-temples-made-of-wood/"
              >Greek Temples Made of Wood</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 17:13:50</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37741254"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37738543">
          <h3>
            <a
              class="item"
              href="https://themarkup.org/prediction-bias/2023/10/02/predictive-policing-software-terrible-at-predicting-crimes"
              >Predictive policing software terrible at predicting crimes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 14:24:44</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37738543"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37736853">
          <h3>
            <a
              class="item"
              href="https://erikwernquist.com/one-revolution-per-minute"
              >One Revolution per Minute [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 11:35:09</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37736853"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37736205">
          <h3>
            <a
              class="item"
              href="https://nautil.us/the-worlds-first-known-deep-sea-octopus-nursery-401656/"
              >Deep-Sea Octopus Nursery</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 10:15:37</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37736205"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37734741">
          <h3>
            <a
              class="item"
              href="https://www.ianvisits.co.uk/articles/the-short-lived-experiment-with-rubber-tires-on-railways-9831/"
              >The short-lived experiment with rubber tires on railways
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 06:48:11</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37734741"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37734460">
          <h3>
            <a
              class="item"
              href="https://forums.autodesk.com/t5/engineering-hub-blog/autodesk-and-outerbounds-partner-to-open-source-ray-and-hpc/ba-p/12254816"
              >HPC at Autodesk</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 05:57:25</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37734460"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
