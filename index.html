<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44502957">
          <h3>
            <a
              class="item"
              href="https://www.tennessean.com/story/travel/2025/07/08/tsa-shoe-removal-policy-tennessee-airports-phase-out/84506399007/"
              >TSA expected to phase out shoe removal policy at airport
              security</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 19:02:43</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44502957"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44502850">
          <h3>
            <a class="item" href="https://github.com/sdrapkin/guid"
              >Fast cryptographically safe GUID generator for Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 18:48:06</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44502850"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44502722">
          <h3>
            <a class="item" href="https://archive.org/details/Brainwash72"
              >Brainwash '72 [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 18:34:08</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44502722"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44502527">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2507.01826"
              >Dynamical origin of Theia, the last giant impactor on Earth</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 18:10:46</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44502527"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44502463">
          <h3>
            <a
              class="item"
              href="https://naildrivin5.com/blog/2025/07/08/brut-a-new-web-framework-for-ruby.html"
              >Brut: A New Web Framework for Ruby</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 18:03:20</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44502463"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44502330">
          <h3>
            <a
              class="item"
              href="https://dgl.cx/2025/07/git-clone-submodule-cve-2025-48384"
              >CVE-2025-48384: Breaking Git with a carriage return and cloning
              RCE</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 17:48:29</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44502330"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44502318">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2025/Jul/6/supabase-mcp-lethal-trifecta/"
              >Supabase MCP leaks your entire SQL Database, a lethal trifecta
              attack</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 17:46:55</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44502318"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44502298">
          <h3>
            <a class="item" href="http://users.notam02.no/~kjetism/radium/"
              >Radium – The Music Editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 17:44:35</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44502298"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44501821">
          <h3>
            <a class="item" href="https://mips.com/press-releases/gf-mips/"
              >GlobalFoundries to Acquire MIPS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 16:57:18</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44501821"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44501413">
          <h3>
            <a class="item" href="https://huggingface.co/blog/smollm3"
              >Smollm3: Smol, multilingual, long-context reasoner LLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 16:13:40</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44501413"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44501379">
          <h3>
            <a
              class="item"
              href="https://www.neowin.net/guides/google-can-now-read-your-whatsapp-messages-heres-how-to-stop-it/"
              >Google can now read your WhatsApp messages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 16:11:20</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44501379"
                  >Comments</a
                ><span class="descendants">: 188</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44500840">
          <h3>
            <a class="item" href="https://www.jukeboxhq.com/"
              >Show HN: Jukebox – Free, Open Source Group Playlist with Fair
              Queueing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 15:18:49</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44500840"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built Jukebox because I got frustrated with group music apps
                and Spotify’s limitations (not everyone has Spotify, and
                collaborative playlists are still too easily dominated by one
                person). Jukebox is a web app that lets you create a group
                queue—anyone can join via link, add YouTube songs, and the
                system automatically rotates songs so everyone gets a fair turn
                (no more playlist hogs).
              </p>
              <p>Web-based, no accounts, no installs.</p>
              <p>Drop in a YouTube link or search and add music instantly.</p>
              <p>
                Songs rotate in round-robin order (so even if one person adds
                ten songs, nobody else is skipped).
              </p>
              <p>
                Entirely open source (MIT), self-hostable with Docker,
                privacy-friendly.
              </p>
              <p>
                Live demo:
                <a href="https://jukeboxhq.com">https://jukeboxhq.com</a>
              </p>
              <p>
                Code:
                <a href="https://github.com/skeptrunedev/jukebox"
                  >https://github.com/skeptrunedev/jukebox</a
                >
              </p>
              <p>
                I made this as a stress-relief project while pivoting my actual
                startup (Trieve) and used it to practice UI/UX (neo-brutalist
                design, drag-and-drop), plus experiment with AI pair coding.
              </p>
              <p>Would love your feedback or feature ideas!</p>
            </div>
          </section>
        </section>
        <section id="44500066">
          <h3>
            <a class="item" href="https://aboveaverageuser.com/smartswitcher"
              >Show HN: I built a tool to solve window management</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 14:01:42</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44500066"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built this because I couldn't find a window
                switching/management solution that worked for me. I tried all
                kinds of different solutions, virtual desktop extensions,
                obscure GUI window managers, you name it. Overtime I realized I
                wanted something that prioritizes one window at a time, is
                keyboard driven with has minimal if no GUI elements. I figured
                this part out, but knew something was missing. I had my eureka
                moment when I realized I could combine my switching method with
                a prediction algorithm. This led to the creation of Smart
                Switcher.
              </p>
              <p>
                Smart Switcher is a data driven window switcher aimed at
                improving the overall window switching experience. It logs data
                on your windows switching, then a prediction algorithm analyzes
                this data and uses it to predict which window you would want to
                switch to next. When you need to switch windows, you press the
                switch shortcut to switch to the next predicted window. If this
                isn't the window you wanted, press the override shortcut to
                switch to the next most likely window. You can press the
                override shortcut as many times as needed until you arrive at
                your desired window.
              </p>
              <p>
                It’s a paid app with a demo and trial version. There is a
                introductory discount and some additional discount tiers for
                early adopters.
              </p>
              <p>Any feedback is appreciated! Thanks!</p>
            </div>
          </section>
        </section>
        <section id="44499860">
          <h3>
            <a class="item" href="https://nuxtlabs.com/"
              >NuxtLabs is joining Vercel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 13:40:12</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44499860"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44499183">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/attimet/jobs/6LaQIc5-founding-researcher-quant"
              >Attimet (YC F24) – Quant Trading Research Lab – Is Hiring
              Founding Researcher</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 12:00:53</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44499057">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/07/08/firefox_isnt_dead/"
              >Firefox is fine. The people running it are not</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 11:35:27</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44499057"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44498296">
          <h3>
            <a class="item" href="https://offchess.com"
              >Show HN: OffChess – Offline chess puzzles app</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 08:57:01</span
              ><span class="points-container"
                >Points: <span class="points">260</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44498296"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm the developer of rdx, a mildly popular ad-free, privacy and
                user friendly Reddit client. This time, I made something for a
                very specific use case: solving chess puzzles with no internet.
              </p>
              <p>
                Why? Well, my Wi-Fi is terrible in the bathroom—and that's where
                I do some of my best thinking. I tried printing out “mate in X”
                puzzles to solve offline, but they weren’t fun without
                interaction. So I built OffChess.
              </p>
              <p>
                OffChess is an iPhone/Android app that contains over 100,000
                chess puzzles, fully offline and completely ad-free. You can
                solve puzzles by category (Mate in 1/2/3/4/5, tactics like
                pins/forks/skewers, or openings like Sicilian/French, etc). You
                gain or lose points based on how you perform, so there's a light
                rating system to keep things engaging.
              </p>
              <p>
                No accounts, no tracking, no monthly subscriptions, no internet
                required. Just pure, old-school tactical chess training,
                wherever you are.
              </p>
              <p>
                You can check out the iPhone/iPad app at
                <a
                  href="https://apps.apple.com/us/app/chess-puzzles-offchess/id6744736661?platform=iphone"
                  >https://apps.apple.com/us/app/chess-puzzles-offchess/id67447...</a
                >
                or the Android app at
                <a
                  href="https://play.google.com/store/apps/details?id=com.offchess"
                  >https://play.google.com/store/apps/details?id=com.offchess</a
                >
              </p>
              <p>Would love feedback, bug reports, or suggestions.</p>
              <p>Thanks!</p>
            </div>
          </section>
        </section>
        <section id="44498133">
          <h3>
            <a class="item" href="https://koaning.io/posts/svg-gifs/"
              >TIL you can make "GIFs" with SVGs for GitHub README.md files</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-08 @ 08:23:05</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44498133"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44493196">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/new-sphere-packing-record-stems-from-an-unexpected-source-20250707/"
              >New sphere-packing record stems from an unexpected source</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-07 @ 18:19:13</span
              ><span class="points-container"
                >Points: <span class="points">391</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44493196"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44489803">
          <h3>
            <a
              class="item"
              href="https://noperator.dev/posts/o3-pocket-profile/"
              >I used o3 to profile myself from my saved Pocket links</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-07 @ 12:44:19</span
              ><span class="points-container"
                >Points: <span class="points">478</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44489803"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44489690">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2506.17298"
              >Mercury: Ultra-fast language models based on diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-07 @ 12:31:08</span
              ><span class="points-container"
                >Points: <span class="points">538</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44489690"
                  >Comments</a
                ><span class="descendants">: 220</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44472812">
          <h3>
            <a class="item" href="https://ceramic-engine.com/"
              >Ceramic: A cross-platform and open-source 2D framework in Haxe</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-05 @ 13:52:31</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44472812"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44472246">
          <h3>
            <a class="item" href="https://berry-lang.github.io/"
              >Berry Script: lightweight embedded scripting language for
              microcontrollers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-05 @ 12:13:50</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44472246"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44472036">
          <h3>
            <a
              class="item"
              href="https://alicemaz.substack.com/p/on-the-meaning-of-ritual"
              >On The Meaning of Ritual</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-05 @ 11:40:43</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44472036"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44470447">
          <h3>
            <a
              class="item"
              href="https://www.craftlinks.art/Notebook/particle-lenia/"
              >Particle Lenia Deluxe Edition</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-05 @ 06:08:36</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44470447"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44468022">
          <h3>
            <a class="item" href="https://github.com/surban/memstop"
              >Memstop: Use LD_PRELOAD to delay process execution when low on
              memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 21:32:16</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44468022"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44467607">
          <h3>
            <a class="item" href="https://github.com/jb55/oot_bitset"
              >A compact bitset implementation used in Ocarina of Time save
              files</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 20:25:43</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44467607"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44466030">
          <h3>
            <a
              class="item"
              href="https://flak.tedunangst.com/post/can-an-email-go-500-miles-in-2025"
              >Can an email go 500 miles in 2025?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 16:49:27</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44466030"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44464628">
          <h3>
            <a
              class="item"
              href="https://macwright.com/2025/07/03/epanet-placemark"
              >Epanet-JS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 13:57:19</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44464628"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44455707">
          <h3>
            <a
              class="item"
              href="https://ericdaigle.ca/posts/taking-over-60k-spyware-user-accounts/"
              >Taking over 60k spyware user accounts with SQL injection</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-03 @ 14:56:00</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44455707"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
