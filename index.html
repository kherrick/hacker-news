<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44021028">
          <h3>
            <a
              class="item"
              href="https://www.jefftk.com/p/google-logo-ligature-bug"
              >Google Logo Ligature Bug</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 12:51:17</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44021028"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44020975">
          <h3>
            <a
              class="item"
              href="https://www.filibeto.org/aduritz/truetrue/e10000/how-e10k-wasborn.html"
              >How the Sun Enterprise 10000 was born (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 12:43:01</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44020975"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44020855">
          <h3>
            <a class="item" href="https://text.npr.org/nx-s1-5371490"
              >Why some friendships end after kids come into the picture</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 12:26:42</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44020855"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44020626">
          <h3>
            <a class="item" href="https://github.com/parsaghaffari/browserbee"
              >Show HN: A web browser agent in your Chrome side panel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 11:48:42</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44020626"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm excited to share BrowserBee, a privacy-first AI assistant in
                your browser that allows you to run and automate tasks using
                your LLM of choice (currently supports Anthropic, OpenAI,
                Gemini, and Ollama). Short demo here:
                <a
                  href="https://github.com/user-attachments/assets/209c7042-6d54-4fce-92a7-ddf8519156c6"
                  >https://github.com/user-attachments/assets/209c7042-6d54-4fc...</a
                >
              </p>
              <p>
                Inspired by projects like Browser Use and Playwright MCP, its
                main advantage is the browser extension form factor which makes
                it more convenient for day to day use, especially for less
                technical users. Its also a bit less cumbersome to use on
                websites that require you to be logged in, as it attaches to the
                same browser instance you use (on privacy: the only data that
                leaves your browser is the communication with the LLM - there is
                no tracking or data collection of any sort).
              </p>
              <p>Some of its core features are as follows:</p>
              <p>
                - a memory feature which allows users to memorize common and
                useful pathways, making the next repetition of those tasks
                faster and cheaper
              </p>
              <p>
                - real-time token counting and cost tracking (inspired by Cline)
              </p>
              <p>
                - an approval flow for critical tasks such as posting content or
                making payments (also inspired by Cline)
              </p>
              <p>
                - tab management allowing the agent to execute tasks across
                multiple tabs
              </p>
              <p>
                - a range of browser tools for navigation, tab management,
                interactions, etc, which are broadly in line with Playwright MCP
              </p>
              <p>
                I'm actively developing BrowserBee and would love to hear any
                thoughts, comments, or feedback.
              </p>
              <p>
                Feel free to reach out via email: parsa.ghaffari [at] gmail
                [dot] com
              </p>
              <p>-Parsa</p>
            </div>
          </section>
        </section>
        <section id="44020591">
          <h3>
            <a class="item" href="https://domenic.me/fsrs/"
              >Spaced repetition systems have gotten way better</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 11:42:19</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44020591"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44020574">
          <h3>
            <a
              class="item"
              href="https://www.nan.usace.army.mil/portals/37/docs/history/hellgate.pdf"
              >The Conquest of Hell Gate [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 11:39:07</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44020574"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44020315">
          <h3>
            <a class="item" href="https://cutfoldtemplates.com"
              >Paper Mechanisms</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 10:25:54</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44020315"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44020019">
          <h3>
            <a class="item" href="https://www.lucidapogee.com/?page=craftbasic"
              >Craft Basic (Windows 95 and up)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 09:08:11</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44020019"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44019386">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/us-news/2025/may/18/mexican-navy-ship-hits-brooklyn-bridge-during-promotional-tour"
              >Mexican Navy ship crashes into Brooklyn Bridge leaving two people
              dead</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 06:23:59</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44019386"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44018886">
          <h3>
            <a class="item" href="https://app.camelai.com/log-in?next=/hn/"
              >Show HN: Chat with 19 years of HN</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 03:52:15</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44018886"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                We loaded a BigQuery dataset of all of Hacker News, every
                comment, story and user, into camelAI.
              </p>
              <p>You can ask questions like:</p>
              <p>• “When does dang tend to comment during the day?”</p>
              <p>
                • “Which domains have gained the most submissions since 2015,
                year-over-year?”
              </p>
              <p>
                • “How has average comment length changed each January since
                2007?”
              </p>
              <p>• “Top five users who link to arXiv papers the most.”</p>
              <p>
                It's behind a log-in to prevent abuse but free to use for 10
                messages. No payment info required. We use OpenAI o3 or Claude
                sonnet 3.7 for the agent which can be really expensive.
              </p>
              <p>
                Would love feedback especially around graph/chart quality and o3
                vs sonnet.
              </p>
            </div>
          </section>
        </section>
        <section id="44018301">
          <h3>
            <a class="item" href="https://boydkane.com/essays/experts"
              >Experts have it easy (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 01:31:24</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44018301"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44018283">
          <h3>
            <a class="item" href="https://apps.dtic.mil/sti/pdfs/ADA507172.pdf"
              >Memetics – A Growth Industry in US Military Operations (2006)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 01:26:08</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44018283"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44017913">
          <h3>
            <a class="item" href="https://komiko.app/video/AniSora"
              >AniSora: Open-source anime video generation model</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 23:59:03</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44017913"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44016564">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2407.12034"
              >Understanding Transformers via N-gram Statistics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 19:56:00</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44016564"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44016037">
          <h3>
            <a
              class="item"
              href="https://suberic.net/~dmm/projects/mystical/README.html"
              >Mystical</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 18:21:18</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44016037"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44015872">
          <h3>
            <a
              class="item"
              href="https://johncarlosbaez.wordpress.com/2025/05/17/dead-stars-dont-radiate-and-shrink/"
              >Dead Stars Don’t Radiate</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 17:54:20</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44015872"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44015367">
          <h3>
            <a class="item" href="https://webkit.org/blog/16929/contrast-color/"
              >How to have the browser pick a contrasting color in CSS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 16:26:44</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44015367"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44015144">
          <h3>
            <a
              class="item"
              href="https://tadaima.bearblog.dev/if-nothing-is-curated-how-do-we-find-things/"
              >If nothing is curated, how do we find things</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 15:51:05</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44015144"
                  >Comments</a
                ><span class="descendants">: 191</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44014587">
          <h3>
            <a
              class="item"
              href="https://30fps.net/pages/palette-lighting-tricks-n64/"
              >Palette lighting tricks on the Nintendo 64</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 14:28:59</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44014587"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44014046">
          <h3>
            <a
              class="item"
              href="https://mastdatabase.co.uk/blog/2025/05/o2-expose-customer-location-call-4g/"
              >O2 VoLTE: locating any customer with a phone call</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-17 @ 13:08:29</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44014046"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43998341">
          <h3>
            <a class="item" href="https://github.com/pixeltable/pixelagent"
              >Show HN: Pixelagent – Build your Stateful Agent Framework in 200
              lines of code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-15 @ 19:17:23</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43998341"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43994190">
          <h3>
            <a
              class="item"
              href="https://leetarxiv.substack.com/p/counting-integer-compositions"
              >What Every Programmer Should Know About Enumerative
              Combinatorics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-15 @ 12:10:30</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43994190"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43993707">
          <h3>
            <a
              class="item"
              href="https://microsoft.github.io/verona/pyrona.html"
              >Project Verona: Fearless Concurrency for Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-15 @ 10:58:09</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43993707"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43991221">
          <h3>
            <a
              class="item"
              href="https://medium.com/@greptime/how-to-supercharge-your-java-project-with-rust-a-practical-guide-to-jni-integration-with-a-86f60e9708b8"
              >Lessons from Mixing Rust and Java: Fast, Safe, and Practical</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-15 @ 02:18:34</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43991221"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43988975">
          <h3>
            <a
              class="item"
              href="https://raymii.org/s/tutorials/High_Available_Mosquitto_MQTT_Broker_on_Kubernetes.html"
              >High Available Mosquitto MQTT on Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-14 @ 20:42:36</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43988975"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43987367">
          <h3>
            <a class="item" href="https://workflows.diagrid.io/"
              >Show HN: Turn any workflow diagram into compilable, running and
              stateful code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-14 @ 17:52:10</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43987367"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              Hi HN folks, I'm a co-creator of the Dapr CNCF project and
              co-founder of Diagrid. Today we announced a free-to-use web app
              that takes any form of workflow diagram (UML, BPMN, scribble in
              your favorite drawing tool or even on paper) and generates code
              that runs in any IDE and that can be deployed to Kubernetes and
              other container based systems, based on Dapr's durable execution
              workflow engine. This essentially allows you to run durable
              workflows in minutes and leaves out the guesswork for how to
              structure, code and optimize a code-first workflow app. I'm happy
              for you to give this a try and provide feedback!
            </div>
          </section>
        </section>
        <section id="43986821">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-025-01515-z"
              >Mice grow bigger brains when given this stretch of human DNA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-14 @ 17:04:00</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43986821"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43985513">
          <h3>
            <a
              class="item"
              href="https://holdtherobot.com/blog/2025/05/11/linux-on-android-with-ar-glasses/"
              >Coding without a laptop: Two weeks with AR glasses and Linux on
              Android</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-14 @ 15:11:57</span
              ><span class="points-container"
                >Points: <span class="points">804</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43985513"
                  >Comments</a
                ><span class="descendants">: 301</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43984770">
          <h3>
            <a class="item" href="https://github.com/espanso/espanso"
              >Espanso – Cross-Platform Text Expander Written in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-14 @ 14:11:46</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43984770"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43982495">
          <h3>
            <a
              class="item"
              href="https://www.nextplatform.com/2025/05/12/armv9-architecture-helps-lift-arm-to-new-financial-heights/"
              >ARMv9 Architecture Helps Lift Arm to New Financial Heights</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-14 @ 09:11:47</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43982495"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
