<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36497019">
          <h3>
            <a
              class="item"
              href="https://www.flux.ai/p/blog/generative-ai-for-hardware-design"
              >Show HN: Flux Copilot – Generative AI for hardware design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 18:43:47</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36497019"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36496583">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/opinion/articles/2023-06-27/silicon-valley-is-on-drugs"
              >Silicon Valley Is on Drugs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 18:10:38</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36496583"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36496102">
          <h3>
            <a
              class="item"
              href="https://www.docker.com/blog/mutagen-acquisition/"
              >Docker Acquires Mutagen</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 17:31:52</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36496102"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36495943">
          <h3>
            <a class="item" href="https://wiki.gentoo.org/wiki/OpenRC"
              >OpenRC is a dependency-based init system for Unix-like systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 17:18:37</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36495943"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36495931">
          <h3>
            <a
              class="item"
              href="https://www.influxdata.com/blog/influxdb-3-0-system-architecture/"
              >InfluxDB 3.0 System Architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 17:17:37</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36495931"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36495782">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/news/tsmc-expected-to-charge-25000usd-per-2nm-wafer"
              >TSMC Expected to Charge $25,000 per 2nm Wafer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 17:07:48</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36495782"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36495740">
          <h3>
            <a class="item" href="https://store.arduino.cc/pages/uno-r4"
              >Arduino Uno R4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 17:04:54</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36495740"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36495680">
          <h3>
            <a
              class="item"
              href="https://www.superblocks.com/blog/introducing-superblocks-ai"
              >Show HN: Superblocks AI – AI coding assistant for internal
              apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 17:00:31</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36495680"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today we launched Superblocks AI and are excited to hear
                feedback from the HN community!
              </p>
              <p>
                Superblocks AI combines the power of the Superblocks
                drag-and-drop App Builder with robust AI code generation, code
                optimization, code explanation, mock data generation, and API
                call generation across SQL, Python, JavaScript, JSON and HTML.
              </p>
              <p>
                We built Superblocks AI with the intention to streamline some of
                the repetitive and often confusing aspects of building internal
                tools, here’s a brief overview:
              </p>
              <p>
                Generate Code: LLMs like ChatGPT have quickly become a critical
                part of developers' lives and we wanted to bring that experience
                natively into our product. The response is streamed for the best
                UX, similar to Chat-GPT, and can be modified before use.
              </p>
              <p>
                Explain Code: Understanding someone else’s code for large
                internal engineering teams is often a challenge. Highlight code
                and Superblocks AI offers an explanation that you then have the
                ability to add as a comment.
              </p>
              <p>
                Edit Code: You can make alterations to code by highlighting it
                and choosing prompts like optimize performance, enhance
                readability, or something custom. We've added an inline code
                diff view for easy verification of changes.
              </p>
              <p>
                Generate API Calls: You often want to make an API call but need
                to spend 30 minutes looking up the documentation and crafting
                the correct call in Postman. We provided a way for you to give a
                prompt, and Superblocks AI will generate REST and GraphQL
                queries for APIs like Stripe, Salesforce, your favorite SaaS
                provider, and more.
              </p>
              <p>
                Generate Mock Data: This enables faster UI development by
                generating mock data for components like tables, charts, grids
                etc., which can be especially handy during prototyping.
              </p>
              <p>
                I'd love to hear feedback from the HN community on how you think
                this feature should evolve over the next few months!
              </p>
            </div>
          </section>
        </section>
        <section id="36495676">
          <h3>
            <a
              class="item"
              href="https://questdb.io/careers/technical-content-lead/"
              >QuestDB (YC S20) Is Hiring a Technical Content Lead</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 17:00:18</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36495667">
          <h3>
            <a
              class="item"
              href="https://opensource.googleblog.com/2023/06/rust-fact-vs-fiction-5-insights-from-googles-rust-journey-2022.html"
              >Rust fact vs. fiction: 5 Insights from Google's Rust journey in
              2022</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 17:00:05</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36495667"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36495335">
          <h3>
            <a
              class="item"
              href="https://martinfowler.com/articles/patterns-of-distributed-systems/"
              >Patterns of Distributed Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 16:43:12</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36495335"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36494966">
          <h3>
            <a
              class="item"
              href="https://www.caltech.edu/about/news/new-bioinspired-robot-flies-rolls-walks-and-more"
              >Caltech M4 Robot Flies, Rolls, Walks, and More</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 16:19:58</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36494966"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36494935">
          <h3>
            <a class="item" href="https://zellij.dev/news/new-plugin-system/"
              >Zellij New WASM Plugin System</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 16:17:40</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36494935"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36494639">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36494639"
              >Launch HN: Fuse (YC W19) – Unified API for financial data
              aggregators</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 15:56:41</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36494639"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.letsfuse.com/">https://www.letsfuse.com/</a
              >). We offer a single integration to multiple financial data
              aggregators and automatically select the most reliable one for
              each institution. Here’s a quick demo:
              <a href="https://youtu.be/w7sNHGav0Fg"
                >https://youtu.be/w7sNHGav0Fg</a
              >
              <p>
                If you're building a product that requires customers to link
                their financial accounts, you might integrate a financial data
                aggregator (such as Plaid, Truelayer, or Finicity) to connect
                with your user's bank account. You’ll probably then experience
                the following issues: customers unable to use your product
                because their financial institution is not supported (e.g.,
                credit unions, local or community banks); frequent
                disconnections; API errors; and high drop-offs during the bank
                linking flow.
              </p>
              <p>
                We spent 2.5 years developing YSplit, a fintech app providing
                joint spending cards for couples. Users linked their bank
                accounts for spend limits but faced issues with unsupported
                banks and frequent disconnections. We looked at other apps and
                saw that the ideal solution was to rely on multiple aggregators,
                but it wasn’t the right use of engineering resources for that
                startup. Upon pivoting from YSplit, though, we decided to go
                back to that problem and address it.
              </p>
              <p>
                We provide a UI component for React, React Native, Flutter, iOS
                &amp; Android native to facilitate bank account linkage within
                your app. When a user taps on an institution, we use a time
                series model to identify the most optimal aggregator to show
                based on historical success rates and disconnection as well as
                downtime. After linkage, we provide a Fuse access token for
                querying balance, transactions, and more via our unified API,
                offering a consistent model irrespective of the aggregator.
              </p>
              <p>
                We also provide other products to translate historical bank data
                into consumer/business credit risk to help you answer questions
                like: How much credit can I feel comfortable offering this user
                or company? Is a user likely to pay me on time? Can I offer
                instant ACH to this customer?
              </p>
              <p>
                By combining aggregators, you gain from their diverse connection
                methods, favoring APIs over screen scraping. Our customers have
                cut disconnections by 16%, increased coverage by 5k institutions
                in the US, and boosted conversions by 20% with Fuse. Moreover,
                we support aggregators in Africa, Europe, South America,
                Australia, and Asia, enabling global product expansion with a
                single API.
              </p>
              <p>
                We don't store personal info and only act as a pass-through. We
                are currently undergoing SOC 2 II audit and can provide
                engagement letters for anyone looking to go to production.
              </p>
              <p>
                We have a self-serve onboarding
                <a href="https://dashboard.letsfuse.com"
                  >https://dashboard.letsfuse.com</a
                >
                to get sandbox keys. Our docs are available here
                <a href="https://docs.letsfuse.com">https://docs.letsfuse.com</a
                >. We’d love for you to try it and give us feedback on
                improvements to the product and docs. If you have any feature
                requests or any aggregators you’d like us to support, let us
                know.
              </p>
            </div>
          </section>
        </section>
        <section id="36494308">
          <h3>
            <a
              class="item"
              href="https://www.blender.org/download/releases/3-6/"
              >Blender 3.6 LTS Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 15:30:47</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36494308"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36494046">
          <h3>
            <a class="item" href="https://www.metaculus.com/ai/"
              >The future of AI according to thousands of forecasters</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 15:13:38</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36494046"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36493715">
          <h3>
            <a class="item" href="https://neal.fun/password-game/"
              >The Password Game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 14:51:22</span
              ><span class="points-container"
                >Points: <span class="points">326</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36493715"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36493422">
          <h3>
            <a class="item" href="https://thesloth.me/posts/5/"
              >I Built Linux from Scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 14:33:25</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36493422"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492975">
          <h3>
            <a
              class="item"
              href="https://changelog.com/posts/still-no-silver-bullet"
              >There's still no silver bullet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 14:06:24</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492975"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492384">
          <h3>
            <a class="item" href="http://book.mixu.net/distsys/single-page.html"
              >Distributed Systems for Fun and Profit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 13:25:59</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492384"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492329">
          <h3>
            <a
              class="item"
              href="https://support.microsoft.com/en-us/topic/outlook-emails-open-next-to-web-links-in-microsoft-edge-b0e1a1c1-bd62-462c-9ed5-5938b9c649f0"
              >Outlook now ignores Windows' Default Browser and opens links in
              Edge by default</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 13:21:30</span
              ><span class="points-container"
                >Points: <span class="points">563</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492329"
                  >Comments</a
                ><span class="descendants">: 392</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492010">
          <h3>
            <a
              class="item"
              href="https://www.thedrive.com/news/fedex-accused-of-largest-odometer-rollback-fraud-in-history-with-used-vans"
              >FedEx Accused of Largest Odometer Rollback Fraud in History with
              Used Vans</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 12:49:17</span
              ><span class="points-container"
                >Points: <span class="points">354</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492010"
                  >Comments</a
                ><span class="descendants">: 222</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36491975">
          <h3>
            <a class="item" href="https://github.com/billabear/billabear"
              >Show HN: BillaBear – Self-Hosted SaaS Subscription Management and
              Billing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 12:46:01</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36491975"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36491704">
          <h3>
            <a class="item" href="https://saurabhs.org/advanced-macos-commands"
              >macOS command-line tools you might not know about</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 12:08:38</span
              ><span class="points-container"
                >Points: <span class="points">1098</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36491704"
                  >Comments</a
                ><span class="descendants">: 297</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36491514">
          <h3>
            <a class="item" href="https://neal.fun/deep-sea/"
              >The Deep Sea (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 11:39:56</span
              ><span class="points-container"
                >Points: <span class="points">333</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36491514"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36491338">
          <h3>
            <a class="item" href="https://www.tinc-vpn.org/"
              >Tinc, a GPLv2 mesh routing VPN</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 11:15:28</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36491338"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36486948">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2023/07/03/on-the-marble-cliffs-ernst-junger-book-review"
              >Ernst Jünger’s Narratives of Complicity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 22:54:34</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36486948"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36486907">
          <h3>
            <a
              class="item"
              href="https://www.thedial.world/issue-5/spain-sephardic-ancestry-citizenship-program"
              >Undoing the Alhambra Decree</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 22:49:39</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36486907"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36486109">
          <h3>
            <a
              class="item"
              href="https://cohost.org/mcc/post/325362-a-one-person-oral-hi"
              >A one-person oral history of Geocities HTML Chat (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 21:28:44</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36486109"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36469147">
          <h3>
            <a
              class="item"
              href="https://matduggan.com/were-all-doing-metrics-wrong/"
              >Monitoring Is a Pain</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-25 @ 15:20:13</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36469147"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
