<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44551109">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/food/article/data-deep-dives-bay-area-fine-dining-restaurants-20404434.php"
              >Bay Area restaurants are vetting your social media before you
              even walk in</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 15:30:29</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44551109"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44550572">
          <h3>
            <a
              class="item"
              href="https://www.makingsoftware.com/chapters/how-a-screen-works"
              >How does a screen even work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 14:09:06</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44550572"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44550450">
          <h3>
            <a
              class="item"
              href="https://hackacad.net/post/2025-07-12-local-chatbot-rag-with-freebsd-knowledge/"
              >Local Chatbot RAG with FreeBSD Knowledge</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 13:48:49</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44550450"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44550157">
          <h3>
            <a class="item" href="https://github.com/Exorust/TorchLeet"
              >Show HN: Learn LLMs LeetCode Style</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 13:03:13</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44550157"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44549145">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/mysterious-pre-islamic-script-oman-finally-deciphered"
              >The Decipherment of the Dhofari Script</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 10:25:18</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44549145"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44549134">
          <h3>
            <a
              class="item"
              href="https://thereader.mitpress.mit.edu/how-citizen-science-games-could-help-cure-disease/"
              >Gaming cancer: How citizen science games could help cure
              disease</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 10:23:38</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44549134"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44548906">
          <h3>
            <a
              class="item"
              href="https://muthuishere.medium.com/understanding-tool-function-calling-in-llms-step-by-step-examples-in-rest-and-spring-ai-2149ecd6b18b"
              >Understanding Tool Calling in LLMs – Step-by-Step with REST and
              Spring AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 09:44:47</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44548906"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44548610">
          <h3>
            <a
              class="item"
              href="https://discourse.mozilla.org/t/let-me-pay-for-firefox/141297"
              >Let me pay for Firefox</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 08:38:52</span
              ><span class="points-container"
                >Points: <span class="points">563</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44548610"
                  >Comments</a
                ><span class="descendants">: 426</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44548503">
          <h3>
            <a
              class="item"
              href="https://www.embedded.com/why-lua-beats-micropython-for-serious-embedded-devs"
              >Lua beats MicroPython for serious embedded devs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 08:16:02</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44548503"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44548353">
          <h3>
            <a
              class="item"
              href="https://mbh4h.substack.com/p/neuromancer-2025-review-william-gibson"
              >Reading Neuromancer for the first time in 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 07:48:44</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44548353"
                  >Comments</a
                ><span class="descendants">: 222</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44547089">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/culture/photo-booth/earths-poet-of-scale"
              >Edward Burtynsky's monumental chronicle of the human impact on
              the planet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 02:47:00</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44547089"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44546640">
          <h3>
            <a
              class="item"
              href="https://wiomoc.de/misc/posts/hacking_coroutines_into_c.html"
              >Hacking Coroutines into C</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 01:12:37</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44546640"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44546265">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44546265"
              >Show HN: ArchGW – an intelligent edge and service proxy for
              agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 23:55:39</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44546265"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                This is Adil, Salman and Jose and and we’re behind archgw [1].
                An intelligent proxy server designed as an edge and AI gateway
                for agents - one that natively know how to handle prompts, not
                just network traffic. We’ve made several sweeping changes so
                sharing the project again.
              </p>
              <p>
                A bit of background on why we’ve built this project. Building AI
                agent demos is easy, but to create something production-ready
                there is a lot of repeat low-level plumbing work that everyone
                is doing. You’re applying guardrails to make sure unsafe or
                off-topic requests don’t get through. You’re clarifying vague
                input so agents don’t make mistakes. You’re routing prompts to
                the right expert agent based on context or task type. You’re
                writing integration code to quickly and safely add support for
                new LLMs. And every time a new framework hits the market or is
                updated, you’re validating or re-implementing that same
                logic—again and again.
              </p>
              <p>
                Putting all the low-level plumbing code in a framework gets
                messy to manage, harder to update and scale. Low-level work
                isn't business logic. That’s why we built archgw - an
                intelligent proxy server that handles prompts during ingress and
                egress and offers several related capabilities from a single
                software service. It lives outside your app runtime, so you can
                keep your business logic clean and focus on what matters. Think
                of it like a service mesh, but for AI agents.
              </p>
              <p>
                Prior to building archgw, the team spent time building Envoy [2]
                at Lyft, API Gateway at AWS, specialized NLP models at Microsoft
                Research and worked on safety at Meta. archgw was born out of
                the belief that rule-based, single-purpose tools that handle the
                work around resiliency, processing and routing prompts should
                move into a dedicated infrastructure layer for agents, but built
                on the battle-tested foundational of Envoy Proxy.
              </p>
              <p>
                The intelligence in archgw comes from our fast Task-specific
                LLMs [3] that can handle things like agent routing and hand off,
                guardrails and preference-based intelligent LLM calling. Here
                are some additional details about the open source project.
                archgw is written in rust, and the request path has three main
                parts:
              </p>
              <p>
                * Listener subsystem which handles downstream (ingress) and
                upstream (egress) request processing. * Prompt handler
                subsystem. This is where archgw makes decisions on the safety of
                the incoming request via its prompt_guard hooks and identifies
                where to forward the conversation to via its prompt_target
                primitive. * Model serving subsystem is the interface that hosts
                all the lightweight LLMs engineered in archgw and offers a
                framework for things like hallucination detection of our these
                models
              </p>
              <p>
                We loved building this open source project, and our belief is
                that this infra primitive would help developers build faster,
                safer and more personalized agents without all the manual prompt
                engineering and systems integration work needed to get there. We
                hope to invite other developers to use and improve Arch. Please
                give it a shot and leave feedback here, or at our discord
                channel [4] Also here is a quick demo of the project in action
                [5]. You can check out our public docs here at [6]. Our models
                are also available here [7].
              </p>
              <p>
                [1]
                <a href="https://github.com/katanemo/archgw"
                  >https://github.com/katanemo/archgw</a
                >
                [2]
                <a href="https://www.envoyproxy.io/"
                  >https://www.envoyproxy.io/</a
                >
                [3]
                <a
                  href="https://huggingface.co/collections/katanemo/arch-function-66"
                  >https://huggingface.co/collections/katanemo/arch-function-66</a
                >... [4]
                <a
                  href="https://discord.com/channels/1292630766827737088/12926307682"
                  >https://discord.com/channels/1292630766827737088/12926307682</a
                >... [5]
                <a href="https://www.youtube.com/watch?v=I4Lbhr-NNXk"
                  >https://www.youtube.com/watch?v=I4Lbhr-NNXk</a
                >
                [6]
                <a href="https://docs.archgw.com/">https://docs.archgw.com/</a>
                [7]
                <a href="https://huggingface.co/katanemo"
                  >https://huggingface.co/katanemo</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44545949">
          <h3>
            <a class="item" href="https://kristoff.it/blog/zig-new-async-io/"
              >Zig's New Async I/O</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 23:03:41</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44545949"
                  >Comments</a
                ><span class="descendants">: 215</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44544862">
          <h3>
            <a class="item" href="https://github.com/aeron-io/aeron"
              >Aeron: Efficient reliable UDP unicast, UDP multicast, and IPC
              message transport</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 20:25:18</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44544862"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44544266">
          <h3>
            <a class="item" href="https://0x44.xyz/blog/web-request-blocking/"
              >Bypassing Google's big anti-adblock update</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 19:06:09</span
              ><span class="points-container"
                >Points: <span class="points">878</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44544266"
                  >Comments</a
                ><span class="descendants">: 737</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543240">
          <h3>
            <a
              class="item"
              href="https://inventwithpython.com/blog/lost-av-chapter.html"
              >Lost Chapter of Automate the Boring Stuff: Audio, Video, and
              Webcams in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 16:45:45</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543240"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44534809">
          <h3>
            <a class="item" href="https://uvdn7.github.io/cpp-coro/"
              >A Mental Model for C++ Coroutine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 17:23:57</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44534809"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44533044">
          <h3>
            <a class="item" href="https://timsh.org/claude-inside-docker/"
              >Switching to Claude Code and VSCode Inside Docker</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 15:11:24</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44533044"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44532527">
          <h3>
            <a
              class="item"
              href="https://c3-lang.org/blog/forget-borrow-checkers-c3-solved-memory-lifetimes-with-scopes/"
              >Forget borrow checkers: C3 solved memory lifetimes with scopes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 14:27:42</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44532527"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44529274">
          <h3>
            <a
              class="item"
              href="http://bannalia.blogspot.com/2025/07/maps-on-chains.html"
              >C++: Maps on Chains</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 07:27:47</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44529274"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44527739">
          <h3>
            <a
              class="item"
              href="https://github.com/dsekz/chrome-x-browser-validation-header"
              >Chrome's hidden X-Browser-Validation header reverse engineered</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 02:00:10</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44527739"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44527172">
          <h3>
            <a
              class="item"
              href="https://www.eff.org/deeplinks/2025/07/axons-draft-one-designed-defy-transparency"
              >Axon's Draft One AI Police Report Generator Is Designed to Defy
              Transparency</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 00:21:16</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44527172"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44519776">
          <h3>
            <a
              class="item"
              href="https://b.tuxes.uk/simple-homelab-monitoring.html"
              >Monitoring My Homelab, Simply</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 11:28:04</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44519776"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44517649">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/features/2025-robot-sculptors-marble/"
              >The Robot Sculptors of Italy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 05:39:46</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44517649"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44515783">
          <h3>
            <a
              class="item"
              href="https://courses.cs.northwestern.edu/325/readings/graham/graham-notes.html"
              >Notes on Graham's ANSI Common Lisp (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 23:32:53</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44515783"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44515379">
          <h3>
            <a
              class="item"
              href="https://cosmicbackground.io/blogs/learn-about-how-these-are-captured/capturing-the-international-space-station"
              >Capturing the International Space Station (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 22:32:41</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44515379"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44512350">
          <h3>
            <a
              class="item"
              href="https://www.mechanize.work/blog/the-upcoming-gpt-3-moment-for-rl/"
              >The upcoming GPT-3 moment for RL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 16:59:30</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44512350"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44507931">
          <h3>
            <a class="item" href="https://github.com/renoise/pattrns"
              >Experimental imperative-style music sequence generator engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 09:33:57</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44507931"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44507405">
          <h3>
            <a
              class="item"
              href="https://www.lelanthran.com/chap13/content.html"
              >Parse, Don’t Validate – Some C Safety Tips</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 08:07:23</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44507405"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
