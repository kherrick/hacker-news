<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46720395">
          <h3>
            <a class="item" href="https://gptzero.me/news/neurips/"
              >GPTZero finds 100 new hallucinations in NeurIPS 2025 accepted
              papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 15:20:48</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46720395"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46719899">
          <h3>
            <a
              class="item"
              href="https://lambdaland.org/posts/2026-01-21_tree-sitter_vs_lsp/"
              >Tree-sitter vs. Language Servers</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 14:47:58</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46719899"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46719491">
          <h3>
            <a
              class="item"
              href="https://e360.yale.edu/digest/europe-wind-solar-fossil-fuels"
              >In Europe, Wind and Solar Overtake Fossil Fuels</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 14:14:15</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46719491"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46719465">
          <h3>
            <a
              class="item"
              href="https://www.thenation.com/article/society/alaska-student-arrested-eating-ai-art-exhibit/"
              >Meet the Alaska Student Arrested for Eating an AI Art Exhibit</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 14:12:13</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46719465"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46719229">
          <h3>
            <a class="item" href="https://qwen.ai/blog?id=qwen3tts-0115"
              >Qwen3-TTS Family Is Now Open Sourced: Voice Design, Clone, and
              Generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 13:51:25</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46719229"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46719222">
          <h3>
            <a
              class="item"
              href="https://shreevatsa.net/post/douglas-adams-cultural-divide/"
              >Douglas Adams on the English–American cultural divide over
              "heroes"</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 13:50:48</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46719222"
                  >Comments</a
                ><span class="descendants">: 206</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46718140">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/flowtel/jobs/LaddaEz-founding-engineer-staff-senior"
              >Flowtel (YC W25) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 12:00:45</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46718061">
          <h3>
            <a
              class="item"
              href="https://www.designorate.com/design-thinking-books/"
              >Design Thinking Books You Must Read</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 11:51:10</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46718061"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46717556">
          <h3>
            <a class="item" href="https://curl.se/.well-known/security.txt"
              >We will ban you and ridicule you in public if you waste our time
              on crap reports</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 10:48:27</span
              ><span class="points-container"
                >Points: <span class="points">696</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46717556"
                  >Comments</a
                ><span class="descendants">: 405</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46717507">
          <h3>
            <a
              class="item"
              href="https://pdfa.org/want-to-make-your-pdfs-20-smaller-for-free/"
              >ISO PDF spec is getting Brotli – ~20 % smaller documents with no
              quality loss</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 10:41:23</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46717507"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46716696">
          <h3>
            <a class="item" href="https://www.jsoftware.com/papers/perlis77.htm"
              >In Praise of APL (1977)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 08:44:56</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46716696"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46716469">
          <h3>
            <a class="item" href="https://reactos.org/blogs/30yrs-of-ros/"
              >30 Years of ReactOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 08:03:57</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46716469"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46715600">
          <h3>
            <a
              class="item"
              href="https://www.pbs.org/newshour/health/brazilian-city-uses-tilapia-fish-skin-treat-burn-victims"
              >Doctors in Brazil using tilapia fish skin to treat burn
              victims</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 05:15:46</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46715600"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46713929">
          <h3>
            <a
              class="item"
              href="https://www.fb.org/market-intel/significant-farm-losses-persist-despite-federal-assistance"
              >Significant US farm losses persist, despite federal assistance</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 01:11:36</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46713929"
                  >Comments</a
                ><span class="descendants">: 335</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46713526">
          <h3>
            <a
              class="item"
              href="https://www.jamf.com/blog/threat-actors-expand-abuse-of-visual-studio-code/"
              >Threat actors expand abuse of Microsoft Visual Studio Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-22 @ 00:12:00</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46713526"
                  >Comments</a
                ><span class="descendants">: 232</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46713387">
          <h3>
            <a class="item" href="https://lix.dev/blog/introducing-lix/"
              >Lix – universal version control system for binary files</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-21 @ 23:55:06</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46713387"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46713106">
          <h3>
            <a
              class="item"
              href="https://huggingface.co/sweepai/sweep-next-edit-1.5B"
              >Show HN: Sweep, Open-weights 1.5B model for next-edit
              autocomplete</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-21 @ 23:22:40</span
              ><span class="points-container"
                >Points: <span class="points">455</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46713106"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
            <div class="text">
              <a href="https://huggingface.co/sweepai/sweep-next-edit-1.5b"
                >https://huggingface.co/sweepai/sweep-next-edit-1.5b</a
              >) or try it in our JetBrains plugin (<a
                href="https://plugins.jetbrains.com/plugin/26860-sweep-ai-autocomplete--coding-agent"
                >https://plugins.jetbrains.com/plugin/26860-sweep-ai-autocomp...</a
              >).
              <p>
                Next-edit autocomplete differs from standard autocomplete by
                using your recent edits as context when predicting completions.
                The model is small enough to run locally while outperforming
                models 4x its size on both speed and accuracy.
              </p>
              <p>
                We tested against Mercury (Inception), Zeta (Zed), and Instinct
                (Continue) across five benchmarks: next-edit above/below cursor,
                tab-to-jump for distant changes, standard FIM, and noisiness. We
                found exact-match accuracy correlates best with real usability
                because code is fairly precise and the solution space is small.
              </p>
              <p>
                Prompt format turned out to matter more than we expected. We ran
                a genetic algorithm over 30+ diff formats and found simple
                `original`/`updated` blocks beat unified diffs. The verbose
                format is just easier for smaller models to understand.
              </p>
              <p>
                Training was SFT on ~100k examples from permissively-licensed
                repos (4hrs on 8xH100), then RL for 2000 steps with tree-sitter
                parse checking and size regularization. The RL step fixes edge
                cases SFT can’t like, generating code that doesn’t parse or
                overly verbose outputs.
              </p>
              <p>
                We're open-sourcing the weights so the community can build fast,
                privacy-preserving autocomplete for any editor. If you're
                building for VSCode, Neovim, or something else, we'd love to see
                what you make with it!
              </p>
            </div>
          </section>
        </section>
        <section id="46712678">
          <h3>
            <a
              class="item"
              href="https://www.media.mit.edu/publications/your-brain-on-chatgpt/"
              >Your brain on ChatGPT: Accumulation of cognitive debt when using
              an AI assistant</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-21 @ 22:41:45</span
              ><span class="points-container"
                >Points: <span class="points">447</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46712678"
                  >Comments</a
                ><span class="descendants">: 318</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46711574">
          <h3>
            <a
              class="item"
              href="https://www.valueaddedresource.net/ebay-bans-ai-agents-updates-arbitration-user-agreement-feb-2026/"
              >eBay explicitly bans AI "buy for me" agents in user agreement
              update</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-21 @ 21:07:47</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46711574"
                  >Comments</a
                ><span class="descendants">: 266</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46708678">
          <h3>
            <a class="item" href="https://blog.kagi.com/waiting-dawn-search"
              >Waiting for dawn in search: Search index, Google rulings and
              impact on Kagi</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-21 @ 17:28:03</span
              ><span class="points-container"
                >Points: <span class="points">400</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46708678"
                  >Comments</a
                ><span class="descendants">: 222</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46708601">
          <h3>
            <a
              class="item"
              href="https://adguard-vpn.com/en/blog/adguard-vpn-protocol-goes-open-source-meet-trusttunnel.html"
              >TrustTunnel: AdGuard VPN protocol goes open-source</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-21 @ 17:21:26</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46708601"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46707572">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/claude-new-constitution"
              >Claude's new constitution</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-21 @ 16:04:49</span
              ><span class="points-container"
                >Points: <span class="points">522</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46707572"
                  >Comments</a
                ><span class="descendants">: 612</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.anthropic.com/constitution"
                >https://www.anthropic.com/constitution</a
              >
            </div>
          </section>
        </section>
        <section id="46706906">
          <h3>
            <a class="item" href="https://skip.dev/blog/skip-is-free/"
              >Skip is now free and open source</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-21 @ 15:20:53</span
              ><span class="points-container"
                >Points: <span class="points">465</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46706906"
                  >Comments</a
                ><span class="descendants">: 213</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46706528">
          <h3>
            <a class="item" href="https://github.com/ChartGPU/ChartGPU"
              >Show HN: ChartGPU – WebGPU-powered charting library (1M points at
              60fps)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-21 @ 14:54:56</span
              ><span class="points-container"
                >Points: <span class="points">641</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46706528"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
            <div class="text">
              <p>
                The core insight: Canvas2D is fundamentally CPU-bound. Even
                WebGL chart libraries still do most computation on the CPU. So I
                moved everything to the GPU via WebGPU:
              </p>
              <p>
                - LTTB downsampling runs as a compute shader - Hit-testing for
                tooltips/hover is GPU-accelerated - Rendering uses instanced
                draws (one draw call per series)
              </p>
              <p>The result: 1M points at 60fps with smooth zoom/pan.</p>
              <p>
                Live demo:
                <a
                  href="https://chartgpu.github.io/ChartGPU/examples/million-points/"
                  >https://chartgpu.github.io/ChartGPU/examples/million-points/</a
                >
              </p>
              <p>
                Currently supports line, area, bar, scatter, pie, and
                candlestick charts. MIT licensed, available on npm: `npm install
                chartgpu`
              </p>
              <p>
                Happy to answer questions about WebGPU internals or architecture
                decisions.
              </p>
            </div>
          </section>
        </section>
        <section id="46675669">
          <h3>
            <a class="item" href="https://www.projectlumen.app/"
              >Show HN: Interactive physics simulations I built while teaching
              my daughter</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-19 @ 06:36:57</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46675669"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                She learned so much faster through hands-on exploration than
                through books or videos. That's when I realized: what if I could
                recreate these physical experiments as interactive simulations?
              </p>
              <p>
                Lumen is the result - an interactive physics playground covering
                sound, light, motion, life, and mechanics. Each module lets you
                manipulate variables in real-time and see/hear the results
                immediately.
              </p>
              <p>
                Try it:
                <a href="https://www.projectlumen.app/"
                  >https://www.projectlumen.app/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46672957">
          <h3>
            <a
              class="item"
              href="https://adventures.nodeland.dev/archive/the-human-in-the-loop/"
              >The Human in the Loop</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 22:47:27</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46672957"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46659016">
          <h3>
            <a
              class="item"
              href="https://t-cadet.github.io/programming-wisdom/#2026-01-17-gathering-linux-syscall-numbers"
              >Gathering Linux Syscall Numbers in a C Table</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-17 @ 15:57:42</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46659016"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46658869">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/essay/the-science-of-life-and-death-in-mary-shelleys-frankenstein/"
              >The Science of Life and Death in Mary Shelley's Frankenstein</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-17 @ 15:36:55</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46658869"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46658128">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2201.01174"
              >Binary fuse filters: Fast and smaller than xor filters (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-17 @ 14:02:17</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46658128"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46649786">
          <h3>
            <a
              class="item"
              href="https://labs.iximiuz.com/tutorials/unikernels-intro-93976514"
              >Hands-On Introduction to Unikernels</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-16 @ 18:16:10</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46649786"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
