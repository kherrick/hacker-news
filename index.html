<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39276916">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/playht/jobs/G6vI660-senior-ml-engineer-large-language-models"
              >PlayHT (YC W23) Is Hiring a Founding LLM Engineer and
              Researcher</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 17:01:01</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39276687">
          <h3>
            <a class="item" href="https://github.com/AdguardTeam/AdGuardHome"
              >Runs on your OpenWrt box: AdGuard Home is network-wide blocking
              ads and tracking</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 16:48:27</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39276687"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39276452">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/02/05/the-perverse-policies-that-fuel-wildfires"
              >The Perverse Policies That Fuel Wildfires</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 16:35:28</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39276452"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39275860">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/tiktok-is-destroying-itself-from-the-inside-out-1851227491"
              >TikTok Is Destroying Itself from the Inside Out</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 16:02:23</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39275860"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39275314">
          <h3>
            <a class="item" href="https://github.com/apple/ml-mgie"
              >Instruction-Based Image Editing via LLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 15:30:48</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39275314"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39275272">
          <h3>
            <a
              class="item"
              href="https://eos.org/articles/oceans-may-have-already-seen-1-7c-of-warming"
              >Oceans May Have Already Seen 1.7°C of Warming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 15:29:09</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39275272"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39275203">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2402.03239"
              >Bluesky and the at Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 15:25:33</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39275203"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274918">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2401.16212"
              >Better Call GPT, Comparing Large Language Models Against Lawyers
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 15:04:39</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274918"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274895">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/01/review-frameworks-laptop-16-is-unique-laudable-fascinating-and-flawed/"
              >Review: Framework's Laptop 16 is unique, laudable and flawed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 15:02:38</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274895"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274882">
          <h3>
            <a
              class="item"
              href="https://bsky.social/about/blog/02-06-2024-join-bluesky"
              >Bluesky signups are now open to the public</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 15:01:28</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274882"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274631">
          <h3>
            <a
              class="item"
              href="https://blog.mozilla.org/en/mozilla/introducing-mozilla-monitor-plus-a-new-tool-to-automatically-remove-your-personal-information-from-data-broker-sites/"
              >Mozilla Monitor Plus: automatically remove your personal info
              from data brokers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 14:37:19</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274631"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274455">
          <h3>
            <a
              class="item"
              href="https://chriscoyier.net/2024/01/24/what-happened-with-the-web-monetization-api/"
              >What Happened with the Web Monetization API?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 14:23:24</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274455"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274128">
          <h3>
            <a
              class="item"
              href="https://english.elpais.com/usa/2024-01-29/prisoners-in-the-us-are-part-of-a-hidden-workforce-linked-to-hundreds-of-popular-food-brands.html"
              >Prisoners in the US are part of a hidden workforce linked to
              popular food brands</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 13:50:03</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274128"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274125">
          <h3>
            <a class="item" href="https://netbox.dev/"
              >NetBox.dev: the source of truth for everything on your network</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 13:49:38</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274125"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274004">
          <h3>
            <a class="item" href="https://www.futureme.org/"
              >Write a Letter to Your Future Self</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 13:34:55</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274004"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39273954">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/cpursley/c8fb81fe8a7e5df038158bdfe0f06dbb"
              >PostgreSQL is enough</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 13:28:27</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39273954"
                  >Comments</a
                ><span class="descendants">: 159</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39273932">
          <h3>
            <a class="item" href="https://clig.dev/"
              >Command Line Interface Guidelines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 13:25:34</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39273932"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39272952">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/TrackingMachineImportance"
              >We might want to regularly keep track of how important each
              server is</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 10:51:37</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39272952"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39272884">
          <h3>
            <a
              class="item"
              href="https://spaceweatherarchive.com/2024/02/01/will-satellite-megaconstellations-weaken-earths-magnetic-field/"
              >Will Satellite Megaconstellations Weaken Earth's Magnetic
              Field?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 10:40:05</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39272884"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39271107">
          <h3>
            <a
              class="item"
              href="https://ionutbalosin.com/2024/02/jvm-performance-comparison-for-jdk-21/"
              >JVM Performance Comparison for JDK 21</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 05:30:16</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39271107"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39268439">
          <h3>
            <a class="item" href="https://www.namethatnation.com/"
              >Show HN: Name That Nation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 23:04:17</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39268439"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
            <div class="text">
              I made this map game. react, material ui, hosted on vercel cdn, no
              back end.
            </div>
          </section>
        </section>
        <section id="39266396">
          <h3>
            <a class="item" href="https://dmytry.github.io/space/"
              >Relativistic Spaceship</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 20:07:47</span
              ><span class="points-container"
                >Points: <span class="points">977</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39266396"
                  >Comments</a
                ><span class="descendants">: 442</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39263854">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39263854"
              >Show HN: Atopile – Design circuit boards with code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 17:30:50</span
              ><span class="points-container"
                >Points: <span class="points">569</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39263854"
                  >Comments</a
                ><span class="descendants">: 277</span></span
              >
            </h4>
            <div class="text">
              <a href="https://youtu.be/7-Q0XVpfW3Y"
                >https://youtu.be/7-Q0XVpfW3Y</a
              >
              <p>
                Could you imagine the pain of building an entire software
                product using only assembly code? That’s about how we felt
                designing hardware. We don’t currently have good ways to
                describe what we need, reuse existing designs and compile that
                description down to a product.
              </p>
              <p>
                We started atopile to fix this. atopile is an open-source
                language and toolchain to describe circuits with code. The
                compiler is here:
                <a href="https://github.com/atopile/atopile"
                  >https://github.com/atopile/atopile</a
                >
                Docs are here:
                <a href="https://atopile.io/getting-started/"
                  >https://atopile.io/getting-started/</a
                >
                . For a detailed deep dive designing an ESP32 module, see this
                video:
                <a href="https://youtu.be/eMWRwZOajdQ"
                  >https://youtu.be/eMWRwZOajdQ</a
                >
              </p>
              <p>
                We realized this was a problem in our previous jobs. Narayan and
                I (Tim) had to manually, draw and export all our electronic
                circuit boards. This lasted until our friend Matt, a software
                engineer, showed us his development workflow. All his projects
                were built, tested, and merged automatically via GitHub. So we
                asked: Can we build the same for hardware?
              </p>
              <p>
                We observed that the ability to abstract electronics effectively
                hinged on using a language to describe the requirements, so we
                came up with the “ato” language. In ato, you can break down
                circuits into modules, components and interfaces. You can nest
                and connect those blocks with each other. Here is an example
                with an RP2040 microcontroller:
              </p>
              <p></p>
              <pre><code>  import RP2040Kit from "rp2040/RP2040Kit.ato"
  import LEDIndicatorBlue from "generics/leds.ato"
  import LDOReg3V3 from "regulators/regulators.ato"
  import USBCConn from "usb-connectors/usb-connectors.ato"

  module Blinky:
    micro_controller = new RP2040Kit
    led_indicator = new LEDIndicatorBlue
    voltage_regulator = new LDOReg3V3
    usb_c_connector = new USBCConn

    usb_c_connector.power ~ voltage_regulator.power_in
    voltage_regulator.power_out ~ micro_controller.power
    micro_controller.gpio13 ~ led_indicator.input
    micro_controller.power.gnd ~ led_indicator.gnd

    led_indicator.resistor.value = 100ohm +/- 10%

</code></pre>
              From there, the compiler produces a netlist that describes how the
              circuit is connected and selects jelly-bean components for you (<a
                href="https://atopile.io/blog/2024/01/31/cloud-components/"
                >https://atopile.io/blog/2024/01/31/cloud-components/</a
              >). Our next focus will be to add layout reuse, mathematical
              relations between values and define circuits by traits (similar to
              Rusts’).
              <p>
                At the moment, atopile is intended to design all types of
                printed circuit boards (PCB) with low to medium complexity. The
                circuit complexity that the compiler can handle will steadily
                increase until it becomes suited for production usage. We often
                get asked if the compiler is meant for chip design rather than
                PCBs, but that is not the case. The language is exclusive to
                PCBs. At least for now..!
              </p>
              <p>
                A big part of why the software community is so prolific is
                thanks to open source and open core technology. The ability to
                share software packages with each other and efficiently chain
                tools together has made the software world an awesome place for
                developers. As hardware engineers, we would love our field to
                benefit from this as well. That’s why we’ve made atopile’s core
                open source (Apache 2.0). We plan to generate revenue by selling
                entreprise targeted features, similar to GitLab.
              </p>
              <p>
                We would love to have your thoughts on the compiler! What’s your
                story in electronics? What would you want us to build?
              </p>
            </div>
          </section>
        </section>
        <section id="39261861">
          <h3>
            <a class="item" href="https://scrollprize.org/grandprize"
              >Vesuvius Challenge 2023 Grand Prize awarded: we can read the
              first scroll</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 15:00:02</span
              ><span class="points-container"
                >Points: <span class="points">1260</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39261861"
                  >Comments</a
                ><span class="descendants">: 197</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39261268">
          <h3>
            <a
              class="item"
              href="https://ericniebler.com/2024/02/04/what-are-senders-good-for-anyway/"
              >What are senders good for, anyway?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 14:01:21</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39261268"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39261241">
          <h3>
            <a
              class="item"
              href="https://slimemoldtimemold.com/2024/02/03/lady-tasting-brine/"
              >Lady Tasting Brine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 13:58:32</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39261241"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39250552">
          <h3>
            <a
              class="item"
              href="https://www.ecologyandsociety.org/vol26/iss2/art41/"
              >How Maasai agro-pastoralists form and use accidental social ties
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 14:45:43</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39250552"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39249281">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/pdf/10.1145/322123.322134"
              >Concurrent Processes and Their Syntax (1979) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 11:02:45</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39249281"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39248331">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/who-are-the-leaders-in-our-heads-and-how-did-they-get-there"
              >The Mythos of Leadership</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 07:21:57</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39248331"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39248110">
          <h3>
            <a
              class="item"
              href="https://haseebq.com/how-not-to-bomb-your-offer-negotiation/"
              >How not to bomb your offer negotiation (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 06:33:22</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39248110"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
