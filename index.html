<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38920043">
          <h3><a class="item" href="https://pola.rs/">Polars</a></h3>
          <section>
            <h4>
              <span>2024-01-08 @ 23:32:54</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38920043"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38919884">
          <h3>
            <a class="item" href="https://openreview.net/forum?id=MGWsPGogLH"
              >Turing Complete Transformers: Two Transformers Are More Powerful
              Than One</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 23:20:21</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38919884"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38918969">
          <h3>
            <a class="item" href="https://github.com/makew0rld/merkdir"
              >Show HN: Merkdir – create Merkle trees from your directories</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 22:12:43</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38918969"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38918569">
          <h3>
            <a
              class="item"
              href="https://hackaday.com/2022/10/08/a-rail-cart-for-the-space-conscious-passenger/"
              >A Rail Cart for the Space Conscious Passenger (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 21:39:57</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38918569"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38918554">
          <h3>
            <a
              class="item"
              href="https://blog.yossarian.net/2021/03/16/totally_safe_transmute-line-by-line"
              >totally_safe_transmute, Line-by-Line (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 21:38:45</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38918554"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38917820">
          <h3>
            <a
              class="item"
              href="https://theaircurrent.com/feed/dispatches/united-finds-loose-bolts-on-plug-doors-during-737-max-9-inspections/"
              >United finds loose bolts on plug doors during 737 Max 9
              inspections</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 20:43:37</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38917820"
                  >Comments</a
                ><span class="descendants">: 422</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38917749">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/cells-across-the-body-talk-to-each-other-about-aging-20240108/"
              >Cells across the body talk to each other about aging</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 20:37:54</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38917749"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38917307">
          <h3>
            <a
              class="item"
              href="https://knowyourmeme.com/memes/how-does-one-patch-kde2-under-freebsd"
              >How does one patch KDE2 under FreeBSD? (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 20:02:48</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38917307"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38917175">
          <h3>
            <a
              class="item"
              href="https://blog.haschek.at/2019/the-curious-case-of-the-RasPi-in-our-network.html"
              >The curious case of the Raspberry Pi in the network closet
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 19:54:46</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38917175"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38916663">
          <h3>
            <a class="item" href="https://www.cs.umd.edu/~ben/goldenrules.html"
              >Golden Rules of Interface Design (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 19:15:07</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38916663"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38916647">
          <h3>
            <a
              class="item"
              href="https://interjectedfuture.com/trade-offs-between-different-crdts/"
              >Trade-offs between Different CRDTs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 19:13:32</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38916647"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38916397">
          <h3>
            <a
              class="item"
              href="https://cmhteixeira.com/concurrency/asyncfileio.html"
              >Async File IO</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 18:54:05</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38916397"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38916212">
          <h3>
            <a
              class="item"
              href="https://www.solvermax.com/blog/solver-performance-1989-vs-2024"
              >Solver Performance: 1989 vs. 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 18:43:16</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38916212"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38915999">
          <h3>
            <a class="item" href="https://wiki.mutable.ai"
              >Show HN: Auto Wiki – Turn your codebase into a Wiki</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 18:26:16</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38915999"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
            <div class="text">
              <a href="https://wiki.mutable.ai/">https://wiki.mutable.ai/</a>),
              which lets you generate a Wiki-style website to document your
              codebase. Citations link to code, with clickable references to
              each line of code being discussed. Here are some examples of
              popular projects:
              <p>
                React:
                <a href="https://wiki.mutable.ai/facebook/react"
                  >https://wiki.mutable.ai/facebook/react</a
                >
              </p>
              <p>
                Ollama
                <a href="https://wiki.mutable.ai/jmorganca/ollama"
                  >https://wiki.mutable.ai/jmorganca/ollama</a
                >
              </p>
              <p>
                D3:
                <a href="https://wiki.mutable.ai/d3/d3"
                  >https://wiki.mutable.ai/d3/d3</a
                >
              </p>
              <p>
                Terraform:
                <a href="https://wiki.mutable.ai/hashicorp/terraform"
                  >https://wiki.mutable.ai/hashicorp/terraform</a
                >
              </p>
              <p>
                Bitcoin:
                <a href="https://wiki.mutable.ai/bitcoin/bitcoin"
                  >https://wiki.mutable.ai/bitcoin/bitcoin</a
                >
              </p>
              <p>
                Mastodon:
                <a href="https://wiki.mutable.ai/mastodon/mastodon"
                  >https://wiki.mutable.ai/mastodon/mastodon</a
                >
              </p>
              <p>
                Auto Wiki makes it easy to see at a high level what a codebase
                is doing and how the work is divided. In some cases we’ve
                identified entire obsolete sections of codebases by seeing a
                section for code that was no longer important. Auto Wiki relies
                on our citations system which cuts back on hallucinations. The
                citations link to a precise reference or definition which means
                the wiki generation is grounded on the basis of the code being
                cited rather than free form generation.
              </p>
              <p>
                We’ve run Auto Wiki on the most popular 1,000 repos on GitHub.
                If you want us to generate a wiki of a public repo for you, just
                comment in this thread! The wikis take time to generate as we
                are still ramping up our capacity, but I’ll reply that we’ve
                launched the process and then come back with a link to your wiki
                when it’s ready.
              </p>
              <p>
                For private repos, you can use our app (<a
                  href="https://app.mutable.ai"
                  >https://app.mutable.ai</a
                >) to generate wikis. We also offer private deployments with our
                own model for enterprise customers; you can ping us at
                info@mutable.ai. Anyone that already has access to a repo
                through GitHub will be able to view the wiki, only the person
                generating the wikis needs to pay to create them. Pricing starts
                at $4 and ramps up by $2 increments depending on how large your
                repo is.
              </p>
              <p>
                In an upcoming version of Auto Wiki, we’ll include other sources
                of information relevant to your code and generate architectural
                diagrams.
              </p>
              <p>
                Please check out Auto Wiki and let us know your thoughts! Thank
                you!
              </p>
            </div>
          </section>
        </section>
        <section id="38915775">
          <h3>
            <a class="item" href="https://tgrcode.com/posts/mario_maker_2_api"
              >Mario Maker 2 API</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 18:08:30</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38915775"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38915759">
          <h3>
            <a
              class="item"
              href="https://rsadowski.de/posts/2024-01-09-openbsd-kde/"
              >OpenBSD KDE Plasma Desktop</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 18:07:24</span
              ><span class="points-container"
                >Points: <span class="points">231</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38915759"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38915157">
          <h3>
            <a
              class="item"
              href="https://postmarketos.org/blog/2024/01/08/infrastructure-and-testing/"
              >PostmarketOS in 2024-01: Infrastructure and bug reports</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 17:21:46</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38915157"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38914913">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/patterns"
              >Patterns (YC S21) Is Hiring to Automate Analytics with LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 17:03:04</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38914764">
          <h3>
            <a
              class="item"
              href="https://www.crunchydata.com/blog/an-overview-of-distributed-postgresql-architectures"
              >An overview of distributed Postgres architectures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 16:52:56</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38914764"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38913425">
          <h3>
            <a class="item" href="https://github.com/wagoodman/dive"
              >Dive: A tool for exploring a Docker image, layer contents and
              more</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 15:35:38</span
              ><span class="points-container"
                >Points: <span class="points">352</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38913425"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38912406">
          <h3>
            <a class="item" href="https://ktye.github.io/pdp11/index.html"
              >k on pdp11</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 14:31:26</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38912406"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38912125">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/it-employment-grew-by-just-700-jobs-in-2023-down-from-267-000-in-2022-adbd8a61"
              >IT employment grew by just 700 jobs in 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 14:11:21</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38912125"
                  >Comments</a
                ><span class="descendants">: 300</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38911740">
          <h3>
            <a
              class="item"
              href="https://brooker.co.za/blog/2023/12/15/sieve.html"
              >Why Aren't We Sieve-Ing?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 13:39:50</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38911740"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38911088">
          <h3>
            <a
              class="item"
              href="https://simjanos-dev.github.io/LinguaCafeHome/"
              >LinguaCafe: Self-hosted software for language learners to read
              foreign languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 12:36:04</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38911088"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38905891">
          <h3>
            <a
              class="item"
              href="https://thenewleafjournal.com/cycling-doping-fallacies/"
              >Cycling Doping Fallacies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 22:33:18</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38905891"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38904963">
          <h3>
            <a
              class="item"
              href="https://rnikhil.com/2024/01/07/attacking-neural-networks.html"
              >Attacks on machine learning models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 20:44:48</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38904963"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38902414">
          <h3>
            <a
              class="item"
              href="https://blog.benjojo.co.uk/post/browsers-biggest-tls-mistake"
              >The browser's biggest TLS mistake</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 16:17:47</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38902414"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38900044">
          <h3>
            <a
              class="item"
              href="https://heritagesciencejournal.springeropen.com/articles/10.1186/s40494-023-01092-2"
              >1899 Peruvian dinero: the mystery of a coin that wasn't
              officially minted</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 10:26:47</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38900044"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38897248">
          <h3>
            <a class="item" href="https://tensornetwork.org"
              >The Tensor Network</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 00:58:51</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38897248"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38890692">
          <h3>
            <a
              class="item"
              href="https://ggnotes.com/the-best-way-to-get-unstuck"
              >The best way to get unstuck</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-06 @ 11:55:27</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38890692"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
