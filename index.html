<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46319946">
          <h3>
            <a class="item" href="https://www.cs251.com/"
              >Great ideas in theoretical computer science</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 22:52:06</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46319946"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46319826">
          <h3>
            <a class="item" href="https://github.com/DGoettlich/history-llms"
              >Trained LLMs exclusively on pre-1913 texts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 22:39:47</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46319826"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46319657">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2025/15-tb-vram-on-mac-studio-rdma-over-thunderbolt-5"
              >1.5 TB of VRAM on Mac Studio – RDMA over Thunderbolt 5</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 22:23:09</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46319657"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46319324">
          <h3>
            <a
              class="item"
              href="https://kottke.org/25/12/this-ai-vending-machine-was-tricked-into-giving-away-everything"
              >AI vending machine was tricked into giving away everything</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 21:52:39</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46319324"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46318676">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/delty/jobs/MDeC49o-machine-learning-engineer"
              >Delty (YC X25) Is Hiring an ML Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 21:02:10</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46318191">
          <h3>
            <a class="item" href="https://nimbalyst.com"
              >Local WYSIWYG Markdown, mockup, data model editor powered by
              Claude Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 20:26:55</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46318191"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                So, we built Nimbalyst to be the local WYSIWYG editor and
                session manager where you iterate with Claude Code on markdown
                docs, diagrams, mockups, data-models, sessions, and code.
                Nimbalyst lets you:
              </p>
              <p>- Work in one integrated tool leveraging all your context.</p>
              <p>- Use all the power of Claude Code in a UI</p>
              <p>
                - Work with Claude Code to write and edit WYSIWYG markdown, see
                AI changes as red/green, approve them
              </p>
              <p>
                - Iterate on html mockups with Claude Code, annotating the
                mockups, and then use them as context for people and Claude Code
                coding
              </p>
              <p>
                - Build your data models based on your docs/code, iterate on
                them with Claude Code, export them in standard formats.
              </p>
              <p>
                - Integrate mermaid diagrams, text, tables, mockups, data
                models, and images in standard markdown for human/AI context
              </p>
              <p>
                - Tie sessions to documents to sessions, find and resume
                sessions, treat sessions as context, run parallel sessions
              </p>
              <p>
                - Code with Claude Code with all of this context, use /
                commands, see git status.
              </p>
              <p>
                Nimbalyst is in Beta, local, and free. We would love your
                feedback.
              </p>
            </div>
          </section>
        </section>
        <section id="46317657">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/developers/t5gemma-2/"
              >T5Gemma 2: The next generation of encoder-decoder models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 19:48:15</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46317657"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46317546">
          <h3>
            <a class="item" href="https://kibty.town/blog/mintlify/"
              >How to hack Discord, Vercel and more with one easy trick</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 19:41:24</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46317546"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46317174">
          <h3>
            <a
              class="item"
              href="https://vividmaps.com/central-pangean-mountains/"
              >The Scottish Highlands, the Appalachians, Atlas are the same
              mountain range</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 19:15:17</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46317174"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46317098">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/hackermondev/5e2cdc32849405fff6b46957747a2d28"
              >We pwned X, Vercel, Cursor, and Discord through a supply-chain
              attack</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 19:08:48</span
              ><span class="points-container"
                >Points: <span class="points">631</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46317098"
                  >Comments</a
                ><span class="descendants">: 259</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46316907">
          <h3>
            <a
              class="item"
              href="https://www.japantimes.co.jp/business/2025/12/18/tech/china-west-ai-chips/"
              >How China built its ‘Manhattan Project’ to rival the West in AI
              chips</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 18:55:34</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46316907"
                  >Comments</a
                ><span class="descendants">: 236</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46316533">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/developers/functiongemma/"
              >FunctionGemma 270M Model</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 18:26:52</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46316533"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46316409">
          <h3>
            <a
              class="item"
              href="https://mastodon.social/@firefoxwebdevs/115740500373677782"
              >Firefox will have an option to disable all AI features</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 18:18:30</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46316409"
                  >Comments</a
                ><span class="descendants">: 256</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46316367">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/introducing-gpt-5-2-codex/"
              >GPT-5.2-Codex</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 18:14:48</span
              ><span class="points-container"
                >Points: <span class="points">391</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46316367"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46315414">
          <h3>
            <a
              class="item"
              href="https://claude.com/blog/organization-skills-and-directory"
              >Skills for organizations, partners, the ecosystem</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 17:04:32</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46315414"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46313991">
          <h3>
            <a class="item" href="https://dl.acm.org/openaccess"
              >Beginning January 2026, all ACM publications will be made open
              access</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 15:39:09</span
              ><span class="points-container"
                >Points: <span class="points">1392</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46313991"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46313379">
          <h3>
            <a class="item" href="https://www.jack.bio/blog/licenseplate"
              >Using TypeScript to obtain one of the rarest license plates</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 15:00:32</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46313379"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46313297">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2025/Dec/18/code-proven-to-work/"
              >Your job is to deliver code you have proven to work</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 14:52:11</span
              ><span class="points-container"
                >Points: <span class="points">648</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46313297"
                  >Comments</a
                ><span class="descendants">: 542</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46312973">
          <h3>
            <a class="item" href="http://pleasejusttryhtmx.com/"
              >Please just try HTMX</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 14:18:52</span
              ><span class="points-container"
                >Points: <span class="points">456</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46312973"
                  >Comments</a
                ><span class="descendants">: 384</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46311856">
          <h3>
            <a
              class="item"
              href="https://worksinprogress.co/issue/were-classical-statues-painted-horribly/"
              >Classical statues were not painted horribly</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 12:28:45</span
              ><span class="points-container"
                >Points: <span class="points">565</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46311856"
                  >Comments</a
                ><span class="descendants">: 271</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46303406">
          <h3>
            <a class="item" href="https://mjg59.dreamwidth.org/73777.html"
              >How did IRC ping timeouts end up in a lawsuit?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-17 @ 18:25:29</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46303406"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46295295">
          <h3>
            <a class="item" href="https://github.com/microsoft/TRELLIS.2"
              >TRELLIS.2: state-of-the-art large 3D generative model (4B)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-16 @ 22:09:53</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46295295"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <a href="https://microsoft.github.io/TRELLIS.2/"
                >https://microsoft.github.io/TRELLIS.2/</a
              >
            </div>
          </section>
        </section>
        <section id="46294456">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/news/845400/texas-tv-makers-lawsuit-samsung-sony-lg-hisense-tcl-spying"
              >Texas is suing all of the big TV makers for spying on what you
              watch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-16 @ 21:04:54</span
              ><span class="points-container"
                >Points: <span class="points">549</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46294456"
                  >Comments</a
                ><span class="descendants">: 283</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46294144">
          <h3>
            <a class="item" href="https://github.com/vivienhenz24/fuzzy-canary"
              >Show HN: Stop AI scrapers from hammering your self-hosted blog
              (using porn)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-16 @ 20:42:38</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46294144"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
            <div class="text">
              <p>
                There isn't much you can do about it without cloudflare. These
                companies ignore robots.txt, and you're competing with teams
                with more resources than you. It's you vs the MJs of
                programming, you're not going to win.
              </p>
              <p>
                But there is a solution. Now I'm not going to say it's a great
                solution...but a solution is a solution. If your website
                contains content that will trigger their scraper's safeguards,
                it will get dropped from their data pipelines.
              </p>
              <p>
                So here's what fuzzycanary does: it injects hundreds of
                invisible links to porn websites in your HTML. The links are
                hidden from users but present in the DOM so that scrapers can
                ingest them and say "nope we won't scrape there again in the
                future".
              </p>
              <p>
                The problem with that approach is that it will absolutely nuke
                your website's SEO. So fuzzycanary also checks user agents and
                won't show the links to legitimate search engines, so Google and
                Bing won't see them.
              </p>
              <p>
                One caveat: if you're using a static site generator it will bake
                the links into your HTML for everyone, including googlebot. Does
                anyone have a work-around for this that doesn't involve using a
                proxy?
              </p>
              <p>Please try it out! Setup is one component or one import.</p>
              <p>
                (And don't tell me it's a terrible idea because I already know
                it is)
              </p>
              <p>
                package:
                <a href="https://www.npmjs.com/package/@fuzzycanary/core"
                  >https://www.npmjs.com/package/@fuzzycanary/core</a
                >
                gh:
                <a href="https://github.com/vivienhenz24/fuzzy-canary"
                  >https://github.com/vivienhenz24/fuzzy-canary</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46292937">
          <h3>
            <a
              class="item"
              href="https://www.snellman.net/blog/archive/2016-12-13-ring-buffers/"
              >I've been writing ring buffers wrong all these years (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-16 @ 19:11:47</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46292937"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46292266">
          <h3>
            <a class="item" href="https://ai.meta.com/samaudio/"
              >Meta Segment Anything Model Audio</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-16 @ 18:26:43</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46292266"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46290349">
          <h3>
            <a class="item" href="https://jgthms.com/picknplace.js/"
              >Show HN: Picknplace.js, an alternative to drag-and-drop</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-16 @ 16:12:06</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46290349"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
            <div class="text">
              <p>
                While it might take more time than a regular drag and drop, the
                benefit is for people who struggle with holding down the mouse
                button. With picknplace.js, you only need two clicks and some
                scrolling.
              </p>
              <p>
                This solution is meant as an experiment, so I'm open to
                discussion.
              </p>
            </div>
          </section>
        </section>
        <section id="46282902">
          <h3>
            <a
              class="item"
              href="https://nolanlawson.com/2025/12/14/the-time-element-should-actually-do-something/"
              >The &lt;time&gt; element should do something&lt;/time&gt;</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-16 @ 00:09:34</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46282902"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46274287">
          <h3>
            <a class="item" href="https://simedw.com/2025/12/15/langseed/"
              >Show HN: Learning a Language Using Only Words You Know</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-15 @ 13:32:12</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46274287"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              A proof-of-concept language learning app that uses LLMs to
              generate definitions of unknown words using only previously
              mastered vocabulary.
            </div>
          </section>
        </section>
        <section id="46257210">
          <h3>
            <a
              class="item"
              href="https://hedgehogreview.com/web-features/thr/posts/the-legacy-of-nicaea"
              >The Legacy of Nicaea</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-13 @ 19:34:14</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46257210"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
