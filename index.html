<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38978493">
          <h3>
            <a class="item" href="https://www.jstor.org/stable/995446"
              >Why Are More Boys Than Girls Retarded in School? (1928)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 09:46:17</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38978493"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38978289">
          <h3>
            <a
              class="item"
              href="https://jobs.apple.com/en-us/details/200531386/compiler-frontend-engineer"
              >Apple hiring compiler developers for improving Swift / C++
              interoperability</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 08:59:40</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38978289"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38978129">
          <h3>
            <a
              class="item"
              href="https://eclecticlight.co/2024/01/13/how-m1-macs-may-lag-behind/"
              >M1 Macs may lag behind</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 08:11:10</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38978129"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38978107">
          <h3>
            <a class="item" href="https://www.youshouldworkwith.com"
              >Show HN: I made a site to simplify recommending talented people
              to others</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 08:04:15</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38978107"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              Hey HN, i made this app to improve tech hiring via personal
              recommendations let me know what you think!
            </div>
          </section>
        </section>
        <section id="38978067">
          <h3>
            <a class="item" href="https://jannestimm.com/posts/xv6/"
              >A first dip into OS kernel development with xv6 and the 6.1810
              labs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 07:49:53</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38978067"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38977902">
          <h3>
            <a
              class="item"
              href="https://www.ashbyhq.com/careers?utm_source=hn&amp;ashby_jid=0b7a2d09-b3ee-4181-a1df-be1ea3fff54e"
              >Ashby (YC W19) Is Hiring Engineers Who Can Design (EMEA
              Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 07:00:19</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38977532">
          <h3>
            <a class="item" href="https://ui.shadcn.com/"
              >Shadcn: Components that you can copy-paste into your apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 05:16:46</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38977532"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38977516">
          <h3>
            <a class="item" href="https://github.com/aspen-cloud/triplit"
              >Triplit: Open-source DB that syncs data between server and
              browser in real-time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 05:13:46</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38977516"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38977128">
          <h3>
            <a
              class="item"
              href="https://blog.freudenjmp.com/posts/no-user-logon/"
              >A decade-old Steam bug</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 03:37:21</span
              ><span class="points-container"
                >Points: <span class="points">262</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38977128"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38976955">
          <h3>
            <a class="item" href="https://midlibrary.io/styles"
              >Midlibrary: Library of 4000 Midjourney artistic styles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 03:04:44</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38976955"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38976896">
          <h3>
            <a class="item" href="https://rkyv.org/"
              >Rkyv: A zero-copy deserialization framework for rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 02:53:09</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38976896"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38976254">
          <h3>
            <a
              class="item"
              href="https://github.com/derrickburns/generalized-kmeans-clustering"
              >Generalized K-Means Clustering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 00:56:35</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38976254"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38975912">
          <h3>
            <a class="item" href="https://github.com/aws/aws-lc-rs"
              >AWS Libcrypto for Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 00:11:00</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38975912"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38975566">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Hashlife"
              >HashLife – A memoized algorithm for Conway's Game of Life and
              cellular automata</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 23:25:37</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38975566"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38975453">
          <h3>
            <a
              class="item"
              href="https://dmicz.github.io/machine-learning/openai-changes/"
              >Hidden Changes in GPT-4, Uncovered</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 23:13:49</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38975453"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38975226">
          <h3>
            <a
              class="item"
              href="https://github.com/microsoft/xbox-multiplayer-analysis-tool"
              >Xbox Multiplayer Analysis Tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 22:48:08</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38975226"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38975204">
          <h3>
            <a class="item" href="https://github.com/revng/revng"
              >revng translates (i386, x86-64, MIPS, ARM, AArch64, s390x)
              binaries to LLVM IR</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 22:45:23</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38975204"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38974802">
          <h3>
            <a
              class="item"
              href="https://twitter.com/karpathy/status/1745921205020799433"
              >On Sleeper Agent LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 22:10:02</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38974802"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38974404">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2401.05566"
              >Sleeper Agents: Training Deceptive LLMs That Persist Through
              Safety Training</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 21:31:59</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38974404"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38974305">
          <h3>
            <a
              class="item"
              href="https://awaisrauf.github.io/deepCuriosity/Attending-NeurIPS2023"
              >My Experiences Attending NeurIPS 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 21:23:45</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38974305"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38972131">
          <h3>
            <a
              class="item"
              href="https://www.pointfree.co/blog/posts/129-perception-a-back-port-of-observable"
              >Perception: A back-port of Observable</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 18:44:52</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38972131"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38971966">
          <h3>
            <a class="item" href="https://github.com/marimo-team/marimo"
              >Show HN: Marimo – an open-source reactive notebook for Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 18:33:17</span
              ><span class="points-container"
                >Points: <span class="points">353</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38971966"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
            <div class="text">
              <p>
                GitHub repo:
                <a href="https://github.com/marimo-team/marimo"
                  >https://github.com/marimo-team/marimo</a
                >
              </p>
              <p>
                In marimo, a notebook’s code, outputs, and program state are
                always consistent. Run a cell and marimo reacts by automatically
                running the cells that reference its declared variables. Delete
                a cell and marimo scrubs its variables from program memory,
                eliminating hidden state. Our reactive runtime is based on
                static analysis, so it’s performant. If you’re worried about
                accidentally triggering expensive computations, you can disable
                specific cells from auto-running.
              </p>
              <p>
                marimo comes with UI elements like sliders, a dataframe
                transformer, and interactive plots that are automatically
                synchronized with Python [3]. Interact with an element and the
                cells that use it are automatically re-run with its latest
                value. Reactivity makes these UI elements more useful and
                ergonomic than Jupyter’s ipywidgets.
              </p>
              <p>
                Every marimo notebook can be run as a script from the command
                line, with cells executed in a topologically sorted order, or
                served as an interactive web app, using the marimo CLI.
              </p>
              <p>
                We’re a team of just two developers. We chose to develop marimo
                because we believe that the Python community deserves a better
                programming environment to do research and communicate it;
                experiment with code and share it; and learn computational
                science and teach it. We’ve seen lots of research start in
                Jupyter notebooks (much of my own has), only to fail to
                reproduce; lots of promising prototypes built that were never
                made real; and lots of tutorials written that failed to engage
                students.
              </p>
              <p>
                marimo has been developed with the close input of scientists and
                engineers, and with inspiration from many tools, including
                Pluto.jl and streamlit. We open-sourced it recently because we
                feel it’s ready for broader use. Please try it out (pip install
                marimo &amp;&amp; marimo tutorial intro). We’d appreciate your
                feedback!
              </p>
              <p>
                [1]
                <a href="https://github.com/marimo-team/marimo"
                  >https://github.com/marimo-team/marimo</a
                >
              </p>
              <p>
                [2]
                <a href="https://docs.marimo.io/faq.html#faq-problems"
                  >https://docs.marimo.io/faq.html#faq-problems</a
                >
              </p>
              <p>
                [3]
                <a href="https://docs.marimo.io/api/inputs/index.html"
                  >https://docs.marimo.io/api/inputs/index.html</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="38971221">
          <h3>
            <a
              class="item"
              href="https://tge-data-web.nyc3.digitaloceanspaces.com/docs/Vector%20Databases%20-%20A%20Technical%20Primer.pdf"
              >Vector Databases: A Technical Primer [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 17:38:56</span
              ><span class="points-container"
                >Points: <span class="points">451</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38971221"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38966213">
          <h3>
            <a
              class="item"
              href="https://nautil.us/the-magic-of-the-blackboard-487759/"
              >The Magic of the Blackboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 10:10:31</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38966213"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38965646">
          <h3>
            <a
              class="item"
              href="https://fprasx.github.io/articles/type-system-arithmetic/"
              >Doing First Grade Math in Rust's Type System</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-12 @ 08:46:38</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38965646"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38955018">
          <h3>
            <a
              class="item"
              href="https://blog.cryptographyengineering.com/2024/01/11/attack-of-the-week-airdrop-tracing/"
              >Attack of the Week: Airdrop Tracing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-11 @ 17:03:22</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38955018"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38950000">
          <h3>
            <a class="item" href="http://www.axiom-developer.org/"
              >Axiom Computer Algebra system (in development since 1971)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-11 @ 09:49:04</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38950000"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38948292">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/12/31/books/review/pure-wit-francesca-peacock.html"
              >Margaret Cavendish: A Polymath Who Scandalized 17th-Century
              London</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-11 @ 05:53:13</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38948292"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38948122">
          <h3>
            <a
              class="item"
              href="https://bjango.com/articles/blurradiuscomparison/"
              >Blur Radius Comparison</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-11 @ 05:28:44</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38948122"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38947851">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/tech/article/uber-lyft-sfo-airport-fees-18598614.php"
              >Uber and Lyft paid SFO about $50M last year</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-11 @ 05:00:40</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38947851"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
