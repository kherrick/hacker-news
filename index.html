<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40368016">
          <h3>
            <a
              class="item"
              href="https://computerhistory.org/blog/adobe-photoshop-source-code/"
              >Adobe Photoshop Source Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 15:12:15</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40368016"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40367160">
          <h3>
            <a
              class="item"
              href="https://twitter.com/janleike/status/1790603862132596961"
              >Jan Leike Resigns from OpenAI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 14:08:05</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40367160"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40367090">
          <h3>
            <a class="item" href="https://github.com/quarylabs/quary"
              >Show HN: Open-source BI and analytics for engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 14:02:35</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40367090"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <a href="https://quary.dev">https://quary.dev</a>), an
              engineer-first BI/analytics product. You can find our repo at
              <a href="https://github.com/quarylabs/quary"
                >https://github.com/quarylabs/quary</a
              >
              and our website at
              <a href="https://www.quary.dev/">https://www.quary.dev/</a>.
              There’s a demo video here:
              <a href="https://www.youtube.com/watch?v=o3hO65_lkGU"
                >https://www.youtube.com/watch?v=o3hO65_lkGU</a
              >
              <p>
                As engineers who have worked on data at startups and Amazon, we
                were frustrated by self-serve BI tools. They seemed dumbed down
                and they always required us to abandon our local dev tools we
                know and love (e.g. copilot, git). For us and for everyone we
                speak to, they end up being a mess.
              </p>
              <p>
                Based on this, we decided there was a need for engineer-oriented
                BI and analytics software.
              </p>
              <p>
                Quary solves these pain points by bringing standard software
                practices (version control, testing, refactoring, ci/cd,
                open-source, etc.) to the BI and analytics workflow.
              </p>
              <p>
                We integrate with many databases, but we’re showcasing our slick
                Supabase integration, because it: (1) keeps your data safe by
                running on your machine without data flowing through our
                servers; and (2) enables you to quickly build an analytics layer
                on top of your Supabase Postgres instances. Check out our
                Supabase guide:
                <a href="https://www.quary.dev/docs/quickstart-supabase"
                  >https://www.quary.dev/docs/quickstart-supabase</a
                >
              </p>
              <p>
                What we’re launching today is open source under the Apache 2.0
                license. We plan to keep the developer core open source and add
                paid features like a web platform to easily share data models
                (per-seat pricing), and an orchestration engine to materialize
                your data models.
              </p>
              <p>
                Please try Quary at
                <a href="https://quary.dev">https://quary.dev</a> and let us
                know what you think! We're excited to put the power of BI and
                analytics into the hands of engineers.
              </p>
            </div>
          </section>
        </section>
        <section id="40366962">
          <h3>
            <a
              class="item"
              href="https://matduggan.com/the-worst-website-in-the-entire-world/"
              >The Worst Website in the Entire World</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 13:52:19</span
              ><span class="points-container"
                >Points: <span class="points">249</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366962"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366867">
          <h3>
            <a
              class="item"
              href="https://danielcompton.net/google-cloud-unisuper"
              >What went wrong with UniSuper and Google Cloud?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 13:43:36</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366867"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366602">
          <h3>
            <a
              class="item"
              href="https://blog.teddykatz.com/2019/11/12/github-actions-dos.html"
              >Accidentally breaking GitHub Actions with a shorthash
              collision</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 13:24:02</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366602"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366474">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/cars/2024/05/heres-how-volvo-is-making-its-long-haul-trucks-safer-more-efficient/"
              >The Volvo VNL, a heavy truck purpose-designed for North American
              roads</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 13:13:23</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366474"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366443">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/society/article/2024/may/15/proteins-blood-cancer-warning-seven-years-study"
              >Proteins in blood could provide early cancer warning 'by more
              than seven years'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 13:11:08</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366443"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366323">
          <h3>
            <a
              class="item"
              href="https://plbrault.com/blog-posts/i-coded-something-dumb-and-im-proud-of-it-en/"
              >I Coded Something Dumb and I'm Proud of It</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:58:46</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366323"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366204">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/video-games/nearly-all-nintendo-64-games-can-now-be-recompiled-into-native-pc-ports-to-add-proper-ray-tracing-ultrawide-high-fps-and-more"
              >Nearly all Nintendo 64 games can now be recompiled into native PC
              ports</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:48:19</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366204"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366137">
          <h3>
            <a
              class="item"
              href="https://www.experimental-history.com/p/how-to-get-7th-graders-to-smoke"
              >How to get 7th graders to smoke</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:41:24</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366137"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366062">
          <h3>
            <a
              class="item"
              href="https://www.londonstockexchange.com/news-article/market-news/expected-intention-to-float/16470316"
              >Raspberry Pi Ltd is considering an IPO</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:32:14</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366062"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40365882">
          <h3>
            <a
              class="item"
              href="https://today.oregonstate.edu/news/researchers-identify-fastest-rate-natural-carbon-dioxide-rise-over-last-50000-years"
              >Fastest rate of natural carbon dioxide rise over the last 50k
              years</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:13:58</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40365882"
                  >Comments</a
                ><span class="descendants">: 279</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40365821">
          <h3>
            <a
              class="item"
              href="https://www.khanna.law/blog/smtp-550-571-redistricting"
              >SMTP 550-5.7.1 Rejected Because of Virginia Redistricting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:07:41</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40365821"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40365198">
          <h3>
            <a
              class="item"
              href="https://www.thestack.technology/oracle-dumps-terraform-for-opentofu/"
              >Oracle goes vegan: Dumps Terraform for OpenTofu</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 10:50:33</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40365198"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40364604">
          <h3>
            <a class="item" href="https://arxiv.org/abs/1309.5133"
              >Abstract Interpretation as a Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 08:52:59</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40364604"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363911">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/great-question/jobs/WIk0wNz-product-engineer-rails-react"
              >Great Question (YC W21) Is Hiring Product Engineers
              (Rails/React)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 07:01:16</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363744">
          <h3>
            <a
              class="item"
              href="https://formal.land/blog/2024/04/26/translation-core-alloc-crates"
              >Translation of the Rust's core and alloc crates to Coq for formal
              verification</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 06:32:18</span
              ><span class="points-container"
                >Points: <span class="points">258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40363744"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363704">
          <h3>
            <a class="item" href="https://ha.cking.ch/s8_data_line_locator/"
              >A low budget consumer hardware espionage implant: a GSM device
              hidden in (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 06:24:02</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40363704"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363517">
          <h3>
            <a class="item" href="https://teachyourselfmath.app/?page=1"
              >Show HN: I built a math website the internet loved, I'm back with
              more features</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 05:50:45</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40363517"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
            <div class="text">
              <p>
                Over the past few weeks, I have been actively working on this
                project, trying to incorporate all the feedback and I’d love to
                share it with the world again. New features: 1. Filter problems
                by difficulty and category 2. Bookmark your favorite problems 3.
                Editor in the comment section supports markdown formatting 4.
                ...and some UI improvements throughout the website
              </p>
              <p>
                I am also starting a small telegram community of math nerds who
                would like to discuss all things math, as well as talk about
                upcoming features and feedback for the website. Here is the link
                - (<a href="https://t.me/teachyourselfmath"
                  >https://t.me/teachyourselfmath</a
                >)
              </p>
              <p>
                If you’d like to support my work through small donations, you
                can do it here - (<a
                  href="https://www.buymeacoffee.com/viveknathani"
                  >https://www.buymeacoffee.com/viveknathani</a
                >). Right now, teachyourselfmath runs for free. Later, I’d love
                to make features that people would love to pay for but
                fundamentally, the goal is to make math accessible through
                technology. There’s a lot of peer learning involved in the
                comments section of these math problems. All of this gives me
                more reason to keep working on this.
              </p>
              <p>Happy hacking!</p>
            </div>
          </section>
        </section>
        <section id="40362449">
          <h3>
            <a class="item" href="https://urlhaus.abuse.ch/"
              >URLhaus: A database of malicious URLs used for malware
              distribution</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 02:24:03</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40362449"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40362105">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/strangely-curved-shapes-break-50-year-old-geometry-conjecture-20240514/"
              >Strangely Curved Shapes Break 50-Year-Old Geometry Conjecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 01:25:44</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40362105"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40361128">
          <h3>
            <a
              class="item"
              href="https://twitter.com/ilyasut/status/1790517455628198322"
              >Ilya Sutskever to leave OpenAI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 23:01:26</span
              ><span class="points-container"
                >Points: <span class="points">1002</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40361128"
                  >Comments</a
                ><span class="descendants">: 657</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40358041">
          <h3>
            <a class="item" href="https://deepmind.google/technologies/veo/"
              >Veo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 17:58:26</span
              ><span class="points-container"
                >Points: <span class="points">1560</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40358041"
                  >Comments</a
                ><span class="descendants">: 444</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40353842">
          <h3>
            <a
              class="item"
              href="https://www.cambridge.org/core/journals/antiquity/article/trypillia-megasites-a-social-levelling-concept/A0048EA63DA8D0B00A513BFD7C24A679"
              >Ancient Eastern European mega-sites: a social levelling
              concept?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 11:06:07</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40353842"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40353694">
          <h3>
            <a
              class="item"
              href="https://blog.can.ac/2021/03/22/speculating-x86-64-isa-with-one-weird-trick/"
              >Speculating the entire x86-64 instruction set in seconds
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 10:42:03</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40353694"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40353630">
          <h3>
            <a class="item" href="https://github.com/kshetline/prague-clock"
              >Prague Astronomical Clock Simulator (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 10:30:23</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40353630"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40353605">
          <h3>
            <a
              class="item"
              href="https://medium.com/pinterest-engineering/hbase-deprecation-at-pinterest-8a99e6c8e6b7"
              >HBase Deprecation at Pinterest</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 10:27:32</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40353605"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40352472">
          <h3>
            <a
              class="item"
              href="https://causal.app/blog/forecasting-with-uncertainty"
              >The Flaw of Averages (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 07:14:36</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40352472"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40342057">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2024/05/how-did-authorities-identify-the-alleged-lockbit-boss/"
              >How did authorities identify the alleged LockBit boss?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 11:36:10</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40342057"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
