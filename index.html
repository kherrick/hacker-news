<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39271297">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/2024/feb/05/cern-atom-smasher-unlock-secrets-universe-large-hadron-collider"
              >CERN aims to build €20B collider to unlock secrets of universe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 06:05:30</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39271297"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39271243">
          <h3>
            <a
              class="item"
              href="https://tylersticka.com/journal/browsers-are-weird-right-now/"
              >Browsers Are Weird</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 05:53:58</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39271243"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39270681">
          <h3>
            <a
              class="item"
              href="https://www.tbray.org/ongoing/When/202x/2024/02/02/Vision-1993"
              >Vision 1993</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 04:09:58</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39270681"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39270215">
          <h3>
            <a
              class="item"
              href="https://9to5google.com/2023/11/20/lineageos-number-of-devices/"
              >LineageOS is currently installed on 1.5M Android devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 02:54:19</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39270215"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39269742">
          <h3>
            <a
              class="item"
              href="http://old.math.nsc.ru/LBRT/g2/english/ssk/case_e.html#contents"
              >The tragedy of mathematics in Russia (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 01:44:01</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39269742"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39269497">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/it-s-insane-new-viruslike-entities-found-human-gut-microbes"
              >New viruslike entities found in human gut microbes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 01:10:41</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39269497"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39269418">
          <h3>
            <a class="item" href="https://panda-css.com/"
              >Panda CSS: build time and type-safe CSS-in-JS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 00:59:39</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39269418"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39269327">
          <h3>
            <a
              class="item"
              href="https://keydiscussions.com/2024/02/05/sim-swap-attacks-can-be-blamed-on-companies-embracing-sms-based-password-resets/"
              >Companies embracing SMS for account logins should be blamed for
              SIM-swap attacks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 00:48:37</span
              ><span class="points-container"
                >Points: <span class="points">355</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39269327"
                  >Comments</a
                ><span class="descendants">: 239</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39268572">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/world-europe-68209691"
              >Organ playing 639-year-long piece changes chord</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 23:19:30</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39268572"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39268530">
          <h3>
            <a
              class="item"
              href="https://mina.naguib.ca/blog/2012/10/22/the-little-ssh-that-sometimes-couldnt.html"
              >The little SSH that sometimes couldn't (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 23:14:51</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39268530"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39268460">
          <h3>
            <a
              class="item"
              href="https://dmitry.gr/?r=05.Projects&amp;proj=33.+LinuxCard"
              >My business card runs Linux and Ultrix (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 23:06:22</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39268460"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39268106">
          <h3>
            <a
              class="item"
              href="https://eos.org/articles/weve-already-seen-category-6-hurricanes-now-scientists-want-to-make-it-official"
              >We've already seen category 6 hurricanes – scientists want to
              make it official</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 22:27:08</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39268106"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39266859">
          <h3>
            <a
              class="item"
              href="http://omicsomics.blogspot.com/2024/02/want-to-build-sequencer-454bio-opens-up.html"
              >Want to build a sequencer? 454.bio opens up their plans</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 20:41:39</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39266859"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39266396">
          <h3>
            <a class="item" href="https://dmytry.github.io/space/"
              >Relativistic Spaceship</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 20:07:47</span
              ><span class="points-container"
                >Points: <span class="points">593</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39266396"
                  >Comments</a
                ><span class="descendants">: 310</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39266112">
          <h3>
            <a class="item" href="https://github.com/narfindustries/http-garden"
              >Show HN: The HTTP Garden – A Parser Vulnerability Research
              Tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 19:48:54</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39266112"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                I started the internship having never worked with web servers,
                and have now found over 100 HTTP implementation bugs. I
                attribute this mostly to the ease of experimentation in the
                Garden. REPL-oriented fuzzing is just a really good interface
                for finding parsing bugs. It's pretty neat to able to run a
                differential fuzzer, categorize and display all the discovered
                discrepancies, then let a human pick through them and interact
                with fuzz targets to test whether the bugs are exploitable.
              </p>
              <p>
                Some notable server combinations in which we discovered new
                request smuggling attacks include Google Cloud &lt;-&gt;
                Node.js, Akamai &lt;-&gt; Node.js, [almost anything] &lt;-&gt;
                LiteSpeed, and OpenBSD relayd &lt;-&gt; [anything].
              </p>
              <p>
                We also found an infinite loop DoS in Cesanta Mongoose that
                affects all configurations, and a null pointer dereference that
                can crash any OpenBSD httpd server that uses FastCGI.
              </p>
            </div>
          </section>
        </section>
        <section id="39265756">
          <h3>
            <a class="item" href="https://github.com/dvcoolarun/web2pdf"
              >Show HN: CLI for generating PDFs for offline reading</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 19:24:48</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39265756"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <p>
                [Edit] Sample PDF ::
                <a
                  href="https://drive.google.com/file/d/1n7M1TKOptSsYiibrbvV_Yojx53TK3k5E/view"
                  >https://drive.google.com/file/d/1n7M1TKOptSsYiibrbvV_Yojx53T...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39264487">
          <h3>
            <a
              class="item"
              href="https://blog.peerdb.io/reducing-bigquery-costs-by-260x"
              >Reducing BigQuery Costs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 18:09:58</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39264487"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39263854">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39263854"
              >Show HN: Atopile – Design circuit boards with code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 17:30:50</span
              ><span class="points-container"
                >Points: <span class="points">449</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39263854"
                  >Comments</a
                ><span class="descendants">: 231</span></span
              >
            </h4>
            <div class="text">
              <a href="https://youtu.be/7-Q0XVpfW3Y"
                >https://youtu.be/7-Q0XVpfW3Y</a
              >
              <p>
                Could you imagine the pain of building an entire software
                product using only assembly code? That’s about how we felt
                designing hardware. We don’t currently have good ways to
                describe what we need, reuse existing designs and compile that
                description down to a product.
              </p>
              <p>
                We started atopile to fix this. atopile is an open-source
                language and toolchain to describe circuits with code. The
                compiler is here:
                <a href="https://github.com/atopile/atopile"
                  >https://github.com/atopile/atopile</a
                >
                Docs are here:
                <a href="https://atopile.io/getting-started/"
                  >https://atopile.io/getting-started/</a
                >
                . For a detailed deep dive designing an ESP32 module, see this
                video:
                <a href="https://youtu.be/eMWRwZOajdQ"
                  >https://youtu.be/eMWRwZOajdQ</a
                >
              </p>
              <p>
                We realized this was a problem in our previous jobs. Narayan and
                I (Tim) had to manually, draw and export all our electronic
                circuit boards. This lasted until our friend Matt, a software
                engineer, showed us his development workflow. All his projects
                were built, tested, and merged automatically via GitHub. So we
                asked: Can we build the same for hardware?
              </p>
              <p>
                We observed that the ability to abstract electronics effectively
                hinged on using a language to describe the requirements, so we
                came up with the “ato” language. In ato, you can break down
                circuits into modules, components and interfaces. You can nest
                and connect those blocks with each other. Here is an example
                with an RP2040 microcontroller:
              </p>
              <p></p>
              <pre><code>  import RP2040Kit from "rp2040/RP2040Kit.ato"
  import LEDIndicatorBlue from "generics/leds.ato"
  import LDOReg3V3 from "regulators/regulators.ato"
  import USBCConn from "usb-connectors/usb-connectors.ato"

  module Blinky:
    micro_controller = new RP2040Kit
    led_indicator = new LEDIndicatorBlue
    voltage_regulator = new LDOReg3V3
    usb_c_connector = new USBCConn

    usb_c_connector.power ~ voltage_regulator.power_in
    voltage_regulator.power_out ~ micro_controller.power
    micro_controller.gpio13 ~ led_indicator.input
    micro_controller.power.gnd ~ led_indicator.gnd

    led_indicator.resistor.value = 100ohm +/- 10%

</code></pre>
              From there, the compiler produces a netlist that describes how the
              circuit is connected and selects jelly-bean components for you (<a
                href="https://atopile.io/blog/2024/01/31/cloud-components/"
                >https://atopile.io/blog/2024/01/31/cloud-components/</a
              >). Our next focus will be to add layout reuse, mathematical
              relations between values and define circuits by traits (similar to
              Rusts’).
              <p>
                At the moment, atopile is intended to design all types of
                printed circuit boards (PCB) with low to medium complexity. The
                circuit complexity that the compiler can handle will steadily
                increase until it becomes suited for production usage. We often
                get asked if the compiler is meant for chip design rather than
                PCBs, but that is not the case. The language is exclusive to
                PCBs. At least for now..!
              </p>
              <p>
                A big part of why the software community is so prolific is
                thanks to open source and open core technology. The ability to
                share software packages with each other and efficiently chain
                tools together has made the software world an awesome place for
                developers. As hardware engineers, we would love our field to
                benefit from this as well. That’s why we’ve made atopile’s core
                open source (Apache 2.0). We plan to generate revenue by selling
                entreprise targeted features, similar to GitLab.
              </p>
              <p>
                We would love to have your thoughts on the compiler! What’s your
                story in electronics? What would you want us to build?
              </p>
            </div>
          </section>
        </section>
        <section id="39263453">
          <h3>
            <a
              class="item"
              href="https://www.ashbyhq.com/careers?ashby_jid=933570bc-a3d6-4fcc-991d-dc399c53a58a"
              >Ashby (YC W19) is hiring a product engineering manager in
              Americas (remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 17:00:26</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39262650">
          <h3>
            <a
              class="item"
              href="https://www.linkedin.com/posts/richardsonalexis_hi-everyone-i-am-very-sad-to-announce-activity-7160295096825860096-ZS67"
              >Weaveworks is shutting down</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 16:06:50</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39262650"
                  >Comments</a
                ><span class="descendants">: 191</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39261861">
          <h3>
            <a class="item" href="https://scrollprize.org/grandprize"
              >Vesuvius Challenge 2023 Grand Prize awarded: we can read the
              first scroll</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 15:00:02</span
              ><span class="points-container"
                >Points: <span class="points">858</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39261861"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39261486">
          <h3>
            <a class="item" href="https://github.com/cfahlgren1/natural-sql"
              >Show HN: Natural-SQL-7B, a strong text-to-SQL model</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 14:22:36</span
              ><span class="points-container"
                >Points: <span class="points">301</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39261486"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
            <div class="text">
              <p>
                Here is the HF page:
                <a href="https://huggingface.co/chatdb/natural-sql-7b"
                  >https://huggingface.co/chatdb/natural-sql-7b</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39261333">
          <h3>
            <a
              class="item"
              href="https://www.newscientist.com/article/2415469-mathematicians-have-finally-proved-that-bach-was-a-great-composer/"
              >Analysis of Bach's information-dense music</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 14:08:07</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39261333"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39249406">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/first-gen-social-media-users-have-nowhere-to-go/"
              >First-Gen Social Media Users Have Nowhere to Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 11:24:02</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39249406"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39249378">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/collectibles/bookfind-of-the-century-sells-for-2-23-million/"
              >"Bookfind of the century" sells for $2.23M</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 11:19:26</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39249378"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39249282">
          <h3>
            <a class="item" href="https://github.com/corkami/collisions"
              >Hash collisions and exploitations (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 11:02:49</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39249282"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39248437">
          <h3>
            <a
              class="item"
              href="http://bitsavers.trailing-edge.com/pdf/xerox/parc/techReports/VLSI-81-1_The_Optical_Mouse.pdf"
              >The Optical Mouse [pdf] (1981)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 07:48:18</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39248437"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39248292">
          <h3>
            <a
              class="item"
              href="https://silent-tower.net/projects/visual-overview-malloc"
              >Visual overview of a custom malloc() implementation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 07:11:54</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39248292"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39248110">
          <h3>
            <a
              class="item"
              href="https://haseebq.com/how-not-to-bomb-your-offer-negotiation/"
              >How not to bomb your offer negotiation (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 06:33:22</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39248110"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39237874">
          <h3>
            <a class="item" href="https://mattgreer.dev/blog/mame-debugging/"
              >MAME Debugging</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-03 @ 05:50:36</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39237874"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
