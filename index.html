<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36853220">
          <h3>
            <a class="item" href="https://percisely.xyz/syncronicity"
              >Time, Clocks, and the Ordering of Events in a Distributed System
              – Paper Review</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 19:41:16</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36853220"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36853207">
          <h3>
            <a class="item" href="https://github.com/emvi/xbegone"
              >Show HN: Browser extension replacing the X with the original
              Twitter logo</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 19:39:38</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36853207"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36853166">
          <h3>
            <a
              class="item"
              href="https://www.intel.com/content/www/us/en/developer/articles/technical/advanced-performance-extensions-apx.html"
              >Intel Advanced Performance Extensions (Intel APX)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 19:35:32</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36853166"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36852971">
          <h3>
            <a class="item" href="https://brev.dev/blog/fine-tuning-llama-2"
              >A simple guide to fine-tuning Llama 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 19:18:26</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36852971"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36852856">
          <h3>
            <a
              class="item"
              href="https://www.independent.co.uk/tech/solar-panel-perovskite-double-sided-b2378337.html"
              >Scientists invent double-sided solar panel that generates way
              more electricity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 19:06:36</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36852856"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36852231">
          <h3>
            <a class="item" href="https://paraxial.io/blog/still-safe"
              >Elixir Is (Still) Safe</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 18:22:37</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36852231"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36851930">
          <h3>
            <a class="item" href="https://openreview.net/forum?id=wK7wUdiM5g0"
              >Text Embeddings Reveal (Almost) as Much as Text</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 18:03:02</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36851930"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36851644">
          <h3>
            <a
              class="item"
              href="https://slimemoldtimemold.com/2023/07/24/your-mystery-have-attention-spans-been-declining/"
              >Have attention spans been declining?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 17:43:37</span
              ><span class="points-container"
                >Points: <span class="points">267</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36851644"
                  >Comments</a
                ><span class="descendants">: 188</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36851505">
          <h3>
            <a class="item" href="https://kxgong.github.io/meta_transformer/"
              >Meta-Transformers: Transformers Are Becoming Multi-Modal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 17:33:52</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36851505"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36851494">
          <h3>
            <a
              class="item"
              href="https://www.evanmiller.org/attention-is-off-by-one.html"
              >Attention Is Off By One</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 17:33:06</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36851494"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36851054">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/61922/"
              >Emerge Tools (YC W21) is hiring a senior front end engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 17:01:05</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36850554">
          <h3>
            <a
              class="item"
              href="https://github.com/camenduru/text-to-video-synthesis-colab"
              >Text-to-Video-Synthesis-Colab</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 16:29:01</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36850554"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36850111">
          <h3>
            <a
              class="item"
              href="https://www.damninteresting.com/the-gimli-glider/"
              >40 years ago yesterday Air Canada Flight 143 ran out of fuel
              mid-flight</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 16:03:03</span
              ><span class="points-container"
                >Points: <span class="points">231</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36850111"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36849784">
          <h3>
            <a class="item" href="https://queue.acm.org/detail.cfm?id=3595862"
              >How capacity planners credibly estimate application
              performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 15:42:25</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36849784"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36849502">
          <h3>
            <a class="item" href="https://projectionlab.com/"
              >Show HN: I spent 2 years building a personal finance simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 15:25:06</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36849502"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
            <div class="text">
              <a href="https://news.ycombinator.com/item?id=31083093"
                >https://news.ycombinator.com/item?id=31083093</a
              >.
              <p>
                TL;DR - ProjectionLab (<a href="https://projectionlab.com"
                  >https://projectionlab.com</a
                >) is a privacy-friendly personal finance planning tool where
                you can create financial plans that go beyond the standard
                online retirement calculators. And by popular request, it now
                supports self-hosting for Lifetime users!
              </p>
              <p>
                Something I'm grateful for is that our community here on HN is
                the difference between PL existing and not. There was actually a
                time early on when I was one day away from halting work on it. I
                posted here on a whim, and was shocked to receive some really
                constructive and energizing feedback that went on to power my
                indie dev journey over the past two and a half years.
              </p>
              <p>
                As a quick recap, the story started when I dove head-first down
                the financial independence rabbit hole. I wanted a hands-on and
                visual way to explore the trade-offs between different life
                paths. One thing led to another, and I decided to build
                ProjectionLab.
              </p>
              <p>
                After last year's Show HN, I really put my nose to the
                grindstone, and here are some of the big developments:
              </p>
              <p>
                - Self-hosting for Lifetime users (spin up your own private
                deployment, based on Docker Compose, includes support for
                auth/encryption)
              </p>
              <p>
                - Cash-flow visualization for each simulated year (sankey
                charts)
              </p>
              <p>
                - Tax analytics (detailed breakdowns for projected income,
                taxes, marginal rates, effective brackets, etc)
              </p>
              <p>
                - Major redesign of entire app, with landing page and resources
                now split into separate project
              </p>
              <p>
                - Filing separately option to improve support for international
                locations that don't have joint filing
              </p>
              <p>- Roth Conversions and 72t (SEPP) distribution modeling</p>
              <p>
                - Improvements to US tax estimation (Secure 2.0 updates, rental
                property tax deductions, Medicare + IRMAA, NIIT, principal
                residence exclusion, etc)
              </p>
              <p>- Better support for planning as a couple</p>
              <p>
                - More modeling options for cash-flow priorities to support
                different budgeting philosophies and goals
              </p>
              <p>
                - Extra liquidity + withdrawal options, ability to fund expenses
                with specific accounts or route income to specific accounts
              </p>
              <p>
                - Customization options for Monte Carlo simulations
                (characterization of success rates and outcome types, option to
                set random seed, etc)
              </p>
              <p>
                - And a whole bunch more! (<a
                  href="https://projectionlab.com/changelog"
                  >https://projectionlab.com/changelog</a
                >)
              </p>
              <p>
                The HN community has had a huge role in shaping my overall
                direction with PL, and I can't wait to hear what you all think
                of the updates and where you would like to see things go from
                here.
              </p>
              <p>
                As always, PL is free to try, with no need to create an account.
                It does not ask to link your financial accounts, and it has a
                sandbox mode if you just want to hop in and see how it works.
              </p>
              <p>--Kyle</p>
            </div>
          </section>
        </section>
        <section id="36849478">
          <h3>
            <a class="item" href="https://github.com/ocaml-wasm/wasm_of_ocaml"
              >Wasm_of_OCaml</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 15:23:30</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36849478"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36848680">
          <h3>
            <a class="item" href="https://lock.cmpxchg8b.com/zenbleed.html"
              >Zenbleed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 14:34:31</span
              ><span class="points-container"
                >Points: <span class="points">599</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36848680"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36848305">
          <h3>
            <a
              class="item"
              href="https://www.gsb.stanford.edu/insights/indulging-guilty-pleasure-dont-put-it-card"
              >Cash Amnesia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 14:11:52</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36848305"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36847960">
          <h3>
            <a class="item" href="https://map.henryn.xyz"
              >Show HN: I built a transit travel time map</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 13:49:08</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36847960"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
            <div class="text">
              <p>
                The backend is written in Rust. It parses public GTFS data from
                transit agencies and performs a simple heuristics-based BFS on
                the bus lines to calculate how long to reach all points in a
                city.
              </p>
              <p>
                The frontend uses React and Mapbox GL to render each individual
                road segment based on how long it takes to reach.
              </p>
              <p>
                This project was a great excuse to learn Rust, deployments, and
                mapping. The source code is here if you are interested:
                <a href="http://github.com/econaxis/time2reach"
                  >http://github.com/econaxis/time2reach</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36847958">
          <h3>
            <a class="item" href="https://arxiv.org/abs/0704.0646"
              >The Mathematical Universe Hypothesis (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 13:48:37</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36847958"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36847569">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36847569"
              >Launch HN: Artie (YC S23) – Real time data replication to data
              warehouses</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 13:21:19</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36847569"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.artie.so/">https://www.artie.so/</a>). We
              solve the problem of stale production data in the data warehouse.
              We’re open source, and you can try it for free here:
              <a href="https://github.com/artie-labs/transfer"
                >https://github.com/artie-labs/transfer</a
              >.
              <p>
                Specifically, we do real time data replication from databases to
                data warehouses. We leverage change data capture (CDC) and
                stream processing to perform data transfers efficiently,
                enabling sub-minute latency and significant cost savings. Here’s
                a quick demo (jumping straight to the important part):
                <a href="https://www.youtube.com/watch?v=uAi1tm4gd9U#t=81s"
                  >https://www.youtube.com/watch?v=uAi1tm4gd9U#t=81s</a
                >.
              </p>
              <p>
                I encountered this problem when I was a heavy data warehouse
                user at prior jobs. The data in our data warehouse was super
                lagged and analytics were always stale. Imagine a fintech
                company performing anti-fraud/transaction monitoring with
                batched ETLs and finding out that fraudulent transactions
                occurred 24 hours ago. This was very frustrating to me! Since my
                background was in distributed systems and database architecture,
                I knew that there was a better way to perform data transfers.
              </p>
              <p>
                The more teams I spoke with, the more I realized this was a real
                pain point. People wanted real time data for analytics, fraud
                alerting, transaction monitoring, and training AI/ML models; but
                there wasn’t an easy out-of-the-box solution. Companies were
                either constrained on latency or schema integrity/data usability
                or data accuracy. Companies started telling me that if I built a
                tool that is robust, near real time, but also maintained schema
                integrity and data accuracy, they would very happily pay for it.
              </p>
              <p>
                So I built Artie, a real time, open-source data streaming
                solution to transfer data from databases to data warehouses and
                handle schemas automatically in-flight (DMLs and DDLs).
              </p>
              <p>
                Typical ETL solutions leverage batched processes that run on a
                schedule (DAGs, Airflow), which cannot achieve real time data
                syncs. This means that when companies aggregate production data
                into their data warehouse, the underlying data is always stale.
              </p>
              <p>
                Streaming change data capture (CDC) logs is a more efficient way
                to transfer data, and helps lower networking/data ingestion
                costs as well. However, building data pipelines with CDC
                streaming is complicated. I wanted Artie to be the tool that
                abstracts away that complexity so that any company can benefit
                from having real time data.
              </p>
              <p>
                A big challenge is implementing CDC streaming for stateful data
                (i.e. row updates/deletes) and schema changes (DDLs), which most
                streaming solutions just don’t address, meaning that complexity
                is passed down to the customer. A lot of in-house streaming
                solutions leverage some combination of Debezium + Kafka/Kinesis
                + Apache Flink and are able to achieve near real time syncs, but
                they only handle append-only events (inserts) and don't handle
                schema changes/schema evolution like DMLs and DDLs. Not handling
                thse means the data at the destination doesn't look exactly like
                the production database, which obscures the source of truth. You
                end up having to do additional work to make the data warehouse
                tables match the source DB.
              </p>
              <p>
                So how do we offer a robust CDC streaming solution? We grab CDC
                logs using Debezium and/or our custom connector (which solves
                for certain edge cases that Debezium doesn’t handle) and push
                them into Kafka (or Google Pub/Sub). Kafka helps ensure ordering
                and ease of recovery upon an outage - we use one table per
                topic, and the partition key is the primary key(s) to ensure no
                out of order writes. Artie then consumes these events from Kafka
                and we have an in-memory DB with our typing library that can
                infer schemas (DML and DDL), performs optimizations like
                deduplications, and then flushes data to the data warehouse.
                When the data warehouse confirms a successful merge, we then
                commit the offset within Kafka. This all happens with sub-minute
                data latency even at high volumes (several TBs or billions of
                rows).
              </p>
              <p>
                However the data looks in your database, it should look exactly
                the same in your data warehouse. We also strive to handle all
                data types with no exceptions - i.e. supporting TOAST columns,
                composite keys as primary keys, arrays, large rows (&gt;1MBs),
                etc. (I say “strive” because I’m sure we haven’t seen all
                possible data types yet!).
              </p>
              <p>
                We’ve been live for a while now. Several companies use us to
                update all their analytic dashboards in real time (with
                dashboards built on top of their data warehouse). Fintech
                platforms use us to perform financial transaction monitoring. A
                utilities software platform uses us to grab video/photo data to
                perform risk/hazard assessment against ML models.
              </p>
              <p>
                Artie is live and supports PostgreSQL, MySQL, MongoDB sources
                and Snowflake, BigQuery, Redshift destinations. We make money
                from our hosted service. We charge based on usage (# of rows
                transferred per month, not including initial snapshots).
              </p>
              <p>
                We’d love for you to try it out! You can get started with the
                open source version here:
                <a href="https://github.com/artie-labs/transfer"
                  >https://github.com/artie-labs/transfer</a
                >. We have a small OSS Slack community (www.artie.so/slack) –
                feel free to ping us for help or any other requests.
              </p>
              <p>
                For our hosted version, we need to ensure that we have enough
                storage and compute capacity provisioned, so we’re asking cloud
                users to hop on a quick call with us before we activate your
                account. Eventually we’ll have easy self-serve functionality but
                that’s not 100% built yet, so for now we set up a Slack channel
                to ensure smooth deployments. If you’re willing to work with us
                on that, we’ll be super excited to show you what we’ve got. Just
                email us at founders@artie.so or request access from
                <a href="https://www.artie.so">https://www.artie.so</a>.
              </p>
              <p>
                We’d love for you to try the OSS or hosted solution and give us
                feedback! We’re eager to improve the product and test it against
                various workloads and data types :)
              </p>
            </div>
          </section>
        </section>
        <section id="36847133">
          <h3>
            <a
              class="item"
              href="https://pikchr.org/home/doc/trunk/doc/userman.md"
              >Pikchr: A PIC-like markup language for diagrams in technical
              documentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 12:48:33</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36847133"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36846567">
          <h3>
            <a
              class="item"
              href="https://www.encrypted.at/android-captive-portal/"
              >Changing the Android captive portal page (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 12:07:00</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36846567"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36846520">
          <h3>
            <a class="item" href="https://driverjs.com/"
              >Driver.js: Product tours, highlights, contextual help and more</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 12:02:50</span
              ><span class="points-container"
                >Points: <span class="points">266</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36846520"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36845714">
          <h3>
            <a
              class="item"
              href="https://jessems.com/posts/2023-07-22-the-unreasonable-effectiveness-of-sequence-diagrams-in-mermaidjs"
              >The Unreasonable Effectiveness of Sequence Diagrams in
              MermaidJS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 10:45:26</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36845714"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36838750">
          <h3>
            <a
              class="item"
              href="https://www.cjr.org/special_report/great-magazines-saturday-evening-post.php"
              >The persistence of the Saturday Evening Post (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 19:24:16</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36838750"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36835900">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/interactive/2023/07/21/science/bird-calls-songs-quiz.html"
              >Can you understand bird? Test your recognition of calls and
              songs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 14:54:20</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36835900"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36833017">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/science.adf8009"
              >The genetic architecture and evolution of the human skeletal
              form</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 06:24:41</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36833017"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36832999">
          <h3>
            <a
              class="item"
              href="https://businessday.ng/life-arts/article/the-secret-economics-of-the-birkin-bag/"
              >The Secret Economics of the Birkin Bag</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 06:20:21</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36832999"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36823673">
          <h3>
            <a class="item" href="https://wmay.github.io/euc-safety/"
              >How to stay safe and happy on an electric unicycle</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-22 @ 05:53:05</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36823673"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
