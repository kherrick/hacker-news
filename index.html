<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36219051">
          <h3>
            <a class="item" href="https://www.tesorio.com/careers#job-openings"
              >Tesorio (YC S15) Is Hiring Back End Engineers, DevOps and Head of
              Marketing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 21:00:18</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36218932">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2023/06/06/sec-asks-for-emergency-order-to-freeze-binance-us-assets-anywhere-in-the-world.html"
              >SEC asks for emergency order to freeze Binance US assets anywhere
              in the world</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 20:49:31</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36218932"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36218330">
          <h3>
            <a
              class="item"
              href="https://twitter.com/davidecci/status/1665835119331135488"
              >Apple Releases New Static Linker</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 19:59:31</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36218330"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36217746">
          <h3>
            <a
              class="item"
              href="https://fermatslibrary.com/s/early-dispersal-of-domestic-horses-into-the-great-plains-and-northern-rockies"
              >Early dispersal of domestic horses into the Great Plains and
              northern Rockies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 19:17:57</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36217746"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36216959">
          <h3>
            <a
              class="item"
              href="https://www.lse.ac.uk/News/Latest-news-from-LSE/2021/k-November-21/Octopuses-crabs-and-lobsters-welfare-protection"
              >Octopuses, crabs and lobsters to be recognised as sentient beings
              under UK law</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 18:19:15</span
              ><span class="points-container"
                >Points: <span class="points">317</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36216959"
                  >Comments</a
                ><span class="descendants">: 321</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36216745">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2023/jun/06/whistleblower-ufo-alien-tech-spacecraft"
              >US urged to reveal UFO evidence after claim that it has intact
              alien vehicles</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 18:04:52</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36216745"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36216532">
          <h3>
            <a class="item" href="https://github.com/princeton-nlp/MeZO"
              >MeZO: Fine-Tuning Language Models with Just Forward Passes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 17:49:06</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36216532"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36216389">
          <h3>
            <a class="item" href="https://www.evanjones.ca/isspace_locale.html"
              >The C Standard Library Function Isspace() Depends on Locale</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 17:40:23</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36216389"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36215924">
          <h3>
            <a
              class="item"
              href="https://sod.pixlab.io/articles/modern-image-processing-algorithms-implementation.html"
              >Modern Image Processing Algorithms Implementation in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 17:07:43</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36215924"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36215651">
          <h3>
            <a class="item" href="http://ggml.ai">GGML – AI at the Edge</a>
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 16:50:34</span
              ><span class="points-container"
                >Points: <span class="points">398</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36215651"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36215357">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/documentation/SwiftData"
              >SwiftData</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 16:33:25</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36215357"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36214781">
          <h3>
            <a
              class="item"
              href="https://pmarca.substack.com/p/why-ai-will-save-the-world"
              >AI will save the world?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 15:56:55</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36214781"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36213704">
          <h3>
            <a class="item" href="https://counterexamples.org/intro.html"
              >Counterexamples in Type Systems: programs that crash, segfault or
              explode (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 14:51:15</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36213704"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36212903">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36212903"
              >Launch HN: Seam (YC S20) – API for IoT Devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 14:00:21</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212903"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.seam.co">https://www.seam.co</a>), a
              universal API for controlling IoT devices such as smart locks,
              thermostats, sensors, and (soon) cameras. Our hope is to make
              device integration simple, with a Plaid-like UI flow for obtaining
              device authorization and standardized API/SDKs for device control.
              <p>
                We started Seam out of our frustration with the challenges of
                integrating IoT devices with software apps.
              </p>
              <p>
                For example, my co-founder Dawn led Sonder's efforts to
                integrate smartlocks with their reservation systems in order to
                automate access for guests. She struggled with poorly documented
                and unreliable device APIs along the way. Our founding engineer
                Max authored the popular TuyAPI library and has spent countless
                hours trying to build sensible interfaces on top of unreliable
                devices.
              </p>
              <p>
                For my part, I was an early engineer at Nest and saw firsthand
                how manufacturers often lack the resources and motivation to
                support third-party developers.
              </p>
              <p>
                As a result, most devices lack public APIs, and getting access
                to the private ones (if they exist) requires lengthy
                negotiations with manufacturers. This task grows in complexity
                with each additional device brand a developer may need to
                integrate.
              </p>
              <p>
                Seam serves as a single API that works across dozens of brands
                and hundreds of devices.
              </p>
              <p>
                We start by testing each device in our hardware lab in San
                Francisco. We study their behaviors &amp; quirks, and faithfully
                reproduce those in our development sandbox. We take time to
                craft custom client libraries that maximize developer ergonomics
                while accounting for the asynchronous nature of the devices. We
                offer pre-built UI components (React, Web-native…etc) to let
                developers rapidly assemble complex UIs that can manage large
                fleets of devices. And we even have a small hardware gateway to
                connect on-prem and legacy devices.
              </p>
              <p>
                A few app developers like Guesty (YC S14) already use Seam to
                connect to their end users’ devices. We have a generous free
                tier and charge a small fee for additional devices. We work
                closely with manufacturers to improve device reliability, add
                OAuth support, and patch security holes. We also spend time
                educating them on the importance of supporting open source
                projects like Home Assistant, OpenHab...etc and we will be
                contributing some of our own integrations to those ecosystems.
              </p>
              <p>
                Seam is still very much a work in progress with many aspects
                that need to be improved. But our hope is that it will help push
                IoT devices from being (mostly) point solutions, to becoming a
                set of API endpoints software engineers can tap to interact with
                the physical world.
              </p>
            </div>
          </section>
        </section>
        <section id="36212865">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/in-new-paradox-black-holes-appear-to-evade-heat-death-20230606/"
              >In New Paradox, Black Holes Appear to Evade Heat Death</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 13:57:56</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212865"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36212674">
          <h3>
            <a
              class="item"
              href="https://asahilinux.org/2023/06/opengl-3-1-on-asahi-linux/"
              >OpenGL 3.1 on Asahi Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 13:46:13</span
              ><span class="points-container"
                >Points: <span class="points">367</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212674"
                  >Comments</a
                ><span class="descendants">: 216</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36212242">
          <h3>
            <a
              class="item"
              href="https://www.bhf.org.uk/what-we-do/news-from-the-bhf/news-archive/2023/june/heart-attack-more-common-monday"
              >Deadly heart attacks are more common on a Monday</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 13:19:59</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212242"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36212120">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/legal/us-sec-sues-coinbase-over-failure-register-2023-06-06/"
              >US SEC sues Coinbase, one day after suing Binance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 13:10:56</span
              ><span class="points-container"
                >Points: <span class="points">472</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212120"
                  >Comments</a
                ><span class="descendants">: 342</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36210986">
          <h3>
            <a
              class="item"
              href="https://pennylane.ai/qml/demos/tutorial_zx_calculus.html"
              >Introduction to the ZX-Calculus</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 11:17:07</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36210986"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36210805">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/06/reddits-plan-to-kill-third-party-apps-sparks-widespread-protests/"
              >Reddit’s plan to kill third-party apps sparks widespread
              protests</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 10:52:36</span
              ><span class="points-container"
                >Points: <span class="points">824</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36210805"
                  >Comments</a
                ><span class="descendants">: 415</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36210548">
          <h3>
            <a class="item" href="https://lethain.com/digg-v4/"
              >Digg's v4 launch: an optimism born of necessity (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 10:13:47</span
              ><span class="points-container"
                >Points: <span class="points">228</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36210548"
                  >Comments</a
                ><span class="descendants">: 252</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36210133">
          <h3>
            <a
              class="item"
              href="https://twitter.com/sterlingcrispin/status/1665792422914453506"
              >Apple Vision predictive bio-feedback</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 09:09:29</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36210133"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36209408">
          <h3>
            <a class="item" href="https://developer.apple.com/passkeys/"
              >Passkeys now support external providers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 07:29:19</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36209408"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36209047">
          <h3>
            <a
              class="item"
              href="https://www.nvidia.com/en-us/data-center/grace-hopper-superchip/"
              >Nvidia releases new AI chip with 480GB CPU RAM, 96GB GPU RAM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 06:46:31</span
              ><span class="points-container"
                >Points: <span class="points">322</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36209047"
                  >Comments</a
                ><span class="descendants">: 255</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36209014">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/wwdc23/topics/ml-vision/"
              >Apple releasing segmentation/pose for humans and animals,
              embedding for 27 lang</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 06:42:31</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36209014"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36208942">
          <h3>
            <a class="item" href="https://jonbarron.info/zipnerf/"
              >Zip-NeRF: Anti-Aliased Grid-Based Neural Radiance Fields</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 06:32:58</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36208942"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36208499">
          <h3>
            <a
              class="item"
              href="https://literaryreview.co.uk/was-he-apollos-son"
              >Was He Apollo’s Son?: Review of Plato of Athens</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 05:26:32</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36208499"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36200895">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Hierapolis_sawmill"
              >Hierapolis Sawmill</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-05 @ 18:34:08</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36200895"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36197588">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-05-scientists-world-x-ray-atom.html"
              >Scientists' report first X-ray of a single atom</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-05 @ 15:25:08</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36197588"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36193315">
          <h3>
            <a class="item" href="https://github.com/reactive-python/reactpy"
              >React, but in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-05 @ 07:02:21</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36193315"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
