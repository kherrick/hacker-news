<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35353843">
          <h3>
            <a
              class="item"
              href="https://mstdn.science/@ukrio/110100752908161183"
              >Now ChatGPT is being (mis)used to do PeerReview</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 07:34:29</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35353843"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35353264">
          <h3>
            <a
              class="item"
              href="https://www.bleepingcomputer.com/news/security/wifi-protocol-flaw-allows-attackers-to-hijack-network-traffic/"
              >WiFi protocol flaw allows attackers to hijack network traffic</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 06:08:29</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35353264"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35352989">
          <h3>
            <a
              class="item"
              href="https://staging.rickconsole.com/posts/hardware-hacking-tp-link/"
              >Establishing a UART Root Connection to a TP-Link Wireless
              Router</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 05:22:51</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35352989"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35352771">
          <h3>
            <a
              class="item"
              href="https://www.muledesign.com/blog/brainstorm-questions"
              >Brainstorm Questions Not Ideas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 04:51:42</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35352771"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35352452">
          <h3>
            <a
              class="item"
              href="https://github.com/Picsart-AI-Research/Text2Video-Zero"
              >Text2Video-Zero Code and Weights Released by Picsart AI Research
              (12G VRAM)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 04:15:08</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35352452"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35352247">
          <h3>
            <a class="item" href="https://www.gptcalculator.xyz/"
              >Show HN: GPT Calculator – Calculate the token count and cost of
              your GPT Prompt</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 03:55:42</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35352247"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35352094">
          <h3>
            <a
              class="item"
              href="https://www.eurekalert.org/news-releases/983050?"
              >New insights into why aspirin works so well</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 03:39:51</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35352094"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35351805">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/binance-sees-2-billion-in-outflows-as-troubles-compound-9a136e21"
              >Binance sees $2B in outflows as troubles compound</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 03:09:24</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35351805"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35350952">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/disney-eliminates-its-metaverse-division-as-part-of-companys-layoffs-plan-94b03650"
              >Disney Eliminates Its Metaverse Division</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 01:40:54</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35350952"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35350662">
          <h3>
            <a class="item" href="https://libraria.dev/"
              >Show HN: Customizable, embeddable Chat GPT based on your own
              documents</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 01:11:18</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35350662"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
            <div class="text">
              <p>
                My name is Bea, I built a site called Libraria that uses GPT to
                do a few things
              </p>
              <p>
                1. Let you spin up multiple assistants based on your own
                documents. You can make it public, private, or protected. It has
                its own subdomain and landing page. 2. Respond in full markdown
                always, so it can output images, links, code, and more 3. Let
                you upload articles on the fly within the Chat, so you can ask
                it questions 4. Make it embeddable in your site with one line of
                code 5. Let you update it for fun / with your branding 5. Enable
                syncing for any URLs you let us scrape, so that you can make
                sure it's always up to date 6. Let you upload multiple file
                types
              </p>
              <p>
                I've been working on this for about a month now by myself and
                you can keep track of my feature updates here:
                <a href="https://libraria.dev/feature-updates"
                  >https://libraria.dev/feature-updates</a
                >
              </p>
              <p>
                I would LOVE your feedback on anything, and If you're willing to
                try it out I'm looking for a few beta users that can provide me
                more continuous feedback that I would gladly waive the fee for!
              </p>
            </div>
          </section>
        </section>
        <section id="35350288">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/3/23/23652939/framework-cooler-master-sff-pc-case"
              >$39 Cooler Master case turns your old Framework Laptop parts into
              a tiny PC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 00:33:06</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35350288"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35349608">
          <h3>
            <a class="item" href="https://github.com/nomic-ai/gpt4all"
              >Gpt4all: A chatbot trained on ~800k GPT-3.5-Turbo Generations
              based on LLaMa</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 23:31:09</span
              ><span class="points-container"
                >Points: <span class="points">390</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35349608"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35348452">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/the-ev-transition-explained-2659602311"
              >The EV Transition Is Harder Than Anyone Thinks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 21:51:10</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35348452"
                  >Comments</a
                ><span class="descendants">: 530</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35347760">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/safebeat/jobs/jeOKzr2-product-manager-advisor"
              >SafeBeat (YC S21) Is Hiring</a
            >
          </h3>
        </section>
        <section id="35347647">
          <h3>
            <a
              class="item"
              href="https://www.dolthub.com/blog/2023-03-23-illusion-of-transparency/"
              >New health insurance “transparency data” looks suspiciously
              wrong</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 20:51:51</span
              ><span class="points-container"
                >Points: <span class="points">391</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35347647"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35347588">
          <h3>
            <a class="item" href="https://laion.ai/blog/open-flamingo/"
              >Open Flamingo – open framework to train multimodal LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 20:47:28</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35347588"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35345117">
          <h3>
            <a
              class="item"
              href="https://blog.persistent.info/2023/03/infinitemac-dot-org.html"
              >Infinite Mac: Infinitemac.org</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 17:53:51</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35345117"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35344831">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2023/03/uk-sets-up-fake-booter-sites-to-muddy-ddos-market/"
              >UK sets up fake booter sites to muddy DDoS market</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 17:36:02</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35344831"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35344514">
          <h3>
            <a
              class="item"
              href="https://zicklag.github.io/blog/interaction-nets-combinators-calculus/"
              >Interaction Nets, Combinators, and Calculus – HVM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 17:17:56</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35344514"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35344354">
          <h3>
            <a class="item" href="https://github.com/TaxyAI/browser-extension"
              >TaxyAI: Open-source browser automation with GPT-4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 17:07:56</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35344354"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35344227">
          <h3>
            <a class="item" href="http://mynor.org/my4th"
              >My4TH – A minimalistic FORTH computer with discrete CPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 17:00:11</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35344227"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35343495">
          <h3>
            <a class="item" href="https://ciechanow.ski/bicycle/">Bicycle</a>
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 16:19:48</span
              ><span class="points-container"
                >Points: <span class="points">2405</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35343495"
                  >Comments</a
                ><span class="descendants">: 316</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35341514">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35341514"
              >Launch HN: Metal (YC W23) – Embeddings as a Service</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 14:18:40</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35341514"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.getmetal.io/">https://www.getmetal.io/</a>).
              You can think of Metal as embeddings as a service. We help
              developers use embeddings without needing to build out
              infrastructure, storage, or tooling. Here’s a 2-minute overview:
              <a
                href="https://www.loom.com/share/39fb6df7fd73469eaf20b37248ceed0f"
                >https://www.loom.com/share/39fb6df7fd73469eaf20b37248ceed0f</a
              >
              <p>
                If you’re unfamiliar with embeddings, they are representations
                of real world data expressed as a vector, where the position of
                the vector can be compared to other vectors – thereby deriving
                <i>meaning</i> from the data. They can be used to create things
                like semantic search, recommender systems, clustering analysis,
                classification, and more.
              </p>
              <p>
                Working at companies like Datadog, Meta, and Spotify, we found
                it frustrating to build ML apps. Lack of tooling,
                infrastructure, and proper abstraction made working with ML
                tedious and slow. To get features out the door we’ve had to
                build data ingestion pipelines from scratch, manually maintain
                live customer datasets, build observability to measure drift,
                manage no-downtime deployments, and the list goes on. It took
                months to get simple features in front of users and the
                developer experience was terrible.
              </p>
              <p>
                OpenAI, Hugging Face and others have brought models to the
                masses, but the developer experience still needs to be improved.
                To actually use embeddings, hitting APIs like OpenAI is just one
                piece of the puzzle. You also need to figure out storage, create
                indexes, maintain data quality through fine-tuning, manage
                versions, code operations on top of your data, and create APIs
                to consume it. All of this friction makes it a pain to ship live
                applications.
              </p>
              <p>
                Metal solves these problems by providing an end-to-end platform
                for embeddings. Here’s how it works:
              </p>
              <p>
                <i>Data In:</i> You send data to our system via our SDK or API.
                Data can be text, images, PDFs, or raw embeddings. When data
                hits our pipeline we preprocess by extracting the text from
                documents and chunking when necessary. We then generate
                embeddings using the selected model. If the index has
                fine-tuning transformation, we transform the embedding into the
                new vector space so it matches the target data. We then store
                the embeddings in cold storage for any needed async jobs.
              </p>
              <p>
                From there we index the embeddings for querying. We use HSNW
                right now, but are planning to support FLAT indexes as well. We
                currently index in Redis, but plan to make this configurable and
                provide more options for datastores.
              </p>
              <p>
                <i>Data Out:</i> We provide querying endpoints to hit the
                indexes, finding the ANN. For fine-tuned indexes, we generate
                embeddings from the base model used and then transform the
                embedding into the new vector space during the pre-query phase.
              </p>
              <p>
                Additionally, we provide methods to run clustering jobs on the
                stored embeddings and visualizations in the UI. We are
                experimenting with zero-shot classification, by embedding the
                classes and matching to each embedding in the closest class,
                allowing us to provide a “classify” method in our SDK. We would
                love feedback on what other async job types would be useful!
              </p>
              <p>
                Examples of what users have built so far include embedding
                product catalogs for improved similarity search, personalized
                in-app messaging with user behavior clusters, and similarity
                search on images for content creators.
              </p>
              <p>
                Metal has a free tier that anyone can use, a developer tier for
                $20/month, and an enterprise tier with custom pricing. We’re
                currently building an open source product that will be released
                soon.
              </p>
              <p>
                Most importantly, we’re sharing Metal with the HN community
                because we want to build the best developer experience possible,
                and the only metric we care about is live apps on prod. We’d
                love to hear your feedback, experiences with embeddings, and
                your ideas for how we can improve the product. Looking forward
                to your comments, thank you!
              </p>
            </div>
          </section>
        </section>
        <section id="35336417">
          <h3>
            <a
              class="item"
              href="http://www.cs.cmu.edu/~kmcrane/Projects/Other/YarnCurve.pdf"
              >A Simple Parametric Model of Plain-Knit Yarns [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 05:45:48</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35336417"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35325995">
          <h3>
            <a class="item" href="https://250bpm.com/blog:95/"
              >Linguistics and Programming Languages (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-27 @ 12:49:30</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35325995"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35325387">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/List_of_rivers_by_discharge"
              >River Ranking by Water Flow Rate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-27 @ 11:40:43</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35325387"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35325165">
          <h3>
            <a class="item" href="https://rfnm.io"
              >NXP LA9310: A new platform for SDR and the 10-year-old AD9361 RF
              Transceiver</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-27 @ 11:06:01</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35325165"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35324380">
          <h3>
            <a
              class="item"
              href="https://github.com/NationalSecurityAgency/ghidra"
              >NSA Ghidra software reverse engineering framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-27 @ 08:49:21</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35324380"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35323640">
          <h3>
            <a
              class="item"
              href="https://mostlynerdless.de/blog/2023/03/27/writing-a-profiler-in-240-lines-of-pure-java/"
              >Writing a Profiler in 240 lines of pure Java</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-27 @ 06:53:52</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35323640"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35323107">
          <h3>
            <a
              class="item"
              href="https://journals.lww.com/anar/fulltext/2010/04010/historical_essay__an_arabic_surgeon,_ibn_al_quff_s.3.aspx"
              >Medieval Arabic surgeon Ibn al Quff's account on surgical pain
              relief</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-27 @ 05:18:29</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35323107"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
