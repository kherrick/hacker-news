<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38913649">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-01-tuna-species-popular-sashimi-bowls.html"
              >Tuna species popular in sashimi and poke bowls in sharp
              decline</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 15:47:53</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38913649"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38913212">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/aerospace-defense/alaska-737-cockpit-voice-recorder-data-erasure-renews-industry-safety-debate-2024-01-08/"
              >Alaska 737 cockpit voice recorder data erasure renews safety
              debate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 15:22:48</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38913212"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38912764">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38912764"
              >Ask HN: What alternatives exist to a Mac mini but for Windows?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 14:53:58</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38912764"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <p>
                As the title already states I am currently looking at some
                hardware alternatives that could replace my current, and very
                outdated, Windows PC with the same form factor as Mac minis.
              </p>
              <p>
                I already own several Mac devices (phones, MBPs M1/M2), and
                mostly kept a Windows PC for so long for:
              </p>
              <p>- Gaming (mostly old games from my Steam library and ISOs).</p>
              <p>- Pictures &amp; videos.</p>
              <p>
                - NTFS HDD and USB keys (ex-FAT and other formats do not always
                work reliably).
              </p>
              <p>
                With these current usages, my ultimate goal is to find something
                as powerful as what I have right now (GTX 260 SLI over 13 years
                old, 10 years old Intel core i5, 16GB DDR3, and an SSD), which
                shouldn't be that hard, but have it as small as possible, and
                within the same price point as the Mac minis.
              </p>
              <p>
                The closest thing I've found so far is a brand called GEEKOM
                which seems to produce exactly what I need, but I do not have
                the impression to find genuine feedback on the hardware capacity
                and quality.
              </p>
              <p>
                EDIT: I live in Europe if that matters for availability and
                shipping.
              </p>
            </div>
          </section>
        </section>
        <section id="38912581">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/web/CGINotSlow"
              >Web CGI programs aren't particularly slow these days</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 14:42:08</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38912581"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38912497">
          <h3>
            <a
              class="item"
              href="https://investors.twilio.com/news/news-details/2024/Twilio-Announces-CEO-Transition/default.aspx"
              >Jeff Lawson Steps Down as CEO of Twilio</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 14:37:05</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38912497"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38912406">
          <h3>
            <a class="item" href="https://ktye.github.io/pdp11/index.html"
              >k on pdp11</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 14:31:26</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38912406"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38912349">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-01-08/iphone-survives-16-000-foot-fall-helps-narrow-jet-panel-search"
              >iPhone Survives 16,000-Foot Fall from Alaska Air Flight</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 14:28:05</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38912349"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38911791">
          <h3>
            <a class="item" href="https://whatpwacando.today"
              >What PWA Can Do Today</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 13:44:18</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38911791"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38911740">
          <h3>
            <a
              class="item"
              href="https://brooker.co.za/blog/2023/12/15/sieve.html"
              >Why Aren't We Sieve-Ing?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 13:39:50</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38911740"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38911731">
          <h3>
            <a
              class="item"
              href="https://news.sky.com/story/music-streaming-service-soundcloud-tunes-up-for-sale-13043602"
              >Music streaming service SoundCloud tunes up for sale</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 13:39:27</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38911731"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38911614">
          <h3>
            <a
              class="item"
              href="https://oklahoma.gov/omes/newsroom/2023/state-receives-first-made-in-oklahoma-electric-vehicles-from-canoo.html"
              >Oklahoma receives first "Made in Oklahoma" EV</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 13:28:38</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38911614"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38911227">
          <h3>
            <a class="item" href="https://bernd-paysan.de/bigforth.html"
              >bigFORTH (1997)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 12:51:15</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38911227"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38911088">
          <h3>
            <a
              class="item"
              href="https://simjanos-dev.github.io/LinguaCafeHome/"
              >LinguaCafe: Self-hosted software for language learners to read
              foreign languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 12:36:04</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38911088"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38910796">
          <h3>
            <a class="item" href="https://skio.com/careers/"
              >Skio (YC S20) – Subscriptions for Shopify, ReCharge Migrations Is
              Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 12:02:45</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38909735">
          <h3>
            <a
              class="item"
              href="https://www.astralcodexten.com/p/the-phrase-no-evidence-is-a-red-flag"
              >The phrase "no evidence" is a red flag for bad science
              communication (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 09:14:25</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38909735"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38909631">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Value_of_life"
              >Value of life</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 08:59:26</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38909631"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38908496">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/all-systems-go-2023-228-why-would-you-still-want-to-use-strace-in-2023-"
              >Why use strace in 2023? [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 05:05:56</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38908496"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38908427">
          <h3>
            <a
              class="item"
              href="https://engineering.fb.com/2023/12/19/core-infra/how-meta-built-the-infrastructure-for-threads/"
              >How meta built the infrastructure for Threads</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 04:54:20</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38908427"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38907821">
          <h3>
            <a
              class="item"
              href="https://buredoranna.github.io/linux/ext4/2020/01/09/ext4-viz.html"
              >Visualizing Ext4</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 03:13:53</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38907821"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38907568">
          <h3>
            <a class="item" href="https://github.com/moturus/motor-os"
              >MotorOS: a Rust-first operating system for x64 VMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 02:24:54</span
              ><span class="points-container"
                >Points: <span class="points">284</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38907568"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38906989">
          <h3>
            <a class="item" href="https://lassebomh.github.io/htmx-playground/"
              >Show HN: I made a HTMX Playground 100% in the browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 01:03:09</span
              ><span class="points-container"
                >Points: <span class="points">417</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38906989"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
            <div class="text">
              <p>I recommend clicking through the examples.</p>
              <p>
                Github repo:
                <a href="https://github.com/lassebomh/htmx-playground"
                  >https://github.com/lassebomh/htmx-playground</a
                >
              </p>
              <p>
                Probably my favorite part is the lack of HTMX specific code.
                It's designed to mimic the client and server, but really nothing
                else. In principle, this means that it is agnostic to whatever
                frontend framework is being used.
              </p>
              <p>
                Known problems: Limited mobile support, Ace Editor (should just
                be Monaco) and lack of proper error outputs.
              </p>
              <p>Feel free to give feedback, suggestions or questions.</p>
              <p>
                I learned a lot when making it, and I hope you'll something
                about HTMX! Happy tinkering.
              </p>
            </div>
          </section>
        </section>
        <section id="38906881">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=1fOA85xtYxs"
              >How An ASML Lithography Machine Moves a Wafer [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 00:46:40</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38906881"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38905898">
          <h3>
            <a
              class="item"
              href="https://sarahconstantin.substack.com/p/what-does-the-cerebellum-do-anyway"
              >What does the cerebellum do?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 22:34:31</span
              ><span class="points-container"
                >Points: <span class="points">308</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38905898"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38904255">
          <h3>
            <a
              class="item"
              href="https://davidcapper.dev/posts/social-batteries-part-1"
              >Designing, manufacturing, and selling an LED 'social battery' pin
              badge</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 19:21:24</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38904255"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38903869">
          <h3>
            <a
              class="item"
              href="https://localghost.dev/blog/just-because-you-can-doesn-t-mean-you-should-the-meter-element/"
              >Just because you can doesn't mean you should: the element</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 18:41:19</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38903869"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38901089">
          <h3>
            <a class="item" href="https://github.com/drmortalwombat/oscar64"
              >C Compiler Assembler and Runtime for C64</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 13:38:41</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38901089"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38900758">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38900758"
              >Ask HN: Small-batch builds of smaller phyiscal objects</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 12:40:50</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38900758"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'd guess there's gotta be some services (in China?) that got
                this need covered. Anyone has any experience with this sort of
                thing? Any tried and tested companies?
              </p>
              <p>Thanks!</p>
            </div>
          </section>
        </section>
        <section id="38900069">
          <h3>
            <a
              class="item"
              href="https://marclou.beehiiv.com/p/7-lessons-from-building-9-startups-as-a-solopreneur"
              >Lessons from building nine startups in 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 10:34:56</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38900069"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38899183">
          <h3>
            <a
              class="item"
              href="https://www.stat.berkeley.edu/~aldous/Real-World/million.html"
              >What has a 1 in a million chance? (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 07:05:31</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38899183"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38895995">
          <h3>
            <a class="item" href="https://github.com/gboncoffee/egg"
              >Show HN: New RISC-V emulator for Computer Science education</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-06 @ 22:08:02</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38895995"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              Just released EGG, an emulator created for teaching Assembly and
              microprocessors (designed to suit the needs of the Microprocessors
              classes, at Universidade Federal do Paraná, Brazil). The emulator
              will support multiple architetures in the future, but currently
              only RISC-V is implemented.
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
