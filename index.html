<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43085492">
          <h3>
            <a class="item" href="https://youtubesequencer.com/"
              >A web platform for using YouTube as a drum sequencer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-18 @ 02:34:37</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43085492"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43085082">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=VwlBwyJVEfw"
              >[Satire] Thiel Backed 'GigSlave' Goes Public with $84B Valuation
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-18 @ 01:22:37</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43085082"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43084200">
          <h3>
            <a
              class="item"
              href="https://mathenchant.wordpress.com/2025/02/17/dedekinds-subtle-knife/"
              >Dedekind's Subtle Knife</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 23:18:52</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43084200"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43084145">
          <h3>
            <a class="item" href="https://www.benningtonreview.org/adam-golaski"
              >On David Lynch's Revenge of the Jedi</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 23:11:33</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43084145"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43083976">
          <h3>
            <a
              class="item"
              href="https://www.pressdemocrat.com/article/trending/police-arrest-apparent-leader-of-cultlike-zizian-group-linked-to-multiple/"
              >Police arrest apparent leader of cultlike 'Zizian' group linked
              to killings</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 22:39:57</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43083976"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43083772">
          <h3>
            <a class="item" href="https://libreture.com/bookshops/"
              >List of DRM-Free Bookshops</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 22:09:09</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43083772"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43083687">
          <h3>
            <a class="item" href="https://previnder.com/tls-ca-linux/"
              >Setting up a trusted, self-signed SSL/TLS certificate authority
              in Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 21:59:14</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43083687"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43083345">
          <h3>
            <a
              class="item"
              href="https://joyarbitrage.substack.com/p/find-your-2ers"
              >Find Your 2%Ers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 21:14:03</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43083345"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43083295">
          <h3>
            <a
              class="item"
              href="https://natlawreview.com/article/nlrb-acting-general-counsel-rescinds-non-compete-labor-policy"
              >NLRB acting general counsel rescinds non-compete labor policy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 21:05:48</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43083295"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43083255">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/testrigor/jobs/AuTkpC9-vp-of-engineering"
              >TestRigor (YC S21) Is Hiring VP of Engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 21:00:29</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43083151">
          <h3>
            <a
              class="item"
              href="https://www.privacyguides.org/articles/2025/02/17/privacy-is-not-dead/"
              >Privacy Is Not Dead: Beware the All-or-Nothing Mindset</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 20:48:37</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43083151"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43083012">
          <h3>
            <a
              class="item"
              href="https://www.cbc.ca/news/canada/toronto/toronto-pearson-overturned-airplane-1.7461227"
              >Plane crashes, overturns during landing at Toronto airport</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 20:30:04</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43083012"
                  >Comments</a
                ><span class="descendants">: 216</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43082739">
          <h3>
            <a class="item" href="https://github.com/decrazyo/nes86"
              >NES86 – IBM PC Emulator for the NES</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 19:57:16</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43082739"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43082287">
          <h3>
            <a
              class="item"
              href="https://www.clp.unesp.br/Modulos/Noticias/401/paleoburrows-nature-2025.pdf"
              >Who carved South America's mysterious ancient tunnels? [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 19:12:14</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43082287"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43081713">
          <h3>
            <a class="item" href="https://bryce.co/undebuggable/"
              >Debugging an Undebuggable App</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 18:10:35</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43081713"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43080895">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43080895"
              >Launch HN: Roark (YC W25) – Taking the pain out of voice AI
              testing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 16:54:52</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43080895"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
            <div class="text">
              <a href="https://roark.ai">https://roark.ai</a>). We built a tool
              that lets developers replay real production calls against their
              latest Voice AI changes, so they can catch failures, test updates,
              and iterate with confidence.
              <p>
                Here’s a demo video:
                <a href="https://www.youtube.com/watch?v=eu8mo28LsTc"
                  >https://www.youtube.com/watch?v=eu8mo28LsTc</a
                >.
              </p>
              <p>
                We ran into this problem while building a voice AI agent for a
                dental clinic. Patients kept getting stuck in loops, failing to
                confirm insurance, or misunderstanding responses. The only way
                to test fixes was to manually call the agent or read through
                hundreds of transcripts, hoping to catch issues. It was slow,
                frustrating, and unreliable.
              </p>
              <p>
                Talking to other teams, we found this wasn’t just a niche issue
                - every team building Voice AI struggled to validate performance
                efficiently. Debugging meant calling the agent over and over.
                Updates shipped with unknown regressions. Sentiment analysis
                relied only on text, missing key audio cues like hesitation or
                frustration, which often signal deeper issues.
              </p>
              <p>
                That’s why we built Roark. Instead of relying on scripted test
                cases, Roark captures real production calls from VAPI, Retell,
                or a custom-built agent via API and replays them against your
                latest agent changes. We don’t just feed back text, we preserve
                what the user said, how they said it, and when they said it,
                mimicking pauses, sentiment, and tone up until the conversation
                flow changes. This ensures your agent is tested under real-world
                conditions, not just synthetic scripts.
              </p>
              <p>
                For each replay that we run, Roark checks if the agent follows
                key flows (e.g. verifying identity before sharing account
                details). Our speech based evaluators also detect sentiments
                such as frustration and confusion, long pauses, and
                interruptions - things that regular transcripts miss.
              </p>
              <p>
                After testing, Roark provides Mixpanel-style analytics to track
                failures, conversation flows, and key performance metrics,
                helping teams debug faster and ship with confidence. Instead of
                hoping changes work, teams get immediate pass/fail results,
                side-by-side transcript comparisons, and real-world insights.
              </p>
              <p>
                We’re already working with teams in healthcare, legal, and
                customer service who rely on Voice AI for critical interactions.
                They use Roark to debug AI failures faster, test updates before
                they go live, and improve customer experiences - without
                manually calling their bots dozens of times.
              </p>
              <p>
                Our product isn’t <i>quite</i> ready yet for self-service, so
                you’ll still see the dreaded “book a demo” on our home page. If
                you’re reading this, though, we’d love to fast-track you, so we
                made a special page for HN signups here:
                <a href="https://roark.ai/hn-access"
                  >https://roark.ai/hn-access</a
                >. If you’re working on Voice AI and want to try us out, please
                do!
              </p>
              <p>
                Would love any feedback, thoughts, or questions from the HN
                community!
              </p>
            </div>
          </section>
        </section>
        <section id="43080531">
          <h3>
            <a class="item" href="https://github.com/dhealy05/frames_of_mind"
              >Watch R1 "think" with animated chains of thought</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 16:23:07</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43080531"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43080378">
          <h3>
            <a
              class="item"
              href="https://www.thomas-huehn.com/open-source-projects-could-sell-sbom-fragments/"
              >Open source projects could sell SBOM fragments</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 16:09:47</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43080378"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43079023">
          <h3>
            <a class="item" href="https://espargos.net/"
              >Espargos: ESP32-based WiFi sensing array</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 13:54:40</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43079023"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43077675">
          <h3>
            <a
              class="item"
              href="https://yosefk.com/blog/cxx-thread-local-storage-performance.html"
              >0+0 &amp;gt; 0: C++ thread-local storage performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 11:18:29</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43077675"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43073377">
          <h3>
            <a
              class="item"
              href="https://rlafuente.com/post?post=2025-2-16-marketmaking-on-kalshi"
              >Making Markets on Kalshi</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-17 @ 00:26:04</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43073377"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43071983">
          <h3>
            <a
              class="item"
              href="https://nyanpasu64.gitlab.io/blog/amdgpu-sleep-wake-hang/"
              >I helped fix sleep-wake hangs on Linux with AMD GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-16 @ 21:42:03</span
              ><span class="points-container"
                >Points: <span class="points">517</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43071983"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43067627">
          <h3>
            <a
              class="item"
              href="https://xyzlabs.substack.com/p/large-language-models-show-concerning"
              >Large Language Models Show Concerning Tendency to Flatter
              Users</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-16 @ 12:54:57</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43067627"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43055191">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/sports/article/sf-thought-built-stadium-future-fog-ewing-field-20051971.php"
              >The San Francisco stadium that fog killed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-15 @ 02:10:04</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43055191"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43053403">
          <h3>
            <a
              class="item"
              href="https://www.learningfromexamples.com/p/reflections-on-superintelligence"
              >George Eliot's reflections on AGI from 1879</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-14 @ 21:43:50</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43053403"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43052635">
          <h3>
            <a class="item" href="https://github.com/cordx56/rustowl"
              >Visualize Ownership and Lifetimes in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-14 @ 20:16:10</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43052635"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43052185">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/history/canyon-of-the-ancestors-180985955/"
              >New Technology Reveals Details About Indigenous Habitations in
              Desert Canyons</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-14 @ 19:38:38</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43052185"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43047341">
          <h3>
            <a
              class="item"
              href="https://www.infobip.com/developers/blog/seniors-working-on-a-legacy-project"
              >You're not a senior engineer until you've worked on a legacy
              project (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-14 @ 11:36:39</span
              ><span class="points-container"
                >Points: <span class="points">585</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43047341"
                  >Comments</a
                ><span class="descendants">: 343</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43046631">
          <h3>
            <a
              class="item"
              href="https://www.cs.auckland.ac.nz/~pgut001/pubs/bollocks.pdf"
              >Why Quantum Cryptanalysis is Bollocks [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-14 @ 09:42:05</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43046631"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43040986">
          <h3>
            <a class="item" href="https://maps.vvolhejn.com"
              >Spacetime maps: A map that warps to show travel time</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-13 @ 20:36:11</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43040986"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
