<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37848793">
          <h3>
            <a class="item" href="https://github.com/anderspitman/obligator"
              >Show HN: Obligator – An OpenID Connect server for self-hosters</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 18:59:20</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37848793"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37848685">
          <h3>
            <a
              class="item"
              href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7467703/"
              >Asphalt-related emissions are a major missing source of air
              pollution (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 18:51:37</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37848685"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37848662">
          <h3>
            <a class="item" href="https://craigmod.com/ridgeline/167/"
              >British Sandwiches and Walking 300km of Wainwright's Coast to
              Coast</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 18:49:53</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37848662"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37848632">
          <h3>
            <a
              class="item"
              href="https://community.macmillanlearning.com/t5/talk-psych-blog/awareness-at-death/ba-p/19410"
              >Awareness at Death</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 18:48:11</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37848632"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37848571">
          <h3>
            <a class="item" href="https://github.com/jinyus/related_post_gen"
              >Julia leads Rust,Zig,Go and Java in data processing benchmark</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 18:43:24</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37848571"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37848321">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2310.06625"
              >Inverted Transformers Are Effective for Time Series
              Forecasting</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 18:25:37</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37848321"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37848212">
          <h3>
            <a class="item" href="https://direct.starlink.com/"
              >Starlink Direct to Cell</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 18:18:00</span
              ><span class="points-container"
                >Points: <span class="points">240</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37848212"
                  >Comments</a
                ><span class="descendants">: 214</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37848115">
          <h3>
            <a class="item" href="https://www.vinerobots.org/"
              >Vine Robots: Learn to Make Your Own</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 18:11:08</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37848115"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37847782">
          <h3>
            <a
              class="item"
              href="https://wordpress.com/blog/2023/10/11/activitypub/"
              >Wordpress.com Now Supports ActivityPub</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 17:47:23</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37847782"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37847454">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/blog/products/databases/announcing-cloud-spanner-price-performance-updates"
              >Google Cloud Spanner is now half the cost of Amazon DynamoDB</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 17:25:40</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37847454"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37846471">
          <h3>
            <a
              class="item"
              href="https://blog.willdepue.com/how-to-legally-pirate-all-fonts-in-an-afternoon"
              >How to legally pirate every font</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 16:21:06</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37846471"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37845903">
          <h3>
            <a class="item" href="https://k3s.io/"
              >K3s – Lightweight Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 15:39:49</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37845903"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37845195">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/the-deep-link-equating-math-proofs-and-computer-programs-20231011/"
              >The deep link equating math proofs and computer programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 14:52:25</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37845195"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37844536">
          <h3>
            <a
              class="item"
              href="https://blog.synopse.info/?post/2022/11/26/Modern-Pascal-is-Still-in-the-Race"
              >Modern Pascal is still in the race (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 14:02:43</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37844536"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37844478">
          <h3>
            <a class="item" href="https://krita.org/en/item/krita-5-2-released/"
              >Krita 5.2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 13:58:08</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37844478"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37844305">
          <h3>
            <a
              class="item"
              href="https://modern-sql.com/reserved-words-empirical-list"
              >SQL Reserved Words – The Empirical List</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 13:45:11</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37844305"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37844225">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/worklife/article/20231010-the-acute-suicide-crisis-among-veterinarians-youre-always-going-to-be-failing-somebody"
              >A suicide crisis among veterinarians</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 13:38:32</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37844225"
                  >Comments</a
                ><span class="descendants">: 315</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37843946">
          <h3>
            <a class="item" href="https://docs.vulkan.org/"
              >Vulkan Documentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 13:14:12</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37843946"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37843908">
          <h3>
            <a class="item" href="https://idiomdrottning.org/bad-emacs-defaults"
              >Bad Emacs defaults</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 13:10:14</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37843908"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37843907">
          <h3>
            <a class="item" href="https://github.com/traceloop/openllmetry"
              >Show HN: OpenLLMetry – OpenTelemetry-based observability for
              LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 13:10:06</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37843907"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/traceloop/openllmetry"
                >https://github.com/traceloop/openllmetry</a
              >.
              <p>
                There’s already a decent number of tools for LLM observability,
                some open-source and some not. But what we found was missing for
                all of them is that they were closed-protocol by design,
                vendor-locking you to use their observability platform or their
                proprietary framework for running your LLMs.
              </p>
              <p>
                It’s still early in the gen-AI space so we think it’s the right
                time to define an open protocol for observability. So we built
                OpenLLMetry. It extends OpenTelemetry and provides
                instrumentations for LLM-specific libraries which automatically
                monitor and trace prompts, token usage, embeddings, etc.
              </p>
              <p>
                Two key benefits with OpenTelemetry are (1) you can trace your
                entire system execution, not just the LLM (so you can see how
                requests to DBs, or other calls affect the overall result); and
                (2) you can connect to any monitoring platform—no need to adopt
                new tools. Install the SDK and plug it into Datadog, Sentry, or
                both. Or switch between them easily.
              </p>
              <p>
                We’ve already built instrumentations for LLMs like OpenAI,
                Anthropic and Cohere, vector DBs like Pinecone and LLM
                Frameworks like LangChain and Haystack. And we’ve built an SDK
                that makes it easy to use all of these instrumentations in case
                you’re not too familiar with OpenTelemetry.
              </p>
              <p>
                Everything is written in Python (with Typescript around the
                corner) and licensed with Apache-2.0.
              </p>
              <p>
                We’re using this SDK for our own platform (Traceloop), but our
                hope is that OpenLLMetry can evolve and thrive independently,
                giving everyone (including our users) the power of choice. We’ll
                be working with the OpenTelemetry community to get this to
                become a first-class citizen of OpenTelemetry.
              </p>
              <p>Would love to hear your thoughts and opinions!</p>
              <p>Check it out -</p>
              <p>
                Docs:
                <a href="https://www.traceloop.com/docs/python-sdk/introduction"
                  >https://www.traceloop.com/docs/python-sdk/introduction</a
                >
              </p>
              <p>
                Github:
                <a href="https://github.com/traceloop/openllmetry"
                  >https://github.com/traceloop/openllmetry</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37843534">
          <h3>
            <a
              class="item"
              href="https://zverok.space/blog/2023-10-11-syntax-sugar1-numeric-block-args.html"
              >Numbered block parameters in Ruby</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 12:22:31</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37843534"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37842993">
          <h3>
            <a
              class="item"
              href="https://themillions.com/2023/10/in-search-of-writers-haunts-bruce-chatwin.html"
              >In Search of Writers' Haunts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 11:03:13</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37842993"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37842618">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2310.06825"
              >Mistral 7B</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 09:56:39</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37842618"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37842301">
          <h3>
            <a class="item" href="https://github.com/Shopify/toxiproxy"
              >Toxiproxy – simulate network and system conditions for chaos
              testing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 08:56:54</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37842301"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37842006">
          <h3>
            <a
              class="item"
              href="https://fermatslibrary.com/s/ancient-babylonian-algorithms"
              >Ancient Babylonian Algorithms</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 07:58:46</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37842006"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37841013">
          <h3>
            <a class="item" href="https://github.com/spacedriveapp/spacedrive"
              >Spacedrive – an open source cross-platform file explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 04:54:07</span
              ><span class="points-container"
                >Points: <span class="points">298</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37841013"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37840756">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Thunderbird_and_Whale"
              >Thunderbird and Whale</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 04:04:53</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37840756"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37840503">
          <h3>
            <a class="item" href="https://prolost.com/blog/applelog"
              >Log is the "Pro" in iPhone 15 Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 03:18:12</span
              ><span class="points-container"
                >Points: <span class="points">987</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37840503"
                  >Comments</a
                ><span class="descendants">: 348</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37839884">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-10-evidence-albatrosses-infrasound-journeys.html"
              >Evidence that albatrosses use infrasound to navigate long
              journeys</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 01:22:18</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37839884"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37832949">
          <h3>
            <a class="item" href="https://capitalgains.thediff.co/p/tmt"
              >Why is there a "Tech, Media, Telecom" sector?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-10 @ 14:58:50</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37832949"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
