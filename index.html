<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44708270">
          <h3>
            <a
              class="item"
              href="https://blog.jim-nielsen.com/2025/how-to-make-websites-that-require-lots-of-time-and-energy/"
              >How to Make Websites That Will Require Lots of Your Time and
              Energy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 07:41:41</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44708270"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44708173">
          <h3>
            <a
              class="item"
              href="https://abitmighty.com/posts/the-ultimate-meeting-culture"
              >The ultimate meeting culture</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 07:27:17</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44708173"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44708028">
          <h3>
            <a
              class="item"
              href="https://huggingface.co/spaces/hesamation/primer-llm-embedding"
              >LLM Embeddings Explained: A Visual and Intuitive Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 07:02:14</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44708028"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44707546">
          <h3>
            <a
              class="item"
              href="https://maltsev.space/blog/012-simd-within-a-register-how-i-doubled-hash-table-lookup-performance"
              >SIMD Within a Register: How I Doubled Hash Table Lookup
              Performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 05:41:34</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44707546"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44707440">
          <h3>
            <a class="item" href="https://github.com/sebastien/multiplex"
              >Multiplex: Command-Line Process Mutliplexer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 05:18:10</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44707440"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44707300">
          <h3>
            <a
              class="item"
              href="https://www.hadess.net/2025/07/digitising-cds-aka-using-your-phone-as.html"
              >Digitising CDs (a.k.a. using your phone as an image scanner)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 04:47:46</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44707300"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44707261">
          <h3>
            <a
              class="item"
              href="https://sfconservancy.org/blog/2021/jul/23/tivoization-and-the-gpl-right-to-install/"
              >“Tivoization” and your right to install under Copyleft and GPL
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 04:35:00</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44707261"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44706428">
          <h3>
            <a
              class="item"
              href="https://lithub.com/how-big-agriculture-mislead-the-public-about-the-benefits-of-biofuels/"
              >Big agriculture mislead the public about the benefits of
              biofuels</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 01:46:44</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44706428"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44705958">
          <h3>
            <a
              class="item"
              href="https://github.com/musistudio/claude-code-router"
              >Claude Code Router</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 00:19:23</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44705958"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44705494">
          <h3>
            <a class="item" href="https://github.com/babycommando/zuse"
              >ZUSE – The Modern IRC Chat for the Terminal Made in
              Go/Bubbletea</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 23:01:01</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44705494"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44705445">
          <h3>
            <a
              class="item"
              href="https://www.geoffreylitt.com/2025/07/27/enough-ai-copilots-we-need-ai-huds"
              >Enough AI copilots, we need AI HUDs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 22:51:28</span
              ><span class="points-container"
                >Points: <span class="points">443</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44705445"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44705240">
          <h3>
            <a
              class="item"
              href="https://www.reddit.com/r/degoogle/s/YxmPgFes8a"
              >EU age verification app to ban any Android system not licensed by
              Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 22:18:44</span
              ><span class="points-container"
                >Points: <span class="points">704</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44705240"
                  >Comments</a
                ><span class="descendants">: 366</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44705171">
          <h3>
            <a
              class="item"
              href="https://kevinlynagh.com/newsletter/2025_07_flatpack/"
              >Designing a flatpack bed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 22:09:14</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44705171"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44704736">
          <h3>
            <a
              class="item"
              href="https://byteofdev.com/posts/making-postgres-slow/"
              >Making Postgres slower</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 21:12:59</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44704736"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44704422">
          <h3>
            <a class="item" href="https://sharktastica.co.uk/topics/patents"
              >IBM Keyboard Patents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 20:30:27</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44704422"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44704270">
          <h3>
            <a
              class="item"
              href="https://nexy.blog/2025/07/27/how-i-hacked-my-washing-machine/"
              >I hacked my washing machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 20:09:29</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44704270"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44703164">
          <h3>
            <a
              class="item"
              href="https://github.com/segmentationf4u1t/trae_telemetry_research"
              >Performance and telemetry analysis of Trae IDE, ByteDance's
              VSCode fork</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 17:57:06</span
              ><span class="points-container"
                >Points: <span class="points">847</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44703164"
                  >Comments</a
                ><span class="descendants">: 302</span></span
              >
            </h4>
            <div class="text">
              <p>Here are the key findings:</p>
              <p>
                1. Extreme Resource Consumption: Out of the box, Trae used 6.3x
                more RAM (~5.7 GB) and spawned 3.7x more processes (33 total)
                than a standard VSCode setup with the same project open. The
                team has since made improvements, but it's still significantly
                heavier.
              </p>
              <p>
                2. Telemetry Opt-Out Doesn't Work (It Makes It Worse): I found
                Trae was constantly sending data to ByteDance servers
                (byteoversea.com). I went into the settings and disabled all
                telemetry. To my surprise, this didn't stop the traffic. In
                fact, it increased the frequency of batch data collection. The
                telemetry "off" switch appears to be purely cosmetic.
              </p>
              <p>
                3. What's Being Sent: Even with telemetry "disabled," Trae sends
                detailed payloads including: Hardware specs (CPU, memory, etc.)
                Persistent user, device, and machine IDs OS version, app
                language, user name Granular usage data like time-on-ide, window
                focus state, and active file types.
              </p>
              <p>
                4. Community Censorship: When I tried to discuss these findings
                on their official Discord, my posts were deleted and my account
                was muted for 7 days. It seems words like "track" trigger an
                automated gag rule, which prevents any real discussion about
                privacy.
              </p>
              <p>
                I believe developers should be aware of this behavior. The
                combination of resource drain, non-functional privacy settings,
                and censorship of technical feedback is a major red flag. The
                full, detailed analysis with all the evidence (process lists,
                Fiddler captures, JSON payloads, and screenshots of the Discord
                moderation) is available at the link. Happy to answer any
                questions.
              </p>
            </div>
          </section>
        </section>
        <section id="44702833">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44702833"
              >Ask HN: What are you working on? (July 2025)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 17:19:19</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44702833"
                  >Comments</a
                ><span class="descendants">: 539</span></span
              >
            </h4>
            <div class="text">
              What are you working on? Do you have any new ideas you're thinking
              about?
            </div>
          </section>
        </section>
        <section id="44702782">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/07/27/arts/music/tom-lehrer-dead.html"
              >Tom Lehrer has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 17:13:25</span
              ><span class="points-container"
                >Points: <span class="points">551</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44702782"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.ph/gY3Xa">https://archive.ph/gY3Xa</a>
              <p>
                Also:
                <a
                  href="https://apnews.com/article/tom-lehrer-son-satirist-mathematician-dies-9caa7ee01faf4fbfb793d7ba984c179d"
                  >https://apnews.com/article/tom-lehrer-son-satirist-mathemati...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44701555">
          <h3>
            <a class="item" href="https://www.dumbpipe.dev/">Dumb Pipe</a>
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 14:25:47</span
              ><span class="points-container"
                >Points: <span class="points">743</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44701555"
                  >Comments</a
                ><span class="descendants">: 176</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44700815">
          <h3>
            <a class="item" href="https://github.com/jkoppel/jj-workshop"
              >The JJ VCS workshop: A zero-to-hero speedrun</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 12:23:31</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44700815"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44700744">
          <h3>
            <a
              class="item"
              href="https://surfingcomplexity.blog/2025/07/26/formal-specs-as-sets-of-behaviors/"
              >Formal specs as sets of behaviors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 12:10:29</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44700744"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44681616">
          <h3>
            <a
              class="item"
              href="https://andinfinity.eu/post/2025-07-24-bits-0x02/"
              >Bits 0x02: switching to orion as a browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 10:24:44</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44681616"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44678083">
          <h3>
            <a class="item" href="https://maurycyz.com/misc/printing/"
              >How big can I print my image?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 00:36:03</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44678083"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44675053">
          <h3>
            <a
              class="item"
              href="https://arclight.run/how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/"
              >How I fixed my blog's performance issues by writing a new Jekyll
              plugin</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 19:35:31</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44675053"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44672149">
          <h3>
            <a
              class="item"
              href="https://neurrone.com/posts/software-development-at-800-wpm/"
              >Software Development at 800 Words per Minute</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 15:47:11</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44672149"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44671802">
          <h3>
            <a
              class="item"
              href="https://code.blender.org/2025/07/beyond-mouse-keyboard/"
              >Blender: Beyond Mouse and Keyboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 15:20:49</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44671802"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44670885">
          <h3>
            <a
              class="item"
              href="https://www.vrt.be/vrtnws/en/2025/07/24/200-000-flemish-drivers-can-turn-traffic-lights-green-but-waze/"
              >200k Flemish drivers can turn traffic lights green</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 14:08:26</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44670885"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44670483">
          <h3>
            <a
              class="item"
              href="https://www.schneier.com/blog/archives/2025/07/how-solid-protocol-restores-digital-agency.html"
              >Solid protocol restores digital agency</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 13:32:50</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44670483"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44666824">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/programming/WhyRDParsersForMe"
              >Why I write recursive descent parsers, despite their issues
              (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 04:07:42</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44666824"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
