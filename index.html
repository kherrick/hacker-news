<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36119709">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36119709"
              >Ask HN: What challenges are you facing offshoring development to
              India?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 00:18:14</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36119709"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                How is your experience offshoring to India or South Asia / SEA
                in general?
              </p>
            </div>
          </section>
        </section>
        <section id="36119169">
          <h3>
            <a class="item" href="https://vanjs.org/"
              >VanJS: Vanilla JavaScript Reactive UI Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 23:07:27</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36119169"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118990">
          <h3>
            <a class="item" href="https://bigcapital.ly"
              >An open-source alternative to QuickBooks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 22:44:09</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118990"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118918">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36118918"
              >Ask HN: Tired of being a software engineer, what next?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 22:35:50</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118918"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
            <div class="text">
              <p>
                I kind of feel I have wasted my time/life on this career. Maybe
                someone can give me decent advice.
              </p>
              <p>
                I am in my 40s now. I started coding when I was a young teen,
                copying code from books in the library to build text based
                games. I ended up making lots of my own games, some got popular.
                I grew a love for tinkering, coding, and building things. I
                eagerly joined the CS dept at university in the early 2000s,
                when CS attendance was at a record low. But I didn't care, I
                loved it.
              </p>
              <p>
                When I graduated, I could not get a job. This was around
                2004-2005. I submitted my resume to many companies and got
                nothing. I ended up working temp jobs, until I finally got lucky
                at a career fair, hit it off with a software QA person, and got
                my first SWE role.
              </p>
              <p>
                This job wasn't exactly pure coding, but more like a data
                scientist/engineer role. But I became the coding expert on my
                team, and built many critical things for the company. I got the
                best perf reviews, threw myself into the job and did pretty
                well. It wasn't the most satisfying work (I just wanted to
                code), but I got my itch scratched enough. Unfortunately the
                company tanked right as I was having a kid, and I had to leave.
              </p>
              <p>
                Next up was, in retrospect, probably the highlight of my career.
                Almost a pure coding job in HFT. I gelled very well with my
                manager and my team, and I threw myself into it. Again I was top
                ranked in perf reviews, and I got my first big pay check after 6
                years of relatively low salaries. Then it kind of fell apart.
                Some controversial stuff came out, all the SWEs realized they
                were getting screwed, and morale sunk. It hit me very hard
                personally - I felt I had given my soul and life to this
                company, and they had screwed me over. I left and went abroad.
              </p>
              <p>
                At this point, my career started to stagnate and I became more
                and more disillusioned with the software field. I could not find
                the same environment I had at the HFT company. Everywhere I went
                had people who barely had any work ethic, or were barely able to
                perform their job. I found it very hard to enjoy working in
                these environments. I started consulting to at least earn more
                money and try and find better roles, but nothing ever improved.
              </p>
              <p>
                After several years of this, I was getting miserable and
                depressed, and my marriage was falling apart. Combined with my
                experience at work, I developed deep burn out. I found myself
                unable to work more than an hour or two a day. It was incredibly
                depressing. But worse, at the places I worked at, no one seemed
                to care. So I guess at this point I had just become like
                everyone else. Oh man. That was eye opening and depressing at
                the same time.
              </p>
              <p>
                I decided to try and rekindle my love for engineering again. I
                started working on my M.S., with a plan to join FAANG when I was
                done. Everyone says how these are the best places to work, a
                true engineer's paradise. Doing the M.S. was great - I was back
                to programming and the basics, which I love, and I enjoyed it a
                lot.
              </p>
              <p>
                I'm now an IC at a FAANG (one of F/G, you guess). And you know
                what? It sucks. I could go into great depth why it sucks. But
                suffice to say, my expectations were sorely disappointed. This
                was supposed to be a pinnacle of my career. Instead, it is one
                of the most dysfunctional places I have worked at. The only
                positive is the pay is extraordinary. But I don't see how I can
                work here for more than a year or two. It is stressful for all
                the wrong reasons.
              </p>
              <p>
                At this point in my career, I'm thinking what else is there for
                me? I'm exhausted - tired of chasing the next dream for it to be
                a disappointment. I just want a job where I can flex my
                engineering skills without BS, work with good, competent people
                who care as much as I do, and be able to relax when I get home,
                knowing I've done what was expected of me. Does this even exist
                anymore?
              </p>
            </div>
          </section>
        </section>
        <section id="36118913">
          <h3>
            <a class="item" href="https://raku-advent.blog/2022/12/20/sigils/"
              >Sigils are an underappreciated programming technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 22:35:10</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118913"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118856">
          <h3>
            <a
              class="item"
              href="https://status.internetnz.nz/incidents/gq1c6slz3198"
              >DNSSEC KSK rollover breaks DNS resolution for .nz domains</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 22:29:38</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118856"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118707">
          <h3>
            <a
              class="item"
              href="https://twitter.com/wondermeg_/status/1662454909353033730"
              >HBO Max new Captcha system</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 22:10:46</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118707"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118093">
          <h3>
            <a
              class="item"
              href="https://alentred.medium.com/cognitive-load-of-abstractions-in-the-source-code-20a889a106d4"
              >Death by design patterns, or On the cognitive load of
              abstractions in the code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 21:04:34</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118093"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118074">
          <h3>
            <a
              class="item"
              href="https://deep-ivy-ltd.breezy.hr/p/055a500d0e8701-ml-research-engineer?ref=upstract.com"
              >Ivy (YC W23) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 21:01:13</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36117950">
          <h3>
            <a
              class="item"
              href="https://austinhenley.com/blog/superoptimizer.html"
              >My first superoptimizer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 20:47:30</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36117950"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36117558">
          <h3>
            <a
              class="item"
              href="https://www.interactions.org///press-release/lhc-experiments-see-first-evidence-rare-higgs-boson-decay"
              >LHC experiments see first evidence of a rare Higgs boson decay</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 20:10:36</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36117558"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36117037">
          <h3>
            <a class="item" href="https://minigdx.github.io/tiny/"
              >Show HN: Tiny – A 2D Game Engine in Kotlin Working with Lua</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 19:19:17</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36117037"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                The engine was created using Kotlin Multiplatform and can run on
                a JVM and JS. Funny things: Games can be created using the
                programming language Lua.
              </p>
              <p>
                Tiny is designed to help you create and test your ideas quickly
                and effectively. Not only can you run your games on your desktop
                computer, but you can also export them for the web, making it
                easy to share your creations with others.
              </p>
              <p>
                You can create games easily with the hot reload, small API and
                Lua, which is very easy to learn.
              </p>
              <p>
                If you want to test a game idea, to try to create your first
                game or just have fun, give it a try to Tiny.
              </p>
            </div>
          </section>
        </section>
        <section id="36114896">
          <h3>
            <a
              class="item"
              href="https://www.catholicnewsagency.com/news/254032/wikipedia-had-the-wrong-vatican-city-flag-for-years-now-incorrect-flags-are-everywhere"
              >Wikipedia had wrong Vatican flag for years – now incorrect flags
              are everywhere</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 15:29:58</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114896"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36114775">
          <h3>
            <a
              class="item"
              href="https://www.rheinmetall.com/en/media/news-watch/news/2023/mai/2023-05-16-rheinmetall-launches-first-pilot-project-for-innovative-curb-stone-chargers"
              >Rheinmetall pilot project for curb stone chargers for EVs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 15:14:52</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114775"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36114641">
          <h3>
            <a
              class="item"
              href="https://pointersgonewild.com/2023/05/29/software-bugs-that-cause-real-world-harm/"
              >Software bugs that cause real-world harm</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 14:59:38</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114641"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36114562">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Johari_window"
              >The Johari Window</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 14:52:14</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114562"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36114147">
          <h3>
            <a
              class="item"
              href="https://interrupt.memfault.com/blog/cpp-17-for-embedded"
              >C++17’s useful features for embedded systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 14:09:58</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114147"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113828">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/XFS-Patch-For-Linux-6.3"
              >XFS Metadata Corruption on Linux 6.3 Tracked Down to One Missing
              One-Line Patch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 13:38:23</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113828"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113586">
          <h3>
            <a
              class="item"
              href="https://duncanlock.net/blog/2023/05/28/thanks-david-peter/"
              >Thanks, David Peter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 13:08:04</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113586"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113432">
          <h3>
            <a
              class="item"
              href="https://simonschreibt.de/gat/deus-ex-alpha-terrain/"
              >Deus Ex – Alpha Terrain</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 12:49:41</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113432"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113430">
          <h3>
            <a
              class="item"
              href="https://www.nray.dev/blog/300ms-faster-reducing-wikipedias-total-blocking-time/"
              >300ms Faster: Reducing Wikipedia's total blocking time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 12:49:11</span
              ><span class="points-container"
                >Points: <span class="points">409</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113430"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113215">
          <h3>
            <a
              class="item"
              href="https://mullvad.net/en/blog/2023/5/29/removing-the-support-for-forwarded-ports/"
              >Removing support for forwarded ports</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 12:17:54</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113215"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113115">
          <h3>
            <a class="item" href="http://akkartik.name/freewheeling"
              >Using computers more freely and safely</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 12:04:09</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113115"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36112815">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2023-05-harvest-abundant-energy-thin-air.html"
              >Research on harvesting electricity from humidity in the air</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 11:12:58</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36112815"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36112053">
          <h3>
            <a
              class="item"
              href="https://fasterthanli.me/articles/a-terminal-case-of-linux"
              >A terminal case of Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 08:51:42</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36112053"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36107619">
          <h3>
            <a
              class="item"
              href="https://chocolateclass.wordpress.com/2014/03/14/chocolate-and-the-steam-engine/"
              >Chocolate and the Steam Engine (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 20:45:00</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36107619"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36105603">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/cash-only-movement-apple-pay-paper-money-3814f75a"
              >Pro-cash movement warns that people could be losing more than
              they bargained for</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 16:39:07</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36105603"
                  >Comments</a
                ><span class="descendants">: 487</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36105398">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/a-rare-1914-silent-film-was-considered-lost-forever-a-professor-rescued-it-from-a-vault-9bfdc1f0"
              >A 1914 silent film considered lost was rescued from a vault</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 16:18:19</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36105398"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36102865">
          <h3>
            <a class="item" href="https://amasad.me/compilers"
              >Why Learn Compilers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 10:38:54</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36102865"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36102116">
          <h3>
            <a
              class="item"
              href="https://quantum5.ca/2023/05/28/introducing-my-own-mirroring-service-mirror.quantum5.ca/"
              >Journey and lessons from running a mirroring service at home</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 08:10:20</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36102116"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
