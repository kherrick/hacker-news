<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37774580">
          <h3>
            <a
              class="item"
              href="https://link.springer.com/article/10.1057/jt.2009.16"
              >Pythagorean Theorem found on clay tablet 1k years older than
              Pythagoras</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-05 @ 03:19:43</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37774580"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37774366">
          <h3>
            <a class="item" href="https://par.nsf.gov/servlets/purl/10150578"
              >President Speaking: Spoofing Alerts in 4G LTE Networks (2019)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-05 @ 02:45:50</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37774366"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37774004">
          <h3>
            <a
              class="item"
              href="https://store.google.com/us/product/pixel_watch_2?hl=en-US"
              >Google Pixel Watch 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-05 @ 01:42:59</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37774004"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37773918">
          <h3>
            <a
              class="item"
              href="https://www.beren.io/2023-03-19-LLMs-confabulate-not-hallucinate/"
              >LLMs confabulate not hallucinate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-05 @ 01:30:32</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37773918"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37773731">
          <h3>
            <a
              class="item"
              href="https://www.forbes.com/sites/jackkelly/2023/10/04/us-tech-workers-are-experiencing-a-drop-in-salaries-and-in-the-number-of-jobs-available-in-the-bay-area/"
              >A drop in salaries and in the number of jobs available in the Bay
              Area</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-05 @ 01:01:57</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37773731"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37773599">
          <h3>
            <a class="item" href="https://nikolaivazquez.com/blog/divan/"
              >Divan: Fast and Simple Benchmarking for Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-05 @ 00:43:10</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37773599"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37773514">
          <h3>
            <a
              class="item"
              href="https://newsroom.wakehealth.edu/news-releases/2023/10/new-wound-healing-research-produces-full-thickness-human-bioprinted-skin"
              >Wound healing research produces full thickness human bioprinted
              skin</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-05 @ 00:32:35</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37773514"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37772427">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2023/10/04/qualcomms-hexagon-dsp-and-now-npu/"
              >Qualcomm’s Hexagon DSP, and Now, NPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 22:02:53</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37772427"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37772206">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02920-y"
              >AI beats human sleuth at finding problematic images in research
              papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 21:40:41</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37772206"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37771721">
          <h3>
            <a class="item" href="https://www.tesorio.com/careers#job-openings"
              >Tesorio (YC S15) Is Hiring a Senior Data Engineer and Senior Back
              End Engineer in Latam</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 21:00:47</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37771041">
          <h3>
            <a class="item" href="https://dioragame.com/devlog/?log=3"
              >The Diorama Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 20:14:42</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37771041"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37770627">
          <h3>
            <a
              class="item"
              href="https://simpleflying.com/ural-airlines-prepares-fly-airbus-a320-from-field/"
              >Ural Airlines is preparing to fly a stranded Airbus A320 out of a
              field</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 19:47:32</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37770627"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37770523">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/1-1-1-1-lookup-failures-on-october-4th-2023/"
              >1.1.1.1 lookup failures on October 4th, 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 19:41:21</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37770523"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37770260">
          <h3>
            <a class="item" href="https://rich-text-to-image.github.io/"
              >Expressive text-to-image generation with rich text</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 19:21:53</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37770260"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37770233">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2310.02059"
              >Security weaknesses of Copilot generated code in GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 19:19:35</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37770233"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37770008">
          <h3>
            <a class="item" href="https://github.com/sebosp/s2protocol-rs"
              >Show HN: A nom parser for the Starcraft 2 Protocol Replay
              format</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 19:03:36</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37770008"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
            <div class="text">
              Been having a lot of fun reading an SC2Replay collection through
              nom parsers, serializing into Arrow files so that pola.rs can read
              them and perform data analysis with jupyter lab, plotly or
              interact with SQL operations, etc. Looking for feedback and ideas
              on what to progress on. For example, "through history, are my
              timings getting better?". etc. Also would love to have ideas on
              what libraries to use to perform forecasting.
            </div>
          </section>
        </section>
        <section id="37769962">
          <h3>
            <a
              class="item"
              href="https://blog.vespa.ai/vespa-is-becoming-its-own-company/"
              >Vespa.ai is spinning out of Yahoo as a separate company</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 19:00:07</span
              ><span class="points-container"
                >Points: <span class="points">262</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37769962"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37769633">
          <h3>
            <a class="item" href="https://github.com/cvilsmeier/sqinn-go"
              >Show HN: Sqinn-Go is a Golang library for accessing SQLite
              databases in pure Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 18:36:46</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37769633"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37769546">
          <h3>
            <a class="item" href="https://minios.dev"
              >MiniOS – a lightweight Linux distribution designed for USB
              drive</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 18:30:05</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37769546"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37769139">
          <h3>
            <a
              class="item"
              href="https://oh8hub.substack.com/p/eliminating-radio-interference-from"
              >Eliminating radio interference from Apple charger</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 18:01:14</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37769139"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37767831">
          <h3>
            <a
              class="item"
              href="https://www.nextplatform.com/2023/10/04/intel-to-set-its-fpga-unit-free-to-pursue-its-own-path/"
              >Intel to set its FPGA unit free to pursue its own path</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 16:42:45</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37767831"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37766446">
          <h3>
            <a
              class="item"
              href="https://store.google.com/product/pixel_8_pro?hl=en-US"
              >Pixel 8 Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 15:19:19</span
              ><span class="points-container"
                >Points: <span class="points">369</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37766446"
                  >Comments</a
                ><span class="descendants">: 589</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37765172">
          <h3>
            <a
              class="item"
              href="https://physics.stackexchange.com/questions/782972/what-is-an-attosecond-pulse-and-what-can-you-use-it-for"
              >What is an “attosecond pulse”, and what can you use it for?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 13:51:19</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37765172"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37764581">
          <h3>
            <a
              class="item"
              href="https://jakelazaroff.com/words/an-interactive-intro-to-crdts/"
              >An interactive intro to CRDTs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 13:12:45</span
              ><span class="points-container"
                >Points: <span class="points">724</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37764581"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37764088">
          <h3>
            <a class="item" href="https://annas-blog.org/worldcat-scrape.html"
              >1.3B Worldcat scrape and data science mini-competition</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 12:22:58</span
              ><span class="points-container"
                >Points: <span class="points">214</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37764088"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37750030">
          <h3>
            <a
              class="item"
              href="http://sociological-eye.blogspot.com/2022/02/five-kinds-of-friends.html"
              >Five Kinds of Friends (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 10:32:16</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37750030"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37749834">
          <h3>
            <a
              class="item"
              href="http://turtleware.eu/posts/Proxy-Generic-Function.html"
              >Proxy Generic Function</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 10:02:40</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37749834"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37734941">
          <h3>
            <a
              class="item"
              href="https://ferdychristant.com/color-for-the-color-challenged-884c7aa04a56?gi=67a96925e6bd"
              >Color for the color-challenged</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 07:26:01</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37734941"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37734593">
          <h3>
            <a
              class="item"
              href="https://szymonkaliski.com/writing/2023-10-02-building-a-diy-pen-plotter/"
              >Building a DIY Pen Plotter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 06:23:17</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37734593"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37734531">
          <h3>
            <a
              class="item"
              href="https://randomascii.wordpress.com/2023/10/01/32-mib-working-sets-on-a-64-gib-machine/#more-4032"
              >32 MiB Working Sets on a 64 GiB machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 06:09:48</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37734531"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
