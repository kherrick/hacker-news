<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41510252">
          <h3>
            <a
              class="item"
              href="https://labs.watchtowr.com/we-spent-20-to-achieve-rce-and-accidentally-became-the-admins-of-mobi/"
              >We Spent $20 to Achieve RCE and Accidentally Became the Admins of
              .MOBI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 11:19:12</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41510252"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41510008">
          <h3>
            <a
              class="item"
              href="https://fullfact.org/online/legal-tender-cash-in-shops/"
              >UK Shops can refuse to take cash even though it's legal tender
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 10:34:26</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41510008"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41509713">
          <h3>
            <a
              class="item"
              href="https://radicle.xyz/2024/09/10/radicle-1.0.html"
              >Radicle 1.0 – A Local-First, P2P Alternative to GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 09:40:38</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41509713"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41509330">
          <h3>
            <a
              class="item"
              href="https://www.timeextension.com/news/2024/09/zx-spectrum-documentary-the-rubber-keyed-wonder-gets-london-premiere-next-month"
              >ZX Spectrum Documentary 'The Rubber Keyed Wonder' Gets London
              Premiere</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 08:32:46</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41509330"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41509156">
          <h3>
            <a class="item" href="https://yaak.app/blog/now-open-source"
              >Yaak is now open source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 08:05:26</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41509156"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41508355">
          <h3>
            <a
              class="item"
              href="https://www.chiark.greenend.org.uk/~sgtatham/quasiblog/findloop/"
              >Possibly all the ways to get loop-finding in graphs wrong</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 05:47:12</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41508355"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41508321">
          <h3>
            <a class="item" href="https://www.urban75.org/watchcam/index.html"
              >Casio WQV2 Wrist Camera Photos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 05:41:09</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41508321"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41507879">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/the-magic-of-dc-dc-voltage-conversion"
              >The magic of DC-DC voltage conversion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 03:53:35</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41507879"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41507563">
          <h3>
            <a class="item" href="https://taconomical.com"
              >How economical is your local Taco Bell?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 02:39:27</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41507563"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41506218">
          <h3>
            <a
              class="item"
              href="https://www.plough.com/en/topics/culture/music/arvo-parts-journey"
              >Arvo Pärt's Journey</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 22:24:53</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41506218"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41506157">
          <h3>
            <a
              class="item"
              href="https://www.chaidiscovery.com/blog/introducing-chai-1"
              >Chai-1: Decoding the molecular interactions of life</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 22:13:30</span
              ><span class="points-container"
                >Points: <span class="points">231</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41506157"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41505665">
          <h3>
            <a
              class="item"
              href="https://wegmueller.it/blog/posts/2024-09-02-rust-on-illumos"
              >Rust in illumos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 21:15:24</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41505665"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41505593">
          <h3>
            <a
              class="item"
              href="https://perthirtysix.com/tool/lottery-simulator"
              >Lottery Simulator (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 21:09:04</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41505593"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41505389">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/hillelwayne/archive/why-not-comments/"
              >Why Not Comments</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 20:52:17</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41505389"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41505266">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/thoughtpolice/9c45287550a56b2047c6311fbadebed2"
              >Some of us like "interdiff" code review</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 20:39:51</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41505266"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41504885">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2403.18103"
              >Tutorial on diffusion models for imaging and vision</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 19:59:39</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41504885"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41504331">
          <h3>
            <a
              class="item"
              href="https://www.mixonline.com/business/inside-iron-mountain-its-time-to-talk-about-hard-drives"
              >Iron Mountain: It's Time to Talk About Hard Drives</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 19:04:42</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41504331"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41504026">
          <h3>
            <a
              class="item"
              href="https://www.axios.com/2024/09/10/nyt-tech-union-strike-vote"
              >New York Times tech workers union votes to authorize a strike</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 18:30:45</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41504026"
                  >Comments</a
                ><span class="descendants">: 299</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41502510">
          <h3>
            <a class="item" href="https://illuminate.google.com/home"
              >Google Illuminate: Books and papers turned into audio</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 16:22:13</span
              ><span class="points-container"
                >Points: <span class="points">517</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41502510"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41501496">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/pingora-saving-compute-1-percent-at-a-time/"
              >A good day to trie-hard: saving compute 1% at a time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 15:03:31</span
              ><span class="points-container"
                >Points: <span class="points">537</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41501496"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41501175">
          <h3>
            <a
              class="item"
              href="https://www.16elt.com/2024/09/07/future-proof-code/"
              >On over-engineering; finding the right balance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 14:31:40</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41501175"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41500938">
          <h3>
            <a
              class="item"
              href="https://github.com/yournextstore/yournextstore"
              >Show HN: YourNextStore – an open-source Shopify with Stripe as
              the back end</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 14:08:37</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41500938"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
            <div class="text">
              <p>
                Selling online is often more complex than it needs to be.
                Setting up a storefront with great performance can feel daunting
                and time-consuming. There are many plugins, libraries, etc - the
                choice can be overwhelming.
              </p>
              <p>
                Plus, in e-commerce, the backend and frontend are often written
                in different languages (e.g., PHP, Python, or Ruby for the
                backend). This increases the complexity and makes code
                management more challenging, especially for teams.
              </p>
              <p>
                After working in e-commerce for several years, Michał and I set
                out to build the fastest and most compelling storefront for
                small to medium-sized merchants. Fast e-commerce sites are
                crucial because slow pages hurt sales [1]. Unfortunately,
                performance issues are still very common. The beauty of Your
                Next Store is its simplicity. No additional tools and no
                databases - just Next.js and Stripe.
              </p>
              <p>
                On the technical side, we use App Router, React Server
                Component, Partial Pre-Rendering, Optimistic Updates, and
                Streaming with Suspense to make the store faster and leaner so
                it feels almost like a static website.
              </p>
              <p>In summary:</p>
              <p>
                Modern &amp; Popular Stack: Built with Next.js, React.js, and
                TypeScript, making development faster and hiring easier compared
                to platforms that use less common frameworks like Shopify’s
                Liquid.
              </p>
              <p>
                No Database Needed: Stripe handles the backend, reducing the
                need for complex infrastructure and simplifying the setup
                process.
              </p>
              <p>
                Open Source: Free and open (AGPL), with the option for a
                commercial license if needed.
              </p>
              <p>
                This is just the beginning. We want to make YNS even better and
                easier to use and eventually provide a good, open-source
                alternative to Shopify.
              </p>
              <p>
                Check our code at
                <a href="https://github.com/yournextstore/yournextstore"
                  >https://github.com/yournextstore/yournextstore</a
                >
              </p>
              <p>
                We’d love to hear your thoughts and feedback! What features
                would you like to see next?
              </p>
              <p>
                [1]:
                <a
                  href="https://www.deloitte.com/ie/en/services/consulting/research/milliseconds-make-millions.html"
                  >https://www.deloitte.com/ie/en/services/consulting/research/...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41500506">
          <h3>
            <a
              class="item"
              href="https://briefer.cloud/blog/posts/open-source-strategy/"
              >Going open-source as a VC-Backed company</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 13:16:28</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41500506"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41497377">
          <h3>
            <a
              class="item"
              href="https://tech.marksblogg.com/ai-sar-satellites-umbra-aircraft-detection.html"
              >Satellites Spotting Aircraft</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 05:15:53</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41497377"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41487833">
          <h3>
            <a class="item" href="https://github.com/overlay-payments/A1"
              >Show HN: A1 – Faster, Dynamic, More Reliable NFC Transactions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-09 @ 12:20:47</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41487833"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41480957">
          <h3>
            <a
              class="item"
              href="https://bytepawn.com/quantum-entanglement-bell-inequality-python.html"
              >Breaking Bell's Inequality with Monte Carlo Simulations in
              Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 15:28:35</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41480957"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41480213">
          <h3>
            <a class="item" href="https://anglicansonline.org/special/gaiters/"
              >Through the Years with Gaiters (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 13:15:47</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41480213"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41480038">
          <h3>
            <a
              class="item"
              href="https://blog.stuffedcow.net/2024/06/microwave-failure-spontaneously-turns-on/"
              >Microwave spontaneously turned on by its LED display</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 12:37:44</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41480038"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41479882">
          <h3>
            <a class="item" href="https://consentomatic.au.dk/"
              >Consent-O-Matic – automatically fills ubiquitous pop-ups with
              your preferences</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 11:56:07</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41479882"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41473640">
          <h3>
            <a
              class="item"
              href="https://www.artbasel.com/stories/jeremy-couillard-video-games-mit-list-visual-arts-center-critique-contemporary-life-digital-landscapes"
              >Jeremy Couillard's video games capture what it's like to be
              alive</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-07 @ 12:48:13</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41473640"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
