<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43707308">
          <h3>
            <a class="item" href="https://github.com/davidesantangelo/krep"
              >Show HN: K(r)ep - A high-performance string search utility</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 16:26:06</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43707308"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43707021">
          <h3>
            <a
              class="item"
              href="https://github.com/harishsg993010/damn-vulnerable-MCP-server"
              >Damn Vulnerable MCP Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 16:00:21</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43707021"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43706706">
          <h3>
            <a
              class="item"
              href="https://archive.org/details/attentionkmartshoppers"
              >Attention K-Mart Shoppers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 15:30:59</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43706706"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43706586">
          <h3>
            <a
              class="item"
              href="https://github.com/iot-ecology/rust-iot-platform"
              >Rust-IoT-Platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 15:18:57</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43706586"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43706210">
          <h3>
            <a
              class="item"
              href="https://medium.com/@carlmkadie/how-to-optimize-your-rust-program-for-slowness-eb2c1a64d184"
              >How to Optimize Rust for Slowness: Inspired by New Turing Machine
              Results</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 14:43:47</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43706210"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43706118">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/hot-chips"
              >Future Chips Will Be Hotter Than Ever</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 14:36:19</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43706118"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43706037">
          <h3>
            <a
              class="item"
              href="https://theappendix.net/posts/2014/02/darwins-children-drew-vegetable-battles-on-the-origin-of-species"
              >Darwin's Children Drew All over the "On the Origin of Species"
              Manuscript (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 14:28:36</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43706037"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43705991">
          <h3>
            <a class="item" href="https://docs.bauplanlabs.com/en/latest/"
              >Bauplan – Git-for-data pipelines on object storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 14:25:00</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43705991"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43705824">
          <h3>
            <a
              class="item"
              href="https://github.com/Validark/Accelerated-Zig-Parser"
              >A high-throughput parser for the Zig programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 14:11:53</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43705824"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43705796">
          <h3>
            <a
              class="item"
              href="https://nsf-gov-resources.nsf.gov/2023-04/EndlessFrontier75th_w.pdf"
              >Science, the Endless Frontier (1945) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 14:09:22</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43705796"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43705649">
          <h3>
            <a
              class="item"
              href="https://nurpax.github.io/posts/2019-08-18-dirty-tricks-6502-programmers-use.html"
              >Dirty tricks 6502 programmers use (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 13:58:36</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43705649"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43705632">
          <h3>
            <a class="item" href="https://antirez.com/news/150"
              >Reproducing Hacker News writing style fingerprinting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 13:57:42</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43705632"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43705144">
          <h3>
            <a class="item" href="https://github.com/onkernel/kernel-images"
              >Show HN: We Put Chromium on a Unikernel (OSS Apache 2.0)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 13:19:46</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43705144"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>- Chrome DevTools Protocol (for Playwright/Puppeteer)</p>
              <p>- noVNC (for live view)</p>
              <p>
                We’ve been following the unikernel space for a while, so we
                decided to see if we could get our image on one. We went with
                Unikraft Cloud[1]. Here’s how it did:
              </p>
              <p>- Boot-up time: 10–20ms (vs. ~5s for Docker containers)</p>
              <p>- Near 0 CPU/memory consumption when idle</p>
              <p>- Still ~8GB RAM when active (headful Chromium)</p>
              <p>Potential use cases:</p>
              <p>
                - Standby mode during long-running jobs: unikernels can sleep
                after X sec of inactivity, reducing clock time costs
              </p>
              <p>
                - Session reuse: auth/session cookies persist for hours/days.
                Basically as long as the cookies are valid
              </p>
              <p>
                - Cold start speed: good for low-latency, event-based handling
              </p>
              <p>
                We open sourced it with Apache 2.0! Feel free to fork or submit
                an issue / PR. Open to feedback or suggestions.
                www.github.com/onkernel/kernel-images
              </p>
              <p>==</p>
              <p>
                [0]
                <a href="https://github.com/onkernel/kernel-images"
                  >https://github.com/onkernel/kernel-images</a
                >
              </p>
              <p>
                [1]
                <a href="https://unikraft.cloud/">https://unikraft.cloud/</a>
              </p>
              <p>
                [2] Thanks to the Unikraft Cloud team @fhuici @nderjung
                @razvandeax for helping us figure this out (we're not
                affiliated)
              </p>
              <p>[3] (OPs) @rgarcia @juecd</p>
            </div>
          </section>
        </section>
        <section id="43705065">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43705065"
              >Launch HN: Jasmine (YC S22) – Automating REC compliance and
              payouts for solar</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 13:11:12</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43705065"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.jasmine.energy">https://www.jasmine.energy</a
              >), a tool that helps residential and commercial solar owners
              automatically register their systems, track energy generation, and
              get paid for Renewable Energy Certificates (RECs).
              <p>
                RECs are tradeable certificates for clean electricity, issued by
                energy markets across the US. Most people with rooftop or small
                commercial solar have never heard of them, let alone claimed
                them, but they’re real! They are typically bought by utilities
                or companies to meet climate targets.
              </p>
              <p>
                The problem is, the process to claim and sell RECs is a
                mess—designed decades ago for utility-scale players, not
                individuals or small businesses.
              </p>
              <p>
                To register a system and start claiming RECs, you usually have
                to: Navigate one of 10+ regional REC registries, each with its
                own documentation, forms, and rules; Pull generation data from
                your inverter or utility, format it, and submit it manually; Try
                to find a buyer (often through a broker or opaque exchange) and
                negotiate payment.
              </p>
              <p>
                That takes weeks if not months for a single system, and most
                people give up. As a result, millions of solar installations
                leave income on the table every year. We started Jasmine Energy
                after seeing this firsthand: some of us worked in energy
                startups, and others watched our parents install solar but never
                claim a single REC.
              </p>
              <p>
                Jasmine automates all of this. Our platform: Extracts metadata
                from your solar documents using AI and auto-registers your
                system in the correct registry; Connects to your inverter to
                submit generation data and verify REC eligibility; Lists RECs
                for sale through partners, tracks the sale process, and issues
                payouts—all through a single dashboard.
              </p>
              <p>
                This domain is a good fit for automation and LLMs—not to
                generate text, but to (1) structure unstructured documents, (2)
                interact with legacy government websites where there’s no API,
                and (3) deal with repetitive bureaucratic language.
              </p>
              <p>
                To be clear, we’re not trying to “squeeze public funding” or
                take unfair advantage of the system. REC sales happen in
                voluntary and compliance markets (usually funded by corporate
                buyers and utilities, not taxpayers). Jasmine doesn’t create or
                inflate incentives—it just helps people claim what already
                exists but is hard to access. We’re making the REC market more
                efficient.
              </p>
              <p>
                RECs have been one of the most effective and widely adopted
                incentive systems to drive grid decarbonization. We’re excited
                to be making them easier to access.
              </p>
              <p>
                The product is live now for solar owners in PJM, M-RETS, and
                ERCOT territories (more coming soon). If you already have solar,
                you can upload your docs and start the process at
                <a href="https://assets.jasmine.energy"
                  >https://assets.jasmine.energy</a
                >.
              </p>
              <p>
                We’d love feedback from this community—on the product, the
                market, or any edge cases you think we should worry about. And
                of course we’ll be happy to answer any questions!
              </p>
            </div>
          </section>
        </section>
        <section id="43704904">
          <h3>
            <a
              class="item"
              href="https://microsoft.design/articles/introducing-kermit-a-typeface-for-kids/"
              >Kermit: A typeface for kids</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 12:57:13</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43704904"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43704853">
          <h3>
            <a class="item" href="https://herb-tools.dev/"
              >Herb: Powerful and seamless HTML-aware ERB parsing and tooling</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 12:52:27</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43704853"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43704596">
          <h3>
            <a
              class="item"
              href="https://thereader.mitpress.mit.edu/how-nintendo-bled-atari-games-to-death/"
              >Nintendo Bled Atari Games to Death</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 12:33:33</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43704596"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43704286">
          <h3>
            <a
              class="item"
              href="https://www.streak.com/careers/staff-ui-engineer"
              >Streak (YC W22) is hiring Staff Engineers for local first, high
              perf front ends</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 12:01:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43703623">
          <h3>
            <a
              class="item"
              href="https://bjlkeng.io/posts/an-introduction-to-stochastic-calculus/"
              >An Introduction to Stochastic Calculus (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 10:26:00</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43703623"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43700633">
          <h3>
            <a
              class="item"
              href="https://www.jeremykun.com/2015/04/06/markov-chain-monte-carlo-without-all-the-bullshit/"
              >Markov Chain Monte Carlo Without All the Bullshit (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 02:01:46</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43700633"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43700607">
          <h3>
            <a
              class="item"
              href="https://www.csoonline.com/article/3963190/cve-program-faces-swift-end-after-dhs-fails-to-renew-contract-leaving-security-flaw-tracking-in-limbo.html"
              >CVE program faces swift end after DHS fails to renew contract</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 01:57:27</span
              ><span class="points-container"
                >Points: <span class="points">1808</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43700607"
                  >Comments</a
                ><span class="descendants">: 960</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43692677">
          <h3>
            <a
              class="item"
              href="https://www.molsonhart.com/blog/america-underestimates-the-difficulty-of-bringing-manufacturing-back"
              >America underestimates the difficulty of bringing manufacturing
              back</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 13:50:49</span
              ><span class="points-container"
                >Points: <span class="points">500</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43692677"
                  >Comments</a
                ><span class="descendants">: 683</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43691334">
          <h3>
            <a
              class="item"
              href="https://knowyourmeme.com/memes/events/april-2025-4chan-sharty-hack-and-janitor-email-leak"
              >4chan Sharty Hack And Janitor Email Leak</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 11:30:56</span
              ><span class="points-container"
                >Points: <span class="points">641</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43691334"
                  >Comments</a
                ><span class="descendants">: 860</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43690289">
          <h3>
            <a class="item" href="https://filiph.github.io/unsure/"
              >Show HN: Unsure Calculator – back-of-a-napkin probabilistic
              calculator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 08:22:59</span
              ><span class="points-container"
                >Points: <span class="points">797</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43690289"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682343">
          <h3>
            <a
              class="item"
              href="https://news.cuanschutz.edu/news-stories/virtual-human-a-living-cadaver-pushes-boundaries-of-anatomical-science"
              >Virtual human – a living cadaver – pushes boundaries of
              anatomical science(2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:26:01</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682343"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43681521">
          <h3>
            <a
              class="item"
              href="https://www-users.york.ac.uk/~ss44/joke/elephant.htm"
              >Elephant in Cairo (Byte Magazine, 1989)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 14:12:43</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43681521"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43678909">
          <h3>
            <a class="item" href="https://keithp.com/blogs/sanitizer-fun/"
              >Fun with -fsanitize=undefined and Picolibc</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 07:26:46</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43678909"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43677326">
          <h3>
            <a
              class="item"
              href="https://www.sciencedaily.com/releases/2025/03/250327142001.htm"
              >Calcium may have unlocked the origins of life's molecular
              asymmetry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 01:41:10</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43677326"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43677122">
          <h3>
            <a
              class="item"
              href="https://probablydance.com/2018/06/16/fibonacci-hashing-the-optimization-that-the-world-forgot-or-a-better-alternative-to-integer-modulo/"
              >Fibonacci Hashing: The Optimization That the World Forgot</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 01:02:41</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43677122"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43673575">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-025-08780-y"
              >Hunter-gatherer sea voyages extended to remotest Mediterranean
              islands</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-13 @ 15:40:21</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43673575"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
