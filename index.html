<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40386026">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/places/zwentendorf-nuclear-power-plant"
              >Zwentendorf Nuclear Power Plant: Finished in 1978 but never
              used</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 03:16:38</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40386026"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40385710">
          <h3>
            <a
              class="item"
              href="https://darrellowens.substack.com/p/how-urban-renewal-ruined-everything"
              >Urban renewal left the U.S. too scared to build</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 02:21:57</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40385710"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40385536">
          <h3>
            <a class="item" href="https://rust-exercises.com/"
              >100 Exercises to Learn Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 01:53:13</span
              ><span class="points-container"
                >Points: <span class="points">412</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40385536"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40384959">
          <h3>
            <a
              class="item"
              href="https://www.potaroo.net/ispcol/2024-05/starlink-tcp.html"
              >A transport protocol's view of Starlink</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 00:17:02</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40384959"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40384421">
          <h3>
            <a class="item" href="https://smudge.ai/blog/ratelimit-algorithms"
              >Visualizing algorithms for rate limiting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 23:07:20</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40384421"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40384013">
          <h3>
            <a
              class="item"
              href="https://cabel.com/2024/05/16/the-forged-apple-employee-badge/"
              >A forged Apple employee badge</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 22:19:06</span
              ><span class="points-container"
                >Points: <span class="points">532</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40384013"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40383978">
          <h3>
            <a
              class="item"
              href="https://slack.com/trust/data-management/privacy-principles?nojsmode=1"
              >Slack AI Training with Customer Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 22:16:01</span
              ><span class="points-container"
                >Points: <span class="points">453</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40383978"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40383263">
          <h3>
            <a
              class="item"
              href="https://www.railtarget.eu/technologies-and-infrastructure/deutsche-bahn-introduces-metawindow-a-gamechanger-in-noise-reduction-for-railways-8449.html"
              >Deutsche Bahn introduces "MetaWindow"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 21:14:47</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40383263"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40383078">
          <h3>
            <a class="item" href="https://skio.com/careers/"
              >Skio (YC S20) – Subscriptions for Shopify, ReCharge Migrations
              – Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 21:01:29</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40382275">
          <h3>
            <a
              class="item"
              href="https://samuele963.github.io/electrics/history.html"
              >History of the Italian electrical system</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 19:39:08</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40382275"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40382163">
          <h3>
            <a
              class="item"
              href="https://www.architecturalrecord.com/articles/16880-exit-strategy-the-case-for-single-stair-egress"
              >Exit Strategy: The Case for Single-Stair Egress</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 19:29:18</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40382163"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40381841">
          <h3>
            <a class="item" href="https://snai.pe/posts/c-smart-pointers"
              >Smart Pointers in (GNU) C</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 18:56:55</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40381841"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40380744">
          <h3>
            <a
              class="item"
              href="https://slate.com/technology/2024/05/deviantart-what-happened-ai-decline-lawsuit-stability.html"
              >The Downfall of DeviantArt</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 17:12:22</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40380744"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40380499">
          <h3>
            <a
              class="item"
              href="https://theprogressplaybook.com/2024/04/17/in-numbers-americas-dramatic-shift-from-gas-power-plants-to-batteries/"
              >America's dramatic shift from gas power plants to batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 16:51:37</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40380499"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379982">
          <h3>
            <a
              class="item"
              href="https://blog.playcanvas.com/build-webgpu-apps-today-with-playcanvas/"
              >Build WebGPU apps with PlayCanvas</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 16:04:47</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379982"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379532">
          <h3>
            <a
              class="item"
              href="https://crystalverse.com/sodium-chloride-crystals/"
              >Growing sodium chloride crystals at home</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 15:24:19</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379532"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379488">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-01449-y"
              >Egypt's pyramids may have been built on a long-lost branch of the
              Nile</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 15:20:45</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379488"
                  >Comments</a
                ><span class="descendants">: 329</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379175">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/computer-scientists-invent-an-efficient-new-way-to-count-20240516/"
              >Computer scientists invent an efficient new way to count</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:54:25</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379175"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40378791">
          <h3>
            <a class="item" href="https://www.d3indepth.com/">D3 in Depth</a>
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:18:07</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40378791"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40378760">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2023/china-tech-workers-investors-founders-app/"
              >Jike: The obscure social media app beloved by China's tech
              scene</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:15:04</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40378760"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40377787">
          <h3>
            <a class="item" href="https://chessdream.ai"
              >Show HN: Chessdream – Generate realistic chess positions with
              AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 12:56:31</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40377787"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                It turned out to be quite effective and I find it surprisingly
                fun and instructive to generate e.g. endgame positions with a
                certain pawn structure (set low temperature, place some pawns
                and position the kings, adjust number of pieces to get an
                endgame), and then figure out how to win vs. the computer in
                those positions.
              </p>
              <p>
                I hooked it up so that you can easily play vs. a computer,
                either via lichess analysis → continue from here, or via my own
                project Noctie.
              </p>
              <p>
                I’m thinking about whether I could develop it further to create
                position variants on a certain theme that the AI thinks I need
                to practice, or maybe make a PvP feature where you play a random
                position vs. a human. Ideas or feedback?
              </p>
            </div>
          </section>
        </section>
        <section id="40370646">
          <h3>
            <a class="item" href="https://erkin.party/blog/200715/evolution/"
              >The evolution of a Scheme programmer (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 18:33:05</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40370646"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40370644">
          <h3>
            <a
              class="item"
              href="https://spritely.institute/news/make-a-game-with-hoot-for-the-lisp-game-jam.html"
              >Make a game with Hoot for the Lisp Game Jam</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 18:32:53</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40370644"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366279">
          <h3>
            <a
              class="item"
              href="https://tastecooking.com/the-united-states-of-avocado/"
              >The United States of Avocado</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:54:25</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366279"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40365956">
          <h3>
            <a
              class="item"
              href="https://www.collectorsweekly.com/articles/how-the-soviets-revolutionized-wristwatches/"
              >How the Soviets revolutionized wristwatches (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:21:21</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40365956"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40365777">
          <h3>
            <a
              class="item"
              href="https://www.tfeb.org/fragments/2024/05/15/an-iteration-construct-for-common-lisp/"
              >Štar: an iteration construct for Common Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:03:20</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40365777"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40365433">
          <h3>
            <a class="item" href="https://archriscv.felixc.at/"
              >Arch Linux RISC-V</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 11:25:25</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40365433"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40364220">
          <h3>
            <a class="item" href="https://ai.google.dev/gemini-api/docs/caching"
              >Context caching guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 07:56:22</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40364220"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363481">
          <h3>
            <a
              class="item"
              href="https://www.dolthub.com/blog/2024-05-15-24-hour-bug-fixes/"
              >How to fix bugs in 24 hours or less</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 05:44:18</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40363481"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363426">
          <h3>
            <a
              class="item"
              href="https://github.com/SPLWare/esProc/wiki/Simplifying-JOIN-syntax-(JOIN-Simplification-and-Acceleration-Series-3)"
              >Simplifying Join Syntax</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 05:35:44</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40363426"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
