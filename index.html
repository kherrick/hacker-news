<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37572518">
          <h3>
            <a
              class="item"
              href="https://www.reviewjournal.com/business/casinos-gaming/analyst-mgm-losing-4-2m-8-4m-a-day-because-of-cyberattack-2906379/"
              >MGM losing up to $8.4M a day due to cyberattack, analyist says</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 16:39:21</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37572518"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37572394">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20230718112821/https://www.nature.com/articles/d41586-023-02299-w"
              >How many medical studies are faked or flawed?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 16:31:31</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37572394"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37571919">
          <h3>
            <a class="item" href="https://signal.org/blog/pqxdh/"
              >Quantum Resistance and the Signal Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 16:02:11</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37571919"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37571535">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2309.04332"
              >Graph Neural Networks Use Graphs When They Shouldn't</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 15:40:38</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37571535"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570947">
          <h3>
            <a
              class="item"
              href="https://fitzgeraldnick.com/2019/11/01/always-bump-downwards.html"
              >Always Bump Downwards (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 15:04:49</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570947"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570929">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37570929"
              >Show HN: Graphite – Stacked Diffs on GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 15:03:24</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570929"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <p>Hi HN!</p>
              <p>
                I’m Tomas, co-founder of graphite.dev, and today we’re launching
                Graphite after almost two years of development in closed beta.
                [1] Graphite started as an internal solution to our own problem.
                When we (engineers from Meta, Google and Airbnb) left our
                previous roles, we lost access to the internal code review tools
                we loved. So we built our own.
              </p>
              <p>https://graphite.dev</p>
              <p>---</p>
              <p>
                Graphite is how the fastest developers ship code - it’s a
                developer tool that allows you to create smaller pull requests,
                stay unblocked, and ship faster with “stacking” (creating a set
                of dependent pull requests). Stacking [2] allows developers to
                break up large pull requests (PRs) into smaller ones that can be
                reviewed &amp; merged independently, while keeping ongoing
                development unblocked. Engineering best practices at Google
                advise that a “reasonable” PR be around 100 lines, and recommend
                splitting PRs in order to achieve this through stacking or other
                methods. [3]
              </p>
              <p>
                Unlike other tools like Phabricator, Gerrit, or Sapling,
                Graphite syncs seamlessly with your GitHub repositories, so that
                you don’t have to manage any extra infrastructure. This also
                means that even if your teammates don’t use Graphite yet, you
                still can.
              </p>
              <p>
                Here’s what you can expect when you sign in to Graphite with
                your GitHub account:
              </p>
              <p>
                (1) First class support for stacking: At its core, Graphite
                enables “stacking”—a workflow used by engineers at top companies
                like Meta and Google to create small, dependent sets of pull
                requests. The Graphite CLI, web app, and VS Code extension all
                come together to empower engineers to start stacking.
              </p>
              <p>
                (2) Pull request inbox: You can think of this as your home page
                on Graphite, where you have full visibility into the status of
                all your PRs and know what still needs to be done across every
                repo, author, and stage of review. You can also create custom
                inboxes that filter PRs on reviewers, authors, labels, CI
                status, and more.
              </p>
              <p>
                (3) Streamlined code review interface: Graphite’s pull request
                page removes tabs and minimizes distractions, with the aim of
                putting your code front and center. You can use keyboard
                shortcuts to navigate between files and comments or to move
                between PRs in your stack. You can also import custom memes and
                gifs to add some to your reviews too!
              </p>
              <p>
                (4) AI-powered pull requests: Auto-generate a detailed
                description for every PR with our OpenAI integration. You can
                even turn your comments into suggested code changes (coming
                soon!).
              </p>
              <p>
                (5) Real-time notifications: Connect Graphite to your Slack
                workspace to stay up-to-date on review requests, comments
                threads, merge status, and other activity on your PRs. For
                smaller PRs, you can leave a review (and even merge) directly
                from Slack.
              </p>
              <p>
                (6) Stack-aware merges: Since Graphite is built to support a
                stacking workflow, it automates the manual work of rebasing PRs
                when it’s time to merge. You can merge your stacks with one
                click from the web app, or in a single command from the CLI.
              </p>
              <p>
                Feel free to take a look at our getting started guide [4] or
                product tour video [5] for a tutorial on how to get started, and
                drop your comments to us below!
              </p>
              <p>[1] http://graphite.dev/blog/launch</p>
              <p>[2] http://stacking.dev</p>
              <p>
                [3]
                https://google.github.io/eng-practices/review/developer/small-cls.html
              </p>
              <p>[4] https://graphite.dev/docs/getting-started-with-graphite</p>
              <p>[5] https://www.youtube.com/watch?v=sBcd9uopLOY</p>
            </div>
          </section>
        </section>
        <section id="37570785">
          <h3>
            <a class="item" href="https://pcmaffey.com/counting-ghosts"
              >Counting Ghosts: A case for abandoning web analytics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 14:53:01</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570785"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570743">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/new-physics-inspired-generative-ai-exceeds-expectations-20230919/"
              >The Physical Process That Powers a New Type of Generative AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 14:50:23</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570743"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570719">
          <h3>
            <a
              class="item"
              href="https://medium.com/graalvm/graalvm-for-jdk-21-is-here-ee01177dd12d"
              >GraalVM for JDK 21</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 14:48:03</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570719"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570407">
          <h3>
            <a
              class="item"
              href="https://twitter.com/matthew_d_green/status/1703959863796158678"
              >Snowden leak: Cavium networking hardware may contain NSA
              backdoor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 14:24:27</span
              ><span class="points-container"
                >Points: <span class="points">411</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570407"
                  >Comments</a
                ><span class="descendants">: 243</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570037">
          <h3>
            <a class="item" href="https://jdk.java.net/21/release-notes"
              >JDK 21 Release Notes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 14:00:06</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570037"
                  >Comments</a
                ><span class="descendants">: 213</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37569911">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/09/19/900_tons_nvidia_servers/"
              >Nvidia's 900 tons of GPU muscle bulks up server market, slims
              down wallets</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 13:50:01</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37569911"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37569622">
          <h3>
            <a
              class="item"
              href="https://resobscura.substack.com/p/historical-maps-probably-helped-cause"
              >Historical maps probably helped cause World War I</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 13:24:02</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37569622"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37569258">
          <h3>
            <a class="item" href="https://blog.ovalerio.net/archives/2615"
              >Improving your online privacy: An update</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 12:54:09</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37569258"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568856">
          <h3>
            <a
              class="item"
              href="https://tigerbeetle.com/blog/2023-09-19-64-bit-bank-balances-ought-to-be-enough-for-anybody/"
              >64-bit bank balances ‘ought to be enough for anybody’?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 12:14:18</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568856"
                  >Comments</a
                ><span class="descendants">: 246</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568732">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/the-pirate-bay-celebrates-its-20th-anniversary-230919/"
              >The Pirate Bay's 20th Anniversary</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 12:00:57</span
              ><span class="points-container"
                >Points: <span class="points">262</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568732"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568554">
          <h3>
            <a class="item" href="https://simulavr.com/blog/headsets-delayed/"
              >SimulaVR $1.2M short of the project's total cost</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 11:41:47</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568554"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568549">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2309.08732"
              >The path to detecting extraterrestrial life with
              astrophotonics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 11:41:18</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568549"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568350">
          <h3>
            <a
              class="item"
              href="https://www.stewartcalculus.com/data/default/upfiles/LiesCalcAndCompTold.pdf"
              >Lies my calculator and computer told me [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 11:19:10</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568350"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568278">
          <h3>
            <a class="item" href="https://vcmi.eu"
              >VCMI: Open-Source Engine for Heroes of Might and Magic III</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 11:12:06</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568278"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37567972">
          <h3>
            <a class="item" href="https://lichess.org/ads"
              >Lichess: Block Ads and Trackers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 10:39:51</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37567972"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37567700">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/bard/google-bard-new-features-update-sept-2023/"
              >Bard can now connect to your Google Apps and services</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 10:10:06</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37567700"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37567115">
          <h3>
            <a
              class="item"
              href="https://about.gitlab.com/releases/2023/09/18/security-release-gitlab-16-3-4-released/"
              >Gitlab Critical Security Release: 16.3.4 and 16.2.7</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 08:44:13</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37567115"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37567009">
          <h3>
            <a class="item" href="https://fx.wtf/">Fx – Terminal JSON Viewer</a>
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 08:26:55</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37567009"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37566992">
          <h3>
            <a
              class="item"
              href="https://nicolasbouliane.com/projects/anmeldung-form-filler"
              >I digitalized Berlin's registration form</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 08:24:19</span
              ><span class="points-container"
                >Points: <span class="points">463</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37566992"
                  >Comments</a
                ><span class="descendants">: 272</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37566929">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/uk-finally-rejoins-horizon-europe-research-funding-scheme"
              >U.K. rejoins Horizon Europe research funding scheme</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 08:16:42</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37566929"
                  >Comments</a
                ><span class="descendants">: 207</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37566458">
          <h3>
            <a
              class="item"
              href="https://nicole.express/2023/have-you-read-atari-today.html"
              >A Line at a Time: The Atari 2600, Now with S-Video</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 06:52:08</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37566458"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37565761">
          <h3>
            <a
              class="item"
              href="https://www.asiamediacentre.org.nz/features/a-guide-to-using-asian-names/"
              >A basic guide to using Asian names</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 04:59:41</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37565761"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37562541">
          <h3>
            <a class="item" href="https://apps.aist.org/steelwheel/index.html"
              >AIST Steel Wheel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-18 @ 21:47:55</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37562541"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37557438">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/collection/the-astrologer-of-the-nineteenth-century-1825"
              >The Astrologer of the Nineteenth Century (1825)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-18 @ 15:21:52</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37557438"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
