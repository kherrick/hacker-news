<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40376143">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/typewise/jobs/myJcREP-product-designer-f-m-x"
              >Typewise (YC S22) is hiring Product Designer for AI writing
              assistant</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 07:59:41</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40375700">
          <h3>
            <a
              class="item"
              href="https://marc.info/?l=openbsd-tech&amp;m=171562561424289&amp;w=2"
              >(OpenBSD) Add sysctl to disable Nagle's algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 06:15:01</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40375700"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40375641">
          <h3>
            <a
              class="item"
              href="https://thefoggiest.dev/2024/05/16/my-sony-hb-f1xv"
              >My Sony HB-F1XV</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 06:03:07</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40375641"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40375548">
          <h3>
            <a
              class="item"
              href="https://www.openvc.app/blog/vcs-arent-your-friends"
              >VCs aren’t your friends</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 05:42:23</span
              ><span class="points-container"
                >Points: <span class="points">283</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40375548"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40375498">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/security/2024/05/ssh-backdoor-has-infected-400000-linux-servers-over-15-years-and-keeps-on-spreading/"
              >Kernel.org servers infected with backdoors for two years from
              2009</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 05:32:35</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40375498"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40375341">
          <h3>
            <a class="item" href="https://graydon2.dreamwidth.org/312681.html"
              >Some notes on Rust, mutable aliasing and formal verification</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 05:01:53</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40375341"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40375226">
          <h3>
            <a
              class="item"
              href="https://www.r-consortium.org/blog/2024/05/15/enhancing-r-the-vision-and-impact-of-jan-viteks-maintainr-initiative"
              >Enhancing R: The Vision and Impact of Jan Vitek's MaintainR
              Initiative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 04:37:13</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40375226"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40375178">
          <h3>
            <a
              class="item"
              href="https://blogs.sciencemag.org/pipeline/archives/2019/11/21/the-higher-states-of-bromine"
              >Things I won't work with: the higher states of bromine (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 04:24:02</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40375178"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40374946">
          <h3>
            <a
              class="item"
              href="https://wadetregaskis.com/swift-sucks-at-web-serving-or-does-it/"
              >Swift sucks at web serving or does it?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 03:29:41</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40374946"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40374879">
          <h3>
            <a
              class="item"
              href="https://thecentercolumn.com/2020/01/17/earths-rotation-limits-ibis-performance-to-6-3-stops/"
              >Earth rotation limits in-body image stabilization to 6.3 stops
              (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 03:17:08</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40374879"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40373931">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2024/05/15/utah-locals-are-getting-cheap-10-gbps-fiber-thanks-to-local-governments/"
              >Utah Locals Are Getting Cheap 10 Gbps Fiber Thanks to Local
              Governments</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 00:22:33</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40373931"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40372317">
          <h3>
            <a class="item" href="https://rachelbythebay.com/w/2024/05/15/ro/"
              >SSD death, tricky read-only filesystems, and systemd magic?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 21:02:50</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40372317"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40371785">
          <h3>
            <a
              class="item"
              href="https://thebulletin.org/2024/05/a-plague-comes-before-the-fall-lessons-from-roman-history/"
              >A ‘plague’ comes before the fall: lessons from Roman history</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 20:11:55</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371785"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40371650">
          <h3>
            <a
              class="item"
              href="https://www.straightdope.com/21341781/in-medicine-what-s-the-difference-between-an-ectomy-an-ostomy-and-an-otomy"
              >What’s the difference between an -ectomy, an -ostomy, and an
              -otomy? (1986)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 20:01:37</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371650"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40371612">
          <h3>
            <a
              class="item"
              href="https://github.com/ggerganov/llama.cpp/pull/7154"
              >New exponent functions that make SiLU and SoftMax 2x faster, at
              full accuracy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 19:57:01</span
              ><span class="points-container"
                >Points: <span class="points">322</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371612"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40371467">
          <h3>
            <a class="item" href="https://desktopdocs.com"
              >Show HN: I made a Mac app to search my images and videos locally
              with ML</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 19:44:46</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371467"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
            <div class="text">
              <p>
                Once you find the file you're looking for you can resize it,
                export it to Adobe Premiere Pro, or drag and drop it into
                another app.
              </p>
              <p>
                I built Desktop Docs because I keep tons of media files on my
                computer and I can never remember where I save stuff (lots of
                screenshots, memes, and downloads). The Apple Photos app also
                only supports photos in your iCloud.
              </p>
              <p>
                Desktop Docs supports adding folders or individual files to an
                AI Library where you can search by the contents of your files,
                not just file titles.
              </p>
              <p>
                You can search by objects ("cardboard box"), actions ("man
                smiling", "car driving"), by emotion ("surprised woman", "sad
                cowboy"), or the text in the frame (great for screenshots or
                memes).
              </p>
              <p>
                It's also 100% private. Make any media searchable without it
                ever leaving your computer.
              </p>
              <p>
                How I built it: - 100% Javascript (I'm using Electron JS and
                React JS). - Embedding generation (CLIP from OpenAI is used to
                compute the image embeddings and text embeddings for user
                queries). - Redis (storing and doing KNN search on the
                embeddings with this DB). - Image/video editing (the app ships
                with FFmpeg binaries to explode videos into individual frames
                and scale images).
              </p>
              <p>
                Demo:
                <a href="https://www.youtube.com/watch?v=EIUgPNHOKKc"
                  >https://www.youtube.com/watch?v=EIUgPNHOKKc</a
                >
              </p>
              <p>
                If there are any features you'd like to see in Desktop Docs or
                want to learn more about how I built it, drop me a comment
                below. Happy to share more.
              </p>
            </div>
          </section>
        </section>
        <section id="40371401">
          <h3>
            <a
              class="item"
              href="https://developers.googleblog.com/en/project-gameface-launches-on-android/"
              >Project Gameface launches on Android</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 19:39:28</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371401"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40371341">
          <h3>
            <a
              class="item"
              href="https://www.pitt.edu/pittwire/features-articles/gas-well-wastewater-lithium"
              >Some lithium could come from wastewater</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 19:34:14</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371341"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40369467">
          <h3>
            <a
              class="item"
              href="https://jepsen.io/analyses/datomic-pro-1.0.7075"
              >Jepsen: Datomic Pro 1.0.7075</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 16:57:30</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40369467"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40369319">
          <h3>
            <a class="item" href="https://github.com/reworkd/tarsier"
              >Show HN: Tarsier – Vision utilities for web interaction agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 16:46:15</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40369319"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
            <div class="text">
              <p>
                Over the course of experimenting with pruned HTML, accessibility
                trees, and other perception systems for web agents, we've
                iterated on Tarsier's components to maximize downstream
                agent/codegen performance.
              </p>
              <p>Here's the Tarsier pipeline in a nutshell:</p>
              <p>
                1. tag interactable elements with IDs for the LLM to act upon
                &amp; grab a full-sized webpage screenshot
              </p>
              <p>
                2. for text-only LLMs, run OCR on the screenshot &amp; convert
                it to whitespace-structured text (this is the coolest part imo)
              </p>
              <p>
                3. map LLM intents back to actions on elements in the browser
                via an ID-to-XPath dict
              </p>
              <p>
                Humans interact with the web through visually-rendered pages,
                and agents should too. We run Tarsier in production for
                thousands of web data extraction agents a day at Reworkd (<a
                  href="https://reworkd.ai"
                  >https://reworkd.ai</a
                >).
              </p>
              <p>
                By the way, we're hiring backend/infra engineers with experience
                in compute-intensive distributed systems!
              </p>
              <p>
                <a href="https://reworkd.ai/careers"
                  >https://reworkd.ai/careers</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40369119">
          <h3>
            <a
              class="item"
              href="https://nondeterministic.computer/@martin/112444389342113780"
              >Starting emails with "BEGIN PGP MESSAGE" will fool the filter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 16:32:08</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40369119"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40369021">
          <h3>
            <a
              class="item"
              href="https://www.dunlap.utoronto.ca/instrumentation/dragonfly/"
              >Dragonfly: An optical telescope built from an array of
              off-the-shelf Canon lens</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 16:24:03</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40369021"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40368016">
          <h3>
            <a
              class="item"
              href="https://computerhistory.org/blog/adobe-photoshop-source-code/"
              >Adobe Photoshop Source Code (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 15:12:15</span
              ><span class="points-container"
                >Points: <span class="points">546</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40368016"
                  >Comments</a
                ><span class="descendants">: 204</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40367331">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2024/05/apple-announces-new-accessibility-features-including-eye-tracking/"
              >Apple announces new accessibility features, including eye
              tracking</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 14:22:05</span
              ><span class="points-container"
                >Points: <span class="points">417</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40367331"
                  >Comments</a
                ><span class="descendants">: 228</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40367090">
          <h3>
            <a class="item" href="https://github.com/quarylabs/quary"
              >Show HN: Open-source BI and analytics for engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 14:02:35</span
              ><span class="points-container"
                >Points: <span class="points">249</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40367090"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
            <div class="text">
              <a href="https://quary.dev">https://quary.dev</a>), an
              engineer-first BI/analytics product. You can find our repo at
              <a href="https://github.com/quarylabs/quary"
                >https://github.com/quarylabs/quary</a
              >
              and our website at
              <a href="https://www.quary.dev/">https://www.quary.dev/</a>.
              There’s a demo video here:
              <a href="https://www.youtube.com/watch?v=o3hO65_lkGU"
                >https://www.youtube.com/watch?v=o3hO65_lkGU</a
              >
              <p>
                As engineers who have worked on data at startups and Amazon, we
                were frustrated by self-serve BI tools. They seemed dumbed down
                and they always required us to abandon our local dev tools we
                know and love (e.g. copilot, git). For us and for everyone we
                speak to, they end up being a mess.
              </p>
              <p>
                Based on this, we decided there was a need for engineer-oriented
                BI and analytics software.
              </p>
              <p>
                Quary solves these pain points by bringing standard software
                practices (version control, testing, refactoring, ci/cd,
                open-source, etc.) to the BI and analytics workflow.
              </p>
              <p>
                We integrate with many databases, but we’re showcasing our slick
                Supabase integration, because it: (1) keeps your data safe by
                running on your machine without data flowing through our
                servers; and (2) enables you to quickly build an analytics layer
                on top of your Supabase Postgres instances. Check out our
                Supabase guide:
                <a href="https://www.quary.dev/docs/quickstart-supabase"
                  >https://www.quary.dev/docs/quickstart-supabase</a
                >
              </p>
              <p>
                What we’re launching today is open source under the Apache 2.0
                license. We plan to keep the developer core open source and add
                paid features like a web platform to easily share data models
                (per-seat pricing), and an orchestration engine to materialize
                your data models.
              </p>
              <p>
                Please try Quary at
                <a href="https://quary.dev">https://quary.dev</a> and let us
                know what you think! We're excited to put the power of BI and
                analytics into the hands of engineers.
              </p>
            </div>
          </section>
        </section>
        <section id="40364989">
          <h3>
            <a
              class="item"
              href="https://blog.axantum.com/2024/05/localizing-net-console-or-desktop.html"
              >Localization in .NET console and desktop apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 10:08:04</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40364989"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363788">
          <h3>
            <a
              class="item"
              href="https://www.scottaaronson.com/democritus/lec17.html"
              >PHYS771 Lecture 17: Fun with the Anthropic Principle (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 06:39:24</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40363788"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40360487">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/planetarium-history"
              >A brief history of the first planetarium</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 21:42:10</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40360487"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40359774">
          <h3>
            <a
              class="item"
              href="https://tenderlovemaking.com/2023/09/02/fast-tokenizers-with-stringscanner.html"
              >Fast Tokenizers with StringScanner (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 20:25:33</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40359774"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40354407">
          <h3>
            <a
              class="item"
              href="https://www.kolide.com/blog/your-company-s-bossware-could-get-you-in-legal-trouble"
              >Bossware is a big legal risk</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 12:21:42</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40354407"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
