<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39978781">
          <h3>
            <a
              class="item"
              href="https://community.penpot.app/t/penpot-2-0-a-major-milestone-in-our-journey-is-now-yours-to-explore-and-enjoy/4906"
              >Penpot 2.0 Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 12:40:59</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978781"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978723">
          <h3>
            <a
              class="item"
              href="https://kieranhealy.org/blog/archives/2024/04/09/the-eclipse-via-satellite/"
              >The Eclipse via Satellite</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 12:33:11</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978723"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978657">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/why-do-airlines-charge-so-much-for-checked-bags-this-obscure-rule-helps-explain-why-225857"
              >Airlines in the U.S. charge separately for checked bags in order
              to reduce tax</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 12:24:51</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978657"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978577">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/blog/products/compute/introducing-googles-new-arm-based-cpu/"
              >Google Axion Processors â€“ Arm-based CPUs designed for the data
              center</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 12:12:51</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978577"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978434">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.04204"
              >Social Skill Training with Large Language Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 11:47:30</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978434"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978396">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/total-eclipse-internet-traffic-impacts-mexico-us-canada"
              >Total eclipse of the Internet: traffic impacts in Mexico, the US,
              and Canada</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 11:41:18</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978396"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978353">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=alrdClpGHvY"
              >How to use my science-based color wheel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 11:35:26</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978353"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978332">
          <h3>
            <a
              class="item"
              href="https://lists.sel4.systems/hyperkitty/list/devel@sel4.systems/thread/6QKUK5C5PNN6CUR2XEUR2SSFLTCTTXLL/"
              >SeL4 Device Driver Framework 0.4.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 11:31:55</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978332"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978292">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/2024/apr/09/study-sheds-light-on-the-white-dwarf-star-likely-destroyer-of-our-solar-system"
              >Study sheds light on white dwarf stars</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 11:25:40</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978292"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978108">
          <h3>
            <a class="item" href="https://github.com/nus-apr/auto-code-rover"
              >AutoCodeRover: Autonomous Program Improvement</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 10:56:31</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978108"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978093">
          <h3>
            <a class="item" href="https://ollama.com/blog/embedding-models"
              >Embedding models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 10:54:20</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978093"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39977862">
          <h3>
            <a class="item" href="https://github.com/PretendoNetwork/SSSL"
              >SSSL â€“ Hackless SSL bypass for the Wii U</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 10:03:53</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39977862"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39977671">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.05719"
              >Apple Ferret-UI: Grounded Mobile UI Understanding with Multimodal
              LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 09:24:58</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39977671"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39977537">
          <h3>
            <a
              class="item"
              href="https://www.muppetlabs.com/%7Ebreadbox/software/tiny/teensy.html"
              >A Whirlwind Tutorial on Creating Teensy ELF Executables for
              Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 09:02:51</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39977537"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39977231">
          <h3>
            <a class="item" href="https://github.com/nalgeon/sqlime"
              >Sqlime: Online SQLite Playground</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 08:24:10</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39977231"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39976640">
          <h3>
            <a class="item" href="https://qdiv.dev/posts/eth2/"
              >Show HN: I made a discrete logic network card</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 06:24:15</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39976640"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39976225">
          <h3>
            <a
              class="item"
              href="https://www.hezmatt.org/~mpalmer/blog/2024/04/09/how-i-tripped-over-the-debian-weak-keys-vuln.html"
              >How I Tripped Over the Debian Weak Keys Vulnerability</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 04:36:04</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39976225"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39975887">
          <h3>
            <a class="item" href="https://github.com/rastapasta/mapscii"
              >MapSCII â€“ A Braille and ASCII world map renderer for the
              console</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 02:58:18</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39975887"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39975865">
          <h3>
            <a
              class="item"
              href="https://www.trains.com/trn/news-reviews/news-wire/bart-to-offer-final-rides-on-original-equipment-on-april-20/"
              >BART to offer final rides on original equipment on April 20</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 02:52:33</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39975865"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39975331">
          <h3>
            <a class="item" href="https://bellard.org/tsac/"
              >TSAC: Low Bitrate Audio Compression</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 01:00:06</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39975331"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39974646">
          <h3>
            <a
              class="item"
              href="https://images.wur.nl/digital/collection/coll13/search"
              >1.18k drawings of plant root systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 23:11:14</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39974646"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39974374">
          <h3>
            <a
              class="item"
              href="https://blog.allenai.org/hello-olmo-a-truly-open-llm-43f7e7359222?gi=760105621962"
              >Hello OLMo: A truly open LLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 22:26:57</span
              ><span class="points-container"
                >Points: <span class="points">309</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39974374"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39974340">
          <h3>
            <a class="item" href="https://up.codes/careers?utm_source=HN"
              >UpCodes (YC S17) hiring devs to automate construction
              compliance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 22:20:13</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39973467">
          <h3>
            <a class="item" href="https://github.com/karpathy/llm.c"
              >Llm.c â€“ LLM training in simple, pure C/CUDA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 20:38:49</span
              ><span class="points-container"
                >Points: <span class="points">883</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39973467"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39972586">
          <h3>
            <a class="item" href="https://github.com/larryboyko/dimityjones"
              >Show HN: Dimity Jones in Puzzle Castle: An Electronic Escape
              Novel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 18:47:31</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39972586"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>Think: escape room in the form of a novel.</p>
              <p>
                A computer, and rudimentary coding skills in a language of your
                choice, will be indispensable for performing the transformations
                -- and might help with the solving too!
              </p>
              <p>
                My wife, the author, passed away five years ago. This is not the
                last thing she wrote, but it is the most unusual,
                unapproachable, and personal of her major works. It is also, as
                the only novel of hers that I cannot breeze through in an
                afternoon (and despite my unflattering appearance in it), my
                favorite.
              </p>
              <p>
                Though _Dimity Jones_ was left unfinished, and perhaps
                abandoned, at the time of my wife's death, its elements were all
                there, on her hard disk, awaiting only a final compiling. My
                contribution to this text has therefore been little more than
                that of an occasional copyeditor (my wife was a meticulous
                speller and self-proofreader) and playtester.
              </p>
              <p>
                Before releasing this work more widely, I would love to have it
                test-driven by better coders and puzzlers than I.
              </p>
              <p>
                Any and all feedback is welcome, from positive to negative, from
                the sweeping to the picayune. Let me know what confuses or
                frustrates you -- and especially let me know if (where) you get
                stuck.
              </p>
              <p>
                Otherwise, there are no special instructions; it's all in the
                book.
              </p>
              <p>
                While _Dimity Jones_ is still in its debugging/proofreading
                phase, please refrain from sharing it or putting it any (other)
                public place. (Christine would have been horrified to see her
                work thus published before it was letter-perfect; but I have
                exhausted my pool of friends and colleagues both able and
                willing to tinker with it. This seems like the ideal community
                of potential testers.)
              </p>
              <p>Thanking you in advance. I hope you enjoy!</p>
            </div>
          </section>
        </section>
        <section id="39970915">
          <h3>
            <a
              class="item"
              href="https://every.to/the-crazy-ones/the-woman-that-tech-history-forgot"
              >Lore Harp McGovern built a microcomputer empire from her suburban
              home</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 15:48:48</span
              ><span class="points-container"
                >Points: <span class="points">489</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39970915"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39968307">
          <h3>
            <a
              class="item"
              href="https://learnbyexample.github.io/cli_text_processing_coreutils/"
              >CLI text processing with GNU Coreutils</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 10:39:02</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39968307"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39966685">
          <h3>
            <a class="item" href="http://www.quartzpage.de/crs_twins.html"
              >Quartz Crystals â€“ Twinning (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 06:08:03</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39966685"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960004">
          <h3>
            <a
              class="item"
              href="https://www.cpcwiki.eu/index.php/Let%27s_Compute!"
              >Let's Compute â€“ Issues 1 to 12 (1990-1991)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 11:08:09</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960004"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39959592">
          <h3>
            <a
              class="item"
              href="https://github.com/thebinarysearchtree/flyweight"
              >Flyweight: A Node.js ORM Specifically for SQLite</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 09:32:53</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39959592"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
