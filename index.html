<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37388639">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/09/04/microsoft_australia_outage_incident_report/"
              >Microsoft blames outage on small staff, automation failures</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-05 @ 06:47:56</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37388639"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37388560">
          <h3>
            <a class="item" href="https://www.microfocus.com/en-us/cobol"
              >Learn COBOL in 1 Day</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-05 @ 06:35:09</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37388560"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37388367">
          <h3>
            <a
              class="item"
              href="https://www.aaronbruce.com/posts/tests-dont-force-good-desgin/"
              >TDD Doesn't Force Good Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-05 @ 06:03:29</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37388367"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37388146">
          <h3>
            <a
              class="item"
              href="https://hackaday.com/2023/08/07/all-about-usb-c-example-circuits/"
              >All About USB-C: Example Circuits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-05 @ 05:18:58</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37388146"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37387878">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/09/05/science/archaeology-burial-ampires-revenants.html"
              >Locking up corpses to keep them from escaping</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-05 @ 04:30:22</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37387878"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37387585">
          <h3>
            <a class="item" href="https://github.com/jstrieb/paperify"
              >Show HN: Transform any website or eBook into a research paper (no
              LLM required)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-05 @ 03:38:52</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37387585"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37387392">
          <h3>
            <a
              class="item"
              href="https://ikrima.dev/dev-notes/homelab/zfs-for-dummies/"
              >ZFS for Dummies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-05 @ 03:07:17</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37387392"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37387110">
          <h3>
            <a
              class="item"
              href="https://www.cambridge.org/core/journals/journal-of-economic-history/article/we-do-not-know-the-population-of-every-country-in-the-world-for-the-past-two-thousand-years/D747DDC6E499C799B0471DBE33FEB0BB"
              >Economists typically rely on bogus population data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-05 @ 02:14:16</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37387110"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37386711">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37386711"
              >Videobug (YC S22) is hiring a founding engineer – automated
              snapshot testing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-05 @ 01:00:31</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                Company Overview: Unlogged (previously videobug) records inputs
                and return values of Java methods to enable developers to replay
                them and identify potential regressions instantly. Our mission
                is enable confident code changes and faster software
                development.
              </p>
              <p>
                We are currently seeking an experienced Backend Java Developer
                (4-6 years of hands on exp.) to join our team. If you like
                JVM-related technologies, and are hands-on with various Java
                frameworks - do consider working with us.
              </p>
              <p>
                Job Summary: We have built a fully offline record and replay
                IntelliJ plugin for Java. We are now looking to build
                production-ready pipeline so that Java developers can replay
                production traffic for their code changes and ensure regression
                free deployments.
              </p>
              <p>
                Responsibilities: - Design, develop, and maintain backend
                applications using Java and various Java frameworks. - Talk to
                other java developers and understand nuances of their day to day
                needs. Founders do this too. - Implement a fast and bug free log
                scanning pipeline . - Integrate 3rd party APIs with the
                dashboard. - Deploy and manage services on cloud platforms such
                as AWS, GCP, or Azure. - Identify and address performance
                bottlenecks in the software. - Participate in code reviews to
                maintain code quality and ensure best practices. - Proactively
                suggest process improvements and participate in technical
                discussions.
              </p>
              <p>
                Requirements: - 4-8 years of hands-on experience with Java
                development and various Java frameworks. - Strong knowledge and
                passion for JVM-related technologies and Java programming. -
                Experience working with at least one SQL database and one NoSQL
                database. - Proficiency in containerization using Docker for
                efficient deployment. - Hands-on experience with at least one
                cloud platforms such as AWS, GCP, or Azure. - Excellent
                problem-solving skills and ability to tackle complex technical
                challenges. - Strong communication and teamwork skills for
                effective collaboration. - Willingness to learn and explore new
                technologies.
              </p>
              <p>
                Benefits: - Competitive salary and equity options based on
                experience and performance. - Opportunity to work on
                cutting-edge projects with a talented team. - Collaborative and
                innovative work environment that encourages new ideas.
              </p>
              <p>
                Location: Preferred: Bangalore, India We are ok with Remote in
                exceptional cases.
              </p>
              <p>
                We are on a mission to automate regression testing. If you feel
                passionate about quality software engineering at speed, do
                consider joining us.
              </p>
              <p>
                To apply, please submit your resume, and GitHub repository links
                to us at ssl [at] bug.video
              </p>
            </div>
          </section>
        </section>
        <section id="37386661">
          <h3>
            <a
              class="item"
              href="https://news.stanford.edu/2023/09/04/farming-food-biodiversity/"
              >Farms that create habitat key to food security and
              biodiversity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-05 @ 00:52:29</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37386661"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37386397">
          <h3>
            <a class="item" href="http://telecom.csail.mit.edu/judy-sammel.html"
              >Get a cable modem, go to jail (1999)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-05 @ 00:02:51</span
              ><span class="points-container"
                >Points: <span class="points">347</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37386397"
                  >Comments</a
                ><span class="descendants">: 256</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37385811">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/news/oscilloscope-watch-ships-after-10-years"
              >Oscilloscope watch ships after 10 years on kickstarter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-04 @ 22:38:37</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37385811"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37385716">
          <h3>
            <a class="item" href="https://sr.ht/~ashton314/emacs-bedrock/"
              >Emacs Bedrock: A minimal Emacs starter kit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-04 @ 22:26:38</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37385716"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37385518">
          <h3>
            <a
              class="item"
              href="https://github.com/BurntSushi/rg-cratesio-typosquat"
              >Rust crate rg typosquatting/redirect to ripgrep</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-04 @ 21:58:33</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37385518"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37385197">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/09/01/web_assembly_wasm_column/"
              >WASM: Big deal or little deal?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-04 @ 21:21:24</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37385197"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37384797">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2023/Sep/4/llm-embeddings/"
              >LLM Python/CLI tool adds support for embeddings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-04 @ 20:37:49</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37384797"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37384517">
          <h3>
            <a
              class="item"
              href="https://www.ben-evans.com/benedictevans/2023/8/24/when-tech-says-no"
              >When tech says ‘no’</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-04 @ 20:14:08</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37384517"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37383913">
          <h3>
            <a class="item" href="https://vgel.me/posts/c500/"
              >Writing a C compiler in 500 lines of Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-04 @ 19:17:37</span
              ><span class="points-container"
                >Points: <span class="points">361</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37383913"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37383749">
          <h3>
            <a class="item" href="https://spectrolite.app"
              >Spectrolite – Mac app to make colorful risograph prints and zines
              more easily</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-04 @ 19:00:47</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37383749"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37383245">
          <h3>
            <a
              class="item"
              href="https://twitter.com/georainbolt/status/1698553197684777069"
              >Geo Guesser identifies the location and seat number from an
              aerial shot</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-04 @ 18:13:14</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37383245"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37381268">
          <h3>
            <a class="item" href="https://github.com/keephq/keep"
              >Show HN: Keep – GitHub Actions for your monitoring tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-04 @ 15:15:09</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37381268"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
            <div class="text">
              <p>
                A few months ago, we introduced here at HN (<a
                  href="https://news.ycombinator.com/item?id=34806482"
                  >https://news.ycombinator.com/item?id=34806482</a
                >) Keep as an “open source alerting CLI” and got some
                interesting feedback - mainly around UI, automation, and
                supporting more tools. We were VERY early back then, and we
                understood that although the current DX around creating alerts
                is not great, it's not that critical and developers don’t need
                another tool just for that.
              </p>
              <p>But we did find something else.</p>
              <p>
                While talking to developers and devops, we found that a lot of
                companies use many tools that generate alerts - from Cloudwatch,
                Prometheus, Grafana, and Datadog to tools such as Zabbix or
                Nagios. We definitely agree consolidation in the observability
                space is a real thing, but while talking to those companies we
                feel that there are still real use cases for having more than
                one tool (and for example, according to Grafana’s 2023
                observability survey, 52% of the companies uses more than 6
                observability tools
                <a href="https://grafana.com/observability-survey-2023/"
                  >https://grafana.com/observability-survey-2023/</a
                >).
              </p>
              <p>
                So we that in mind, we rebuilt Keep with a simple mindset: (1)
                Integrate with every tool that triggers alerts - it can be
                either pushing alerts to Keep via webhooks or routing policies
                or Keep to pull alerts via the tools API. (2) Create a simple
                abstraction layer to run workflows on top of these alerts. (3)
                Maintain a great developer experience - open source, API-first,
                workflows as code and generally having a developer mindset while
                building Keep.
              </p>
              <p>
                During the time we rebuilt Keep, Datadog released their workflow
                automation tool (<a
                  href="https://docs.datadoghq.com/service_management/workflows/"
                  >https://docs.datadoghq.com/service_management/workflows/</a
                >) which led us to the understanding that's exactly what we
                solve - but for everyone who uses tools other than Datadog.
              </p>
              <p>
                A short demo of Keep with a simple use case:
                <a href="https://www.youtube.com/watch?v=FPMRCZM8ZYg"
                  >https://www.youtube.com/watch?v=FPMRCZM8ZYg</a
                >
              </p>
              <p>
                You can try it yourself by signing into
                <a href="https://platform.keephq.dev"
                  >https://platform.keephq.dev</a
                >
              </p>
              <p>
                Like always - we invite you to try Keep and we are eager to hear
                any feedback.
              </p>
            </div>
          </section>
        </section>
        <section id="37376519">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2023/aug/27/competition-seeks-true-taste-of-thailands-national-dish"
              >Pad kaphrao contest seeks true taste of Thai dish</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-04 @ 02:16:40</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37376519"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37369732">
          <h3>
            <a
              class="item"
              href="https://hachyderm.io/@softwaredoug/111000936722843110"
              >Do we think about vector storage completely wrong?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-03 @ 12:07:06</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37369732"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37369450">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/us-news/2023/sep/02/shipwreck-trinidad-lake-michigan-wisconsin"
              >19th-century shipwreck discovered in Lake Michigan</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-03 @ 11:13:32</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37369450"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37369440">
          <h3>
            <a
              class="item"
              href="https://nautil.us/the-social-life-of-bats-373018/"
              >The Social Life of Bats</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-03 @ 11:11:55</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37369440"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37369416">
          <h3>
            <a
              class="item"
              href="https://blog.stephaniestimac.com/posts/2023/09/just-build-it/"
              >Just Build It...</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-03 @ 11:08:04</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37369416"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37368148">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/senderle/8ad6aae251c4ddf9424f8a05dd0e8c18"
              >So you want to modify the text of a PDF by hand (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-03 @ 06:24:13</span
              ><span class="points-container"
                >Points: <span class="points">254</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37368148"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37367089">
          <h3>
            <a
              class="item"
              href="http://oldvcr.blogspot.com/2023/09/refurb-weekend-powerbook-duo-2300c.html"
              >Refurb weekend: PowerBook Duo 2300c</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-03 @ 02:03:14</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37367089"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37365764">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=RFjGq55BglM"
              >1985 New Tech Times on counterfeit Apple II computers [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 21:39:39</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37365764"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37365752">
          <h3>
            <a
              class="item"
              href="https://rishad.substack.com/p/a-company-of-one"
              >A Company of One</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 21:38:13</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37365752"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
