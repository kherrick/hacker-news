<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41038372">
          <h3>
            <a class="item" href="https://matthewstrom.com/writing/copying/"
              >Copying is the way design works</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 18:59:38</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41038372"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41037595">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2024/07/22/business/delta-canceled-flights-computer-problems/index.html"
              >Why Delta is still canceling flights as other airlines return to
              normal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 18:10:42</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41037595"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41037380">
          <h3>
            <a
              class="item"
              href="https://thenewstack.io/microsoft-linux-is-the-top-operating-system-on-azure-today/"
              >Microsoft: Linux Is the Top Operating System on Azure Today</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 17:58:13</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41037380"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41037177">
          <h3>
            <a
              class="item"
              href="https://github.com/DouglasNeuroInformatics/OpenDataCapture"
              >Show HN: OpenDataCapture an electronic data capture platform for
              data collection</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 17:43:10</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41037177"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                We're the Douglas Neuroinformatics Platform[1], and we've been
                working on Open Data Capture, a web-based electronic data
                capture (EDC) platform for continuous clinical and research data
                collection. You can use it to administer instruments (like forms
                and interactive tasks) either in-person or remotely.
              </p>
              <p>
                The platform is based on a fundamentally longitudinal data
                model. Unlike other EDC platforms, which are centered around the
                concept of a study with rigid timepoints, Open Data Capture is
                designed for continuous data capture. Data is associated with a
                given session, which includes metadata such as date, time, and
                mode (i.e., in-person or remote).
              </p>
              <p>
                We've designed the system around the core restriction that many
                hospital institutions demand that data remain on-premise, while
                clinician-researchers often want to evaluate clients outside the
                institution with research questions. This has resulted in our
                innovative gateway concept, where assigned remote assessments
                are pushed onto an internet accessible service, and responses
                are encrypted in-place with HPKE[2] until the backend pulls them
                into the backend database. This makes the deployment
                firewall-friendly provided you can launch a minimal VPS or VM
                host somewhere globally accessible.
              </p>
              <p>
                We're also a big fan of making things easy to deploy, so we
                supply a docker-compose stack which can bring up a demo instance
                easily to run locally.
              </p>
              <p>
                The platform is free, open source, and written in TypeScript,
                with a NoSQL database underneath. Users can write instruments in
                TypeScript using a type-safe declarative form system (with
                native i18n support built in) or wrap and integrate completely
                arbitrary interactive tasks written in JavaScript (with optional
                support for TypeScript and JSX). Under the hood, this is based
                on dynamic imports and native ESM. There’s a browser-based IDE
                (the Instrument Playground) with live reloading and full
                Intellisense where you can try creating your own instruments.
              </p>
              <p>
                We have a local deployment going live at our institution and
                appropriately-licensed (free) instruments we're deploying here
                will be integrated directly into the codebase.
              </p>
              <p>
                Our future plans include expanding our instrument types to allow
                for binary data storage with an s3-like backend, and with
                abstractions for data types, like actigraphy, and MRI.
              </p>
              <p>
                Check it out on GitHub[3], try the Instrument Playground[4], or
                see the Live Demo[5].
              </p>
              <p>Would love to hear everybody’s thoughts!</p>
              <p>Links:</p>
              <p>
                [1]
                <a href="https://github.com/DouglasNeuroInformatics/"
                  >https://github.com/DouglasNeuroInformatics/</a
                >
              </p>
              <p>@gdevenyi @joshunrau</p>
              <p>
                [2]
                <a href="https://datatracker.ietf.org/doc/rfc9180/"
                  >https://datatracker.ietf.org/doc/rfc9180/</a
                >
              </p>
              <p>
                [3]
                <a
                  href="https://github.com/DouglasNeuroInformatics/OpenDataCapture"
                  >https://github.com/DouglasNeuroInformatics/OpenDataCapture</a
                >
              </p>
              <p>
                [4]
                <a href="https://playground.opendatacapture.org"
                  >https://playground.opendatacapture.org</a
                >
              </p>
              <p>
                [5]
                <a href="https://demo.opendatacapture.org"
                  >https://demo.opendatacapture.org</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41037168">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/aerospace-defense/boeing-owned-wisk-expects-begin-carrying-passengers-later-decade-2024-07-22/"
              >Boeing-owned Wisk expects to begin carrying passengers 'later in
              the decade'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 17:42:17</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41037168"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036982">
          <h3>
            <a
              class="item"
              href="https://ssoready.com/blog/engineering/a-gentle-intro-to-saml/"
              >A Gentle Introduction to SAML</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 17:27:44</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41036982"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036914">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41036914"
              >Ask HN: Is there a list of grey-hair-friendly IT companies?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 17:21:29</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41036914"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              E.g. something like that
              https://github.com/remoteintech/remote-jobs but for being actively
              anti-ageist or at least not bothered by one's age?
            </div>
          </section>
        </section>
        <section id="41036633">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/roame/jobs/tu786nh-founding-growth-operations"
              >Roame (YC S23) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 17:00:37</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036526">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/articles/c728ven2v9eo"
              >Oxygen discovery defies knowledge of the deep ocean</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 16:48:44</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41036526"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036462">
          <h3>
            <a
              class="item"
              href="https://www.ucsf.edu/news/2024/07/428011/scientists-discover-new-hormone-can-build-strong-bones"
              >Scientists discover a new hormone that can build strong bones</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 16:42:22</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41036462"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036231">
          <h3>
            <a class="item" href="https://github.com/bugbakery/audapolis"
              >Audapolis: Edit audio files by word, not waveform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 16:25:21</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41036231"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036216">
          <h3>
            <a
              class="item"
              href="https://www.theintrinsicperspective.com/p/all-the-existential-risk-none-of"
              >All the existential risk, none of the economic impact. That's a
              shitty trade</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 16:24:11</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41036216"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41035405">
          <h3>
            <a
              class="item"
              href="https://github.blog/2024-07-22-3-ways-to-get-remote-code-execution-in-kafka-ui/"
              >How to Get Remote Code Execution in Kafka UI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 15:14:35</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41035405"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41034738">
          <h3>
            <a
              class="item"
              href="https://bigthink.com/starts-with-a-bang/fast-human-run-100-meters/"
              >How fast can a human possibly run 100 meters?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 14:21:20</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41034738"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41033579">
          <h3>
            <a
              class="item"
              href="https://www.brendangregg.com/blog/2024-07-22/no-more-blue-fridays.html"
              >No More Blue Fridays</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 12:21:06</span
              ><span class="points-container"
                >Points: <span class="points">320</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41033579"
                  >Comments</a
                ><span class="descendants">: 201</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41033209">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/article/2024/jul/22/physicist-rosemary-fowler-honoured-doctorate-75-years-after-discovery"
              >Physicist, 98, honoured with doctorate 75 years after
              groundbreaking discovery</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 11:29:45</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41033209"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41033005">
          <h3>
            <a
              class="item"
              href="https://www.openresearchlab.org/studies/unconditional-cash-study/study"
              >Unconditional Cash Study: first findings available</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 11:00:16</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41033005"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41031975">
          <h3>
            <a class="item" href="https://billabear.com/"
              >Show HN: A source-available billing system I've spent 18 months
              building</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 08:22:16</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41031975"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41031960">
          <h3>
            <a
              class="item"
              href="https://www.rte.ie/news/business/2024/0719/1460807-ryanair-wins-us-court-case-against-bookingcom/"
              >Ryanair wins screen scraping case against Booking.com in US court
              ruling</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 08:20:05</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41031960"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41031942">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/newsletters/2024-07-21/apple-tries-to-rein-in-hollywood-spending-after-years-of-losses"
              >Apple tries to rein in Hollywood spending after years of
              losses</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 08:15:24</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41031942"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41031112">
          <h3>
            <a class="item" href="https://github.com/eza-community/eza"
              >Eza: A modern, maintained replacement for ls</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 05:17:23</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41031112"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41031037">
          <h3>
            <a class="item" href="https://github.com/BurntSushi/jiff"
              >Jiff: Datetime library for Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 04:57:46</span
              ><span class="points-container"
                >Points: <span class="points">408</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41031037"
                  >Comments</a
                ><span class="descendants">: 190</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41030862">
          <h3>
            <a class="item" href="https://www.rrweb.io/"
              >Rrweb – record and replay debugger for the web</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 04:10:23</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41030862"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41030073">
          <h3>
            <a
              class="item"
              href="https://martinfowler.com/articles/data-fetch-spa.html"
              >Data Fetching for Single-Page Apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 01:31:15</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41030073"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41029987">
          <h3>
            <a
              class="item"
              href="https://jim.rees.org/apollo-archive/marketing/1988-ApolloDN10000ProductBrochure.pdf"
              >Apollo DN10000: Quad CPU/128Mb RAM workstation from 1988 [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 01:12:12</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41029987"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41029287">
          <h3>
            <a class="item" href="https://without.boats/blog/pin/">Pin</a>
          </h3>
          <section>
            <h4>
              <span>2024-07-21 @ 23:23:36</span
              ><span class="points-container"
                >Points: <span class="points">424</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41029287"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41001550">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20240708-00/?p=109959"
              >What's the point of std:monostate? You can't do anything with
              it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-19 @ 02:15:26</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41001550"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40997764">
          <h3>
            <a
              class="item"
              href="https://semanticdiff.com/blog/language-aware-diff-how-far/"
              >How far should a programming language aware diff go?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-18 @ 17:18:13</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40997764"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40987123">
          <h3>
            <a
              class="item"
              href="https://langdev.stackexchange.com/questions/3942/what-are-the-ways-compilers-recognize-complex-patterns"
              >What are the ways compilers recognize complex patterns?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 15:44:25</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40987123"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40986250">
          <h3>
            <a
              class="item"
              href="https://hh409.user.srcf.net/blog/lens-distortion-correction-lines.html"
              >Wide angle lens distortion correction from lines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 14:20:51</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40986250"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
