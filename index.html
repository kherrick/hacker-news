<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42414912">
          <h3>
            <a
              class="item"
              href="https://twitter.com/i/status/1867719020444889118"
              >Ilya Sutskever Test of Time Talk "Pre-training as we know it will
              end"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 05:38:58</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42414912"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42413845">
          <h3>
            <a
              class="item"
              href="https://github.com/bigskysoftware/htmx/blob/v2.0.4/CHANGELOG.md"
              >Htmx 2.0.4 Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 01:23:14</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42413845"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42413757">
          <h3>
            <a
              class="item"
              href="https://www.shirtpocket.com/blog/index.php/shadedgrey/youre_a_mean_one/"
              >macOS 15.2 breaks the ability to copy the OS to another drive</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 01:04:24</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42413757"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42413464">
          <h3>
            <a class="item" href="https://github.com/ellenhp/farebox"
              >Show HN: Performant intracontinental public transport routing in
              Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 00:00:28</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42413464"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                Example query (Berlin to Barcelona):
                <a
                  href="https://farebox.airmail.rs/plan/52.5176122,13.4180261/41.380458,2.1455451"
                  >https://farebox.airmail.rs/plan/52.5176122,13.4180261/41.380...</a
                >
              </p>
              <p>
                There are some bugs still. Notably, it's not capable of planning
                the return trip for this route, nor the reverse of the trip from
                Seattle to NYC that I gave in the blog post.
              </p>
              <p>
                Blog post:
                <a
                  href="https://blog.ellenhp.me/performant-intracontinental-transit-routing-in-rust"
                  >https://blog.ellenhp.me/performant-intracontinental-transit-...</a
                >
              </p>
              <p>
                Repo:
                <a href="https://github.com/ellenhp/farebox"
                  >https://github.com/ellenhp/farebox</a
                >
              </p>
              <p>
                Side-note but in the past some have criticized my writing style
                and it's been a bit hurtful at times but if you have
                <i>constructive</i> feedback on the blog post I'd appreciate it.
                I'm trying to get better at writing. :)
              </p>
            </div>
          </section>
        </section>
        <section id="42413343">
          <h3>
            <a
              class="item"
              href="https://github.com/rochus-keller/Luon/blob/master/Readme.md"
              >Luon programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 23:37:45</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42413343"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42413086">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2024/12/13/nx-s1-5155962/mckinsey-purdue-opioid-prosecution-doj"
              >McKinsey and Company to pay $650M for role in opioid crisis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 22:57:04</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42413086"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42412718">
          <h3>
            <a
              class="item"
              href="https://www.mercurynews.com/2024/12/13/openai-whistleblower-found-dead-in-san-francisco-apartment/"
              >OpenAI whistleblower found dead in San Francisco apartment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 21:56:29</span
              ><span class="points-container"
                >Points: <span class="points">527</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42412718"
                  >Comments</a
                ><span class="descendants">: 187</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42412360">
          <h3>
            <a
              class="item"
              href="https://ai.meta.com/blog/meta-fair-updates-agents-robustness-safety-architecture/?_fb_noscript=1"
              >Sharing new research, models, and datasets from Meta FAIR</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 21:07:08</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42412360"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42411727">
          <h3>
            <a class="item" href="https://www.npmjs.com/package/@smoores/epub"
              >Show HN: @smoores/epub, a JavaScript library for working with
              EPUB publications</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 19:52:26</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42411727"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
            <div class="text">
              <a href="https://smoores.dev/post/announcing_smoores_epub/"
                >https://smoores.dev/post/announcing_smoores_epub/</a
              >. As I've been working on Storyteller[1], I've been developing a
              library for working with EPUB files, since that's a large amount
              of the work that Storyteller does. After a friend asked for advice
              on creating EPUB books in Node.js, I decided to publish
              Storyteller's EPUB library as a standalone NPM package. I really
              love the EPUB spec, and I think the Node.js developer community
              deserves an actively maintained library for working with it!
              <p>
                [1]:
                <a href="https://smoores.gitlab.io/storyteller"
                  >https://smoores.gitlab.io/storyteller</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42411608">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/elon-musk-wanted-an-openai-for-profit/"
              >Elon Musk wanted an OpenAI for-profit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 19:36:41</span
              ><span class="points-container"
                >Points: <span class="points">466</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42411608"
                  >Comments</a
                ><span class="descendants">: 478</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42410803">
          <h3>
            <a class="item" href="https://github.com/microsoft/markitdown"
              >MarkItDown: Python tool for converting files and office documents
              to Markdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 18:02:03</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42410803"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42410582">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42410582"
              >Ask HN: What should I do with meet.hn?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 17:38:30</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42410582"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
            <div class="text">
              <a href="https://news.ycombinator.com/item?id=41539125"
                >https://news.ycombinator.com/item?id=41539125</a
              >)
              <p>
                We are now about 1700 hackers willing to meet each other in
                almost 700 locations worldwide.
              </p>
              <p>
                Since then, some requested features and bug fixes have been
                implemented:
              </p>
              <p>
                - locations are now searchable and not restricted to a
                simplistic city-country pair
              </p>
              <p>- locations work with diacritics and diverse languages</p>
              <p>
                - new socials: personal website, email, Mastodon, Discord,
                GitLab, Google Scholar, YouTube, etc.
              </p>
              <p>
                - upon user request, I can now showcase your local meetups on
                your location listing, as it's done for Old Toronto: [1]
              </p>
              <p>
                About actual meetings, I'm aware of around a dozen so far, but I
                think many more occurred.
              </p>
              <p>Why am I writing this post?</p>
              <p>
                About 80% of the ~1700 signups happened in the first 36 hours
                after launch. As expected, signups dropped pretty quickly, and
                now it gains about one new user every other day.
              </p>
              <p>
                I think a ton of global value (and local joy) can emerge from HN
                users meeting each other. That's why I'm writing this post. To
                answer the question: how can we meet more? and how can meet.hn
                help?
              </p>
              <p>What I thought about:</p>
              <p>
                1. Implementing RSS for each location: helpful for RSS users
                only, and not that useful if there are no new registrations.
              </p>
              <p>
                2. Email notification system: wide audience, but requires users
                to give their emails.
              </p>
              <p>
                3. Turning meet.hn into some sort of an atproto [3] project, or
                at least leveraging it somehow. Might be more Bluesky centric
                (if we use labels, for example), but maybe not?
              </p>
              <p>
                4. A bookmarklet which, once clicked when on a HN post, would
                insert a meet.hn logo next to all user names of users commenting
                there and registered on meet.hn
              </p>
              <p>
                5. An HN "proxy website" which would copy HN in every way, but
                would add the meet.hn logo just like the bookmarklet described
                point 4 would do, but everywhere and automatically.
              </p>
              <p>
                6. Create Telegram (or equivalent) channels for each location
              </p>
              <p>
                But all of these ideas are unideal fixes. The lowest common
                denominator between everyone on HN... is HN. Hence, meeting
                right from HN would be best. An MVP for this could be to have a
                "willing to meet" attribute with a boolean value (like the
                "showdead" or "noprocrast" attributes). When enabled, an icon
                would be shown next to the user name in threads.
              </p>
              <p>
                I talked to dang, and even if the idea of implementing something
                on HN is not out of the question, it is not on the roadmap yet.
              </p>
              <p>
                Let's discuss all of this in the comments. Looking forward to
                hearing what you think.
              </p>
              <p>
                [1]
                <a
                  href="https://meet.hn/city/43.6534817,-79.3839347/Old-Toronto"
                  >https://meet.hn/city/43.6534817,-79.3839347/Old-Toronto</a
                >
              </p>
              <p>
                [2]
                <a href="https://meet.hn/city/43.6044622,1.4442469/Toulouse"
                  >https://meet.hn/city/43.6044622,1.4442469/Toulouse</a
                >
              </p>
              <p>[3] <a href="https://atproto.com/">https://atproto.com/</a></p>
            </div>
          </section>
        </section>
        <section id="42410229">
          <h3>
            <a class="item" href="https://blog.langworth.com/imposter-attack"
              >Show HN: Imposter Attack – Among Us-themed infrared game made
              with ESP32</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 17:00:19</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42410229"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42410151">
          <h3>
            <a
              class="item"
              href="https://archaeologymag.com/2024/12/tablet-with-unknown-language-unearthed-in-georgia/"
              >Mysterious tablet with unknown language unearthed in Georgia</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 16:50:46</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42410151"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42408819">
          <h3>
            <a class="item" href="https://weborigami.org"
              >Web Origami, for making websites where you can understand how
              they’re made</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 14:43:05</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42408819"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42408271">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/noninvasive-imaging-method-can-penetrate-deeper-living-tissue-1211"
              >Noninvasive imaging method can penetrate deeper into living
              tissue</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 13:34:34</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42408271"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42407250">
          <h3>
            <a
              class="item"
              href="https://matt.might.net/articles/shell-scripts-for-passive-voice-weasel-words-duplicates/"
              >My PhD advisor rewrote himself in bash (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 09:41:55</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42407250"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42406158">
          <h3>
            <a
              class="item"
              href="https://computerhistory.org/blog/in-memoriam-donald-bitzer-1934-2024/"
              >Donald Bitzer has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 05:32:42</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42406158"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42403324">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2024/dec/12/pompeii-experts-back-plinys-account-of-mount-vesuvius-eruption-date"
              >Pompeii experts back Pliny's account of Mount Vesuvius eruption
              date</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 21:06:34</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42403324"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42403273">
          <h3>
            <a class="item" href="https://www.keacher.com/xmas24/"
              >Energy-Harvesting Electronic Holiday Card 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 21:00:40</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42403273"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42399397">
          <h3>
            <a
              class="item"
              href="https://xenaproject.wordpress.com/2024/12/11/fermats-last-theorem-how-its-going/"
              >Fermat's Last Theorem – how it’s going</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 14:30:37</span
              ><span class="points-container"
                >Points: <span class="points">386</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42399397"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42398230">
          <h3>
            <a
              class="item"
              href="https://www.daveliepmann.com/articles/idiomatic-clojure-errors.html"
              >Idiomatic Errors in Clojure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 11:15:06</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42398230"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42392668">
          <h3>
            <a
              class="item"
              href="https://engineering.stackexchange.com/questions/100/is-it-possible-to-build-a-perfectly-spherical-prince-ruperts-drop"
              >Is it possible to build a perfectly spherical prince Ruperts drop
              (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 20:37:02</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42392668"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42391079">
          <h3>
            <a
              class="item"
              href="https://oldbytes.space/@kenshirriff/113606898880486330"
              >The Pentium FDIV bug, reverse-engineered</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 18:33:06</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42391079"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42390683">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/space/2024/12/nasa-believes-it-understands-why-ingenuity-crashed-on-mars/"
              >NASA believes it understands why Ingenuity crashed on Mars</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 18:01:00</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42390683"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42387428">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/graphene-semiconductor-2670398194"
              >Graphene Interconnects Aim to Give Moore's Law New Life</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 13:22:55</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42387428"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42382357">
          <h3>
            <a
              class="item"
              href="https://github.com/Robertleoj/pen_plotter_robot/blob/main/story.md"
              >Making my first robot as a software engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 22:31:32</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42382357"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42367290">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/exotic-new-superconductors-delight-and-confound-20241206/"
              >Exotic new superconductors delight and confound</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 15:47:42</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42367290"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42360074">
          <h3>
            <a
              class="item"
              href="https://www.vice.com/en/article/viganella-italy-fake-manmade-sun/"
              >An Italian town that built its own sun (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-08 @ 20:21:14</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42360074"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42358444">
          <h3>
            <a
              class="item"
              href="https://blog.jgc.org/2024/12/all-you-base-are-belong-to-us.html"
              >"All your base are belong to us" intro to my 2004 MIT Spam
              Conference talk</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-08 @ 17:25:28</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42358444"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
