<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36680755">
          <h3>
            <a class="item" href="https://www.anthropic.com/index/claude-2"
              >Claude 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 13:35:58</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36680755"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36680639">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36680639"
              >Ask HN: Why do functional programmers hate loops (for, while,
              etc.)?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 13:26:25</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36680639"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
            <div class="text">
              Why do functional programmers hate looping constructs of
              imperative languages and ignore them as if they don't exist?
            </div>
          </section>
        </section>
        <section id="36680535">
          <h3>
            <a
              class="item"
              href="https://tigerbeetle.com/blog/2023-07-11-we-put-a-distributed-database-in-the-browser/"
              >We put a distributed database in the browser and made a game of
              it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 13:15:49</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36680535"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36680186">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/07/fairphone-3-gets-seven-years-of-updates-besting-every-other-android-oem/"
              >Fairphone 3 gets seven years of updates, besting every other
              Android OEM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 12:43:27</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36680186"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36679569">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/how-cloudflare-images-addressed-the-acropalypse-vulnerability/"
              >How Cloudflare Images addressed the aCropalypse vulnerability</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 11:39:17</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36679569"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36679368">
          <h3>
            <a class="item" href="https://github.com/photoprism/photoprism"
              >PhotoPrism: Browse Your Life in Pictures</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 11:18:48</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36679368"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36679128">
          <h3>
            <a
              class="item"
              href="https://stratechery.com/2023/threads-and-the-social-communications-map/"
              >Threads and the Social/Communications Map</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 10:47:54</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36679128"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36678834">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2023/07/big-tech-can-transfer-europeans-data-to-us-in-win-for-facebook-and-google/"
              >Big Tech can transfer Europeansâ€™ data to US in win for Facebook
              and Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 10:14:29</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36678834"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36678795">
          <h3>
            <a class="item" href="https://mjg59.dreamwidth.org/66907.html"
              >Roots of Trust Are Difficult</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 10:09:57</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36678795"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36678475">
          <h3>
            <a
              class="item"
              href="https://sourcery.ai/blog/measuring_working_memory/"
              >How much information is too much information? (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 09:35:59</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36678475"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36678457">
          <h3>
            <a
              class="item"
              href="https://nnethercote.github.io/2023/07/11/back-end-parallelism-in-the-rust-compiler.html"
              >Back-end parallelism in the Rust compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 09:33:12</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36678457"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36678412">
          <h3>
            <a
              class="item"
              href="https://nhigham.com/2023/07/11/what-is-the-numerical-range-of-a-matrix/"
              >What Is the Numerical Range of a Matrix?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 09:27:25</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36678412"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36678375">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/by-invitation/2023/07/10/mathew-lawrence-on-why-privatisation-has-been-a-costly-failure-in-britain"
              >Privatisation has been a costly failure in Britain</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 09:20:43</span
              ><span class="points-container"
                >Points: <span class="points">391</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36678375"
                  >Comments</a
                ><span class="descendants">: 449</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36678079">
          <h3>
            <a
              class="item"
              href="https://www.suse.com/news/SUSE-Preserves-Choice-in-Enterprise-Linux/"
              >SUSE is forking RHEL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 08:41:22</span
              ><span class="points-container"
                >Points: <span class="points">368</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36678079"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36677034">
          <h3>
            <a
              class="item"
              href="https://github.com/mshumer/gpt-prompt-engineer"
              >GPT-Prompt-Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 06:16:14</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36677034"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36676810">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/system/files/atc23-huye.pdf"
              >Metaâ€™s Microservice Architecture [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 05:41:05</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36676810"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36676415">
          <h3>
            <a class="item" href="https://playlaser.xyz"
              >Show HN: Laser, a new game played on a chess board</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 04:27:41</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36676415"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
            <div class="text">
              <i>laser</i> piece, which can shoot diagonally through every piece
              on the board except for the <i>wall</i>, which blocks it. The
              detailed rules are on the website.
              <p>
                I made the website as a super minimal way to play online against
                friends. Nobody really knows about it so it might be hard to
                find a game, but maybe you will against someone on HN if people
                read this. It uses the lichess.org chessboard UI which is super
                pretty and allows you to draw on the board, make premoves, etc.
                The code is public if you are interested:
                github.com/melgrove/laser
              </p>
              <p>If you are playing, good luck, and don't get lasered!</p>
            </div>
          </section>
        </section>
        <section id="36675934">
          <h3>
            <a
              class="item"
              href="https://threadreaderapp.com/thread/1678545170508267522.html"
              >GPT-4 details leaked?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 03:00:19</span
              ><span class="points-container"
                >Points: <span class="points">420</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36675934"
                  >Comments</a
                ><span class="descendants">: 351</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36674487">
          <h3>
            <a
              class="item"
              href="https://blurbusters.com/frame-generation-essentials-interpolation-extrapolation-and-reprojection/"
              >Frame generation essentials: Interpolation, extrapolation, and
              reprojection</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 23:30:27</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36674487"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36674224">
          <h3>
            <a class="item" href="https://www.getlocalcert.net/"
              >Easy HTTPS for your private networks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 23:05:21</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36674224"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36674069">
          <h3>
            <a
              class="item"
              href="https://www.udiscovermusic.com/news/brian-eno-albums-dolby-atmos-first-time/"
              >Brian Eno albums available in Dolby Atmos and Spatial</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 22:49:32</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36674069"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36673793">
          <h3>
            <a
              class="item"
              href="https://letsencrypt.org/2023/07/10/cross-sign-expiration.html"
              >Shortening the Let's Encrypt chain of trust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 22:19:22</span
              ><span class="points-container"
                >Points: <span class="points">484</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36673793"
                  >Comments</a
                ><span class="descendants">: 244</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36673224">
          <h3>
            <a class="item" href="https://github.com/immich-app/immich"
              >Self-hosted photo and video backups directly from your mobile
              phone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 21:28:40</span
              ><span class="points-container"
                >Points: <span class="points">666</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36673224"
                  >Comments</a
                ><span class="descendants">: 309</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36669810">
          <h3>
            <a
              class="item"
              href="https://www.hillelwayne.com/post/always-more-history/"
              >There's always more history (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 17:34:05</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36669810"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36667840">
          <h3>
            <a
              class="item"
              href="https://www.japantimes.co.jp/life/2023/07/09/food/iwanohara-vineyard-niigata-joestu/"
              >At Japanâ€™s first winery, the countryâ€™s oldest grape lives on</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 15:28:08</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36667840"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36667103">
          <h3>
            <a
              class="item"
              href="http://hyperphysics.phy-astr.gsu.edu/hbase/index.html"
              >HyperPhysics (1998)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 14:36:57</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36667103"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36666380">
          <h3>
            <a
              class="item"
              href="https://www.beterinbeleggen.nl/pdf/tsm/The-Perfect-Business-Richard-Russell.pdf"
              >The Perfect Business (2014) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 13:47:59</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36666380"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36665978">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/technology/2023/07/10/rage-room-printers-recycle-environment-health/"
              >People are paying to break printers with sledgehammers in smash
              rooms</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 13:20:04</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36665978"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36664372">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Hybrid_Insect_Micro-Electro-Mechanical_Systems"
              >Hybrid Insect Micro-Electro-Mechanical Systems (Hi-MEMS)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 10:34:10</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36664372"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36662893">
          <h3>
            <a
              class="item"
              href="https://www.linode.com/blog/linode/docs-as-code-at-linode/"
              >Docs as Code at Linode (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-10 @ 06:47:09</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36662893"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
