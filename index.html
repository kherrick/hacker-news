<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42742350">
          <h3>
            <a class="item" href="https://github.com/tomhea/c2fj"
              >Show HN: Compile C to Not Gates</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 19:36:37</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42742350"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today I completed my compiler from C to FlipJump. It takes C
                files, and compiles them into flipjump. I finished testing it
                all today, and it works! My key interest in this project is to
                stretch what we know of computing and to prove that anything can
                be done even with minimal power.
              </p>
              <p>
                I appreciate you reading my announcement, and be happy to answer
                questions.
              </p>
              <p>More links:</p>
              <p>
                - The flipjump language:
                <a href="https://github.com/tomhea/flip-jump"
                  >https://github.com/tomhea/flip-jump</a
                >
                <a href="https://esolangs.org/wiki/FlipJump"
                  >https://esolangs.org/wiki/FlipJump</a
                >
              </p>
              <p>
                - c2fj python package
                <a href="https://pypi.org/project/c2fj/"
                  >https://pypi.org/project/c2fj/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42742184">
          <h3>
            <a
              class="item"
              href="https://cceckman.com/writing/branchless-utf8-encoding/"
              >Branchless UTF-8 Encoding</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 19:20:14</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42742184"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42742057">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2501.09286"
              >Mathematics of the daily word game Waffle</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 19:07:54</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42742057"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42741155">
          <h3>
            <a
              class="item"
              href="https://blogsystem5.substack.com/p/netbsd-graphics-wo-x11"
              >Hands-On Graphics Without X11</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 17:54:02</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42741155"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42740596">
          <h3>
            <a
              class="item"
              href="https://blog.sourcedive.net/brood-war-korean-translations/"
              >Brood War Korean Translations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 17:15:07</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42740596"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42740301">
          <h3>
            <a
              class="item"
              href="https://www.keelinglabs.com/jobs?ashby_jid=81b48fb8-8176-4529-a38d-8fc736ebe2aa"
              >Keeling Labs (YC W23) Is Hiring an ML Engineer for Grid-Scale
              Energy Storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 17:00:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42740183">
          <h3>
            <a class="item" href="https://github.com/rgl-epfl/drtvam"
              >Dr. TVAM â€“ Inverse Rendering for Tomographic Volumetric Additive
              Manufacturing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 16:53:55</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42740183"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                Based on Mitsuba 3 and Dr. JIT we provide our software Dr. TVAM
                to optimize patterns for TVAM. TVAM allows to print centi-meter
                scale objects within seconds.
              </p>
            </div>
          </section>
        </section>
        <section id="42739572">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/the-french-modernists-loathed-and-loved-the-mass-media-of-their-day"
              >French modernists were alarmed, inspired by newspaper's voracious
              dynamism</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 16:21:13</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42739572"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42739163">
          <h3>
            <a
              class="item"
              href="https://www.clereviewofbooks.com/writing/kevin-killian-selling-the-collective"
              >Selling the Collective: On Kevin Killian's "Selected Amazon
              Reviews"</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 16:00:07</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42739163"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42738656">
          <h3>
            <a
              class="item"
              href="https://docs.mermaidchart.com/blog/posts/gui-for-editing-mermaid-class-diagrams"
              >Show HN: GUI for editing Mermaid class diagrams</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 15:36:01</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42738656"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42738464">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2025/01/17/supreme-court-rules-to-uphold-tiktok-ban.html"
              >Supreme Court upholds TikTok ban, but Trump might offer
              lifeline</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 15:23:58</span
              ><span class="points-container"
                >Points: <span class="points">673</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42738464"
                  >Comments</a
                ><span class="descendants">: 1547</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42738457">
          <h3>
            <a
              class="item"
              href="https://blog.skyvern.com/skyvern-2-0-state-of-the-art-web-navigation-with-85-8-on-webvoyager-eval/"
              >Skyvern Browser Agent 2.0: How We Reached State of the Art in
              Evals</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 15:23:05</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42738457"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42737778">
          <h3>
            <a
              class="item"
              href="https://games.productartistry.com/games/dark-patterns"
              >Show HN: Interactive game teaching dark patterns in UX design</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 14:23:56</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42737778"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
            <div class="text">
              <p>The game includes:</p>
              <p>
                â€¢ Interactive pattern recognition scenarios â€¢ Explanations of
                psychological principles â€¢ Simulated real-world examples with
                guided feedback
              </p>
              <p>Built with Next.js, TypeScript, and Tailwind.</p>
              <p>
                I'd especially appreciate feedback on the educational approach
                and scenario design.
              </p>
            </div>
          </section>
        </section>
        <section id="42736968">
          <h3>
            <a class="item" href="https://www.damninteresting.com/the-derelict/"
              >The Derelict (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 12:46:08</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42736968"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42735413">
          <h3>
            <a
              class="item"
              href="https://www.linusakesson.net/music/family-bass/index.php"
              >The Family Bass - Music with an NES</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 08:54:28</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42735413"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42734851">
          <h3>
            <a
              class="item"
              href="https://johnaustin.io/articles/2025/issues-with-cielab-and-perceptual-brightness"
              >Issues with Color Spaces and Perceptual Brightness</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 07:01:27</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42734851"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42734478">
          <h3>
            <a
              class="item"
              href="https://blog.cryptographyengineering.com/2025/01/17/lets-talk-about-ai-and-end-to-end-encryption/"
              >Let's talk about AI and end-to-end encryption</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 05:50:25</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42734478"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42733640">
          <h3>
            <a
              class="item"
              href="https://oddlama.org/blog/bypassing-disk-encryption-with-tpm2-unlock/"
              >Bypassing disk encryption on systems with automatic TPM2
              unlock</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 03:00:10</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42733640"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42732728">
          <h3>
            <a
              class="item"
              href="https://charleshughsmith.substack.com/p/is-the-world-becoming-uninsurable"
              >Is the world becoming uninsurable?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 00:32:06</span
              ><span class="points-container"
                >Points: <span class="points">399</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42732728"
                  >Comments</a
                ><span class="descendants">: 980</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42731582">
          <h3>
            <a class="item" href="https://learn.yjs.dev/"
              >Learn Yjs Interactively</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-16 @ 22:13:22</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42731582"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42731417">
          <h3>
            <a
              class="item"
              href="https://github.com/westoncb/nonlinear-optics-sandbox"
              >Show HN: Real-time nonlinear optics simulation (JS/GLSL)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-16 @ 21:55:01</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42731417"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42731091">
          <h3>
            <a
              class="item"
              href="https://www.spacex.com/launches/mission/?missionId=starship-flight-7?submit"
              >Starship Flight 7</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-16 @ 21:25:24</span
              ><span class="points-container"
                >Points: <span class="points">617</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42731091"
                  >Comments</a
                ><span class="descendants">: 640</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42725385">
          <h3>
            <a class="item" href="https://keygen.sh/blog/no-calls/">No Calls</a>
          </h3>
          <section>
            <h4>
              <span>2025-01-16 @ 14:17:31</span
              ><span class="points-container"
                >Points: <span class="points">1456</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42725385"
                  >Comments</a
                ><span class="descendants">: 476</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42725147">
          <h3>
            <a class="item" href="https://zadzmo.org/code/nepenthes/"
              >Nepenthes is a tarpit to catch AI web crawlers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-16 @ 13:57:43</span
              ><span class="points-container"
                >Points: <span class="points">610</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42725147"
                  >Comments</a
                ><span class="descendants">: 230</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42699620">
          <h3>
            <a
              class="item"
              href="https://iosoft.blog/2019/11/22/real-time-location-ultra-wideband/"
              >Real Time Location Using Ultra-Wideband (UWB) (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-14 @ 16:37:55</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42699620"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42697001">
          <h3>
            <a class="item" href="https://www.lightcellenergy.com/"
              >Lightcell: An engine that uses light to make electricity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-14 @ 13:36:09</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42697001"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42694732">
          <h3>
            <a
              class="item"
              href="https://postgresql-anonymizer.readthedocs.io/en/stable/"
              >PostgreSQL Anonymizer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-14 @ 07:36:25</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42694732"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42694384">
          <h3>
            <a class="item" href="https://docs.p2p.industries"
              >Show HN: Decentralized robots (and things) orchestration
              system</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-14 @ 06:31:22</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42694384"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                This first beta version allows you to create fully decentralized
                robot swarms. The system will set up a wireless mesh network and
                run a p2p networking stack on top of it, such that nodes can
                interact with each other through various abstractions using our
                SDKs (Rust, Python, TypeScript) or a CLI.
              </p>
              <p>
                We hope this is a step toward better inter-robot communication
                (and a fun project if you have a few Raspberry Pis lying
                around).
              </p>
              <p>
                Our mesh network is created by B.A.T.M.A.N.-adv and weâ€™ve
                combined this with optimized decentralized algorithms. To a
                user, it becomes very easy to write decentralized applications
                involving several peers since weâ€™ve abstracted away much of the
                complexity. Our system currently offers several orchestration
                primitives (Key-Value Store, Pub-Sub, Discovery,
                Request-Response, Mesh Inspection, Debug Services, etc.)
              </p>
              <p>
                Internally, everything except the SDKs is written in Rust,
                building on top of libp2p. We use gRPC to communicate between
                the SDKs and the CLI, so libraries for other languages are
                possible, and we welcome contributions (or feedback).
              </p>
              <p>
                The C++ SDK and a ROS package that should feel natural to
                roboticists are in the works. Soon we also want to support a
                collaborative SLAM and a distributed task queue.
              </p>
              <p>Weâ€™d love to hear your thoughts! :)</p>
            </div>
          </section>
        </section>
        <section id="42693748">
          <h3>
            <a
              class="item"
              href="https://www.paulosyibelo.com/2024/12/doubleclickjacking-what.html"
              >A New type of web hacking technique: DoubleClickjacking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-14 @ 04:44:06</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42693748"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42689054">
          <h3>
            <a
              class="item"
              href="https://www.universityofcalifornia.edu/news/how-uc-santa-cruz-professor-unearthed-oldest-alphabet-yet"
              >A UC Santa Cruz professor unearthed the oldest alphabet yet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-13 @ 20:50:01</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42689054"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
