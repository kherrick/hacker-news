<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39613398">
          <h3>
            <a
              class="item"
              href="https://www.astralcodexten.com/p/the-psychopolitics-of-trauma"
              >The Psychopolitics of Trauma</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 07:50:30</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39613398"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39613181">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/how-birmingham-city-councils-equal-pay-bankruptcy-provided-cover-for-ongoing-oracle-it-disaster-224416"
              >Birmingham council's 'equal pay' bankruptcy provided cover for
              Oracle disaster</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 07:12:05</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39613181"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39613021">
          <h3>
            <a class="item" href="https://github.com/soorajshankar/logScreen"
              >Show HN: Piping logs, visualizing in a web app – just suffix "|
              npx logscreen"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 06:42:45</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39613021"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39612950">
          <h3>
            <a class="item" href="https://yacy.net/"
              >YaCy, a distributed Web Search Engine, based on a peer-to-peer
              network</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 06:33:04</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39612950"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39612799">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=dZQ7x0-MZcI"
              >Alan Kay's talk at UCLA – Feb 21, 2024 [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 06:03:33</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39612799"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39612640">
          <h3>
            <a class="item" href="https://iss-mimic.github.io/Mimic/"
              >Realtime telemetry from ISS internal components</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 05:28:50</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39612640"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39612607">
          <h3>
            <a
              class="item"
              href="https://aws.amazon.com/blogs/aws/free-data-transfer-out-to-internet-when-moving-out-of-aws/"
              >Free data transfer out to internet when moving out of AWS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 05:22:35</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39612607"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39612484">
          <h3>
            <a
              class="item"
              href="https://www.canva.dev/blog/engineering/fonts-are-still-a-helvetica-of-a-problem/"
              >Fonts are still a Helvetica of a Problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 04:57:44</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39612484"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39612443">
          <h3>
            <a
              class="item"
              href="https://corecursive.com/leaving-linkedin-with-chris-krycho/"
              >Leaving LinkedIn: Choosing Engineering Excellence over
              Expediency</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 04:49:38</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39612443"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39611849">
          <h3>
            <a class="item" href="https://www.sugarlabs.org/"
              >Sugar: An activity-focused, open-source software learning
              platform for children</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 03:09:12</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39611849"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39611662">
          <h3>
            <a
              class="item"
              href="https://jdh.hamkins.org/propagation-of-error-in-classical-geometry-constructions/"
              >The propagation of error in classical geometry constructions
              (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 02:43:54</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39611662"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39611484">
          <h3>
            <a class="item" href="https://openai.com/blog/openai-elon-musk"
              >OpenAI and Elon Musk</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 02:19:01</span
              ><span class="points-container"
                >Points: <span class="points">588</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39611484"
                  >Comments</a
                ><span class="descendants">: 382</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39611111">
          <h3>
            <a
              class="item"
              href="https://forums.swift.org/t/embedded-swift-on-the-raspberry-pi-pico-rp2040-without-the-pico-sdk/69338"
              >Embedded Swift on the Raspberry Pi Pico</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 01:10:49</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39611111"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39610931">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/03/05/accenture-to-acquire-udacity-to-build-a-learning-platform-focused-on-ai/"
              >Accenture to Acquire Udacity</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 00:46:12</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39610931"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39609528">
          <h3>
            <a
              class="item"
              href="https://paxsims.wordpress.com/2024/03/02/ace-of-aces-or-why-you-should-do-maths-as-a-game-designer/"
              >Ace of Aces: Why you should do maths as a game designer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 21:45:53</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39609528"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39609336">
          <h3>
            <a
              class="item"
              href="https://texts.blog/2024/02/20/cracking-metas-messenger-certificate-pinning-on-macos/"
              >Cracking Meta's Messenger Certificate Pinning on macOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 21:25:24</span
              ><span class="points-container"
                >Points: <span class="points">381</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39609336"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39608822">
          <h3>
            <a
              class="item"
              href="https://blog.dhsdevelopments.com/array-languages-vs"
              >Array languages vs. the curse of the spreadsheet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 20:32:44</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39608822"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39607753">
          <h3>
            <a
              class="item"
              href="https://www.jedec.org/news/pressreleases/jedec-publishes-gddr7-graphics-memory-standard"
              >JEDEC publishes GDDR7 graphics memory standard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 18:57:24</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39607753"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39607747">
          <h3>
            <a
              class="item"
              href="https://www.gitclear.com/blog/linux_touchpad_like_macbook_2023_update_smooth_scroll"
              >Linux Touchpad Like MacBook Update: 2023 Progress on Smooth
              Scrolling</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 18:57:03</span
              ><span class="points-container"
                >Points: <span class="points">236</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39607747"
                  >Comments</a
                ><span class="descendants">: 219</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39607412">
          <h3>
            <a class="item" href="http://www.larry.denenberg.com/Knuth-3-16/"
              >This Is Knuth 3:16 (2002)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 18:30:47</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39607412"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39606371">
          <h3>
            <a
              class="item"
              href="https://extremelearning.com.au/how-to-generate-uniformly-random-points-on-n-spheres-and-n-balls/"
              >How to generate uniformly random points on n-spheres and in
              n-balls</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 17:14:20</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39606371"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39604961">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39604961"
              >Launch HN: Greptile (YC W24) - RAG on codebases that actually
              works</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 15:48:56</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39604961"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
            <div class="text">
              <a href="https://youtu.be/qI24eKO1YX0"
                >https://youtu.be/qI24eKO1YX0</a
              >. You can try it on 100 popular repos here:
              <a href="https://app.greptile.com/repo"
                >https://app.greptile.com/repo</a
              >, and on your own repo (if you give permission - more on that
              below) here:
              <a href="https://app.greptile.com">https://app.greptile.com</a>.
              <p>
                We are far from the first people to try "RAG on your codebase".
                We focus on full codebase comprehension: using LLMs to
                accurately answer difficult questions with full context of
                large, complex, and even multi-repo codebases.
              </p>
              <p>
                Simple RAG alone is not sufficient for this task. Codebases
                aren’t like most PDFs, docs, or other similar data types. They
                are graphs—complex puzzles where each piece is interlinked. So
                Greptile does a few things past simple RAG:
              </p>
              <p>
                (1) Instead of directly embedding code, we parse the AST of the
                codebase, recursively generate docstrings for each node in the
                tree, and then embed the docstrings.
              </p>
              <p>
                (2) Alongside vector similarity search and keyword search, we do
                “agentic search” where an agent reviews the relevance of the
                search results, and scans the source code to follow references
                that might lead to something important. Then it returns the
                relevant sources.
              </p>
              <p>
                For example, here are a couple questions that this system is
                able to answer in our test repo that simple RAG couldn’t (in our
                experience):
              </p>
              <p>
                “<i>Where are the auth providers configured?</i>” (They are in
                an array inside of an options.ts file, where looking at the file
                it’s not obvious it’s an auth related file. However, because
                that array is imported into the auth/route.ts file, Greptile’s
                agent traces and find it)
              </p>
              <p>
                “<i>How would I add a postgres connector?</i>” (The best way to
                answer this is to see how the Redis connector is set up and
                mirror it. Simple RAG sometimes retrieves some of the code for
                the Redis connector, but Greptile’s agent follows the
                connections to retrieve all the code that the redis connector
                touches, and uses that to write instructions.)
              </p>
              <p>
                Developers (including at Stripe and Microsoft) are using
                Greptile for things like:
              </p>
              <p>
                Debugging—you can paste in an error message and it does a pretty
                good job of diagnosing the root cause and suggesting fixes.
              </p>
              <p>
                Grokking OSS repos—for example, if you're forking a repo,
                modifying it for your usecase, or just integrating it, Greptile
                lets you add multiple repos and dependencies in the same chat
                session so it has full context.
              </p>
              <p>
                Parsing legacy code at work—especially if original engineers
                have left the company.
              </p>
              <p>
                Since we're accessing your private code, we're very careful with
                security. We don't store any code on our servers after initial
                processing, and just pull snippets as needed from the GitHub
                API.
              </p>
              <p>
                Quick note: when you sign in with GH, it might ask for
                permission to "act on your behalf". This is a quirk of GitHub's
                wording—our permissions are read-only and the only thing we do
                "on your behalf" is read code, so we can index the repo.
              </p>
              <p>
                We came up with this idea while working at AWS—the codebase was
                super complicated, the docs were sparse and out of date, and our
                team was remote so it was slow to get answers to questions. We
                picked "greptile" because of "grep" and also we just wanted a
                somewhat silly name.
              </p>
              <p>
                Try it out! It's a work in progress, so any feedback is
                appreciated. Here are the links again: for popular open source
                repos see
                <a href="https://app.greptile.com/repo"
                  >https://app.greptile.com/repo</a
                >, and to get it working on your own repo, start at
                <a href="https://app.greptile.com">https://app.greptile.com</a>.
              </p>
              <p>
                If you have experience working with a complex codebase at work
                or for a project, I’d love to hear about it. It really helps us
                educate our product direction. Looking forward to comments!
              </p>
              <p>
                edit. For those who want to try this on large or private repos,
                here is a promo code for a free month: HACKERNEWS100
              </p>
            </div>
          </section>
        </section>
        <section id="39604600">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/elliptic-curve-murmurations-found-with-ai-take-flight-20240305/"
              >Elliptic curve 'murmurations' found with AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 15:27:58</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39604600"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39603087">
          <h3>
            <a class="item" href="https://papereditor.app/internals"
              >Nerdy internals of an Apple text editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 13:28:56</span
              ><span class="points-container"
                >Points: <span class="points">363</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39603087"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39602480">
          <h3>
            <a class="item" href="https://math.ucr.edu/home/baez/roots/"
              >The Beauty of Roots (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 12:31:57</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39602480"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39602093">
          <h3>
            <a
              class="item"
              href="https://www.amazon.science/publications/forecasting-with-trees"
              >Forecasting with Trees (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 11:37:34</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39602093"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39600810">
          <h3>
            <a
              class="item"
              href="https://app.radicle.xyz/nodes/seed.radicle.garden/rad:z3gqcJUoA1n9HaHKufZs5FCSGazv5"
              >Radicle: Open-Source, Peer-to-Peer, GitHub Alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 08:39:10</span
              ><span class="points-container"
                >Points: <span class="points">737</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39600810"
                  >Comments</a
                ><span class="descendants">: 251</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39600108">
          <h3>
            <a
              class="item"
              href="http://www.os2museum.com/wp/the-future-that-never-was/"
              >The Future That Never Was</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 06:35:29</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39600108"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39589488">
          <h3>
            <a
              class="item"
              href="https://pages.cpsc.ucalgary.ca/~robin/class/449/Evolution.htm"
              >The Evolution of a Haskell Programmer (2001)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 12:12:01</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39589488"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39589293">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/space/2024/03/the-worlds-most-traveled-crew-transport-spacecraft-will-launch-again-tonight/"
              >The most traveled crew transport spacecraft flies again</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 11:44:16</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39589293"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
