<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46445229">
          <h3>
            <a
              class="item"
              href="https://xam.dk/blog/lets-make-2026-the-year-of-java-in-the-terminal/"
              >2026: The Year of Java in the Terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 15:55:14</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46445229"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46445195">
          <h3>
            <a
              class="item"
              href="https://kywch.github.io/blog/2025/12/curriculum-learning-2048-tetris/"
              >Scaffolding to Superhuman: How Curriculum Learning Solved 2048
              and Tetris</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 15:52:51</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46445195"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46445068">
          <h3>
            <a
              class="item"
              href="https://monogame.net/blog/2025-12-30-385-new-sponsor-announcement/"
              >Stardew Valley developer made a $125k donation to the FOSS C#
              framework MonoGame</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 15:39:58</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46445068"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46444743">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2025/dec/31/france-plans-social-media-ban-for-under-15s-from-september-2026"
              >France targets Australia-style social media ban for children next
              year</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 15:06:52</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46444743"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46444564">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/healthcare-pharmaceuticals/drugmakers-raise-us-prices-350-medicines-despite-pressure-trump-2025-12-31/"
              >Drugmakers raise US prices on 350 medicines despite pressure</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 14:51:28</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46444564"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46444481">
          <h3>
            <a class="item" href="https://sergiocipriano.com/beyla-envoy.html"
              >Zero-Code Instrumentation of an Envoy TCP Proxy Using eBPF</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 14:43:38</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46444481"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46444076">
          <h3>
            <a
              class="item"
              href="https://www.helsinki.fi/en/news/innovations/efficient-method-capture-carbon-dioxide-atmosphere-developed-university-helsinki"
              >Efficient method to capture CO2 from the atmosphere / Univ of
              Helsinki</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 13:59:09</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46444076"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46443988">
          <h3>
            <a class="item" href="https://alexwlchan.net/2025/square-pixels/"
              >When square pixels aren't square</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 13:44:41</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46443988"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46443767">
          <h3>
            <a class="item" href="https://carimbo.games/games/nintendo/"
              >Claude wrote a functional NES emulator using my engine's API</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 13:07:22</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46443767"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46443744">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46443744"
              >Tell HN: Happy New Year</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 13:02:48</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46443744"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46443626">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/inside-nvidia-gb10s-memory-subsystem"
              >Nvidia GB10's Memory Subsystem, from the CPU Side</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 12:43:58</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46443626"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46443579">
          <h3>
            <a
              class="item"
              href="https://sprott.physics.wisc.edu/pickover/trans.html"
              >Fifteen Most Famous Transcendental Numbers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 12:32:27</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46443579"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46443486">
          <h3>
            <a
              class="item"
              href="https://people.idsia.ch/~juergen/who-invented-the-transistor.html"
              >Who Invented the Transistor?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 12:12:20</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46443486"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46442903">
          <h3>
            <a
              class="item"
              href="https://www.ece.uvic.ca/~elec399/201409/Akin%27s%20Laws%20of%20Spacecraft%20Design.pdf"
              >Akin's Laws of Spacecraft Design [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 10:12:51</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46442903"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46442597">
          <h3>
            <a
              class="item"
              href="https://chrisloy.dev/post/2025/12/30/the-rise-of-industrial-software"
              >The rise of industrial software</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 09:09:28</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46442597"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46442245">
          <h3>
            <a class="item" href="https://exopriors.com/scry"
              >Show HN: Use Claude Code to Query 600 GB Indexes over Hacker
              News, ArXiv, etc.</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 07:47:44</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46442245"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
            <div class="text">
              <p>
                There's also an Alerts functionality, where you can just ask
                Claude to submit a SQL query as an alert, and you'll be emailed
                when the ultra nuanced criteria is met (and the output changes).
                Like I want to know when somebody posts about "estrogen" in a
                psychoactive context, or enough biology metaphors when talking
                about building infrastructure.
              </p>
              <p>
                Currently have embedded: posts: 1.4M / 4.6M comments: 15.6M /
                38M That's with Voyage-3.5-lite. And you can do amazing
                compositional vector search, like search @FTX_crisis -
                (@guilt_tone - @guilt_topic) to find writing that was about the
                FTX crisis and distinctly without guilty tones, but that can
                mention "guilt".
              </p>
              <p>
                I can embed everything and all the other sources for cheap, I
                just literally don't have the money.
              </p>
            </div>
          </section>
        </section>
        <section id="46440510">
          <h3>
            <a class="item" href="http://www.redbook.io/"
              >Readings in Database Systems (5th Edition) (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 02:01:53</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46440510"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46438522">
          <h3>
            <a
              class="item"
              href="https://vptdigital.com/blog/honey-detecting-testers/"
              >Honey's Dieselgate: Detecting and tricking testers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 21:59:35</span
              ><span class="points-container"
                >Points: <span class="points">323</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46438522"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46436889">
          <h3>
            <a
              class="item"
              href="https://it-notes.dragas.net/2025/02/26/fedimeteo-how-a-tiny-freebsd-vps-became-a-global-weather-service-for-thousands/"
              >FediMeteo: A â‚¬4 FreeBSD VPS Became a Global Weather Service</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 19:21:48</span
              ><span class="points-container"
                >Points: <span class="points">354</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46436889"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46436409">
          <h3>
            <a
              class="item"
              href="https://f-droid.org/2025/12/30/a-faster-heart-for-f-droid.html"
              >A faster heart for F-Droid</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 18:36:37</span
              ><span class="points-container"
                >Points: <span class="points">486</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46436409"
                  >Comments</a
                ><span class="descendants">: 197</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46435614">
          <h3>
            <a
              class="item"
              href="https://00f.net/2025/12/30/libsodium-vulnerability/"
              >A Vulnerability in Libsodium</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 17:24:57</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46435614"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46435308">
          <h3>
            <a class="item" href="https://hackerbook.dosaygo.com"
              >Show HN: 22 GB of Hacker News in SQLite</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 17:01:59</span
              ><span class="points-container"
                >Points: <span class="points">643</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46435308"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
            <div class="text">
              <p>
                Go to this repo (<a
                  href="https://github.com/DOSAYGO-STUDIO/HackerBook"
                  >https://github.com/DOSAYGO-STUDIO/HackerBook</a
                >): you can download it. Big Query -&gt; ETL -&gt; npx serve
                docs - that's it. 20 years of HN arguments and beauty, can be
                yours forever. So they'll never die. Ever. It's the unkillable
                static archive of HN and it's your hands. That's my Year End
                gift to you all. Thank you for a wonderful year, have happy and
                wonderful 2026. make something of it.
              </p>
            </div>
          </section>
        </section>
        <section id="46410676">
          <h3>
            <a class="item" href="https://crazyfast.website"
              >A super fast website using Cloudflare workers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-28 @ 12:42:11</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46410676"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46409359">
          <h3>
            <a
              class="item"
              href="https://en.andros.dev/blog/7b1b607b/doom-in-django-testing-the-limits-of-liveview-at-600000-divssegundo/"
              >Doom in Django: testing the limits of LiveView at 600.000
              divs/segundo</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-28 @ 08:10:01</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46409359"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46394651">
          <h3>
            <a class="item" href="https://github.com/tixl3d/tixl"
              >Tixl: Open-source realtime motion graphics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-26 @ 18:20:10</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46394651"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46390621">
          <h3>
            <a class="item" href="https://animatedai.github.io/">Animated AI</a>
          </h3>
          <section>
            <h4>
              <span>2025-12-26 @ 09:34:57</span
              ><span class="points-container"
                >Points: <span class="points">268</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46390621"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46381901">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/c4g9dzj1xj3o"
              >Winnie-the-Pooh brings 100 years of fame to forest</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 03:49:33</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46381901"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46379562">
          <h3>
            <a class="item" href="http://www.vpri.org/pdf/tr1997001_backto.pdf"
              >Back to the future: the story of Squeak, a practical Smalltalk
              written in itself [pdf] (1997)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-24 @ 21:42:07</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46379562"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46376307">
          <h3>
            <a
              class="item"
              href="https://www.spatialsource.com.au/three-norths-alignment-about-to-end/"
              >'Three norths' alignment about to end</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-24 @ 15:17:48</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46376307"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46375067">
          <h3>
            <a class="item" href="https://github.com/libriscv/libloong"
              >Show HN: LoongArch Userspace Emulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-24 @ 12:40:00</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46375067"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://fwsgonzo.medium.com/notes-on-libloong-loongarch-64-bit-emulation-515ea6610cad"
                >https://fwsgonzo.medium.com/notes-on-libloong-loongarch-64-b...</a
              >
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
