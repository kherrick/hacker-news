<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40680380">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/opinions/2024/06/14/europe-competition-economy-reform-populism/"
              >Europe's biggest problem: It is falling way behind America's
              powerhouse economy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 12:46:57</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40680380"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40680218">
          <h3>
            <a
              class="item"
              href="https://martincmartin.com/2024/06/14/how-i-found-a-55-year-old-bug-in-the-first-lunar-lander-game/"
              >I Found a 55 Year Old Bug in the First Lunar Lander Game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 12:24:06</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40680218"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40680107">
          <h3>
            <a
              class="item"
              href="https://timberfestival.org.uk/soundsoftheforest-soundmap/"
              >Map of Forest Sounds from Around the World</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 12:11:28</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40680107"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40680018">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/sante/jobs/Xw3ujU8-technical-account-manager"
              >Santé (YC S23) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 12:01:08</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40679689">
          <h3>
            <a
              class="item"
              href="https://googleprojectzero.blogspot.com/2024/06/driving-forward-in-android-drivers.html"
              >Android Drivers - News and updates from the Project Zero team at
              Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 11:16:09</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40679689"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40677810">
          <h3>
            <a
              class="item"
              href="https://www.interconnects.ai/p/apple-intelligence"
              >A look at Apple's technical approach to AI including core model
              performance etc.</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 05:36:47</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40677810"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40676974">
          <h3>
            <a
              class="item"
              href="https://www.eetimes.com/asml-aims-for-hyper-na-euv-shrinking-chip-limits/"
              >ASML Aims for Hyper-NA EUV, Shrinking Chip Limits</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 02:23:06</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40676974"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40676408">
          <h3>
            <a
              class="item"
              href="https://progressandpoverty.substack.com/p/land-value-tax-in-online-games-and"
              >Land value tax in online games and virtual worlds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 00:36:21</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40676408"
                  >Comments</a
                ><span class="descendants">: 254</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40676239">
          <h3>
            <a
              class="item"
              href="https://www.nioz.nl/en/news/fungus-breaks-down-ocean-plastic"
              >Fungus breaks down ocean plastic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 00:04:51</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40676239"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40675947">
          <h3>
            <a
              class="item"
              href="https://www.optoutproject.net/what-is-true-on-the-internet/"
              >Why I Bought an Encyclopedia</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-13 @ 23:18:50</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40675947"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40675397">
          <h3>
            <a class="item" href="https://yobibyte.github.io/notebooks.html"
              >Notebooks Are McDonalds of Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-13 @ 22:09:55</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40675397"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40673091">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/mouth-based-touchpad-augmental-0605"
              >Mouth-based touchpad enables people living with paralysis to use
              computers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-13 @ 18:43:17</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40673091"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40672843">
          <h3>
            <a class="item" href="https://github.com/ask-fini/paramount"
              >Show HN: Paramount – Human Evals of AI Customer Support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-13 @ 18:20:31</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40672843"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today, one of the largest use cases of LLMs is for the purpose
                of automating support. As the space has evolved over the past
                year, there has subsequently been a need for evaluations of LLM
                outputs - and a sea of LLM Evals packages have been released.
                "LLM evals" refer to the evaluation of large language models,
                assessing how well these AI systems understand and generate
                human-like text. These packages have recently relied on
                "automatic evals," where algorithms (usually another LLM)
                automatically test and score AI responses without human
                intervention.
              </p>
              <p>
                In our day to day work, we have found that Automatic Evals are
                not enough to get the required 95% accuracy for our Enterprise
                customers. Automatic Evals are efficient, but still often miss
                nuances that only human expertise can catch. Automatic Evals can
                never replace the feedback of a trained human who is deeply
                knowledgeable on an organization's latest product releases,
                knowledgebase, policies and support issues. The key to solve
                this is to stop ignoring the business side of the problem, and
                start involving knowledgeable experts in the evaluation process.
              </p>
              <p>
                That is why we are releasing Paramount - an Open Source package
                which incorporates human feedback directly into the evaluation
                process. By simplifying the step of gathering feedback, ML
                Engineers can pinpoint and fix accuracy issues (prompts,
                knowledgebase issues) much faster. Paramount provides a
                framework for recording LLM function outputs (ground truth data)
                and facilitates human agent evaluations through a simple UI,
                reducing the time to identify and correct errors.
              </p>
              <p>
                Developers can integrate Paramount with a Python decorator that
                logs LLM interactions into a database, followed by a
                straightforward UI for expert review. This process aids the
                debugging and validation phase of launching accurate support
                bots. We'd love to hear what you think!
              </p>
            </div>
          </section>
        </section>
        <section id="40672663">
          <h3>
            <a
              class="item"
              href="https://ykulbashian.medium.com/the-uncanny-is-the-experience-of-a-loss-of-control-06a3fb4dbcd1"
              >The "uncanny" is the experience of a loss of control</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-13 @ 18:02:15</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40672663"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40671140">
          <h3>
            <a class="item" href="https://github.com/morishin/XDeck"
              >Show HN: XDeck – An ad-blocking client app for macOS, like
              TweetDeck</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-13 @ 15:51:11</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40671140"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                XDeck is an client app for macOS as a TweetDeck alternative,
                with Ad-Blocking!
              </p>
              <p>
                I developed this for myself after feeling disappointed that
                TweetDeck has become a paid service.
              </p>
              <p>I hope you find it useful too.</p>
            </div>
          </section>
        </section>
        <section id="40670612">
          <h3>
            <a
              class="item"
              href="https://engineering.fb.com/2024/06/13/web/mlow-metas-low-bitrate-audio-codec/"
              >MLow: Meta's low bitrate audio codec</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-13 @ 15:05:18</span
              ><span class="points-container"
                >Points: <span class="points">531</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40670612"
                  >Comments</a
                ><span class="descendants">: 184</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40670096">
          <h3>
            <a class="item" href="https://lumalabs.ai/dream-machine"
              >Luma AI Dream Machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-13 @ 14:25:51</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40670096"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40666237">
          <h3>
            <a class="item" href="https://mjg59.dreamwidth.org/69646.html"
              >SSH agent extensions as an arbitrary RPC mechanism</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-13 @ 05:26:02</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40666237"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40662056">
          <h3>
            <a class="item" href="http://blog.cr.yp.to/20240612-bibkeys.html"
              >Bibliography keys: It's as easy as [1], [2], [3]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-12 @ 19:34:45</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40662056"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40656671">
          <h3>
            <a
              class="item"
              href="http://ai.eecs.umich.edu/people/conway/Memoirs/VLSI/Lynn_Conway_VLSI_Reminiscences.pdf"
              >Reminiscences of the VLSI Revolution – Lynn Conway [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-12 @ 11:02:30</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40656671"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40656310">
          <h3>
            <a
              class="item"
              href="https://github.com/thewierdnut/asha_pipewire_sink"
              >ASHA for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-12 @ 09:50:14</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40656310"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40656126">
          <h3>
            <a
              class="item"
              href="https://thebaffler.com/latest/spreadsheet-assassins-king"
              >Spreadsheet Assassins – A short history of "software as a
              service"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-12 @ 09:19:33</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40656126"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40656125">
          <h3>
            <a
              class="item"
              href="https://www.xlwings.org/blog/my-thoughts-on-python-in-excel"
              >My thoughts on Python in Excel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-12 @ 09:19:20</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40656125"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40655635">
          <h3>
            <a
              class="item"
              href="https://londonist.substack.com/p/a-new-map-of-medieval-london"
              >A new map of medieval London</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-12 @ 07:54:37</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40655635"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40649282">
          <h3>
            <a
              class="item"
              href="https://mrd0x.com/progressive-web-apps-pwa-phishing/"
              >Progressive Web Apps (PWAs) Phishing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 17:44:41</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40649282"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40647811">
          <h3>
            <a
              class="item"
              href="https://aethermug.com/posts/borges-on-chaos-theory"
              >Borges on Chaos Theory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 15:54:24</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40647811"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40646528">
          <h3>
            <a
              class="item"
              href="https://louisabraham.github.io/articles/probabilistic-tic-tac-toe"
              >Solving Probabilistic Tic-Tac-Toe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 14:25:28</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40646528"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40645362">
          <h3>
            <a
              class="item"
              href="https://nautil.us/the-boy-who-was-king-of-vanilla-522772/"
              >Edmond Albius's method of pollination is now used by all vanilla
              growers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 12:20:28</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40645362"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40644562">
          <h3>
            <a
              class="item"
              href="https://lemire.me/blog/2024/06/08/scan-html-faster-with-simd-instructions-chrome-edition/"
              >Scan HTML faster with SIMD instructions – Chrome edition</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 10:26:21</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40644562"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40641598">
          <h3>
            <a
              class="item"
              href="https://pillser.com/engineering/2024-06-10-website-without-404s"
              >Designing a website without 404s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 02:18:54</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40641598"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
