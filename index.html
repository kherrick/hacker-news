<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42057597">
          <h3>
            <a
              class="item"
              href="https://github.com/bayandin/awesome-awesomeness"
              >A GitHub repo that curates all the awesome repos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 06:40:56</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42057597"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42057451">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/sysadmin/comments/1gk2qdu/windows_2022_servers_unexpectedly_upgrading_to/"
              >Windows 2022 Servers Unexpectedly Upgrading to 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 05:57:15</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42057451"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42057431">
          <h3>
            <a
              class="item"
              href="https://weiyen.net/articles/useful-macos-cmd-line-utilities"
              >Useful built-in macOS command-line utilities</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 05:51:40</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42057431"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42057378">
          <h3>
            <a
              class="item"
              href="https://www.tumfatig.net/2024/gotosocial-wasm-based-sqlite-driver-and-bsd/"
              >GoToSocial WASM-based SQLite driver and BSD</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 05:35:31</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42057378"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42057139">
          <h3>
            <a
              class="item"
              href="https://www.understandingai.org/p/why-the-deep-learning-boom-caught"
              >Why the deep learning boom caught almost everyone by surprise</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 04:05:01</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42057139"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42057036">
          <h3>
            <a
              class="item"
              href="https://berthub.eu/articles/posts/tracker-beeper/"
              >Tracker Beeper (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 03:21:09</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42057036"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42056954">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-11-defibrillation-devices-electricity-optimized.html"
              >Defibrillation devices save lives using 1k times less
              electricity</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 02:54:44</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42056954"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42056923">
          <h3>
            <a class="item" href="https://www.titledrops.net/"
              >Title drops in movies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 02:48:06</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42056923"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42056918">
          <h3>
            <a class="item" href="https://jdan.github.io/98.css/"
              >98.css – A design system for building faithful recreations of old
              UIs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 02:46:58</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42056918"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42056644">
          <h3>
            <a
              class="item"
              href="https://admiralcloudberg.medium.com/the-spiral-of-wrath-the-crash-of-armavia-flight-967-c7d84541f0f7"
              >The Spiral of Wrath: The crash of Armavia flight 967</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 01:26:43</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42056644"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42055979">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/11/5/24289124/mozilla-foundation-layoffs-advocacy-global-programs"
              >Mozilla is eliminating its advocacy division</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 23:04:45</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42055979"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42055644">
          <h3>
            <a
              class="item"
              href="https://dspinellis.github.io/unix-v3man/v3man.pdf"
              >Unix Programmer's Manual Third Edition [pdf] (1973)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 22:12:02</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42055644"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42055616">
          <h3>
            <a
              class="item"
              href="https://www.thonking.ai/p/what-shapes-do-matrix-multiplications"
              >What Shapes Do Matrix Multiplications Like?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 22:08:24</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42055616"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42055556">
          <h3>
            <a
              class="item"
              href="https://www.winestockwebdesign.com/Essays/Eternal_Mainframe.html"
              >The Eternal Mainframe (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 22:00:05</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42055556"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42054813">
          <h3>
            <a
              class="item"
              href="https://thenewstack.io/why-companies-are-ditching-the-cloud-the-rise-of-cloud-repatriation/"
              >Why Companies Are Ditching the Cloud: The Rise of Cloud
              Repatriation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 20:19:13</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42054813"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42054779">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/nstc"
              >U.S. chip revival plan chooses sites</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 20:14:02</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42054779"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42054569">
          <h3>
            <a
              class="item"
              href="https://www.centauri-dreams.org/2024/11/05/vegas-puzzling-disk/"
              >Vega's Puzzling Disk</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 19:43:34</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42054569"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42054449">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/pc-components/cpus/for-the-first-time-ever-amd-outsells-intel-in-the-datacenter-space"
              >AMD outsells Intel in the datacenter space</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 19:27:15</span
              ><span class="points-container"
                >Points: <span class="points">384</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42054449"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42053747">
          <h3>
            <a class="item" href="https://github.com/fortress-build/whirlwind"
              >Show HN: Whirlwind – Async concurrent hashmap for Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 18:02:18</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42053747"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
            <div class="text">
              <a href="https://news.ycombinator.com/item?id=41426998"
                >https://news.ycombinator.com/item?id=41426998</a
              >).
              <p>
                We use a lot of async Rust internally, and created this library
                out of a need for an async-aware concurrent hashmap since there
                weren’t many available in the Rust ecosystem.
              </p>
              <p>
                Whirlwind is a sharded HashMap with a fully asynchronous API.
                Just as dashmap is a replacement for
                std::sync::RwLock&lt;HashMap&gt;, whirlwind aims to be a
                replacement for tokio::sync::RwLock&lt;HashMap&gt;. It has a
                similar design and performance characteristics to dashmap, but
                seems to perform better in read-heavy workloads with tokio's
                green threading.
              </p>
              <p>
                Benchmarks are in the readme! We used an asyncified version of
                dashmap's benchmark suite. The project is in a pretty early
                stage and I'm sure there are flaws, but I'm pretty happy with
                the performance.
              </p>
              <p>
                There is some unsafe involved, but we run Miri in ci to
                (hopefully) catch undefined behavior well before it's in an
                actual release.
              </p>
              <p>We'd appreciate any feedback! Thanks in advance :)</p>
            </div>
          </section>
        </section>
        <section id="42052432">
          <h3>
            <a class="item" href="https://github.com/gregpr07/browser-use"
              >Show HN: I wrote an open-source browser alternative for Computer
              Use for any LLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 15:51:43</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42052432"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
            <div class="text">
              <p>
                I made Browser-Use, an open-source tool that lets (all Langchain
                supported) LLMs execute tasks directly in the browser just with
                function calling.
              </p>
              <p>
                It allows you to build agents that interact with web elements
                using natural language prompts. We created a layer that
                simplifies website interaction for LLMs by extracting xPaths and
                interactive elements like buttons and input fields (and other
                fancy things). This enables you to design custom web automation
                and scraping functions without manual inspection through
                DevTools.
              </p>
              <p>
                Hasn't this been done a lot of times? Good question, as a
                general SaaS tool yes, but I think a lot of people are going to
                try to make their own web automation agents from scratch, so the
                idea is to provide groundwork/library for the hard part so that
                not everyone has to repeat these steps:
              </p>
              <p>
                - parse html in a LLM friendly way (clickable items +
                screenshots)
              </p>
              <p>
                - provide a nice function calls for everything inside the
                browser
              </p>
              <p>- create reusable agent classes</p>
              <p>
                What this is NOT? An all knowing AI agent that can solve all
                your problems.
              </p>
              <p>
                The vision: create repeatable tasks on the web just by prompting
                your agent and not care about the hows.
              </p>
              <p>
                To better showcase the power of text extraction we made a few
                demos such as:
              </p>
              <p>
                - Applying for multiple software engineering jobs in San
                Francisco
              </p>
              <p>
                - Opening new tabs to search for images of Albert Einstein,
                Oprah Winfrey, and Steve Jobs
              </p>
              <p>
                - Finding the cheapest one-way flight from London to Kyrgyzstan
                for December 25th
              </p>
              <p>
                I’d be interested in feedback on how this tool fits into your
                automation workflows. Try it out and let me know how it performs
                on your end.
              </p>
              <p>We are Gregor &amp; Magnus and we built this in 5 days.</p>
            </div>
          </section>
        </section>
        <section id="42052143">
          <h3>
            <a class="item" href="https://battleda.sh/blog/ea-account-takeover"
              >Hacking 700M Electronic Arts accounts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 15:18:34</span
              ><span class="points-container"
                >Points: <span class="points">731</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42052143"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42051968">
          <h3>
            <a class="item" href="https://docs.hackerfab.org/hacker-fab-space"
              >Hacker Fab</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 14:59:15</span
              ><span class="points-container"
                >Points: <span class="points">375</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42051968"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42051368">
          <h3>
            <a
              class="item"
              href="https://nap.nationalacademies.org/read/26982/chapter/1"
              >Failure analysis of the Arecibo 305 meter telescope collapse</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 13:37:42</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42051368"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42051197">
          <h3>
            <a
              class="item"
              href="https://codspeed.io/blog/state-of-python-3-13-performance-free-threading"
              >State of Python 3.13 performance: Free-threading</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 13:06:57</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42051197"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42051098">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/watermark"
              >DeepMind debuts watermarks for AI-generated text</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 12:50:16</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42051098"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42050862">
          <h3>
            <a class="item" href="https://github.com/darwindarak/rallyup"
              >Show HN: rallyup – Lightweight Wake-on-LAN Scheduler</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 12:04:14</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42050862"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’ve wanted a simple solution to handle Wake-on-LAN sequences
                for my home and work labs to boot up servers in the right order.
                I was already dabbling in Rust and thought this would be an
                interesting project to dive deeper and see if it could work well
                for this kind of network tool. The result is rallyup.
              </p>
              <p>
                rallyup lets you set up server dependencies in a YAML file, so
                each service (e.g., firewalls, storage, VM hosts) comes online
                in the right order. It verifies each server’s status before
                moving to the next.
              </p>
              <p>Features:</p>
              <p>
                - Dependency-based WOL with VLAN support - Built-in health
                checks (HTTP, open ports, shell commands) - Lightweight enough
                to run on a Raspberry Pi or similar device
              </p>
              <p>Would love any feedback. Thanks for taking a look!</p>
            </div>
          </section>
        </section>
        <section id="42025619">
          <h3>
            <a class="item" href="https://github.com/matvp91/superstreamer"
              >Superstreamer – OSS streaming toolkit from video source to
              player</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-02 @ 11:09:41</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42025619"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42018195">
          <h3>
            <a class="item" href="https://tmpout.sh/2/4.html"
              >Every boring problem found in eBPF (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-01 @ 15:50:56</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42018195"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42007462">
          <h3>
            <a
              class="item"
              href="https://inconvergent.net/2024/lisp-query-notation/"
              >Lisp Query Notation (LQN)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 14:46:59</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42007462"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42005147">
          <h3>
            <a
              class="item"
              href="https://www.doc.ic.ac.uk/~rak/papers/algorithm%20=%20logic%20+%20control.pdf"
              >Algorithm = Logic and Control [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-31 @ 10:00:07</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42005147"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
