<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35906604">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35906604"
              >Ask HN: It's 2023, how do you choose between MySQL and
              Postgres?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 18:52:47</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35906604"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
            <div class="text">
              Imagine you are starting a new project, and your backing datastore
              options are restricted to mysql or postgres (and/or their
              cloud-tailored equivalents.) What sort of functional requirements
              would cause you to choose one over the other?
            </div>
          </section>
        </section>
        <section id="35906292">
          <h3>
            <a class="item" href="https://teenage.engineering/products/tp-7"
              >TP-7</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 18:32:11</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35906292"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35906135">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/1dd470c2-be80-4887-83cc-87be93100a12"
              >SoftBank Vision funds post record $39B annual loss</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 18:21:26</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35906135"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35905858">
          <h3>
            <a
              class="item"
              href="https://github.com/dereknguyen269/programing-best-practices-2023"
              >Programing Best Practices 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 18:02:28</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35905858"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35905624">
          <h3>
            <a
              class="item"
              href="https://www.craigkerstiens.com/2013/03/31/why-i-blog/"
              >Why I Blog</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 17:46:35</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35905624"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35905437">
          <h3>
            <a class="item" href="https://www.boringreport.org/"
              >Show HN: Boring Report, a news app that uses AI to
              desensationalize the news</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 17:32:41</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35905437"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
            <div class="text">
              <p>
                App Link:
                <a
                  href="https://apps.apple.com/us/app/boring-report-news-by-ai/id6446786839?itsct=apps_box_link&amp;itscg=30200"
                  >https://apps.apple.com/us/app/boring-report-news-by-ai/id644...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="35905269">
          <h3>
            <a class="item" href="https://meyerweb.com/eric/comment/chech.html"
              >“Considered Harmful” Essays Considered Harmful (2002)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 17:20:44</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35905269"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35904973">
          <h3>
            <a
              class="item"
              href="https://remotejobs.org/remote-jobs/sales-development-representative-1121"
              >RankScience (YC W17) Is Hiring SDR's with a Knack for SEO</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 17:01:10</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35904773">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/index/100k-context-windows"
              >Anthropic - Introducing 100K Token Context Windows, Around 75,000
              Words</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 16:46:19</span
              ><span class="points-container"
                >Points: <span class="points">354</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35904773"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35904734">
          <h3>
            <a class="item" href="https://moderatormayhem.engine.is/"
              >Show HN: Moderator Mayhem, a game about the difficulties of
              content moderation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 16:43:58</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35904734"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35904320">
          <h3>
            <a class="item" href="https://www.barebones.com/store/"
              >BBEdit is 30 years old</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 16:14:47</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35904320"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35904118">
          <h3>
            <a
              class="item"
              href="https://unchainedcrypto.com/irs-files-44-billion-claims-against-bankrupt-ftx/"
              >IRS Files $44B Claims Against Bankrupt FTX</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 16:00:39</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35904118"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35903294">
          <h3>
            <a
              class="item"
              href="https://badar.tech/2023/04/30/electronics-lab-bench-setup-guide/"
              >Electronics Lab Bench Setup Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 15:09:04</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35903294"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35903260">
          <h3>
            <a
              class="item"
              href="https://www.scopeofwork.net/when-the-chips-are-down/"
              >When the Chips Are Down - Interview with Chip War author</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 15:06:41</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35903260"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35903188">
          <h3>
            <a
              class="item"
              href="https://www.deusinmachina.net/p/understanding-the-power-of-bitwise"
              >Understanding the power of bitwise operators</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 15:02:04</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35903188"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35902506">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/930705/4bbe9c26d7884277/"
              >Faster CPython at PyCon, part one</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 14:21:17</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35902506"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35902174">
          <h3>
            <a
              class="item"
              href="https://fungi.com/blogs/articles/place-mushrooms-in-sunlight-to-get-your-vitamin-d"
              >Place mushrooms in sunlight to get your vitamin D (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 13:58:25</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35902174"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35902086">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35902086"
              >Ask HN: Resources for older developers?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 13:51:51</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35902086"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
            <div class="text">
              I am early 50's and still code around half of my day. I do manage
              a small team but my primary love has always been development. I'm
              wondering what resources there are for us senior devs who keep
              coding? My older friends in the field chat when we are able about
              the cyclic nature of tech, coding, managing, mentoring and
              sometimes (unfortunately) strategies for dealing with ageism. But
              the pool of 40+ yr old devs is not huge in my area so I'd like
              access to a online community if anyone has pointers. Thanks!
            </div>
          </section>
        </section>
        <section id="35901538">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.04928"
              >A transformer-based method for zero and few-shot biomedical
              NER</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 13:12:37</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35901538"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35901128">
          <h3>
            <a
              class="item"
              href="https://nautil.us/the-19th-century-trippers-who-probed-the-mind-303265/"
              >The 19th-Century Trippers Who Probed the Mind</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 12:27:34</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35901128"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35900907">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/science-environment-65557469"
              >Wind is main source of UK electricity for first time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 11:57:57</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35900907"
                  >Comments</a
                ><span class="descendants">: 172</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35900891">
          <h3>
            <a class="item" href="https://pharo.org/news/pharo11-released.html"
              >Pharo 11</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 11:56:02</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35900891"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35900635">
          <h3>
            <a
              class="item"
              href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3419012/"
              >Fern leaves and cauliflower curds are not fractals (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 11:24:04</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35900635"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35900282">
          <h3>
            <a
              class="item"
              href="https://fly.io/blog/js-ecosystem-delightfully-wierd/"
              >The JavaScript ecosystem is delightfully weird</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 10:38:43</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35900282"
                  >Comments</a
                ><span class="descendants">: 159</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35899527">
          <h3>
            <a
              class="item"
              href="https://lore.kernel.org/lkml/20230509165657.1735798-1-kent.overstreet@linux.dev/T/#mf171fd06ffa420fe1bcf0f49a2b44a361ca6ac44"
              >Bcachefs – A New COW Filesystem</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 08:50:26</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35899527"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35899020">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=EDl9qBZ9Bb0"
              >32-Bit DOS Applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 07:37:50</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35899020"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35896190">
          <h3>
            <a
              class="item"
              href="https://twitter.com/paulg/status/1655925905527537666"
              >When you lose the ability to write, you also lose some of your
              ability to think</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 01:39:24</span
              ><span class="points-container"
                >Points: <span class="points">773</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35896190"
                  >Comments</a
                ><span class="descendants">: 469</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35893133">
          <h3>
            <a
              class="item"
              href="https://news.ucsc.edu/2023/04/sea-lion-size.html"
              >As the California sea lion population got bigger, so did male sea
              lions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 20:36:17</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35893133"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35885982">
          <h3>
            <a class="item" href="https://noidea.dog/#/fires/"
              >The History of Fire Escapes (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 11:32:39</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35885982"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35885046">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Protocol_Wars"
              >Protocol Wars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 08:26:54</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35885046"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
