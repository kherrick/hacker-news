<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39798209">
          <h3>
            <a
              class="item"
              href="https://run.outsideonline.com/news/barkley-marathons-2024-results/"
              >Jasmin Paris Becomes First Woman to Finish Hardest Race</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 07:44:52</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39798209"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39798115">
          <h3>
            <a
              class="item"
              href="https://gitlab.com/Screwtapello/sqlite-schema-diagram"
              >SQLite Schema Diagram Generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 07:20:13</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39798115"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39798029">
          <h3>
            <a
              class="item"
              href="https://andrewkelley.me/post/redis-renamed-to-redict.html"
              >Redis Renamed to Redict</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 07:01:14</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39798029"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39798026">
          <h3>
            <a
              class="item"
              href="https://jobs.gem.com/signoz/am9icG9zdDpFuMuTUJDOYgsO29-QrAIM"
              >SigNoz (YC W21, Open Source Datadog) Is Hiring Developer
              Advocate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 07:00:40</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39797889">
          <h3>
            <a
              class="item"
              href="https://underjord.io/fundamentals-of-object-storage.html"
              >Fundamentals of Object Storage in Elixir</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 06:26:58</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39797889"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39797659">
          <h3>
            <a
              class="item"
              href="https://www.folklore.org/Negative_2000_Lines_Of_Code.html"
              >-2000 Lines of Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 05:19:39</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39797659"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39797615">
          <h3>
            <a
              class="item"
              href="https://ai.meta.com/blog/scenescript-3d-scene-reconstruction-reality-labs-research/"
              >SceneScript, a novel approach for 3D scene reconstruction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 05:08:55</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39797615"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39797176">
          <h3>
            <a
              class="item"
              href="https://stability.ai/news/stabilityai-announcement"
              >Emad Mostaque resigned as CEO of Stability AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 03:33:17</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39797176"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39796893">
          <h3>
            <a class="item" href="https://soupault.app/"
              >Soupault: A static website management tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 02:19:13</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39796893"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39796595">
          <h3>
            <a
              class="item"
              href="https://news.stanford.edu/2024/03/13/high-speed-microscale-3d-printing/"
              >High-speed microscale 3D printing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 01:23:57</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39796595"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39796550">
          <h3>
            <a
              class="item"
              href="https://www.forbes.com/sites/thomasbrewster/2024/03/22/feds-ordered-google-to-unmask-certain-youtube-users-critics-say-its-terrifying/"
              >Google Ordered to Identify Who Watched Certain YouTube Videos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 01:15:54</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39796550"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39796349">
          <h3>
            <a
              class="item"
              href="https://dadrian.io/blog/posts/pqc-signatures-2024/"
              >Post-quantum cryptography is too damn big</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 00:50:44</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39796349"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39796216">
          <h3>
            <a
              class="item"
              href="https://www.collectorsweekly.com/articles/visiting-scarfolk/"
              >Visiting Scarfolk, the most spectacular dystopia of the 1970s
              (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 00:21:13</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39796216"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39795830">
          <h3>
            <a
              class="item"
              href="https://nfraprado.net/post/vcard-rss-as-an-alternative-to-social-media.html"
              >VCard and RSS as an alternative to social media</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-22 @ 23:14:43</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39795830"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39793912">
          <h3>
            <a
              class="item"
              href="https://www.petoi.com/pages/opencat-open-source-robot-pet-framework"
              >OpenCat: Open-source robotic pet quadruped framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-22 @ 19:25:59</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39793912"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39793805">
          <h3>
            <a class="item" href="https://pack.ac/note/pack"
              >Pack: A new container format for compressed files</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-22 @ 19:11:45</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39793805"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39793513">
          <h3>
            <a class="item" href="https://css.winterveil.net"
              >Show HN: magick.css – Minimalist CSS for Wizards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-22 @ 18:43:12</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39793513"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39793420">
          <h3>
            <a class="item" href="https://pure-css-site.netlify.app/"
              >Pure CSS Website</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-22 @ 18:34:56</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39793420"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39793250">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2402.02622"
              >DenseFormer: Enhancing Information Flow in Transformers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-22 @ 18:13:57</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39793250"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39793044">
          <h3>
            <a
              class="item"
              href="https://boomsupersonic.com/flyby/inaugural-first-flight-xb1-supersonic-demonstrator"
              >Boom announces successful flight of XB-1 demonstrator aircraft</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-22 @ 17:45:53</span
              ><span class="points-container"
                >Points: <span class="points">436</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39793044"
                  >Comments</a
                ><span class="descendants">: 373</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39792136">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39792136"
              >Launch HN: DryMerge (YC W24) – Automate Workflows with Plain
              English</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-22 @ 16:15:53</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39792136"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
            <div class="text">
              <a href="https://drymerge.com">https://drymerge.com</a>), a tool
              to automate workflows with plain English. For example, a user can
              say "When I get an email from a potential customer, add their
              details to a google sheet and send me a text", and DryMerge sets
              that up end-to-end in seconds. Other examples might be “When I
              finish a Google Meet with a customer, record any issues reported
              in Linear”, or “Every morning at 9 am, text me a summary of my
              calendar events for the day”.
              <p>
                Here’s a video walkthrough:
                <a href="https://youtu.be/S4L3B21vXGY"
                  >https://youtu.be/S4L3B21vXGY</a
                >.
              </p>
              <p>
                We initially set out to build a dev tool for API integration,
                and while building in the integration space, we realized
                existing workflow automation tools have a few key limitations.
                They still force users to do a lot of work like: Navigate
                through a sea of menus; Break down their workflow into discrete
                steps; Manually configure data transformations.
              </p>
              <p>
                This led us to explore how we could make workflow automation way
                simpler by letting users describe what they want in plain
                English and having AI take care of the automation setup,
                replacing no-code GUIs or scripts.
              </p>
              <p>Under the hood, DryMerge has two key components:</p>
              <p>
                - A semantic layer that uses LLMs to interpret the user's
                request and map it to a series of pre-defined triggers and
                actions (we've built hundreds of these integrations).
              </p>
              <p>
                - A data plane that orchestrates the actual execution, complete
                with smart field mapping, conditional logic, and
                human-in-the-loop checks.
              </p>
              <p>
                When a user describes a workflow, our semantic layer generates
                multiple candidate plans, scores them, and selects the best
                based on prior successful/failed workflows. It extracts key
                entities and fields needed, and auto-generates a simple form for
                the user to fill in any missing details. Users can then
                iteratively describe, tweak, and test their workflow in the same
                chat.
              </p>
              <p>
                The data plane then subscribes to the relevant event streams,
                executes the workflow steps, and handles gnarly aspects like
                pagination, retries, and rollbacks invisibly. We allow the
                semantic layer to delegate some values for runtime dependency
                injection from the data plane, to handle open-ended logic like
                classifying an email as urgent or summarizing a Google Meet
                transcript.
              </p>
              <p>
                We integrate with 14 common services — we’d love for you to try
                it out and share what you think. Check it out at
                <a href="https://drymerge.com/app">https://drymerge.com/app</a>.
              </p>
            </div>
          </section>
        </section>
        <section id="39774153">
          <h3>
            <a
              class="item"
              href="https://technicshistory.com/2024/03/21/twilight-of-the-steam-age-part-1-internal-combustion/"
              >Twilight of the Steam Age, Part 1: Internal Combustion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-21 @ 01:46:46</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39774153"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39770795">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-03-neolithic-boats-excavated-mediterranean-reveal.html"
              >Neolithic boats found in the Mediterranean reveal advanced
              nautical technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 19:14:59</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39770795"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39764360">
          <h3>
            <a
              class="item"
              href="https://wiki.secretgeek.net/unbounded-recursion#jokes-featuring-unbounded-recursion"
              >Unbounded Recursion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 09:29:12</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39764360"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39760482">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/2024/mar/17/cosmic-cathedrals-dust-rooftops-planetary-secrets-asteroids-comets"
              >Cosmic cleaners: the scientists scouring English cathedral roofs
              for space dust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 21:34:08</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39760482"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39759344">
          <h3>
            <a
              class="item"
              href="https://www.1024cores.net/home/relacy-race-detector"
              >Relacy Race Detector</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 19:25:27</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39759344"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39756367">
          <h3>
            <a class="item" href="https://quickwit.io/blog/quickwit-0.8"
              >Quickwit 0.8: Indexing and Search at Petabyte Scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 14:56:54</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39756367"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39753749">
          <h3>
            <a
              class="item"
              href="https://www.scattered-thoughts.net/writing/unexplanations-sql-is-syntactic-sugar-for-relational-algebra/"
              >SQL is syntactic sugar for relational algebra</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 07:54:22</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39753749"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39752239">
          <h3>
            <a
              class="item"
              href="http://www.shaveworld.org/images/%20DEBladePage2010.htm"
              >Evolution of the Double Edge Blade (1990)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-19 @ 01:55:48</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39752239"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39732713">
          <h3>
            <a
              class="item"
              href="https://maskray.me/blog/2024-03-17-c++-exit-time-destructors"
              >C++ Exit-Time Destructors</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-17 @ 07:56:34</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39732713"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
