<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39610134">
          <h3>
            <a
              class="item"
              href="https://nnethercote.github.io/2024/03/06/how-to-speed-up-the-rust-compiler-in-march-2024.html"
              >How to speed up the Rust compiler in March 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 22:50:03</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39610134"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39610054">
          <h3>
            <a
              class="item"
              href="https://reuters.com/technology/tethers-100-bln-stokes-stablecoin-stability-concerns-2024-03-05"
              >Tether reaches $100B, stokes stablecoin stability concerns</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 22:39:47</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39610054"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39609846">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/technology/2024/03/05/encryption-eu-human-rights-privacy-ruling/"
              >European court favors strong encryption, calling it key to
              privacy rights</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 22:16:06</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39609846"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39609528">
          <h3>
            <a
              class="item"
              href="https://paxsims.wordpress.com/2024/03/02/ace-of-aces-or-why-you-should-do-maths-as-a-game-designer/"
              >Ace of Aces: or, why you should Do Maths as a game designer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 21:45:53</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39609528"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39609336">
          <h3>
            <a
              class="item"
              href="https://texts.blog/2024/02/20/cracking-metas-messenger-certificate-pinning-on-macos/"
              >Cracking Meta's Messenger Certificate Pinning on macOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 21:25:24</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39609336"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39608822">
          <h3>
            <a
              class="item"
              href="https://blog.dhsdevelopments.com/array-languages-vs"
              >Array languages vs. the curse of the spreadsheet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 20:32:44</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39608822"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39607753">
          <h3>
            <a
              class="item"
              href="https://www.jedec.org/news/pressreleases/jedec-publishes-gddr7-graphics-memory-standard"
              >JEDEC publishes GDDR7 graphics memory standard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 18:57:24</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39607753"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39607747">
          <h3>
            <a
              class="item"
              href="https://www.gitclear.com/blog/linux_touchpad_like_macbook_2023_update_smooth_scroll"
              >Linux Touchpad Like MacBook Update: 2023 Progress on Smooth
              Scrolling</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 18:57:03</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39607747"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39607412">
          <h3>
            <a class="item" href="http://www.larry.denenberg.com/Knuth-3-16/"
              >This Is Knuth 3:16 (2002)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 18:30:47</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39607412"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39606885">
          <h3>
            <a class="item" href="https://tylerhou.com/posts/datalog-go-brrr/"
              >The "missing" graph datatype already exists. It was invented in
              the '70s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 17:53:22</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39606885"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39606464">
          <h3>
            <a
              class="item"
              href="https://learn.microsoft.com/en-us/windows/android/wsa/"
              >Microsoft is ending support for the Windows Subsystem for Android
              (WSA)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 17:22:21</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39606464"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39606371">
          <h3>
            <a
              class="item"
              href="https://extremelearning.com.au/how-to-generate-uniformly-random-points-on-n-spheres-and-n-balls/"
              >How to generate uniformly random points on n-spheres and in
              n-balls</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 17:14:20</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39606371"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39606245">
          <h3>
            <a
              class="item"
              href="https://www.historic-uk.com/HistoryUK/HistoryofBritain/Londons-Great-Stink/"
              >London's Great Stink</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 17:03:26</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39606245"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39606209">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/64643"
              >Keeper (YC S21) hiring engineers to build AI tax prep</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 17:00:51</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39606093">
          <h3>
            <a
              class="item"
              href="https://coinweek.com/bad-money-ancient-counterfeiters-and-their-fake-coins/"
              >Ancient Counterfeiters and Their Fake Coins</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 16:53:02</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39606093"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39606048">
          <h3>
            <a class="item" href="https://blog.kagi.com/kagi-wolfram"
              >Kagi and Wolfram</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 16:50:00</span
              ><span class="points-container"
                >Points: <span class="points">455</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39606048"
                  >Comments</a
                ><span class="descendants">: 171</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39605923">
          <h3>
            <a class="item" href="https://workout.olzhasar.com/"
              >Show HN: Workout Tracker PWA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 16:41:39</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39605923"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39605487">
          <h3>
            <a
              class="item"
              href="https://heatmap.news/technology/methanesat-edf-satellite-gosat"
              >Why are there so many methane satellites?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 16:14:10</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39605487"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39604961">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39604961"
              >Launch HN: Greptile (YC W24) - RAG on codebases that actually
              works</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 15:48:56</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39604961"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
            <div class="text">
              <a href="https://youtu.be/qI24eKO1YX0"
                >https://youtu.be/qI24eKO1YX0</a
              >. You can try it on 100 popular repos here:
              <a href="https://app.greptile.com/repo"
                >https://app.greptile.com/repo</a
              >, and on your own repo (if you give permission - more on that
              below) here:
              <a href="https://app.greptile.com">https://app.greptile.com</a>.
              <p>
                We are far from the first people to try "RAG on your codebase".
                We focus on full codebase comprehension: using LLMs to
                accurately answer difficult questions with full context of
                large, complex, and even multi-repo codebases.
              </p>
              <p>
                Simple RAG alone is not sufficient for this task. Codebases
                aren’t like most PDFs, docs, or other similar data types. They
                are graphs—complex puzzles where each piece is interlinked. So
                Greptile does a few things past simple RAG:
              </p>
              <p>
                (1) Instead of directly embedding code, we parse the AST of the
                codebase, recursively generate docstrings for each node in the
                tree, and then embed the docstrings.
              </p>
              <p>
                (2) Alongside vector similarity search and keyword search, we do
                “agentic search” where an agent reviews the relevance of the
                search results, and scans the source code to follow references
                that might lead to something important. Then it returns the
                relevant sources.
              </p>
              <p>
                For example, here are a couple questions that this system is
                able to answer in our test repo that simple RAG couldn’t (in our
                experience):
              </p>
              <p>
                “<i>Where are the auth providers configured?</i>” (They are in
                an array inside of an options.ts file, where looking at the file
                it’s not obvious it’s an auth related file. However, because
                that array is imported into the auth/route.ts file, Greptile’s
                agent traces and find it)
              </p>
              <p>
                “<i>How would I add a postgres connector?</i>” (The best way to
                answer this is to see how the Redis connector is set up and
                mirror it. Simple RAG sometimes retrieves some of the code for
                the Redis connector, but Greptile’s agent follows the
                connections to retrieve all the code that the redis connector
                touches, and uses that to write instructions.)
              </p>
              <p>
                Developers (including at Stripe and Microsoft) are using
                Greptile for things like:
              </p>
              <p>
                Debugging—you can paste in an error message and it does a pretty
                good job of diagnosing the root cause and suggesting fixes.
              </p>
              <p>
                Grokking OSS repos—for example, if you're forking a repo,
                modifying it for your usecase, or just integrating it, Greptile
                lets you add multiple repos and dependencies in the same chat
                session so it has full context.
              </p>
              <p>
                Parsing legacy code at work—especially if original engineers
                have left the company.
              </p>
              <p>
                Since we're accessing your private code, we're very careful with
                security. We don't store any code on our servers after initial
                processing, and just pull snippets as needed from the GitHub
                API.
              </p>
              <p>
                Quick note: when you sign in with GH, it might ask for
                permission to "act on your behalf". This is a quirk of GitHub's
                wording—our permissions are read-only and the only thing we do
                "on your behalf" is read code, so we can index the repo.
              </p>
              <p>
                We came up with this idea while working at AWS—the codebase was
                super complicated, the docs were sparse and out of date, and our
                team was remote so it was slow to get answers to questions. We
                picked "greptile" because of "grep" and also we just wanted a
                somewhat silly name.
              </p>
              <p>
                Try it out! It's a work in progress, so any feedback is
                appreciated. Here are the links again: for popular open source
                repos see
                <a href="https://app.greptile.com/repo"
                  >https://app.greptile.com/repo</a
                >, and to get it working on your own repo, start at
                <a href="https://app.greptile.com">https://app.greptile.com</a>.
              </p>
              <p>
                If you have experience working with a complex codebase at work
                or for a project, I’d love to hear about it. It really helps us
                educate our product direction. Looking forward to comments!
              </p>
              <p>
                edit. For those who want to try this on large or private repos,
                here is a promo code for a free month: HACKERNEWS100
              </p>
            </div>
          </section>
        </section>
        <section id="39604621">
          <h3>
            <a
              class="item"
              href="https://lithub.com/a-vanishing-world-on-europes-disappearing-peasantry/"
              >A Vanishing World: On Europe's Disappearing Peasantry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 15:29:21</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39604621"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39604600">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/elliptic-curve-murmurations-found-with-ai-take-flight-20240305/"
              >Elliptic curve 'murmurations' found with AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 15:27:58</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39604600"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39604245">
          <h3>
            <a class="item" href="https://www.needledrop.me/"
              >Show HN: NeedleDrop – Guess the movie from a song</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 14:59:29</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39604245"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
            <div class="text">
              <p>
                For the past four or five years, I've played a hacky trivia game
                with family and friends where I play a song, and they have to
                guess the movie that features the song; Guess the Needle Drop.
                After many passionate debates and over-the-top celebrations
                fueled by my generation’s nostalgia for popular classic songs
                and films, people often told me that I needed to “build an app
                for this.”
              </p>
              <p>
                I started doodling in Figma before quickly starting to build the
                website in Node, and then read somewhere that it's a better
                approach to learn vanilla javascript before trying to benefit
                from frameworks like React, etc. So I started again with a
                static vanilla website and, piece by piece, built out each chunk
                of functionality I’d envisioned. My mind was consistently blown
                at how helpful ChatGPT was–far beyond my lofty expectations,
                even with all the AI hype. It was like having a 24/7 personal
                tutor for free. I rarely had to google console errors hoping
                that a Stack Overflow discussion catered to my exact scenario.
                With enough information, ChatGPT always knew what was wrong and
                explained in terms I could understand.
              </p>
              <p>
                The workflow went like this: I would describe the desired user
                experience, parse the code GPT suggested, copy it to my editor,
                and paste back any errors I came across along the way. The
                errors were abundant at the beginning, but I got better over
                time at anticipating issues. Perhaps my biggest takeaway was
                that I had to learn how to converse with ChatGPT: sometimes I
                would spend 10 minutes crafting a prompt, forcing me to fully
                understand and articulate my own line of thinking about what I
                was trying to achieve .
              </p>
              <p>
                Using ChatGPT to make a static local website is fairly trivial,
                but the deployment and automation stage is where I fully
                realised the scope of what I could achieve. As a product
                designer, I’ve had the luxury of listening to engineers discuss
                solutions without personally having to sweat the execution.
                Working solo I couldn’t stay in the periphery anymore. I kinda
                knew AWS was a whole thing. That git was non-negotiable. That
                having a staging server is sensible and that APIs could do a lot
                of the heavy lifting for me. I would sanity-check with ChatGPT
                whether I understood these tools correctly and whether it was
                appropriate to use them for what I was building. A few of the
                things that initially intimidated me but I ended up working out:
              </p>
              <p>- GitHub Actions workflows</p>
              <p>- AWS hosting and CloudFront</p>
              <p>- Route 53 DNS hosting</p>
              <p>- SSL certificates</p>
              <p>- Implementing fuzzy search</p>
              <p>- LocalStorage and JSON manipulation</p>
              <p>- Even some basic python to scrub data</p>
              <p>
                It’s a fairly basic game, and for anyone sneaking a look with
                the inspector, it’s a dog’s div soup breakfast served with a
                side of spaghetti logic. But it still goes to show how much AI
                seems like a learning steroid.
              </p>
            </div>
          </section>
        </section>
        <section id="39603087">
          <h3>
            <a class="item" href="https://papereditor.app/internals"
              >Nerdy internals of an Apple text editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 13:28:56</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39603087"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39602480">
          <h3>
            <a class="item" href="https://math.ucr.edu/home/baez/roots/"
              >The Beauty of Roots (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 12:31:57</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39602480"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39602472">
          <h3>
            <a class="item" href="https://shenlanguage.org/"
              >The Shen Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 12:30:22</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39602472"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39601710">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2207.08815"
              >Why do tree-based models still outperform deep learning on
              tabular data? (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 10:44:01</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39601710"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39600810">
          <h3>
            <a
              class="item"
              href="https://app.radicle.xyz/nodes/seed.radicle.garden/rad:z3gqcJUoA1n9HaHKufZs5FCSGazv5"
              >Radicle: Open-Source, Peer-to-Peer, GitHub Alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-05 @ 08:39:10</span
              ><span class="points-container"
                >Points: <span class="points">669</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39600810"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39597030">
          <h3>
            <a class="item" href="https://github.com/HeyPuter/puter"
              >Show HN: 3 years and 1M users later, I just open-sourced my
              "Internet OS"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 22:31:15</span
              ><span class="points-container"
                >Points: <span class="points">1130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39597030"
                  >Comments</a
                ><span class="descendants">: 289</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39588977">
          <h3>
            <a
              class="item"
              href="https://ieeexplore.ieee.org/abstract/document/6319640"
              >A windowed graph Fourier transform (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 10:49:36</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39588977"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39588895">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Flexagon"
              >Flexagon</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-04 @ 10:35:27</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39588895"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
