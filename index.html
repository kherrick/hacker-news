<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40761837">
          <h3>
            <a
              class="item"
              href="https://ember-climate.org/insights/in-brief/the-global-solar-revolution/"
              >Solar generates fifth of global electricity on summer solstice
              midday peak</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 20:18:23</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40761837"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40761713">
          <h3>
            <a
              class="item"
              href="https://www.energysingularity.cn/en/hh70-the-worlds-first-high-temperature-superconducting-tokamak-achieves-first-plasma/"
              >HH70, the first high-temperature superconducting Tokamak achieves
              first plasma</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 20:01:41</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40761713"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40761606">
          <h3>
            <a
              class="item"
              href="https://www.msn.com/en-us/money/technology/ai-is-exhausting-the-power-grid-tech-firms-are-seeking-a-miracle-solution/ar-BB1oDl5z"
              >AI is exhausting the power grid. Tech firms are seeking a miracle
              solution</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 19:45:38</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40761606"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40761505">
          <h3>
            <a
              class="item"
              href="https://www.dw.com/en/greece-introduces-the-six-day-work-week/a-69439050"
              >Greece introduces the six day work week</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 19:30:32</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40761505"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40760962">
          <h3>
            <a
              class="item"
              href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4865492"
              >An Anatomy of Algorithm Aversion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 18:14:42</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40760962"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40760858">
          <h3>
            <a
              class="item"
              href="https://github.com/awslabs/aws-lambda-web-adapter"
              >AWS Lambda Web Adapter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 18:01:45</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40760858"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40760687">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/06/22/testing-amds-bergamo-zen-4c-spam/"
              >Testing AMD's Bergamo: Zen 4c</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 17:36:39</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40760687"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40760433">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/trellis/jobs/1ypWafM-founding-engineer-full-time-backend-ml-infra"
              >Trellis (YC W24) is hiring engineer to build AI-powered ETL for
              unstructured data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 17:00:58</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40760320">
          <h3>
            <a class="item" href="https://pigazing.dcford.org.uk/"
              >Pi Gazing is a project to build meteor cameras using Raspberry
              Pi</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 16:44:44</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40760320"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40759333">
          <h3>
            <a class="item" href="https://haithemturki.com/hybrid-nerf/"
              >HybridNeRF: Efficient Neural Rendering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 14:21:21</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40759333"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40759277">
          <h3>
            <a
              class="item"
              href="https://vu.nl/en/news/2024/andrew-s-tanenbaum-receives-acm-software-system-award"
              >Andrew S. Tanenbaum Receives ACM Software System Award</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 14:12:02</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40759277"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40758767">
          <h3>
            <a
              class="item"
              href="https://anandsanwal.me/2018/06/19/dad-company-sale/"
              >After my dad died, I ran and sold his company (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 12:49:18</span
              ><span class="points-container"
                >Points: <span class="points">417</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40758767"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40758703">
          <h3>
            <a class="item" href="https://github.com/mattrighetti/envelope"
              >Show HN: Envelope – A modern environment variable cli tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 12:39:57</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40758703"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
            <div class="text">
              <p>
                I had this idea when I made a big mistake and broke some
                production stuff because I had a very messy .env file laying
                around in my project.
              </p>
              <p>
                I was implementing new features for one of my projects and in my
                .env file I had the test database url commented out and the
                production one was not. Long story short, I applied migrations
                to the production database instead of my local test one and
                broke a lot of production APIs :')
              </p>
              <p>
                I wanted a tool that could easily help me spot these issues
                before something bad happened, and so I built envelope for that
                reason.
              </p>
              <p>
                Instead of a \.env(\..+)? file, I now use this tool to add
                variables to different configurations: dev, prod etc. and I feed
                them to the program I am executing on a one liner.
              </p>
              <p></p>
              <pre><code>  $ envelope init
  $ envelope add dev db_url localhost:5432/postgres
  $ envelope add dev db_username username
  $ envelope add dev db_pwd pwd
  $ export $(envelope list dev)
  $ ./run.sh
</code></pre>
              This way I am explicitly exporting the dev environment without
              relying on the fact that everything is in order in my .env file
              (another approach would be to have a .env.dev file)
              <p>
                A very useful feature that I use quite a lot is the `check`
                command which is going to tell you which environment you have
                currently active
              </p>
              <p></p>
              <pre><code>  $ export $(envelope list dev)
  $ envelope check
  &gt; dev
</code></pre>
              I don't think this tool is going to be useful to anybody, but I
              wanted to share this with you in case there is someone that can
              make good use of it or find particular scenarios where this could
              be used instead of .env files, either way I had a lot of fun
              building it
            </div>
          </section>
        </section>
        <section id="40757951">
          <h3>
            <a class="item" href="https://v1.web-check.xyz/"
              >Show HN: I made tool that let's you see everything about any
              website</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 10:43:47</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40757951"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/lissy93/web-check"
                >https://github.com/lissy93/web-check</a
              >
              :)
              <p>
                Why I'm building this? There are a lot of tools out there for
                discovering meta and security data relating to a website, IP or
                server. But currently, there isn't anything that does
                everything, all in one place and without a paywall/ user sign
                up.
              </p>
              <p>
                It's still a WIP, and I'm working on a new version, with some
                more comprehensive checks, so any feedback would be much
                appreciated :)
              </p>
            </div>
          </section>
        </section>
        <section id="40757787">
          <h3>
            <a
              class="item"
              href="https://www.neilhenning.dev/posts/yourownconstantfolder/"
              >Own Constant Folder in C/C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 10:07:05</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40757787"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40757486">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40757486"
              >Ask HN: Advice for Leading a Software Migration?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 08:49:04</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40757486"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm about to take lead of a decent sized software migration at
                work. (From V1 of some subsystem, to v2, both in house. We want
                to deprecated and eventually remove V1 totally) For 8 of our
                clients, totalling about 16 million customers.
              </p>
              <p>
                I don't have too many details to share, as I don't know what's
                relevant. But I'm asking if anyone has any advice or recommended
                reading regarding such?
              </p>
              <p>
                One book that is really inspiring me about it is "how big things
                get done" by Bent Flyvbjerg and Dan Gardner. In it, there's some
                key bits of advice such as
              </p>
              <p>* Think slow, ask fast, and mitigate long tailed risks.</p>
              <p>
                * Compartmentalize and stick to repeated processes. "Build with
                LEGOs"
              </p>
              <p>* Look around at other projects of similar nature.</p>
              <p>
                The last point is why I'm here, as I know some of you have been
                in the game for longer than I have, so feel free to share
                experiences that you might think is relevant, if you'd like.
              </p>
            </div>
          </section>
        </section>
        <section id="40756176">
          <h3>
            <a
              class="item"
              href="https://gwern.net/doc/psychology/linguistics/2024-fedorenko.pdf"
              >Language is primarily a tool for communication rather than
              thought [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 04:04:22</span
              ><span class="points-container"
                >Points: <span class="points">367</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40756176"
                  >Comments</a
                ><span class="descendants">: 281</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40756034">
          <h3>
            <a class="item" href="https://www.farmfe.org/"
              >Farm: Fast vite compatible build tool written in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 03:34:39</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40756034"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40752721">
          <h3>
            <a
              class="item"
              href="https://asia.nikkei.com/Business/Tech/Semiconductors/TSMC-explores-radical-new-chip-packaging-approach-to-feed-AI-boom"
              >TSMC experimenting with rectangular wafers vs. round for more
              chips per wafer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 19:17:41</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40752721"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40751813">
          <h3>
            <a
              class="item"
              href="https://navyhistory.au/aster-shootdown-over-sydney-in-1955/"
              >Aster shootdown over Sydney in 1955</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 17:33:28</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40751813"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40751020">
          <h3>
            <a
              class="item"
              href="https://blog.jitx.com/jitx-corporate-blog/testing-generative-ai-for-circuit-board-design"
              >Testing Generative AI for Circuit Board Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 16:16:31</span
              ><span class="points-container"
                >Points: <span class="points">331</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40751020"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40750506">
          <h3>
            <a
              class="item"
              href="https://mathstodon.xyz/@johncarlosbaez/112653640999819867"
              >Why does current flow the opposite way from the electrons?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 15:16:16</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40750506"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
            <div class="text">
              After fighting through a bunch of unhelpful answers, one gets to
              the bottom of things: Benjamin Franklin chose a convention that
              makes electrons negative, and apparently nobody knows why.
            </div>
          </section>
        </section>
        <section id="40741833">
          <h3>
            <a class="item" href="https://lwn.net/Articles/978010/"
              >Memory sealing for the GNU C Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 18:42:44</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40741833"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40741236">
          <h3>
            <a class="item" href="https://nical.github.io/posts/etagere.html"
              >Eight million pixels and counting: improving texture atlas
              allocation in Firefox (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 17:42:02</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40741236"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40739356">
          <h3>
            <a
              class="item"
              href="https://rafichaudhury.com/site/blog/Freehand-Web"
              >Curating my corner of the Internet with a freehand web editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 14:48:29</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40739356"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40739046">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/pdf/10.1145/319838.319870"
              >Connection Machine Lisp (1986)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 14:17:02</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40739046"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40738534">
          <h3>
            <a
              class="item"
              href="https://keymaterial.net/2024/06/15/reconstructing-public-keys-from-signatures/"
              >Reconstructing Public Keys from Signatures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 13:25:52</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40738534"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40736174">
          <h3>
            <a
              class="item"
              href="https://jupiter-ace.co.uk/Forth_general_practical_computing8108.html"
              >As you learn Forth, it learns from you (1981)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 08:05:13</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40736174"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40735038">
          <h3>
            <a
              class="item"
              href="https://zacksdancelab.com/blog/a-new-kind-of-dance-science/"
              >A New Kind Of Dance Science (combinatorics of social dancing)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 04:53:37</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40735038"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40709434">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-06-scientists-secrets-life-energy.html"
              >Scientists unlock secrets of how the third form of life makes
              energy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 18:43:43</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40709434"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
