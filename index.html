<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45154947">
          <h3>
            <a
              class="item"
              href="https://datamuseum.dk/wiki/Rational/R1000s400/Logbook/2019#2019-10-28"
              >The world has a running Rational R1000/400 computer again
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 02:46:55</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45154947"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45154856">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/09/05/us/navy-seal-north-korea-trump-2019.html"
              >Navy SEALs reportedly killed North Korean fishermen to hide a
              failed mission</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 02:30:07</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45154856"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45154609">
          <h3>
            <a class="item" href="https://mitchivin.com/"
              >Show HN: I recreated Windows XP as my portfolio</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 01:44:19</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45154609"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
            <div class="text">
              <p>
                I started from zero knowledge and spent months collaborating
                with AI agents as a learning experience. Every pixel and every
                function went through me. The AI translated what I asked for
                into code, but every decision was human. I didn't use existing
                OS frameworks because the goal was learning how basic coding
                languages worked while also developing my skills with AI
                collaboration. Apart from basic libraries like xp.css and
                paint.js, it's all original code.
              </p>
              <p>
                The result is a fully functional Windows XP recreation running
                in your browser. Complete experience with sounds, animations,
                and working applications. Even works properly on mobile, which
                required rebuilding everything to maintain the authentic feel
                without becoming unusable on touchscreens.
              </p>
              <p>
                This project taught me more about coding and AI collaboration
                than I ever expected. Would love to hear your thoughts on the
                execution and any feedback on the technical approach.
              </p>
            </div>
          </section>
        </section>
        <section id="45154501">
          <h3>
            <a class="item" href="https://stlab.cc/tips/about-mvc.html"
              >The MVC definition has been abused</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 01:26:44</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45154501"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45154270">
          <h3>
            <a
              class="item"
              href="https://jetgirl.art/blogs-used-to-be-very-different/"
              >Blogs used to be different</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-07 @ 00:45:22</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45154270"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45153863">
          <h3>
            <a class="item" href="https://kindnesssender.com/"
              >Show HN: Send kind and aspirational words to a stranger who needs
              it</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 23:32:22</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45153863"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              It is simply a reason to be kind to one another, for kindness may
              be the only medicine for the world’s pain.
            </div>
          </section>
        </section>
        <section id="45153636">
          <h3>
            <a
              class="item"
              href="https://www.sandordargo.com/blog/2025/02/05/cpp26-erroneous-behaviour"
              >C++26: Erroneous behaviour</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 22:51:42</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45153636"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45153428">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41380-025-03053-6"
              >A history of metaphorical brain talk in psychiatry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 22:21:55</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45153428"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45153140">
          <h3>
            <a
              class="item"
              href="https://www.gpiaaf.gov.pt/upload/processos/d054239.pdf"
              >Gloria funicular derailment initial findings report (EN) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 21:43:08</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45153140"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45152940">
          <h3>
            <a class="item" href="https://kanadojo.com"
              >Show HN: I'm making an open-source platform for learning
              Japanese</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 21:19:30</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45152940"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
            <div class="text">
              <p>
                Unfortunately, pretty much all language learning apps are
                closed-sourced and paid these days, and the ones that are free
                have unfortunately been abandoned.
              </p>
              <p>
                But of course, just creating yet another language learning app
                was not enough - there has to be a unique selling point. And
                then I thought to myself: why not make it crazy and do what no
                other language learning app ever did by adding a gazillion
                different color themes and fonts, to really hit it home and
                honor the app's original inspiration, Monkeytype?
              </p>
              <p>
                And so I did. Now, I'm looking to find contributors and testers
                for the early stages of the app.
              </p>
              <p>
                Why? Because weebs and otakus deserve to have a 100% free,
                beautiful, quality language learning app too！
              </p>
              <p>
                For anyone interested, you can check it out at --&gt;
                <a href="https://kanadojo.com">https://kanadojo.com</a> and let
                me know what you think ^ ^
              </p>
            </div>
          </section>
        </section>
        <section id="45152779">
          <h3>
            <a
              class="item"
              href="https://www.righto.com/2025/09/marilou-schultz-navajo-555-weaving.html"
              >A Navajo weaving of an integrated circuit: the 555 timer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 20:57:27</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45152779"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45152648">
          <h3>
            <a
              class="item"
              href="https://gamesbymason.com/blog/2025/stop-shipping-pngs/"
              >Shipping textures as PNGs is suboptimal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 20:37:16</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45152648"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45152569">
          <h3>
            <a
              class="item"
              href="https://www.gatesnotes.com/utahs-hottest-new-power-source-is-below-the-ground"
              >Cape Station, future home of an enhanced geothermal power plant,
              in Utah</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 20:26:13</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45152569"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45152402">
          <h3>
            <a
              class="item"
              href="https://joshs.bearblog.dev/being-good-isnt-enough/"
              >Being good isn't enough</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 20:01:35</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45152402"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45152374">
          <h3>
            <a
              class="item"
              href="https://www.consumer.org.hk/en/press-release/528-sunscreen-test"
              >Over 80% of sunscreen performed below their labelled efficacy
              (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 19:57:59</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45152374"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45152066">
          <h3>
            <a
              class="item"
              href="https://dti.domaintools.com/inside-the-kimsuky-leak-how-the-kim-dump-exposed-north-koreas-credential-theft-playbook/"
              >How the “Kim” dump exposed North Korea's credential theft
              playbook</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 19:14:26</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45152066"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45151622">
          <h3>
            <a
              class="item"
              href="https://hackers.pub/@hongminhee/2025/stop-writing-cli-validation-parse-it-right-the-first-time"
              >Stop writing CLI validation. Parse it right the first time</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 18:20:26</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45151622"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45151598">
          <h3>
            <a
              class="item"
              href="https://www.gigabyte.com/PC-Accessory/AI-TOP-CXL-R5X4"
              >GigaByte CXL memory expansion card with up to 512GB DRAM</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 18:17:06</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45151598"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45149626">
          <h3>
            <a class="item" href="https://avi.im/blag/2025/oldest-txn/"
              >Oldest recorded transaction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 14:34:55</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45149626"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45148944">
          <h3>
            <a
              class="item"
              href="https://bobdahacker.com/blog/rbi-hacked-drive-thrus/"
              >We hacked Burger King: How auth bypass led to drive-thru audio
              surveillance</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 13:04:51</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45148944"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45148237">
          <h3>
            <a
              class="item"
              href="https://github.com/b4rtaz/distributed-llama/discussions/255"
              >Qwen3 30B A3B Hits 13 token/s on 4xRaspberry Pi 5</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 10:59:12</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45148237"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45147385">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/why-language-models-hallucinate/"
              >Why language models hallucinate</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-06 @ 07:41:48</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45147385"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45144610">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/how-the-math-of-shuffling-cards-almost-brought-down-an-online-poker-empire/"
              >The math of shuffling cards almost brought down an online poker
              empire</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-05 @ 22:50:55</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45144610"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45140973">
          <h3>
            <a
              class="item"
              href="http://odb.ar/blog/2025/09/05/hosting-my-blog-on-an-iPad-2.html"
              >What to do with an old iPad</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-05 @ 17:14:16</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45140973"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
            <div class="text">
              Coming back with my own blog (hosted on iPad 2) after asking here
              the same question
            </div>
          </section>
        </section>
        <section id="45124165">
          <h3>
            <a class="item" href="https://pwy.io/posts/kruci-post-mortem/"
              >Kruci: Post-mortem of a UI library</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-04 @ 06:22:20</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45124165"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45122069">
          <h3>
            <a
              class="item"
              href="https://github.com/shriram/anonymous-recursive-function"
              >Anonymous recursive functions in Racket</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-04 @ 00:39:33</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45122069"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45121010">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/08/27/science/biology-trees-microbiomes.html"
              >Like Humans, Every Tree Has Its Own Microbiome, a New Study Has
              Found</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-03 @ 22:21:38</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45121010"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45113181">
          <h3>
            <a class="item" href="https://github.com/rougier/braincraft"
              >Braincraft challenge – 1000 neurons, 100 seconds, 10 runs, 2
              choices, no reward</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-03 @ 07:31:11</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45113181"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45110311">
          <h3>
            <a
              class="item"
              href="https://www.gilesthomas.com/2025/09/maths-for-llms"
              >The maths you need to start understanding LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-02 @ 23:10:47</span
              ><span class="points-container"
                >Points: <span class="points">501</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45110311"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45109927">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20250829-the-bomber-that-became-ww2s-most-expensive-weapon"
              >The World War Two bomber that cost more than the atomic bomb</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-02 @ 22:26:25</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45109927"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
