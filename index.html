<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43351765">
          <h3>
            <a
              class="item"
              href="https://www.ftm.eu/articles/huawei-targeted-in-european-parliament-corruption-probe"
              >Huawei targeted in new European Parliament corruption probe</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 10:04:02</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43351765"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43351271">
          <h3>
            <a
              class="item"
              href="https://www.copetti.org/writings/consoles/game-boy-advance/"
              >Game Boy Advance Architecture – A Practical Analysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 08:25:03</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43351271"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43351137">
          <h3>
            <a
              class="item"
              href="https://forum.cursor.com/t/cursor-told-me-i-should-learn-coding-instead-of-asking-it-to-generate-it-limit-of-800-locs/61132"
              >Cursor told me I should learn coding instead of asking it to
              generate it</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 07:59:55</span
              ><span class="points-container"
                >Points: <span class="points">313</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43351137"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43349426">
          <h3>
            <a class="item" href="https://github.com/learnk8s/xlskubectl"
              >xlskubectl – a spreadsheet to control your Kubernetes cluster</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 01:12:56</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43349426"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43349214">
          <h3>
            <a
              class="item"
              href="https://nanochess.org/transputer_operating_system.html"
              >My teen years: The transputer operating system</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 00:31:47</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43349214"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43348379">
          <h3>
            <a
              class="item"
              href="https://www.tibinotes.com/p/practical-ux-for-startups-surviving"
              >Practical UX for startups surviving without a designer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 22:32:30</span
              ><span class="points-container"
                >Points: <span class="points">236</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43348379"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43347724">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/system/files/1311_05-08_mickens.pdf"
              >The Night Watch (2013) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 21:12:05</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43347724"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43347662">
          <h3>
            <a
              class="item"
              href="https://www.eff.org/deeplinks/2025/03/memoriam-mark-klein-att-whistleblower-about-nsa-mass-spying"
              >Mark Klein, AT&amp;amp;T whistleblower who revealed NSA mass
              spying, has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 21:05:08</span
              ><span class="points-container"
                >Points: <span class="points">1107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43347662"
                  >Comments</a
                ><span class="descendants">: 234</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43347306">
          <h3>
            <a class="item" href="https://www.eggnog.ai/entertimeportal"
              >Show HN: Time Portal – Get dropped into history, guess where you
              landed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 20:23:52</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43347306"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
            <div class="text">
              <p>
                The videos are all created with AI. It’s a pipeline of Flux
                (images), Kling (video), and mmaudio (audio). The videos aren’t
                always historically accurate to the last detail. They might
                incorporate elements of folklore or have details from popular
                beliefs about the way things looked rather than the latest
                academic research on how they looked.
              </p>
              <p>
                I’m thinking a lot about how to make the game more interactive.
                One thing that makes Geoguessr so fun for me is that you can
                move infinitely and always find more details to help you
                pinpoint the location. I want Time Portal to have a similar
                quality. I have a few ideas to try soon that will hopefully make
                the game more interactive and infinite.
              </p>
            </div>
          </section>
        </section>
        <section id="43346816">
          <h3>
            <a
              class="item"
              href="https://www.chiark.greenend.org.uk/~sgtatham/quasiblog/putty-icons/"
              >Iconography of the PuTTY tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 19:29:41</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43346816"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43345285">
          <h3>
            <a
              class="item"
              href="https://wulinshu.com/2025/03/11/reverse-engineering-adventures-3-bug-or-not-bug/"
              >Shenmue (1999) reverse engineering reveals possible sun position
              oversight</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 17:00:28</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43345285"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43344703">
          <h3>
            <a
              class="item"
              href="https://sugaku.net/content/understanding-the-cultural-divide-between-mathematics-and-ai/"
              >The cultural divide between mathematics and AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 16:07:35</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43344703"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43344673">
          <h3>
            <a
              class="item"
              href="https://twitter.com/benswerd/status/1899853533761200300"
              >Reverse engineering OpenAI code execution to make it run C and
              JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 16:04:54</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43344673"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43344082">
          <h3>
            <a
              class="item"
              href="https://deepmind.google/discover/blog/gemini-robotics-brings-ai-into-the-physical-world/"
              >Gemini Robotics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 15:09:09</span
              ><span class="points-container"
                >Points: <span class="points">758</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43344082"
                  >Comments</a
                ><span class="descendants">: 439</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43342712">
          <h3>
            <a class="item" href="https://duckdb.org/2025/03/12/duckdb-ui.html"
              >The DuckDB Local UI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 12:56:01</span
              ><span class="points-container"
                >Points: <span class="points">724</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43342712"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43342361">
          <h3>
            <a class="item" href="https://github.com/kern/filepizza"
              >Peer-to-peer file transfers in the browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 12:08:43</span
              ><span class="points-container"
                >Points: <span class="points">490</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43342361"
                  >Comments</a
                ><span class="descendants">: 216</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43342178">
          <h3>
            <a class="item" href="https://ersei.net/en/blog/niri"
              >The Future Is Niri</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 11:42:16</span
              ><span class="points-container"
                >Points: <span class="points">349</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43342178"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43341481">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/03/12/hardware_os_lockin_monopolies/"
              >Apple has locked me in the same cage Microsoft's built for
              Windows 10 users</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 10:00:37</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43341481"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43340948">
          <h3>
            <a class="item" href="https://mozillapetition.com/"
              >Tell Mozilla: it's time to ditch Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 08:25:36</span
              ><span class="points-container"
                >Points: <span class="points">373</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43340948"
                  >Comments</a
                ><span class="descendants">: 386</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43340731">
          <h3>
            <a
              class="item"
              href="https://www.kmx.io/blog/why-stopped-everything-and-started-writing-C-again"
              >I stopped everything and started writing C again</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 07:38:35</span
              ><span class="points-container"
                >Points: <span class="points">313</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43340731"
                  >Comments</a
                ><span class="descendants">: 316</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43340662">
          <h3>
            <a class="item" href="https://www.nickcraux.com/blog/cursor-tips"
              >I use Cursor daily - here's how I avoid the garbage parts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 07:21:28</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43340662"
                  >Comments</a
                ><span class="descendants">: 204</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43340491">
          <h3>
            <a
              class="item"
              href="https://storage.googleapis.com/deepmind-media/gemma/Gemma3Report.pdf"
              >Gemma 3 Technical Report [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 06:39:17</span
              ><span class="points-container"
                >Points: <span class="points">436</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43340491"
                  >Comments</a
                ><span class="descendants">: 222</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43340196">
          <h3>
            <a
              class="item"
              href="https://soatok.blog/2025/03/12/on-the-insecurity-of-telecom-stacks-in-the-wake-of-salt-typhoon/"
              >The insecurity of telecom stacks in the wake of Salt Typhoon</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 05:21:33</span
              ><span class="points-container"
                >Points: <span class="points">284</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43340196"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43334507">
          <h3>
            <a
              class="item"
              href="https://thecritic.co.uk/the-city-that-forgot-itself/"
              >The city that forgot itself</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-11 @ 16:55:27</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43334507"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43332143">
          <h3>
            <a
              class="item"
              href="https://legacy.cs.indiana.edu/~dyb/papers/3imp.pdf"
              >Three Implementation Models for Scheme (1987) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-11 @ 13:19:29</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43332143"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43325628">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2025/mar/09/internet-shutdowns-record-high-africa-2024-access-weaponised"
              >Internet shutdowns at record high in Africa as access
              'weaponised'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 20:22:59</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43325628"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43315029">
          <h3>
            <a class="item" href="https://obrhubr.org/dithering-in-colour"
              >Dithering in Colour</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 23:28:09</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43315029"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43311082">
          <h3>
            <a
              class="item"
              href="https://now.tufts.edu/2025/03/04/now-theres-open-source-software-modeling-soft-materials"
              >Open source software for modeling soft materials</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 17:03:42</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43311082"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43307751">
          <h3>
            <a class="item" href="https://dynomight.net/noise/"
              >My stupid noise journey (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 10:06:27</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43307751"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43307563">
          <h3>
            <a
              class="item"
              href="https://bluesock.org/~willkg/blog/dev/switch_pyenv_to_uv.html"
              >Switching from Pyenv to Uv</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 09:23:39</span
              ><span class="points-container"
                >Points: <span class="points">278</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43307563"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
