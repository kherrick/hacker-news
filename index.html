<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42529756">
          <h3>
            <a
              class="item"
              href="https://www.worldofreel.com/blog/2024/12/27/netflix-tells-writers-to-have-characters-announce-what-theyre-doing-just-in-case-viewer-is-busy-doing-something-else"
              >Netflix tells writers to have characters "announce what they're
              doing"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 09:32:32</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42529756"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42529564">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/the-nvidia-way"
              >The Nvidia Way â€“ Review of Tae Kim's New Book</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 08:45:18</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42529564"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42529023">
          <h3>
            <a
              class="item"
              href="https://www.ams.org/notices/202501/rnoti-p6.pdf"
              >Machine-Assisted Proof by Terence Tao [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 06:20:38</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42529023"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42528435">
          <h3>
            <a class="item" href="https://mako.cc/writing/hill-free_tools.html"
              >Free Software Needs Free Tools (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 03:58:26</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42528435"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42528302">
          <h3>
            <a class="item" href="https://nytpu.com/gemlog/2024-12-27"
              >Ada's dependent types, and its types as a whole</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 03:22:29</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42528302"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42528216">
          <h3>
            <a
              class="item"
              href="https://forum.level1techs.com/t/bizarre-pcie-trouble-with-4tb-crucial-t500-nvme-ssd/222915"
              >PCIe trouble with 4TB Crucial T500 NVMe SSD for &amp;gt;1 power
              cycle on MSI PRO X670-P</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 03:04:08</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42528216"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42527947">
          <h3>
            <a class="item" href="https://github.com/SpongePowered/Mixin"
              >Mixin is a trait/mixin and bytecode weaving framework for Java
              using ASM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 02:10:48</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42527947"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42527496">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.01332"
              >Explaining Large Language Models Decisions Using Shapley
              Values</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 00:44:18</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42527496"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42527265">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/38c3-liberating-wi-fi-on-the-esp32"
              >Liberating Wi-Fi on the ESP32 [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 00:03:05</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42527265"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42527256">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/38c3-libobscura-cameras-are-difficult"
              >Libobscura: Cameras Are Difficult [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 00:01:39</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42527256"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42526926">
          <h3>
            <a
              class="item"
              href="https://gildas-lormeau.github.io/Polyglot-HTML-ZIP-PNG/SUMMARY.html"
              >How to Create HTML/ZIP/PNG Polyglot Files</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 23:10:54</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42526926"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42526769">
          <h3>
            <a class="item" href="https://github.com/bmtwl/exerciseminimilism"
              >Show HN: Minimal, self-hosted exercise tracker</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 22:45:42</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42526769"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
            <div class="text">
              <p>
                I am now at a place where I simply want the minimal amount of
                structure and tracking to make sure I can maintain my fitness,
                so I boiled the entire concept down to what I felt was its
                essence: enough information and structure to remind you of what
                is needed today, and how it went on the same exercises last
                week.
              </p>
              <p>
                To reduce friction, the interface is kept as simple as possible.
                Simple to the point where all setup is done by editing the html
                source file and there is only one freeform "weight" textbox per
                exercise to manipulate. Data is autosaved as it is entered. It
                never nags or judges you except by showing the last date you
                entered data in for that day-of-the-week's exercises. The only
                quality-of-life feature is a super-simple rest period timer in
                the footer.
              </p>
              <p>
                It has no external dependencies and only uses browser local
                storage. There is no possibility of monetizing it.
              </p>
              <p>
                I was on the fence about sharing since it is such a small and
                simple project, but decided I would share here in case anyone is
                looking to make a fresh start in the new year and finds the
                philosophy appealing.
              </p>
            </div>
          </section>
        </section>
        <section id="42526092">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/38c3-demystifying-common-microcontroller-debug-protocols"
              >Demystifying Common Microcontroller Debug Protocols [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 21:14:14</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42526092"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42526081">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/38c3-breaking-the-mirror-a-look-at-apple-s-new-iphone-remote-control-feature"
              >Breaking the Mirror â€“ A Look at Apple's New iPhone Remote Control
              Feature [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 21:12:57</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42526081"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42525633">
          <h3>
            <a class="item" href="https://www.plasticlist.org/report"
              >Plasticlist Report â€“ Data on plastic chemicals in Bay Area
              foods</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 20:15:44</span
              ><span class="points-container"
                >Points: <span class="points">443</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42525633"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42525384">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/tsmc-arizona"
              >TSMC's Arizona Plant to Start Making Advanced Chips</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 19:43:23</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42525384"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42524848">
          <h3>
            <a class="item" href="https://doodledreams.cc"
              >Show HN: I made a web app to bring children's drawings to life</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 18:50:15</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42524848"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
            <div class="text">
              <p>
                I used to spend hours drawing all kind of things as a kid. Sadly
                though, those drawings are long gone.
              </p>
              <p>
                Inspired by this, I created DoodleDreams. A webapp that brings
                drawings to life using AI and stores them as memories. You can
                always look back at the drawings, see who made them, and even
                know the age they were drawn at.
              </p>
              <p>
                I thought it was a fun way to preserve those memories. What do
                you think?
              </p>
              <p>Viktor</p>
            </div>
          </section>
        </section>
        <section id="42524174">
          <h3>
            <a
              class="item"
              href="https://www.lloydslist.com/LL1151955/Russia-linked-cable-cutting-tanker-seized-by-Finland-was-loaded-with-spying-equipment"
              >Cable-cutting tanker seized by Finland 'was loaded with spying
              equipment'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 17:36:50</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42524174"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42523745">
          <h3>
            <a class="item" href="https://www.lucaiaconistewart.com/model-777"
              >Scale Model of Boeing 777-300ER, Made from Manila Folders</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 16:53:33</span
              ><span class="points-container"
                >Points: <span class="points">471</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42523745"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42523061">
          <h3>
            <a class="item" href="https://bench.co/"
              >Bench accounting services shutting down</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 15:43:09</span
              ><span class="points-container"
                >Points: <span class="points">254</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42523061"
                  >Comments</a
                ><span class="descendants">: 250</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42521629">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/the-paper-passport-is-dying/"
              >The paper passport's days are numbered</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 12:29:13</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42521629"
                  >Comments</a
                ><span class="descendants">: 238</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42515159">
          <h3>
            <a class="item" href="https://taylor.town/flat-scraps-000"
              >Cramming Scrapscript into Msgpack</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 13:55:32</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42515159"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42514105">
          <h3>
            <a
              class="item"
              href="https://www.architecturaldigest.com/story/should-more-of-us-be-moving-to-live-near-friends"
              >Should more of us be moving to live near friends?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 09:23:08</span
              ><span class="points-container"
                >Points: <span class="points">376</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42514105"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42513204">
          <h3>
            <a class="item" href="https://www.theibns.org/joomla/index.php"
              >International Bank Note Society</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 04:54:20</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42513204"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42511211">
          <h3>
            <a
              class="item"
              href="https://www.cell.com/cell/fulltext/S0092-8674(16)31310-1"
              >Progressive Loss of Function in a Limb Enhancer During Snake
              Evolution (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 21:16:22</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42511211"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42507145">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20241224-00/?p=110675"
              >A design flaw in the Windows 3D Pipes screen saver pointed out by
              a customer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 05:51:35</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42507145"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42506984">
          <h3>
            <a
              class="item"
              href="https://fhur.me/posts/2024/thats-not-an-abstraction"
              >That's not an abstraction, that's a layer of indirection</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 05:06:58</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42506984"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42506623">
          <h3>
            <a
              class="item"
              href="https://monoli-shop.com/products/pixlens-ã‚³ãƒ”ãƒ¼"
              >PixLens: A lens that turns the scenery you see into pixel art</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 03:23:55</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42506623"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42498754">
          <h3>
            <a class="item" href="https://issung.com/posts/lanphotosarchive/"
              >1584 LAN party photos from 1996 â€“ 2010 from Australia's island
              state archived</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 00:40:30</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42498754"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42482805">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=xLaLpMeOyHk"
              >The hydraulic systems of the Alhambra Palace [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-21 @ 22:22:27</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42482805"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
