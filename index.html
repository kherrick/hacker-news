<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40012712">
          <h3>
            <a
              class="item"
              href="https://security.paloaltonetworks.com/CVE-2024-3400"
              >Unauthenticated, RCE vulnerability in Palo Alto firewalls,
              exploits in the wild</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 13:38:46</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40012712"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40012446">
          <h3>
            <a
              class="item"
              href="https://neurosciencenews.com/childhood-loneliness-psychosis-25891/"
              >Childhood Loneliness Linked to Later Psychosis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 13:22:30</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40012446"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40012374">
          <h3>
            <a
              class="item"
              href="https://jvns.ca/blog/2024/04/10/notes-on-git-error-messages/"
              >Notes on Git's Error Messages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 13:18:07</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40012374"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40011490">
          <h3>
            <a class="item" href="https://github.com/mjackson/unpkg/issues/384"
              >Unpkg CDN down causing dependent website outages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 11:49:11</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40011490"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40011464">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/tech/china-telecom-intel-amd-chips-99ae99a9"
              >China Tells Telecom Carriers to Phase Out Foreign Chips in Blow
              to Intel, AMD</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 11:45:24</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40011464"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40011438">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2024/04/researchers-find-a-new-organelle-evolving/"
              >Researchers find a new organelle evolving</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 11:40:52</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40011438"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40011250">
          <h3>
            <a class="item" href="https://github.com/ad-si/tu"
              >Show HN: tu â€“ Convert natural language date/time to UTC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 11:04:04</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40011250"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40011111">
          <h3>
            <a
              class="item"
              href="https://www.jvt.me/posts/2024/04/12/use-renovate/"
              >Why I recommend Renovate over any other dependency update
              tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 10:35:48</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40011111"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40010991">
          <h3>
            <a class="item" href="https://devenv.sh/"
              >Fast, Declarative, Reproduble and Composable Developer
              Environments Using Nix</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 10:08:23</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40010991"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40010819">
          <h3>
            <a
              class="item"
              href="https://github.com/tinygrad/open-gpu-kernel-modules"
              >Tinygrad: Hacked 4090 driver to enable P2P</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 09:27:58</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40010819"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40010615">
          <h3>
            <a class="item" href="https://heatpumpmonitor.org/"
              >An open source initiative to share and compare heat pump
              performance data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 08:53:16</span
              ><span class="points-container"
                >Points: <span class="points">368</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40010615"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40010579">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/04/09/h1b_visa_fraud/"
              >H-1B visa fraud alive and well amid anti-abuse efforts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 08:47:48</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40010579"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40010559">
          <h3>
            <a
              class="item"
              href="http://mathtourist.blogspot.com/2009/02/pondering-artists-perplexing-tribute-to.html"
              >Pondering an Artist's Perplexing Tribute to the Pythagorean
              Theorem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 08:44:22</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40010559"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40010221">
          <h3>
            <a
              class="item"
              href="https://spacetelescopelive.org/webb?obsId=01HTJT20C0STKNZ01KQYGEKBQ1"
              >Webb â€“ Space Telescope Live. What Is Webb Observing Now?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 07:29:17</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40010221"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40010066">
          <h3>
            <a
              class="item"
              href="https://mathstodon.xyz/@two_star/112242224494626411"
              >"Here's a puzzle game. I call it Reverse the List of
              Integers."</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 06:59:35</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40010066"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40009997">
          <h3>
            <a
              class="item"
              href="https://contrapunctus.codeberg.page/blog/mapping-party-tips.html"
              >Organizing OpenStreetMap Mapping Parties</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 06:46:07</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40009997"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40009856">
          <h3>
            <a
              class="item"
              href="https://www.ianvisits.co.uk/articles/theres-a-dead-rabbit-in-seven-sisters-tube-station-71502/"
              >Thereâ€™s a 30-year old dead Rabbit in Seven Sisters tube
              station</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 06:14:55</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40009856"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40008934">
          <h3>
            <a
              class="item"
              href="https://nithinbekal.com/posts/abstract-methods-notimplementederror-ruby/"
              >Abstract Methods and NotImplementedError in Ruby</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 02:44:58</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40008934"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40008841">
          <h3>
            <a
              class="item"
              href="https://www.polarsparc.com/xhtml/Containers-1.html"
              >Building a Linux Container Using Namespaces: Part â€“ 1 (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 02:22:25</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40008841"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40008755">
          <h3>
            <a class="item" href="https://github.com/mhx/dwarfs"
              >DwarFS â€“ Deduplicating Warp-Speed Advanced Read-Only File
              System</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 02:04:54</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40008755"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40008383">
          <h3>
            <a
              class="item"
              href="https://github.com/aaronjanse/dns-over-wikipedia"
              >DNS over Wikipedia</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-12 @ 00:52:10</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40008383"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40003710">
          <h3>
            <a
              class="item"
              href="https://paulbupejr.com/developing-the-optigap-sensor-system/"
              >Show HN: I made a new sensor out of 3D printer filament for my
              PhD</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 16:06:03</span
              ><span class="points-container"
                >Points: <span class="points">770</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40003710"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been on HN for a while now and I've seen my fair share of
                posts about the woes of pursuing a PhD. Now that I'm done with
                mine I wanna share some anecdotal evidence that doing a PhD can
                actually be enjoyable (not necessarily easy) and also be doable
                in 3 years.
              </p>
              <p>
                When I started I knew I didn't want to work on something that
                would never leave the lab or languish in a dissertation PDF no
                one will ever read. Thanks to an awesome advisor I think I
                managed to thread the needle between simplicity and
                functionality.
              </p>
              <p>
                Looking back, the ideas and methods behind it are pretty
                straightforward, but getting there took some doing. Itâ€™s funny
                how things seem obvious once you've figured them out!
              </p>
              <p>
                Oh, I love creating GUIs for sensor data and visualizations as
                you'll see -- it's such a game changer! pyqtgraph is my go-to at
                the moment - such a great library.
              </p>
            </div>
          </section>
        </section>
        <section id="39999530">
          <h3>
            <a
              class="item"
              href="https://www.labrujulaverde.com/en/2024/04/an-unusual-prehistoric-monument-made-up-of-three-interlocking-circles-a-typology-never-seen-before-discovered-in-france/"
              >An Unusual Prehistoric Monument Made Up of Three Interlocking
              Circles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 08:00:23</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39999530"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39998446">
          <h3>
            <a
              class="item"
              href="https://samuele963.github.io/electrics/index.html"
              >The Electrical Items Collection</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 04:41:41</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39998446"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39998396">
          <h3>
            <a class="item" href="https://eprint.iacr.org/2024/555"
              >Quantum Algorithms for Lattice Problems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 04:32:15</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39998396"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39998359">
          <h3>
            <a class="item" href="https://roosterking.drewschorno.com/"
              >Rooster King: A multimedia zine website collage album memoir
              thing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 04:25:13</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39998359"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39998277">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39998277"
              >Ask HN: Where are all the touch-based art forms?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-11 @ 04:03:59</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39998277"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
            <div class="text">
              <p>
                For vision, our most dominant sense, there is literature,
                painting, sculpture and film.
              </p>
              <p>For hearing there is music.</p>
              <p>For smell there is perfumery.</p>
              <p>For taste there are the culinary arts.</p>
              <p>
                Touch seems like the odd one out - it's playing second fiddle to
                taste in food, and to appearance in sculpture and clothing. You
                only very rarely find some artwork where the main draw is the
                tactile experience. Why is this?
              </p>
            </div>
          </section>
        </section>
        <section id="39988718">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/forever-chemicals-pfas-pollution-epa-drinking-water-1c8804288413a73bb7b99fc866c8fa51"
              >U.S. imposes first-ever national drinking water limits on PFAS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 09:31:10</span
              ><span class="points-container"
                >Points: <span class="points">547</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39988718"
                  >Comments</a
                ><span class="descendants">: 356</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39988298">
          <h3>
            <a
              class="item"
              href="https://burakku.com/blog/rye-test-and-python-tools/"
              >Trying Out Rye</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-10 @ 08:25:23</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39988298"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39984757">
          <h3>
            <a class="item" href="https://ingino.me/ideas/on-dependencies/"
              >Dependencies and resilience</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 21:59:42</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39984757"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
