<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41876821">
          <h3>
            <a
              class="item"
              href="https://community.wolfram.com/groups/-/m/t/1793319"
              >Factorio â€“ Visualizing construction material dependencies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-18 @ 06:25:34</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41876821"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41876723">
          <h3>
            <a
              class="item"
              href="https://cacm.acm.org/opinion/what-is-theoretical-computer-science/"
              >What Is Theoretical Computer Science?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-18 @ 06:04:17</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41876723"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41875792">
          <h3>
            <a class="item" href="https://lwn.net/Articles/992055/"
              >Smart pointers for the kernel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-18 @ 02:10:09</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41875792"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41875358">
          <h3>
            <a
              class="item"
              href="https://gitlab.com/mebassett/quixotic-learning/-/tree/master"
              >Show HN: I wrote an autodiff in C++ and implemented LeNet with
              it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-18 @ 00:52:04</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41875358"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41875152">
          <h3>
            <a
              class="item"
              href="https://www.flexport.com/blog/dhl-bills-of-lading/"
              >DHL pioneered the sharing economy (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-18 @ 00:15:56</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41875152"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41875108">
          <h3>
            <a class="item" href="https://tilde.town/~dozens/sofa/"
              >SOFA - Start Often Finish rArely</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-18 @ 00:07:46</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41875108"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41874394">
          <h3>
            <a
              class="item"
              href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2024/p3477r0.html"
              >C++ proposal: There are exactly 8 bits in a byte</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 22:21:15</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41874394"
                  >Comments</a
                ><span class="descendants">: 226</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41874275">
          <h3>
            <a
              class="item"
              href="https://www.sjsu.edu/faculty/watkins/5thgen.htm"
              >The Fifth Generation Project in Japan (1992)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 22:03:01</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41874275"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41873957">
          <h3>
            <a
              class="item"
              href="https://neon.tech/blog/why-does-everyone-run-ancient-postgres-versions"
              >Why does everyone run ancient Postgres versions?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 21:23:29</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41873957"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41872813">
          <h3>
            <a
              class="item"
              href="https://github.com/google-deepmind/searchless_chess"
              >Grandmaster-level chess without search</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 19:13:20</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41872813"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871812">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/science-and-technology/2024/10/16/tubeworms-live-beneath-the-planetary-crust-around-deep-sea-vents"
              >Tubeworms live around deep-sea vents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 17:41:38</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871812"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871729">
          <h3>
            <a
              class="item"
              href="https://mathenchant.wordpress.com/2024/10/17/industrious-dice/"
              >Industrious Dice</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 17:32:40</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871729"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871629">
          <h3>
            <a
              class="item"
              href="https://www.thecoder.cafe/p/unit-tests-as-documentation"
              >Unit tests as documentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 17:22:45</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871629"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871375">
          <h3>
            <a class="item" href="https://pudding.cool/2024/10/crokinole/"
              >Crokinole</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 16:54:49</span
              ><span class="points-container"
                >Points: <span class="points">470</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871375"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871262">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/ai/notebooklm-update-october-2024/"
              >NotebookLM launches feature to customize and guide audio
              overviews</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 16:42:04</span
              ><span class="points-container"
                >Points: <span class="points">265</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871262"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871068">
          <h3>
            <a
              class="item"
              href="https://www.crunchydata.com/blog/pg_parquet-an-extension-to-connect-postgres-and-parquet"
              >Pg_parquet: An extension to connect Postgres and parquet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 16:18:32</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871068"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41870887">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41870887"
              >I'm Peter Roberts, immigration attorney who does work for YC and
              startups. AMA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 16:01:16</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41870887"
                  >Comments</a
                ><span class="descendants">: 275</span></span
              >
            </h4>
            <div class="text">
              <p>
                Previous threads we've done:
                https://news.ycombinator.com/submitted?id=proberts.
              </p>
            </div>
          </section>
        </section>
        <section id="41869460">
          <h3>
            <a
              class="item"
              href="https://gitlab.com/lockie/cl-fast-ecs/-/wikis/tutorial-2"
              >Gamedev in Lisp. Part 2: Dungeons and Interfaces</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 13:26:25</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41869460"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41868683">
          <h3>
            <a
              class="item"
              href="https://www.cell.com/iscience/fulltext/S2589-0042(24)02024-8"
              >Cats are (almost) liquid</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 11:43:00</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41868683"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41859037">
          <h3>
            <a class="item" href="https://unsloth.ai/blog/gradient"
              >Bugs in LLM Training â€“ Gradient Accumulation Fix</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 13:51:00</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41859037"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41855403">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41855403"
              >Ask HN: Tips for Hacking a TV?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 03:44:35</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41855403"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                Any tips and pointers would be much appreciated, in terms of
                common ways to search for and exploit vulnerabilities, or the
                exploitation of other televisions. Alternatively, if this is an
                absolute fool's errand, and the whole thing is locked down
                tighter than Fort Knox, a firm warning that this is not a good
                thing to dick around with over a weekend would also be
                appreciated.
              </p>
            </div>
          </section>
        </section>
        <section id="41853942">
          <h3>
            <a
              class="item"
              href="https://mcejp.github.io/2024/10/16/gba-raycasting.html"
              >How I failed to make a game: Raycasting on the GBA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 22:53:35</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41853942"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41847953">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41847953"
              >Tell HN: DigitalRiver/MyCommerce stopped paying vendors since
              July</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 12:40:21</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41847953"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <p>
                For those who don't know MyCommerce is a platform for selling
                software online. They're merchant of record, they handle taxes,
                generate license keys, etc so they're a bit higher level than
                Stripe or PayPal. We're with them since 2005. Things started
                going south in August. July payment was due on August 15 but
                never came. Few days afterwards they sent and email that they're
                changing contract terms and that payments will now be sent 60
                days instead of 15 days after the month. Sadly, I didn't switch
                to another payment processor immediately that day - accountants
                were on holiday, we were investigating our options, and we were
                generally happy for 20 years with them. We switched only in
                September, where they worsened contract terms even more,
                introducing monthly fee, hourly fee for support, increased
                payment thresholds, etc. By the time we switched, MyCommerce
                already sat on entire revenue from July, August, and half of
                September. Their support is not helpful.
              </p>
              <p>
                This is not only about us, it's about myriad other vendors,
                mostly small ones. Unfortunately, we didn't have online space to
                share our findings and experiences. I only found today that it
                was discussed on kvraudio forum, and a bit on LinkedIn. There
                are many small vendors who are now in a hole for tens of
                thousands of dollars/euros.
              </p>
              <p>
                It looks pretty much that MyCommerce / DigitarRiver Gmbh are in
                financial trouble. There are news of layoffs and new management.
                It's questionable whether we'll see any of our money and when.
                But the troubling part is MyCommerce still operates and takes
                orders. If there are vendors who still only know about what
                MyCommerce officially told them and wait for delayed payments -
                please reconsider your position.
              </p>
              <p>
                <a href="https://www.kvraudio.com/forum/viewtopic.php?t=612462"
                  >https://www.kvraudio.com/forum/viewtopic.php?t=612462</a
                >
              </p>
              <p>
                <a
                  href="https://www.kvraudio.com/forum/viewtopic.php?t=614929&amp;start=30"
                  >https://www.kvraudio.com/forum/viewtopic.php?t=614929&amp;start=...</a
                >
              </p>
              <p>
                <a
                  href="https://www.linkedin.com/posts/lorant-barla_mycommerce-digitalriver-contracts-activity-7244193845607878657-iS4S/"
                  >https://www.linkedin.com/posts/lorant-barla_mycommerce-digit...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41847587">
          <h3>
            <a class="item" href="https://www.gomponents.com"
              >Show HN: Gomponents, HTML components in pure Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 11:56:44</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41847587"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
            <div class="text">
              Hey everyone! I just released v1.0.0 of gomponents last week. It's
              an HTML component builder in pure Go, with a DSL-like HTML syntax.
              It's been 4 years in the making, and makes it really easy to build
              HTML in your web apps.
            </div>
          </section>
        </section>
        <section id="41847149">
          <h3>
            <a class="item" href="https://hackertyper.net">Hacker Typer</a>
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 10:41:33</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41847149"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41846693">
          <h3>
            <a
              class="item"
              href="https://github.com/EtherDream/media-popup-player"
              >Watch YouTube videos on the album artwork of Windows music
              control bar</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 09:29:35</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41846693"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41835784">
          <h3>
            <a class="item" href="https://boston.conman.org/2024/10/13.1"
              >A benchmark of three different floating point packages for the
              6809</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-14 @ 09:25:14</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41835784"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41831948">
          <h3>
            <a class="item" href="https://github.com/eivindbohler/itxllama"
              >ITX-Llama (Vortex86EX ITX Motherboard)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-13 @ 21:47:46</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41831948"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41831735">
          <h3>
            <a
              class="item"
              href="https://shchegrikovich.substack.com/p/use-prolog-to-improve-llms-reasoning"
              >Use Prolog to improve LLM's reasoning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-13 @ 21:22:48</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41831735"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41830699">
          <h3>
            <a
              class="item"
              href="https://inkscape.org/news/2024/10/13/inkscape-launches-version-14-powerful-new-accessib/"
              >Inkscape 1.4 Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-13 @ 19:14:30</span
              ><span class="points-container"
                >Points: <span class="points">322</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41830699"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
