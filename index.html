<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38445122">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/treble-ai/jobs/tL8GeWc-staff-product-engineer"
              >Treble.ai (YC S19) Is Hiring Spainish Speaking Engineers in
              NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 12:51:02</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38445022">
          <h3>
            <a
              class="item"
              href="https://blog.metaphysic.ai/badly-compressed-images-affect-clips-performance-new-research-contends/"
              >Badly-Compressed Images Affect CLIP's Performance, New Research
              Contends</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 12:35:27</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38445022"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38445020">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/11/28/microsoft_opens_sources_threadx/"
              >Microsoft opens sources ThreadX RTOS used in Raspberry Pis</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 12:35:20</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38445020"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38444834">
          <h3>
            <a
              class="item"
              href="https://github.com/federico-busato/Modern-CPP-Programming"
              >Modern C++ Programming Course</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 12:03:04</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38444834"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38444719">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=TbZ3HzvFEto"
              >Half Life:25th Anniversary Documentary</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 11:40:37</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38444719"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38444606">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/court-cloudflare-is-liable-for-pirate-site-but-not-as-a-dns-provider-231127/"
              >Court: Cloudflare Is Liable for Pirate Site, but Not as a DNS
              Provider</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 11:18:08</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38444606"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38443855">
          <h3>
            <a
              class="item"
              href="https://framablog.org/2023/11/28/peertube-v6-is-out-and-powered-by-your-ideas/"
              >PeerTube v6 is out, and powered by your ideas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 09:07:13</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38443855"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38443668">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38443668"
              >Ask HN: Is Knuth's TAOCP worth the time and effort?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 08:40:19</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38443668"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
            <div class="text">
              <p>
                I showed it to a friend who is quite good at math, and he told
                me the book may be trying too hard especially in the examples
                variety, and how it might not be needed for comprehension's
                sake.
              </p>
              <p>
                Would you still recommend this book, and if yes, in what
                circumstances?
              </p>
            </div>
          </section>
        </section>
        <section id="38443399">
          <h3>
            <a
              class="item"
              href="https://daily.jstor.org/the-hunt-for-life-in-alpha-centauri/"
              >The Hunt for Life in Alpha Centauri</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 07:44:00</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38443399"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38443253">
          <h3>
            <a class="item" href="https://mcyoung.xyz/2023/11/27/simd-base64/"
              >Designing a SIMD Algorithm from Scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 07:12:23</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38443253"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38442779">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2311.01906"
              >Simplifying Transformer Blocks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 05:49:10</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38442779"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38442133">
          <h3>
            <a
              class="item"
              href="http://rachelbythebay.com/w/2023/11/27/sitefinder/"
              >That time Verisign typo-squatted all of .com and .net</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 03:53:58</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38442133"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38441747">
          <h3>
            <a
              class="item"
              href="https://chriscoyier.net/2023/11/27/the-hanging-punctuation-property-in-css/"
              >The `hanging-punctuation property` in CSS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 02:58:41</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38441747"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38441643">
          <h3>
            <a class="item" href="https://github.com/breadbored/N64-RPG"
              >RPG Engine for the Nintendo 64</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 02:43:11</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38441643"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38441139">
          <h3>
            <a class="item" href="https://kagi.com/orion/"
              >Orion Browser by Kagi</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 01:33:07</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38441139"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38440779">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/an-invasive-tick-that-can-clone-itself-is-spreading-across-us-threatening-livestock-180983323/"
              >An Invasive Tick That Can Clone Itself Is Spreading Across the
              U.S.</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 00:44:33</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38440779"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38438261">
          <h3>
            <a
              class="item"
              href="https://www.astralcodexten.com/p/god-help-us-lets-try-to-understand"
              >Let's try to understand AI monosemanticity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-27 @ 21:04:46</span
              ><span class="points-container"
                >Points: <span class="points">296</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38438261"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38438000">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/cheaper-microscope-could-bring-protein-mapping-technique-masses"
              >Cheaper microscope could bring protein mapping technique to the
              masses</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-27 @ 20:45:18</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38438000"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38435908">
          <h3>
            <a
              class="item"
              href="https://jacobbartlett.substack.com/p/my-toddler-loves-planes-so-i-built"
              >My toddler loves planes, so I built her a radar</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-27 @ 18:16:07</span
              ><span class="points-container"
                >Points: <span class="points">1110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38435908"
                  >Comments</a
                ><span class="descendants">: 216</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38432486">
          <h3>
            <a class="item" href="https://dalle.party/"
              >Show HN: A Dalle-3 and GPT4-Vision feedback loop</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-27 @ 14:18:24</span
              ><span class="points-container"
                >Points: <span class="points">482</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38432486"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
            <div class="text">
              <p>
                You need to bring your own OpenAI API key (costs about
                $0.10/run)
              </p>
              <p>
                Some prompts are very stable, others go wild. If you bias GPT4's
                prompting by telling it to "make it weird" you can get crazy
                results.
              </p>
              <p>Here's a few of my favorites:</p>
              <p>
                - Gnomes:
                <a href="https://dalle.party/?party=k4eeMQ6I"
                  >https://dalle.party/?party=k4eeMQ6I</a
                >
              </p>
              <p>
                - Start with a sailboat but bias GPT4V to "replace everything
                with cats":
                <a href="https://dalle.party/?party=0uKfJjQn"
                  >https://dalle.party/?party=0uKfJjQn</a
                >
              </p>
              <p>
                - A more stable one (but everyone is always an actor):
                <a href="https://dalle.party/?party=oxpeZKh5"
                  >https://dalle.party/?party=oxpeZKh5</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="38429697">
          <h3>
            <a
              class="item"
              href="https://mostlynerdless.de/blog/2023/11/27/custom-events-in-the-blocky-world-using-jfr-in-minecraft/"
              >Custom Events in the Blocky World: Using JFR in Minecraft</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-27 @ 08:37:02</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38429697"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38429278">
          <h3>
            <a
              class="item"
              href="https://arangodb.com/2021/02/cpp-memory-model-migrating-from-x86-to-arm/"
              >C++ Memory Model: Migrating from x86 to ARM (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-27 @ 07:41:01</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38429278"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38429055">
          <h3>
            <a
              class="item"
              href="https://tomverbeure.github.io/2023/11/26/Monoprice-Blackbird-4K-Pro-HDCP-Converter.html"
              >Analyzing the Monoprice Blackbird HDCP 2.2 to 1.4 Down
              Converter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-27 @ 06:54:29</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38429055"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38428713">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/arts-culture/books/nuts-bolts-review-the-levers-that-move-the-world-f117a196"
              >'Nuts and Bolts' Review: The Levers That Move the World</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-27 @ 06:02:03</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38428713"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38414677">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/archive/visual-effects-model-design/zdmgnrd"
              >Visual effects model design [video] (1980)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-25 @ 16:58:39</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38414677"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38414380">
          <h3>
            <a
              class="item"
              href="https://www.aanda.org/articles/aa/pdf/2023/10/aa45927-23.pdf"
              >Large Interferometer for Exoplanets [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-25 @ 16:11:15</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38414380"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38413509">
          <h3>
            <a
              class="item"
              href="https://blogs.loc.gov/law/2017/08/regulating-the-rag-and-bone-man/"
              >Regulating the Rag and Bone Man (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-25 @ 13:53:04</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38413509"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38412138">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=dmPgTDs9FRo"
              >Heron's Horse [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-25 @ 08:29:22</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38412138"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38411975">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=Mdh2pLwsK8Y"
              >Optical Computing with Plasma [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-25 @ 07:42:13</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38411975"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38409523">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/full/10.1126/sciadv.adh8499"
              >Intentional creation of carbon-rich dark earth soils in the
              Amazon</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-24 @ 23:26:35</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38409523"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
