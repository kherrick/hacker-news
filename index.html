<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44054024">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/collection/chinese-fishes/"
              >Gilded Fish: Illustrations of Histoire naturelle des dorades de
              la Chine c.1780</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 17:40:29</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44054024"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44053744">
          <h3>
            <a class="item" href="https://jngiam.bearblog.dev/mcp-large-data/"
              >LLM function calls don't scale; code orchestration is simpler,
              more effective</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 17:18:52</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44053744"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44053603">
          <h3>
            <a class="item" href="https://webcomponents.shopify.dev/"
              >Storefront Web Components</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 17:08:58</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44053603"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44053560">
          <h3>
            <a
              class="item"
              href="https://mattweidner.com/2025/05/21/text-without-crdts.html"
              >Collaborative Text Editing Without CRDTs or OT</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 17:05:45</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44053560"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44053518">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2025-05-21/openai-to-buy-apple-veteran-jony-ive-s-ai-device-startup-in-6-5-billion-deal"
              >OpenAI to buy AI startup from Jony Ive</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 17:01:35</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44053518"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44053506">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/harper/jobs"
              >Harper (YC W25) Is Hiring Applied AI / AI Context Engineers and
              Data Scientist</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 17:00:50</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44053328">
          <h3>
            <a
              class="item"
              href="https://www.wheresyoured.at/the-era-of-the-business-idiot/"
              >The Era of the Business Idiot</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 16:43:19</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44053328"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44053119">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44053119"
              >Ask HN: How to Make Friendster Great?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 16:21:46</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44053119"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'd like it to be about connecting with and making new real
                friends. I'd like it to be positive and do something positive
                for people. I don't want it to have the addictive behaviors and
                negativity that are prevalent in current social networks.
              </p>
              <p>It is currently self-funded.</p>
            </div>
          </section>
        </section>
        <section id="44052984">
          <h3>
            <a
              class="item"
              href="https://ai.meta.com/blog/llama-startup-program/?_fb_noscript=1"
              >Introducing the Llama Startup Program</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 16:10:06</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44052984"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44052909">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/why-mitochondria-are-more-like-a-motherboard-than-the-powerhouse-of-the-cell/"
              >Mitochondria Are More Than Powerhouses–They're the Motherboard of
              the Cell</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 16:03:36</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44052909"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44052766">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44052766"
              >Launch HN: SIM Studio (YC X25) – Figma-Like Canvas for Agent
              Workflows</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 15:49:15</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44052766"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
            <div class="text">
              <a href="https://simstudio.ai">https://simstudio.ai</a>). We did a
              Show HN a few weeks ago about our open-source project (<a
                href="https://news.ycombinator.com/item?id=43823096"
                >https://news.ycombinator.com/item?id=43823096</a
              >). Today, we’re launching our hosted platform—a collaborative
              interface to build and deploy agent workflows. We just removed the
              waitlist (with 5,000+ people) and you can sign up and access it
              at: <a href="https://simstudio.ai">https://simstudio.ai</a>
              <p>
                Sim Studio lets you build agents with different models, tools,
                and custom functions. In minutes, you can deploy a research
                agent. Demo here -
                <a href="https://youtu.be/F6MqNvnfxbI"
                  >https://youtu.be/F6MqNvnfxbI</a
                >
              </p>
              <p>
                We started working on Sim Studio because we were frustrated with
                agent frameworks that required excessive boilerplate code and
                unhelpful abstractions (like agent roles and backstories). We
                also tried other visual interfaces, but found them difficult to
                set up and too limited for production use cases. Specifically,
                we wanted the ability to write custom functions, force tool
                calls, and run parallel execution.
              </p>
              <p>
                We’re taking a different approach. Our visual canvas lets you
                explicitly define how agents interact, use external tools, and
                handle complex logic like branching, loops, and conditional
                execution. You can seamlessly integrate with popular tools like
                Supabase, Pinecone, Mem0, and Exa without obscure abstractions.
              </p>
              <p>
                You can simulate workflow runs, deploy workflows as APIs or
                standalone chat interfaces, and trigger them via webhooks. We
                offer built-in observability, detailed trace spans, and logs
                that make debugging straightforward. Try searching yourself
                below:
              </p>
              <p>
                Example message for
                <a href="https://hn.simstudio.ai">https://hn.simstudio.ai</a>:
              </p>
              <p>
                - Search [person] from [company] - "Search Emir Karabeg from Sim
                Studio"
              </p>
              <p>
                Check out our Apache 2.0 licensed repo at
                <a href="https://github.com/simstudioai/sim"
                  >https://github.com/simstudioai/sim</a
                >, explore our docs at
                <a href="https://docs.simstudio.ai">https://docs.simstudio.ai</a
                >, or try out our deployed chat from the demo video here:
                <a href="https://hn.simstudio.ai">https://hn.simstudio.ai</a>.
              </p>
              <p>
                We’d love to hear your feedback! Do you think our visual
                solution is a good approach to building agents?
              </p>
            </div>
          </section>
        </section>
        <section id="44052738">
          <h3>
            <a class="item" href="https://github.com/BlackMATov/evolved.lua"
              >Show HN: Evolved.lua – An Evolved Entity Component System for
              Lua</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 15:46:45</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44052738"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                evolved.lua is a fast and flexible ECS (Entity-Component-System)
                library for Lua. It is designed to be simple and easy to use,
                while providing all the features needed to create complex
                systems with blazing performance.
              </p>
              <p>Enjoy!</p>
            </div>
          </section>
        </section>
        <section id="44052424">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/new-tools-and-features-in-the-responses-api"
              >New tools and features in the Responses API</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 15:17:38</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44052424"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44052418">
          <h3>
            <a
              class="item"
              href="https://news.engin.umich.edu/2025/05/the-us-has-a-new-most-powerful-laser/"
              >The US has a new most powerful laser hitting 2 petawatts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 15:17:10</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44052418"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44052106">
          <h3>
            <a class="item" href="https://github.com/lune-org/lune"
              >Lune: Standalone Luau Runtime</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 14:51:38</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44052106"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44052041">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2502.00627"
              >Discord Unveiled: A Comprehensive Dataset of Public Communication
              (2015-2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 14:45:38</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44052041"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44052010">
          <h3>
            <a class="item" href="https://trendlyai.com/"
              >Show HN: Trendly AI – Trend detection across 42 languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 14:43:09</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44052010"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44051958">
          <h3>
            <a
              class="item"
              href="http://www.datapointed.net/visualizations/math/factorization/animated-diagrams/"
              >Animated Factorization</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 14:39:37</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44051958"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44051733">
          <h3>
            <a class="item" href="https://mistral.ai/news/devstral">Devstral</a>
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 14:21:10</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44051733"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44051652">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/turbocharged-mitochondria-power-birds-epic-migratory-journeys-20250519/"
              >'Turbocharged' Mitochondria Power Birds' Epic Migratory
              Journeys</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 14:11:33</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44051652"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44048775">
          <h3>
            <a class="item" href="https://iment.com/maida/computer/redref/"
              >Overview of the Ada Computer Language Competition (1979)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 06:18:55</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44048775"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44048420">
          <h3>
            <a
              class="item"
              href="https://www.commonwealmagazine.org/goethe-mitchell-wilson-faust-johann-biography"
              >Goethe's Faustian Life</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 04:56:44</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44048420"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44048306">
          <h3>
            <a
              class="item"
              href="https://eli.thegreenplace.net/2025/convolutions-polynomials-and-flipped-kernels/"
              >Convolutions, Polynomials and Flipped Kernels</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 04:35:21</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44048306"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44046578">
          <h3>
            <a
              class="item"
              href="https://neuecc.medium.com/zlinq-a-zero-allocation-linq-library-for-net-1bb0a3e5c749"
              >“ZLinq”, a Zero-Allocation LINQ Library for .NET</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-20 @ 22:29:12</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44046578"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44045292">
          <h3>
            <a class="item" href="https://fly.io/blog/litestream-revamped/"
              >Litestream: Revamped</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-20 @ 19:58:27</span
              ><span class="points-container"
                >Points: <span class="points">412</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44045292"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44044199">
          <h3>
            <a
              class="item"
              href="https://developers.googleblog.com/en/introducing-gemma-3n/"
              >Gemma 3n preview: Mobile-first AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-20 @ 18:03:32</span
              ><span class="points-container"
                >Points: <span class="points">416</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44044199"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44044043">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/ai/generative-media-models-io-2025/"
              >Veo 3 and Imagen 4, and a new tool for filmmaking called Flow</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-20 @ 17:46:36</span
              ><span class="points-container"
                >Points: <span class="points">760</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44044043"
                  >Comments</a
                ><span class="descendants">: 475</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44027424">
          <h3>
            <a
              class="item"
              href="https://johnnysswlab.com/link-time-optimizations-new-way-to-do-compiler-optimizations/"
              >Link Time Optimizations: New Way to Do Compiler Optimizations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-19 @ 07:48:22</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44027424"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44023400">
          <h3>
            <a
              class="item"
              href="https://blog.awaxman.com/what-is-the-difference-between-a-block-a-proc-and-a-lambda-in-ruby"
              >What Is the Difference Between a Block, a Proc, and a Lambda in
              Ruby? (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 18:34:12</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44023400"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44023226">
          <h3>
            <a
              class="item"
              href="https://medium.com/@joe_5312/pg-e-sucks-or-how-i-learned-to-stop-worrying-and-love-building-my-own-solar-system-acf0c9f03f3b"
              >Building my own solar power system</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 18:07:03</span
              ><span class="points-container"
                >Points: <span class="points">332</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44023226"
                  >Comments</a
                ><span class="descendants">: 254</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
