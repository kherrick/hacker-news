<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37071472">
          <h3>
            <a class="item" href="https://thewalrus.ca/medical-tiktok/"
              >Doctors on TikTok: The Dark Side of Medical Influencers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 03:10:01</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37071472"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37071300">
          <h3>
            <a
              class="item"
              href="https://wiki.makerdiary.com/nrf52840-mdk-usb-dongle/guides/ble-sniffer/"
              >Make a low-cost Bluetooth LE packet sniffer with Wireshark</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 02:45:03</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37071300"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37071220">
          <h3>
            <a class="item" href="https://bubblic.co/"
              >Show HN: Bubblic – end loneliness together using the power of
              your voice</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 02:31:32</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37071220"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              <p>
                We take privacy seriously, so all data are anonymized and are
                not sold to anyone.
              </p>
              <p>
                So far, we had a user who said that 'had it not been for
                Bubblic, I might not be here today'. This gives us so much drive
                to carry on with our project!
              </p>
              <p>We'd appreciate any feedback you have :)</p>
            </div>
          </section>
        </section>
        <section id="37071160">
          <h3>
            <a
              class="item"
              href="https://hacks.mozilla.org/2023/08/autogenerating-rust-js-bindings-with-uniffi/"
              >Autogenerating Rust-JS Bindings with UniFFI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 02:22:20</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37071160"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37070398">
          <h3>
            <a
              class="item"
              href="https://kuow.org/stories/seattle-becomes-first-in-u-s-to-protect-gig-workers-from-sudden-deactivation"
              >Seattle becomes first in U.S. to protect gig workers from sudden
              'deactivation'</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 00:46:02</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37070398"
                  >Comments</a
                ><span class="descendants">: 229</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37070261">
          <h3>
            <a
              class="item"
              href="https://news.uchicago.edu/story/uchicago-scientists-observe-first-evidence-quantum-superchemistry-laboratory"
              >UChicago scientists see first evidence of 'quantum
              superchemistry' in the lab</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 00:28:10</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37070261"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37070218">
          <h3>
            <a
              class="item"
              href="https://conversationswithtyler.com/episodes/paul-graham/"
              >Paul Graham on Conversations with Tyler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 00:21:36</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37070218"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37069551">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/duns-scotus-was-no-fool-but-a-brilliant-enigmatic-thinker"
              >Who Was Duns Scotus?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 23:01:58</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37069551"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37068464">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/8/9/23826342/cnet-content-pruning-deleting-articles-google-seo"
              >CNET is deleting old articles to try to improve its Google Search
              ranking</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 21:10:52</span
              ><span class="points-container"
                >Points: <span class="points">359</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37068464"
                  >Comments</a
                ><span class="descendants">: 238</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37068346">
          <h3>
            <a class="item" href="https://jobs.lever.co/buildzoom"
              >BuildZoom (YC W13) Is hiring a Growth Associate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 21:01:04</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37067894">
          <h3>
            <a class="item" href="https://dl.acm.org/doi/pdf/10.1145/3570638"
              >Optimization Techniques for GPU Programming [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 20:25:14</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37067894"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37066680">
          <h3>
            <a
              class="item"
              href="https://github.com/extesy/hoverzoom/discussions/670"
              >Temptations of an open-source Chrome extension developer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 18:28:30</span
              ><span class="points-container"
                >Points: <span class="points">763</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37066680"
                  >Comments</a
                ><span class="descendants">: 261</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37066522">
          <h3>
            <a
              class="item"
              href="https://blog.mlc.ai/2023/08/09/Making-AMD-GPUs-competitive-for-LLM-inference"
              >Making AMD GPUs competitive for LLM inference</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 18:15:24</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37066522"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37064822">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37064822"
              >Launch HN: Refine (YC S23) – Open-Source Retool alternative for
              enterprise</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 16:11:09</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37064822"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/refinedev/refine"
                >https://github.com/refinedev/refine</a
              >), an open-source platform for developing enterprise web
              applications rapidly. In one year since launch we have 15K active
              developers each month, and over 5K projects in production. Among
              the 5,000+ projects deployed to production, we see a lot of admin
              panels, dashboards, B2B portals and SAAS interfaces.
              <p>
                Check out our online generator at (<a
                  href="https://refine.dev/#playground"
                  >https://refine.dev/#playground</a
                >) to create a custom Refine application and download it.
              </p>
              <p>
                Before starting refine, we spent five years as a consultancy
                company building internal-facing applications for enterprise
                clients. We have seen many complex use cases where the demanded
                flexibility was much higher than what existing low-code/no-code
                solutions provide. Moving away from rigid architectures and
                pre-made components that are difficult to customize, developers
                tend to start from the scratch. This results in a significant
                waste of time and resources.
              </p>
              <p>
                In order to find a sweet spot between “starting from scratch”
                and higher level solutions, we started working on refine. After
                a couple of iterations, we came up with a “headless” solution,
                separating the UI-layer completely from the rest of the frontend
                logic. This allowed us to support multiple UI frameworks and
                custom designs out of the box.
              </p>
              <p>
                We understand the importance of frontend developers working with
                the stack and tools they love and are familiar with. So, we have
                built our project creation wizard that allows developers to mix
                and match their technology stack when creating a project.
              </p>
              <p>
                After 1.5 years of development with the great support of the
                open-source community, Refine has become a mature framework that
                allows developers to rapidly build enterprise applications and
                have 100% control over their projects.
              </p>
              <p>
                While remaining unobtrusive, Refine still saves a lot of
                development resources by eliminating repetitive tasks such as
                CRUD operations, state management, routing, authentication,
                access control, and i18n. It’s also backend-agnostic and works
                with any APIs or services.
              </p>
              <p>
                The best way to start Refine development is visiting our
                extensive documentation at (<a href="https://refine.dev/docs/"
                  >https://refine.dev/docs/</a
                >). Here, you can also find tutorials and real-life examples to
                use as a starting point for your use case.
              </p>
              <p>
                We had one successful Show HN earlier this year (<a
                  href="https://news.ycombinator.com/item?id=34515128"
                  >https://news.ycombinator.com/item?id=34515128</a
                >), and have since had several major releases and added many
                more features.
              </p>
              <p>
                Recently, we've released our enterprise edition featuring
                deployments, built-in security, backend integrations and
                auto-generated UI's. By expanding Refine's capabilities beyond
                the frontend, the enterprise edition offers a complete solution
                for the internal tooling requirements of larger organizations.
                To get more information, please see our pricing page:
                <a href="https://refine.dev/pricing/"
                  >https://refine.dev/pricing/</a
                >.
              </p>
              <p>
                If you have any questions, ideas or suggestions please share
                them with us. The team will be here all day to answer. We look
                forward to all of your comments!
              </p>
            </div>
          </section>
        </section>
        <section id="37064152">
          <h3>
            <a class="item" href="https://tosnotify.com/"
              >Show HN: Get notified when sites update their terms of service</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 15:26:56</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37064152"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
            <div class="text">
              <p>
                A harder problem I've been thinking through is how to know which
                terms to track, since it'd be a pain to add every site I have an
                account with. One idea I had is to automatically get terms for
                apps you have installed from the app store. Any other
                ideas/feedback are appreciated!
              </p>
              <p>
                [0]:
                <a href="https://news.ycombinator.com/item?id=37052508"
                  >https://news.ycombinator.com/item?id=37052508</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37063884">
          <h3>
            <a
              class="item"
              href="https://ergaster.org/posts/2023/08/09-i-dont-want-to-host-services-but-i-do/"
              >I don't want to host services but I do</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 15:09:16</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37063884"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37063829">
          <h3>
            <a
              class="item"
              href="https://www.cbc.ca/news/canada/british-columbia/amazon-shoe-packages-1.6926200"
              >B.C. woman buried in Amazon packages she did not ask for and does
              not want</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 15:05:56</span
              ><span class="points-container"
                >Points: <span class="points">228</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37063829"
                  >Comments</a
                ><span class="descendants">: 248</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37063774">
          <h3>
            <a
              class="item"
              href="http://www.noveltyansweringmachine.com/audio/index.html"
              >Archive of novelty answering machine recordings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 15:02:40</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37063774"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37063238">
          <h3>
            <a class="item" href="https://github.com/zknill/sqledge"
              >SQLedge: Replicate Postgres to SQLite on the Edge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 14:29:49</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37063238"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37063151">
          <h3>
            <a class="item" href="https://github.com/kognise/arpchat"
              >Arpchat – Text your friends on the same network using just ARP</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 14:24:56</span
              ><span class="points-container"
                >Points: <span class="points">349</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37063151"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37061842">
          <h3>
            <a class="item" href="https://arbesman.net/computationaldelights/"
              >The Garden of Computational Delights</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 12:47:47</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37061842"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37061127">
          <h3>
            <a
              class="item"
              href="https://hackaday.com/2023/08/07/review-beepy-a-palm-sized-linux-hacking-playground/"
              >Review: Beepy a Palm-Sized Linux Hacking Playground</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 11:30:47</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37061127"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37060470">
          <h3>
            <a
              class="item"
              href="https://spacecraft.ssl.umd.edu/akins_laws.html"
              >Akin’s Laws of Spacecraft Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 09:45:40</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37060470"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37060213">
          <h3>
            <a class="item" href="https://github.com/eliasdorneles/upiano"
              >Piano Emulator in Your Terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 08:59:06</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37060213"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37059400">
          <h3>
            <a class="item" href="https://supabase.com/blog/supabase-local-dev"
              >Supabase Local Dev: migrations, branching, and observability</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 06:40:39</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37059400"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37047529">
          <h3>
            <a
              class="item"
              href="https://themillions.com/2023/07/braille-is-alive-well-and-ever-evolving.html"
              >Braille Is Alive, Well, and Ever-Evolving</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 11:49:59</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37047529"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37047343">
          <h3>
            <a class="item" href="https://qoaformat.org/"
              >The Quite OK Audio Format for Fast, Lossy Compression</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 11:27:30</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37047343"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37046300">
          <h3>
            <a
              class="item"
              href="https://via.library.depaul.edu/cgi/viewcontent.cgi?referer=&amp;httpsredir=1&amp;article=1969&amp;context=law-review"
              >The Legitimacy of Takeover Defense in the '90s</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 09:04:53</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37046300"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37045471">
          <h3>
            <a
              class="item"
              href="https://losingfight.com/blog/2007/05/17/rip-freehand/"
              >R.I.P. Macromedia FreeHand (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 07:01:07</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37045471"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37045329">
          <h3>
            <a
              class="item"
              href="https://blog.nelhage.com/post/systems-at-capacity/"
              >Graceful behavior at capacity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 06:41:33</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37045329"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
