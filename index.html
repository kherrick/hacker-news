<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40844095">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/what-makes-a-good-tree-we-used-ai-to-ask-birds-233281"
              >What makes a good tree? We used AI to ask birds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 09:39:05</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40844095"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40844056">
          <h3>
            <a class="item" href="https://github.com/ShaShekhar/aaiela"
              >Show HN: Image editing with just audio instructions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 09:32:56</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40844056"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                Imagine the possibilities if Google Photos integrated voice
                assisted editing like AAIELA! Alongside Magic Eraser and other
                AI tools, editing with audio instruction could revolutionize how
                we interact with our photos.
              </p>
            </div>
          </section>
        </section>
        <section id="40844035">
          <h3>
            <a class="item" href="https://www.openssh.com/txt/release-9.8"
              >OpenSSH Race condition resulting in potential remote code
              execution</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 09:28:40</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40844035"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40843966">
          <h3>
            <a class="item" href="https://webneko.net/"
              >Webneko â€“ a desktop screenmate ported to web</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 09:15:43</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40843966"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40843867">
          <h3>
            <a class="item" href="https://pikimov.com/"
              >Show HN: I created an After Effects alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 08:57:26</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40843867"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <p>
                Inspired by Photopea (a free Photoshop clone), I created this
                web-based motion design &amp; video editor as an alternative to
                After Effects, to fill empty void.
              </p>
              <p>
                It's free, without signup, without cloud uploads (your files
                stay on your machine), and your projects are not used for AI
                models training.
              </p>
            </div>
          </section>
        </section>
        <section id="40843848">
          <h3>
            <a
              class="item"
              href="https://mlops.systems/posts/2024-07-01-full-finetuned-model-evaluation.html"
              >My finetuned models beat OpenAI's GPT-4</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 08:53:04</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40843848"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40843778">
          <h3>
            <a
              class="item"
              href="https://www.qualys.com/2024/07/01/cve-2024-6387/regresshion.txt"
              >RegreSSHion: RCE in OpenSSH's server, on glibc-based Linux
              systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 08:40:54</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40843778"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40843720">
          <h3>
            <a
              class="item"
              href="https://herman.bearblog.dev/cities-need-more-trees/"
              >Cities Need More Trees</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 08:31:58</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40843720"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40843683">
          <h3>
            <a class="item" href="https://github.com/ccbikai/Sink"
              >Show HN: An open-source alternative to Bitly</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 08:25:15</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40843683"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              Sink is A Simple / Speedy / Secure Link Shortener with Analytics
              run on Cloudflare.
            </div>
          </section>
        </section>
        <section id="40842917">
          <h3>
            <a class="item" href="https://berqwp.com/"
              >Show HN: BerqWP â€“ Automatically Optimize Core Web Vitals for
              WordPress</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 05:52:10</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40842917"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm excited to share BerqWP, a WordPress plugin I developed that
                automates the optimization of Core Web Vitals for your website.
              </p>
              <p>Key Features:</p>
              <p>
                Cache Warmup: Ensures your site loads faster by warming up the
                cache. WebP Images: Converts images to the WebP format for
                reduced loading times without sacrificing quality. Image Lazy
                Loading: Loads images only when they enter the viewport,
                reducing initial load time. YouTube Lazy Loading: Defers the
                loading of YouTube videos until they are about to be played. CSS
                Optimization: Minifies and combines CSS files to reduce the
                number of requests and improve load times. JavaScript
                Optimization: Minifies and defers JavaScript to avoid
                render-blocking and improve page speed. LCP Fix: Addresses and
                fixes issues related to the Largest Contentful Paint (LCP),
                ensuring a better user experience. And much more! Why BerqWP?
              </p>
              <p>
                Optimizing Core Web Vitals can be a complex and time-consuming
                task, especially for those who are not familiar with the
                intricacies of web performance. BerqWP takes care of this
                automatically, so you can focus on creating great content while
                ensuring your website performs optimally.
              </p>
              <p>Get Started:</p>
              <p>
                Download: You can download BerqWP from the WordPress Plugin
                Repository.
              </p>
              <p>
                Iâ€™d love to hear your feedback and suggestions to make BerqWP
                even better. Thank you for checking it out!
              </p>
              <p>Cheers, Hamza</p>
            </div>
          </section>
        </section>
        <section id="40842898">
          <h3>
            <a class="item" href="https://ieeexplore.ieee.org/document/10243497"
              >Quaternions in Signal and Image Processing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 05:47:05</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40842898"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40842867">
          <h3>
            <a
              class="item"
              href="https://carbon-steel.github.io/jekyll/update/2024/06/19/abstractions.html"
              >Programmers Should Never Trust Anyone, Not Even Themselves</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 05:39:57</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40842867"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40842762">
          <h3>
            <a class="item" href="https://ofcr.se/jujutsu-merge-workflow"
              >A Better Merge Workflow with Jujutsu</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 05:24:23</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40842762"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40842275">
          <h3>
            <a class="item" href="https://boston.conman.org/2024/06/30.1"
              >Four lines of code it was four lines of code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 03:26:09</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40842275"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40842173">
          <h3>
            <a
              class="item"
              href="https://maskray.me/blog/2024-06-30-integrated-assembler-improvements-in-llvm-19"
              >Integrated assembler improvements in LLVM 19</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 02:57:57</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40842173"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40841980">
          <h3>
            <a class="item" href="https://www.pipes.digital/docs"
              >Pipes: A spiritual successor to Yahoo Pipes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 02:03:37</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40841980"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40841649">
          <h3>
            <a
              class="item"
              href="https://grugq.substack.com/p/userland-rootkits-are-lame"
              >Userland rootkits are lame (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 00:47:45</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40841649"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40841502">
          <h3>
            <a
              class="item"
              href="https://tylerneylon.com/a/mind_model/mind_model.html"
              >A Model of a Mind</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 00:15:19</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40841502"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40840488">
          <h3>
            <a
              class="item"
              href="https://omid.dev/2024/07/01/chaos-engineering-in-frontend-development/"
              >Chaos Engineering in Front End Development: Enhancing Application
              Resilience</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 21:20:45</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40840488"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40840396">
          <h3>
            <a
              class="item"
              href="https://www.alvarorevuelta.com/posts/fft-polynomials"
              >Convolutions, Fast Fourier Transform and polynomials (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 21:08:43</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40840396"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40840315">
          <h3>
            <a
              class="item"
              href="https://www.ericpfahl.com/from-pattern-matching-to-unification/"
              >Unification in Elixir</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 20:58:32</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40840315"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40839830">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2406.09490"
              >Newswire: A large-scale structured database of a century of
              historical news</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 19:58:46</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40839830"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40839208">
          <h3>
            <a
              class="item"
              href="https://tulach.cc/writing-gui-apps-for-windows-is-painful/"
              >Writing GUI apps for Windows is painful</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 18:53:18</span
              ><span class="points-container"
                >Points: <span class="points">309</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40839208"
                  >Comments</a
                ><span class="descendants">: 373</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40838167">
          <h3>
            <a
              class="item"
              href="https://dillan.org/articles/how-to-get-root-access-to-your-sleep-number-bed"
              >How to get root access to your Sleep Number bed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 16:38:08</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40838167"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40837610">
          <h3>
            <a class="item" href="https://github.com/poundifdef/SmoothMQ"
              >Show HN: Drop-in SQS replacement based on SQLite</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 15:11:08</span
              ><span class="points-container"
                >Points: <span class="points">546</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40837610"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wrote this because I wanted a queue with all the bells and
                whistles - searching, scheduling into the future, observability,
                and rate limiting - all the things that many modern task queue
                systems have.
              </p>
              <p>
                But I didn't want to rewrite my app, which was already using
                SQS. And I was frustrated that many of the best solutions out
                there (BullMQ, Oban, Sidekiq) were language-specific.
              </p>
              <p>
                So I made an SQS-compatible replacement. All you have to do is
                replace the endpoint using AWS' native library in your language
                of choice.
              </p>
              <p>
                For example, the queue works with Celery - you just change the
                connection string. From there, you can see all of your messages
                and their status, which is hard today in the SQS console (and
                flower doesn't support SQS.)
              </p>
              <p>
                It is written to be pluggable. The queue implementation uses
                SQLite, but I've been experimenting with RocksDB as a backend
                and you could even write one that uses Postgres. Similarly, you
                could implement multiple protocols (AMQP, PubSub, etc) on top of
                the underlying queue. I started with SQS because it is simple
                and I use it a lot.
              </p>
              <p>
                It is written to be as easy to deploy as possible - a single go
                binary. I'm working on adding distributed and autoscale
                functionality as the next layer.
              </p>
              <p>
                Today I have search, observability (via prometheus), unlimited
                message sizes, and the ability to schedule messages arbitrarily
                in the future.
              </p>
              <p>
                In terms of monetization, the goal is to just have a hosted
                queue system. I believe this can be cheaper than SQS without
                sacrificing performance. Just as Backblaze and Minio have had
                success competing in the S3 space, I wanted to take a crack at
                queues.
              </p>
              <p>I'd love your feedback!</p>
            </div>
          </section>
        </section>
        <section id="40837411">
          <h3>
            <a class="item" href="https://mental-reverb.com/blog.php?id=29"
              >The weirdest QNX bug I've encountered (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 14:42:03</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40837411"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40835223">
          <h3>
            <a
              class="item"
              href="https://10maurycy10.github.io/misc/the_physics_of_flight/"
              >The physics of airplane flight</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 04:54:17</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40835223"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40835181">
          <h3>
            <a
              class="item"
              href="https://harpers.org/archive/2024/07/art-and-artifice-donna-tartt/"
              >Art and Artifice</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 04:39:11</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40835181"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40834377">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Pumped-storage_hydroelectricity"
              >Pumped-storage hydroelectricity</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 00:52:29</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40834377"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40816631">
          <h3>
            <a
              class="item"
              href="https://www.nasa.gov/missions/osiris-rex/surprising-phosphate-finding-in-nasas-osiris-rex-asteroid-sample/"
              >Surprising Phosphate Finding in NASA's Osiris-Rex Asteroid
              Sample</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 00:25:20</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40816631"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
