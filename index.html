<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38208502">
          <h3>
            <a class="item" href="https://openai.com/blog/data-partnerships"
              >OpenAI Data Partnerships</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 18:09:22</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38208502"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38208334">
          <h3>
            <a
              class="item"
              href="https://store.steampowered.com/sale/steamdeck_2023"
              >Steam Deck OLED</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 17:55:02</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38208334"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38208296">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38208296"
              >Ask HN: Ways to make side income as a SWE?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 17:52:18</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38208296"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                I want to earn some side income. Are there any platforms that
                pay reasonable amounts for short-term contract or gig work for
                SWEs?
              </p>
            </div>
          </section>
        </section>
        <section id="38208016">
          <h3>
            <a class="item" href="https://hu.ma.ne/aipin">Humane AI Pin</a>
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 17:30:18</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38208016"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38207959">
          <h3>
            <a class="item" href="https://corrode.dev/why-rust/"
              >Why Rust in Production?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 17:25:52</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38207959"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38207892">
          <h3>
            <a class="item" href="https://uxaudit.vercel.app"
              >Show HN: GPT-4V audit for your landing page</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 17:20:47</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38207892"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's pretty simple to use - just go to
                <a href="https://uxaudit.vercel.app"
                  >https://uxaudit.vercel.app</a
                >
                and enter your homepage or landing page URL.
              </p>
              <p>
                I'm using urlbox to get a screenshot of your page, then I
                utilize GPT-4V to analyze the screenshot and find potential
                usability and conversion issues. It also suggests solutions and
                highlights the relevant problem areas in the screenshot
                (although the position is sometimes inaccurate).
              </p>
              <p>
                Please let me know your thoughts and suggestions on how to
                improve it.
              </p>
            </div>
          </section>
        </section>
        <section id="38207866">
          <h3>
            <a
              class="item"
              href="https://www.propublica.org/article/your-right-to-know-why-health-insurer-denied-claim"
              >You Have a Right to Know Why a Health Insurer Denied Your
              Claim</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 17:19:25</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38207866"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38207744">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/11/09/car_text_harvesting/"
              >It's perfectly legal for cars to harvest your texts, call logs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 17:11:59</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38207744"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38207743">
          <h3>
            <a
              class="item"
              href="https://www.righto.com/2023/11/reverse-engineering-intel-386.html"
              >Reverse engineering the Intel 386 processor's register cell</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 17:11:56</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38207743"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38207700">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/humane-ai-pin-700-dollar-smartphone-alternative-wearable/"
              >Humane launches $699 Ai Pin</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 17:09:35</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38207700"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38207024">
          <h3>
            <a class="item" href="https://shreyans.org/google"
              >What I learned getting acquired by Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 16:20:56</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38207024"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38206973">
          <h3>
            <a class="item" href="https://www.nango.dev?source=hn-nov-2023"
              >Show HN: Nango – Open unified API for product integrations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 16:17:35</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38206973"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                Other integration companies have focused on building a lot of
                pre-built integrations. These are fast to ship and low
                maintenance, but they limit how deeply you can integrate with
                the external APIs.
              </p>
              <p>
                We take a different approach: we make it easier for developers
                to build and maintain product integrations in code. This lets
                you create exactly the integration your customers need without
                compromising on speed and maintainability, and without having to
                build complex infrastructure (OAuth, retries, rate-limit
                handling, change detection, monitoring &amp; logging, alerting,
                etc.).
              </p>
              <p>
                Our platform has two layers: (1) An API-agnostic infrastructure
                built with Temporal and Postgres, and (2) lambda function-like
                integrations written in typescript by any developer.
              </p>
              <p>
                Integrations are rarely more than 50 lines of code (here is an
                example:
                <a href="https://bit.ly/nango-example"
                  >https://bit.ly/nango-example</a
                >), thanks to the developer tooling we’ve built in:
                authentication, pagination, retries, change detection,
                rate-limit handling, monitoring, Slack alerts, etc.
              </p>
              <p>
                We have pre-built integration templates you can clone and
                extend—or you can build entirely custom integrations. Your
                integrations live in your repo and are tested and deployed to
                Nango with a CLI.
              </p>
              <p>
                In your product, you use a single API to interact with all your
                integrations. This lets you easily grow the available
                integrations with minimal code changes in your product.
              </p>
              <p>
                As a community-driven project, anybody can contribute
                integration templates and APIs to the platform. In fact, more
                than 30% of the APIs we support today have been contributed by
                our community.
              </p>
              <p>
                Nango grew out of a “universal OAuth” project called Pizzly and
                powers the integrations of 100+ SaaS products today. We have an
                active community of 800+ developers (<a
                  href="https://nango.dev/slack"
                  >https://nango.dev/slack</a
                >).
              </p>
              <p>
                All auth-related features are free forever, and we monetize with
                sync-related features. The entire code base and all integrations
                are source-available:
                <a href="https://github.com/NangoHQ/nango"
                  >https://github.com/NangoHQ/nango</a
                >.
              </p>
              <p>
                We hope Nango can help connect all SaaS products together and
                look forward to your feedback!
              </p>
            </div>
          </section>
        </section>
        <section id="38206678">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2023/11/08/the-worlds-largest-aircraft-breaks-cover-in-silicon-valley/"
              >World's largest aircraft breaks cover in Silicon Valley</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 16:00:58</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38206678"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38206333">
          <h3>
            <a
              class="item"
              href="https://lasvegassun.com/news/2023/nov/08/las-vegas-sphere-reports-984-million-loss-cfo-quit/"
              >Las Vegas Sphere reports $98.4M loss; CFO quits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 15:36:20</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38206333"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38206143">
          <h3>
            <a
              class="item"
              href="https://blog.jetbrains.com/clion/2023/11/clion-nova/"
              >CLion Nova Explodes onto the C and C++ Development Scene</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 15:23:40</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38206143"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38205571">
          <h3>
            <a
              class="item"
              href="https://www.latimes.com/world-nation/story/2023-11-08/olive-oil-price-soars-thieves-target-old-trees"
              >Olive oil soars, and thieves go after century-old trees in the
              Mediterranean</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 14:41:38</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38205571"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38205357">
          <h3>
            <a
              class="item"
              href="https://www.threads.net/@waxpancake/post/CzbS-cVuGgn"
              >You Win or You Learn</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 14:25:27</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38205357"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38204733">
          <h3>
            <a
              class="item"
              href="https://servo.org/blog/2023/11/06/nlgrant-announcement/"
              >Servo announces grant from the NLnet Foundation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 13:30:13</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38204733"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38204679">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/950567/fd65339fb45197f6/"
              >Reducing patch postings to Linux-kernel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 13:24:15</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38204679"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38204430">
          <h3>
            <a
              class="item"
              href="https://blog.mentat.ai/benchmarking-gpt-4-turbo-a-cautionary-tale"
              >Benchmarking GPT-4 Turbo – A Cautionary Tale</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 13:00:53</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38204430"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38203923">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/ploomber"
              >Ploomber (YC W22) Is Hiring Software Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 12:01:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38203553">
          <h3>
            <a class="item" href="https://www.nasm.us/"
              >The Netwide Assembler (NASM)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 11:11:08</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38203553"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38202993">
          <h3>
            <a class="item" href="https://statused.com"
              >Show HN: I built a tool to get "Your app was approved/rejected "
              alerts on Slack</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 09:51:26</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38202993"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
            <div class="text">
              <p>
                Looking for feedback, suggestions, and maybe opportunities I'm
                not seeing?
              </p>
            </div>
          </section>
        </section>
        <section id="38202703">
          <h3>
            <a class="item" href="https://github.com/ianatha/bababasic"
              >Show HN: QBasic 4.5 on Android</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 09:10:18</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38202703"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
            <div class="text">
              <p>
                One day, he mused about the simplicity and educational value of
                BASIC and wondered if there was a way to share its charm using
                today's technology.
              </p>
              <p>
                Specifically, he was looking for an Android application that
                could run BASIC so he could "teach programming while drinking
                coffee with [his] friends".
              </p>
              <p>
                Thus, BabaBASIC was born—a hat tip to 'Babá', the Greek term for
                "dad", and a reminder of who sparked this journey.
              </p>
              <p>
                The first iteration of this was made over a 10-hour all-nighter
                using existing open-source libraries.
              </p>
              <p>
                I ended up forking the BASIC-like implementation to make it more
                byte-for-byte compatible with QBasic 4.5, which is what my
                father used back in the 90s to teach me programming.
              </p>
              <p>
                This is the first thing I have ever made of which he approves.
              </p>
            </div>
          </section>
        </section>
        <section id="38202668">
          <h3>
            <a class="item" href="https://www.commoncoresheets.com/"
              >Common Core Sheets</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 09:04:31</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38202668"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38201914">
          <h3>
            <a class="item" href="https://ratfactor.com/cards/asm-data-in-text"
              >i386 Assembly Language trick for storing data in .text</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 06:47:25</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38201914"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38201624">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/semiconductor"
              >Researchers uncover the fastest semiconductor yet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 05:48:46</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38201624"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38199869">
          <h3>
            <a
              class="item"
              href="https://blog.gingerbeardman.com/2023/11/09/early-computer-art-by-barbara-nessim/"
              >Early computer art by Barbara Nessim (1984)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 01:39:06</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38199869"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38199355">
          <h3>
            <a class="item" href="https://www.omegle.com/">Omegle 2009-2023</a>
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 00:40:25</span
              ><span class="points-container"
                >Points: <span class="points">2169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38199355"
                  >Comments</a
                ><span class="descendants">: 872</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38199061">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2023/11/first-planned-small-nuclear-reactor-plant-in-the-us-has-been-canceled/"
              >First planned small nuclear reactor plant in the US has been
              canceled</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-09 @ 00:02:28</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38199061"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
