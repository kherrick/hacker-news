<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41482087">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/world/us/white-house-asks-agencies-step-up-internet-routing-security-efforts-2024-09-03/"
              >White House asks agencies to step up internet routing security
              efforts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 18:25:00</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41482087"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41482070">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2024/ev-company-shutdowns-china/"
              >When EV startups shut down, will their cars still work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 18:22:18</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41482070"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41482060">
          <h3>
            <a class="item" href="https://github.com/damn/core"
              >RPG Maker and Engine for Clojure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 18:21:00</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41482060"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41481876">
          <h3>
            <a class="item" href="https://tailscale.com/kb/1193/tailscale-ssh"
              >Tailscale SSH</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 17:52:04</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41481876"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41481852">
          <h3>
            <a
              class="item"
              href="https://ahmadosman.com/blog/serving-ai-from-basement/"
              >Serving AI from the Basement – 192GB of VRAM Setup</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 17:47:44</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41481852"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41481821">
          <h3>
            <a
              class="item"
              href="https://www.robinsloan.com/moonbound/muscular-imagination/"
              >The muscular imagination of Iain M. Banks: a future you might
              want to l</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 17:42:02</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41481821"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41481682">
          <h3>
            <a
              class="item"
              href="https://blog.trailofbits.com/2024/09/06/unstripping-binaries-restoring-debugging-information-in-gdb-with-pwndbg/"
              >"Unstripping" binaries: Restoring debugging information in GDB
              with Pwndbg</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 17:23:14</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41481682"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41481501">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/infisical/jobs/snlbWtr-technical-content-marketer"
              >Infisical (YC W23) Is Hiring a Developer Who Love Writing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 17:00:02</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41481482">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41481482"
              >Ask HN: How do you share and sync .env files and secrets with
              your team</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 16:57:58</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41481482"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
            <div class="text">
              I am trying to figure out how to securely share and sync .env
              files and secrets with my team. Is there a saas/oss solution that
              "just works" or there's no way around using hashicorp vault/GCP
              Secrets/etc. with custom scripts?
            </div>
          </section>
        </section>
        <section id="41481323">
          <h3>
            <a
              class="item"
              href="https://arnaud-carre.github.io/2024-09-08-4ktribute/"
              >Graphics Tricks from Boomers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 16:31:04</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41481323"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41480034">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41480034"
              >Ask HN: How does my school block DoH?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 12:35:48</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41480034"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
            <div class="text">
              <p>
                How does this work? Is this some kind of MITM-Attack on me (I do
                not remember having had to install any special certificates, but
                I do not know how to check this)? Is there a convenient way to
                bypass this (i. e. not Tor et al.)?
              </p>
              <p>
                I respect the IT companys efforts to secure the schools network
                (The IT company is universally hated by the entire school - They
                block the sites the teachers want to use, the youtube videos
                sometimes used for lessons, make the schools computers slow
                through McAfee and other bloat and prevent us learning about
                computer networks in class by blocking school-pc-to-school-pc
                connections in the firewall. Oh, and they also recently took in
                all the school issued I-Pads for an update only to delete all
                personal files on them; fortunately I do not use these out of
                principle, although I believe everyone managed to recover from
                cloud backups), but I would like to understand what they are
                doing to the network. Furthermore I am concerned about the
                legality of what they are doing (German law) and if they are
                able to read my private data that flows through the network (the
                network is personal login only, which would make that even
                worse). Also I find it disconcerting that my school blocks
                hrw.org (i. e. human rights watch) which I believe sends a wrong
                message.
              </p>
              <p>
                If there is any testing I can/need to do for further analysis I
                would appreciate you telling me. Thank you! This is actually my
                first post here on HN as a long time lurker.
              </p>
            </div>
          </section>
        </section>
        <section id="41479785">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/article/2024/sep/08/goodbye-tinder-hello-strava-have-hobby-apps-become-the-new-social-networks"
              >Have ‘hobby’ apps become the new social networks?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 11:32:52</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41479785"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41479637">
          <h3>
            <a class="item" href="https://github.com/LuaJIT/LuaJIT/pull/1267"
              >LuaJIT PR: Add Support for RISC-V 64</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 10:57:55</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41479637"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41479365">
          <h3>
            <a class="item" href="https://mxb.dev/blog/buildless/"
              >Going Buildless</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 09:53:49</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41479365"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41479266">
          <h3>
            <a
              class="item"
              href="https://www.new-east-archive.org/articles/show/7269/spomenik-yugoslav-monument-owen-hatherley"
              >Concrete clickbait: next time you share a spomenik photo
              (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 09:34:00</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41479266"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41478690">
          <h3>
            <a class="item" href="https://www.alphaxiv.org/"
              >alphaXiv: Open research discussion on top of arXiv</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 06:57:18</span
              ><span class="points-container"
                >Points: <span class="points">387</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41478690"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41478138">
          <h3>
            <a
              class="item"
              href="https://conspirator0.substack.com/p/baiting-the-bot"
              >Baiting the bot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 04:05:36</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41478138"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41477446">
          <h3>
            <a
              class="item"
              href="https://bernsteinbear.com/blog/fenster-microui/"
              >Microui+fenster=Small GUI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 00:55:19</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41477446"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41475998">
          <h3>
            <a class="item" href="https://citizen-dj.labs.loc.gov/"
              >CitizenDJ – Make music using free audio and video from the
              Library of Congress</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-07 @ 19:47:01</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41475998"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41475124">
          <h3>
            <a
              class="item"
              href="https://purplesyringa.moe/blog/webp-the-webpage-compression-format/"
              >WebP: The WebPage Compression Format</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-07 @ 17:32:48</span
              ><span class="points-container"
                >Points: <span class="points">486</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41475124"
                  >Comments</a
                ><span class="descendants">: 174</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41474828">
          <h3>
            <a
              class="item"
              href="https://blog.jgc.org/2024/09/cracking-old-zip-file-to-help-open.html"
              >Cracking an old ZIP file to help open source the ANC's "Vula"
              secret crypto code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-07 @ 16:41:11</span
              ><span class="points-container"
                >Points: <span class="points">283</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41474828"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41467503">
          <h3>
            <a class="item" href="https://www.mdpi.com/2076-393X/12/9/958#"
              >Unconventional Case Study of Neoadjuvant Oncolytic Virotherapy
              for Breast Cancer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 16:20:55</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41467503"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41461251">
          <h3>
            <a
              class="item"
              href="https://martypc.blogspot.com/2024/08/pc-floppy-copy-protection-softguard.html"
              >PC Floppy Copy Protection: Softguard Superlok</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 23:19:09</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41461251"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41458646">
          <h3>
            <a
              class="item"
              href="https://www.ben-evans.com/benedictevans/2017/01/11/wrongquestions"
              >Asking the wrong questions (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 17:19:09</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41458646"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41453569">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/RsyncForLimitedRemoteWrite"
              >Using rsync to create a limited ability to write remote files</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 04:48:27</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41453569"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41453119">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=3pYqXrFx6S8"
              >How a 16th Century Explorer's Sailing Ship Works</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 03:13:25</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41453119"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41451969">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-02832-5"
              >A day in the life of the fastest supercomputer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-04 @ 23:38:43</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41451969"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41447554">
          <h3>
            <a class="item" href="https://thewalrus.ca/moleskine/"
              >Business Moleskine Mania: How a Notebook Conquered the Digital
              Era</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-04 @ 16:26:28</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41447554"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41443012">
          <h3>
            <a
              class="item"
              href="https://github.com/Amourspirit/python_libre_pythonista_ext"
              >LibrePythonista allows running IPython code in a LibreOffice
              spreadsheet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-04 @ 07:56:48</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41443012"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41440997">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/article/2024/sep/04/dogs-remember-names-toys-years-study-pets-memory"
              >Dogs can remember names of toys years after not seeing them,
              study shows</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-04 @ 01:27:05</span
              ><span class="points-container"
                >Points: <span class="points">295</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41440997"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
