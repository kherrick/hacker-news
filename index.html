<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42289345">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/infisical/jobs/2OGBQMt-full-stack-engineer-sf"
              >Infisical (YC W23) Is Hiring Full Stack Engineers in SF and
              Remotely</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 17:00:49</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42289310">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2411.12580"
              >Procedural Knowledge in Pretraining Drives Reasoning in Large
              Language Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 16:54:26</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42289310"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42288956">
          <h3>
            <a
              class="item"
              href="https://bilbof.com/posts/kubernetes-on-hetzner"
              >Kubernetes on Hetzner: cutting my infra bill by 75%</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 15:43:40</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42288956"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42288483">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=bVdF9ByDb6g"
              >Tiny Arcades [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 13:59:39</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42288483"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42288449">
          <h3>
            <a
              class="item"
              href="https://www.sciencealert.com/the-worlds-rarest-mineral-is-so-rare-its-only-ever-been-found-once"
              >The Rarest Mineral Is So Rare It's Only Ever Been Found Once</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 13:49:00</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42288449"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42288375">
          <h3>
            <a
              class="item"
              href="https://lamport.azurewebsites.net/tla/science-book.html"
              >A Science of Concurrent Programs (final draft)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 13:34:27</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42288375"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42287795">
          <h3>
            <a
              class="item"
              href="https://worldsensorium.com/turning-bogs-from-wastelands-to-nature-scapes/"
              >Turning bogs from wastelands to nature-scapes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 11:24:43</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42287795"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42287345">
          <h3>
            <a
              class="item"
              href="http://cadlag.org/posts/a-review-of-freedman-pisani-purves-statistics.html"
              >Statistics, by Freedman, Pisani, and Purves (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 09:37:56</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42287345"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42287231">
          <h3>
            <a class="item" href="https://adventofcode.com/2024/about"
              >Advent of Code 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 09:09:35</span
              ><span class="points-container"
                >Points: <span class="points">696</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42287231"
                  >Comments</a
                ><span class="descendants">: 267</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42286397">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2411.01747"
              >DynaSaur: Large Language Agents Beyond Predefined Actions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 05:21:59</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42286397"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42284980">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2410.02724"
              >Large Language Models as Markov Chains</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 23:57:53</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42284980"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42284412">
          <h3>
            <a class="item" href="https://github.com/privastead/privastead"
              >Show HN: Open-source private home security camera system
              (end-to-end encryption)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 22:13:49</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42284412"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
            <div class="text">
              <p>
                Based on some of the discussions I've seen online, it seems like
                there are other users who are also concerned with the privacy
                implications of home security cameras. Therefore, I decided to
                open source my solution for everyone to use. If you need a
                privacy-preserving home security camera, please give it a try
                and provide feedback. Note that trying out the system requires
                you to have a supported IP camera, a local machine connected to
                the IP camera, a server, and an Android smartphone. I have put
                together detailed instructions on setting up the system, which I
                hope makes it easier for others to get the system up and
                running.
              </p>
              <p>
                In addition, consider contributing to the project. The prototype
                currently has a lot of limitations: mainly that it has only been
                tested with one IP camera, only allows the use of one camera,
                and only supports Android. I'll continue to improve the
                prototype as time permits, but progress will be much faster if
                there are other contributors as well.
              </p>
            </div>
          </section>
        </section>
        <section id="42283950">
          <h3>
            <a class="item" href="https://github.com/maharmstone/ntfs2btrfs"
              >Ntfs2btrfs does in-place conversion of NTFS filesystem to the
              open-source Btrfs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 20:50:08</span
              ><span class="points-container"
                >Points: <span class="points">362</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42283950"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42283933">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/amd-disables-zen-4s-loop-buffer"
              >AMD Disables Zen 4's Loop Buffer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 20:47:35</span
              ><span class="points-container"
                >Points: <span class="points">269</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42283933"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42282112">
          <h3>
            <a
              class="item"
              href="https://leancrew.com/all-this/2024/11/square-roots-and-maxima/"
              >Square roots and maxima</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 15:33:59</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42282112"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42282053">
          <h3>
            <a
              class="item"
              href="https://distrowatch.com/weekly.php?issue=20090323#feature"
              >Interview of Robert Shingledecker, Tiny Core Linux and DSL
              Developer (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 15:18:50</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42282053"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42280570">
          <h3>
            <a
              class="item"
              href="https://blog.lucasholten.com/rust-query-announcement/"
              >Safe relational database queries using the Rust type system</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 09:29:39</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42280570"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42280049">
          <h3>
            <a
              class="item"
              href="https://www.cindydrozda.com/html/Video_Pages/VideoMostOfBurl.html"
              >Make the most of your burl</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 06:51:33</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42280049"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42277850">
          <h3>
            <a
              class="item"
              href="https://www.theparisreview.org/blog/2017/02/15/rhythmical-lines/"
              >Geometric line-art of Wacław Szpakowski (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 22:54:12</span
              ><span class="points-container"
                >Points: <span class="points">434</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42277850"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42276813">
          <h3>
            <a class="item" href="https://github.com/pyrustic/jinbase"
              >Show HN: Jinbase – Multi-model transactional embedded database</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 20:25:33</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42276813"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/pyrustic/jinbase"
                >https://github.com/pyrustic/jinbase</a
              >), my multi-model transactional embedded database.
              <p>
                Almost a year ago, I introduced Paradict [1], my take on
                multi-format streaming serialization. Given its readability, the
                Paradict text format appears de facto as an interesting data
                format for config files. But using Paradict to manage config
                files would end up cluttering its programming interface and
                making it confusing for users who still have choices of
                alternative libraries (TOML, INI File, etc.) dedicated to config
                files. So I used Paradict as a dependency for KvF (Key-value
                file format) [2], a new project of mine that focuses on config
                files with sections.
              </p>
              <p>
                With its compact binary format, I thought Paradict would be an
                efficient dependency for a new project that would rely on I/O
                functions (such as Open, Read, Write, Seek, Tell and Close) to
                implement a minimalistic yet reliable persistence solution. But
                that was before I learned that "files are hard" [3]. SQLite with
                its transactions, BLOB data type and incremental I/O for BLOBs
                seemed like the right giant to stand on for my new project.
              </p>
              <p>
                Jinbase started small as a key-value store and ended up as a
                multi-model embedded database that pushes the boundaries of what
                we usually do with SQLite. The first transition to the second
                data model (the depot) happened when I realized that the
                key-value store was not well suited for cases where a unique
                identifier is supposed to be automatically generated for each
                new record, saving the user the burden of providing an
                identifier that could accidentally be subject to a collision and
                thus overwrite an existing record. After that, I implemented a
                search capability that accepts UID ranges for the depot store,
                timespans (records are automatically timestamped) for both the
                depot and key-value stores and GLOB patterns and number ranges
                for string and integer keys in the key-value store.
              </p>
              <p>
                The queue and stack data models emerged as solutions for use
                cases where records must be consumed in a specific order. A
                typical record would be retrieved and deleted from the database
                in a single transaction unit.
              </p>
              <p>
                Since SQLite is used as the storage engine, Jinbase supports the
                relational model de facto. For convenience, all tables related
                to Jinbase internals are prefixed with "jinbase_", making
                Jinbase a useful tool for opening legacy SQLite files to add new
                data models that will safely coexist with the ad hoc relational
                model.
              </p>
              <p>
                All four main data models (key-value, depot, queue, stack)
                support Paradict-compatible data types, such as dictionaries,
                strings, binary data, integers, datetimes, etc. Under the hood,
                when the user initiates a write operation, Jinbase serializes
                (except for binary data), chunks, and stores the data
                iteratively. A record can be accessed not only in bulk, but also
                with two levels of partial access granularity: the byte-level
                and the field-level.
              </p>
              <p>
                While SQLite's incremental I/O for BLOBs is designed to target
                an individual BLOB column in a row, Jinbase extends this so that
                for each record, incremental reads cover all chunks as if they
                were a single unified BLOB. For dictionary records only, Jinbase
                automatically creates and maintains a lightweight index
                consisting of pointers to root fields, which then allows
                extracting from an arbitrary record the contents of a field
                automatically deserialized before being returned.
              </p>
              <p>
                The most obvious use cases for Jinbase are storing user
                preferences, persisting session data before exit, order-based
                processing of data streams, exposing data for other processes,
                upgrading legacy SQLite files with new data models and bespoke
                data persistence solutions.
              </p>
              <p>
                Jinbase is written in Python, is available on PyPI and you can
                play with the examples on the README.
              </p>
              <p>Let me know what you think about this project.</p>
              <p>
                [1]
                <a href="https://news.ycombinator.com/item?id=38684724"
                  >https://news.ycombinator.com/item?id=38684724</a
                >
              </p>
              <p>
                [2]
                <a href="https://github.com/pyrustic/kvf"
                  >https://github.com/pyrustic/kvf</a
                >
              </p>
              <p>
                [3]
                <a href="https://news.ycombinator.com/item?id=10725859"
                  >https://news.ycombinator.com/item?id=10725859</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42268319">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/dont-cancel-aristotle-we-need-his-ideas-to-hone-ours"
              >Who can claim Aristotle?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-28 @ 20:23:56</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42268319"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42256968">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/jaffray/archive/fine-ill-play-with-skiplists/"
              >Fine, I'll Play With Skiplists</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-27 @ 15:50:21</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42256968"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42254144">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/hillelwayne/archive/the-opposite-of-documentation-is-superstition/"
              >The Opposite of Documentation is Superstition (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-27 @ 08:32:39</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42254144"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42253640">
          <h3>
            <a class="item" href="https://sha.org/bottle/"
              >Historic Bottle Website</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-27 @ 06:59:07</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42253640"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42245544">
          <h3>
            <a class="item" href="https://mementomovi.wackyneighbor.com/"
              >Memento Movi</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-26 @ 13:31:17</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42245544"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42244472">
          <h3>
            <a class="item" href="https://shader-slang.com"
              >The Slang Shading Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-26 @ 10:40:53</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42244472"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42239323">
          <h3>
            <a
              class="item"
              href="https://www.augmentcode.com/blog/rethinking-llm-inference-why-developer-ai-needs-a-different-approach?"
              >How We Optimize LLM Inference for AI Coding Assistant</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-25 @ 19:27:36</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42239323"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42233836">
          <h3>
            <a
              class="item"
              href="https://notso.boringsql.com/posts/deletes-are-difficult/"
              >DELETEs Are Difficult</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-25 @ 06:46:15</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42233836"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42232952">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20241029-the-caving-scientists-exploring-the-darkest-places-on-earth"
              >Caving scientists exploring the darkest places on Earth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-25 @ 03:25:33</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42232952"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42220596">
          <h3>
            <a class="item" href="https://github.com/hfiref0x/WinDepends"
              >WinDepends – A Rewrite of the Dependency Walker</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-23 @ 12:48:06</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42220596"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
