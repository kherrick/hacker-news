<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41959498">
          <h3>
            <a
              class="item"
              href="https://eclecticlight.co/2024/10/26/a-brief-history-of-mac-firmware/"
              >A brief history of Mac firmware</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-27 @ 02:53:39</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41959498"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41958766">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/30C3_-_5588_-_en_-_saal_g_-_201312281600_-_my_journey_into_fm-rds_-_oona_raisanen"
              >I discovered mysterious hidden signals on a public radio channel
              (2013) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-27 @ 00:09:50</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41958766"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41958575">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/ideas/archive/2024/10/psychedelics-medicine-science/680286/"
              >The weak science behind psychedelics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 23:39:50</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41958575"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41958561">
          <h3>
            <a
              class="item"
              href="https://www.nray.dev/blog/visual-testing-building-a-more-robust-wikipedia-interface-by-spotting-the-differences/"
              >Building a more robust Wikipedia interface by spotting the
              differences (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 23:38:18</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41958561"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41958550">
          <h3>
            <a
              class="item"
              href="https://embracethered.com/blog/posts/2024/claude-computer-use-c2-the-zombais-are-coming/"
              >ZombAIs: From Prompt Injection to C2 with Claude Computer Use</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 23:36:27</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41958550"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41958420">
          <h3>
            <a
              class="item"
              href="https://unherd.com/2024/10/californias-woes-were-born-in-england/"
              >California is torn between clashing Anglo traditions?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 23:15:13</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41958420"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41958255">
          <h3>
            <a class="item" href="https://browserleaks.com/canvas"
              >Canvas Fingerprinting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 22:41:29</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41958255"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41958180">
          <h3>
            <a
              class="item"
              href="https://www.history.com/news/electoral-college-nearly-abolished-thurmond"
              >How the Electoral College Was Nearly Abolished in 1970</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 22:25:09</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41958180"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41957685">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41957685"
              >Carma (YC W24) hiring founding SWEs (remote) to build the next
              Uber for auto repair</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 21:00:32</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                We are on a mission to become the Uber of auto repair. Carma has
                built a network of top-tier auto service centers that bid for
                same-day service requests. We are gaining significant traction
                in the B2B sector, focusing on business fleet customers—think
                large companies in construction, landscaping, cleaning services,
                and pest control. These businesses feel the pain of auto repair
                most acutely, often spending millions annually. While we are
                currently focused on this market, we have plans to expand into
                the consumer space in the future.
              </p>
              <p>
                As a founding engineer, you will experience a tight customer
                feedback loop. Your work will be deployed daily, receiving
                immediate market feedback from our customers and partner service
                centers—both of whom rely on Carma daily to power their
                businesses.
              </p>
              <p>
                Our go-to-market strategy is highly effective, and we are
                consistently acquiring new enterprise customers each month. We
                iterate rapidly, prioritizing speed and maintaining a tight
                feedback loop with customers above all else.
              </p>
              <p>
                We're experiencing rapid growth, with our revenue increasing by
                40% month-over-month. We were among the first companies accepted
                into the W24 batch and emerged as one of the top-funded non-AI
                startups, securing over $5 million in funding.
              </p>
              <p>What is Carma and how does it work?</p>
              <p>
                Carma is a B2B managed marketplace that provides same-day
                automotive repair for commercial fleet owners. We offer instant,
                transparent quotes and guaranteed pricing for any vehicle. Our
                mission is to tackle the $573 billion problem in commercial auto
                repair: the challenge for fleet owners to efficiently find
                automotive services and for repair shops to attract customers.
              </p>
              <p>
                Fleet owners can request any service through our mobile app. We
                then send these requests to our network of highly-vetted partner
                service centers. These partners provide real-time offers for the
                requested services, ensuring quick and competitive responses.
              </p>
              <p>
                Our fleet customers save over 50% when using Carma compared to
                the median price for the same service in their zip code.
                Meanwhile, our partner service centers increase their revenue
                and acquire new customers. Here are the links to our open
                positions:
              </p>
              <p>
                <a
                  href="https://www.ycombinator.com/companies/carma/jobs/Q8b56T8-full-stack-software-engineer"
                  >https://www.ycombinator.com/companies/carma/jobs/Q8b56T8-ful...</a
                >
              </p>
              <p>
                <a
                  href="https://www.ycombinator.com/companies/carma/jobs/MN1V2dB-mobile-software-engineer"
                  >https://www.ycombinator.com/companies/carma/jobs/MN1V2dB-mob...</a
                >
              </p>
              <p>
                If you are interested, let's chat ASAP. You can apply above or
                email me directly: tony at joincarma.com
              </p>
            </div>
          </section>
        </section>
        <section id="41957585">
          <h3>
            <a class="item" href="https://www.bbc.com/news/business-66644709"
              >Long wave radio fans mourn fading frequencies (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 20:42:17</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41957585"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41957377">
          <h3>
            <a
              class="item"
              href="https://medium.com/@danielstone/olivettis-ivrea-how-an-italian-tech-giant-built-the-world-s-most-progressive-company-town-557cb035c383"
              >Olivetti’s Ivrea</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 20:13:22</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41957377"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41957008">
          <h3>
            <a class="item" href="https://m4xc.dev/articles/fundamental-rc/"
              >Fundamentals of Radiance Cascades</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 19:14:30</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41957008"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41956742">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-10-ion-solar-gravitational-lens-years.html"
              >Ion engines could take us to the solar gravitational lens in less
              than 13 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 18:34:45</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41956742"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41956587">
          <h3>
            <a
              class="item"
              href="https://commoncog.com/goodharts-law-not-useful/"
              >Goodhart's law isn't as useful as you might think (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 18:13:03</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41956587"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41955912">
          <h3>
            <a
              class="item"
              href="https://blog.hyperknot.com/p/understanding-round-robin-dns"
              >Understanding Round Robin DNS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 16:46:52</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41955912"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41955003">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/deep-dive-the-instability-of-op-amps"
              >Deep dive: the instability of op-amps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 14:38:11</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41955003"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41954825">
          <h3>
            <a
              class="item"
              href="https://www.bleepingcomputer.com/news/security/new-windows-driver-signature-bypass-allows-kernel-rootkit-installs/"
              >New Windows driver signature bypass allows kernel rootkit
              installs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 14:12:40</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41954825"
                  >Comments</a
                ><span class="descendants">: 210</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41953063">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41953063"
              >Tell HN: GpuOwl/PRPLL, GPU software used to find the largest
              prime number</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 06:57:28</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41953063"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                Feel free to ask questions about technical aspects of the GpuOwl
                implementation, about optimizations, tricks, efficient FFT
                implementation on GPUs etc. Or anything else.
              </p>
              <p>
                [1] GpuOwl:
                <a href="https://github.com/preda/gpuowl"
                  >https://github.com/preda/gpuowl</a
                >
                [2] GIMPS:
                <a href="https://www.mersenne.org/"
                  >https://www.mersenne.org/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41952984">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/b9e419c6-acf1-420b-8ae6-908feb52c94e"
              >How 'Factorio' seduced Silicon Valley and me</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 06:33:01</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41952984"
                  >Comments</a
                ><span class="descendants">: 185</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41952953">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/how-the-human-brain-contends-with-the-strangeness-of-zero-20241018/"
              >How the Human Brain Contends with the Strangeness of Zero</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 06:22:44</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41952953"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41952779">
          <h3>
            <a class="item" href="https://github.com/dim0x69/mdx"
              >Show HN: Mdx – Execute your Markdown code blocks, now in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 05:34:20</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41952779"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/dim0x69/mdx"
                >https://github.com/dim0x69/mdx</a
              >).
              <p>Key Features:</p>
              <p>- Define dependencies between commands</p>
              <p>- Supports shebangs</p>
              <p>- Ability to pass arguments to code blocks</p>
              <p>Would love feedback and thoughts!</p>
              <p>
                Ref. makedown:
                <a href="https://github.com/tzador/makedown"
                  >https://github.com/tzador/makedown</a
                >. Thanks for the idea! :)
              </p>
            </div>
          </section>
        </section>
        <section id="41951408">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=SioCwvR_PYY"
              >How can this 6 axis robot have a static accuracy of 0.05 mm?
              (2021) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-26 @ 00:20:26</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41951408"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41947985">
          <h3>
            <a
              class="item"
              href="https://jamesclear.com/wp-content/uploads/2015/03/copy-machine-study-ellen-langer.pdf"
              >The Mindlessness of Ostensibly Thoughtful Action (1978) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-25 @ 18:15:42</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41947985"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41944919">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/why-ghosts-wear-clothes-or-white-sheets-instead-of-appearing-in-the-nude-241948"
              >Why ghosts wear clothes or white sheets</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-25 @ 13:10:13</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41944919"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41936855">
          <h3>
            <a
              class="item"
              href="https://www.assembled.com/blog/how-we-saved-hundreds-of-engineering-hours-by-writing-tests-with-llms"
              >Using LLMs to enhance our testing practices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-24 @ 16:03:09</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41936855"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41925510">
          <h3>
            <a
              class="item"
              href="https://www.hcn.org/articles/migrating-birds-find-refuge-in-pop-up-habitats/"
              >Migrating birds find refuge in pop-up habitats</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 14:41:11</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41925510"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41925130">
          <h3>
            <a
              class="item"
              href="https://thevccorner.substack.com/p/from-sci-fi-to-reality"
              >Using a BCI with LLM for enabling ALS patients to speak again
              with family</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 13:59:35</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41925130"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41921311">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-10-imaging-ovulation-action-reveals-distinct.html"
              >Live imaging of ovulation in action reveals three distinct phases
              in mice</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 02:56:24</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41921311"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41920055">
          <h3>
            <a
              class="item"
              href="https://cloudinary.com/blog/how_jpeg_xl_compares_to_other_image_codecs"
              >How JPEG XL compares to other image codecs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 00:04:30</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41920055"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41915978">
          <h3>
            <a
              class="item"
              href="https://practicalbetterments.com/order-and-orient-the-keys-on-your-keychain/"
              >Order and orient the keys on your keychain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 16:29:32</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41915978"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
