<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43604015">
          <h3>
            <a class="item" href="http://beyondloom.com/blog/images.html"
              >The Treachery of Image Files (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 19:02:58</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43604015"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43603999">
          <h3>
            <a
              class="item"
              href="https://tedium.co/2025/04/06/gumroad-open-source-doge-drama/"
              >Gumroad's Interestingly Timed "Open-Source" Play</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 19:01:32</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43603999"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43603566">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=5M_hmwBBPnc"
              >Jeff Geerling won't connect his dishwasher to your stupid cloud
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 18:16:35</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43603566"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43603453">
          <h3>
            <a
              class="item"
              href="https://www.lesswrong.com/posts/4mvphwx5pdsZLMmpY/recent-ai-model-progress-feels-mostly-like-bullshit"
              >Recent AI model progress feels mostly like bullshit</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 18:01:59</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43603453"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43603111">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/pacific-crest-appalachian-trail-federal-layoffs-934a5526570569b625f5d854ec339a04"
              >Federal cuts disrupt repairs to iconic U.S. trails</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 17:24:08</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43603111"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43603091">
          <h3>
            <a
              class="item"
              href="https://www.bleepingcomputer.com/news/security/max-severity-rce-flaw-discovered-in-widely-used-apache-parquet/"
              >Max severity RCE flaw discovered in widely used Apache Parquet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 17:21:54</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43603091"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43602940">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/foundry/jobs/WvDDlqc-founding-fullstack-engineer-building-the-future-of-browser-agents"
              >Foundry (YC F24) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 17:01:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43602688">
          <h3>
            <a
              class="item"
              href="https://0xda.de/blog/2025/04/hiding-elements-that-require-javascript-without-javascript/"
              >Hiding elements that require JavaScript without JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 16:28:23</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43602688"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43601301">
          <h3>
            <a class="item" href="https://github.com/brannondorsey/mem-isolate"
              >Show HN: I built a Rust crate for running unsafe code safely</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 13:28:48</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43601301"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43600704">
          <h3>
            <a
              class="item"
              href="https://nautil.us/neutron-stars-hint-at-another-dimension-1202180/"
              >Neutron Stars Hint at Another Dimension</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 11:41:26</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43600704"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43600192">
          <h3>
            <a
              class="item"
              href="https://elenacross7.medium.com/%EF%B8%8F-the-s-in-mcp-stands-for-security-91407b33ed6b"
              >The "S" in MCP Stands for Security</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 09:42:28</span
              ><span class="points-container"
                >Points: <span class="points">421</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43600192"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43599967">
          <h3>
            <a
              class="item"
              href="https://machinelearning.apple.com/research/seedlm-compressing"
              >SeedLM: Compressing LLM Weights into Seeds of Pseudo-Random
              Generators</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 08:53:41</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43599967"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43599637">
          <h3>
            <a class="item" href="https://standardebooks.org"
              >Standard Ebooks: liberated ebooks, carefully produced for the
              true book lover</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 07:36:12</span
              ><span class="points-container"
                >Points: <span class="points">796</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43599637"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43599613">
          <h3>
            <a
              class="item"
              href="https://motifanalytics.medium.com/my-browser-wasmt-prepared-for-this-using-duckdb-apache-arrow-and-web-workers-in-real-life-e3dd4695623d"
              >My Browser WASM't Prepared for This. Using DuckDB, Apache Arrow
              and Web Workers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 07:31:27</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43599613"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43598600">
          <h3>
            <a
              class="item"
              href="https://spatialists.ch/posts/2025/04-05-serving-vector-tiles-fast/"
              >Serving Vector Tiles, Fast</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 02:56:16</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43598600"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43597778">
          <h3>
            <a
              class="item"
              href="https://tansanrao.com/blog/2025/04/xnu-kernel-and-darwin-evolution-and-architecture/"
              >Apple’s Darwin OS and XNU Kernel Deep Dive</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 23:46:19</span
              ><span class="points-container"
                >Points: <span class="points">408</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43597778"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43595585">
          <h3>
            <a
              class="item"
              href="https://ai.meta.com/blog/llama-4-multimodal-intelligence/"
              >The Llama 4 herd</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 18:33:56</span
              ><span class="points-container"
                >Points: <span class="points">1167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43595585"
                  >Comments</a
                ><span class="descendants">: 592</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43595283">
          <h3>
            <a
              class="item"
              href="https://planetscale.com/blog/faster-interpreters-in-go-catching-up-with-cpp"
              >Faster interpreters in Go: Catching up with C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 17:59:55</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43595283"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43595269">
          <h3>
            <a class="item" href="https://simone.org/advertising/"
              >What if we made advertising illegal?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 17:57:46</span
              ><span class="points-container"
                >Points: <span class="points">1598</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43595269"
                  >Comments</a
                ><span class="descendants">: 1185</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43593789">
          <h3>
            <a class="item" href="https://www.whatsit.today/"
              >Show HN: I built a word game. My mom thinks it's great. What do
              you think?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 14:26:02</span
              ><span class="points-container"
                >Points: <span class="points">450</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43593789"
                  >Comments</a
                ><span class="descendants">: 234</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43586043">
          <h3>
            <a
              class="item"
              href="https://www.researchgate.net/publication/26467883_NEW_THEORETICAL_RESEARCH_TRENDS_IN_CARTOGRAPHY"
              >New Theoretical Research Trends in Cartography</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-04 @ 18:23:20</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43586043"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43585742">
          <h3>
            <a
              class="item"
              href="https://corrode.dev/blog/pitfalls-of-safe-rust/"
              >Pitfalls of Safe Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-04 @ 17:55:58</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43585742"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43579104">
          <h3>
            <a class="item" href="https://lwn.net/Articles/1013776/"
              >Lessons from open source in the Mexican government</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-04 @ 06:55:11</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43579104"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43573507">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/OpenSSHConfigOrderMatters"
              >The order of files in /etc/ssh/sshd_config.d/ matters</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-03 @ 18:25:48</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43573507"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43572134">
          <h3>
            <a class="item" href="https://www.localscore.ai/download"
              >Show HN: LocalScore – Local LLM Benchmark</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-03 @ 16:32:32</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43572134"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been building an open source benchmark for measuring local
                LLM performance on your own hardware. The benchmarking tool is a
                CLI written on top of Llamafile to allow for portability across
                different hardware setups and operating systems. The website is
                a database of results from the benchmark, allowing you to
                explore the performance of different models and hardware
                configurations.
              </p>
              <p>
                Please give it a try! Any feedback and contribution is much
                appreciated. I'd love for this to serve as a helpful resource
                for the local AI community.
              </p>
              <p>
                For more check out: - Website:
                <a href="https://localscore.ai">https://localscore.ai</a> - Demo
                video:
                <a href="https://youtu.be/De6pA1bQsHU"
                  >https://youtu.be/De6pA1bQsHU</a
                >
                - Blog post:
                <a href="https://localscore.ai/blog"
                  >https://localscore.ai/blog</a
                >
                - CLI Github:
                <a
                  href="https://github.com/Mozilla-Ocho/llamafile/tree/main/localscore"
                  >https://github.com/Mozilla-Ocho/llamafile/tree/main/localsco...</a
                >
                - Website Github:
                <a href="https://github.com/cjpais/localscore"
                  >https://github.com/cjpais/localscore</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43570676">
          <h3>
            <a
              class="item"
              href="https://qwenlm.github.io/blog/qvq-max-preview/"
              >QVQ-Max: Think with Evidence</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-03 @ 14:55:17</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43570676"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43568711">
          <h3>
            <a
              class="item"
              href="https://dfarq.homeip.net/thomas-rattigan-short-lived-commodore-ceo/"
              >Thomas Rattigan, short-lived Commodore CEO</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-03 @ 12:34:37</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43568711"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43566651">
          <h3>
            <a
              class="item"
              href="http://funcall.blogspot.com/2025/04/blacksmithing-and-lisp.html"
              >Blacksmithing and Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-03 @ 08:34:11</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43566651"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43562579">
          <h3>
            <a
              class="item"
              href="https://www.newlyswissed.com/turntable-roundabout-in-switzerland/"
              >Switzerland's vinyl turntable roundabout: Unique road art
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-02 @ 22:39:46</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43562579"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43561104">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43561104"
              >For a solo funder, I think social is to connect on the
              internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-02 @ 20:26:01</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43561104"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              As an independent developer, I write code at home every day. I
              have been wondering if I am too out of the market and want to go
              out. Thinking of my social scope, it seems that my social scope is
              about housewives and church friends, and it is actually difficult
              to get in touch with more people. I shot on Twitter, etc.,
              communicating more with people on social media may be more
              important.
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
