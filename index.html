<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40554012">
          <h3>
            <a
              class="item"
              href="https://fosspost.org/there-has-never-been-a-better-time-to-switch-to-linux"
              >There Has Never Been a Better Time to Switch to Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 13:37:18</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40554012"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40553986">
          <h3>
            <a class="item" href="https://www.lungy.app/"
              >Show HN: I'm a doctor and built a responsive breathing app for
              anxiety and sleep</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 13:35:36</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40553986"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’m an NHS doctor and the founder of Pia (<a
                  href="https://www.piahealth.co"
                  >https://www.piahealth.co</a
                >) which developed Lungy (<a href="https://www.lungy.app"
                  >https://www.lungy.app</a
                >). Lungy is an iOS app that responds to breathing in real-time
                and was designed to make breathing exercises more engaging and
                beneficial to do. It’s been just over a year since Lungy
                launched (here’s the original ShowHN:
                <a href="https://news.ycombinator.com/item?id=34534615"
                  >https://news.ycombinator.com/item?id=34534615</a
                >) and it's had a huge update and complete redesign. We rebuilt
                the whole app, and added a real-time 3D soft body solver which
                gives some really cool interactions like blobs / objects that
                inflate as you breathe. We also made a version for Vision Pro,
                called 'Lungy Spaces'.
              </p>
              <p>
                My background is as a junior surgical trainee and I started
                building Lungy in 2020 during the first COVID lockdown in
                London. During COVID, there were huge numbers of patients coming
                off ventilators and patients are often given breathing exercises
                on a worksheet and disposable plastic devices called incentive
                spirometers to encourage deep breathing. This is intended to
                prevent chest infections and strengthen breathing muscles that
                have weakened. I noticed often the incentive spirometer would
                sit by the bedside, whilst the patient would be on their phone –
                this was the spark that lead to Lungy!
              </p>
              <p>
                Since making the first version we’ve made exercises fully
                customisable (you can dial in exact timings for each breath
                phase), added new breathing indicators, learning modules, e.g.
                self-care for anxiety symptoms, and lots of new visuals. The
                free version gives you access to a new breathing exercise each
                day, whilst premium ($14.99 per year, $39.99 unlimited) unlocks
                the full library of exercises, exercise data and visuals..
              </p>
              <p>
                The visuals are mostly built using Metal (a couple use
                SpriteKit) and there are lots to choose from - boids, cloth
                sims, fluid sims, a hacky DLA implementation, rigid body + soft
                body sims - each one reacts to breath and touch. The audio uses
                AudioKit with a polyphonic synth and a sequencer plays generated
                notes from a chosen scale (you can mess around with the
                sequencer and synth in Settings/Create Music). The nice thing
                about the visuals + audio being generative is that the download
                size is relatively small with no other downloads. We’re still
                working on improving the breath detection, using ML - currently,
                it uses microphone input, with optional camera input to guide
                positioning.
              </p>
              <p>
                We’re also close to finishing the medical device version -
                <a href="http://lungy.health">http://lungy.health</a> - designed
                as a pulmonary rehab platform for patients with asthma and COPD,
                it should hopefully be released in the UK early 2025.
              </p>
              <p>Thanks for reading - would love to hear any feedback!</p>
              <p>
                Lungy Version 2 here:
                <a href="https://apps.apple.com/app/apple-store/id1545223887"
                  >https://apps.apple.com/app/apple-store/id1545223887</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40553881">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/05/31/hugging-face-says-it-detected-unauthorized-access-to-its-ai-model-hosting-platform/"
              >Hugging Face detected 'unauthorized access' to its AI model
              hosting platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 13:19:47</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40553881"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40553684">
          <h3>
            <a class="item" href="https://danluu.com/microsoft-culture/"
              >Windows: A Software Engineering Odyssey</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 12:50:04</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40553684"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40553448">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2011.13127"
              >Copy-and-Patch Compilation: fast compilation algorithm for
              high-level languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 12:07:07</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40553448"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40553163">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/snowflake-breach-ticketmaster-santander-ticketek-hacked/"
              >The Ticketmaster Data Breach May Be Just the Beginning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 11:16:02</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40553163"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40552621">
          <h3>
            <a
              class="item"
              href="https://katherinemichel.github.io/portfolio/pycon-us-2024-recap.html"
              >PyCon US 2024 Recap</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 09:03:54</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40552621"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40552549">
          <h3>
            <a class="item" href="https://www.fusio-project.org/"
              >Show HN: Fusio 5.0 released – open-source API management
              platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 08:47:37</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40552549"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40551725">
          <h3>
            <a
              class="item"
              href="https://www.tbray.org/ongoing/When/202x/2024/06/01/Parable-of-the-Sofa"
              >Parable of the Sofa</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 05:57:48</span
              ><span class="points-container"
                >Points: <span class="points">363</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40551725"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40551112">
          <h3>
            <a
              class="item"
              href="http://computer-communication.blogspot.com/2007/06/unlocking-duron-and-athlon-using-pencil_08.html"
              >Unlocking the Duron and Athlon using the pencil (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 03:29:55</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40551112"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40551070">
          <h3>
            <a class="item" href="https://www.cam.ac.uk/stories/third-thumb"
              >How do our brains adapt to control an extra body part?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 03:17:02</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40551070"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40550830">
          <h3>
            <a
              class="item"
              href="https://www.audiolabs-erlangen.de/resources/MIR/FMP/C0/C0.html"
              >Python notebooks for fundamentals of music processing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-02 @ 02:20:09</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40550830"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40550059">
          <h3>
            <a class="item" href="https://github.com/distantmagic/paddler"
              >Show HN: Open-source load balancer for llama.cpp</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-01 @ 23:35:46</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40550059"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              Stateful load balancer customized for llama.cpp (with a reverse
              proxy).
            </div>
          </section>
        </section>
        <section id="40549250">
          <h3>
            <a
              class="item"
              href="https://dthompson.us/posts/lisp-icing-or-cake.html"
              >Lisp: Icing or Cake?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-01 @ 21:32:12</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40549250"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40549209">
          <h3>
            <a
              class="item"
              href="https://chemistry.berkeley.edu/news/scientific-glassblower-continues-century-old-campus-tradition"
              >Scientific glassblower continues century-old campus tradition
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-01 @ 21:26:29</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40549209"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40548498">
          <h3>
            <a
              class="item"
              href="https://maryrosecook.com/blog/post/little-lisp-interpreter"
              >Little Lisp Interpreter (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-01 @ 19:41:21</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40548498"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40544349">
          <h3>
            <a
              class="item"
              href="https://www.cyber.gc.ca/en/guidance/routers-cyber-security-best-practices-itsap80019"
              >Routers cyber security best practices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-01 @ 10:03:15</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40544349"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40542940">
          <h3>
            <a class="item" href="https://xata.io/blog/geo-distributed-postgres"
              >How to Distribute Postgres Geographically</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-01 @ 04:42:37</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40542940"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40538540">
          <h3>
            <a
              class="item"
              href="https://blog.luden.io/what-do-i-think-about-lua-after-shipping-a-project-with-60-000-lines-of-code-bf72a1328733?gi=8385ed7c6379"
              >What I think about Lua after shipping a project with 60k lines of
              code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-31 @ 18:15:17</span
              ><span class="points-container"
                >Points: <span class="points">266</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40538540"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40535868">
          <h3>
            <a
              class="item"
              href="https://www.kmjn.org/notes/message_existence.html"
              >This Message Does Not Exist</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-31 @ 14:43:42</span
              ><span class="points-container"
                >Points: <span class="points">664</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40535868"
                  >Comments</a
                ><span class="descendants">: 197</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40534740">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/05/31/headway/highways-colorado-transportation.html"
              >In Colorado, an ambitious new highway policy is not building
              them</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-31 @ 13:14:32</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40534740"
                  >Comments</a
                ><span class="descendants">: 574</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40534293">
          <h3>
            <a class="item" href="https://eugeneyan.com/writing/llm-lessons/"
              >What we've learned from a year of building with LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-31 @ 12:33:10</span
              ><span class="points-container"
                >Points: <span class="points">298</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40534293"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40533139">
          <h3>
            <a class="item" href="https://fellerts.no/projects/kintsugi.php"
              >Repairing my mug with Kintsugi</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-31 @ 09:57:19</span
              ><span class="points-container"
                >Points: <span class="points">472</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40533139"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40530719">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40530719"
              >Ask HN: How to transcribe 1000s of handwritten notes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-31 @ 01:57:25</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40530719"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
            <div class="text">
              <p>My handwriting is not great!</p>
              <p>
                None of the off the shelf solutions come even close to
                recognizing my handwriting.
              </p>
              <p>
                Can you think of anything better than just opening every single
                file and manually transcribing it?
              </p>
              <p>
                I have been thinking about training a model to first divide the
                images into lines of text. Then, it will be easier to
                transcribe, and automatically those transcriptions will be
                associated with areas of the image, in case I figure out a good
                handwriting model.
              </p>
            </div>
          </section>
        </section>
        <section id="40529098">
          <h3>
            <a class="item" href="https://www.usnc.com/core-build/"
              >Building a Reactor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 21:49:59</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40529098"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40527014">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=bKwzONOGLxs"
              >Java Language Update – a look at where the language is going by
              Brian Goetz</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 18:21:53</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40527014"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40526020">
          <h3>
            <a class="item" href="https://github.com/decrazyo/fdxb"
              >Arduino FDX-B (animal ID chip) reader built from discrete
              components</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 17:03:28</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40526020"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40523612">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/how-to-consult-an-onion-calendar"
              >How to Consult an Onion Oracle</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 13:41:36</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40523612"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40522602">
          <h3>
            <a
              class="item"
              href="https://www.lux.camera/orion-from-idea-to-launch-in-45-days/"
              >Orion – From idea to launch in 45 days</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 11:49:27</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40522602"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40522400">
          <h3>
            <a
              class="item"
              href="https://milvus.io/blog/introducing-milvus-lite.md"
              >Milvus Lite: The Lightweight Version of Milvus</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 11:17:52</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40522400"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
