<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42958656">
          <h3>
            <a
              class="item"
              href="https://opensource.web.cern.ch/cern-open-source-heritage"
              >CERN's open source heritage: Building blocks to share</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 03:26:00</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42958656"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42958474">
          <h3>
            <a
              class="item"
              href="https://www.amny.com/nyc-transit/nyc-subway-crime-plummets-ridership-jumps-2025/"
              >Subway crime plummets as ridership jumps significantly in
              congestion pricing era</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 02:58:41</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42958474"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42958218">
          <h3>
            <a
              class="item"
              href="https://www.ctvnews.ca/atlantic/new-brunswick/article/good-first-step-nb-mystery-brain-disease-patients-welcome-new-investigation/"
              >Mystery brain disease patients in New Brunswick say they welcome
              investigation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 02:19:49</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42958218"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42957823">
          <h3>
            <a
              class="item"
              href="https://nemanjatrifunovic.substack.com/p/6502-is-a-good-starting-point-for"
              >6502 Is a Good Starting Point for Beginning Assembly
              Programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 01:28:17</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42957823"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42957726">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/the-human-brain-may-contain-as-much-as-a-spoons-worth-of-microplastics-new-research-suggests-180985995/"
              >Human Brain May Contain as Much as a Spoon's Worth of
              Microplastics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 01:13:32</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42957726"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42957517">
          <h3>
            <a class="item" href="https://idiallo.com/blog/listen-mp3-is-free"
              >What does it mean that MP3 is free?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 00:41:43</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42957517"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42955613">
          <h3>
            <a
              class="item"
              href="https://github.com/dwhinham/mt32-pi/blob/075b52809e77420c6e80828825fe42430336b369/README.md"
              >It's unlikely that there will be any further releases of
              mt32-pi</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 21:42:20</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42955613"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42955356">
          <h3>
            <a
              class="item"
              href="https://scrollprize.substack.com/p/exciting-news-from-scroll-5"
              >News from Scroll 5</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 21:23:09</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42955356"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42955176">
          <h3>
            <a
              class="item"
              href="https://n0rdy.foo/posts/20250121/okta-bcrypt-lessons-for-better-apis/"
              >Okta Bcrypt incident lessons for designing better APIs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 21:10:25</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42955176"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42953508">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42953508"
              >Tell HN: Cloudflare is blocking Pale Moon and other
              non-mainstream browsers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 19:08:12</span
              ><span class="points-container"
                >Points: <span class="points">666</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42953508"
                  >Comments</a
                ><span class="descendants">: 226</span></span
              >
            </h4>
            <div class="text">
              <p>
                Cloudflare's Browser Intergrity Check/Verification/Challenge
                feature used by many websites, is denying access to users of
                non-mainstream browsers like Pale Moon.
              </p>
              <p>Users reports began on January 31:</p>
              <p>
                <a
                  href="https://forum.palemoon.org/viewtopic.php?f=3&amp;t=32045"
                  >https://forum.palemoon.org/viewtopic.php?f=3&amp;t=32045</a
                >
              </p>
              <p>
                This situation occurs at least once a year, and there is no easy
                way to contact Cloudflare. Their "Submit feedback" tool yields
                no results. A Cloudflare Community topic was flagged as "spam"
                by members of that community and was promptly locked with no
                real solution, and no official response from Cloudflare:
              </p>
              <p>
                <a
                  href="https://community.cloudflare.com/t/access-denied-to-pale-moon-desktop-browser/764330"
                  >https://community.cloudflare.com/t/access-denied-to-pale-moo...</a
                >
              </p>
              <p>
                Partial list of other browsers that are being denied access:
              </p>
              <p>Falkon, SeaMonkey, IceCat, Basilisk.</p>
              <p>
                Hacker News 2022 post about the same issue, which brought
                attention and had Cloudflare quickly patching the issue:
              </p>
              <p>
                <a href="https://news.ycombinator.com/item?id=31317886"
                  >https://news.ycombinator.com/item?id=31317886</a
                >
              </p>
              <p>
                A Cloudflare product manager declared back then: "...we do not
                want to be in the business of saying one browser is more
                legitimate than another."
              </p>
              <p>
                As of now, there is no official response from Cloudflare.
                Internet access is still denied by their tool.
              </p>
            </div>
          </section>
        </section>
        <section id="42952960">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=7xTGNNLPyMI"
              >Andrej Karpathy: Deep Dive into LLMs Like ChatGPT [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 18:29:30</span
              ><span class="points-container"
                >Points: <span class="points">358</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42952960"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42952605">
          <h3>
            <a
              class="item"
              href="https://www.sergey.fyi/articles/gemini-flash-2"
              >Ingesting PDFs and why Gemini 2.0 changes everything</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 18:05:28</span
              ><span class="points-container"
                >Points: <span class="points">670</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42952605"
                  >Comments</a
                ><span class="descendants">: 235</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42952584">
          <h3>
            <a
              class="item"
              href="https://gabrielsimmer.com/blog/archiveteam-warrior-kubernetes"
              >Running ArchiveTeam's Warrior in Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 18:04:20</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42952584"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42951511">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/ploomber/jobs"
              >Ploomber (YC W22) Is Hiring Engineers (Infra, Backend, Growth)
              and Ex-Founders</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 17:00:43</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42950790">
          <h3>
            <a
              class="item"
              href="https://www.axios.com/2025/02/04/trump-buyout-federal-workers-20000"
              >20k federal workers take "buyout" so far, official says</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 16:23:10</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42950790"
                  >Comments</a
                ><span class="descendants">: 419</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42950454">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/google-deepmind/gemini-model-updates-february-2025/"
              >Gemini 2.0 is now available to everyone</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 16:03:18</span
              ><span class="points-container"
                >Points: <span class="points">441</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42950454"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42949390">
          <h3>
            <a
              class="item"
              href="https://servo.org/blog/2025/01/31/servo-in-2024/"
              >Servo's progress in 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 15:03:09</span
              ><span class="points-container"
                >Points: <span class="points">328</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42949390"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42949277">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/podcast/episode/how-to-avoid-outrage-fatigue-and-tune-in-without-burning-out/"
              >Avoiding outrage fatigue while staying informed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 14:55:03</span
              ><span class="points-container"
                >Points: <span class="points">499</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42949277"
                  >Comments</a
                ><span class="descendants">: 490</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42949181">
          <h3>
            <a
              class="item"
              href="https://tedium.co/2025/02/05/warner-bros-youtube-full-movie-releases/"
              >Why is Warner Bros. Discovery putting old movies on YouTube?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 14:47:32</span
              ><span class="points-container"
                >Points: <span class="points">452</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42949181"
                  >Comments</a
                ><span class="descendants">: 352</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42946854">
          <h3>
            <a class="item" href="https://timkellogg.me/blog/2025/02/03/s1"
              >S1: A $6 R1 competitor?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 11:05:40</span
              ><span class="points-container"
                >Points: <span class="points">628</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42946854"
                  >Comments</a
                ><span class="descendants">: 247</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42946281">
          <h3>
            <a
              class="item"
              href="https://chriskiehl.com/article/thoughts-after-10-years"
              >Software development topics I've changed my mind on</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 09:50:30</span
              ><span class="points-container"
                >Points: <span class="points">628</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42946281"
                  >Comments</a
                ><span class="descendants">: 614</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42945146">
          <h3>
            <a class="item" href="https://gmsl.jgc.org/"
              >GNU Make Standard Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 07:30:59</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42945146"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42943271">
          <h3>
            <a
              class="item"
              href="https://www.jordanroga.com/blog/introducing-a-hexagonal-tiled-cartogram-for-u-s-counties"
              >A hexagonal-tiled cartogram for U.S. counties</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 03:18:22</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42943271"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://github.com/jordanroga/hex-cartogram/blob/main/County%20Hex%20Cartogram.csv"
                >https://github.com/jordanroga/hex-cartogram/blob/main/County...</a
              >.
            </div>
          </section>
        </section>
        <section id="42926359">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42926359"
              >Ask HN: Do you know travel blogs that have animated SVG maps of
              their travels?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 01:40:06</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42926359"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been banging my head against Google for a solid 3-4 hours
                at this point but it is pointless to try to search something
                there these days so I come here.
              </p>
              <p>
                I remember that the blogger in question was into photography and
                photographed the Te Whanganui-A-Hei (Cathedral Cove) in New
                Zealand during early morning with no people there and wrote a
                post about the process. And of course they had these small SVG
                animations of their trips at the top of their posts, with a map
                displaying the route they took, animating the path.
              </p>
              <p>
                They wrote a pretty in-depth article about how they accomplished
                this with the help of some custom JS and SVG animations too and
                I am after that article.
              </p>
              <p>
                If you know the name of the blog that would absolutely make my
                day!
              </p>
              <p>
                Please also feel free to answer if you know anything
                <i>similar</i> to the title of the blog where somebody has
                created stylized animated SVG maps of their trips and documented
                the process they used to create those.
              </p>
            </div>
          </section>
        </section>
        <section id="42917522">
          <h3>
            <a class="item" href="https://www.zompist.com/kit.html"
              >The Language Construction Kit</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-03 @ 12:31:15</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42917522"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42917306">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42917306"
              >Run-All</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-03 @ 11:56:27</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42917306"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              github.com/clovis818/run-all is a command-line tool that allows
              you to execute commands across multiple directories based on a
              customizable directory pattern. It is designed for developers and
              sysadmins who need to run repetitive tasks in multiple project
              folders, offering options to exclude directories, run commands in
              parallel, and more.
            </div>
          </section>
        </section>
        <section id="42917268">
          <h3>
            <a class="item" href="https://github.com/DiscordMessenger/dm"
              >Discord client that works on Win95*, Win98 and above</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-03 @ 11:49:49</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42917268"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42915669">
          <h3>
            <a
              class="item"
              href="https://github.com/vulnerability-lookup/vulnerability-lookup"
              >Quick correlation of vulnerabilities from various sources</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-03 @ 06:55:19</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42915669"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42905900">
          <h3>
            <a
              class="item"
              href="https://winnielim.org/journal/minimum-effective-dose/"
              >Minimum effective dose</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-02 @ 04:43:00</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42905900"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42905439">
          <h3>
            <a
              class="item"
              href="https://iopscience.iop.org/article/10.35848/1882-0786/ad59f4"
              >Polarization-dependent photoluminescence of Ce-implanted MgO and
              MgAl2O4</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-02 @ 03:19:36</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42905439"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
