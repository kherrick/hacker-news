<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44381358">
          <h3>
            <a
              class="item"
              href="https://blog.miloslavhomer.cz/p/microsoft-dependency-has-risks"
              >Microsoft Dependency Has Risks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 20:08:26</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381358"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44381297">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/a-new-pyramid-like-shape-always-lands-the-same-side-up-20250625/"
              >A new pyramid-like shape always lands the same side up</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 20:01:07</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381297"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44381292">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2506.19244"
              >Building a Monostable Tetrahedron</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 20:00:38</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381292"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44381252">
          <h3>
            <a
              class="item"
              href="https://www.folklore.org/StoryView.py?story=Negative_2000_Lines_Of_Code.txt"
              >Negative Two-Thousand Lines of Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 19:53:13</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381252"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44381168">
          <h3>
            <a class="item" href="https://www.theoffline-club.com"
              >The Offline Club</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 19:42:57</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381168"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44381144">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gaming/2025/06/games-run-faster-on-steamos-than-windows-11-ars-testing-finds/"
              >Games run faster on SteamOS than Windows 11, Ars testing finds</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 19:40:10</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381144"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44381131">
          <h3>
            <a class="item" href="https://www.qsymbolic.com"
              >A Classical RAM Design That Mimics Quantum Collapse and
              Entanglement"</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 19:39:23</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381131"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44381093">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/1025971/73f269ad3695186d/"
              >Libxml2's "no security embargoes" policy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 19:36:55</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381093"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44381091">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44381091"
              >Show HN: PLJS â€“ JavaScript for Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 19:36:50</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381091"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                Here are bencharks that show how it compares to PLV8:
                <a
                  href="https://github.com/plv8/pljs/blob/main/docs/BENCHMARKS.md"
                  >https://github.com/plv8/pljs/blob/main/docs/BENCHMARKS.md</a
                >
              </p>
              <p>
                This is the first step toward a truly light-weight, fast, and
                extensible JavaScript runtime embedded inside of Postgres. The
                initial roadmap has been published at
                <a href="https://github.com/plv8/pljs/blob/main/docs/ROADMAP.md"
                  >https://github.com/plv8/pljs/blob/main/docs/ROADMAP.md</a
                >
              </p>
              <p>
                You can join the discussion by joining the PLV8 Discord:
                <a href="https://discord.gg/XYGSCfVNBC"
                  >https://discord.gg/XYGSCfVNBC</a
                >
              </p>
              <p>
                You can find PLJS at
                <a href="https://github.com/plv8/pljs"
                  >https://github.com/plv8/pljs</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44380955">
          <h3>
            <a
              class="item"
              href="https://www.collabora.com/news-and-blog/blog/2025/06/25/coccinelle-for-rust-progress-report/"
              >Coccinelle for Rust Progress Report</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 19:20:23</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44380955"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44379792">
          <h3>
            <a class="item" href="https://lmstudio.ai/blog/lmstudio-v0.3.17"
              >LM Studio is now an MCP Host</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 17:27:35</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44379792"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44379688">
          <h3>
            <a class="item" href="https://github.com/mozilla/DeepSpeech"
              >DeepSpeech Is Discontinued (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 17:15:45</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44379688"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44379673">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/claude-powered-artifacts"
              >Build and Host AI-Powered Apps with Claude â€“ No Deployment
              Needed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 17:14:35</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44379673"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44379670">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/ideas/archive/2025/06/prisoner-populations-are-plummeting/683310/"
              >Americaâ€™s incarceration rate is in decline</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 17:14:29</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44379670"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44379606">
          <h3>
            <a
              class="item"
              href="http://genius.cat-v.org/richard-feynman/writtings/letters/problems"
              >What Problems to Solve (1966)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 17:08:44</span
              ><span class="points-container"
                >Points: <span class="points">237</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44379606"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44379509">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/furtherai/jobs"
              >FurtherAI (YC W24) Is Hiring for Software and AI Roles</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 17:00:41</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44379173">
          <h3>
            <a class="item" href="https://github.com/n0-computer/iroh"
              >Iroh: A library to establish direct connection between peers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 16:34:51</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44379173"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44379034">
          <h3>
            <a
              class="item"
              href="https://community.letsencrypt.org/t/getting-ready-to-issue-ip-address-certificates/238777"
              >Getting ready to issue IP address certificates</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 16:21:45</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44379034"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44378486">
          <h3>
            <a
              class="item"
              href="https://turtleware.eu/static/paste/wecl-test-gl/main.html"
              >Web Embeddable Common Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 15:33:20</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44378486"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44378127">
          <h3>
            <a
              class="item"
              href="https://research.roundtable.ai/proof-of-human/"
              >Bot or human? Creating an invisible Turing test for the
              internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 15:00:00</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44378127"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44377274">
          <h3>
            <a
              class="item"
              href="https://sigma-star.at/blog/2025/06/deep-down-the-rabbit-hole-bash-overlayfs-and-a-30-year-old-surprise/"
              >Deep Down the Rabbit Hole: Bash, OverlayFS, and a 30-Year-Old
              Surprise</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 13:43:59</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44377274"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44376989">
          <h3>
            <a
              class="item"
              href="https://george.mand.is/2025/06/openai-charges-by-the-minute-so-make-the-minutes-shorter/"
              >OpenAI Charges by the Minute, So Make the Minutes Shorter</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 13:17:25</span
              ><span class="points-container"
                >Points: <span class="points">360</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44376989"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44376919">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/developers/introducing-gemini-cli-open-source-ai-agent/"
              >Gemini CLI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 13:10:46</span
              ><span class="points-container"
                >Points: <span class="points">799</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44376919"
                  >Comments</a
                ><span class="descendants">: 450</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/google-gemini/gemini-cli"
                >https://github.com/google-gemini/gemini-cli</a
              >
            </div>
          </section>
        </section>
        <section id="44376362">
          <h3>
            <a class="item" href="https://www.nber.org/papers/w32604"
              >Third places and neighborhood entrepreneurship (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 12:10:21</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44376362"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44374574">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2025/06/reading-nfc-passport-chips-in-linux/"
              >Reading NFC Passport Chips in Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 07:33:59</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44374574"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44365754">
          <h3>
            <a
              class="item"
              href="https://www.programmax.net/articles/png-is-back/"
              >A new PNG spec</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-24 @ 13:01:17</span
              ><span class="points-container"
                >Points: <span class="points">405</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44365754"
                  >Comments</a
                ><span class="descendants">: 432</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44354141">
          <h3>
            <a class="item" href="https://chua.bitbucket.io"
              >Yet another insignificant programming notes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-23 @ 10:20:17</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44354141"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44353241">
          <h3>
            <a class="item" href="https://dl.acm.org/doi/10.1145/3728894"
              >LLM Hallucinations in Practical Code Generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-23 @ 07:14:09</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44353241"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44352476">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44352476"
              >I built an app to backup Live Photos from iPhone to external hard
              drives</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-23 @ 04:36:13</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44352476"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
            <div class="text">
              <p>
                The widespread problem: iPhone storage fills up crazy fast, not
                everyone has a Mac, many don't want to pay monthly for iCloud
                storage, and home NAS setups aren't realistic for most users.
                The manual approach of creating folders and selecting photos one
                by one is tedious, and keeping up with new photos becomes
                overwhelming
              </p>
              <p>
                So I built an app called BackiGo that addresses this exact pain
                point - it allows direct backup of Live Photos from iPhone to
                external hard drives, no Mac needed.
              </p>
              <p>What makes it useful:</p>
              <p>Backs up your Live Photos with all the motion intact</p>
              <p>Can restore Live Photos back to your iPhone camera roll</p>
              <p>Super easy to backup new photos</p>
              <p>
                You can browse and view all your saved Live Photos directly from
                the external drive without having to restore them first
              </p>
              <p>
                You can test it out with up to 500 photos &amp; videos backup
                before deciding if it works for your needs
              </p>
            </div>
          </section>
        </section>
        <section id="44345681">
          <h3>
            <a class="item" href="https://crescentro.se/posts/writing-drivers/"
              >Writing a basic Linux device driver when you know nothing about
              Linux drivers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-22 @ 10:29:42</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44345681"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
