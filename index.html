<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37075064">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/gym-class-by-irl-studios/jobs/futIIml-unity-engineer-tools"
              >Gym Class VR (YC W22) Is Hiring Unity Tooling Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 12:01:09</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37074589">
          <h3>
            <a
              class="item"
              href="https://daily.jstor.org/whats-causing-the-rise-of-hoarding-disorder/"
              >What’s causing the rise of hoarding disorder?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 11:11:31</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37074589"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37074452">
          <h3>
            <a
              class="item"
              href="https://groups.google.com/g/vim_dev/c/dq9Wu5jqVTw"
              >The Future of the Vim Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 10:57:30</span
              ><span class="points-container"
                >Points: <span class="points">267</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37074452"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37074177">
          <h3>
            <a
              class="item"
              href="https://www.confiant.com/news/the-yandex-leak-how-a-russian-search-giant-uses-consumer-data"
              >The Yandex Leak: How a Russian Search Giant Uses Consumer Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 10:20:01</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37074177"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37074095">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/08/10/workplace_monitoring_select_committee/"
              >Get your staff's consent before you monitor them, tech inquiry
              warns</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 10:08:10</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37074095"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37073938">
          <h3>
            <a
              class="item"
              href="https://github.com/joonspk-research/generative_agents"
              >Generative Agents: Interactive Simulacra of Human Behavior, Now
              Open Source</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 09:39:06</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37073938"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37073885">
          <h3>
            <a class="item" href="https://speed.cloudflare.com/">Speed Test</a>
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 09:30:44</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37073885"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37073768">
          <h3>
            <a
              class="item"
              href="https://vpncentral.com/russia-starts-blocking-vpn-protocols/"
              >Russia Starts Blocking VPN Protocols</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 09:12:43</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37073768"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37073701">
          <h3>
            <a class="item" href="https://gpt-unicorn.adamkdean.co.uk/"
              >GPT Unicorn has drawn a unicorn</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 09:02:50</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37073701"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37073494">
          <h3>
            <a
              class="item"
              href="https://www.vice.com/en/article/ak3jwb/unbelievable-astronomer-claims-direct-evidence-of-gravity-breaking-down"
              >'Unbelievable': Astronomer Claims 'Direct Evidence' of Gravity
              Breaking Down</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 08:28:58</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37073494"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37072588">
          <h3>
            <a
              class="item"
              href="https://maritime-executive.com/article/world-s-strangest-research-vessel-heads-for-scrapyard-after-51-years"
              >Scripps Institution of Oceanography’s FLIP vessel decommissioned
              after 60 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 06:21:04</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37072588"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37072530">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2023/aug/10/pak-n-save-savey-meal-bot-ai-app-malfunction-recipes"
              >Supermarket AI meal planner app suggests recipe that would create
              chlorine gas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 06:11:26</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37072530"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37072037">
          <h3>
            <a
              class="item"
              href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3469465"
              >Manias and Mimesis: Applying Girard’s Mimetic Theory to Financial
              Bubbles (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 04:41:18</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37072037"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37072036">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/make-viking-funeral-flatbreads"
              >How to Make Viking Funerary Flatbread</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 04:41:18</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37072036"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37071472">
          <h3>
            <a class="item" href="https://thewalrus.ca/medical-tiktok/"
              >Doctors on TikTok</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 03:10:01</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37071472"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37071300">
          <h3>
            <a
              class="item"
              href="https://wiki.makerdiary.com/nrf52840-mdk-usb-dongle/guides/ble-sniffer/"
              >Make a low-cost Bluetooth LE packet sniffer with Wireshark</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 02:45:03</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37071300"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37071160">
          <h3>
            <a
              class="item"
              href="https://hacks.mozilla.org/2023/08/autogenerating-rust-js-bindings-with-uniffi/"
              >Autogenerating Rust-JS Bindings with UniFFI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-10 @ 02:22:20</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37071160"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37068464">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/8/9/23826342/cnet-content-pruning-deleting-articles-google-seo"
              >CNET is deleting old articles to try to improve its Google Search
              ranking</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 21:10:52</span
              ><span class="points-container"
                >Points: <span class="points">643</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37068464"
                  >Comments</a
                ><span class="descendants">: 402</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37066680">
          <h3>
            <a
              class="item"
              href="https://github.com/extesy/hoverzoom/discussions/670"
              >Temptations of an open-source Chrome extension developer
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 18:28:30</span
              ><span class="points-container"
                >Points: <span class="points">977</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37066680"
                  >Comments</a
                ><span class="descendants">: 312</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37065288">
          <h3>
            <a
              class="item"
              href="https://abcnews.go.com/Entertainment/wireStory/singer-songwriter-sixto-rodriguez-subject-searching-sugarman-documentary-102133209"
              >Sixto Rodriguez, subject of 'Searching for Sugarman' documentary,
              dies at 81</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 16:41:55</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37065288"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37064843">
          <h3>
            <a
              class="item"
              href="https://johnmaeda.medium.com/whats-a-human-powered-computer-14997285111"
              >What’s a Human-Powered Computer? (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 16:12:51</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37064843"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37064822">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37064822"
              >Launch HN: Refine (YC S23) – Open-source platform for enterprise
              web apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 16:11:09</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37064822"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/refinedev/refine"
                >https://github.com/refinedev/refine</a
              >), an open-source platform for developing enterprise web
              applications rapidly. In one year since launch we have 15K active
              developers each month, and over 5K projects in production. Among
              the 5,000+ projects deployed to production, we see a lot of admin
              panels, dashboards, B2B portals and SAAS interfaces.
              <p>
                Check out our online generator at (<a
                  href="https://refine.dev/#playground"
                  >https://refine.dev/#playground</a
                >) to create a custom Refine application and download it.
              </p>
              <p>
                Before starting refine, we spent five years as a consultancy
                company building internal-facing applications for enterprise
                clients. We have seen many complex use cases where the demanded
                flexibility was much higher than what existing low-code/no-code
                solutions provide. Moving away from rigid architectures and
                pre-made components that are difficult to customize, developers
                tend to start from the scratch. This results in a significant
                waste of time and resources.
              </p>
              <p>
                In order to find a sweet spot between “starting from scratch”
                and higher level solutions, we started working on refine. After
                a couple of iterations, we came up with a “headless” solution,
                separating the UI-layer completely from the rest of the frontend
                logic. This allowed us to support multiple UI frameworks and
                custom designs out of the box.
              </p>
              <p>
                We understand the importance of frontend developers working with
                the stack and tools they love and are familiar with. So, we have
                built our project creation wizard that allows developers to mix
                and match their technology stack when creating a project.
              </p>
              <p>
                After 1.5 years of development with the great support of the
                open-source community, Refine has become a mature framework that
                allows developers to rapidly build enterprise applications and
                have 100% control over their projects.
              </p>
              <p>
                While remaining unobtrusive, Refine still saves a lot of
                development resources by eliminating repetitive tasks such as
                CRUD operations, state management, routing, authentication,
                access control, and i18n. It’s also backend-agnostic and works
                with any APIs or services.
              </p>
              <p>
                The best way to start Refine development is visiting our
                extensive documentation at (<a href="https://refine.dev/docs/"
                  >https://refine.dev/docs/</a
                >). Here, you can also find tutorials and real-life examples to
                use as a starting point for your use case.
              </p>
              <p>
                We had one successful Show HN earlier this year (<a
                  href="https://news.ycombinator.com/item?id=34515128"
                  >https://news.ycombinator.com/item?id=34515128</a
                >), and have since had several major releases and added many
                more features.
              </p>
              <p>
                Recently, we've released our enterprise edition featuring
                deployments, built-in security, backend integrations and
                auto-generated UI's. By expanding Refine's capabilities beyond
                the frontend, the enterprise edition offers a complete solution
                for the internal tooling requirements of larger organizations.
                To get more information, please see our pricing page:
                <a href="https://refine.dev/pricing/"
                  >https://refine.dev/pricing/</a
                >.
              </p>
              <p>
                If you have any questions, ideas or suggestions please share
                them with us. The team will be here all day to answer. We look
                forward to all of your comments!
              </p>
            </div>
          </section>
        </section>
        <section id="37061020">
          <h3>
            <a
              class="item"
              href="https://milkytracker.org/news/2023/07/05/version-1.04/"
              >MilkyTracker 1.04</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 11:15:21</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37061020"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37060305">
          <h3>
            <a class="item" href="https://nonzerosum.games/thetetriseffect.html"
              >The Tetris Effect</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 09:13:49</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37060305"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37060213">
          <h3>
            <a class="item" href="https://github.com/eliasdorneles/upiano"
              >Piano Emulator in Your Terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-09 @ 08:59:06</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37060213"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37047529">
          <h3>
            <a
              class="item"
              href="https://themillions.com/2023/07/braille-is-alive-well-and-ever-evolving.html"
              >Braille Is Alive, Well, and Ever-Evolving</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 11:49:59</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37047529"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37046934">
          <h3>
            <a
              class="item"
              href="https://0x1.pt/2023/08/08/subscriber-only-a-technical-post-mortem/"
              >Subscriber Only: A Technical Post Mortem</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 10:32:09</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37046934"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37046353">
          <h3>
            <a
              class="item"
              href="https://download.clojure.org/papers/clojure-hopl-iv-final.pdf"
              >A History of Clojure (2020) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 09:11:13</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37046353"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37046172">
          <h3>
            <a
              class="item"
              href="https://www.masswerk.at/nowgobang/2023/pet-keys-2001-edition"
              >Commodore PET Keys – Series 2001 Edition</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 08:43:29</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37046172"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37045803">
          <h3>
            <a
              class="item"
              href="http://jroweboy.github.io/c/asm/2015/01/26/when-is-main-not-a-function.html"
              >Main is usually a function. So then when is it not? (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-08 @ 07:47:15</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37045803"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
