<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38087917">
          <h3>
            <a class="item" href="https://www.mux.com/jobs?j=srplatform"
              >Mux (YC W16) is hiring a Sr Platform Engineer for distributed,
              scaled video infra</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 17:00:15</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38087573">
          <h3>
            <a
              class="item"
              href="https://hacks.mozilla.org/2023/10/down-and-to-the-right-firefox-got-faster-for-real-users-in-2023/"
              >Firefox Got Faster for Real Users in 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 16:39:13</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38087573"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38087448">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/10/behind-the-scenes-at-scary-fast-apples-keynote-event-shot-on-iphone/"
              >Behind the scenes: An Apple Event shot on iPhone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 16:32:37</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38087448"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38087256">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2023/oct/29/bologna-seals-off-leaning-tower-fears-tilting-too-far"
              >Bologna seals off 'leaning tower' over fears it is tilting too
              far</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 16:22:03</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38087256"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38086894">
          <h3>
            <a
              class="item"
              href="http://www.righto.com/2023/10/reverse-engineering-ethernet-backoff-on.html"
              >Reverse-engineering Ethernet backoff on the Intel 82586 network
              chip's die</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 15:59:57</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38086894"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38086518">
          <h3>
            <a
              class="item"
              href="https://planetocracy.substack.com/p/mars-cyclers"
              >Mars Cyclers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 15:38:46</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38086518"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38086227">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/new-wildlife-tracker-powers-itself-as-animals-walk-trot-and-run/"
              >New wildlife GPS tracker uses kinetic energy for power</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 15:22:32</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38086227"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38086222">
          <h3>
            <a
              class="item"
              href="https://blog.maximeheckel.com/posts/real-time-cloudscapes-with-volumetric-raymarching/"
              >Real-time dreamy Cloudscapes with Volumetric Raymarching</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 15:22:15</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38086222"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38086082">
          <h3>
            <a
              class="item"
              href="https://www.keephq.dev/post/vendor-lock-in-is-in-the-small-details"
              >Vendor lock-in in the observability space</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 15:14:02</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38086082"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38085903">
          <h3>
            <a
              class="item"
              href="https://chrome.google.com/webstore/detail/copycat/jdjbiojkklnaeoanimopafmnmhldejbg"
              >Copy webpage text, convert to Markdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 15:01:12</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38085903"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38085289">
          <h3>
            <a
              class="item"
              href="https://www.nolo.com/legal-encyclopedia/working-from-home-in-california-does-my-employer-have-to-reimburse-me-for-utilities-or-other-expenses.html"
              >California employers must reimburse remote workers for all
              necessary expenses</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 14:22:22</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38085289"
                  >Comments</a
                ><span class="descendants">: 308</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084737">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=fxMKuv0A6z4"
              >Penn and Teller's Lab Scam [video] (1990)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 13:46:58</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084737"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084572">
          <h3>
            <a class="item" href="https://www.beep.blog/io/"
              >.io considered harmful</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 13:35:04</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084572"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084516">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2023/10/us-harbors-prolific-malicious-link-shortening-service/"
              >.US harbors prolific malicious link shortening service</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 13:29:56</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084516"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084337">
          <h3>
            <a
              class="item"
              href="https://www.itpro.com/security/ransomware/coalition-of-nations-agree-to-end-ransomware-payments-to-hackers"
              >US-led coalition of nations agrees to end ransomware payments to
              hackers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 13:15:16</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084337"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084244">
          <h3>
            <a
              class="item"
              href="https://josem.co/the-beauty-of-finished-software/"
              >The beauty of finished software</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 13:07:25</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084244"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38084098">
          <h3>
            <a
              class="item"
              href="https://github.com/eugene-khyst/postgresql-event-sourcing"
              >Show HN: Light implementation of Event Sourcing using PostgreSQL
              as event store</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 12:56:43</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38084098"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <p>
                If you have a Java Spring Boot application with a PostgreSQL
                database, you can implement Event Sourcing without introducing
                new specialized databases or frameworks.
              </p>
              <p>
                If you have an application dealing with an entity called Order,
                you should adopt Event Sourcing to keep track of all changes,
                and know how the Order got into the current state.
              </p>
              <p>Event Sourcing gives you:</p>
              <p>1. the true history of the system (audit and traceability),</p>
              <p>
                2. the ability to put the system in any prior state (debugging),
              </p>
              <p>
                3. the ability to create read projections from events as needed
                to respond to new demands.
              </p>
              <p>
                There are several well-known specialized frameworks and
                databases for Event Sourcing: EventStoreDB, Marten, Eventuate,
                to name a few. But adopting a new framework or database you are
                not familiar with may stop you from trying the Event Sourcing
                pattern in your project. But you can actually implement Event
                Sourcing with a few classes and use PostgreSQL as an event
                store.
              </p>
              <p>
                The "postgresql-event-sourcing" project is a reference
                implementation of an event-sourced system that uses PostgreSQL
                as an event store built with Spring Boot. Fork the repository
                and use it as a template for your projects. Or clone the
                repository and run end-to-end tests to see how everything works
                together.
              </p>
              <p>The project describes in detail:</p>
              <p>- database model for storing events,</p>
              <p>- synchronous and asynchronous event handlers,</p>
              <p>- CQRS,</p>
              <p>- Transactional Outbox pattern,</p>
              <p>- Polling Publisher pattern,</p>
              <p>
                - optimized publisher that uses PostgreSQL LISTEN/NOTIFY
                capabilities,
              </p>
              <p>- and more.</p>
              <p>
                This project can be easily extended to comply with your domain
                model.
              </p>
              <p>
                The source code is available on GitHub &lt;<a
                  href="https://github.com/eugene-khyst/postgresql-event-sourcing"
                  >https://github.com/eugene-khyst/postgresql-event-sourcing</a
                >&gt;.
              </p>
            </div>
          </section>
        </section>
        <section id="38083588">
          <h3>
            <a class="item" href="https://fullystacked.net/posts/av1/"
              >AV1 video codec gains broader hardware support</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 12:16:35</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38083588"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38083484">
          <h3>
            <a class="item" href="https://darkhotels.co"
              >I've overlayed stays on a light pollution satellite map</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 12:04:58</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38083484"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38083045">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Bcachefs-Merged-Linux-6.7"
              >Bcachefs Merged into the Linux 6.7 Kernel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 11:19:30</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38083045"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38082980">
          <h3>
            <a
              class="item"
              href="https://www.sciencedaily.com/releases/2023/10/231030110005.htm"
              >Genetic heritage of the Denisovans may have left its mark on our
              mental health</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 11:13:05</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38082980"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38082621">
          <h3>
            <a class="item" href="https://github.com/formbricks/formbricks"
              >Show HN: Formbricks â€“ Open-source alternative to Typeform and
              Sprig</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 10:27:09</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38082621"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38081633">
          <h3>
            <a
              class="item"
              href="https://stackdiary.com/german-court-bans-linkedin-from-ignoring-do-not-track-signals/"
              >German court prohibits LinkedIn from ignoring "Do Not Track"
              signals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 08:22:42</span
              ><span class="points-container"
                >Points: <span class="points">942</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38081633"
                  >Comments</a
                ><span class="descendants">: 455</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38080367">
          <h3>
            <a
              class="item"
              href="https://flak.tedunangst.com/post/two-hackers-one-keyboard-two-ways"
              >Two hackers one keyboard two ways</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 04:35:14</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38080367"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38079512">
          <h3>
            <a
              class="item"
              href="https://people.ischool.berkeley.edu/~nick/aaronson-oracle/"
              >Can you use your "free will"? Try your hand</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 02:36:23</span
              ><span class="points-container"
                >Points: <span class="points">280</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38079512"
                  >Comments</a
                ><span class="descendants">: 229</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38078063">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/10/apple-unveils-m3-m3-pro-and-m3-max-the-most-advanced-chips-for-a-personal-computer/"
              >Apple unveils M3, M3 Pro, and M3 Max</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-31 @ 00:30:14</span
              ><span class="points-container"
                >Points: <span class="points">898</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38078063"
                  >Comments</a
                ><span class="descendants">: 935</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38071920">
          <h3>
            <a
              class="item"
              href="https://www.eetimes.com/nvidia-trains-llm-on-chip-design/"
              >Nvidia Trains LLM on Chip Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 16:43:13</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38071920"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38069623">
          <h3>
            <a
              class="item"
              href="https://www.youtube.com/playlist?list=PLcGZbzUhfcJbEazYYKUgdnEskZa5PX86N"
              >Building and programming a 16-bit Intel x86 breadboard computer
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 14:06:21</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38069623"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38057888">
          <h3>
            <a
              class="item"
              href="https://github.com/antonmedv/walk/releases/tag/v1.7.0"
              >Walk a Terminal File Manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-29 @ 12:22:35</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38057888"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38057338">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20121113003010/http://www.engadget.com/2012/11/12/nintendo-wii-u-proprietary-disc/"
              >A close look at the round-edged Wii U proprietary discs (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-29 @ 10:48:43</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38057338"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
