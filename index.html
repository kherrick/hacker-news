<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38008395">
          <h3>
            <a
              class="item"
              href="https://news.harvard.edu/gazette/story/2023/10/heated-yoga-may-reduce-depression-in-adults/"
              >Heated yoga may reduce depression in adults</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 02:19:27</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38008395"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38008194">
          <h3>
            <a
              class="item"
              href="https://www.caltech.edu/about/news/ligo-surpasses-the-quantum-limit"
              >LIGO Surpasses the Quantum Limit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 01:51:35</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38008194"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38008181">
          <h3>
            <a
              class="item"
              href="https://www.pcmag.com/news/toyota-inks-deal-to-mass-produce-solid-state-ev-batteries-with-932-mile"
              >Toyota Inks Deal to Mass Produce Solid State EV Batteries with
              932-Mile Range</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 01:49:41</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38008181"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38007028">
          <h3>
            <a class="item" href="https://portal.alien.top"
              >Show HN: Fediverser Portal – Bring your subreddits to Lemmy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 23:18:49</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38007028"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                There are two sides to this project. The first one is that I
                have setup a Lemmy instance (alien.top) which is mirroring some
                of the reddit content from subreddits that I wanted to follow
                <i>with the comments</i>. The difference from most mirroring
                bots is that, instead of one single bot account mirroring all
                content, the system creates one account for each reddit user
                that is being mirrored.
              </p>
              <p>
                The <i>other</i> part of this idea which I believe is more
                interesting: reddit users can <i>take over</i> their own
                mirrored bot account on this Lemmy instance. The instance itself
                does not use the regular registration process, but instead
                authenticates via Reddit OAuth. If you login through through the
                "Portal", we can then grab your subscribed subreddits and (when
                it can) find the corresponding Lemmy communities and subscribe
                you to those automatically. At the moment there are not that
                Lemmy communities that are being mirrored because I've been the
                sole user, but hopefully if more people sign-up, it will help to
                create the network effects and more instance admins will be
                interested in hosting these "fediversed" communities.
              </p>
              <p>
                All of the code is open source (<a
                  href="https://github.com/mushroomlabs/fediverser"
                  >https://github.com/mushroomlabs/fediverser</a
                >) and I'm more than willing to help people getting their own
                instances if they don't want to use alien.top itself.
              </p>
              <p>Questions and any type of feedback is always welcome!</p>
            </div>
          </section>
        </section>
        <section id="38006814">
          <h3>
            <a class="item" href="https://restaurants.rip/"
              >Show HN: Restaurants in Peace – leave a remembrance for a closed
              restaurant</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 22:54:17</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38006814"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
            <div class="text">
              <p>
                It’s been a project long in the making - it started in 2019,
                before everything shut down/changed. The list of closed
                restaurants I found - for New York only - was already really
                long. So now (that I have time to work on it at recurse.com) it
                really felt like I needed to do something about it.
              </p>
              <p>
                When a restaurant (or any business) shows up on Google Maps as
                “permanently closed”, in that bright red font, there’s always a
                tiny bit of a pang of sadness. It’s definitely more than a pang
                when you look for a place you loved and expected to visit again.
              </p>
              <p>
                The project’s “aesthetic” is inspired by early 2000s funeral
                homes’ websites. The combination of funeral + restaurant is what
                made it click for me. Maybe what we long for is a place to share
                our losses? Maybe.
              </p>
              <p>Thanks for checking it out! :)</p>
              <p>
                [0]
                <a href="https://restaurants.rip/about"
                  >https://restaurants.rip/about</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="38006512">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2023/10/30/the-mysteries-bill-watterson-book-review"
              >Life After “Calvin and Hobbes”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 22:24:20</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38006512"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38005461">
          <h3>
            <a
              class="item"
              href="https://fastify.dev/docs/latest/Guides/Prototype-Poisoning/"
              >Prototype poisoning (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 20:57:38</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38005461"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38004721">
          <h3>
            <a
              class="item"
              href="https://www.nbcbayarea.com/investigations/googles-waymo-safety-study-on-driverless-cars/3311188/"
              >Waymo says insurance data shows its driverless cars are safer
              than humans</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 20:08:26</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38004721"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38004699">
          <h3>
            <a
              class="item"
              href="https://docs.google.com/document/d/1iL0fYmMmariFoSvLd9U5nPVH1uFKC7bvVasUcYq78So/edit"
              >The OSI Deprogrammer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 20:07:08</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38004699"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38004178">
          <h3>
            <a class="item" href="https://gittuf.github.io/"
              >Gittuf – a security layer for Git</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 19:31:59</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38004178"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38002752">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/autos-transportation/california-suspends-gm-cruises-driverless-autonomous-vehicle-permits-2023-10-24/"
              >California suspends Cruise's autonomous vehicle deployment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 17:55:33</span
              ><span class="points-container"
                >Points: <span class="points">754</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38002752"
                  >Comments</a
                ><span class="descendants">: 915</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38002305">
          <h3>
            <a
              class="item"
              href="https://www.ligo.caltech.edu/news/ligo20231023"
              >LIGO Surpasses the Quantum Limit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 17:25:01</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38002305"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38001978">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/livedocs/jobs/IqaU8e4-marketing-coordinator"
              >Livedocs (YC W22) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 17:01:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38001784">
          <h3>
            <a
              class="item"
              href="https://mchap.io/that-time-the-city-of-seattle-accidentally-gave-me-32m-emails-for-40-dollars4997.html"
              >The City of Seattle accidentally gave me 32M emails for $40
              (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 16:47:57</span
              ><span class="points-container"
                >Points: <span class="points">268</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38001784"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38000843">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-10-24/meta-sued-by-california-states-over-harmful-youth-marketing"
              >Meta sued by states over harmful youth marketing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 15:48:22</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38000843"
                  >Comments</a
                ><span class="descendants">: 372</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38000824">
          <h3>
            <a
              class="item"
              href="https://www.figma.com/blog/server-side-sandboxing-containers-and-seccomp/#j1WRe"
              >Server-side sandboxing: Containers and seccomp</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 15:47:24</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38000824"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38000551">
          <h3>
            <a class="item" href="https://brilliant.org/challenges/halfsies/"
              >Halfsies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 15:30:45</span
              ><span class="points-container"
                >Points: <span class="points">416</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38000551"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38000154">
          <h3>
            <a
              class="item"
              href="https://words.filippo.io/dispatches/parameters/"
              >Why we don’t generate elliptic curves every day</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 15:00:51</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38000154"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37999380">
          <h3>
            <a
              class="item"
              href="https://www.moderntreasury.com/journal/reconciliation-is-a-knapsack-problem"
              >Reconciliation is a knapsack problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 14:09:10</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37999380"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37999164">
          <h3>
            <a
              class="item"
              href="https://www.stackfix.com/blog/the-ideation-flywheel"
              >The Ideation Flywheel: A mental model for deciding which startup
              ideas to pursue</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 13:50:11</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37999164"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37999035">
          <h3>
            <a class="item" href="https://animatedai.github.io/">Animated AI</a>
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 13:39:54</span
              ><span class="points-container"
                >Points: <span class="points">572</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37999035"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37998923">
          <h3>
            <a class="item" href="https://codeforces.com/blog/entry/85638"
              >Voronoi Diagram and Delaunay Triangulation in O(nlog(n))
              (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 13:29:54</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37998923"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37998147">
          <h3>
            <a
              class="item"
              href="https://resobscura.substack.com/p/there-should-be-more-cash-prizes"
              >There should be more cash prizes for solving historical
              mysteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 12:25:34</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37998147"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37985489">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2023/Oct/23/embeddings/"
              >Embeddings: What they are and why they matter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-23 @ 13:42:12</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37985489"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37975526">
          <h3>
            <a class="item" href="https://www.around.com/bugs/"
              >Chasing bugs in the electronic village (1992)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-22 @ 14:09:47</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37975526"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37975413">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=lFlu60qs7_4"
              >One Line in the Oldest Math Text Hinted at Hidden Universes
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-22 @ 13:56:36</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37975413"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37975306">
          <h3>
            <a class="item" href="https://icecube.wisc.edu/science/icecube/"
              >IceCube – South Pole Neutrino Observatory</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-22 @ 13:45:51</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37975306"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37975285">
          <h3>
            <a
              class="item"
              href="https://www.eejournal.com/article/before-computers-were-logic-diagrams-and-machines/"
              >Before computers were logic diagrams and machines</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-22 @ 13:43:58</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37975285"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37974897">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=ZUY2AtBD6Sk"
              >Development Secrets of the Original Kirby [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-22 @ 12:47:08</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37974897"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37974865">
          <h3>
            <a class="item" href="https://javednissar.ca/wait-equation"
              >The Wait Equation and AI Investment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-22 @ 12:42:44</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37974865"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
