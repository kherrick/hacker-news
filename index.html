<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43028200">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/hillelwayne/archive/are-efficiency-and-horizontal-scalability-at-odds/"
              >Are Efficiency and Horizontal Scalability at Odds?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 18:27:41</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43028200"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43027579">
          <h3>
            <a
              class="item"
              href="https://nautil.us/the-hallucinatory-thoughts-of-the-dying-mind-1189807/"
              >The Hallucinatory Thoughts of the Dying Mind</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 17:33:07</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43027579"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43027335">
          <h3>
            <a
              class="item"
              href="https://eli.lipsitz.net/posts/introducing-gamebub/"
              >Show HN: Game Bub – open-source FPGA retro emulation handheld</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 17:11:25</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43027335"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                Over the past ~1.5 years, I built an open-source FPGA retro
                emulation handheld that can play Game Boy, Game Boy Color, and
                Game Boy Advance cartridges. To my knowledge, there isn't an
                existing open-source FPGA emulator that can play physical
                cartridges like this.
              </p>
              <p>
                One of my main goals was to do all of the pieces myself, and be
                able to understand every component of it, so I designed my own
                PCB, wrote the firmware, wrote a Game Boy and Game Boy Advance
                emulator for the FPGA (using the Chisel HDL), and designed a
                3D-printed case.
              </p>
              <p>
                I detailed the design and development process in the linked
                post. It's quite long, but there are a lot of pictures and
                videos.
              </p>
              <p>
                Code and design files available on GitHub:
                <a href="https://github.com/elipsitz/gamebub"
                  >https://github.com/elipsitz/gamebub</a
                >, and an overview of the architecture:
                <a
                  href="https://github.com/elipsitz/gamebub/blob/handheld/docs/architecture.md"
                  >https://github.com/elipsitz/gamebub/blob/handheld/docs/archi...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43027266">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/5g-bandwidth"
              >It's Time to Rethink 6G</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 17:04:22</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43027266"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43027230">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/artie/jobs/CM1sVks-business-operations"
              >Artie (YC S23) Is Hiring Business Operations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 17:00:48</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43027150">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-025-00444-1"
              >Record-breaking neutrino is most energetic ever detected</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 16:52:57</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43027150"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43026934">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/markets/deals/inside-collapse-nissan-hondas-60-billion-mega-deal-2025-02-12/"
              >How Nissan and Honda's $60B merger talks collapsed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 16:32:37</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43026934"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43026920">
          <h3>
            <a
              class="item"
              href="https://www.worksinprogress.news/p/the-prophet-of-parking"
              >The Prophet of Parking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 16:31:04</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43026920"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43026590">
          <h3>
            <a
              class="item"
              href="https://www.techtalksweekly.io/p/100-most-watched-software-engineering"
              >Most-Watched Software Engineering Talks of 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 15:55:20</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43026590"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43026036">
          <h3>
            <a
              class="item"
              href="https://github.com/nexsol-technologies/pgassistant"
              >PgAssistant: OSS tool to help devs understand and optimize PG
              performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 15:01:40</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43026036"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43025645">
          <h3>
            <a
              class="item"
              href="https://perthirtysix.com/visualizing-data-is-an-art"
              >Visualizing Data Is an Art – We Should Treat It Like One</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 14:17:48</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43025645"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43024961">
          <h3>
            <a class="item" href="https://deadbeef.sourceforge.io/"
              >DeaDBeeF: The Ultimate Music Player</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 12:58:13</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43024961"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43024540">
          <h3>
            <a
              class="item"
              href="https://blog.archive.org/2025/02/12/vanishing-culture-punch-card-knitting/"
              >Vanishing Culture: Punch Card Knitting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 12:11:33</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43024540"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43024221">
          <h3>
            <a
              class="item"
              href="https://brutecat.com/articles/leaking-youtube-emails"
              >Leaking the email of any YouTube user for $10,000</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 11:19:42</span
              ><span class="points-container"
                >Points: <span class="points">894</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43024221"
                  >Comments</a
                ><span class="descendants">: 278</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43024173">
          <h3>
            <a
              class="item"
              href="https://maknee.github.io/blog/2025/League-Data-Scraping/"
              >League of Legends data scraping the hard and tedious way for
              fun</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 11:11:38</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43024173"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43023634">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2111.12800"
              >Tiny Pointers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 09:43:48</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43023634"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43023554">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/ai/2025/02/us-and-uk-refuse-to-sign-ai-safety-declaration-at-summit/"
              >US and UK refuse to sign AI safety declaration at summit</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 09:33:29</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43023554"
                  >Comments</a
                ><span class="descendants">: 205</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43023508">
          <h3>
            <a
              class="item"
              href="https://paulbutler.org/2025/smuggling-arbitrary-data-through-an-emoji/"
              >Smuggling arbitrary data through an emoji</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 09:24:08</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43023508"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43023464">
          <h3>
            <a class="item" href="https://github.com/hotrod462/Mikey"
              >Show HN: Mikey – No bot meeting notetaker for Windows</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 09:17:02</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43023464"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43021677">
          <h3>
            <a
              class="item"
              href="https://localfirstweb.dev/blog/2023-05-29-i-wrote-a-static-web-page"
              >I wrote a static web page and accidentally started a community
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 03:51:37</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43021677"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43020983">
          <h3>
            <a
              class="item"
              href="https://bessstillman.substack.com/p/the-year-i-didnt-survive"
              >The year I didn't survive</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-12 @ 02:07:52</span
              ><span class="points-container"
                >Points: <span class="points">770</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43020983"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43019136">
          <h3>
            <a class="item" href="https://drio.github.io/unixmagic/"
              >Show HN: Mapping the Unix Magic Poster – An Interactive
              Annotation Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-11 @ 22:22:37</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43019136"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                We've discussed the Unix Magic poster before (<a
                  href="https://news.ycombinator.com/item?id=27029196"
                  >https://news.ycombinator.com/item?id=27029196</a
                >). Like many of you, I love this poster and all the Unix
                references hidden in it.
              </p>
              <p>
                I built this as a static site that lets us annotate the Unix
                Magic poster by placing markers on references and adding
                descriptions to explain them. I've added a few so far, but
                there's much more to document.
              </p>
              <p>
                What I love about this approach is that contributions happen not
                just on the site itself but also through PRs, where we can
                discuss and refine the details of each reference. Feel free to
                send a PR!
              </p>
              <p>
                Code:
                <a href="https://github.com/drio/unixmagic"
                  >https://github.com/drio/unixmagic</a
                >
                Live site:
                <a href="https://drio.github.io/unixmagic"
                  >https://drio.github.io/unixmagic</a
                >
              </p>
              <p>
                Would love feedback, suggestions, and PRs from the community!
              </p>
              <p>Thanks!</p>
              <p>—drd</p>
            </div>
          </section>
        </section>
        <section id="43013615">
          <h3>
            <a
              class="item"
              href="https://haterade.substack.com/p/i-tasted-hondas-spicy-rodent-repelling"
              >I tasted Honda’s spicy rodent-repelling tape and I will do it
              again (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-11 @ 15:08:08</span
              ><span class="points-container"
                >Points: <span class="points">1479</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43013615"
                  >Comments</a
                ><span class="descendants">: 419</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43013431">
          <h3>
            <a
              class="item"
              href="https://www.backblaze.com/blog/backblaze-drive-stats-for-2024/"
              >Backblaze Drive Stats for 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-11 @ 14:55:45</span
              ><span class="points-container"
                >Points: <span class="points">581</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43013431"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43008587">
          <h3>
            <a class="item" href="https://github.com/vagos/llm-sort"
              >Show HN: Sort lines semantically using llm-sort</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-11 @ 03:25:25</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43008587"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>You can do things like:</p>
              <p>
                cat names.txt | llm sort -q "Which one of these names is best
                for a pet seagull?"
              </p>
              <p>
                cat books.txt | llm sort -q "Which book is more related to basic
                vs. advanced CS topics?"
              </p>
              <p>
                I see a lot of potential marrying LLMs with classic UNIX
                interfaces.
              </p>
            </div>
          </section>
        </section>
        <section id="42999598">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-01-durable-plastic-sustainability-makeover-polymerization.html"
              >Durable plastic gets a sustainability makeover in novel
              polymerization process</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 12:44:27</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42999598"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42996656">
          <h3>
            <a
              class="item"
              href="https://www.scattered-thoughts.net/writing/the-missing-tier-for-query-compilers/"
              >The missing tier for query compilers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-10 @ 03:36:05</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42996656"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42992368">
          <h3>
            <a class="item" href="https://sprocketfox.io/xssfox/2025/02/09/ido/"
              >Bad Smart Watch Authentication</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-09 @ 18:18:47</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42992368"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42990103">
          <h3>
            <a
              class="item"
              href="https://www.fastcompany.com/90747313/steve-jobs-lessons-tony-fadell-build-book-excerpt"
              >Storytelling lessons I learned from Steve Jobs (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-09 @ 11:53:31</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42990103"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42987848">
          <h3>
            <a
              class="item"
              href="https://blog.gingerbeardman.com/2025/02/08/automating-the-cleaning-of-macos-specific-files-on-eject/"
              >Automating the cleaning of macOS-specific ( ._ and .DS_Store)
              files on Eject</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-09 @ 02:00:06</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42987848"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
