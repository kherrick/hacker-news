<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38754785">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38754785"
              >GoGoGrandparent (YC S16) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 17:00:44</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                The position: FULLY REMOTE | Full-time | US, UK, or able to work
                4+ hours overlap with mainland US (UK time working hours also
                OK) | $100k to $120k
              </p>
              <p>
                Build high-quality, robust engineering at the rarest of things -
                a Silicon Valley startup that is both wholesome AND profitable.
                We have 8-figure revenue, are YC-backed, and growing fast.
              </p>
              <p>
                Tech stack (<i>required): Back-end heavy (Node</i>, Typescript<i
                  >, MySQL</i
                >, REST*+GraphQL), front-end (Vue), deploy (AWS, Docker/K8s)
              </p>
              <p>
                Minimum 6 years experience (mostly Node). If full-stack, you
                must be strongest on the backend.
              </p>
              <p>2-stage interview process.</p>
              <p>
                If you want to help older adults and people with disabilities,
                send your LinkedIn/CV to william@gogograndparent.com (keep it
                brief) or apply at
                <a
                  href="https://www.ycombinator.com/companies/gogograndparent/jobs"
                  >https://www.ycombinator.com/companies/gogograndparent/jobs</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="38754581">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/science/archive/2023/12/american-chestnut-perfect-tree-restoration/676927/"
              >America Lost the Chestnut, Its One Perfect Tree</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 16:37:18</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38754581"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38754125">
          <h3>
            <a
              class="item"
              href="https://purplecandy.github.io/kibibyte-pipboy/"
              >Show HN: I made a Fallout inspired PIP-Boy portfolio</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 15:34:27</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38754125"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text"><p>It's only opitimised for desktops</p></div>
          </section>
        </section>
        <section id="38754087">
          <h3>
            <a
              class="item"
              href="https://www.filfre.net/2023/12/putting-the-j-in-the-rpg-part-3-playing-final-fantasy-vii-or-old-man-yells-at-jrpg/"
              >Putting the "J" in the RPG, Part 3: Playing Final Fantasy VII</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 15:28:54</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38754087"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38753814">
          <h3>
            <a
              class="item"
              href="https://informedinfrastructure.com/91930/holcim-launches-phoenix-the-first-of-its-kind-circular-3d-printed-concrete-bridge/"
              >A circular 3D-printed concrete bridge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 14:55:57</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38753814"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38753791">
          <h3>
            <a
              class="item"
              href="https://earthsky.org/astronomy-essentials/everything-you-need-to-know-quadrantid-meteor-shower/"
              >2024 Quadrantid meteor shower to peak January 3-4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 14:52:36</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38753791"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38753694">
          <h3>
            <a
              class="item"
              href="https://www.pv-magazine.com/2023/12/21/germany-hits-80-gw-milestone/"
              >Germany hits 80 GW milestone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 14:34:18</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38753694"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38753567">
          <h3>
            <a
              class="item"
              href="https://huggingface.co/cognitivecomputations/dolphin-2_6-phi-2"
              >Dolphin-2_6-Phi-2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 14:12:23</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38753567"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38753048">
          <h3>
            <a
              class="item"
              href="https://www.enlightenment.org/news/2022-12-23-enlightenment-0.26.0"
              >Enlightenment 0.26</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 12:29:18</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38753048"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38752693">
          <h3>
            <a
              class="item"
              href="https://meyerweb.com/eric/thoughts/2023/12/21/pixelating-live-with-svg/"
              >Pixelating Live with SVG</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 11:07:14</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38752693"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38752691">
          <h3>
            <a
              class="item"
              href="https://nonnullish.pages.dev/posts/resetting-the-timer-in-my-toothbrush/"
              >Resetting the Timer in My Toothbrush</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 11:06:43</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38752691"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38752385">
          <h3>
            <a class="item" href="https://generals.io/"
              >Generals.io – Capture enemy generals to defeat them</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 09:38:09</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38752385"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38752060">
          <h3>
            <a
              class="item"
              href="https://blog.kerollmops.com/meilisearch-expands-search-power-with-arroy-s-filtered-disk-ann"
              >Meilisearch Expands Search Power with Arroy's Filtered Disk
              ANN</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 08:16:44</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38752060"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38751452">
          <h3>
            <a
              class="item"
              href="https://web.mit.edu/jmorzins/www/C-H-speech.html"
              >Bill Watterson Commencement Speech (1990)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 05:47:51</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38751452"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38750807">
          <h3>
            <a
              class="item"
              href="http://oldvcr.blogspot.com/2023/12/when-power-macintosh-ran-netware.html"
              >When the Power Macintosh Ran NetWare (Featuring Wormhole and
              Cyberpunk)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 03:26:05</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38750807"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38750459">
          <h3>
            <a
              class="item"
              href="https://railsatscale.com/2023-12-19-irb-for-ruby-3-3/"
              >Unveiling the big leap in Ruby 3.3's IRB</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 02:15:56</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38750459"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38750411">
          <h3>
            <a
              class="item"
              href="https://aviation.stackexchange.com/questions/738/can-microsoft-flight-simulator-help-me-learn-to-fly-or-make-me-a-better-pilot"
              >Can Microsoft Flight Simulator help me learn to fly or make me a
              better pilot?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-24 @ 02:08:13</span
              ><span class="points-container"
                >Points: <span class="points">363</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38750411"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38749434">
          <h3>
            <a
              class="item"
              href="https://github.com/cumulo-autumn/StreamDiffusion"
              >StreamDiffusion: A pipeline-level solution for real-time
              interactive generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-23 @ 23:42:54</span
              ><span class="points-container"
                >Points: <span class="points">335</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38749434"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38748370">
          <h3>
            <a class="item" href="https://artofelectronics.net/"
              >The Art of Electronics (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-23 @ 21:23:59</span
              ><span class="points-container"
                >Points: <span class="points">356</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38748370"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38747710">
          <h3>
            <a class="item" href="https://smoores.gitlab.io/storyteller/"
              >Show HN: An open-source, self-hostable synced narration platform
              for ebooks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-23 @ 20:11:58</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38747710"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <p>
                Storyteller is a self-hosted platform for ebooks with synced
                narration. This is basically self-hosted WhisperSync, for anyone
                familiar with that Amazon product.
              </p>
              <p>
                It's currently made up of two self-hostable backend systems and
                a mobile app for reading and listening to the books it produces.
                Technically it uses an open spec, EPUB 3's "Media Overlay", for
                syncing the narration, but very few ebook apps actually support
                Media Overlays, and even fewer work well and have nice
                interfaces.
              </p>
              <p>
                The mobile app is available on the Apple App Store as
                "Storyteller Reader", and I plan to release it for Android as
                well early next year.
              </p>
              <p>Anyway, I hope someone finds this interesting or useful!</p>
            </div>
          </section>
        </section>
        <section id="38745668">
          <h3>
            <a class="item" href="https://udel.edu/~mm/xmas/">Xmas.c (1988)</a>
          </h3>
          <section>
            <h4>
              <span>2023-12-23 @ 16:56:46</span
              ><span class="points-container"
                >Points: <span class="points">531</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38745668"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38742021">
          <h3>
            <a
              class="item"
              href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2981r1.html"
              >Improving our safety with a physical quantities and units
              library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-23 @ 06:01:29</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38742021"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38741982">
          <h3>
            <a
              class="item"
              href="http://plumshell.com/2023/12/23/having-a-game-im-really-into-makes-every-day-incredibly-enjoyable/"
              >Having a Game I'm into Makes Every Day Enjoyable</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-23 @ 05:52:23</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38741982"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38732825">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/nature.2013.12615"
              >Earthquakes make gold veins in an instant (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 10:21:37</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38732825"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38732717">
          <h3>
            <a class="item" href="https://github.com/mozilla/sccache"
              >Mozilla sccache: ccache with cloud storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 10:02:31</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38732717"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38732520">
          <h3>
            <a
              class="item"
              href="https://forum.lazarus.freepascal.org/index.php?topic=65612.0"
              >Lazarus IDE 3.0 Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 09:28:59</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38732520"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38731862">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/north-america-big-map"
              >A cartographer drew a freehand map of North America (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 07:32:31</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38731862"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38731402">
          <h3>
            <a
              class="item"
              href="https://trofi.github.io/posts/295-ssh-over-https.html"
              >SSH over HTTPS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 06:02:57</span
              ><span class="points-container"
                >Points: <span class="points">313</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38731402"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38718857">
          <h3>
            <a
              class="item"
              href="https://www.vox.com/down-to-earth/2022/11/30/23473062/plant-mimicry-boquila-trifoliolata"
              >The mystery of the mimic plant (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-21 @ 10:28:18</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38718857"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38718457">
          <h3>
            <a
              class="item"
              href="https://garyodernichts.blogspot.com/2023/01/looking-into-stadia-controller.html"
              >Looking into the Stadia Controller Bluetooth Mode Website</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-21 @ 09:11:00</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38718457"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
