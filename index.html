<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36340439">
          <h3>
            <a
              class="item"
              href="https://floridapolitics.com/archives/618230-gov-desantis-signs-car-dealership-protection-bill-banning-most-direct-to-consumer-auto-sales/"
              >DeSantis signs car dealership bill banning most
              direct-to-consumer auto sales</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 13:46:38</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36340439"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36339777">
          <h3>
            <a
              class="item"
              href="https://github.com/faster-cpython/ideas/blob/main/3.13/README.md"
              >Our Plan for Python 3.13</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 12:55:55</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36339777"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36339253">
          <h3>
            <a
              class="item"
              href="https://industrydecarbonization.com/news/cements-future-could-be-a-combination-of-carbon-capture-and-electrification.html"
              >Cement's future could be a combination of Carbon Capture and
              Electrification</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 12:02:11</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36339253"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36339236">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/jetpack-aviation/jobs/vZY8DUc-chief-engineer-turbine-powered-vtol-aircraft"
              >JetPack Aviation (YC W19) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 12:00:30</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36338979">
          <h3>
            <a
              class="item"
              href="https://abcnews.go.com/Technology/wireStory/2-men-helped-run-popular-pirating-website-megaupload-100099005"
              >Men who helped run Megaupload sentenced to prison in New
              Zealand</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 11:33:22</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36338979"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36338902">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-06-network-channels-saturate-youtube-pro-bolsonaro.html"
              >Network of channels tried to saturate YouTube with pro-Bolsonaro
              content</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 11:23:45</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36338902"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36338873">
          <h3>
            <a
              class="item"
              href="https://hasen.substack.com/p/the-stupid-programmer-manifesto"
              >The Stupid Programmer Manifesto</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 11:20:15</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36338873"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36338870">
          <h3>
            <a
              class="item"
              href="https://www.spiegel.de/politik/deutschland/arzneimittel-reform-karl-lauterbach-will-drugchecking-bundesweit-einfuehren-a-b642b609-9149-47bc-a013-11476d54e96f"
              >Germany wants to legalize quality control of illegal drugs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 11:20:01</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36338870"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36338784">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/society/2023/jun/15/guardian-bans-all-gambling-advertising"
              >The Guardian bans all gambling advertising</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 11:08:39</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36338784"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36338529">
          <h3>
            <a class="item" href="https://www.lurklurk.org/effective-rust/"
              >Effective Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 10:29:16</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36338529"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36338484">
          <h3>
            <a
              class="item"
              href="https://worldsensorium.com/bioacoustics-finding-the-voices-of-other-species/"
              >Bioacoustics: Finding the Voices of Other Species</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 10:21:37</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36338484"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36338365">
          <h3>
            <a
              class="item"
              href="https://fennel.ai/blog/vector-search-in-200-lines-of-rust/"
              >FANN: Vector Search in 200 Lines of Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 10:04:43</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36338365"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36337828">
          <h3>
            <a class="item" href="https://zed.dev/blog/open-sourcing-zed-on-zed"
              >Building a platform that open sources itself</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 08:36:07</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36337828"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36337500">
          <h3>
            <a
              class="item"
              href="https://this-week-in-rust.org/blog/2023/06/14/this-week-in-rust-499/"
              >This Week in Rust 499</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 07:37:28</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36337500"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36337473">
          <h3>
            <a
              class="item"
              href="https://michaelnielsen.org/ddi/how-to-crawl-a-quarter-billion-webpages-in-40-hours/"
              >How to crawl a quarter billion webpages in 40 hours (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 07:33:37</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36337473"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36336748">
          <h3>
            <a
              class="item"
              href="https://ghiculescu.substack.com/p/11-years-of-hosting-a-saas"
              >Lessons Learned from 11 Years of Hosting a SaaS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 05:24:48</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36336748"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36336112">
          <h3>
            <a
              class="item"
              href="https://www.espressif.com/sites/default/files/documentation/ESP32-C3%20Wireless%20Adventure.pdf"
              >ESP32-C3 Wireless Adventure: A Comprehensive Guide to IoT
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 03:42:26</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36336112"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36335581">
          <h3>
            <a
              class="item"
              href="https://www.berkeleyscanner.com/2023/06/12/uc-berkeley-crime/uc-berkeley-skeleton-found-2021-clark-kerr-human-remains/"
              >Man found UC Berkeley skeleton in 2021</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 02:11:17</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36335581"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36335104">
          <h3>
            <a
              class="item"
              href="https://calnewport.com/on-the-slow-productivity-of-john-wick/"
              >On the slow productivity of John Wick</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 01:04:46</span
              ><span class="points-container"
                >Points: <span class="points">283</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36335104"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36334912">
          <h3>
            <a
              class="item"
              href="https://www.supercluster.com/editorial/seti-scientists-to-devise-plan-for-lunar-listening-station/"
              >SETI scientists to devise plan for lunar listening station</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 00:38:20</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36334912"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36330972">
          <h3>
            <a
              class="item"
              href="https://yonom.substack.com/p/native-json-output-from-gpt-4"
              >Native JSON Output from GPT-4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-14 @ 19:07:43</span
              ><span class="points-container"
                >Points: <span class="points">550</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36330972"
                  >Comments</a
                ><span class="descendants">: 232</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36326525">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36326525"
              >Launch HN: Credal.ai (YC W23) – Data Safety for Enterprise AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-14 @ 14:26:55</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36326525"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.credal.ai/">https://www.credal.ai/</a>). We
              provide a Chat UI and APIs that enforce PII redaction, audit
              logging, and data access controls for companies that want to use
              LLMs with their corporate data from Google Docs, Slack, or
              Confluence. There’s a demo video here:
              <a
                href="https://www.loom.com/share/2b5409fd64464dc9b5b6277f2be4e90f?sid=7a728d97-58ac-4355-9c87-75eaf12b0775"
                >https://www.loom.com/share/2b5409fd64464dc9b5b6277f2be4e90f?...</a
              >.
              <p>
                One big thing enterprises and businesses are worried about with
                LLMs is “what’s happening to my data”? The way we see it, there
                are three big security and privacy barriers companies need to
                solve:
              </p>
              <p>
                1. Controlling what data goes to whom: the basic stuff is just
                putting controls in place around customer and employee PII, but
                it can get trickier when you also want to be putting controls in
                place around business secrets, so companies can ensure the Coca
                Cola recipe doesn’t accidentally leave the company.
              </p>
              <p>
                2. Visibility: Enterprise IT wants to know exactly what data was
                shared by whom, when, at what time, and what the model responded
                with (not to mention how much the request cost!). Each provider
                gives you a piece of the puzzle in their dashboard, but getting
                all this visibility per request from either of the main
                providers currently requires writing code yourself.
              </p>
              <p>
                3. Access Controls: Enterprises have lots of documents that for
                whatever reason cannot be shared internally to everyone. So how
                do I make sure employees can use AI with this stuff, without
                compromising the sensitivity of the data?
              </p>
              <p>
                Typically this pain is something that is felt most acutely by
                Enterprise IT, but also of course by the developers and business
                people who get told not to build the great stuff they can
                envision. We think it’s critical to solve these issues since the
                more visibility and control we can give Enterprise IT about how
                data is used, the more we can actually build on top of these
                APIs and start applying some of the awesome capabilities of the
                foundation models across every business problem.
              </p>
              <p>
                You can easily grab data from sources like Google Docs via their
                APIs, but for production use cases, you have to respect the
                permissions on each Google Doc, Confluence Page, Slack channel
                etc. This gets tricky when these systems combine some
                permissions defined totally inside their product, with
                permissions that are inherited from the company’s SSO provider
                (often Okta or Azure AD). Respecting all these permissions
                becomes both hard and vital as the number of employees and tools
                accessing the data grows.
              </p>
              <p>
                The current state of the art is to use a vector database like
                Pinecone, Milvus, or Chroma, integrate your internal data with
                those systems, and then when a user asks a question, dynamically
                figure out which bits are relevant to the user’s question and
                send those to the AI as part of the prompt. We handle all this
                automatically for you (using Milvus for now, which we host
                ourselves), including the point and click connectors for your
                data (Google Docs/Sheets, Slack, Confluence with many more
                coming soon). You can use that data through our UI already and
                we’re in the process of adding this search functionality to the
                API as well.
              </p>
              <p>
                There’s other schlep work that devs would rather not worry
                about: building out request level audit logs, staying on top of
                the rapidly changing API formats from these providers,
                implementing failover for when these heavily overburdened APIs
                go down etc, We think individual devs should not have to do
                these themselves, but the foundation model providers are
                unlikely to provide consistent, customer centric approaches for
                them. The PII detection piece in some ways is the easiest -
                there are a lot of good open source models for doing this, and
                companies using Azure OpenAI and AWS Bedrock seem less concerned
                with it anyway. We expect that the emphasis companies place on
                the redactions we provide may actually go down over time, while
                the emphasis on unified, consistent audit logging and data
                access controls will increase.
              </p>
              <p>
                Right now we have three plans: a free tier (which is admittedly
                very limited but intended to give you a feel for the product),
                the business plan which starts at $500pm which gets you access
                to the data integration as well as the most powerful models like
                GPT 4 32k, Anthropic 100k etc, and an enterprise plan which
                starts at $5000pm, which is a scaled up version of the business
                tier and lets you go on-prem (more details on each plan are on
                the website). You can try the free tier self-serve, but we
                haven’t yet built out fully self service onboarding for the paid
                plans so for now it is a “book a meeting” button, apologies!
                (But it only takes 5 minutes and if you want it, we can fully
                onboard you in the meeting itself).
              </p>
              <p>
                When Jack and I started Credal, we actually set out to solve a
                different problem: an ‘AI Chief of Staff’ that could read your
                documents and task trackers, and guide your strategic decision
                making. We knew that data security was going to be a critical
                problem for enterprises. Jack and I were both deep in the
                Enterprise Data Security + AI space before Credal, so we
                naturally took a security first approach to building out our AI
                Chief of Staff. But in reality, when we started showing the
                product to customers, we learned pretty fast that the ‘Chief of
                Staff’ features were at best nice to have, and the security
                features were what they were actually excited by. So we stripped
                the product back to basics, and built out the thing our
                customers actually needed. Since then we’ve signed a bunch of
                customers and thousands of users, which has been really
                exciting.
              </p>
              <p>
                Now that our product is concretely helping a bunch of people at
                work, is SOC 2 T1 Compliant, and is ready for anyone to just
                walk up and use, we’re super excited to share it with the Hacker
                News community, which Jack and I have been avid readers of for a
                decade now. It’s still a very early product (the private beta
                opened in March), but we can’t wait to get your feedback and see
                how we can make it even better!
              </p>
            </div>
          </section>
        </section>
        <section id="36325986">
          <h3>
            <a
              class="item"
              href="https://rwmj.wordpress.com/2023/06/14/i-booted-linux-292612-times/"
              >I booted Linux 293k times in 21 hours</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-14 @ 13:54:33</span
              ><span class="points-container"
                >Points: <span class="points">758</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36325986"
                  >Comments</a
                ><span class="descendants">: 250</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36319025">
          <h3>
            <a class="item" href="https://dl.acm.org/doi/pdf/10.1145/3591246"
              >Conflict-Driven Synthesis for Layout Engines</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 23:19:33</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36319025"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36318281">
          <h3>
            <a class="item" href="https://github.com/martinpiper/BDD6502"
              >Behaviour Driven Development with 6502 code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 22:10:06</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36318281"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36315978">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/collection/san-francisco-calamity"
              >Eyewitness Accounts of the 1906 San Francisco Earthquake</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 19:53:05</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36315978"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36315529">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=4gNYTqn3qRc"
              >Quake's lightning gun bug explained</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 19:22:24</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36315529"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36312232">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/06/13/magazine/old-magazines.html"
              >To Understand the Past, Pick Up an Old Magazine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 16:03:59</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36312232"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36311871">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2106.06981"
              >Thinking Like Transformers (2021) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 15:40:13</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36311871"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36306337">
          <h3>
            <a
              class="item"
              href="https://blog.ceejbot.com/posts/reduce-friction/"
              >Reduce Friction</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-13 @ 06:32:41</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36306337"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
