<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39106480">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/united-airlines-ceo-boeing-manufacturing-problems-4090ea6176ef59e382dd18e9522596bc"
              >United Airlines CEO says the airline will consider alternatives
              to Boeing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 17:27:24</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39106480"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39106278">
          <h3>
            <a
              class="item"
              href="https://uk.pcmag.com/news/150577/amazon-fined-35-million-in-france-over-overly-intrusive-employee-surveillance-in-its-warehouses"
              >Amazon Fined $35M in France over 'Overly Intrusive'
              Surveillance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 17:16:19</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39106278"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39106224">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/parabon-nanolabs-dna-face-models-police-facial-recognition/"
              >Cops Used DNA to Predict Suspects Face and Tried to Run Facial
              Recognition on It</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 17:13:11</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39106224"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39106050">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39106050"
              >Hightouch (YC S19) Is Hiring a Lead Front End Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 17:00:16</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                We are looking for a senior frontend engineer with the ability
                to develop production-ready applications and a passion for
                building a great user experience. This role will be the primary
                owner on the frontend for several new products we’ve launched
                recently, giving it significant ownership and room for impact.
              </p>
              <p>
                As a key member of the frontend team, you will also play a
                crucial role in shaping best practices within our engineering
                organization. You will have the opportunity to mentor other
                frontend engineers, make important technical decisions, and
                establish the standard for our user experience.
              </p>
              <p>
                <a href="https://boards.greenhouse.io/hightouch/jobs/4981337004"
                  >https://boards.greenhouse.io/hightouch/jobs/4981337004</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39105906">
          <h3>
            <a
              class="item"
              href="https://www.malwarebytes.com/blog/news/2024/01/the-mother-of-all-breaches-26-billion-records-found-online"
              >“The mother of all breaches”: 26 billion records found online</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 16:50:28</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39105906"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39105626">
          <h3>
            <a
              class="item"
              href="https://9to5google.com/2024/01/23/samsung-expands-diy-repair-program-galaxy-s23-fold-5/"
              >Samsung heavily expands DIY repair program, adds Galaxy S23 and
              Fold 5 in US</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 16:33:36</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39105626"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39105114">
          <h3>
            <a
              class="item"
              href="https://blog.mozilla.org/en/products/4-reasons-to-try-mozillas-new-firefox-linux-package-for-ubuntu-and-debian-derivatives/"
              >Mozilla's new Firefox Linux package for Ubuntu and Debian
              derivatives</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 16:00:19</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39105114"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39104363">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/review/framework-laptop-16"
              >Framework Laptop 16 Delivers Great Linux Support and
              Performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 15:12:13</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39104363"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39103419">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2401.09514"
              >Is the emergence of life an expected phase transition in the
              evolving universe?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 14:06:03</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39103419"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39103412">
          <h3>
            <a
              class="item"
              href="https://www.livescience.com/space/asteroids/scientists-discover-near-earth-asteroid-hours-before-it-exploded-over-berlin"
              >Scientists discover near-Earth asteroid hours before it exploded
              over Berlin</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 14:05:37</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39103412"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39103093">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/architecture/legends-tower-ao/"
              >Proposed Oklahoma skyscraper gets redesign to become USA's new
              tallest building</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 13:34:15</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39103093"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39102577">
          <h3>
            <a class="item" href="https://www.loro.dev/blog/loro-richtext"
              >Introduction to Loro's Rich Text CRDT</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 12:40:16</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39102577"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39102069">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/another-of-ancient-romes-mysterious-12-sided-objects-has-been-found-in-england-180983632/"
              >Another mysterious Roman dodecahedron has been unearthed in
              England</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 11:33:44</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39102069"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39102002">
          <h3>
            <a
              class="item"
              href="https://www.rawrlab.com/godot_nintendo_switch_free_port.html"
              >Free Godot Engine for Official Switch Developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 11:26:58</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39102002"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39101828">
          <h3>
            <a
              class="item"
              href="https://leebriggs.co.uk/blog/2019/02/07/why-are-we-templating-yaml"
              >Why the fuck are we templating YAML? (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 10:58:41</span
              ><span class="points-container"
                >Points: <span class="points">350</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39101828"
                  >Comments</a
                ><span class="descendants">: 482</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39101682">
          <h3>
            <a
              class="item"
              href="https://qdrant.tech/blog/series-a-funding-round/"
              >Qdrant, the Vector Search Database, raised $28M in a Series A
              round</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 10:34:38</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39101682"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39101165">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/make-coffee-moka-pot"
              >The Humble Brilliance of Italy's Moka Coffee Pot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 09:13:08</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39101165"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39099980">
          <h3>
            <a class="item" href="https://github.com/rajnandan1/kener"
              >Show HN: Built a self hosted clean status page and batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 05:36:07</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39099980"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
            <div class="text">
              Status pages have been the way they have seen the mid 2010s. There
              are few new ones but they are paid. So I decided to build this
              using svelte + sveltekit. It has all the necessary features. Few
              are yet to be built. Do check it out
            </div>
          </section>
        </section>
        <section id="39099759">
          <h3>
            <a class="item" href="https://www.hawaiiseaglider.org/"
              >The Hawai'I Seaglider Initiative – A New Approach to Travel
              Between the Islands</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 04:49:58</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39099759"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39098603">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/01/22/science/space/arno-a-penzias-dead.html"
              >Arno A. Penzias, 90, Dies; Nobel Physicist Confirmed Big Bang
              Theory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 02:05:46</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39098603"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39096138">
          <h3>
            <a class="item" href="https://vimeo.com/802502826"
              >Zag Smalltalk (2022) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 22:04:31</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39096138"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39093927">
          <h3>
            <a
              class="item"
              href="https://huggingface.co/spaces/Synanthropic/reading-analog-gauge"
              >Show HN: Simply Reading Analog Gauges – GPT4, CogVLM Can't</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 19:11:26</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39093927"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39093682">
          <h3>
            <a class="item" href="https://www.noemamag.com/feral-intelligence/"
              >Feral Minds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 18:56:08</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39093682"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39092505">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gaming/2024/01/modder-recreates-game-boy-advance-games-using-the-audio-from-crash-sounds/"
              >Modder re-creates Game Boy Advance games using the audio from
              crash sounds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 17:39:13</span
              ><span class="points-container"
                >Points: <span class="points">540</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39092505"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39091867">
          <h3>
            <a class="item" href="https://www.hillelwayne.com/post/randomness/"
              >An RNG that runs in your brain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 17:00:44</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39091867"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39088018">
          <h3>
            <a
              class="item"
              href="http://minikanren.org/minikanren-and-prolog.html"
              >Differences Between miniKanren and Prolog</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 10:20:54</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39088018"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39087170">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/pc-components/cpus/china-planning-1600-core-chips-that-use-an-entire-wafer-similar-to-american-company-cerebras-wafer-scale-design"
              >China planning 1600-core chips that use an entire wafer –
              'wafer-scale' designs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 07:20:29</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39087170"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39086334">
          <h3>
            <a class="item" href="https://iter.ca/post/gh-sig-pwn/"
              >Forging signed commits on GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 04:49:26</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39086334"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39084177">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=5TPBesaSkZ8"
              >Reverse Engineering the TouchBar Screen and MIPI DSI Primer
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-21 @ 23:33:53</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39084177"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39081876">
          <h3>
            <a
              class="item"
              href="https://bitbytebit.substack.com/p/the-size-of-your-backlog-is-inversely"
              >Backlog size is inversely proportional to how often we talk to
              customers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-21 @ 19:18:00</span
              ><span class="points-container"
                >Points: <span class="points">324</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39081876"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
