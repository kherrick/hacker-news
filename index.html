<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44661914">
          <h3>
            <a
              class="item"
              href="https://playgama.com/blog/general/boost-html5-game-performance-with-webassembly/"
              >Boost HTML5 Game Performance with WebAssembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 17:45:03</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44661914"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44661912">
          <h3><a class="item" href="https://www.ai.gov/">AI.gov</a></h3>
          <section>
            <h4>
              <span>2025-07-23 @ 17:44:53</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44661912"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44661846">
          <h3>
            <a class="item" href="https://www.aaedmusa.com/projects/cara"
              >Cara â€“ High Precision Robot Dog Using Rope</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 17:38:20</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44661846"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44661785">
          <h3>
            <a class="item" href="https://buf.build/blog/hyperpb"
              >Hyperpb: 10x faster dynamic Protobuf parsing that's faster than
              generated code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 17:32:37</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44661785"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44661682">
          <h3>
            <a class="item" href="https://tpl.house/">The Promised LAN</a>
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 17:24:32</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44661682"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44661607">
          <h3>
            <a class="item" href="https://nullprogram.com/blog/2014/12/23/"
              >Interactive Programming in C (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 17:16:35</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44661607"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44661527">
          <h3>
            <a
              class="item"
              href="https://machinelearning.apple.com/research/fast-vision-language-models"
              >FastVLM: Efficient Vision Encoding for Vision Language Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 17:09:47</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44661527"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44661420">
          <h3>
            <a class="item" href="https://www.optery.com/careers/"
              >Optery (YC W22) Is Hiring in Engineering, Legal, Sales, Marketing
              (U.S., Latam)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 17:01:14</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44660736">
          <h3>
            <a class="item" href="https://bookhead.net/"
              >Show HN: The missing link of a bookstore's tech stack</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 16:04:30</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44660736"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built Bookhead because I used to work as a bookseller and I
                wasn't happy with the software options when I decided to sell my
                own collection online (with the hopes of one day growing so I
                can open my own brick &amp; mortar). So I decided to make my own
                bookselling app...a classic hacker distraction.
              </p>
              <p>
                Bookhead has two main parts: 1. an inventory management app that
                allows a bookseller to list their books anywhere they want to
                sell books (like Squarespace, Biblio, eBay, Shopify (coming
                soon!), etc) 2. an e-commerce platform with a CMS for selling
                books and letting a store control their online brand
              </p>
              <p>
                I have a very exciting roadmap that I'm not ready to fully
                reveal, but it's all based on books. I'm building a sorta
                Zapier-like platform for independent booksellers. Everything is
                so fragmented and disconnected, which makes it hard for
                booksellers to do their work. I'm hoping to change that. I have
                a blog post that lays out my vision here:
                <a href="https://bookhead.net/blog/fragmented/"
                  >https://bookhead.net/blog/fragmented/</a
                >
              </p>
              <p>
                The current iteration is like "data engineering as a service for
                books." A book is a powerful thing. I'm hoping to give a
                bookstore everything they need to sell books online. Inventory,
                e-commerce, marketing, etc. It's a crowded market but I've had
                fun making the bookselling app that I believe should exist.
              </p>
              <p>
                If you know any booksellers, please let them know about this!
                I'm onboarding my first customer right now and the biggest
                bottleneck is the other bookselling software providers, despite
                my intention to collaborate instead of compete. It's frustrating
                to wait for two weeks for a point of sale provider to setup an
                integration. It's almost like they don't care about their
                customers. Some providers even require ethernet cables for their
                software...still partying like it's 1999. Perfect for
                early-adopter booksellers frustrated with current tech who
                understand the power of automation.
              </p>
              <p>
                I'm currently looking for funding so I can focus on this
                full-time. My biggest problem right now is time (aka money)
                because I have to sell my time to make rent etc, and can't focus
                on this project like I need to. I've gotten good validation from
                booksellers and other technically savvy folks in the industry
                (I've heard from two different companies that they've considered
                building something like this), so I believe I have something
                valuable. I'm not interested in funding from somebody who
                doesn't share my love for books or doesn't support my mission:
                help people use technology to promote literature. I believe that
                literature is one of humanityâ€™s most prized creations, and we
                can use technology as a tool to keep this gift alive.
              </p>
              <p>
                Please email me at sam@bookhead.net if you know of booksellers
                who might want to be an early adopter, or know of any funding
                opportunities that might be a good fit.
              </p>
            </div>
          </section>
        </section>
        <section id="44660519">
          <h3>
            <a class="item" href="https://zed.dev/blog/disable-ai-features"
              >You Can Now Disable All AI Features in Zed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 15:45:15</span
              ><span class="points-container"
                >Points: <span class="points">336</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44660519"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44660437">
          <h3>
            <a
              class="item"
              href="https://magazine.uc.edu/editors_picks/recent_features/armstrong/moonrocks.html"
              >Trip to moon required Apollo 11 crew to sign US Customs
              declaration to enter US</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 15:37:40</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44660437"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44659921">
          <h3>
            <a
              class="item"
              href="https://hazelweakly.me/blog/stop-building-ai-tools-backwards/"
              >Stop Building AI Tools Backwards</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 14:56:31</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44659921"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44659822">
          <h3>
            <a
              class="item"
              href="https://www.perl.com/article/proxmox-donates-to-tprf/"
              >Proxmox Donates â‚¬10k to the Perl and Raku Foundation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 14:48:22</span
              ><span class="points-container"
                >Points: <span class="points">228</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44659822"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44659712">
          <h3>
            <a
              class="item"
              href="https://www.worksinprogress.news/p/tram-trains"
              >Tram Trains</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 14:37:12</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44659712"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44659661">
          <h3>
            <a
              class="item"
              href="https://github.com/KemingHe/python-dependency-manager-companion-mcp-server"
              >Show HN: Self-updating MCP server for official pip, uv, poetry
              and conda docs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 14:32:23</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44659661"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44659019">
          <h3>
            <a
              class="item"
              href="https://michael-prokop.at/blog/2025/07/20/what-to-expect-from-debian-trixie-newintrixie/"
              >What to Expect from Debian/Trixie</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 13:27:38</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44659019"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44658978">
          <h3>
            <a
              class="item"
              href="https://github.com/manticoresoftware/manticoresearch"
              >Manticore Search: Fast, efficient, drop-in replacement for
              Elasticsearch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 13:23:49</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44658978"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44658973">
          <h3>
            <a
              class="item"
              href="https://blog.ydb.tech/the-surprising-grpc-client-bottleneck-in-low-latency-networks-and-how-to-get-around-it-69d6977a1d02"
              >The Surprising gRPC Client Bottleneck in Low-Latency Networks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 13:23:20</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44658973"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44658909">
          <h3>
            <a class="item" href="https://www.blacksmith.sh/blog/cache"
              >Reverse engineering GitHub Actions cache to make it fast</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 13:17:43</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44658909"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44658820">
          <h3>
            <a
              class="item"
              href="https://radicle.xyz/2025/07/23/using-radicle-ci-for-development"
              >Using Radicle CI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 13:09:01</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44658820"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44657727">
          <h3>
            <a
              class="item"
              href="https://www.cerebras.ai/press-release/cerebras-launches-qwen3-235b-world-s-fastest-frontier-ai-model-with-full-131k-context-support"
              >Cerebras launches Qwen3-235B, achieving 1.5k tokens per second</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 10:51:51</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44657727"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44657433">
          <h3>
            <a
              class="item"
              href="https://rtpg.co/2025/06/28/checking-out-sys-remote-exec/"
              >Checking Out CPython 3.14's remote debugging protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 09:57:25</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44657433"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44655921">
          <h3>
            <a class="item" href="https://queue.acm.org/detail.cfm?id=3746174"
              >When Is WebAssembly Going to Get DOM Support?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 05:16:24</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44655921"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44638304">
          <h3>
            <a
              class="item"
              href="https://idiallo.com/blog/sql-injection-as-a-feature"
              >SQL Injection as a Feature</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-21 @ 17:59:23</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44638304"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44632045">
          <h3>
            <a
              class="item"
              href="https://scallywag.software/vim/blog/simd-perlin-noise-i"
              >SIMD Perlin Noise: Beating the Compiler with SSE</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-21 @ 05:28:15</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44632045"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44631042">
          <h3>
            <a
              class="item"
              href="https://pixelmoondust.neocities.org/archives/archivedtiles/backgroundsindex"
              >Geocities Backgrounds</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-21 @ 01:42:22</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44631042"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://pixelmoondust.neocities.org/archives/archivedtiles"
                >https://pixelmoondust.neocities.org/archives/archivedtiles</a
              >
            </div>
          </section>
        </section>
        <section id="44626359">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/ChecklistsAreHardButGood"
              >Checklists are hard (but still a good thing)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-20 @ 15:51:15</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44626359"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44622637">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/e17647f0-4c3b-49b4-a031-b56158bbb3b8"
              >AI groups spend to replace low-cost 'data labellers' with
              high-paid experts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-20 @ 07:02:03</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44622637"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44620577">
          <h3>
            <a
              class="item"
              href="https://zeux.io/2010/11/29/optimizations-that-arent/"
              >Optimizations That Aren't</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-19 @ 23:49:24</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44620577"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44619835">
          <h3>
            <a
              class="item"
              href="https://blog.th0m.as/misc/fingerprint-reversing/"
              >Reversing a Fingerprint Reader Protocol (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-19 @ 22:02:37</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44619835"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
