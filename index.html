<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44985131">
          <h3>
            <a
              class="item"
              href="https://blog.thunderbird.net/2025/08/tbpro-august-2025-update/"
              >Thunderbird Pro August 2025 Update</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 14:29:40</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44985131"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44985028">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cvg04gm92d3o"
              >US to review all 55M visas to check if holders broke rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 14:20:27</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44985028"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44984096">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44984096"
              >Launch HN: Inconvo (YC S23) – AI agents for customer-facing
              analytics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 12:59:07</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44984096"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <a href="https://inconvo.com">https://inconvo.com</a>), a platform
              that makes it easy to build and deploy AI analytics agents into
              your SaaS products, so your customers can quickly interact with
              their data.
              <p>
                There’s a demo video at
                <a href="https://www.youtube.com/watch?v=4wlZL3XGWTQ"
                  >https://www.youtube.com/watch?v=4wlZL3XGWTQ</a
                >
                and a live demo at
                <a href="https://demo.inconvo.ai/">https://demo.inconvo.ai/</a>
                (no signup required). Docs are at
                <a href="https://inconvo.com/docs">https://inconvo.com/docs</a>.
              </p>
              <p>
                SaaS products typically offer dashboards and reports, which work
                for high-level metrics but are clunky for drill-downs and slow
                for ad-hoc questions. Modern users, shaped by tools like
                ChatGPT, now expect a similar degree of speed and flexibility
                when getting insights from their data. To meet these
                expectations, you need an AI analytics agent, but these are
                painful to develop and manage.
              </p>
              <p>
                Inconvo is a platform built from the ground up for developers
                building AI agents for customer-facing analytics. We make it
                simple to expose data to Inconvo by connecting to SQL databases.
                We offer a semantic model to create a layer that governs data
                access and defines business logic, conversation logs to track
                user interactions, and a developer-friendly API for easy
                integration. For observability we show a trace for each agent
                response to make agent behaviour easily debuggable.
              </p>
              <p>
                We didn’t start out building Inconvo, initially we built a
                developer productivity SaaS from which we pivoted. Our favourite
                feature of that product was its analytics agent, and we knew
                that building one was a big enough problem to solve on its own
                so we decided to build a developer tool to do so.
              </p>
              <p>
                Our API is designed for multi-tenant databases, allowing you to
                pass session information as context. This instructs the agent to
                only analyse data relevant to the specific tenant making the
                request.
              </p>
              <p>
                Most of our competitors are BI tools primarily designed for
                internal analytics with limited embedding options through iFrame
                or unintuitive APIs.
              </p>
              <p>
                If you’re concerned about AI SQL generation, we are too. In our
                opinion, AI agents for customer-facing analytics shouldn’t
                generate and run raw SQL without validation. Instead, our agents
                generate structured query objects that are programmatically
                validated to guarantee they request only the data allowed within
                the context of the request. Then we send validated objects to
                our QueryEngine which converts the object to SQL. With this
                approach we ensure a bounded set of possible SQL that can be
                generated, which stops the agent from hallucinating and running
                rouge queries.
              </p>
              <p>
                Our pricing is upfront and available on our website. You can try
                the platform for free without a credit card.
              </p>
              <p>
                If you want to try out the full product, you can sign up for
                free at
                <a href="https://auth.inconvo.ai/en/signup"
                  >https://auth.inconvo.ai/en/signup</a
                >. As mentioned, our sandbox demo is at
                <a href="https://demo.inconvo.ai/">https://demo.inconvo.ai/</a>,
                and there’s a video at
                <a href="https://youtu.be/4wlZL3XGWTQ"
                  >https://youtu.be/4wlZL3XGWTQ</a
                >.
              </p>
              <p>
                We're really interested in any feedback you have so please share
                your thoughts and ideas in the comments, as we aim to make this
                tool as developer-friendly as possible. Thanks!
              </p>
            </div>
          </section>
        </section>
        <section id="44983986">
          <h3>
            <a
              class="item"
              href="https://terriblesoftware.org/2025/08/22/the-management-skill-nobody-talks-about/"
              >All managers make mistakes; good managers acknowledge and
              repair</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 12:50:39</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44983986"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44983570">
          <h3>
            <a
              class="item"
              href="https://promptql.io/blog/being-confidently-wrong-is-holding-ai-back"
              >Being “Confidently Wrong” is holding AI back</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 12:14:35</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44983570"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44983364">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2025/08/what-about-using-relshare-url-to-expose-sharing-intents/"
              >What about using rel="share-url" to expose sharing intents?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 11:49:08</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44983364"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44982681">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/articles/cq68j5g2nr1o"
              >4chan will refuse to pay daily online safety fines, lawyer tells
              BBC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 10:02:21</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44982681"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44982491">
          <h3>
            <a
              class="item"
              href="https://blog.habets.se/2025/07/Go-is-still-not-good.html"
              >Go is still not good</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 09:25:23</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44982491"
                  >Comments</a
                ><span class="descendants">: 298</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44982409">
          <h3>
            <a class="item" href="https://labplot.org/"
              >LabPlot: Free, open source and cross-platform Data Visualization
              and Analysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 09:11:26</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44982409"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44980865">
          <h3>
            <a
              class="item"
              href="https://blog.habets.se/2025/04/io-uring-ktls-and-rust-for-zero-syscall-https-server.html"
              >Io_uring, kTLS and Rust for zero syscall HTTPS server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 03:51:44</span
              ><span class="points-container"
                >Points: <span class="points">337</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44980865"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44980339">
          <h3>
            <a class="item" href="https://gwern.net/everything"
              >Everything is correlated (2014–23)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 02:05:53</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44980339"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44980004">
          <h3>
            <a class="item" href="https://www.begaydocrime.com/"
              >Control shopping cart wheels with your phone (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-22 @ 00:59:04</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44980004"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.youtube.com/watch?v=fBICDODmCPI"
                >https://www.youtube.com/watch?v=fBICDODmCPI</a
              >
            </div>
          </section>
        </section>
        <section id="44979107">
          <h3>
            <a
              class="item"
              href="https://www.fertrevino.com/docs/gpt5_medhelm.pdf"
              >From GPT-4 to GPT-5: Measuring progress through MedHELM [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 22:52:14</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44979107"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
            <div class="text">
              <p>
                I found this to be an interesting finding. Here are the detailed
                results:
                <a href="https://www.fertrevino.com/docs/gpt5_medhelm.pdf"
                  >https://www.fertrevino.com/docs/gpt5_medhelm.pdf</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44978073">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/text-ai/jobs/OJBr0v2-founding-full-stack-engineer"
              >Text.ai (YC X25) Is Hiring Founding Full-Stack Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 21:04:39</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44977645">
          <h3>
            <a
              class="item"
              href="https://pydevtools.com/blog/uv-format-code-formatting-comes-to-uv-experimentally/"
              >Code formatting comes to uv experimentally</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 20:26:44</span
              ><span class="points-container"
                >Points: <span class="points">303</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44977645"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44977189">
          <h3>
            <a class="item" href="https://www.hillelwayne.com/post/python-abc/"
              >Crimes with Python's Pattern Matching (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 19:47:02</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44977189"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44976764">
          <h3>
            <a class="item" href="https://api-docs.deepseek.com/news/news250821"
              >DeepSeek-v3.1</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 19:06:09</span
              ><span class="points-container"
                >Points: <span class="points">627</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44976764"
                  >Comments</a
                ><span class="descendants">: 188</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44976568">
          <h3>
            <a
              class="item"
              href="https://github.com/ghostty-org/ghostty/pull/8289"
              >AI tooling must be disclosed for contributions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 18:49:57</span
              ><span class="points-container"
                >Points: <span class="points">673</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44976568"
                  >Comments</a
                ><span class="descendants">: 414</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44976468">
          <h3>
            <a
              class="item"
              href="https://giansegato.com/essays/probabilistic-era"
              >Building AI products in the probabilistic era</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 18:42:10</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44976468"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44973375">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2507.00191"
              >Beyond sensor data: Foundation models of behavioral data from
              wearables</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 14:39:45</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44973375"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44972213">
          <h3>
            <a
              class="item"
              href="https://www.journals.uchicago.edu/doi/10.1086/735665"
              >How well does the money laundering control system work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 12:58:17</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44972213"
                  >Comments</a
                ><span class="descendants">: 308</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44972151">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/08/21/aws_ceo_entry_level_jobs_opinion/"
              >AWS CEO says using AI to replace junior staff is 'Dumbest thing
              I've ever heard'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 12:53:16</span
              ><span class="points-container"
                >Points: <span class="points">1503</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44972151"
                  >Comments</a
                ><span class="descendants">: 637</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44971850">
          <h3>
            <a
              class="item"
              href="https://www.construction-physics.com/p/how-does-the-us-use-water"
              >How does the US use water?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 12:21:38</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44971850"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44971845">
          <h3>
            <a
              class="item"
              href="https://blog.trailofbits.com/2025/08/21/weaponizing-image-scaling-against-production-ai-systems/"
              >Weaponizing image scaling against production AI systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 12:20:53</span
              ><span class="points-container"
                >Points: <span class="points">446</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44971845"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44971607">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=jHG_I-9a7FY"
              >1981 Sony Trinitron KV-3000R: The Most Luxurious Trinitron
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 11:52:29</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44971607"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44970563">
          <h3>
            <a
              class="item"
              href="https://feyor.sh/blog/my-other-email-client-is-a-mail-daemon/"
              >My other email client is a daemon</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-21 @ 08:54:06</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44970563"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44942709">
          <h3>
            <a class="item" href="https://andrei.xyz/post/how-not-to-buy-a-ssd/"
              >How Not to Buy a SSD</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-18 @ 16:49:59</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44942709"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44942099">
          <h3>
            <a class="item" href="https://mavericksforever.com/"
              >Show HN: OS X Mavericks Forever</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-18 @ 16:01:44</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44942099"
                  >Comments</a
                ><span class="descendants">: 167</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44941605">
          <h3>
            <a
              class="item"
              href="https://www.joshwcomeau.com/svg/interactive-guide-to-paths/"
              >An interactive guide to SVG paths</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-18 @ 15:19:05</span
              ><span class="points-container"
                >Points: <span class="points">386</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44941605"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44941056">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=HFYWHeBhYbM"
              >VHS-C: When a lazy idea stumbles towards perfection [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-18 @ 14:30:28</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44941056"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
