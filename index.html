<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35364224">
          <h3>
            <a class="item" href="https://www.rfc-editor.org/rfc/rfc7807"
              >Problem Details for HTTP APIs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 21:47:11</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35364224"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35363993">
          <h3>
            <a class="item" href="https://brianmckenna.org/blog/verse_types"
              >Type system of Fortnite's Verse language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 21:29:37</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35363993"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35363967">
          <h3>
            <a
              class="item"
              href="https://blog.eladgil.com/p/video-and-transcript-fireside-chat"
              >Fireside Chat with Clem Delangue, CEO of Hugging Face</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 21:27:49</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35363967"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35363547">
          <h3>
            <a class="item" href="https://onesignal.com/careers/4004532006"
              >OneSignal (YC S11) is hiring a head of developer relations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 21:00:26</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35363095">
          <h3>
            <a
              class="item"
              href="https://storage.courtlistener.com/recap/gov.uscourts.cand.373179/gov.uscourts.cand.373179.469.0.pdf"
              >Judge finds Google destroyed evidence and repeatedly lied to the
              court [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 20:32:46</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35363095"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35363044">
          <h3>
            <a class="item" href="https://www.destroyallsoftware.com/talks/wat"
              >Wat [video] (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 20:29:53</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35363044"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35362353">
          <h3>
            <a
              class="item"
              href="https://lux-magazine.com/article/sex-and-the-citizenship-process/"
              >Sex and the Citizenship Process: Why people keep sending nudes to
              immigration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 19:47:38</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35362353"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35362063">
          <h3>
            <a class="item" href="https://www.getclearspace.com/beeper"
              >I built an iMessage bot using Beeper</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 19:27:30</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35362063"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35362048">
          <h3>
            <a
              class="item"
              href="https://www.lunasec.io/docs/blog/cerebras-gpt-vs-llama-ai-model-comparison/"
              >Cerebras-GPT vs. LLaMA AI Model Performance Comparison</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 19:26:17</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35362048"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35361473">
          <h3>
            <a class="item" href="https://www.mythic.computer/essays/origins"
              >I wanted a beautiful computer and couldn't find one, so I made my
              own</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 18:46:18</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35361473"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35361403">
          <h3>
            <a
              class="item"
              href="https://hellgatenyc.com/some-guy-bought-the-flatiron-building-and-didnt-pay-for-it"
              >A VC bought the Flatiron Building and didn’t pay for it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 18:41:10</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35361403"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35361192">
          <h3>
            <a class="item" href="https://gambas.sourceforge.net/en/main.html"
              >Gambas Almost Means BASIC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 18:25:15</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35361192"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35360219">
          <h3>
            <a
              class="item"
              href="https://www.prusa3d.com/product/original-prusa-mk4-2/"
              >Original Prusa MK4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 17:15:57</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35360219"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35359473">
          <h3>
            <a class="item" href="https://github.com/pojntfx/go-nbd"
              >Show HN: go-nbd – A Pure Go NBD Server and Client</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 16:23:21</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35359473"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
            <div class="text"><p>I'd love to get your feedback :)</p></div>
          </section>
        </section>
        <section id="35359295">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/history/biggest-clues-lives-early-americans-hidden-underwater-submerged-prehistory-180981891/"
              >Clues to the lives of North America’s first inhabitants are
              hidden underwater</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 16:12:42</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35359295"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35358873">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35358873"
              >Launch HN: Vocode (YC W23) – Library for voice conversation with
              LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 15:43:36</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35358873"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/vocodedev/vocode-python"
                >https://github.com/vocodedev/vocode-python</a
              >
              and our docs are at
              <a href="https://docs.vocode.dev">https://docs.vocode.dev</a>.
              <p>
                Building realtime voice apps with LLMs is powerful but hard. You
                have to orchestrate the speech recognition, LLM, and speech
                synthesis in real-time (all async)–while handling the complexity
                of conversation (like understanding when someone is finished
                speaking or handling interruptions).
              </p>
              <p>
                Our library is easy to get up and running–you can set up a
                conversation in &lt;15 lines of code. Check out our Gen Z GPT
                hotline demo:
                <a href="https://replit.com/@vocode/Gen-Z-Phone"
                  >https://replit.com/@vocode/Gen-Z-Phone</a
                >
                (try it out at +1-650-729-9536).
              </p>
              <p>
                It all started with our PrankGPT project that we built for fun
                (quick demo at
                <a
                  href="https://www.loom.com/share/0d0d68f1a62f409eb5ae24521293d2dc"
                  >https://www.loom.com/share/0d0d68f1a62f409eb5ae24521293d2dc</a
                >). We realized how powerful voice + LLMs are but that it was
                hard to build.
              </p>
              <p>
                Once we got everything working, it was really cool and useful.
                Talking to LLMs is better than all the voice AI experiences
                we’ve had before. And, we imagined a host of cool applications
                that people can build on top of that.
              </p>
              <p>
                So, we decided to build a developer tool to make it easy. Our
                library is open source and gives you everything you need in a
                single place.
              </p>
              <p>
                We give you a bunch of integrations out-of-the-box to speech
                recognition/synthesis providers and let you swap them out
                easily. We have platform support across web and telephony (via
                Twilio), with mobile coming soon. We also provide abstractions
                for streaming conversation (this is good for realtime apps like
                phone calls) and for command-based/turn-based applications (like
                voice-based chess). And, we provide customizability around how
                the conversation is done—things like how to know when someone is
                finished speaking, changing emotion, sending filler audio if
                there are delays, etc.
              </p>
              <p>
                In terms of “how do you make money” – we have a hosted version
                that we’re going to charge for (though right now you can get it
                for free!
                <a href="https://app.vocode.dev">https://app.vocode.dev</a>) and
                we're also going to build enterprise products in the future.
              </p>
              <p>
                We’d love for you to try it out and give us some feedback! And,
                if you have any demos you'd like to see – let us know and we’ll
                take a crack at building them. We’re curious about your
                experiences using or building voice AI, what features or use
                cases you’d love to see, and any other ideas you have to share!
              </p>
            </div>
          </section>
        </section>
        <section id="35358535">
          <h3>
            <a class="item" href="https://github.com/Mirrorful/mirrorful"
              >Show HN: Mirrorful – A developer-first way to implement designs
              faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 15:19:24</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35358535"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.mirrorful.com/">https://www.mirrorful.com/</a
              >) is an open-source developer framework that helps front-end
              engineers manage their design systems. We’ve been building
              Mirrorful with the open-source community (<a
                href="https://github.com/Mirrorful/mirrorful"
                >https://github.com/Mirrorful/mirrorful</a
              >) and wanted to share our beta with you. Check out our online
              demo to get the idea:
              <a href="https://app.mirrorful.com/">https://app.mirrorful.com/</a
              >.
              <p>
                Design systems can be thought of as the “building blocks of your
                app” which makes me think of Lego bricks. Mirrorful helps you
                manage your codebase’s Lego bricks and ensure that they are
                consistent across all of your apps and platforms.
              </p>
              <p>
                We saw as product engineers how hard it is to get code to match
                Figma mock ups. High-quality design is a competitive advantage,
                so getting your UI pixel perfect can matter a lot, but is
                time-consuming and tedious.
              </p>
              <p>
                When we worked for large public companies, we saw that good
                component libraries help, but engineers are often still dealing
                with tweaking small design decisions. There are a lot of
                inefficiencies. We also worked at a small startup and saw what
                it was like to not have a design system. No design system led to
                copy pasta code, and days of back-and-forth on simple things
                like “what hex should i be using for the hover state?”
              </p>
              <p>
                Design systems are tricky to get right. Picking an
                out-of-the-box solution is easy to begin with, but one day
                you’ll be cursing yourself due to lack of flexibility (we did!).
                On the other hand, creating a design system from scratch is
                super time-consuming even for the best frontend engineers.
                Mirrorful is our way out of this dilemma.
              </p>
              <p>
                Mirrorful is completely open-source and written in Typescript.
                We’re starting with basic design elements—commonly called
                “design tokens” — such as colors, typography, and shadows, but
                have plans to expand our scope into more complex components.
              </p>
              <p>
                As frontend engineers ourselves, we wanted a tool that lives in
                code but is visual. It had to be super easy to set up, but also
                prepare you for scale so you and/or your team don’t end up
                copy-pasting everywhere. We decided to make it an NPM package
                (<a href="https://www.npmjs.com/package/mirrorful"
                  >https://www.npmjs.com/package/mirrorful</a
                >) that runs a localhost editor and exports out your design
                tokens into any configuration you want: .js, .ts, .css, .scss,
                .json. It’s lightweight with no design system lock-in.
              </p>
              <p>
                Our product is completely self-serve: just install our NPM
                package. If you run Mirrorful locally, a visual dashboard will
                pop up at localhost:5050 that lets you manage your theme and
                export various configuration files directly into code.
              </p>
              <p>
                Pricing is similar to other open-source companies—we charge for
                cloud-hosted features and for premium components.
              </p>
              <p>
                We’ve built open-source/open-core projects before and love
                interacting with contributors from all over the world. If anyone
                has any opinions on what we’re building, we’re all ears. Check
                us out at mirrorful.com and at github.com/Mirrorful/mirrorful
                and give it a shot!
              </p>
            </div>
          </section>
        </section>
        <section id="35356256">
          <h3>
            <a
              class="item"
              href="https://www.sciencenews.org/article/meat-rotten-putrid-paleo-diet-fire-neanderthal"
              >Rotten meat may have been a staple of Stone Age diets</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 12:30:28</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35356256"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35356201">
          <h3>
            <a class="item" href="https://wrv.github.io/h26forge.pdf"
              >Finding and exploiting vulnerabilities in H.264 decoders [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 12:25:45</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35356201"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35356149">
          <h3>
            <a
              class="item"
              href="https://blog.google/threat-analysis-group/spyware-vendors-use-0-days-and-n-days-against-popular-platforms/"
              >Spyware vendors use 0-days and n-days against Android, iOS and
              Chrome</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 12:20:34</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35356149"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35355703">
          <h3>
            <a
              class="item"
              href="https://www.alexmurrell.co.uk/articles/the-age-of-average"
              >The age of average</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 11:39:28</span
              ><span class="points-container"
                >Points: <span class="points">822</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35355703"
                  >Comments</a
                ><span class="descendants">: 400</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35355527">
          <h3>
            <a
              class="item"
              href="https://www.gregegan.net/SCALE/01/ScienceOfScale.html"
              >The Science of Scale (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 11:19:37</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35355527"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35355469">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/mathematician-proves-huge-result-on-dangerous-problem-20191211"
              >Terence Tao makes progress on the Collatz conjecture (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 11:13:04</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35355469"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35355372">
          <h3>
            <a class="item" href="https://fs.blog/carl-braun-communicating/"
              >Carl Braun on communicating like a grown-up (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 11:00:15</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35355372"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35350030">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/news/daily-comment/what-we-still-dont-know-about-how-ai-is-trained"
              >What we still don’t know about how A.I. is trained</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 00:08:20</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35350030"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35348353">
          <h3>
            <a
              class="item"
              href="https://futureoflife.org/open-letter/pause-giant-ai-experiments/"
              >Pause Giant AI Experiments: An Open Letter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 21:43:33</span
              ><span class="points-container"
                >Points: <span class="points">452</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35348353"
                  >Comments</a
                ><span class="descendants">: 663</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35347925">
          <h3>
            <a
              class="item"
              href="https://www.congress.gov/bill/118th-congress/senate-bill/686/text?s=1&amp;r=15"
              >Senate Bill to Ban TikTok</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 21:12:13</span
              ><span class="points-container"
                >Points: <span class="points">389</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35347925"
                  >Comments</a
                ><span class="descendants">: 425</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35344703">
          <h3>
            <a
              class="item"
              href="https://jacobian.org/2023/mar/28/incompetent-but-nice/"
              >Incompetent but Nice</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 17:28:04</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35344703"
                  >Comments</a
                ><span class="descendants">: 185</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35340083">
          <h3>
            <a class="item" href="https://www.oliverburkeman.com/river"
              >Treat your to-read pile like a river, not a bucket</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 12:50:32</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35340083"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35339955">
          <h3>
            <a class="item" href="https://maximullaris.com/awk_tech_notes.html"
              >Awk Technical Notes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 12:41:03</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35339955"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
