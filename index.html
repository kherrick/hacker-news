<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35869798">
          <h3>
            <a
              class="item"
              href="https://sfstandard.com/business/downtown-san-francisco-office-tower-to-sell-at-massive-discount-sources/"
              >Downtown San Francisco Office Tower Likely to Sell at Discount:
              Sources</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 03:15:28</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35869798"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35869011">
          <h3>
            <a
              class="item"
              href="https://mastodon.social/@danluu/110335983520055904"
              >The rise of ChatGPT-enabled GitHub spam</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 01:02:24</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35869011"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35868685">
          <h3>
            <a class="item" href="https://meetcala.com/"
              >“Tinder for Canceling Meetings”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 00:15:35</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35868685"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35868529">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/05/08/wordpress_plugin_vulnerability/"
              >WordPress plugin hole puts '2M websites' at risk</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 23:54:56</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35868529"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35868447">
          <h3>
            <a class="item" href="https://unlighthouse.dev"
              >Unlighthouse: Like Lighthouse, but it scans every single page</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 23:45:50</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35868447"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35868421">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2023/05/08/ed-sheeran-once-again-demonstrates-how-modern-copyright-is-destroying-rather-than-helping-musicians/"
              >Ed Sheeran demonstrates how copyright is destroying musicians</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 23:43:14</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35868421"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35868065">
          <h3>
            <a
              class="item"
              href="https://hai.stanford.edu/news/ais-ostensible-emergent-abilities-are-mirage"
              >LLMs are not greater than the sum of their parts: researchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 23:04:39</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35868065"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35867935">
          <h3>
            <a
              class="item"
              href="https://classicalwisdom.substack.com/p/12-ancient-greek-terms-that-should"
              >Ancient Greek terms worth reviving</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 22:45:13</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35867935"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35867928">
          <h3>
            <a
              class="item"
              href="https://quillette.com/2023/04/23/the-man-who-invented-the-cop-novel/"
              >The man who invented the modern cop novel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 22:44:26</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35867928"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35867275">
          <h3>
            <a class="item" href="https://visual-fonts.com/"
              >Cantonese Font with Pronunciation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 21:28:28</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35867275"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35866988">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/publications/loginonline/codon-python-compiler#Rik%20Farrow"
              >Codon: Python Compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 20:59:04</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35866988"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35866283">
          <h3>
            <a
              class="item"
              href="https://www.hypertalking.com/2023/05/08/1-bit-pixel-art-of-hokusais-the-great-wave-off-kanagawa/"
              >1-Bit Hokusai’s ”The Great Wave”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 19:56:50</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35866283"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35865855">
          <h3>
            <a
              class="item"
              href="https://electronics360.globalspec.com/article/11940/dutch-town-becomes-first-to-install-bat-friendly-red-led-street-lights"
              >Dutch town installs bat-friendly red LED street lights (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 19:18:20</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35865855"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35864661">
          <h3>
            <a class="item" href="https://cptn.io"
              >Show HN: Cptn.io – open-source integration platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 17:45:50</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35864661"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
            <div class="text">
              <a href="https://cptn.io">https://cptn.io</a>). The product is MIT
              licensed and the repo is at
              <a href="https://github.com/cptn-io/el-cptn"
                >https://github.com/cptn-io/el-cptn</a
              >.
              <p>
                I have started on my startup journey an year ago and launched a
                monitoring platform called DevRaven. Unfortunately the product
                did not takeoff as expected. That story is for another day.
              </p>
              <p>
                But during the course of building the product, I have built
                several integrations leveraging MQs and Cloud Functions. While
                building and deploying Cloud Functions for happy paths is easy,
                I had to monitor logs for failures, build retry mechanisms or
                manually process failed events, keep instances running to
                prevent cold start timeouts. It can also get expensive with
                charges for MQs, server time for running cloud functions etc and
                costs can be unpredictable.
              </p>
              <p>
                I thought of building a platform where I can build integrations
                quickly, have the ability to look at incoming/outgoing events,
                look at logs, retry any failed events etc. And finally,
                predictable costs for running the infrastructure. cptn.io
                provides all these capabilities and more. You can build
                pipelines to integrate with any cloud services, send data from
                your backend to data warehouses, listen to web hook events etc.
                The platform can be integrated into any stack by sending events
                to HTTP end points.
              </p>
              <p>
                Instead of trying to build a business first or launch an open
                source product under restrictive licenses, the platform will be
                available under MIT license so any user or customer can use it.
                There is no ee folder or complex dual licensing and I am also
                committing to releasing SSO under MIT. The plan is to offer a
                managed service in the cloud at a later time, accept sponsors
                for prioritizing features for enterprise customers and charge
                for enterprise support.
              </p>
              <p>
                It should take less than 5 minutes to get the platform running
                on your machine. Welcome any feedback, feature requests, PRs and
                bug reports.
              </p>
            </div>
          </section>
        </section>
        <section id="35864429">
          <h3>
            <a class="item" href="https://www.nextcomputers.org/"
              >NeXT Computers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 17:29:37</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35864429"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35864053">
          <h3>
            <a class="item" href="https://www.tesorio.com/careers#job-openings"
              >Tesorio (YC S15) Hiring Senior Back End Engineer, DevOps, Head of
              Data Science</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 17:01:39</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35863837">
          <h3>
            <a class="item" href="https://github.com/vadimdemedes/ink"
              >Ink: React for interactive command-line apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 16:46:41</span
              ><span class="points-container"
                >Points: <span class="points">423</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35863837"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35863309">
          <h3>
            <a
              class="item"
              href="https://aaronlou.com/blog/2023/reflected-diffusion/"
              >Reflected Diffusion Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 16:13:01</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35863309"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35862837">
          <h3>
            <a
              class="item"
              href="http://undeadly.org/cgi?action=article;sid=20230507122935"
              >OpenBSD cron(8) now supports random ranges with steps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 15:40:33</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35862837"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35862799">
          <h3>
            <a
              class="item"
              href="https://qrper.com/2023/04/coax-cables-i-used-for-sota-pota-a-horror-story/"
              >A coax cable horror story</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 15:37:43</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35862799"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35862142">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/a-mutation-turned-ants-into-parasites-in-one-generation-20230508/"
              >A mutation turned ants into parasites in one generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 14:50:47</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35862142"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35861435">
          <h3>
            <a
              class="item"
              href="https://b-fg.github.io/2023/05/07/waterlily-on-gpu.html"
              >GPU vendor-agnostic fluid dynamics solver in Julia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 13:44:16</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35861435"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35861209">
          <h3>
            <a class="item" href="https://github.com/hackclub/sinerider"
              >Show HN: SineRider, a math puzzle game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 13:14:58</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35861209"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                SineRider is literally an infinite universe of function
                composition puzzles, each with infinite solutions, that range
                from welcoming for 9th graders to difficult for even the most
                serious matlab user. And every day we tweet out a fresh one to
                be solved with your morning coffee.
              </p>
              <p>
                We hope you enjoy playing SineRider as much as we’ve enjoyed
                making it. And we’re not done! Mobile support, polar
                coordinates, and a level editor are all on the roadmap.
                SineRider is a living project, to be continuously built and
                maintained as free OSS by the Hack Club community:
                <a href="https://github.com/hackclub/sinerider"
                  >https://github.com/hackclub/sinerider</a
                >
              </p>
              <p>
                The team that built the game will try to be in the comments
                today between high school classes and AP tests.
              </p>
              <p>—chris walker, creative director</p>
              <p>
                Watch the trailer:
                <a href="https://www.youtube.com/watch?v=35nDYoIwiA8"
                  >https://www.youtube.com/watch?v=35nDYoIwiA8</a
                >
              </p>
              <p>
                Play now:
                <a href="https://sinerider.com">https://sinerider.com</a>
              </p>
            </div>
          </section>
        </section>
        <section id="35858375">
          <h3>
            <a class="item" href="https://ivanish.ca/hest-time-travel/"
              >Hest, Time Travel (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 05:16:26</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35858375"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35857072">
          <h3>
            <a
              class="item"
              href="https://www.sacrideo.us/suggestivity-and-idioms-in-apl/"
              >Suggestivity and Idioms in APL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 01:10:46</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35857072"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35856654">
          <h3>
            <a
              class="item"
              href="https://www.cc.gatech.edu/classes/AY2001/cs6470_fall/LTAND.html"
              >LambdaMOO Takes a New Direction (1992)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 23:40:47</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35856654"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35856276">
          <h3>
            <a
              class="item"
              href="https://groups.google.com/g/comp.protocols.tcp-ip/c/mVnR2OSXHBY/m/tjdkK1OBtCEJ"
              >Are sockets the wave of the future? (1990)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 22:36:26</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35856276"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35853217">
          <h3>
            <a
              class="item"
              href="https://www.thelancet.com/journals/lanonc/article/PIIS1470-2045(23)00112-2/fulltext"
              >Blood–brain barrier opening with ultrasound device in patients
              with glioblastoma</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 16:43:29</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35853217"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35852710">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/casio-g-shock-digital-watch-fitness-tracking-heart-rate-1850357822"
              >Casio adds fitness features to original G-Shock digital watch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 15:52:43</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35852710"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35836019">
          <h3>
            <a class="item" href="https://mashpoe.github.io/favicon-dino-game/"
              >Favicon Dino Game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-05 @ 22:45:42</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35836019"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
