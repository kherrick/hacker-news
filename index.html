<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40164793">
          <h3>
            <a
              class="item"
              href="https://mailchi.mp/62e24f2ccc99/a-heavy-sad-heart"
              >MFJ is ceasing its on-site production</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-26 @ 00:50:52</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40164793"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40164337">
          <h3>
            <a
              class="item"
              href="https://romeov.github.io/malicious_ip_addresses/malicious_ip_analysis.html"
              >Visualizing malicious IP addresses</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 23:32:07</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40164337"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40164199">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/04/25/business/media/the-onion-sold.html"
              >Jeff Lawson Buys The Onion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 23:11:14</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40164199"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40163405">
          <h3>
            <a
              class="item"
              href="https://www.hanselman.com/blog/open-sourcing-dos-4"
              >Open Sourcing DOS 4</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 21:42:06</span
              ><span class="points-container"
                >Points: <span class="points">378</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40163405"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40163104">
          <h3>
            <a
              class="item"
              href="https://www.osohq.com/post/logic-language-distributed-sql-queries"
              >A Logic Language for Distributed SQL Queries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 21:13:52</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40163104"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40162961">
          <h3>
            <a class="item" href="https://www.tesorio.com/careers#job-openings"
              >Tesorio (YC S15) Is Hiring a Head of Cloud
              Infrastructure/Operations (Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 21:00:50</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40162610">
          <h3>
            <a
              class="item"
              href="https://docs.firecrawl.dev/articles/search-announcement"
              >Show HN: From SERP to LLM-Ready Data Markdown in Seconds with
              Firesearch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 20:29:40</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40162610"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40162433">
          <h3>
            <a
              class="item"
              href="https://reason.com/2024/04/25/judge-acquits-backpage-co-founder-michael-lacey-on-most-counts/"
              >Judge acquits Backpage co-founder Michael Lacey on most counts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 20:14:10</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40162433"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40162354">
          <h3>
            <a
              class="item"
              href="https://abc.xyz/assets/91/b3/3f9213d14ce3ae27e1038e01a0e0/2024q1-alphabet-earnings-release-pdf.pdf"
              >Google Earning Q1 2024 [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 20:07:21</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40162354"
                  >Comments</a
                ><span class="descendants">: 191</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40161794">
          <h3>
            <a class="item" href="https://increase.com/articles/no-abstractions"
              >No Abstractions: our API design principle</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 19:15:11</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40161794"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40161712">
          <h3>
            <a
              class="item"
              href="https://bigthink.com/neuropsych/rhyme-as-reason/"
              >Rhyme as Reason</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 19:08:22</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40161712"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40161697">
          <h3>
            <a class="item" href="https://startyourownisp.com/"
              >Start Your Own ISP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 19:06:58</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40161697"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40160467">
          <h3>
            <a
              class="item"
              href="https://blog.peerdb.io/how-can-we-make-pgdump-and-pgrestore-5-times-faster"
              >Parallel Snapshotting: make pg_dump and pg_restore multi-threaded
              per table</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 17:24:36</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40160467"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40160429">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/04/25/technology/fcc-net-neutrality-open-internet.html"
              >FCC votes to restore net neutrality rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 17:23:00</span
              ><span class="points-container"
                >Points: <span class="points">714</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40160429"
                  >Comments</a
                ><span class="descendants">: 426</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40159766">
          <h3>
            <a class="item" href="https://mitxela.com/projects/ddc-oled"
              >DDC OLED (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 16:42:05</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40159766"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40159278">
          <h3>
            <a class="item" href="https://github.com/ArhanChaudhary/NAND"
              >Show HN: I made a programmable computer from NAND gates</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 16:08:05</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40159278"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
            <div class="text">
              <p>
                Check out NAND at
                <a href="https://nand.arhan.sh">https://nand.arhan.sh</a>
              </p>
              <p>
                Additionally, I've authored an extensive writeup about the
                project. Read about it on the GitHub repository's readme.
              </p>
            </div>
          </section>
        </section>
        <section id="40158794">
          <h3>
            <a
              class="item"
              href="https://www.amazon.science/publications/amazon-memorydb-a-fast-and-durable-memory-first-cloud-database"
              >MemoryDB: A fast and durable memory-first cloud database</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 15:34:59</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40158794"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40158481">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40158481"
              >Launch HN: Nango (YC W23) – Source-available unified API</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 15:09:02</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40158481"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.nango.dev">https://www.nango.dev</a>). We
              take care of the annoyances of external APIs (167 and counting) so
              you can quickly build custom integrations for your SaaS, while
              retaining full control over how they work. 2 min demo video:
              <a
                href="https://www.loom.com/share/d04c67b47e284e86b91b4b99fba548ec"
                >https://www.loom.com/share/d04c67b47e284e86b91b4b99fba548ec</a
              >
              <p>
                SaaS engineering teams face a tough choice: they can build each
                integration in-house from scratch, which gives them full control
                but takes a lot of time and maintenance effort. Or they can use
                pre-built solutions, which are fast and easy but less flexible
                and might not fulfill all customer needs.
              </p>
              <p>
                Nango combines the best of both worlds. We let you quickly ship
                custom integrations without building complex infrastructure or
                diving deep into the quirks of each API. You control the
                business logic, data models, and customer-specific
                configurations, like custom field mappings. We handle (O)Auth
                and run your integrations reliably in production.
              </p>
              <p>
                Under the hood, your integrations run as typescript “lambdas” on
                Nango. A typical integration has 3-5 lambdas of 20-50 lines of
                code each. These lambdas live inside your git repo, are
                version-controlled with the rest of your app, and get deployed
                to Nango with a CLI (<a
                  href="https://docs.nango.dev/understand/core-concepts"
                  >https://docs.nango.dev/understand/core-concepts</a
                >).
              </p>
              <p>
                Our runtime has a built-in scheduler for continuous background
                syncs, monitoring to know if your integrations run as expected,
                detailed logging of everything that happens in Nango, and
                pre-built infrastructure to deal with (O)auth, retries,
                rate-limit handling, webhook floods, data caching,
                de-duplication, etc. More here:
                <a href="https://docs.nango.dev/understand/architecture"
                  >https://docs.nango.dev/understand/architecture</a
                >
              </p>
              <p>
                We have found that ChatGPT and Copilot let you build
                integrations on Nango very fast without having to learn each
                API’s intricacies. LLMs are great at figuring out which endpoint
                to use, what parameters it takes, etc. Paired with our runtime,
                this lets you build complex, high-scale integrations in hours
                instead of weeks.
              </p>
              <p>
                We’ve put a ton of effort into dealing with API complexities, so
                you don’t have to. Even integrations that looked simple at first
                ended up forcing us to extend our infra to deal with their
                quirks and gotchas.
              </p>
              <p>
                For example, we had to figure out 100+ different OAuth
                implementations (see
                <a href="https://www.nango.dev/blog/why-is-oauth-still-hard"
                  >https://www.nango.dev/blog/why-is-oauth-still-hard</a
                >
                and
                <a href="https://news.ycombinator.com/item?id=35713518"
                  >https://news.ycombinator.com/item?id=35713518</a
                >). We had to deal with a half-dozen non-standard auth methods
                (Github apps, Stripe apps, Netsuite, etc.), expiring webhooks,
                ways to deal with data dependencies, weird pagination methods,
                API keys that change with every API call, dozens of different
                ways to register for webhooks, etc. It’s a constantly moving
                target, but it is a challenge we have come to love, and we think
                the approach makes sense: we specialize in finicky details that
                vary from API to API—you specialize in making your product great
                and offering more integrations to your users.
              </p>
              <p>
                Last but not least, Nango is open source (<a
                  href="https://github.com/NangoHQ/nango"
                  >https://github.com/NangoHQ/nango</a
                >) under the ELv2 license (allows most use cases, except for
                direct copy-cats). Anybody can contribute new APIs &amp; share
                their integration templates with the community.
              </p>
              <p>
                The fastest way to see Nango in action is with our interactive
                demo here (no signup required):
                <a href="https://app.nango.dev/hn-demo"
                  >https://app.nango.dev/hn-demo</a
                >
              </p>
              <p>
                Or take a look at our docs:
                <a href="https://docs.nango.dev">https://docs.nango.dev</a>
              </p>
              <p>
                We would love to hear your feedback and look forward to the
                comments!
              </p>
            </div>
          </section>
        </section>
        <section id="40157530">
          <h3>
            <a
              class="item"
              href="https://openup.design/we-learn/50-digital-wood-joints/"
              >Digital Wood Joints</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 13:46:28</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40157530"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40156890">
          <h3>
            <a
              class="item"
              href="https://github.com/alexpusch/rust-magic-patterns/blob/master/rust-stream-visualized/Readme.md"
              >Rust Stream API visualized and exposed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 12:51:44</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40156890"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40156534">
          <h3>
            <a class="item" href="https://github.com/Tribler/tribler/wiki"
              >Tribler: An attack-resilient micro-economy for media</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 12:13:51</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40156534"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40154395">
          <h3>
            <a
              class="item"
              href="https://direct.mit.edu/books/oa-monograph/5761/TorFrom-the-Dark-Web-to-the-Future-of-Privacy"
              >Tor: From the Dark Web to the Future of Privacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 07:07:19</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40154395"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40154104">
          <h3>
            <a class="item" href="http://leehite.org/Chimes.htm"
              >Chime Design and Build</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 06:22:26</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40154104"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40153691">
          <h3>
            <a
              class="item"
              href="https://www.commonreader.co.uk/p/how-penelope-fitzgerald-became-a"
              >How Penelope Fitzgerald became a late blooming novelist</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-25 @ 05:12:22</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40153691"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40151424">
          <h3>
            <a
              class="item"
              href="https://oxfordamerican.org/magazine/issue-124-spring-2024/don-t-bleed-on-the-artwork-notes-from-the-afterlife"
              >Don’t bleed on the artwork</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-24 @ 23:52:53</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40151424"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40143460">
          <h3>
            <a class="item" href="https://github.com/turingmotors/swan"
              >Swan – A Lightweight Language Model Execution Environment Using
              FPGA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-24 @ 12:15:26</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40143460"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40143285">
          <h3>
            <a
              class="item"
              href="https://www.cs.utexas.edu/users/EWD/ewd02xx/EWD249.PDF"
              >Notes on Structured Programming (1970) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-24 @ 11:55:54</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40143285"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40142427">
          <h3>
            <a
              class="item"
              href="https://www.tigergraph.com/blogs/gsql/the-rise-of-gql-a-new-iso-standard-in-graph-query-language/"
              >GQL: A New ISO Standard in Graph Query Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-24 @ 09:54:02</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40142427"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40142039">
          <h3>
            <a class="item" href="https://www.erlang.org/blog/optimizations/"
              >The Optimizations in Erlang/OTP 27</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-24 @ 08:44:54</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40142039"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40141713">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-04-species-sizes-rare-evolution-action.html"
              >Same species, different sizes: Rare evolution in action spotted
              in island bats</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-24 @ 07:38:39</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40141713"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
