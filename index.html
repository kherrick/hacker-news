<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40942266">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=END_PVp3Eds"
              >I spent two years trying to make SD cards more nostalgic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 02:17:21</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40942266"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40941645">
          <h3>
            <a class="item" href="https://www.nber.org/papers/w32604"
              >Third Places and Neighborhood Entrepreneurship: Evidence from
              Starbucks Caf√©s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 23:50:09</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40941645"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40941583">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-07-team-cell-free-genetic-metabolism.html"
              >First cell-free system in which genetic information and
              metabolism work together</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 23:39:47</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40941583"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40941475">
          <h3>
            <a class="item" href="https://dl.acm.org/doi/10.1145/3656386"
              >Boosting Compiler Testing by Injecting Real-World Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 23:18:15</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40941475"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40941463">
          <h3>
            <a
              class="item"
              href="https://www.cryptologie.net/article/504/why-im-writing-a-book-on-cryptography/"
              >Why I'm Writing a Book on Cryptography (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 23:16:51</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40941463"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40941219">
          <h3>
            <a
              class="item"
              href="https://explorersweb.com/mysterious-denisovans-survived-on-tibetan-plateau/"
              >Denisovians Survived on Tibetan Plateau for 160k Years</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 22:33:48</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40941219"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40941056">
          <h3>
            <a
              class="item"
              href="https://physicsbaseddeeplearning.org/intro.html"
              >Physics-Based Deep Learning Book</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 22:10:10</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40941056"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40940565">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40940565"
              >Imbue (Formerly Generally Intelligent) (YC S17) Is Hiring an
              Engineering Manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 21:00:06</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                Engineering Manager (SF, Full-time):
                <a
                  href="https://jobs.lever.co/imbue/75fac008-22e5-49ab-9f4e-a4c459b52b41?lever-origin=applied&amp;lever-source%5B%5D=Y%20Combinator"
                  >https://jobs.lever.co/imbue/75fac008-22e5-49ab-9f4e-a4c459b5...</a
                >
              </p>
              <p>
                Founding Product Engineer (SF, Full-time):
                <a
                  href="https://jobs.lever.co/imbue/0764f1c0-89e5-452f-ab41-ff1d1ba8fd6a?lever-origin=applied&amp;lever-source%5B%5D=Y%20Combinator"
                  >https://jobs.lever.co/imbue/0764f1c0-89e5-452f-ab41-ff1d1ba8...</a
                >
              </p>
              <p>
                Machine Learning Engineer (SF or Remote, Contract or Full-time):
                <a
                  href="https://jobs.lever.co/imbue/9411e2ec-502a-403f-a39a-0d44c676b6af?lever-origin=applied&amp;lever-source%5B%5D=Y%20Combinator"
                  >https://jobs.lever.co/imbue/9411e2ec-502a-403f-a39a-0d44c676...</a
                >
              </p>
              <p>
                Research Scientist (SF, Full-time):
                <a
                  href="https://jobs.lever.co/imbue/6c25a25c-35ec-4d7b-8d7e-40e9c4c85fba?lever-origin=applied&amp;lever-source%5B%5D=Y%20Combinator"
                  >https://jobs.lever.co/imbue/6c25a25c-35ec-4d7b-8d7e-40e9c4c8...</a
                >
              </p>
              <p>
                Software Engineer (SF, Full-time):
                <a
                  href="https://jobs.lever.co/imbue/e66a55a3-a117-406c-9b07-8ba055047cea?lever-origin=applied&amp;lever-source%5B%5D=Y%20Combinator"
                  >https://jobs.lever.co/imbue/e66a55a3-a117-406c-9b07-8ba05504...</a
                >
              </p>
              <p>
                Technical Lead Manager (SF, Full-time):
                <a
                  href="https://jobs.lever.co/imbue/9ce44b67-04ca-4da1-b845-6995c62aaf8b?lever-origin=applied&amp;lever-source%5B%5D=YCombinator"
                  >https://jobs.lever.co/imbue/9ce44b67-04ca-4da1-b845-6995c62a...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40940225">
          <h3>
            <a class="item" href="https://webvm.io/"
              >WebVM is a server-less virtual Linux environment running
              client-side</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 20:16:21</span
              ><span class="points-container"
                >Points: <span class="points">330</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40940225"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40940181">
          <h3>
            <a class="item" href="https://github.com/amakelov/mandala"
              >Show HN: Mandala ‚Äì Automatically save, query and version Python
              computations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 20:10:44</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40940181"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <p>
                Surprisingly, it turns out that this vision can pretty much be
                achieved with two generic tools:
              </p>
              <p>
                1. a memoization+versioning decorator, `@op`, which tracks
                inputs, outputs, code and runtime dependencies (other functions
                called, or global variables accessed) every time a function is
                called. Essentially, this makes function calls replace logging:
                if you want something saved, you write a function that returns
                it. Using (a lot of) hashing, `@op` ensures that the same
                version of the function is never executed twice on the same
                inputs.
              </p>
              <p>
                Importantly, the decorator encourages/enforces composition.
                Before a call, `@op` functions wrap their inputs in special
                objects, `Ref`s, and return `Ref`s in turn. Furthermore, data
                structures can be made transparent to `@op`s, so that an `@op`
                can be called on a list of outputs of other `@op`s, or on an
                element of the output of another `@op`. This creates an
                expressive "web" of `@op` calls over time.
              </p>
              <p>
                2. a data structure, `ComputationFrame`, can automatically
                organize any such web of `@op` calls into a high-level view, by
                grouping calls with a similar role into "operations", and their
                inputs/outputs into "variables". It can detect "imperative"
                patterns - like feedback loops, branching/merging, and grouping
                multiple results in a single object - and surface them in the
                graph.
              </p>
              <p>
                `ComputationFrame`s are a "synthesis" of computation graphs and
                relational databases, and can be automatically "exported" as
                dataframes, where columns are variables and operations in the
                graph, and rows contain values and calls for (possibly partial)
                executions of the graph. The upshot is that you can query the
                relationships between any variables in a project in one line,
                even in the presence of very heterogeneous patterns in the
                graph.
              </p>
              <p>
                I'm very excited about this project - which is still in an alpha
                version being actively developed - and especially about the
                `ComputationFrame` data structure. I'd love to hear the feedback
                of the HN community.
              </p>
              <p>
                Colab quickstart:
                <a
                  href="https://colab.research.google.com/github/amakelov/mandala/blob/master/docs_source/tutorials/01_hello.ipynb"
                  >https://colab.research.google.com/github/amakelov/mandala/bl...</a
                >
              </p>
              <p>
                Blog post introducing `ComputationFrame`s (can be opened in
                Colab too):
                <a href="https://amakelov.github.io/mandala/blog/01_cf/"
                  >https://amakelov.github.io/mandala/blog/01_cf/</a
                >
              </p>
              <p>
                Docs:
                <a href="https://amakelov.github.io/mandala/"
                  >https://amakelov.github.io/mandala/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40939703">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/charmed-collaboration-creates-therapy-candidate-fatal-prion-diseases-0627"
              >Gene-silencing tool shows promise as a future therapy against
              prion diseases</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 19:21:08</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40939703"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40939184">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/the-great-lightbulb-conspiracy"
              >The Great Lightbulb Conspiracy (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 18:15:27</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40939184"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40938810">
          <h3>
            <a class="item" href="https://github.com/gojue/ecapture"
              >Capturing Linux SSL/TLS plaintext without a CA certificate using
              eBPF</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 17:31:48</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40938810"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40938577">
          <h3>
            <a class="item" href="https://www.together.ai/blog/flashattention-3"
              >FlashAttention-3: Fast and Accurate Attention with Asynchrony and
              Low-Precision</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 17:06:06</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40938577"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40938388">
          <h3>
            <a
              class="item"
              href="https://www.burn-heart.com/rulers-of-the-ancient-world"
              >Rulers of the Ancient World: period correct measuring tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 16:41:34</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40938388"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40938325">
          <h3>
            <a class="item" href="https://github.com/postgresml/korvus"
              >Korvus: Single-Query RAG with Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 16:35:31</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40938325"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40938092">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cy77p22jr5lo"
              >Shelley Duvall has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 16:06:08</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40938092"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40937973">
          <h3>
            <a
              class="item"
              href="https://mydiplomaticlife.com/how-to-survive-3-years-in-north-korea-as-a-foreigner/"
              >Surviving three years in North Korea as a foreigner (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 15:52:14</span
              ><span class="points-container"
                >Points: <span class="points">254</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40937973"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40937760">
          <h3>
            <a
              class="item"
              href="https://blog.paradedb.com/pages/iceberg_lakehouse"
              >Putting DuckDB in Postgres to Query Iceberg</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 15:29:08</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40937760"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40936808">
          <h3>
            <a
              class="item"
              href="https://matttproud.com/blog/posts/x-window-system-boot-stipple.html"
              >Iconography of the X Window System: The Boot Stipple</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 13:48:49</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40936808"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40935701">
          <h3>
            <a
              class="item"
              href="https://quickwit.io/blog/quickwit-binance-story"
              >Binance built a 100PB log service with Quickwit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 11:57:27</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40935701"
                  >Comments</a
                ><span class="descendants">: 161</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40934924">
          <h3>
            <a
              class="item"
              href="https://typesetinthefuture.com/2018/12/04/walle/"
              >The Typeset of Wall¬∑E (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 09:28:54</span
              ><span class="points-container"
                >Points: <span class="points">533</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40934924"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40934608">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2402.11150"
              >A relativistic framework to establish coordinate time on the Moon
              and beyond</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 08:11:36</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40934608"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40934582">
          <h3>
            <a
              class="item"
              href="https://ktema.org/articles/the-overengineered-resume/"
              >The Overengineered Resume with Zola, JSON Resume, Weasyprint, and
              Nix (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 08:06:38</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40934582"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40931636">
          <h3>
            <a
              class="item"
              href="https://news.feinberg.northwestern.edu/2024/07/10/scientists-discover-a-cause-of-lupus-and-a-possible-way-to-reverse-it/"
              >Scientists discover a cause of lupus, possible way to reverse
              it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 21:24:49</span
              ><span class="points-container"
                >Points: <span class="points">754</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40931636"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40931590">
          <h3>
            <a
              class="item"
              href="https://www.sciencealert.com/physicists-have-created-the-worlds-most-fiendishly-difficult-maze"
              >Physicists have created the most fiendishly difficult maze</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 21:20:41</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40931590"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40914052">
          <h3>
            <a
              class="item"
              href="https://ethz.ch/en/news-and-events/eth-news/news/2024/07/mining-rare-earth-metals-from-electronic-waste.html"
              >Rapid extraction of europium from spent fluorescent lamps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 09:26:08</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40914052"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40909094">
          <h3>
            <a
              class="item"
              href="https://healeycodes.com/making-python-less-random"
              >Making Python Less Random</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 20:09:08</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40909094"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40906374">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/an-archeological-revolution-transforms-our-image-of-human-freedoms"
              >A revolution in archaeology is transforming our picture of past
              populations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 15:41:25</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40906374"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40902688">
          <h3>
            <a
              class="item"
              href="https://telearn.hal.science/hal-00190537/document"
              >Children's mental models of recursive LOGO programs (1985)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 04:48:10</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40902688"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
