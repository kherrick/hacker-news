<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41133574">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/just-words/jobs/ED0Qf42-founding-engineer"
              >Just Words (YC W24) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 21:01:17</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41132787">
          <h3>
            <a
              class="item"
              href="https://www.sabulo.com/sb/3d-printing-2/8mm-film-scanner-kotokino-mark-iv/"
              >DIY, 8mm film scanner Kotokino Mark IV</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 19:42:18</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41132787"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41132669">
          <h3>
            <a
              class="item"
              href="https://groups.google.com/g/golang-dev/c/0OqBkS2RzWw"
              >Russ Cox is stepping down as the Go tech lead</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 19:29:55</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41132669"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41132328">
          <h3>
            <a
              class="item"
              href="https://www.proofpoint.com/us/blog/threat-insight/threat-actor-abuses-cloudflare-tunnels-deliver-rats"
              >Threat actor abuses Cloudflare tunnels to deliver remote access
              trojans</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 18:57:04</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41132328"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41132104">
          <h3>
            <a class="item" href="https://aodyo.com/anyma-v/"
              >Show HN: Anyma V, a hybrid physical modelling virtual
              instrument</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 18:35:46</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41132104"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                Here's a video:
                <a href="https://www.youtube.com/watch?v=6efDQ9GmRpg"
                  >https://www.youtube.com/watch?v=6efDQ9GmRpg</a
                >
              </p>
              <p>
                We're not pivoting to VSTs, it's just that it was a practical
                way of investigating several issues and helping us with the
                ongoing development of our upcoming Kickstarter-backed synth
                (Anyma Omega) and MPE controller (Loom), and a gift to thank our
                backers for the wait they gave to go through due to several
                manufacturing and production issues.
              </p>
              <p>
                I enjoy reading music-related entries here, so I thought I'd
                contribute this time and I hope it will interest some. I'm here
                for any question or remark.
              </p>
            </div>
          </section>
        </section>
        <section id="41132023">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/sciadv.adm8470"
              >Space is a latent sequence: A theory of the hippocampus</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 18:28:31</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41132023"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41131181">
          <h3>
            <a class="item" href="https://100r.co/site/about_us.html"
              >Hundred Rabbits is a small collective exploring the failability
              of modern tech</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 17:00:53</span
              ><span class="points-container"
                >Points: <span class="points">304</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41131181"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41130620">
          <h3>
            <a
              class="item"
              href="https://blog.fal.ai/flux-the-largest-open-sourced-text2img-model-now-available-on-fal/"
              >Flux: Open-source text-to-image model with 12B parameters</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 16:03:19</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41130620"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41130359">
          <h3>
            <a
              class="item"
              href="https://www.gauge.sh/blog/the-trouble-with-all"
              >The Trouble with __all__</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 15:41:21</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41130359"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41130042">
          <h3>
            <a
              class="item"
              href="https://stability.ai/news/introducing-stable-fast-3d"
              >Stable Fast 3D: Rapid 3D Asset Generation from Single Images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 15:16:09</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41130042"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41129813">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41129813"
              >Ask HN: Who is hiring? (August 2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 15:00:34</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41129813"
                  >Comments</a
                ><span class="descendants">: 191</span></span
              >
            </h4>
            <div class="text">
              <i>not</i> an option.
              <p>
                Please only post if you personally are part of the hiring
                company—no recruiting firms or job boards. One post per company.
                If it isn't a household name, explain what your company does.
              </p>
              <p>
                Commenters: please don't reply to job posts to complain about
                something. It's off topic here.
              </p>
              <p>
                Readers: please only email if you are personally interested in
                the job.
              </p>
              <p>
                Searchers: try
                <a href="http://nchelluri.github.io/hnjobs/"
                  >http://nchelluri.github.io/hnjobs/</a
                >,
                <a href="https://hnresumetojobs.com"
                  >https://hnresumetojobs.com</a
                >,
                <a href="https://hnhired.fly.dev">https://hnhired.fly.dev</a>,
                <a href="https://kennytilton.github.io/whoishiring/"
                  >https://kennytilton.github.io/whoishiring/</a
                >,
                <a href="https://hnjobs.emilburzo.com"
                  >https://hnjobs.emilburzo.com</a
                >.
              </p>
              <p>Don't miss these other fine threads:</p>
              <p>
                <i>Who wants to be hired?</i>
                <a href="https://news.ycombinator.com/item?id=41129811"
                  >https://news.ycombinator.com/item?id=41129811</a
                >
              </p>
              <p>
                <i>Freelancer? Seeking freelancer?</i>
                <a href="https://news.ycombinator.com/item?id=41129812"
                  >https://news.ycombinator.com/item?id=41129812</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41128325">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/science-nature/parasites-are-everywhere-so-why-do-so-few-researchers-study-them-180984753/"
              >Parasites are everywhere. Why do so few researchers study
              them?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 12:07:58</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41128325"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41127726">
          <h3>
            <a class="item" href="https://github.com/cgzirim/not-shazam"
              >I recreated Shazam's algorithm with Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 10:29:21</span
              ><span class="points-container"
                >Points: <span class="points">277</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41127726"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41127706">
          <h3>
            <a
              class="item"
              href="https://www.funraniumlabs.com/2024/07/how-i-got-my-laser-eye-injury/"
              >How I got my laser eye injury</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 10:25:34</span
              ><span class="points-container"
                >Points: <span class="points">548</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41127706"
                  >Comments</a
                ><span class="descendants">: 219</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41127048">
          <h3>
            <a
              class="item"
              href="https://vercel.com/blog/how-google-handles-javascript-throughout-the-indexing-process"
              >How Google handles JavaScript throughout the indexing process</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 07:55:57</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41127048"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41126971">
          <h3>
            <a class="item" href="https://nullprogram.com/blog/2024/07/31/"
              >Deep list copy: More than meets the eye</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 07:40:47</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41126971"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41126944">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/sensational-breakthrough-marks-step-toward-revealing-hidden-structure-prime-numbers"
              >Breakthrough a step toward revealing hidden structure of prime
              numbers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 07:34:30</span
              ><span class="points-container"
                >Points: <span class="points">318</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41126944"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41126380">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/essay/scenes-of-reading-on-the-early-portrait-postcard/"
              >Scenes of Reading on the Early Portrait Postcard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 05:19:12</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41126380"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41125980">
          <h3>
            <a class="item" href="https://github.com/pytorch/torchchat"
              >Torchchat: Chat with LLMs Everywhere</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 03:48:14</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41125980"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41125544">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2024/07/dont-let-your-domain-name-become-a-sitting-duck/"
              >Don’t let your domain name become a sitting duck</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-01 @ 02:00:12</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41125544"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41120568">
          <h3>
            <a
              class="item"
              href="https://generativist.falsifiable.com/metaverse/dunbars-number-is-quadratic"
              >Dunbar's Number Is Quadratic (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 16:21:49</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41120568"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41119646">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/health-wellbeing/robot-dentist-world-first/"
              >Robot dentist performs first human procedure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 14:44:35</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41119646"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41116439">
          <h3>
            <a class="item" href="https://github.com/davidgiven/wordgrinder"
              >WordGrinder: A simple word processor that runs on the console</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 04:39:03</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41116439"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41116238">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/c0xj3xq5l1vo"
              >Australia starts peanut allergy treatment for babies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 03:43:55</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41116238"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41116071">
          <h3>
            <a class="item" href="https://www.datagubbe.se/crt/"
              >The effect of CRTs on pixel art</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 02:57:30</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41116071"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41112889">
          <h3>
            <a class="item" href="https://trayce.dev"
              >Show HN: Trayce – Network tab for your local Docker containers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 18:58:05</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41112889"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                As a backend developer I wanted something which was similar to
                Wireshark or the Chrome network tab, but which intercepted
                requests &amp; responses to my containers for debugging in a
                local dev environment. Wireshark is a great tool but it seems
                more geared towards lower level networking tasks. When I'm
                developing REST APIs I dont care about packets, checksums, bit
                flags etc. I'm only concerned with HTTP requests and their
                responses. I also didn't want to have to configure a pre master
                key to intercept TLS, I wanted it to work out-of-the-box.
              </p>
              <p>
                Trayce is in beta phase so feedback is very welcome, bug reports
                too. The frontend GUI is written in Python with the QT
                framework. The TrayceAgent which is what does the intercepting
                of traffic is written in Go and eBPF.
              </p>
            </div>
          </section>
        </section>
        <section id="41104789">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/interactive/2024/07/29/science/ai-weather-forecast-hurricane.html"
              >Artificial intelligence gives weather forecasters a new edge</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-29 @ 23:49:54</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41104789"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41101700">
          <h3>
            <a
              class="item"
              href="https://vincent.bernat.ch/en/blog/2024-bgp-endless-aspath"
              >Crafting endless AS paths in BGP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-29 @ 16:37:15</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41101700"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41100737">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/sections/shots-health-news/2024/07/29/g-s1-13519/alzheimers-protein-reelin-brain-aging-amyloid-tau-memory"
              >The protein Reelin keeps popping up in brains that resist aging
              and Alzheimer’s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-29 @ 14:27:40</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41100737"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41093197">
          <h3>
            <a
              class="item"
              href="https://blog.davidv.dev/posts/first-contact-with-k8s/"
              >A skeptic's first contact with Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 14:00:42</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41093197"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
