<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41701398">
          <h3>
            <a
              class="item"
              href="https://www.carscoops.com/2024/09/mazdas-remote-start-subscription-draws-ire-of-noted-right-to-repair-advocate/"
              >Mazda's $10 Subscription for Remote Start Sparks Backlash</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 19:58:34</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41701398"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41701265">
          <h3>
            <a
              class="item"
              href="https://twitter.com/CodeFryingPan/status/1840831339337302204"
              >Pear AI founder: We made two big mistakes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 19:45:58</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41701265"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41701219">
          <h3>
            <a class="item" href="https://github.com/ekiefl/pooltool"
              >Pooltool: A sandbox billiards game that emphasizes realistic
              physics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 19:41:50</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41701219"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41701156">
          <h3>
            <a class="item" href="https://musicbrainz.org/"
              >MusicBrainz: An open music encyclopedia</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 19:36:54</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41701156"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41700989">
          <h3>
            <a
              class="item"
              href="https://www.manning.com/books/deep-learning-with-jax"
              >Deep Learning with Jax</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 19:21:57</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41700989"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41700517">
          <h3>
            <a
              class="item"
              href="https://launchpointzero.com/blog/product-hunt-isnt-dying-its-become-gentrified/"
              >Product Hunt isn't dying, it's becoming gentrified</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 18:42:09</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41700517"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41700516">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/09/30/us/california-bans-legacy-admissions-private-universities.html"
              >California bans legacy admissions at private universities</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 18:42:03</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41700516"
                  >Comments</a
                ><span class="descendants">: 234</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41700394">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/space/2024/09/engineers-investigate-another-malfunction-on-spacexs-falcon-9-rocket/"
              >Engineers investigate another malfunction on SpaceX's Falcon 9
              rocket</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 18:30:05</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41700394"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41699730">
          <h3>
            <a class="item" href="https://www.gnucash.org/news.phtml"
              >GnuCash 5.9 Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 17:26:03</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41699730"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41699323">
          <h3>
            <a class="item" href="https://github.com/peer-calls/peer-calls"
              >Peer Calls: WebRTC peer to peer calls for everyone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 16:51:48</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41699323"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41698823">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/10/07/dr-calhouns-mousery-lee-alan-dugatkin-book-reviews-rat-city-edmund-ramsden-and-jon-adams"
              >Two new books on John Calhoun and his rodent experiments</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 16:11:52</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41698823"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41698686">
          <h3>
            <a
              class="item"
              href="https://blog.sequinstream.com/at-most-once-at-least-once-and-exactly-once-delivery/"
              >No such thing as exactly-once delivery</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 16:00:17</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41698686"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41697137">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41697137"
              >Launch HN: Inkeep (YC W23) – Copilot for Support (think Cursor
              for help desks)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 13:57:38</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41697137"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
            <div class="text">
              <a href="https://inkeep.com">https://inkeep.com</a>). We help
              companies turn their content into AI support copilots. So far,
              we’d focused on customer-facing experiences (e.g. find us as an
              “Ask AI” button in the docs of companies like Anthropic and
              Pinecone). Today, we’re excited to share our new copilot, Keep,
              which is designed specifically for support agents.
              <p>
                It’s a conversational sidebar you can use as an app for Zendesk
                or Chrome Extension for any support platform. There’s a demo
                video at
                <a href="https://vid.inkeep.com/cx-copilot"
                  >https://vid.inkeep.com/cx-copilot</a
                >
                or you can try the live sandbox with example tickets at
                <a href="https://try.inkeep.com/cx-copilot"
                  >https://try.inkeep.com/cx-copilot</a
                >.
              </p>
              <p>
                Why? Most AI support tools today are focused on trying to have
                AI answer customer questions before they even reach support
                teams (‘deflection’). We’d focused on that too. However, we
                heard from many of our customers that while they care about
                deflection, they care even more about providing high-quality,
                fast human support when users need it. Some teams don’t even
                want customer-facing AI at all and just want AI tools to help
                their team be more efficient. We created Keep with these
                scenarios in mind.
              </p>
              <p>Keep does a few neat things we haven’t seen elsewhere:</p>
              <p>
                1. Provides intelligent suggestions: if Keep is confident, it’ll
                create a draft answer and tell you the sources it used. If the
                ticket is long, it’ll summarize the conversation so far and
                outline the remaining to-dos. All automatic and contextual to
                the ticket.
              </p>
              <p>
                2. Is fully conversational: ask for clarifications, revise draft
                answers, and iterate as needed.
              </p>
              <p>
                3. Uses ‘Generative UI’: suggestions are rendered as glanceable,
                interactive UI components. For example, a draft answer has
                buttons like “Shorten” &amp; “Concise” that prompt the AI to
                revise the answer. UI components are interweaved within normal
                text.
              </p>
              <p>
                4. Turns tickets into FAQs: can generate an FAQ from a closed
                ticket and lets you iterate on it and save it when done.
              </p>
              <p>
                5. Leverages many content types: uses your docs, help center,
                previous support tickets, Slack threads, etc.
              </p>
              <p>
                We were inspired by tools like Cursor, Claude Artifacts, and v0.
                These experiences go beyond plain-text conversations by
                interweaving interactive code blocks or UI previews into their
                answers. This makes answers digestible and intuitive (and fun)
                to iterate on.
              </p>
              <p>
                Some technical details, for those interested: We use the Vercel
                AI SDK to optimistically stream the React components by using
                our Chat APIs, which are powered by Claude Sonnet 3.5 and our
                RAG service. Our APIs follow the OpenAI chat completion format
                so are generally compatible with any LLM tooling. Our
                `inkeep-qa` API generates draft answers and the `inkeep-context`
                API generates structured outputs and tool calls (docs:
                <a href="https://go.inkeep.com/ai-api"
                  >https://go.inkeep.com/ai-api</a
                >). For an example of how these APIs are used, check out our
                Intelligent Support Form example (demo:
                <a href="https://try.inkeep.com/ai-form"
                  >https://try.inkeep.com/ai-form</a
                >, repo:
                <a href="https://quickstart.inkeep.com/ai-form"
                  >https://quickstart.inkeep.com/ai-form</a
                >).
              </p>
              <p>
                If you want to try Inkeep on your product's content, just fill
                out the form in our landing page. You’ll get a demo in your
                inbox powered by your public content — NO “call us”, “book a
                demo”, or “schedule a meeting” required. Note: we do check that
                your email domain matches your content to prevent spam.
              </p>
              <p>
                Curious to hear about your experiences when working with
                customer/support questions and any ideas on how else the copilot
                could be useful for those scenarios.
              </p>
            </div>
          </section>
        </section>
        <section id="41697064">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/typewise/jobs/NH0WiMZ-senior-backend-engineer-f-m-x"
              >Typewise (YC S22) Is Hiring a Senior AI Back End Engineer
              (Python, Europe)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 13:50:48</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41696560">
          <h3>
            <a class="item" href="https://afewthingz.com/browserbookmark"
              >The best browser bookmarking system is files</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 12:51:44</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41696560"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41696046">
          <h3>
            <a
              class="item"
              href="https://www.marginalia.nu/log/a_111_phrase_matching/"
              >Phrase matching in Marginalia Search</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 11:42:55</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41696046"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41695840">
          <h3>
            <a class="item" href="https://github.com/mediar-ai/screenpipe"
              >Screenpipe: 24/7 local AI screen and mic recording</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 11:15:36</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41695840"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41695756">
          <h3>
            <a
              class="item"
              href="https://apps.apple.com/us/app/crystalclear-sound/id6695723746?mt=12"
              >Show HN: A macOS app to prevent sound quality degradation on
              AirPods</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 11:03:10</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41695756"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's a known issue and here's what Apple recommends to fix it:
                <a href="https://support.apple.com/en-hk/102217"
                  >https://support.apple.com/en-hk/102217</a
                >
              </p>
              <p>
                Most of the time(unless you are on a Mac Mini/Studio/Pro), you
                have much higher quality microphones built in, so in most use
                cases, you want to hear from your AirPods but be heard from your
                internal microphone, which means if every time you connect your
                AirPods and go into the settings and set the default input
                device as the internal mic, you won't have sound quality
                degradation on mic activation, and if you use your mic to talk
                to people or record something, you will have better sound
                quality too.
              </p>
              <p>
                Based on this observation, first I tried to create a script or
                some automation that can do it for me but found out that it can
                be clunky or needlessly complex.
              </p>
              <p>
                Here's someone who used this approach to fix this issue:
                <a
                  href="https://www.dermitch.de/post/macos-force-microphone-when-using-airpods/"
                  >https://www.dermitch.de/post/macos-force-microphone-when-usi...</a
                >
              </p>
              <p>
                Anyway, I decided to take the "build your app for that" route
                and created this app and called it CrystalClear Audio which
                doesn't involve any technical setup to use. Making it was also
                not as easy I hoped, I was expecting this to be a half an hour
                project but ended up filing bug reports with Apple because some
                API wasn't behaving as expected or mysterious things were
                happening when using it(like phantom device changes).
              </p>
              <p>
                After spending that much time with all this, I decided to
                publish it on Mac AppStore and after too many rejections(all my
                mistakes) I got it published:
                <a
                  href="https://apps.apple.com/us/app/crystalclear-sound/id6695723746"
                  >https://apps.apple.com/us/app/crystalclear-sound/id669572374...</a
                >
              </p>
              <p>
                The app is not free but comes with a free trial. I decided to go
                with a very cheap subscription model because I suspect further
                development might be needed as bugs emerge or API behavior
                changes. I know its a hated business model but IMHO it's better
                than ads or tracking of any sort to justify the work done. It's
                not free because supporting a free app is just as hard as
                supporting a paid one and it's not one time payment because I
                don't know what would the right price be for supporting an app
                for years to come and still have people willing to pay for it.
              </p>
              <p>
                I hope other people find this useful and if you do, you can
                support by upvoting on Producthunt so even more people can find
                it sueful:
                <a href="https://www.producthunt.com/posts/crystalclear-sound"
                  >https://www.producthunt.com/posts/crystalclear-sound</a
                >
              </p>
              <p>
                PS: the app is also useful for quickly switching between giving
                the sound out of the laptop speakers and the headphones, I ended
                up using that quite often.
              </p>
            </div>
          </section>
        </section>
        <section id="41694712">
          <h3>
            <a class="item" href="https://app.keeptrack.space"
              >Keep Track: 3D Satellite Toolkit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 08:10:12</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41694712"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41694504">
          <h3>
            <a
              class="item"
              href="https://ngrok.com/blog-post/how-we-built-ngroks-data-platform"
              >How we built ngrok's data platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 07:35:01</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41694504"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41694044">
          <h3>
            <a class="item" href="https://walzr.com/bop-spotter">Bop Spotter</a>
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 06:09:53</span
              ><span class="points-container"
                >Points: <span class="points">1199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41694044"
                  >Comments</a
                ><span class="descendants">: 237</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41693979">
          <h3>
            <a
              class="item"
              href="https://rodneybrooks.com/tips-for-building-and-deploying-robots/"
              >Tips for Building and Deploying Robots</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 05:55:51</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41693979"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41693087">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2024/Sep/29/notebooklm-audio-overview/"
              >NotebookLM's automatically generated podcasts are surprisingly
              effective</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 02:58:02</span
              ><span class="points-container"
                >Points: <span class="points">787</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41693087"
                  >Comments</a
                ><span class="descendants">: 401</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41691943">
          <h3>
            <a
              class="item"
              href="https://benn.substack.com/p/do-ai-companies-work"
              >Do AI companies work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-29 @ 23:44:57</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41691943"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41690302">
          <h3>
            <a
              class="item"
              href="https://www.gov.ca.gov/wp-content/uploads/2024/09/SB-1047-Veto-Message.pdf"
              >Gavin Newsom vetoes SB 1047</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-29 @ 20:43:32</span
              ><span class="points-container"
                >Points: <span class="points">727</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41690302"
                  >Comments</a
                ><span class="descendants">: 416</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41688469">
          <h3>
            <a class="item" href="https://mundraub.org/map"
              >Map with public fruit trees</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-29 @ 16:29:36</span
              ><span class="points-container"
                >Points: <span class="points">323</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41688469"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41688018">
          <h3>
            <a class="item" href="https://gitlab.com/zephray/sitina1"
              >Sitina1 Open-Source Camera</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-29 @ 15:27:54</span
              ><span class="points-container"
                >Points: <span class="points">324</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41688018"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41671562">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/white-strawberry"
              >The fight to save Chile's white strawberry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-27 @ 15:20:41</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41671562"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41666269">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/normans-and-slavery-breaking-bonds"
              >Normans and Slavery: Breaking the Bonds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-27 @ 04:31:27</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41666269"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41653148">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-09-extreme-botany-paramotorists-soar-remote.html"
              >Paramotorists soar across remote Peru desert to collect
              threatened plants</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-26 @ 00:04:10</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41653148"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
