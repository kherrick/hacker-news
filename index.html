<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41920591">
          <h3>
            <a class="item" href="https://bmchtech.github.io/post/multiply/"
              >Solving the Mystery of ARM7TDMI Multiply Carry Flag</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 01:13:28</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41920591"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41920491">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/sei/jobs/gTP6gPx-software-engineer-typescript-gen-ai"
              >Sei AI (YC W22) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 01:00:32</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41920401">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-10-23/arm-to-cancel-qualcomm-chip-design-license-in-escalation-of-feud"
              >Arm is canceling Qualcomm's chip design license</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 00:48:24</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41920401"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41920294">
          <h3>
            <a
              class="item"
              href="https://github.com/konstin/sudoku-in-python-packaging"
              >Solving Sudoku with the Python package resolver</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 00:35:21</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41920294"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41919907">
          <h3>
            <a
              class="item"
              href="https://hai.stanford.edu/news/tech-coup-new-book-shows-how-unchecked-power-companies-destabilizing-governance"
              >How the Unchecked Power of Companies Is Destabilizing
              Governance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 23:42:57</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41919907"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41919717">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/simone-giertz"
              >Simone Giertz talks about invention</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 23:12:04</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41919717"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41919262">
          <h3>
            <a
              class="item"
              href="https://www.micron.com/about/blog/memory/dram/how-dram-changed-the-world"
              >How DRAM changed the world</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 22:12:15</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41919262"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41918621">
          <h3>
            <a
              class="item"
              href="https://github.com/abdulkader-alrezej/ipv6spot"
              >Captive Portal IPv6 Support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 20:58:07</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41918621"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41918448">
          <h3>
            <a class="item" href="https://snack.xyz/"
              >Show HN: I made a tool for curating and sharing links as lists</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 20:36:58</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41918448"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41918446">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-10-fast-quantum-entanglement-scientists-attosecond.html"
              >How fast is quantum entanglement? Scientists investigate it at
              attosecond scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 20:36:45</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41918446"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41918414">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/994704/0356b274aa959853/"
              >A Report from the 2024 Image-Based Linux Summit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 20:32:28</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41918414"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41917990">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/tsmc-told-us-chip-huawei-device-after-techinsights-finding-source-says-2024-10-22/"
              >TSMC told US of chip in Huawei product after TechInsights
              finding, source says</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 19:48:58</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41917990"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41917035">
          <h3>
            <a
              class="item"
              href="https://tsapps.nist.gov/srmext/certificates/documents/Current_SRM_Catalog.pdf"
              >NIST Standard Reference Materials Catalog [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 18:12:52</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41917035"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41917016">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/technology/archive/2017/04/the-tragedy-of-google-books/523320/"
              >The Tragedy of Google Books (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 18:11:03</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41917016"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41916322">
          <h3>
            <a
              class="item"
              href="https://www.usgs.gov/news/national-news-release/unlocking-arkansas-hidden-treasure-usgs-uses-machine-learning-show-large"
              >USGS uses machine learning to show large lithium potential in
              Arkansas</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 17:05:01</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41916322"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41915958">
          <h3>
            <a class="item" href="https://github.com/solcloud/Counter-Strike"
              >Show HN: Open-source Counter-Strike-like game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 16:27:51</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41915958"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41915724">
          <h3>
            <a
              class="item"
              href="https://planetscale.com/blog/announcing-planetscale-vectors-public-beta"
              >The PlanetScale vectors public beta</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 16:06:55</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41915724"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41915187">
          <h3>
            <a
              class="item"
              href="https://abcnews.go.com/US/wireStory/ftcs-rule-banning-fake-online-reviews-effect-115009298"
              >FTC's rule banning fake online reviews goes into effect</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 15:21:58</span
              ><span class="points-container"
                >Points: <span class="points">413</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41915187"
                  >Comments</a
                ><span class="descendants">: 239</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41914989">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/3-5-models-and-computer-use"
              >Computer use, a new Claude 3.5 Sonnet, and Claude 3.5 Haiku</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 15:02:46</span
              ><span class="points-container"
                >Points: <span class="points">977</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41914989"
                  >Comments</a
                ><span class="descendants">: 533</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41914845">
          <h3>
            <a
              class="item"
              href="https://clickhouse.com/blog/a-new-powerful-json-data-type-for-clickhouse"
              >We built a new powerful JSON data type for ClickHouse</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 14:47:00</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41914845"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41914544">
          <h3>
            <a class="item" href="https://github.com/levkk/rwf"
              >Show HN: Rust Web Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 14:15:54</span
              ><span class="points-container"
                >Points: <span class="points">360</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41914544"
                  >Comments</a
                ><span class="descendants">: 167</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been "funemployed" for a few months and with all that free
                time and idle hands I wrote a full web framework (think Rails,
                not Flask) for Rust.
              </p>
              <p>
                It's boring old MVC, has its own ORM, templates, background
                jobs, auth, websockets, migrations and more. If you're keen but
                don't feel like rewriting your app in a different language, Rwf
                has a WSGI server to run Django (or Flask) inside Rust [1],
                letting you migrate to Rust at your own pace without disrupting
                your website.
              </p>
              <p>
                I think Rust makes a great prototyping and deploy straight to
                production language. Now it has yet another framework for y'all
                to play with.
              </p>
              <p>Cheers!</p>
              <p>
                [1]
                <a href="https://levkk.github.io/rwf/migrating-from-python/"
                  >https://levkk.github.io/rwf/migrating-from-python/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41913520">
          <h3>
            <a class="item" href="https://ambulate.app"
              >Show HN: Ambulate â€“ Detailed Trip Planning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 12:19:43</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41913520"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <p>
                Features - Manage itineraries - Add activities and map markers -
                Add routes (upload GPX or plot by hand on map) - Desktop and
                mobile
              </p>
              <p>
                It is free to try (login using Google or create a user).
                Alternatively the slides on the home page give an idea of the
                UI.
              </p>
              <p>
                I'll appreciate any thoughts and feedback you care to share:)
              </p>
            </div>
          </section>
        </section>
        <section id="41913437">
          <h3>
            <a class="item" href="https://www.votito.com/methods/togs-paradox/"
              >Tog's Paradox</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 12:05:41</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41913437"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41912284">
          <h3>
            <a class="item" href="https://blog.plover.com/math/PM.html"
              >One Plus One Equals Two (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 08:21:42</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41912284"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41894765">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41894765"
              >Ask HN: What's the most creative 'useless' program you've ever
              written?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-20 @ 11:56:31</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41894765"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
            <div class="text">
              I recently came across the concept of "useless" programs - pieces
              of code that serve no practical purpose but are fun, creative, or
              challenging to write. These could be anything from elaborate ASCII
              art generators to programs that solve imaginary problems. I'm
              curious to hear about the most interesting or creative "useless"
              programs the HN community has written. What was your motivation?
              What unexpected challenges did you face? Did you learn anything
              valuable from the experience? Some examples to get the ball
              rolling: 1. A program that prints the lyrics of "99 Bottles of
              Beer" in binary. A text-based game where you play as a semicolon
              trying to find its way to the end of a line of code. A script that
              translates English text into Shakespearean insults. Share your
              creations, no matter how quirky or impractical. Let's celebrate
              the joy of coding for coding's sake!
            </div>
          </section>
        </section>
        <section id="41894669">
          <h3>
            <a class="item" href="https://www.alexbowe.com/rrr/"
              >RRR: A Succinct Rank/Select Index for Bit Vectors (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-20 @ 11:34:15</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41894669"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41886047">
          <h3>
            <a
              class="item"
              href="https://blog.wilsonb.com/posts/2024-09-27-brainfuck.html"
              >Implementing Brainfuck in APL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-19 @ 06:32:50</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41886047"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41883365">
          <h3>
            <a
              class="item"
              href="https://github.com/pc2005cz/TheUltimate486Upgrade/blob/main/main.md"
              >Coreboot port for 486 motherboard (UM8881/6)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-18 @ 20:48:43</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41883365"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41881897">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/travel/what-its-like-to-experience-polar-night-in-the-worlds-northernmost-town-180985271/"
              >Polar Night in the Northernmost Town</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-18 @ 18:02:35</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41881897"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41880709">
          <h3>
            <a
              class="item"
              href="https://rabbitwaves.ca/site/flags_maritime.html"
              >An Illustrated Guide to Maritime Signal Flags</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-18 @ 16:08:21</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41880709"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
