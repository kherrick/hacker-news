<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38024573">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/10/apple-backs-national-right-to-repair-bill-offering-parts-manuals-and-tools/"
              >Apple backs national right-to-repair bill, offering parts,
              manuals, and tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 12:21:50</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38024573"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38024337">
          <h3>
            <a
              class="item"
              href="https://www.dezeen.com/2023/10/25/pulpatronics-paper-rfid-tags/"
              >Pulpatronics tackles single-use electronics with paper RFID
              tags</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 11:51:35</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38024337"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38024327">
          <h3>
            <a
              class="item"
              href="https://english.elpais.com/science-tech/2023-10-23/the-secrets-of-megatsunamis-waves-over-500-meters-high-and-devastation-beyond-the-ocean.html"
              >Megatsunamis: Waves over 500 meters high and devastation beyond
              the ocean</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 11:49:44</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38024327"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38024056">
          <h3>
            <a
              class="item"
              href="https://www.gamedeveloper.com/business/reality-labs-has-lost-11-4-billion-during-2023-and-there-s-still-one-quarter-left-"
              >Reality Labs has lost $11.4B during 2023 (there's still one
              quarter left)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 11:11:46</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38024056"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38024002">
          <h3>
            <a
              class="item"
              href="https://github.com/analysis-tools-dev/static-analysis"
              >Static Analysis Tools for C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 11:03:20</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38024002"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38023891">
          <h3>
            <a
              class="item"
              href="https://oxide.computer/blog/the-cloud-computer"
              >Oxide: The Cloud Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 10:43:59</span
              ><span class="points-container"
                >Points: <span class="points">269</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38023891"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38023874">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/10/26/technology/google-apple-search-spotlight.html"
              >Google's Plan to Stop Apple from Getting Serious About Search</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 10:40:31</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38023874"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38023852">
          <h3>
            <a
              class="item"
              href="https://www.scmp.com/tech/tech-war/article/3239238/advanced-chip-huawei-mate-60-pro-smartphone-produced-asml-duv-machines-sources"
              >ASML DUV machines used to produce Huawei Mate 60 Pro chips</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 10:36:43</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38023852"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38023580">
          <h3>
            <a
              class="item"
              href="https://www.gamesradar.com/5-people-made-the-original-super-mario-bros-all-of-them-were-still-at-nintendo-to-ship-wonder-38-years-later/"
              >People who made the original Super Mario Bros shipped Wonder 38
              years later</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 09:45:17</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38023580"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38023392">
          <h3>
            <a
              class="item"
              href="https://steve-yegge.medium.com/dear-google-cloud-your-deprecation-policy-is-killing-you-ee7525dc05dc"
              >Dear Google Cloud: Your Deprecation Policy Is Killing You
              (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 09:09:21</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38023392"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38021461">
          <h3>
            <a class="item" href="https://github.com/instant-dev/api"
              >Show HN: Instant API – Build type-safe web APIs with
              JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 04:00:22</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38021461"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
            <div class="text">
              <p>
                This eliminates the need for most schema validation libraries,
                automates user input sanitization, and prevents your team from
                developing carpal tunnel syndrome trying to keep your OpenAPI /
                Swagger specifications up-to-date. We developed it as a side
                effect of building our own serverless API platform, where it has
                scaled to handle over 100M requests from users per day. This is
                an early release, but Instant API has had about six years of
                consistent development as proprietary software to get to the
                point it is at today. We have spent the last couple of months
                modernizing it.
              </p>
              <p>
                We have command line tools that make building, testing, and
                deploying Instant API to Vercel or AWS a breeze. Additionally,
                there is a sister package, Instant ORM, that provides a Ruby on
                Rails-like model management, migration and querying suite for
                Postgres. Everything you need to build an API from scratch.
              </p>
              <p>
                Finally -- LLMs and chatbots are the the top of the hype cycle
                right now. We aren't immune, and have developed a number of
                LLM-integrated tools ourselves. Instant API comes with
                first-class Server-Sent Event support for building your own
                assistants and a few other nifty tools that help with AI
                integrations and chatbot webhook responses, like executing
                endpoints as background jobs.
              </p>
              <p>
                This has been a huge labor of love -- it has become our
                "JavaScript on Rails" suite -- and we hope y'all enjoy it!
              </p>
            </div>
          </section>
        </section>
        <section id="38020792">
          <h3>
            <a class="item" href="https://research.swtch.com/nih"
              >Running the "Reflections on Trusting Trust" Compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 01:57:14</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38020792"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38020308">
          <h3>
            <a
              class="item"
              href="https://blogs.bl.uk/digitisedmanuscripts/2023/10/chaucers-works-go-online.html"
              >Chaucer's works go online</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 00:48:20</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38020308"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38020109">
          <h3>
            <a
              class="item"
              href="https://jina.ai/news/jina-ai-launches-worlds-first-open-source-8k-text-embedding-rivaling-openai/"
              >Jina AI launches open-source 8k text embedding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 00:24:41</span
              ><span class="points-container"
                >Points: <span class="points">430</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38020109"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38019231">
          <h3>
            <a
              class="item"
              href="https://jsoverson.medium.com/was-rust-worth-it-f43d171fb1b3"
              >Was Rust Worth It?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 22:37:06</span
              ><span class="points-container"
                >Points: <span class="points">368</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38019231"
                  >Comments</a
                ><span class="descendants">: 535</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38018917">
          <h3>
            <a
              class="item"
              href="https://manas.tech/blog/2023/10/25/approaching-unconventional-problems/"
              >How to find a lost phone in a no-cell-coverage camping site?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 21:58:02</span
              ><span class="points-container"
                >Points: <span class="points">319</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38018917"
                  >Comments</a
                ><span class="descendants">: 226</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38017446">
          <h3>
            <a
              class="item"
              href="https://idl.cs.washington.edu/papers/living-papers/"
              >Living Papers: A Language Toolkit for Augmented Scholarly
              Communication</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 19:55:32</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38017446"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38015277">
          <h3>
            <a class="item" href="https://ileakage.com/"
              >iLeakage: Browser-Based Timerless Speculative Execution Attacks
              on Apple Devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 17:15:49</span
              ><span class="points-container"
                >Points: <span class="points">542</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38015277"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38013477">
          <h3>
            <a class="item" href="https://neal.fun/internet-artifacts/"
              >Internet Artifact Museum</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 14:54:33</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38013477"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38013299">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Heslington_Brain"
              >Heslington Brain</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 14:40:06</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38013299"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38012032">
          <h3>
            <a
              class="item"
              href="https://github.com/AndrewWalsh/openapi-devtools"
              >Show HN: OpenAPI DevTools – Chrome extension that generates an
              API spec</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 12:24:19</span
              ><span class="points-container"
                >Points: <span class="points">745</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38012032"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
            <div class="text">
              Effortlessly discover API behaviour with a Chrome extension that
              automatically generates OpenAPI specifications in real time for
              any app or website.
            </div>
          </section>
        </section>
        <section id="38010992">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38010992"
              >Ask HN: PG's 'Do Things That Don't Scale' manual examples?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 09:37:24</span
              ><span class="points-container"
                >Points: <span class="points">333</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38010992"
                  >Comments</a
                ><span class="descendants">: 255</span></span
              >
            </h4>
            <div class="text">
              In PG's essay he talks about manually doing what you later plan to
              automate and gives the example of stripe manually onboarding
              startups. Does anyone else have other examples?
            </div>
          </section>
        </section>
        <section id="38009291">
          <h3>
            <a
              class="item"
              href="https://salt.security/blog/oh-auth-abusing-oauth-to-take-over-millions-of-accounts"
              >Oh-Auth – Abusing OAuth to take over millions of accounts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 04:57:08</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38009291"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38007648">
          <h3>
            <a
              class="item"
              href="http://strangeco.blogspot.com/2023/10/the-first-american-murder.html"
              >The First American Murder</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 00:28:29</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38007648"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38004962">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/collection/the-book-of-halloween/"
              >A Melting Cauldron: The Book of Hallowe'en (1919)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 20:24:36</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38004962"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38002752">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/autos-transportation/california-suspends-gm-cruises-driverless-autonomous-vehicle-permits-2023-10-24/"
              >California suspends Cruise's autonomous vehicle deployment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 17:55:33</span
              ><span class="points-container"
                >Points: <span class="points">1154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38002752"
                  >Comments</a
                ><span class="descendants">: 1203</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38000573">
          <h3>
            <a
              class="item"
              href="https://resobscura.substack.com/p/simulating-history-with-multimodal"
              >Simulating History with Multimodal AI: An Update</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 15:32:12</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38000573"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37997940">
          <h3>
            <a
              class="item"
              href="https://www.anandtech.com/show/21104/samsung-announces-shinebolt-hbm3e-memory-hbm-hits-36gb-stacks-at-98-gbps"
              >Samsung announces 'Shinebolt' HBM3E memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 12:06:16</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37997940"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37997282">
          <h3>
            <a
              class="item"
              href="https://www.ilograph.com/architecture-center/index.html"
              >Ilograph Architecture Center</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 11:02:35</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37997282"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37994996">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Randolph_Bourne"
              >Randolph Bourne</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 05:06:12</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37994996"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
