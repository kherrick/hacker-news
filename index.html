<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40595499">
          <h3>
            <a
              class="item"
              href="https://geospatial.netlify.app/posts/gds-2024-04-20-cathedrals/"
              >St Michael Sword investigation: Are the 7 Cathedrals on a
              straight line?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 09:48:59</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40595499"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40595456">
          <h3>
            <a
              class="item"
              href="https://www.robkhenderson.com/p/the-distinctiveness-of-human-aggression"
              >The Distinctiveness of Human Aggression (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 09:44:11</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40595456"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40595384">
          <h3>
            <a
              class="item"
              href="https://www.qemu.org/2018/02/09/understanding-qemu-devices/"
              >Understanding QEMU Devices (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 09:33:19</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40595384"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40595222">
          <h3>
            <a
              class="item"
              href="https://www.esa.int/Enabling_Support/Space_Transportation/Ariane/Ariane_6_inaugural_launch_targeted_for_9_July"
              >Ariane 6 inaugural launch targeted for 9 July</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 09:11:34</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40595222"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40595164">
          <h3>
            <a
              class="item"
              href="https://www.spacex.com/launches/mission/?missionId=starship-flight-4"
              >Starship's Fourth Flight Test: Window Opens 07:00 AM Central
              Time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 09:04:32</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40595164"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40594533">
          <h3>
            <a
              class="item"
              href="https://www.fbi.gov/news/speeches/fbi-cyber-assistant-director-bryan-vorndran-s-remarks-at-the-2024-boston-conference-on-cyber-security"
              >FBI has obtained 7k Lockbit ransomware decryption keys</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 07:28:11</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40594533"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40594152">
          <h3>
            <a
              class="item"
              href="https://ntrs.nasa.gov/api/citations/20190025446/downloads/20190025446.pdf"
              >Durability of Polymers in the Space Environment [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 06:24:19</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40594152"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40593674">
          <h3>
            <a
              class="item"
              href="https://soranews24.com/2024/05/28/mitsubishi-develops-robot-that-solves-rubiks-cube-style-puzzle-in-0-305-seconds%e3%80%90video%e3%80%91/"
              >Mitsubishi robot solves Rubik's Cube in 0.305s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 05:00:25</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40593674"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40593540">
          <h3>
            <a
              class="item"
              href="https://mkukri.xyz/2024/06/01/tpm-gpio-fail.html"
              >TPM GPIO fail: How bad OEM firmware ruins Intel TPM security</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 04:34:57</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40593540"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40593275">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/06/05/technology/nvidia-microsoft-openai-antitrust-doj-ftc.html"
              >U.S. clears way for antitrust inquiries of Nvidia, Microsoft and
              OpenAI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 03:52:42</span
              ><span class="points-container"
                >Points: <span class="points">214</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40593275"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40592998">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/psa-if-youre-a-fan-of-atmega-try"
              >PSA: If you're a fan of ATmega, try AVR Dx</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 03:03:59</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40592998"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40592789">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/online-privacy"
              >Microsoft AI spying scandal: time to rethink privacy standards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 02:25:25</span
              ><span class="points-container"
                >Points: <span class="points">506</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40592789"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40592575">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/most-life-on-earth-is-dormant-after-pulling-an-emergency-brake-20240605/"
              >Most life on Earth is dormant, after pulling an 'emergency
              brake'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 01:45:25</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40592575"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40590910">
          <h3>
            <a class="item" href="https://webdraft.hu/fonts/classic-console/"
              >Show HN: Original 8x16 ASCII Fixed Width Font: Classic Console
              Neue</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 21:35:53</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40590910"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40589675">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/researchers-plan-retract-landmark-alzheimers-paper-containing-doctored-images"
              >Researchers to retract landmark Alzheimer's paper containing
              doctored images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 19:49:18</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40589675"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40588540">
          <h3>
            <a
              class="item"
              href="https://lukemuehlhauser.com/industrial-revolution/"
              >How big a deal was the Industrial Revolution? (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 18:28:53</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40588540"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40586757">
          <h3>
            <a
              class="item"
              href="https://coder.com/blog/delivering-5x-faster-throughput-in-coder-2-12-0"
              >We improved the performance of a userspace TCP stack in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 16:13:39</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40586757"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40586654">
          <h3>
            <a
              class="item"
              href="https://www.idealista.com/en/news/legal-advice-in-spain/2024/04/15/816509-squatting-in-spain-understanding-spain-s-okupas-problem"
              >Squatting in Spain: Understanding Spain's "okupas" problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 16:06:05</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40586654"
                  >Comments</a
                ><span class="descendants">: 267</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40585932">
          <h3>
            <a class="item" href="https://github.com/misprit7/foosbar"
              >Show HN: Foosbar – My autonomous foosball-playing robot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 15:16:50</span
              ><span class="points-container"
                >Points: <span class="points">270</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40585932"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40585842">
          <h3>
            <a
              class="item"
              href="https://rosenzweig.io/blog/vk13-on-the-m1-in-1-month.html"
              >Vulkan1.3 on the M1 in one month</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 15:11:01</span
              ><span class="points-container"
                >Points: <span class="points">733</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40585842"
                  >Comments</a
                ><span class="descendants">: 281</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40585728">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/live/world-us-canada-69094213"
              >Boeing Starliner launches first crewed mission</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 15:04:03</span
              ><span class="points-container"
                >Points: <span class="points">574</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40585728"
                  >Comments</a
                ><span class="descendants">: 593</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40585559">
          <h3>
            <a class="item" href="https://github.com/laudspeaker/laudspeaker"
              >Show HN: Laudspeaker – Open-source mobile push, SMS and email
              automation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 14:52:37</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40585559"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
            <div class="text">
              <p>
                Laudspeaker (<a href="https://laudspeaker.com/"
                  >https://laudspeaker.com/</a
                >) is an open source customer engagement suite (also called
                marketing automation software). If you've used tools like Braze,
                One Signal, Airship, Iterable, Customer.io or some others,
                Laudspeaker is an alternative to these. Here is a quick demo:
                <a
                  href="https://www.loom.com/share/4b309390ee274ea491981e1394e9abc4"
                  >https://www.loom.com/share/4b309390ee274ea491981e1394e9abc4</a
                >. And here is a link to sign up and try free (no cc needed):
                <a href="https://app.laudspeaker.com/signup"
                  >https://app.laudspeaker.com/signup</a
                >.
              </p>
              <p>
                Or if you prefer to just jump in, go to
                <a href="https://app.laudspeaker.com/login"
                  >https://app.laudspeaker.com/login</a
                >
                and use this test account:
              </p>
              <p></p>
              <pre><code>  email: test94@laudspeaker.com
  pw: test93@laudspeaker.com
</code></pre>
              The main things Laudspeaker lets you do are:
              <p>
                1. Define 'segments': which of your users should receive
                messages.
              </p>
              <p>
                2. Define 'messaging journeys': when, where and with which
                channels you want to reach users. Right now we support push,
                email, SMS, and soon we'll also include in-app messages and
                WhatsApp.
              </p>
              <p>
                For example, one customer of ours runs a journey like this:
                "Wait for a user to complete onboarding on our mobile app, then
                send a welcome push. If they complete an action the next day on
                the app, stop sending messages, otherwise send a followup
                email."
              </p>
              <p>
                There are quite a few big updates since our last Show HN (<a
                  href="https://news.ycombinator.com/item?id=34835559"
                  >https://news.ycombinator.com/item?id=34835559</a
                >):
              </p>
              <p>
                We now have a mobile SDK for sending and receiving push
                notifications. We have revamped the journey builder, and made
                our segment builder much more comprehensive. Our application is
                also a lot more battle tested - we are deployed with a major
                fintech in Asia and are sending XX million messages a week to
                more than x million users.
              </p>
              <p>
                We've seen a lot of demand from consumer focused apps and
                websites who find most of the existing solutions' pricing models
                prohibitively expensive so please reach out if that sounds like
                you. We have successfully migrated people over from Braze,
                customer io and others.
              </p>
              <p>
                If you're interested in the mobile SdK, see our tutorial:
                <a
                  href="https://laudspeaker.com/docs/getting-started/setting-up-mobile-push"
                  >https://laudspeaker.com/docs/getting-started/setting-up-mobi...</a
                >,
              </p>
              <p>
                and sample apps:
                <a href="https://github.com/laudspeaker/android-sample-app"
                  >https://github.com/laudspeaker/android-sample-app</a
                >,
                <a href="https://github.com/laudspeaker/ios-sample-app"
                  >https://github.com/laudspeaker/ios-sample-app</a
                >.
              </p>
              <p>
                Our Github is
                <a href="https://github.com/laudspeaker/laudspeaker"
                  >https://github.com/laudspeaker/laudspeaker</a
                >. Try it out for free at
                <a href="https://app.laudspeaker.com/signup"
                  >https://app.laudspeaker.com/signup</a
                >.
              </p>
              <p>We'd love to hear your feedback and comments!</p>
            </div>
          </section>
        </section>
        <section id="40582035">
          <h3>
            <a class="item" href="https://martinwecke.de/108/"
              >Minimalistic Beat Maker</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 06:43:45</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40582035"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40581528">
          <h3>
            <a
              class="item"
              href="https://literaryreview.co.uk/our-man-in-fotheringhay"
              >Our Man in Fotheringhay</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 04:58:44</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40581528"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40580874">
          <h3>
            <a
              class="item"
              href="https://www.entrepreneur.com/business-news/realpage-rent-price-fixing-probe-escalates-with-fbi-raid/475109"
              >FBI raids Atlanta corporate landlord in probe of rental market
              price fixing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 02:35:58</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40580874"
                  >Comments</a
                ><span class="descendants">: 231</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40580142">
          <h3>
            <a
              class="item"
              href="https://research.google/blog/heuristics-on-the-high-seas-mathematical-optimization-for-cargo-ships/"
              >Mathematical Optimization for Cargo Ships</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 00:00:42</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40580142"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40578137">
          <h3>
            <a
              class="item"
              href="https://www.theparisreview.org/blog/2024/05/20/televised-music-is-a-pointless-rigmarole/"
              >Televised Music Is a Pointless Rigmarole (1968)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 19:33:38</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40578137"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40573689">
          <h3>
            <a
              class="item"
              href="https://laurent.le-brun.eu/blog/an-overview-of-starlark"
              >An Overview of the Starlark Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 12:17:12</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40573689"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40573506">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2024/06/infrared-infrastructure/"
              >Infrared Infrastructure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 11:57:18</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40573506"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40573364">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/technology/night-vision-thin-light-lens/"
              >Night-vision lenses so thin and light that we can all see in the
              dark</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 11:42:13</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40573364"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
