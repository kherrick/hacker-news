<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42473321">
          <h3>
            <a
              class="item"
              href="https://arcprize.org/blog/oai-o3-pub-breakthrough"
              >OpenAI O3 breakthrough high score on ARC-AGI-PUB</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 18:11:13</span
              ><span class="points-container"
                >Points: <span class="points">323</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42473321"
                  >Comments</a
                ><span class="descendants">: 226</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42473032">
          <h3>
            <a class="item" href="https://grayjay.app/desktop/"
              >Grayjay Desktop App</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 17:33:00</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42473032"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42472828">
          <h3>
            <a
              class="item"
              href="https://apps.apple.com/us/app/day-by-data/id6737629704"
              >Show HN: Spotify and Apple Health Data as Art</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 17:12:24</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42472828"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                So I made this app, Day by Data, to connect with and visualize
                your personal data like step count, music listening habits, and
                more into tiny visualizations and data art right on your iPhone.
              </p>
              <p>
                The launch version has a few year-in-steps breakdowns and a few
                Spotify data-visualizations.
              </p>
              <p>
                Over time, the goal is to make more data sources available to
                connect and empower users to learn from their personal data
                stored across these platforms. Think data about the food we eat,
                places we travel, or shows we watch.
              </p>
              <p>
                Data accessibility and cleanliness is the hardest part, but I'm
                always open to different sources and visualization types.
              </p>
              <p>
                Let me know what you think and if there are certain data sets
                you'd like to see visualized!
              </p>
            </div>
          </section>
        </section>
        <section id="42472247">
          <h3>
            <a
              class="item"
              href="https://climate.benjames.io/uk-electricity-bills/"
              >Why are UK electricity bills so expensive?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 16:05:31</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42472247"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42471933">
          <h3>
            <a
              class="item"
              href="https://acoup.blog/2024/12/20/collections-on-bread-and-circuses/"
              >Collections: On Bread and Circuses</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 15:30:40</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42471933"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42471927">
          <h3>
            <a
              class="item"
              href="https://cerncourier.com/a-bestiary-of-exotic-hadrons/"
              >A bestiary of exotic hadrons: the 23 exotic hadrons discovered at
              the LHC so far</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 15:29:59</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42471927"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42471913">
          <h3>
            <a class="item" href="https://artemis.jamesg.blog/"
              >Show HN: Artemis, a Calm Web Reader</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 15:28:50</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42471913"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
            <div class="text">
              <p>
                I have been using the tool, which I called Artemis, for several
                months. Every morning, I looked forward to my "morning paper" of
                blogs I love reading.
              </p>
              <p>
                There are no notifications, read vs. unread states, counts of
                posts, etc. Only the last seven days of posts are available. The
                colour scheme is changeable. Dark mode is supported. All popular
                feed formats are supported.
              </p>
              <p>
                There is no reading interface to read blog posts; rather, the
                links take you to the authors' websites. Many of my favourite
                bloggers put a lot of effort into the design of their blogs and
                like to change things up; I wanted an experience that embraced
                that.
              </p>
              <p>
                The reader is now available for anyone to use (with invite code
                "hn").
              </p>
            </div>
          </section>
        </section>
        <section id="42470386">
          <h3>
            <a class="item" href="https://gauntletai.com"
              >Gauntlet AI (YC S17) is training AI engineers and hiring them in
              Austin ($200k/yr)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 12:00:59</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42470202">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/space/2024/12/were-about-to-fly-a-spacecraft-into-the-sun-for-the-first-time/"
              >We're about to fly a spacecraft into the Sun for the first
              time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 11:23:56</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42470202"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42469560">
          <h3>
            <a class="item" href="https://rerun.io/blog/graphs"
              >Show HN: Interactive graphs in Rerun with a Rust port of
              D3-force</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 09:42:47</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42469560"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                We built this with applications in robotics and spatial
                computing in mind but would love to hear feedback from folks
                that would see this as useful in other domains as well.
              </p>
            </div>
          </section>
        </section>
        <section id="42469074">
          <h3>
            <a class="item" href="https://computer.tldraw.com"
              >Tldraw Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 07:42:36</span
              ><span class="points-container"
                >Points: <span class="points">358</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42469074"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42468214">
          <h3>
            <a class="item" href="https://distill.pub/2021/gnn-intro/"
              >A Gentle Introduction to Graph Neural Networks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 04:10:42</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42468214"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42467194">
          <h3>
            <a
              class="item"
              href="https://www.home-assistant.io/blog/2024/12/19/voice-preview-edition-the-era-of-open-voice/"
              >The era of open voice assistants</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-20 @ 00:29:57</span
              ><span class="points-container"
                >Points: <span class="points">587</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42467194"
                  >Comments</a
                ><span class="descendants">: 218</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42466676">
          <h3>
            <a
              class="item"
              href="https://win-vector.com/2024/12/19/kelly-cant-fail/"
              >Kelly Can't Fail</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 23:07:15</span
              ><span class="points-container"
                >Points: <span class="points">331</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42466676"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42464138">
          <h3>
            <a
              class="item"
              href="https://www.speakandregret.michaelinzlicht.com/p/revisiting-stereotype-threat"
              >Revisiting Stereotype Threat</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 18:08:29</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42464138"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42463123">
          <h3>
            <a class="item" href="https://www.nicbarker.com/clay"
              >Clay – UI Layout Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 16:36:54</span
              ><span class="points-container"
                >Points: <span class="points">326</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42463123"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42461688">
          <h3>
            <a class="item" href="https://github.com/apankrat/nullboard"
              >Nullboard: Kanban board in a single HTML file</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 14:29:18</span
              ><span class="points-container"
                >Points: <span class="points">469</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42461688"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42461530">
          <h3>
            <a
              class="item"
              href="https://harpers.org/archive/2025/01/the-ghosts-in-the-machine-liz-pelly-spotify-musicians/"
              >Ghost artists on Spotify</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 14:12:05</span
              ><span class="points-container"
                >Points: <span class="points">340</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42461530"
                  >Comments</a
                ><span class="descendants">: 258</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42453207">
          <h3>
            <a
              class="item"
              href="https://www.elevationlab.com/blogs/news/introducing-timecapsule"
              >A 10-Year Battery for AirTag</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 18:17:17</span
              ><span class="points-container"
                >Points: <span class="points">571</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42453207"
                  >Comments</a
                ><span class="descendants">: 499</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42450227">
          <h3>
            <a
              class="item"
              href="https://wyounas.github.io/concurrency/2024/12/12/how-concurrency-works-a-visual-guide/"
              >How concurrecy works: A visual guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 13:22:28</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42450227"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42450221">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2024/12/how-to-lose-a-fortune-with-just-one-bad-click/"
              >How to lose a fortune with one bad click</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 13:21:14</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42450221"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42450213">
          <h3>
            <a
              class="item"
              href="https://www.bostonglobe.com/ideas/2012/02/12/how-boston-city-hall-was-born/DtfspyXVbKBIKi8iSXHX6J/story.html"
              >How Boston City Hall was born</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 13:19:27</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42450213"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42449497">
          <h3>
            <a class="item" href="https://github.com/boardgameio/boardgame.io"
              >Boardgame.io: an engine for creating turn-based games using
              JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 10:50:20</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42449497"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42446686">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/health/2024/12/the-kids-are-maybe-alright-teen-drug-use-hits-new-lows-in-ongoing-decline/"
              >"Unprecedented" decline in teen drug use continues, surprising
              experts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 23:44:40</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42446686"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42441772">
          <h3>
            <a
              class="item"
              href="https://www.earthdata.nasa.gov/learn/data-in-action/global-navigation-satellite-system-data-brings-forth-guardian"
              >Using GPS satellites to detect tsunamis via ionospheric
              ionization waves</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 14:50:01</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42441772"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42439956">
          <h3>
            <a
              class="item"
              href="https://www.camras.nl/en/blog/2024/dwingeloo-telescope-receives-signals-from-voyager-1/"
              >HAM radio operators receive signals from Voyager 1 on Dwingeloo
              telescope</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 09:56:04</span
              ><span class="points-container"
                >Points: <span class="points">265</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42439956"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42436783">
          <h3>
            <a
              class="item"
              href="https://github.com/markmoxon/elite-source-code-commodore-64"
              >Documented and annotated source code for Elite on the Commodore
              64</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 23:42:38</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42436783"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42436097">
          <h3>
            <a
              class="item"
              href="https://99percentinvisible.org/episode/ten-thousand-years/"
              >Ten Thousand Years</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 22:18:55</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42436097"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42435127">
          <h3>
            <a
              class="item"
              href="https://github.com/huggingface/search-and-learn"
              >Open source inference time compute example from HuggingFace</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 20:35:45</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42435127"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42428290">
          <h3>
            <a class="item" href="https://pyherald.com/articles/16_12_2024/"
              >Conda: A package management disaster?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 05:47:47</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42428290"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
