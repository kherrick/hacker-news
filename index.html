<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36849649">
          <h3>
            <a
              class="item"
              href="https://www.semafor.com/article/07/23/2023/publishers-want-billions-not-millions-from-ai"
              >Publishers want billions, not millions, from AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 15:33:30</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36849649"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36849523">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/7/24/23805530/tiktok-text-posts-micro-blogging-twitter-threads"
              >TikTok is adding text posts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 15:25:58</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36849523"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36849478">
          <h3>
            <a class="item" href="https://github.com/ocaml-wasm/wasm_of_ocaml"
              >WASM_of_OCaml</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 15:23:30</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36849478"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36849277">
          <h3>
            <a
              class="item"
              href="https://vitalik.ca/general/2023/07/24/biometric.html"
              >What do I think about biometric proof of personhood?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 15:10:40</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36849277"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36848680">
          <h3>
            <a class="item" href="https://lock.cmpxchg8b.com/zenbleed.html"
              >Zenbleed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 14:34:31</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36848680"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36848037">
          <h3>
            <a
              class="item"
              href="https://retrododo.com/atari-collectible-arcade-circuit-boards/"
              >Atari Has Launched Collectible Arcade Circuit Boards of Retro
              Classics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 13:55:08</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36848037"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36847960">
          <h3>
            <a class="item" href="https://map.henryn.xyz"
              >Show HN: I built a transit travel time map</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 13:49:08</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36847960"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <p>
                The backend is written in Rust. It parses public GTFS data from
                transit agencies and performs a simple heuristics-based BFS on
                the bus lines to calculate how long to reach all points in a
                city.
              </p>
              <p>
                The frontend uses React and Mapbox GL to render each individual
                road segment based on how long it takes to reach.
              </p>
              <p>
                This project was a great excuse to learn Rust, deployments, and
                mapping. The source code is here if you are interested:
                <a href="http://github.com/econaxis/time2reach"
                  >http://github.com/econaxis/time2reach</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36847831">
          <h3>
            <a
              class="item"
              href="https://twitter.com/tubetimeus/status/1671654843138854912"
              >Reviving an IBM RS/6000 Workstation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 13:40:59</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36847831"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36847569">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36847569"
              >Launch HN: Artie (YC S23) ‚Äì Real time data replication to data
              warehouses</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 13:21:19</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36847569"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.artie.so/">https://www.artie.so/</a>). We
              solve the problem of stale production data in the data warehouse.
              We‚Äôre open source, and you can try it for free here:
              <a href="https://github.com/artie-labs/transfer"
                >https://github.com/artie-labs/transfer</a
              >.
              <p>
                Specifically, we do real time data replication from databases to
                data warehouses. We leverage change data capture (CDC) and
                stream processing to perform data transfers efficiently,
                enabling sub-minute latency and significant cost savings. Here‚Äôs
                a quick demo (jumping straight to the important part):
                <a href="https://www.youtube.com/watch?v=uAi1tm4gd9U#t=81s"
                  >https://www.youtube.com/watch?v=uAi1tm4gd9U#t=81s</a
                >.
              </p>
              <p>
                I encountered this problem when I was a heavy data warehouse
                user at prior jobs. The data in our data warehouse was super
                lagged and analytics were always stale. Imagine a fintech
                company performing anti-fraud/transaction monitoring with
                batched ETLs and finding out that fraudulent transactions
                occurred 24 hours ago. This was very frustrating to me! Since my
                background was in distributed systems and database architecture,
                I knew that there was a better way to perform data transfers.
              </p>
              <p>
                The more teams I spoke with, the more I realized this was a real
                pain point. People wanted real time data for analytics, fraud
                alerting, transaction monitoring, and training AI/ML models; but
                there wasn‚Äôt an easy out-of-the-box solution. Companies were
                either constrained on latency or schema integrity/data usability
                or data accuracy. Companies started telling me that if I built a
                tool that is robust, near real time, but also maintained schema
                integrity and data accuracy, they would very happily pay for it.
              </p>
              <p>
                So I built Artie, a real time, open-source data streaming
                solution to transfer data from databases to data warehouses and
                handle schemas automatically in-flight (DMLs and DDLs).
              </p>
              <p>
                Typical ETL solutions leverage batched processes that run on a
                schedule (DAGs, Airflow), which cannot achieve real time data
                syncs. This means that when companies aggregate production data
                into their data warehouse, the underlying data is always stale.
              </p>
              <p>
                Streaming change data capture (CDC) logs is a more efficient way
                to transfer data, and helps lower networking/data ingestion
                costs as well. However, building data pipelines with CDC
                streaming is complicated. I wanted Artie to be the tool that
                abstracts away that complexity so that any company can benefit
                from having real time data.
              </p>
              <p>
                A big challenge is implementing CDC streaming for stateful data
                (i.e. row updates/deletes) and schema changes (DDLs), which most
                streaming solutions just don‚Äôt address, meaning that complexity
                is passed down to the customer. A lot of in-house streaming
                solutions leverage some combination of Debezium + Kafka/Kinesis
                + Apache Flink and are able to achieve near real time syncs, but
                they only handle append-only events (inserts) and don't handle
                schema changes/schema evolution like DMLs and DDLs. Not handling
                thse means the data at the destination doesn't look exactly like
                the production database, which obscures the source of truth. You
                end up having to do additional work to make the data warehouse
                tables match the source DB.
              </p>
              <p>
                So how do we offer a robust CDC streaming solution? We grab CDC
                logs using Debezium and/or our custom connector (which solves
                for certain edge cases that Debezium doesn‚Äôt handle) and push
                them into Kafka (or Google Pub/Sub). Kafka helps ensure ordering
                and ease of recovery upon an outage - we use one table per
                topic, and the partition key is the primary key(s) to ensure no
                out of order writes. Artie then consumes these events from Kafka
                and we have an in-memory DB with our typing library that can
                infer schemas (DML and DDL), performs optimizations like
                deduplications, and then flushes data to the data warehouse.
                When the data warehouse confirms a successful merge, we then
                commit the offset within Kafka. This all happens with sub-minute
                data latency even at high volumes (several TBs or billions of
                rows).
              </p>
              <p>
                However the data looks in your database, it should look exactly
                the same in your data warehouse. We also strive to handle all
                data types with no exceptions - i.e. supporting TOAST columns,
                composite keys as primary keys, arrays, large rows (&gt;1MBs),
                etc. (I say ‚Äústrive‚Äù because I‚Äôm sure we haven‚Äôt seen all
                possible data types yet!).
              </p>
              <p>
                We‚Äôve been live for a while now. Several companies use us to
                update all their analytic dashboards in real time (with
                dashboards built on top of their data warehouse). Fintech
                platforms use us to perform financial transaction monitoring. A
                utilities software platform uses us to grab video/photo data to
                perform risk/hazard assessment against ML models.
              </p>
              <p>
                Artie is live and supports PostgreSQL, MySQL, MongoDB sources
                and Snowflake, BigQuery, Redshift destinations. We make money
                from our hosted service. We charge based on usage (# of rows
                transferred per month, not including initial snapshots).
              </p>
              <p>
                We‚Äôd love for you to try it out! You can get started with the
                open source version here:
                <a href="https://github.com/artie-labs/transfer"
                  >https://github.com/artie-labs/transfer</a
                >. We have a small OSS Slack community (www.artie.so/slack) ‚Äì
                feel free to ping us for help or any other requests!
              </p>
              <p>
                For our hosted version, we need to ensure that we have enough
                storage and compute capacity provisioned, so we‚Äôre asking cloud
                users to hop on a quick call with us before we activate your
                account. Eventually we‚Äôll have easy self-serve functionality but
                that‚Äôs not 100% built yet, so for now we set up a Slack channel
                to ensure smooth deployments. If you‚Äôre willing to work with us
                on that, we‚Äôll be super excited to show you what we‚Äôve got. Just
                email us at founders@artie.so or request access from
                <a href="https://www.artie.so">https://www.artie.so</a>.
              </p>
              <p>
                We‚Äôd love for you to try the OSS or hosted solution and give us
                feedback! We‚Äôre eager to improve the product and test it against
                various workloads and data types :)
              </p>
            </div>
          </section>
        </section>
        <section id="36847413">
          <h3>
            <a
              class="item"
              href="https://github.com/incuna/django-pgcrypto-fields"
              >Transparent field level encryption for Django with pgcrypto
              PostgreSQL extension</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 13:11:27</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36847413"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36847258">
          <h3>
            <a
              class="item"
              href="https://bugs.chromium.org/p/chromium/issues/detail?id=109212"
              >SVG Chromium bug is more than 10 years old</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 12:58:04</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36847258"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36847133">
          <h3>
            <a
              class="item"
              href="https://pikchr.org/home/doc/trunk/doc/userman.md"
              >Pikchr: A PIC-like markup language for diagrams in technical
              documentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 12:48:33</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36847133"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36846965">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36846965"
              >Ask HN: Which recently research paper blow your mind?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 12:34:25</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36846965"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
            <div class="text">.</div>
          </section>
        </section>
        <section id="36846597">
          <h3>
            <a class="item" href="https://www.roxlu.com/2021/070/nat-types"
              >Nat Types</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 12:08:43</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36846597"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36846567">
          <h3>
            <a
              class="item"
              href="https://www.encrypted.at/android-captive-portal/"
              >Changing the Android captive portal page (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 12:07:00</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36846567"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36846520">
          <h3>
            <a class="item" href="https://driverjs.com/"
              >Driver.js: Product tours, highlights, contextual help and more</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 12:02:50</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36846520"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36846242">
          <h3>
            <a
              class="item"
              href="https://www.vice.com/en/article/4a3n3j/backdoor-in-police-radios-tetra-burst"
              >Researchers Find ‚ÄòBackdoor‚Äô in Encrypted Police and Military
              Radios</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 11:38:56</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36846242"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36846195">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/information-technology/2023/07/the-ibm-mainframe-how-it-runs-and-why-it-survives/"
              >The IBM mainframe: How it runs and why it survives</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 11:35:35</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36846195"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36846076">
          <h3>
            <a class="item" href="https://www.compart.com/en/unicode/U+1D54F"
              >Unicode Character ‚Äúùïè‚Äù (U+1D54F)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 11:22:13</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36846076"
                  >Comments</a
                ><span class="descendants">: 207</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36845714">
          <h3>
            <a
              class="item"
              href="https://jessems.com/posts/2023-07-22-the-unreasonable-effectiveness-of-sequence-diagrams-in-mermaidjs"
              >The Unreasonable Effectiveness of Sequence Diagrams in
              MermaidJS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 10:45:26</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36845714"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36845347">
          <h3>
            <a class="item" href="https://dietpi.com/#home"
              >DietPi ‚Äì Lightweight justice for your SBC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 10:02:24</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36845347"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36845111">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2023/07/24/twitter-has-officially-changed-its-logo-to-x/"
              >Twitter has officially changed its logo to ‚ÄòX‚Äô</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 09:34:23</span
              ><span class="points-container"
                >Points: <span class="points">410</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36845111"
                  >Comments</a
                ><span class="descendants">: 989</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36842839">
          <h3>
            <a class="item" href="https://sarahkmarr.com/retrohp1973.html"
              >HP 45 (and 35 and 80) Calculator Emulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 03:35:23</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36842839"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36842239">
          <h3>
            <a
              class="item"
              href="https://math.stanford.edu/~vakil/threethings.html"
              >The ‚Äúthree things‚Äù exercise for getting things out of talks
              (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 02:06:18</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36842239"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36842182">
          <h3>
            <a
              class="item"
              href="https://adamfuhrer.com/pen-plotting-experiments"
              >Show HN: My Pen Plotting Journey</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 01:57:22</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36842182"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36841798">
          <h3>
            <a
              class="item"
              href="https://blog.aurel32.net/welcome-debian-riscv64.html"
              >Debian riscv64</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 01:06:21</span
              ><span class="points-container"
                >Points: <span class="points">293</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36841798"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36838051">
          <h3>
            <a class="item" href="https://github.com/karpathy/llama2.c"
              >Llama2.c: Inference llama 2 in one file of pure C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 18:13:54</span
              ><span class="points-container"
                >Points: <span class="points">660</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36838051"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36832736">
          <h3>
            <a
              class="item"
              href="http://web.archive.org/web/20181008215625/http://johnsankey.ca/proxomitron.html"
              >The Proxomitron: An Introduction (2004)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 05:15:18</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36832736"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36824181">
          <h3>
            <a
              class="item"
              href="https://www.buckleyschool.com/magazine/articles/poem-to-read-aloud-a-heap-o-livin/"
              >A Heap O' Livin'</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-22 @ 07:30:07</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36824181"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36821985">
          <h3>
            <a class="item" href="http://www.cs.cmu.edu/~tom7/abc/paper.pdf"
              >C89 compiler produces printable executables from C code [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-22 @ 00:42:20</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36821985"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
