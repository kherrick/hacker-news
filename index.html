<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43392521">
          <h3>
            <a class="item" href="https://opentimes.org"
              >Show HN: OpenTimes – Free travel times between U.S. Census
              geographies</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 20:40:52</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43392521"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                The primary goal here is to enable research and fill a gap I
                noticed in the open-source spatial ecosystem. Researchers
                (social scientists, economists, etc.) use large travel time
                matrices to quantify things like access to healthcare, but they
                often end up paying Google or Esri for the necessary data. By
                pre-calculating times between commonly-used research geographies
                (i.e. Census) and then making those times easily accessible via
                SQL, I hope to make large-scale accessibility research cheaper
                and simpler.
              </p>
              <p>Some technical bits that may be of interest to HN folks:</p>
              <p>
                - The entire OpenTimes backend is just static Parquet files on
                R2. There's no RDBMS or running service. The whole thing costs
                about $10/month to host and is free to serve.
              </p>
              <p>
                - All travel times were calculated by pre-building the inputs
                (OSM, OSRM networks) and then distributing the compute over
                hundreds of GitHub Actions jobs.
              </p>
              <p>
                - The query/SQL layer uses a setup I haven't seen before: a
                single DuckDB database file with views that point to static
                Parquet files via HTTP.
              </p>
              <p>
                Finally, the driving times are optimistic since they don't (yet)
                account for traffic. This is something I hope to work on in the
                near future. Enjoy!
              </p>
            </div>
          </section>
        </section>
        <section id="43392303">
          <h3>
            <a class="item" href="https://occupry.com"
              >Occupry your next lease to negotiate a better deal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 20:12:40</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43392303"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43391459">
          <h3>
            <a
              class="item"
              href="https://blog.dshr.org/2025/03/archival-storage.html"
              >Archival Storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 18:36:21</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43391459"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43390823">
          <h3>
            <a class="item" href="https://localscope.readthedocs.io/en/latest/"
              >Show HN: Localscope–Limit scope of Python functions for
              reproducible execution</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 17:33:14</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43390823"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/jax-ml/jax"
                >https://github.com/jax-ml/jax</a
              >) because it requires pure functions. Thought I'd share.
            </div>
          </section>
        </section>
        <section id="43390505">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/piramidal/jobs/neQ9JaN-research-engineer-foundational-ai"
              >Piramidal (YC W24) is hiring a ML Engineer to decode
              brainwaves</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 17:00:21</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43390400">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2503.02113"
              >Deep Learning Is Not So Mysterious or Different</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 16:47:02</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43390400"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43389064">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/chaos-in-cloudflare-lisbon-office-securing-the-internet-with-wave-motion/"
              >Chaos in the Cloudflare Lisbon Office</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 14:38:18</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43389064"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43388296">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/undergraduate-upends-a-40-year-old-data-science-conjecture/"
              >Undergraduate Disproves 40-Year-Old Conjecture, Invents New Kind
              of Hash Table</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 13:19:37</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43388296"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43387259">
          <h3>
            <a class="item" href="https://ghuntley.com/z80/"
              >Converting C to ASM to specs and then to a working Z/80 Speccy
              tape</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 11:17:09</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43387259"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43387188">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/tech-industry/cyber-security/akira-ransomware-cracked-with-rtx-4090-new-exploit-to-brute-force-encryption-attack"
              >Akira ransomware can be cracked with sixteen RTX 4090 GPUs in
              around ten hours</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 11:06:24</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43387188"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43386745">
          <h3>
            <a class="item" href="https://enkitask.com/"
              >Show HN: EnkiTask: Lightweight Project Management for
              Freelancers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 10:02:22</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43386745"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43386578">
          <h3>
            <a
              class="item"
              href="https://makerworld.com/en/models/783010-underware-2-0-infinite-cable-management"
              >Underware 2.0 – Open Source Infinite Cable Management</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 09:29:33</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43386578"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43386004">
          <h3>
            <a
              class="item"
              href="https://cp4space.hatsya.com/2020/10/28/the-exceptional-jordan-algebra/"
              >The exceptional Jordan algebra (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 07:30:26</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43386004"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43384894">
          <h3>
            <a class="item" href="https://github.com/mvt-project/mvt"
              >Conducting forensics of mobile devices to find signs of a
              potential compromise</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 03:25:26</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43384894"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43384826">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-03-genomic-capacity-language-emerged-years.html"
              >Genomic study: our capacity for language emerged at least 135k
              years ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 03:09:28</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43384826"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43384069">
          <h3>
            <a
              class="item"
              href="https://www.icann.org/en/announcements/details/icann-update-launching-rdap-sunsetting-whois-27-01-2025-en"
              >Launching RDAP; sunsetting WHOIS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 00:48:48</span
              ><span class="points-container"
                >Points: <span class="points">815</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43384069"
                  >Comments</a
                ><span class="descendants">: 320</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43381512">
          <h3>
            <a
              class="item"
              href="https://trifectatech.org/blog/zlib-rs-is-faster-than-c/"
              >Zlib-rs is faster than C</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-16 @ 19:35:07</span
              ><span class="points-container"
                >Points: <span class="points">326</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43381512"
                  >Comments</a
                ><span class="descendants">: 437</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43380453">
          <h3>
            <a
              class="item"
              href="https://dfarq.homeip.net/when-the-dotcom-bubble-burst/"
              >When the Dotcom Bubble Burst</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-16 @ 17:02:34</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43380453"
                  >Comments</a
                ><span class="descendants">: 320</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43378627">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2025/03/towards-extracting-content-from-an-lcp-protected-epub/"
              >Extracting content from an LCP "protected" ePub</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-16 @ 12:50:56</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43378627"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43378239">
          <h3>
            <a class="item" href="https://github.com/suitenumerique/docs"
              >Docs – Open source alternative to Notion or Outline</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-16 @ 11:38:52</span
              ><span class="points-container"
                >Points: <span class="points">1776</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43378239"
                  >Comments</a
                ><span class="descendants">: 433</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43377463">
          <h3>
            <a class="item" href="https://jcgt.org/published/0014/01/04/"
              >Compression of Spectral Images Using Spectral JPEG XL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-16 @ 07:37:20</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43377463"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43369739">
          <h3>
            <a
              class="item"
              href="https://www.lrb.co.uk/the-paper/v47/n05/colin-burrow/ogres-are-cool"
              >Ogres Are Cool</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-15 @ 03:28:39</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43369739"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43366671">
          <h3>
            <a class="item" href="https://hackers.town/@zwol/114155595855705796"
              >Recommendations for designing magic numbers of binary file
              formats</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 20:05:53</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43366671"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43360633">
          <h3>
            <a class="item" href="https://github.com/formal-land/coq-of-rust"
              >Coq-of-rust: Formal verification tool for Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 08:34:18</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43360633"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43360251">
          <h3>
            <a
              class="item"
              href="https://httptoolkit.com/blog/http3-quic-open-source-support-nowhere/"
              >HTTP/3 is everywhere but nowhere</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 07:02:39</span
              ><span class="points-container"
                >Points: <span class="points">265</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43360251"
                  >Comments</a
                ><span class="descendants">: 256</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43360150">
          <h3>
            <a class="item" href="https://www.datagubbe.se/scenecop/"
              >Copyright and the Demo Scene</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 06:38:53</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43360150"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43359343">
          <h3>
            <a
              class="item"
              href="https://homepages.inf.ed.ac.uk/rbf/BOOKS/PHILLIPS/cips2ed.pdf"
              >Image Processing in C (2000) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 03:30:33</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43359343"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43359264">
          <h3>
            <a
              class="item"
              href="https://slamdunksoftware.substack.com/p/hidden-messages-in-emojis-and-hacking"
              >Hidden Messages in Emojis and Hacking the US Treasury</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 03:13:26</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43359264"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43358264">
          <h3>
            <a
              class="item"
              href="https://collidingscopes.github.io/liquid-shape-distortions/"
              >Show HN: Psychedelic animation generator; (p)art of your next
              trip</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 23:26:56</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43358264"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <p>
                This project was inspired by drum &amp; bass / acid techno
                music, and 90s rave posters.
              </p>
              <p>
                Use this to create art for a music video, concert posters,
                stylized animations in creative projects, or simply to enjoy
                alongside some fine music.
              </p>
              <p>
                Use the detailed control menu (top-right) to set a custom canvas
                size, adjust animation speed, control pattern and colours,
                etc...
              </p>
              <p>
                You can export your creation as an image or video afterwards.
              </p>
              <p>
                How this works: this tool uses WebGL shaders to create a
                real-time animation (with a trippy liquid / shadow / blur
                aesthetic).
              </p>
              <p>
                The animation is created using a random seed position and mixes
                in random noise (fractal brownian motion, 3D simplex noise), so
                each time you re-run it you're creating a unique piece of art.
              </p>
              <p>
                Github repo:
                <a
                  href="https://github.com/collidingScopes/liquid-shape-distortions"
                  >https://github.com/collidingScopes/liquid-shape-distortions</a
                >
              </p>
              <p>-----</p>
              <p>
                I hope you enjoy the visuals. I'd love to hear any feedback or
                suggestions.
              </p>
            </div>
          </section>
        </section>
        <section id="43353223">
          <h3>
            <a
              class="item"
              href="https://blog.gitbutler.com/going-down-the-rabbit-hole-of-gits-new-bundle-uri/"
              >Going down the rabbit hole of Git's new bundle-URI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 13:38:26</span
              ><span class="points-container"
                >Points: <span class="points">276</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43353223"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
