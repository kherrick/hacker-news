<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39179031">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/sonar-image-pilot-amelia-earhart-plane-found-pacific-ocean-2024"
              >An Air Force officer who spent $11M searching Earhart's plane may
              have found it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 17:20:34</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39179031"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39179013">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/technology-68128177"
              >Apple says UK could 'veto' global privacy tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 17:19:33</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39179013"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39179010">
          <h3>
            <a
              class="item"
              href="https://themarkup.org/gentle-january/2024/01/29/lie-about-your-birthday"
              >Lie About Your Birthday</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 17:19:18</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39179010"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39178886">
          <h3>
            <a
              class="item"
              href="https://twitter.com/AIatMeta/status/1752013879532782075"
              >Meta AI releases Code Llama 70B</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 17:11:34</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39178886"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39178847">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2024/jan/29/amazon-deal-irobot-eu-veto-roomba"
              >Amazon drops $1.4B deal to buy iRobot after EU veto reports</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 17:09:20</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39178847"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39178370">
          <h3>
            <a
              class="item"
              href="https://fortune.com/europe/2024/01/29/harvard-medical-school-affiliate-retracts-corrects-research-dana-farber-welsh-blogger/"
              >Harvard Medical affiliate retracts, corrects research after
              sleuthing by blogger</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 16:38:08</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39178370"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39178147">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=XuTQbOo3Y30"
              >Vape-o-nomics: Why Everything is Addictive Now [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 16:23:25</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39178147"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39178122">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/viewing-illegal-streams-no-cautions-fines-or-arrests-say-gm-police-240129/"
              >Viewing Illegal Streams: No Cautions, Fines or Arrests Say GM
              Police</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 16:22:18</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39178122"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39177467">
          <h3>
            <a class="item" href="https://phrasing.app/playground"
              >Show HN: Phrasing â€“ learn every language, to any level</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 15:38:02</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39177467"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today I'm sharing a demo of my our language learning tool,
                Phrasing. It's a tool born from the language acquisition
                hypothesis, too many hours in an anki slog, and a strange desire
                to always be learning obscure languages.
              </p>
              <p>The method is simple:</p>
              <p>1. type in a show</p>
              <p>2. learn the most important words</p>
              <p>3. watch the show/acquire the words</p>
              <p>4. review the words when needed in the future.</p>
              <p>On top of that, we're trying to:</p>
              <p>
                - do some novel things with spaced repetition (no more anki
                slog)
              </p>
              <p>
                - expand the sort of content you can learn from (I want to to
                refresh my French by reading The Stormlight Archive)
              </p>
              <p>
                - make an insanely beautiful tool for all languages (I want to
                learn Sanskrit and Hawaiian and such)
              </p>
              <p>
                I think we're off to a great start so far, and I'm happy to be
                able to share what we have already! We've taken some of our core
                features, and ripped them out to put them on a playground for HN
                to explore. There's so much more to come though, this is just
                the beginning.
              </p>
              <p>
                I'll be here all day to answer any questions. Thanks for
                checking it out and have a wonderful day &lt;3
              </p>
              <p>
                EDIT: This link was meant as a demo so hacker news has something
                to click around on (as per the rules of Show HN). The main
                marketing page can be found at
                <a href="https://phrasing.app/">https://phrasing.app/</a> - I
                think that's causing some confusion
              </p>
            </div>
          </section>
        </section>
        <section id="39177452">
          <h3>
            <a
              class="item"
              href="https://www.kiphakes.com/2024/01/how-we-had-our-nectar-points-stolen-and-this-is-how-yours-will-be-too/"
              >How we had our Nectar Points stolen, and this is how yours will
              be too</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 15:37:04</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39177452"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39177206">
          <h3>
            <a
              class="item"
              href="https://www.derekau.net/blog/2019/07/10/paintings-of-the-traditional-porcelain-process"
              >Paintings of the Traditional Porcelain Process</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 15:17:54</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39177206"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39176899">
          <h3>
            <a
              class="item"
              href="https://stratechery.com/2024/the-apple-vision-pros-missing-apps/"
              >The Apple Vision Proâ€™s missing apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 14:53:51</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39176899"
                  >Comments</a
                ><span class="descendants">: 290</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39176797">
          <h3>
            <a
              class="item"
              href="https://xuanwo.io/2024/02-what-i-talk-about-when-i-talk-about-query-optimizer-part-1/"
              >What I Talk About When I Talk About Query Optimizer (Part 1): IR
              Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 14:45:08</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39176797"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39176570">
          <h3>
            <a class="item" href="https://github.com/collabora/WhisperFusion"
              >Show HN: WhisperFusion â€“ Ultra-low latency conversations with an
              AI chatbot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 14:23:10</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39176570"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
            <div class="text">
              WhisperFusion builds upon the capabilities of open source tools
              WhisperLive and WhisperSpeech to provide a seamless conversations
              with an AI chatbot.
            </div>
          </section>
        </section>
        <section id="39175873">
          <h3>
            <a class="item" href="https://everything.curl.dev/libcurl/libcurl"
              >â€”-libcurl</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 13:19:20</span
              ><span class="points-container"
                >Points: <span class="points">489</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39175873"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39175670">
          <h3>
            <a
              class="item"
              href="https://loichovon.com/posts/streetview-scraper.html"
              >Streetview scraper v1: cheap, arbitrary sized streetview
              images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 12:52:47</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39175670"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39175393">
          <h3>
            <a class="item" href="https://svelte-native.technology/"
              >Svelte Native: The Svelte Mobile Development Experience</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 12:13:58</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39175393"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39174549">
          <h3>
            <a class="item" href="https://teropa.info/harmonics-explorer/"
              >Harmonics Explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 09:51:22</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39174549"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39173775">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/world-asia-68125589"
              >Japan: Moon lander Slim comes back to life and resumes mission</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 07:43:56</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39173775"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39173455">
          <h3>
            <a
              class="item"
              href="https://nosferalatu.com/HigherOrderDerivativesTransforms.html"
              >Higher Order Derivatives of Transforms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 06:44:10</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39173455"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39172859">
          <h3>
            <a
              class="item"
              href="https://www.damtp.cam.ac.uk/user/tong/em/dyson.pdf"
              >Why is Maxwell's theory so hard to understand? (2007) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 05:00:39</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39172859"
                  >Comments</a
                ><span class="descendants">: 182</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39172858">
          <h3>
            <a
              class="item"
              href="https://asteriskmag.com/issues/05/why-you-ve-never-been-in-a-plane-crash"
              >Why you've never been in a plane crash</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 05:00:25</span
              ><span class="points-container"
                >Points: <span class="points">236</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39172858"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39172732">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/01/29/the-twins-obsession"
              >The Twins Obsession</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 04:37:51</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39172732"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39172377">
          <h3>
            <a
              class="item"
              href="https://blog.gtk.org/2024/01/28/new-renderers-for-gtk/"
              >New Renderers for GTK</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 03:24:10</span
              ><span class="points-container"
                >Points: <span class="points">306</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39172377"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39172029">
          <h3>
            <a
              class="item"
              href="https://thewalrus.ca/around-the-world-in-eighty-lies/"
              >A writer fabricated a series of stories for Atlas Obscura</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 02:18:51</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39172029"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39169318">
          <h3>
            <a class="item" href="https://www.flamewarriorsguide.com/"
              >A Guide to Flamewarriors</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 20:06:52</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39169318"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39168986">
          <h3>
            <a
              class="item"
              href="https://www.vitling.xyz/i-need-to-grow-away-from-these-roots/"
              >I need to grow away from these roots</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 19:29:23</span
              ><span class="points-container"
                >Points: <span class="points">368</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39168986"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39165328">
          <h3>
            <a
              class="item"
              href="https://jarbus.net/blog/take-the-road-most-documented/"
              >Take the Road Most Documented</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 13:07:50</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39165328"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39163556">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20100524023205/http://playstation2-linux.com:80/"
              >Linux for Playstation 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 08:26:52</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39163556"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39163284">
          <h3>
            <a class="item" href="https://anime.mit.edu/resources/mit_in_anime"
              >Appearances of MIT in Anime</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 07:24:00</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39163284"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
