<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43930156">
          <h3>
            <a
              class="item"
              href="https://parisianfields.com/2017/11/05/the-rise-and-fall-of-the-visual-telegraph/"
              >The Rise and Fall of the Visual Telegraph (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 19:13:29</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43930156"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43929724">
          <h3>
            <a
              class="item"
              href="https://blog.hayman.net/2025/05/06/from-steve-jobs-great-idea.html"
              >From: Steve Jobs. "Great idea, thank you."</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 18:40:12</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43929724"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43929447">
          <h3>
            <a class="item" href="https://m-arriola.com/bd3lms/"
              >Block Diffusion: Interpolating Autoregressive and Diffusion
              Language Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 18:18:20</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43929447"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43929054">
          <h3>
            <a class="item" href="https://overreacted.io/static-as-a-server/"
              >Static as a Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 17:49:02</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43929054"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43929040">
          <h3>
            <a class="item" href="https://brokk.ai"
              >Brokk: AI for Large Codebases</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 17:48:12</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43929040"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43928315">
          <h3>
            <a class="item" href="https://samwho.dev/reservoir-sampling/"
              >Reservoir Sampling</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 17:02:10</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43928315"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43928294">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/ciro/jobs"
              >Ciro (YC S22) is hiring a software engineer to build AI agents
              for sales</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 17:00:38</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43928118">
          <h3>
            <a class="item" href="https://github.com/qpoint-io/qtap"
              >Show HN: Using eBPF to see through encryption without a proxy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 16:49:11</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43928118"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
            <div class="text">
              <p>
                For a while now, my team and I at Qpoint.io have been grappling
                with the challenge of understanding what's actually happening
                inside the encrypted traffic leaving our production systems.
                Modern apps rely heavily on third-party APIs (think payment
                processors, data providers, etc.), but once TLS kicks in,
                figuring out exactly what data is being sent, identifying PII
                exposure, or debugging integration issues becomes incredibly
                difficult without resorting to complex and often brittle
                solutions.
              </p>
              <p>
                Traditional approaches like forward proxies require terminating
                TLS (MITM), managing certificates, and often introduce
                performance bottlenecks or single points of failure. Network
                firewalls usually operate at L3/L4 and lack payload visibility.
                We felt there had to be a better way.
              </p>
              <p>
                That's why we built qtap. It's a lightweight agent that uses
                eBPF to tap into network traffic at the kernel level. The key
                idea is to hook into common TLS libraries (like OpenSSL) before
                encryption and after decryption. This gives us deep visibility
                into the actual request/response payloads of HTTPS/TLS traffic
                without needing to terminate the connection or manage certs.
                Because it leverages eBPF, the performance impact is minimal
                compared to traditional methods.
              </p>
              <p>
                With qtap, we can now see exactly which external services our
                apps are talking to, inspect the payloads for debugging or
                security auditing (e.g., spotting accidental PII leaks), monitor
                API performance/errors for third-party dependencies, and get a
                much clearer picture of our egress traffic patterns.
              </p>
              <p>
                We've found this approach really powerful for improving
                reliability and security posture. We've packaged qtap as a Linux
                Binary, Docker container, and Helm chart for deployment.
              </p>
              <p>
                This is still evolving, but we're excited about the potential of
                using eBPF for this kind of deep, yet non-intrusive, visibility.
              </p>
              <p>We'd love to get the HN community's feedback:</p>
              <p></p>
              <pre><code>    Do you face similar challenges monitoring encrypted egress traffic?
    What are your thoughts on using eBPF for this compared to other methods?
    Any suggestions or potential use cases we haven't considered?
</code></pre>
              Happy to answer any questions!
            </div>
          </section>
        </section>
        <section id="43927948">
          <h3>
            <a
              class="item"
              href="https://www.gq.com/story/why-is-everyone-getting-their-tattoos-removed"
              >More people are getting tattoos removed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 16:37:25</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43927948"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43927926">
          <h3>
            <a class="item" href="https://github.com/voideditor/void"
              >Void: Open-source Cursor alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 16:35:34</span
              ><span class="points-container"
                >Points: <span class="points">280</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43927926"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
            <div class="text">
              <a href="https://voideditor.com/download-beta"
                >https://voideditor.com/download-beta</a
              >
            </div>
          </section>
        </section>
        <section id="43927914">
          <h3>
            <a
              class="item"
              href="https://ghiculescu.substack.com/p/nobody-codes-here-anymore"
              >Notes on rolling out Cursor and Claude Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 16:34:39</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43927914"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43927856">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/world/live-news/new-pope-conclave-day-two-05-08-25"
              >First American pope elected and will be known as Pope Leo XIV</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 16:30:45</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43927856"
                  >Comments</a
                ><span class="descendants">: 421</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43927842">
          <h3>
            <a
              class="item"
              href="https://hypermode.com/blog/introducing-model-router"
              >Hypermode Model Router Preview – OpenRouter Alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 16:29:39</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43927842"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43927649">
          <h3>
            <a
              class="item"
              href="https://github.com/donobu-inc/donobu-papal-election-tests/blob/main/tests/papal_election_smoke.test.ts"
              >Show HN: Checking Pope's election results with smoke test script
              for chimney</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 16:13:44</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43927649"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                Currently, set to use Google Gemini Flash 2.0, but you can
                switch it to use other LLM providers/models by setting the
                environment variable in the Github actions workflow:
                <a
                  href="https://github.com/donobu-inc/donobu-papal-election-tests/blob/main/.github/workflows/tests.yaml"
                  >https://github.com/donobu-inc/donobu-papal-election-tests/bl...</a
                >
              </p>
              <p>
                I've set it to run every minute during the Papal Conclave
                election times -
                <a
                  href="https://github.com/donobu-inc/donobu-papal-election-tests/actions"
                  >https://github.com/donobu-inc/donobu-papal-election-tests/ac...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43927374">
          <h3>
            <a
              class="item"
              href="https://newsletter.techworld-with-milan.com/p/how-google-measures-and-manages-tech"
              >Google Measures and Manages Tech Debt</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 15:51:55</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43927374"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43927337">
          <h3>
            <a
              class="item"
              href="https://www.fusionenergybase.com/articles/continuing-progress-toward-fusion-energy-breakeven-and-gain-as-measured-against-the-lawson-criteria"
              >Progress toward fusion energy gain as measured against the Lawson
              criteria</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 15:49:37</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43927337"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43926165">
          <h3>
            <a
              class="item"
              href="https://www.gatesnotes.com/home/home-page-topic/reader/n20-years-to-give-away-virtually-all-my-wealth"
              >My new deadline: 20 years to give away virtually all my wealth</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 13:59:49</span
              ><span class="points-container"
                >Points: <span class="points">404</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43926165"
                  >Comments</a
                ><span class="descendants">: 430</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43925982">
          <h3>
            <a
              class="item"
              href="https://www.esgtoday.com/google-to-back-three-new-advanced-nuclear-projects/"
              >Google to back three new nuclear projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 13:36:09</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43925982"
                  >Comments</a
                ><span class="descendants">: 246</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43925732">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43925732"
              >Ask HN: What are good high-information density UIs (screenshots,
              apps, sites)?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 13:05:10</span
              ><span class="points-container"
                >Points: <span class="points">292</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43925732"
                  >Comments</a
                ><span class="descendants">: 237</span></span
              >
            </h4>
            <div class="text">
              <p>
                Search engines are full to the brim with vague articles
                repeating each other's talking points, and exception being this
                blog post by Matthew Ström:
                <a href="https://matthewstrom.com/writing/ui-density/"
                  >https://matthewstrom.com/writing/ui-density/</a
                >
              </p>
              <p>Image search is no better, with largely irrelevant results.</p>
              <p>
                In the age when everything is spaced out and zoned out gray on
                gray, what are your go-to examples of UIs that pack a lot of
                info?
              </p>
            </div>
          </section>
        </section>
        <section id="43925325">
          <h3>
            <a
              class="item"
              href="https://www.owlposting.com/p/will-protein-design-tools-solve-the"
              >Will protein design tools solve the snake antivenom shortage?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 12:05:26</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43925325"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43924358">
          <h3>
            <a
              class="item"
              href="https://radioandnukes.substack.com/p/how-dare-you-transmit-at-14-ghz"
              >Using NASA’s SMAP satellite to detect L-band interference</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 08:52:56</span
              ><span class="points-container"
                >Points: <span class="points">278</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43924358"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43923372">
          <h3>
            <a class="item" href="https://mycoria.org/"
              >Mycoria is an open and secure overlay network that connects all
              participants</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-08 @ 05:40:52</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43923372"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43909519">
          <h3>
            <a
              class="item"
              href="https://www.newscientist.com/article/2438107-mind-reading-ai-recreates-what-youre-looking-at-with-amazing-accuracy/"
              >AI focused on brain regions recreates what you're looking at
              (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-06 @ 20:52:45</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43909519"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43908261">
          <h3>
            <a
              class="item"
              href="https://practical.engineering/blog/2025/5/6/when-abandoned-mines-collapse"
              >When Abandoned Mines Collapse</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-06 @ 18:38:14</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43908261"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43906066">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-05-mass-spectrometry-method-pathogens-minutes.html"
              >Mass spectrometry method identifies pathogens within minutes
              instead of days</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-06 @ 15:13:37</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43906066"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43903809">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/sciadv.ads5659"
              >Shape and topology morphing of closed surfaces integrating
              origami and kirigami</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-06 @ 11:16:32</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43903809"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43901190">
          <h3>
            <a
              class="item"
              href="https://www.wiz.io/blog/github-actions-security-guide"
              >How to harden GitHub Actions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-06 @ 02:07:42</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43901190"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43895890">
          <h3>
            <a
              class="item"
              href="https://briefer.cloud/blog/posts/least-squares/"
              >How linear regression works intuitively and how it leads to
              gradient descent</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-05 @ 15:05:33</span
              ><span class="points-container"
                >Points: <span class="points">301</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43895890"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43892786">
          <h3>
            <a
              class="item"
              href="https://www.electrospaces.net/2013/04/how-obamas-blackberry-got-secured.html"
              >How Obama’s BlackBerry got secured (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-05 @ 07:54:44</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43892786"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43892446">
          <h3>
            <a
              class="item"
              href="https://coalton-lang.github.io/20220906-quantum-compiler/"
              >Using Coalton to implement a quantum compiler (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-05 @ 06:31:38</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43892446"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
