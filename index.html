<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37868792">
          <h3>
            <a
              class="item"
              href="https://www.dw.com/en/new-brain-atlases-will-unlock-mysteries-of-the-human-mind/a-67078463"
              >New brain atlases will unlock mysteries of the human mind</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 09:56:31</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37868792"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37868705">
          <h3>
            <a
              class="item"
              href="https://www.justbeepit.com/post/saas-startup-founders-what-advice-would-you-give-your-younger-selves-here-s-what-they-said"
              >The Advice SaaS Startup Founders Would Give Their Younger
              Selves</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 09:44:25</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37868705"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37868591">
          <h3>
            <a class="item" href="https://blog.orsinium.dev/posts/misc/docs/"
              >Remove Half of Your Documentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 09:27:36</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37868591"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37868493">
          <h3>
            <a class="item" href="https://mprove.de/script/99/kai/"
              >The Interface of Kai Krause's Software</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 09:10:51</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37868493"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37868429">
          <h3>
            <a
              class="item"
              href="https://www.schneier.com/blog/archives/2023/10/cisco-cant-stop-using-hard-coded-passwords.html"
              >Cisco Can't Stop Using Hard-Coded Passwords</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 09:01:07</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37868429"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37868388">
          <h3>
            <a
              class="item"
              href="https://developer.mozilla.org/en-US/docs/Web/Performance/How_browsers_work"
              >Populating the page: how browsers work</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 08:55:42</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37868388"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37868106">
          <h3>
            <a
              class="item"
              href="https://gpsjam.org/?lat=45.00000&amp;lon=35.00000&amp;z=3.0&amp;date=2023-10-10"
              >GPSJam: Daily maps of possible GPS interference</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 08:12:42</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37868106"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37867856">
          <h3>
            <a
              class="item"
              href="https://tratt.net/laurie/blog/2023/two_stories_for_what_is_cheri.html"
              >Two Stories for "What Is CHERI?"</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 07:36:27</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37867856"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37867609">
          <h3>
            <a
              class="item"
              href="https://ourworldindata.org/communications-outreach-manager-q4-2023"
              >Our World in Data (YC W19) Is Hiring a Comms Manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 07:01:13</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37867144">
          <h3>
            <a class="item" href="https://mud.co.uk/richard/htflpism.htm"
              >How to fit a large program into a small machine (1999)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 05:47:40</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37867144"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37866999">
          <h3>
            <a class="item" href="http://thumbcalendar.com/"
              >The Thumb Calendar</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 05:21:38</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37866999"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37866421">
          <h3>
            <a
              class="item"
              href="https://www.newscientist.com/article/2396510-mathematician-warns-us-spies-may-be-weakening-next-gen-encryption/"
              >Mathematician warns US spies may be weakening next-gen
              encryption</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 03:51:32</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37866421"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37865941">
          <h3>
            <a
              class="item"
              href="https://www.tokyodev.com/articles/not-setting-up-find-my-bricked-my-macbook"
              >Not setting up Find My bricked my MacBook</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 02:43:13</span
              ><span class="points-container"
                >Points: <span class="points">297</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37865941"
                  >Comments</a
                ><span class="descendants">: 399</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37865933">
          <h3>
            <a
              class="item"
              href="https://www.laphamsquarterly.org/roundtable/go-devils-name"
              >Go in the Devil's Name: When Isobel Gowdie Confessed to Being a
              Witch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 02:42:08</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37865933"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37865816">
          <h3>
            <a
              class="item"
              href="https://www.thebignewsletter.com/p/the-price-fixing-economy"
              >The Price-Fixing Economy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 02:24:38</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37865816"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37865812">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=5CMv5V-wxT8"
              >The Rise and Reign of Japanese VCRs [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 02:24:09</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37865812"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37864883">
          <h3>
            <a
              class="item"
              href="https://zach.codes/p/a-developers-review-framework-13"
              >Framework 13 AMD 7040 Series: A Developer's First Impressions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 00:19:43</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37864883"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37864867">
          <h3>
            <a class="item" href="https://artemis.sh/2023/10/12/scrollbars.html"
              >Scrollbars are becoming a problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-13 @ 00:17:23</span
              ><span class="points-container"
                >Points: <span class="points">492</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37864867"
                  >Comments</a
                ><span class="descendants">: 459</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37864244">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/echoes-of-electromagnetism-found-in-number-theory-20231012/"
              >Echoes of Electromagnetism Found in Number Theory</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-12 @ 22:57:47</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37864244"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37864096">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=xvyYPVkkztQ"
              >Step-by-Step Restoration of a Rare 1995 IBM ThinkPad [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-12 @ 22:43:02</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37864096"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37863784">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-10-quantum-dots-tiny-rainbow-crystals.html"
              >Quantum dots: the tiny 'rainbow' crystals behind chemistry
              Nobel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-12 @ 22:04:57</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37863784"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37863745">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20120630140041/https://www.juliangough.com/the-great-hargeisa-goat-bubble/"
              >The Great Hargeisa Goat Bubble</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-12 @ 22:01:31</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37863745"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37863616">
          <h3>
            <a
              class="item"
              href="https://danmeyer.substack.com/p/the-misunderstanding-about-education"
              >Personalized learning can feel isolating. Whole class learning
              can feel personal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-12 @ 21:48:32</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37863616"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37862606">
          <h3>
            <a
              class="item"
              href="https://ruoyusun.com/2023/10/12/one-game-six-platforms.html"
              >One game, by one man, on six platforms: The good, the bad and the
              ugly</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-12 @ 20:14:46</span
              ><span class="points-container"
                >Points: <span class="points">274</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37862606"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37859261">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/depth-of-field"
              >Impossible photo feat now possible via holography</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-12 @ 16:18:02</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37859261"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37859085">
          <h3>
            <a class="item" href="https://www.desmos.com/3d"
              >Desmos 3D graphing calculator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-12 @ 16:05:23</span
              ><span class="points-container"
                >Points: <span class="points">394</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37859085"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37857765">
          <h3>
            <a class="item" href="https://www.diceright.com/"
              >Show HN: I built a virtual tabletop for playing Dungeons and
              Dragons</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-12 @ 14:35:56</span
              ><span class="points-container"
                >Points: <span class="points">347</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37857765"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
            <div class="text">
              <a href="https://tinyurl.com/diceright"
                >https://tinyurl.com/diceright</a
              >. And there’s a list of the main features right on the homepage.
              <p>
                It’s a Ruby on Rails site that makes heavy use of action cable
                for keeping the maps and tokens in sync for all players. On the
                front end, I’m using HTML canvas for the maps and a js library
                called fabric.js for interacting with the canvas. Otherwise,
                just jQuery on the front end. I optimized it all to work on
                mobile too.
              </p>
              <p>
                I built this as a side project for fun over of the past couple
                years. It took a lot longer than expected, but it was also a lot
                of fun. I did all the design / UX for it too which was a
                struggle at first but was a great learning experience.
              </p>
              <p>
                Let me know what you think and if you have any questions.
                Thanks!
              </p>
            </div>
          </section>
        </section>
        <section id="37857417">
          <h3>
            <a class="item" href="https://scrollprize.org/firstletters"
              >First word discovered in unopened Herculaneum scroll by CS
              student</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-12 @ 14:11:18</span
              ><span class="points-container"
                >Points: <span class="points">770</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37857417"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37854846">
          <h3>
            <a class="item" href="https://openintro-ims2.netlify.app/"
              >Introduction to Modern Statistics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-12 @ 08:45:10</span
              ><span class="points-container"
                >Points: <span class="points">653</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37854846"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37839417">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-10-pre-columbian-agave-persisting-arizona-landscapes.html"
              >Researchers find pre-Columbian agave plants persisting in Arizona
              landscapes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-11 @ 00:10:34</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37839417"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
