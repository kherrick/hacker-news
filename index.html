<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44703613">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/tom-lehrer-son-satirist-mathematician-dies-9caa7ee01faf4fbfb793d7ba984c179d"
              >Tom Lehrer, song satirist and mathematician, dies at 97</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 18:55:25</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44703613"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44703416">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/07/27/itch-io-is-the-latest-marketplace-to-crack-down-on-adult-games/"
              >Itch.io is the latest marketplace to crack down on adult games</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 18:32:53</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44703416"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44703164">
          <h3>
            <a
              class="item"
              href="https://github.com/segmentationf4u1t/trae_telemetry_research"
              >Disabling telemetry in ByteDance's VSCode fork increases data
              sent to its server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 17:57:06</span
              ><span class="points-container"
                >Points: <span class="points">371</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44703164"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
            <div class="text">
              <p>Here are the key findings:</p>
              <p>
                1. Extreme Resource Consumption: Out of the box, Trae used 6.3x
                more RAM (~5.7 GB) and spawned 3.7x more processes (33 total)
                than a standard VSCode setup with the same project open. The
                team has since made improvements, but it's still significantly
                heavier.
              </p>
              <p>
                2. Telemetry Opt-Out Doesn't Work (It Makes It Worse): I found
                Trae was constantly sending data to ByteDance servers
                (byteoversea.com). I went into the settings and disabled all
                telemetry. To my surprise, this didn't stop the traffic. In
                fact, it increased the frequency of batch data collection. The
                telemetry "off" switch appears to be purely cosmetic.
              </p>
              <p>
                3. What's Being Sent: Even with telemetry "disabled," Trae sends
                detailed payloads including: Hardware specs (CPU, memory, etc.)
                Persistent user, device, and machine IDs OS version, app
                language, user name Granular usage data like time-on-ide, window
                focus state, and active file types.
              </p>
              <p>
                4. Community Censorship: When I tried to discuss these findings
                on their official Discord, my posts were deleted and my account
                was muted for 7 days. It seems words like "track" trigger an
                automated gag rule, which prevents any real discussion about
                privacy.
              </p>
              <p>
                I believe developers should be aware of this behavior. The
                combination of resource drain, non-functional privacy settings,
                and censorship of technical feedback is a major red flag. The
                full, detailed analysis with all the evidence (process lists,
                Fiddler captures, JSON payloads, and screenshots of the Discord
                moderation) is available at the link. Happy to answer any
                questions.
              </p>
            </div>
          </section>
        </section>
        <section id="44703079">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/07/26/allianz-life-says-majority-of-customers-personal-data-stolen-in-cyberattack/"
              >Allianz Life says 'majority' of customers' personal data stolen
              in cyberattack</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 17:49:23</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44703079"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44702894">
          <h3>
            <a class="item" href="https://khang-nd.github.io/7.css/"
              >Show HN: Windows 7 GUI for the Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 17:27:26</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44702894"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44702833">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44702833"
              >Ask HN: What are you working on? (July 2025)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 17:19:19</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44702833"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
            <div class="text">
              What are you working on? Do you have any new ideas you're thinking
              about?
            </div>
          </section>
        </section>
        <section id="44702782">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/07/27/arts/music/tom-lehrer-dead.html"
              >Tom Lehrer, Musical Satirist with a Dark Streak, Dies at 97</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 17:13:25</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44702782"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.ph/gY3Xa">https://archive.ph/gY3Xa</a>
              <p>
                Also:
                <a
                  href="https://apnews.com/article/tom-lehrer-son-satirist-mathematician-dies-9caa7ee01faf4fbfb793d7ba984c179d"
                  >https://apnews.com/article/tom-lehrer-son-satirist-mathemati...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44702627">
          <h3>
            <a
              class="item"
              href="https://phase.dev/blog/instrumenting-nextjs-with-runtime-secret-injection/"
              >Instrumenting Next.js with runtime secret injection</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 16:53:00</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44702627"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44701574">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/whatever_jamie/archive/the-many-many-many-javascript-runtimes-of-the-last-decade/"
              >The many JavaScript runtimes of the last decade</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 14:28:49</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44701574"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44701555">
          <h3>
            <a class="item" href="https://www.dumbpipe.dev/">Dumb Pipe</a>
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 14:25:47</span
              ><span class="points-container"
                >Points: <span class="points">408</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44701555"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44700923">
          <h3>
            <a
              class="item"
              href="https://news.exeter.ac.uk/faculty-of-health-and-life-sciences/beetroot-juice-lowers-blood-pressure-in-older-people-by-changing-oral-microbiome/"
              >Beetroot juice lowers blood pressure by changing oral microbiome:
              study</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 12:44:31</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44700923"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44699980">
          <h3>
            <a
              class="item"
              href="https://jyn.dev/constrained-languages-are-easier-to-optimize/"
              >Constrained languages are easier to optimize</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 09:21:13</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44699980"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44699452">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2506.21734"
              >Hierarchical Reasoning Model</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 07:15:57</span
              ><span class="points-container"
                >Points: <span class="points">249</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44699452"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44699421">
          <h3>
            <a
              class="item"
              href="https://bikepacking.com/plog/when-we-get-komooted/"
              >When we get Komooted</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 07:07:09</span
              ><span class="points-container"
                >Points: <span class="points">399</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44699421"
                  >Comments</a
                ><span class="descendants">: 215</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44699393">
          <h3>
            <a
              class="item"
              href="https://www.linaro.org/blog/linux-on-snapdragon-x-elite/"
              >Linux on Snapdragon X Elite: Linaro and Tuxedo Pave the Way for
              ARM64 Laptops</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 07:01:02</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44699393"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44699052">
          <h3>
            <a
              class="item"
              href="https://www.kcrw.com/news/shows/npr/npr-story/nx-s1-5481304"
              >4k NASA employees opt to leave agency through deferred
              resignation program</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 05:17:03</span
              ><span class="points-container"
                >Points: <span class="points">312</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44699052"
                  >Comments</a
                ><span class="descendants">: 383</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44698928">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/nmc-battery-aspiring-materials"
              >Chemical process produces critical battery metals with no
              waste</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 04:35:33</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44698928"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44698899">
          <h3>
            <a
              class="item"
              href="https://www.robertmao.com/blog/en/the-future-is-not-self-hosted-but-self-sovereign"
              >The future is not self-hosted, but self-sovereign</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 04:26:08</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44698899"
                  >Comments</a
                ><span class="descendants">: 151</span></span
              >
            </h4>
            <div class="text">
              <i>The future is not self-hosted</i> -
              <a href="https://news.ycombinator.com/item?id=44682175"
                >https://news.ycombinator.com/item?id=44682175</a
              >
              (424 comments)
            </div>
          </section>
        </section>
        <section id="44698754">
          <h3>
            <a
              class="item"
              href="https://quantum5.ca/2025/05/11/fast-cheap-bulk-storage-using-lvm-to-cache-hdds-on-ssds/"
              >Fast and cheap bulk storage: using LVM to cache HDDs on SSDs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 03:38:27</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44698754"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44698733">
          <h3>
            <a
              class="item"
              href="https://www.bosch-sensortec.com/news/worlds-smallest-particulate-matter-sensor-bmv080.html"
              >Smallest particulate matter air quality sensor for ultra-compact
              IoT devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 03:34:47</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44698733"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44698185">
          <h3>
            <a class="item" href="https://janet-lang.org"
              >Janet: Lightweight, Expressive, Modern Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 01:28:36</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44698185"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44697145">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/07/26/health/coronary-artery-calcium-heart.html"
              >Coronary artery calcium testing can reveal plaque in arteries,
              but is underused</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-26 @ 21:45:07</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44697145"
                  >Comments</a
                ><span class="descendants">: 161</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44674961">
          <h3>
            <a
              class="item"
              href="https://www.robertasami.com/coffee/into-the-coferment-kingdom"
              >Into the co-ferment kingdom: A trip to Finca Monteblanco</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 19:26:18</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44674961"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44669026">
          <h3>
            <a class="item" href="https://github.com/vivoblueos/kernel"
              >BlueOS Kernel – Written in Rust, compatible with POSIX</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 10:19:59</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44669026"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44666032">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/books/2025/07/12/flashes-brilliance-history-early-photography-anika-burgess-review/"
              >When photography was born, fascination, obsession, and danger
              followed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 01:51:04</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44666032"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44665816">
          <h3>
            <a class="item" href="https://16colo.rs/"
              >16colo.rs: ANSI/ASCII art archive</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 01:12:35</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44665816"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44665662">
          <h3>
            <a
              class="item"
              href="https://fs.blog/knowledge-project-podcast/outliers-katharine-graham/"
              >Katharine Graham: The Washington Post</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 00:47:24</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44665662"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44665644">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Purple_Earth_hypothesis"
              >Purple Earth hypothesis</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 00:43:38</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44665644"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44658722">
          <h3>
            <a
              class="item"
              href="https://www.cnx-software.com/2025/07/22/three-high-performance-risc-v-processors-to-watch-in-h2-2025-ultrarisc-ur-dp1000-zizhe-a210-and-spacemit-k3/"
              >High-performance RISC-V processors: UltraRISC UR-DP1000, Zhihe
              A210, SpacemIT K3</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 12:58:48</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44658722"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44658323">
          <h3>
            <a
              class="item"
              href="https://www.livescience.com/animals/land-mammals/return-of-wolves-to-yellowstone-has-led-to-a-surge-in-aspen-trees-unseen-for-80-years"
              >Return of wolves to Yellowstone has led to a surge in aspen
              trees</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-23 @ 12:13:52</span
              ><span class="points-container"
                >Points: <span class="points">296</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44658323"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://www.sciencedirect.com/science/article/pii/S0378112725004499?via%3Dihub"
                >https://www.sciencedirect.com/science/article/pii/S037811272...</a
              >
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
