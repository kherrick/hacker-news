<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44555836">
          <h3>
            <a
              class="item"
              href="https://www.italpassion.fr/en/stellantis/stellantis-declares-bankruptcy-in-china-with-1-billion-in-debts/"
              >Stellantis declares bankruptcy in China, with $1B in debts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 02:17:06</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44555836"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44555804">
          <h3>
            <a
              class="item"
              href="https://www.astronomy.com/science/james-webb-hubble-space-telescopes-face-reduction-in-operations-over-funding-shortfalls/"
              >James Webb, Hubble space telescopes face reduction in
              operations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 02:10:54</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44555804"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44555317">
          <h3>
            <a
              class="item"
              href="https://www.marksimonson.com/notebook/view/the-scourge-of-arial/"
              >The Scourge of Arial (2001)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 00:55:06</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44555317"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44555220">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/astronomers-detect-a-black-hole-merger-thats-so-massive-it-shouldnt-exist-2000628197"
              >Black hole merger challenges our understanding of black hole
              formation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 00:38:20</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44555220"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44554865">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2502.17424"
              >Emergent Misalignment: Narrow finetuning can produce broadly
              misaligned LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 23:46:12</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44554865"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44554307">
          <h3>
            <a class="item" href="https://gpfault.net/posts/asm-tut-0.txt.html"
              >Let's Learn x86-64 Assembly (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 22:22:15</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44554307"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44553752">
          <h3>
            <a class="item" href="https://github.com/OpenCut-app/OpenCut"
              >OpenCut: The open-source CapCut alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 21:08:47</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44553752"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44553747">
          <h3>
            <a class="item" href="https://github.com/APKLab/APKLab"
              >APKLab: Android Reverse-Engineering Workbench for VS Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 21:08:14</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44553747"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44553389">
          <h3>
            <a
              class="item"
              href="https://marketsaintefficient.substack.com/p/five-companies-now-control-over-90"
              >Five companies now control over 90% of the restaurant food
              delivery market</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 20:23:37</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44553389"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44553257">
          <h3>
            <a
              class="item"
              href="https://blog.johnluttig.com/p/hypercapitalism-and-the-ai-talent"
              >Hypercapitalism and the AI talent wars</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 20:09:34</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44553257"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44552414">
          <h3>
            <a
              class="item"
              href="https://www.glp1digest.com/p/how-glp-1s-are-breaking-life-insurance"
              >GLP-1s Are Breaking Life Insurance</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 18:31:47</span
              ><span class="points-container"
                >Points: <span class="points">277</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44552414"
                  >Comments</a
                ><span class="descendants">: 316</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44551913">
          <h3>
            <a
              class="item"
              href="https://www.lttlabs.com/blog/2025/07/11/does-showing-seconds-in-the-system-tray-actually-use-more-power"
              >Does showing seconds in the system tray actually use more
              power?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 17:18:20</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44551913"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44551784">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/infisical/jobs/qCrLiJb-developer-relations"
              >Infisical (YC W23) Is Hiring DevRel Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 17:00:57</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44551762">
          <h3>
            <a class="item" href="https://github.com/ByteAtATime/raycast-linux"
              >Show HN: A Raycast-compatible launcher for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 16:57:48</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44551762"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm a huge fan of Raycast, but as a Linux user, I was always
                disappointed it wasn't available on my main OS. This summer, I
                decided to just build it myself. This project has the goal of
                being interoperable with Raycast itself, including a majority of
                the extensions.
              </p>
              <p>
                It's built with Tauri and Rust on the backend, with a Svelte
                frontend. The biggest challenge was getting it to run existing
                Raycast extensions, which required building a custom React
                renderer as well as making a custom API.
              </p>
              <p>
                I also wrote a quick post, which I hope to expand on in the
                future, about this project. You can find it here:
                <a href="https://byteatatime.dev/posts/recreating-raycast"
                  >https://byteatatime.dev/posts/recreating-raycast</a
                >
              </p>
              <p>
                The project is still very rough, but I'm sharing it now to get
                any feedback you may have!
              </p>
            </div>
          </section>
        </section>
        <section id="44551652">
          <h3>
            <a
              class="item"
              href="https://zola.ink/blog/posts/a-technical-look-at-irans-internet-shutdown"
              >A technical look at Iran's internet shutdowns</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 16:45:02</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44551652"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44551318">
          <h3>
            <a
              class="item"
              href="https://blog.ivnj.org/post/function-coloring-is-inevitable"
              >Zig's new I/O: function coloring is inevitable?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 15:57:34</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44551318"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44551109">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/food/article/data-deep-dives-bay-area-fine-dining-restaurants-20404434.php"
              >Fine dining restaurants researching guests to make their dinner
              unforgettable</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 15:30:29</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44551109"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44550572">
          <h3>
            <a
              class="item"
              href="https://www.makingsoftware.com/chapters/how-a-screen-works"
              >How does a screen work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 14:09:06</span
              ><span class="points-container"
                >Points: <span class="points">370</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44550572"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44550157">
          <h3>
            <a class="item" href="https://github.com/Exorust/TorchLeet"
              >Show HN: Learn LLMs LeetCode Style</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 13:03:13</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44550157"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44549762">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/07/13/fake_it_worker_problem/"
              >The North Korean fake IT worker problem is ubiquitous</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 12:06:34</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44549762"
                  >Comments</a
                ><span class="descendants">: 237</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44532527">
          <h3>
            <a
              class="item"
              href="https://c3-lang.org/blog/forget-borrow-checkers-c3-solved-memory-lifetimes-with-scopes/"
              >C3 solved memory lifetimes with scopes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 14:27:42</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44532527"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44531642">
          <h3>
            <a
              class="item"
              href="https://bennet.org/blog/how-secure-is-your-bitcoin-wallets-mnemonic-seed-phrase/"
              >How secure is your Bitcoin wallet's mnemonic seed phrase?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 13:01:07</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44531642"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44527172">
          <h3>
            <a
              class="item"
              href="https://www.eff.org/deeplinks/2025/07/axons-draft-one-designed-defy-transparency"
              >Axon’s Draft One is designed to defy transparency</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 00:21:16</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44527172"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44525405">
          <h3>
            <a
              class="item"
              href="https://blog.jxmo.io/p/how-to-scale-rl-to-1026-flops"
              >How to scale RL to 10^26 FLOPs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 20:47:34</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44525405"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44522683">
          <h3>
            <a class="item" href="https://nodaysoff.run"
              >Show HN: Ten years of running every day, visualized</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 16:21:13</span
              ><span class="points-container"
                >Points: <span class="points">240</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44522683"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
            <div class="text">
              <p>
                Running has truly changed my life: I've made lifelong friends,
                explored beautiful places, and more importantly invested into my
                own health and fitness, which I'm starting to see the positive
                benefits as I get older.
              </p>
              <p>
                The stack is pretty simple: a NextJS app, with a Postgres
                database to keep all my running data, and all the stats are
                pre-computed and cached in Redis, so I effectively only hit the
                database once a day when a new run is ingested. On the fronted,
                I toyed with the idea of using D3 or pre-existing data viz
                libraries, but ended up rolling my own using SVGs directly, it
                gave me more control on the visualizations.
              </p>
              <p>
                I used the Strava bulk export to pre-populate the database, and
                I'm using their webhook API to do incremental updates. I have to
                tap into OpenWeatherMap and OpenCageDate to enrich the running
                data a little bit.
              </p>
              <p>
                Happy to answer anything about the stack, data pipeline, or how
                I stayed motivated for 10 years!
              </p>
              <p>
                [1]
                <a href="https://www.runeveryday.com"
                  >https://www.runeveryday.com</a
                >
                Run Streak Association rules: ≥ 1 mile per day
              </p>
            </div>
          </section>
        </section>
        <section id="44521108">
          <h3>
            <a
              class="item"
              href="https://www.sciencealert.com/chimpfluencers-are-sticking-grass-in-their-ears-and-butts-in-latest-viral-trend"
              >Chimpfluencers Stick Grass in Their Ears and Butts in Latest
              Viral Trend</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 13:52:27</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44521108"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44520855">
          <h3>
            <a class="item" href="https://vidmix.app/ffmpeg-in-plain-english/"
              >Show HN: FFmpeg in plain English – LLM-assisted FFmpeg in the
              browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 13:32:49</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44520855"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                This site attempts to solve that. You just describe what you
                want to do, pick the input files and an LLM (currently DeepSeek)
                generates the FFmpeg command. You can then run it directly in
                your browser or use the command elsewhere.
              </p>
            </div>
          </section>
        </section>
        <section id="44519890">
          <h3>
            <a
              class="item"
              href="https://jameshfisher.com/2025/07/07/a-job-queue-in-two-lines-of-js/"
              >A job queue in two lines of JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 11:43:36</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44519890"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44519395">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20181129-the-underground-cathedral-protecting-tokyo-from-floods"
              >The underground cathedral protecting Tokyo from floods (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 10:30:42</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44519395"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44512350">
          <h3>
            <a
              class="item"
              href="https://www.mechanize.work/blog/the-upcoming-gpt-3-moment-for-rl/"
              >The upcoming GPT-3 moment for RL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 16:59:30</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44512350"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
