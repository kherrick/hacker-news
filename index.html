<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41752020">
          <h3>
            <a
              class="item"
              href="https://research.tudelft.nl/en/publications/corncrete-a-corn-starch-based-building-material"
              >CoRncrete: A corn starch based building material</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 18:51:28</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41752020"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41751776">
          <h3>
            <a
              class="item"
              href="https://twitter.com/automattic/status/1842612123488473341"
              >Automattic turns to weaponizing responsible disclosure against WP
              Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 18:14:58</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41751776"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41751587">
          <h3>
            <a class="item" href="https://github.com/StarmoonAI/Starmoon"
              >Show HN: Open-source real-time talk-to-AI wearable device for few
              $</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 17:48:42</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41751587"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                2. Not everyone is good at making friends and not everyone has a
                BFF to talk to. Imagine you're having a hard time in life or at
                work, and you can't tell your parents or friends.
              </p>
              <p>
                So, we built an open-source project Starmoon and are using
                affordable hardware components to bring AI characters to
                real-word objects like toys and plushies to help people
                emotional growth.
              </p>
              <p>
                We believe this is a complement tool and it is not intended to
                replace anyone. Please leave any opinion.
              </p>
            </div>
          </section>
        </section>
        <section id="41751568">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-03209-4"
              >World-first therapy using donor cells sends autoimmune diseases
              into remission</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 17:46:33</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41751568"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41751407">
          <h3>
            <a class="item" href="https://datavizcatalogue.com/search.html"
              >The Data Visualisation Catalogue: find the right method for your
              data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 17:25:01</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41751407"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41751243">
          <h3>
            <a
              class="item"
              href="https://remotejobs.org/companies/rankscience-remote-jobs"
              >RankScience (YC W17) is hiring to supercharge SEO for startups</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 17:00:33</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41751122">
          <h3>
            <a
              class="item"
              href="https://www.space.com/space-bricks-potato-starch-mars-moon-dirt"
              >Potatoes are better than human blood for making space bricks,
              scientists say</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 16:45:51</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41751122"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41751013">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41751013"
              >Ask HN: What type of Auth are you using on your side projects?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 16:29:14</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41751013"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
            <div class="text">
              I was looking at the Supabase docs and it was nice to see a long
              list of Auth work flows supported/documented. So my question is,
              here in October 2024, what are y'all using for Auth on your side
              projects. Password based, social, email, something else? If you
              are using social, which social do you support? Is there any public
              data on which types of Auth have the best conversion/bounce rates?
              And for you, which Auth is just easy to support long term and
              which just ends up being a drag? TY
            </div>
          </section>
        </section>
        <section id="41750716">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/10/03/patent_shakedown_fails_as_troll/"
              >Cloudflare beats patent troll so badly it basically gives up</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 15:51:41</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41750716"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41750630">
          <h3>
            <a class="item" href="https://zeldman.com/2024/10/04/i-stayed/"
              >I Stayed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 15:40:04</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41750630"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41750470">
          <h3>
            <a
              class="item"
              href="https://hbr.org/2024/10/gen-ai-makes-legal-action-cheap-and-companies-need-to-prepare"
              >Gen AI Makes Legal Action Cheap – and Companies Need to
              Prepare</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 15:18:51</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41750470"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41749742">
          <h3>
            <a
              class="item"
              href="https://medicalxpress.com/news/2024-09-preclinical-drug-free-nasal-spray.html"
              >Studies suggest a drug-free nasal spray could ward off
              respiratory infections</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 13:38:36</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41749742"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41749655">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/health/2024/10/popular-gut-probiotic-completely-craps-out-in-randomized-controlled-trial/"
              >Popular gut probiotic craps out in randomized controlled trial</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 13:23:57</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41749655"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41749612">
          <h3>
            <a
              class="item"
              href="https://www.righto.com/2023/01/inside-globus-ink-mechanical-navigation.html"
              >The Globus INK: a mechanical navigation computer for Soviet
              spaceflight</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 13:16:30</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41749612"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41749592">
          <h3>
            <a
              class="item"
              href="https://www.thetimes.com/life-style/parenting/article/we-only-learnt-of-our-sons-secret-online-life-after-he-died-at-20-rj3bqfnqn"
              >We only learnt of our son's online life after he died at 20</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 13:12:46</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41749592"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41749371">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/technology/archive/2024/10/sam-altman-mythmaking/680152/"
              >It's Time to Stop Taking Sam Altman at His Word</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 12:17:24</span
              ><span class="points-container"
                >Points: <span class="points">559</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41749371"
                  >Comments</a
                ><span class="descendants">: 448</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41749346">
          <h3>
            <a
              class="item"
              href="https://english.elpais.com/health/2024-10-05/cern-trains-ai-models-to-revolutionize-cancer-treatment.html"
              >CERN trains AI models to revolutionize cancer treatment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 12:12:06</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41749346"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41748941">
          <h3>
            <a class="item" href="https://github.com/Pythagora-io/pythagora"
              >Pythagora: Auto-Generate Node.js Tests Using LLMs, No Coding
              Required</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 10:42:40</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41748941"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41748497">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/transistor-radio-invented"
              >The First Transistor Radio</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 08:32:40</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41748497"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41747966">
          <h3>
            <a class="item" href="https://www.linuxfromscratch.org/index.html"
              >Linux from Scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 05:43:59</span
              ><span class="points-container"
                >Points: <span class="points">277</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41747966"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41747881">
          <h3>
            <a class="item" href="https://github.com/Losses/rune"
              >Rune: A Local Music Player Reviving Zune's Classic Aesthetic with
              Modern Tech</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 05:15:26</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41747881"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41745788">
          <h3>
            <a
              class="item"
              href="https://github.com/norvig/pytudes/blob/main/ipynb/CherylMind.ipynb"
              >LLMs, Theory of Mind, and Cheryl's Birthday</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 21:34:07</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41745788"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41744434">
          <h3>
            <a
              class="item"
              href="https://mitmproxy.org/posts/releases/mitmproxy-11/"
              >Mitmproxy 11: Full HTTP/3 Support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 18:52:46</span
              ><span class="points-container"
                >Points: <span class="points">320</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41744434"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41743327">
          <h3>
            <a class="item" href="https://github.com/livekit/agents"
              >Show HN: Open source framework OpenAI uses for Advanced Voice</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 17:01:04</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41743327"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
            <div class="text">
              <p>
                The goal is to give everyone access to the same stack that
                underpins Advanced Voice in the ChatGPT app.
              </p>
              <p>
                Under the hood it works like this: - A user's speech is captured
                by a LiveKit client SDK in the ChatGPT app - Their speech is
                streamed using WebRTC to OpenAI’s voice agent - The agent relays
                the speech prompt over websocket to GPT-4o - GPT-4o runs
                inference and streams speech packets (over websocket) back to
                the agent - The agent relays generated speech using WebRTC back
                to the user’s device
              </p>
              <p>
                The Realtime API that OpenAI launched is the websocket interface
                to GPT-4o. This backend framework covers the voice agent
                portion. Besides having additional logic like function calling,
                the agent fundamentally proxies WebRTC to websocket.
              </p>
              <p>
                The reason for this is because websocket isn’t the best choice
                for client-server communication. The vast majority of packet
                loss occurs between a server and client device and websocket
                doesn’t provide programmatic control or intervention in lossy
                network environments like WiFi or cellular. Packet loss leads to
                higher latency and choppy or garbled audio.
              </p>
            </div>
          </section>
        </section>
        <section id="41742432">
          <h3>
            <a class="item" href="https://isaak.net/mandarin/"
              >12 Months of Mandarin</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 15:28:51</span
              ><span class="points-container"
                >Points: <span class="points">454</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41742432"
                  >Comments</a
                ><span class="descendants">: 255</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41728480">
          <h3>
            <a class="item" href="https://nv1t.github.io/blog/kekz-headphones/"
              >Reverse Engineering and Dismantling Kekz Headphones</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 08:24:49</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41728480"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41728185">
          <h3>
            <a class="item" href="https://hansdegoede.dreamwidth.org/28841.html"
              >IPU6 camera support in Fedora 41</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 07:37:01</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41728185"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41721885">
          <h3>
            <a
              class="item"
              href="https://www.itu.int:443/en/mediacentre/Pages/PR-2024-09-19-the-Republic-of-Palau-becomes-ITUs-194th-Member-State.aspx"
              >The Republic of Palau Becomes ITU's 194th Member State</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-02 @ 15:50:56</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41721885"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41717543">
          <h3>
            <a
              class="item"
              href="https://vasekrozhon.wordpress.com/2024/08/18/what-p-vs-np-is-actually-about/"
              >What P vs. NP is about</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-02 @ 05:46:04</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41717543"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41715883">
          <h3><a class="item" href="https://noise.jake.fun/">Noise</a></h3>
          <section>
            <h4>
              <span>2024-10-02 @ 00:16:26</span
              ><span class="points-container"
                >Points: <span class="points">529</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41715883"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
