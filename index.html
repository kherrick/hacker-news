<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44388387">
          <h3>
            <a
              class="item"
              href="https://bfl.ai/announcements/flux-1-kontext-dev"
              >FLUX.1 Kontext [Dev] – Open Weights for Image Editing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-26 @ 15:31:58</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44388387"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44388093">
          <h3>
            <a class="item" href="https://github.com/metabase/dataset-generator"
              >Show HN: I built an AI dataset generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-26 @ 14:58:32</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44388093"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44387828">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44387828"
              >Launch HN: Issen (YC F24) – personal AI language tutor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-26 @ 14:32:28</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44387828"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <a href="https://issen.com">https://issen.com</a>), a foreign
              language voice tutor app that adapts to your interests, goals, and
              needs.
              <p>
                Demo:
                <a
                  href="https://www.loom.com/share/a78e713d46934857a2dc88aed1bb100d?sid=ec4dc1f3-1a4f-4d75-8e87-efbb3d2b2e90"
                  >https://www.loom.com/share/a78e713d46934857a2dc88aed1bb100d?...</a
                >
              </p>
              <p>
                We started this company after struggling to find great tools to
                practice speaking Japanese and French. Having a tutor can be
                awesome, but there are downsides: they can be expensive (since
                you pay by the hour), difficult to schedule, and have a high
                upfront cost (finding a tutor you like often forces you to cycle
                through a few that you don’t).
              </p>
              <p>
                We wanted something that would talk with us — realistically, in
                full conversations — and actually help us improve. So we built
                it ourselves. The app relies on a custom voice AI pipeline
                combining STT (speech-to-text), TTS (text-to-speech), LLMs, long
                term memory, interruptions, turn-taking, etc. Getting
                speech-to-text to work well for learners was one of the hardest
                parts — especially with accents, multi-lingual sentences, and
                noisy environments. We now combine Gemini Flash, Whisper,
                Scribe, and GPT-4o-transcribe to minimize errors and keep the
                conversation flowing.
              </p>
              <p>
                We didn’t want to focus too much on gamification. In our
                experience, that leads to users performing well in the app,
                achieving long streaks and so on, without actually getting
                fluent in the language you're wanting to learn.
              </p>
              <p>
                With ISSEN you instantly speak and immerse yourself in the
                language, which, while not easy, is a much more efficient way to
                learn.
              </p>
              <p>
                We combine this with a word bank and SRS flashcards for new
                words learned in the AI voice chats, which allows very rapid
                improvement in both vocabulary and speaking skills. We also
                create custom curriculums for each student based on goals,
                interests, and preferences, and fully customizable settings like
                speed, turn taking, formality, etc.
              </p>
              <p>
                App: <a href="https://issen.com">https://issen.com</a> (works on
                web, iOS, Android) Pricing: 20 min free trial, $20–29/month
                (depending on duration and specific geography)
              </p>
              <p>
                We’d love your feedback — on the tech, the UX, or what you’d
                wish from a tool like this. Thanks!
              </p>
            </div>
          </section>
        </section>
        <section id="44386887">
          <h3>
            <a
              class="item"
              href="https://www.cubic.dev/blog/learnings-from-building-ai-agents"
              >Learnings from building AI agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-26 @ 12:45:04</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44386887"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44386637">
          <h3>
            <a
              class="item"
              href="https://matklad.github.io/2025/06/26/rssssr.html"
              >RSS Server Side Reader</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-26 @ 12:11:52</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44386637"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44385981">
          <h3>
            <a
              class="item"
              href="https://research.google/blog/muvera-making-multi-vector-retrieval-as-fast-as-single-vector-search/"
              >Muvera: Making multi-vector retrieval as fast as single-vector
              search</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-26 @ 10:29:34</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44385981"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44385742">
          <h3>
            <a class="item" href="https://apptainer.org/"
              >Apptainer: Application Containers for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-26 @ 09:45:21</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44385742"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44385612">
          <h3>
            <a
              class="item"
              href="https://www.worksinprogress.news/p/the-first-non-opioid-painkiller"
              >The first non-opoid painkiller</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-26 @ 09:16:53</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44385612"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44385562">
          <h3>
            <a class="item" href="https://snowemu.com/"
              >Snow - Classic Macintosh emulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-26 @ 09:08:00</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44385562"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/twvd/snow"
                >https://github.com/twvd/snow</a
              >, Originally-submitted source explaining project:
              <a href="https://oldbytes.space/@smallsco/114747196289375530"
                >https://oldbytes.space/@smallsco/114747196289375530</a
              >,
            </div>
          </section>
        </section>
        <section id="44384913">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/accessowl/jobs/1shGwy2-senior-software-engineer-elixir-focus"
              >AccessOwl (YC S22) is hiring an Elixir Engineer to connect 100s
              of SaaS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-26 @ 07:00:43</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44384610">
          <h3>
            <a class="item" href="https://jaysthoughts.com/aithoughts1"
              >LLM code generation may lead to an erosion of trust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-26 @ 06:07:49</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44384610"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44382834">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/puerto-rico-solar-microgrids"
              >Puerto Rico's Solar Microgrids Beat Blackout</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 23:41:16</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44382834"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44382752">
          <h3>
            <a
              class="item"
              href="https://github.com/qemu/qemu/commit/3d40db0efc22520fa6c399cf73960dced423b048"
              >Define policy forbidding use of AI code generators</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 23:26:55</span
              ><span class="points-container"
                >Points: <span class="points">455</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44382752"
                  >Comments</a
                ><span class="descendants">: 322</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44381297">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/a-new-pyramid-like-shape-always-lands-the-same-side-up-20250625/"
              >A new pyramid-like shape always lands the same side up</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 20:01:07</span
              ><span class="points-container"
                >Points: <span class="points">529</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381297"
                  >Comments</a
                ><span class="descendants">: 135</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44381252">
          <h3>
            <a
              class="item"
              href="https://www.folklore.org/Negative_2000_Lines_Of_Code.html"
              >-2000 Lines of code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 19:53:13</span
              ><span class="points-container"
                >Points: <span class="points">446</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381252"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44381168">
          <h3>
            <a class="item" href="https://www.theoffline-club.com"
              >The Offline Club</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 19:42:57</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44381168"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44380185">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/06/25/this-self-taught-ethiopian-dev-built-an-authentication-tool-and-got-into-yc/"
              >Better Auth, by a self-taught Ethiopian dev, raises $5M from Peak
              XV, YC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 18:07:02</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44380185"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44379673">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/claude-powered-artifacts"
              >Build and Host AI-Powered Apps with Claude – No Deployment
              Needed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 17:14:35</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44379673"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44379670">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/ideas/archive/2025/06/prisoner-populations-are-plummeting/683310/"
              >America’s incarceration rate is in decline</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 17:14:29</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44379670"
                  >Comments</a
                ><span class="descendants">: 384</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44379606">
          <h3>
            <a
              class="item"
              href="http://genius.cat-v.org/richard-feynman/writtings/letters/problems"
              >What Problems to Solve (1966)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 17:08:44</span
              ><span class="points-container"
                >Points: <span class="points">416</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44379606"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44376989">
          <h3>
            <a
              class="item"
              href="https://george.mand.is/2025/06/openai-charges-by-the-minute-so-make-the-minutes-shorter/"
              >OpenAI charges by the minute, so speed up your audio</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 13:17:25</span
              ><span class="points-container"
                >Points: <span class="points">646</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44376989"
                  >Comments</a
                ><span class="descendants">: 191</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44376919">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/developers/introducing-gemini-cli-open-source-ai-agent/"
              >Gemini CLI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-25 @ 13:10:46</span
              ><span class="points-container"
                >Points: <span class="points">1327</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44376919"
                  >Comments</a
                ><span class="descendants">: 722</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/google-gemini/gemini-cli"
                >https://github.com/google-gemini/gemini-cli</a
              >
            </div>
          </section>
        </section>
        <section id="44365754">
          <h3>
            <a
              class="item"
              href="https://www.programmax.net/articles/png-is-back/"
              >A new PNG spec</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-24 @ 13:01:17</span
              ><span class="points-container"
                >Points: <span class="points">610</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44365754"
                  >Comments</a
                ><span class="descendants">: 553</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44361633">
          <h3>
            <a
              class="item"
              href="http://wtarreau.blogspot.com/2025/06/real-world-performance-comparison-of.html"
              >Real-world performance comparison of ebtree/cebtree/rbtree</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-24 @ 00:27:51</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44361633"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44358667">
          <h3>
            <a class="item" href="https://github.com/boltgolt/howdy"
              >Howdy – Windows Hello style facial authentication for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-23 @ 18:34:36</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44358667"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44358148">
          <h3>
            <a class="item" href="https://ambient.garden">Ambient Garden</a>
          </h3>
          <section>
            <h4>
              <span>2025-06-23 @ 17:38:08</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44358148"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44354032">
          <h3>
            <a
              class="item"
              href="https://tympanus.net/codrops/2025/06/23/modeling-the-world-in-280-characters/"
              >Modeling the World in 280 Characters</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-23 @ 10:02:10</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44354032"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44349332">
          <h3>
            <a class="item" href="https://cij-analysis.streamlit.app"
              >What makes comprehensible input comprehensible?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-22 @ 18:51:17</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44349332"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44348415">
          <h3>
            <a
              class="item"
              href="https://blog.brakmic.com/structured-output-with-langchain-and-llamafile/"
              >Structured Output with LangChain and Llamafile</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-22 @ 17:01:10</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44348415"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44345681">
          <h3>
            <a class="item" href="https://crescentro.se/posts/writing-drivers/"
              >Writing a basic Linux device driver when you know nothing about
              Linux drivers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-22 @ 10:29:42</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44345681"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
