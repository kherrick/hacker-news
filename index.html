<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39983490">
          <h3>
            <a class="item" href="https://github.com/dolthub/go-mysql-server"
              >A MySQL compatible database engine written in pure Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 19:50:43</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39983490"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39982818">
          <h3>
            <a
              class="item"
              href="https://platform.openai.com/docs/models/gpt-4-turbo-and-gpt-4"
              >GPT-4 Turbo with Vision Generally Available</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 18:53:54</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39982818"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39982362">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.01261"
              >Evaluating faithfulness and content selection of LLMs in
              book-length summaries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 18:14:47</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39982362"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39982300">
          <h3>
            <a
              class="item"
              href="https://lithub.com/the-small-press-world-is-about-to-fall-apart-on-the-collapse-of-small-press-distribution/"
              >The Collapse of Small Press Distribution</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 18:09:29</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39982300"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39982024">
          <h3>
            <a
              class="item"
              href="https://www.stanfordmagnets.com/cow-magnets.html"
              >Cow Magnets</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 17:45:00</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39982024"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39982011">
          <h3>
            <a
              class="item"
              href="https://pikuma.com/courses/ps1-programming-mips-assembly-language"
              >PS1 Programming Course with MIPS Assembly and C</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 17:43:57</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39982011"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39981945">
          <h3>
            <a class="item" href="https://zed.dev/blog/zed-decoded-async-rust"
              >Zed Decoded: Async Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 17:38:59</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39981945"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39981623">
          <h3>
            <a
              class="item"
              href="https://research.google/blog/screenai-a-visual-language-model-for-ui-and-visually-situated-language-understanding/"
              >ScreenAI: A visual LLM for UI and visually-situated language
              understanding</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 17:15:53</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39981623"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39981550">
          <h3>
            <a class="item" href="https://shop.fairphone.com/fairbuds"
              >Fairbuds: In-ear with replaceable batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 17:09:51</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39981550"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39981423">
          <h3>
            <a class="item" href="https://www.virtualcolossus.co.uk/colossus3d/"
              >Virtual Colossus</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 16:59:49</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39981423"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39981034">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/2024/apr/09/peter-higgs-physicist-who-discovered-higgs-boson-dies-aged-94"
              >Peter Higgs, physicist who discovered Higgs boson, has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 16:21:53</span
              ><span class="points-container"
                >Points: <span class="points">517</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39981034"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39981032">
          <h3>
            <a
              class="item"
              href="https://www.intel.com/content/www/us/en/newsroom/news/vision-2024-gaudi-3-ai-accelerator.html"
              >Intel Gaudi 3 AI Accelerator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 16:21:40</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39981032"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39980268">
          <h3>
            <a
              class="item"
              href="https://blog.beeper.com/2024/04/09/beeper-is-joining-automattic/"
              >Beeper acquired by Automattic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 15:09:25</span
              ><span class="points-container"
                >Points: <span class="points">370</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39980268"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39979806">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-024-07229-y"
              >Persistent interaction patterns across social media platforms and
              over time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 14:27:53</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39979806"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39979750">
          <h3>
            <a
              class="item"
              href="https://grafana.com/blog/2024/04/09/find-your-logs-data-with-explore-logs-no-logql-required/"
              >Preview of Explore Logs, a new way to browse your logs without
              writing LogQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 14:23:26</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39979750"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39979375">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2024/e-rickshaw-yc-electric-india/"
              >India’s electric rickshaws</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 13:45:04</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39979375"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39979140">
          <h3>
            <a
              class="item"
              href="http://www.adriancourreges.com/blog/2015/06/23/supreme-commander-graphics-study/"
              >Supreme Commander Graphics Study (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 13:18:34</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39979140"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978774">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/by-invitation/2024/04/08/steven-levitt-and-john-donohue-defend-a-finding-made-famous-by-freakonomics"
              >Steven Levitt and John Donohue defend abortion-crime
              hypothesis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 12:40:09</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978774"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978717">
          <h3>
            <a
              class="item"
              href="https://storage.googleapis.com/deepmind-media/gemma/codegemma_report.pdf"
              >Google CodeGemma: Open Code Models Based on Gemma [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 12:32:05</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978717"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978653">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41598-024-57916-z"
              >Anger is eliminated with the disposal of a paper written because
              of provocation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 12:24:04</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978653"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39978108">
          <h3>
            <a class="item" href="https://github.com/nus-apr/auto-code-rover"
              >AutoCodeRover: Autonomous Program Improvement</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 10:56:31</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39978108"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39977845">
          <h3>
            <a
              class="item"
              href="https://blog.the.al/2024/04/09/dualshock-calibration-in-the-browser.html"
              >Show HN: DualShock calibration in the browser using WebHID</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 09:59:16</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39977845"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
            <div class="text">
              This website uses undocumented HID commands of both DS4 and
              DualSense to re-center and recalibrate DualShock analog sticks.
            </div>
          </section>
        </section>
        <section id="39977831">
          <h3>
            <a
              class="item"
              href="https://www.upworthy.com/the-lonely-funeral-project"
              >The Lonely Funeral Project in Amsterdam</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 09:56:49</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39977831"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39977058">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2024/04/02/1241148577/table-saw-injuries-safety-sawstop-cpsc"
              >The U.S. government may finally mandate safer table saws</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 07:48:11</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39977058"
                  >Comments</a
                ><span class="descendants">: 308</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39976640">
          <h3>
            <a class="item" href="https://qdiv.dev/posts/eth2/"
              >Show HN: I made a discrete logic network card</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 06:24:15</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39976640"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39976557">
          <h3>
            <a
              class="item"
              href="https://text.marvinborner.de/2024-03-25-02.html"
              >Lambda Screen: Fractals in Pure Lambda Calculus</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 06:05:56</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39976557"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39976472">
          <h3>
            <a
              class="item"
              href="https://zipcpu.com/blog/2024/04/01/chasing-resets.html"
              >Chasing resets</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-09 @ 05:47:03</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39976472"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39972586">
          <h3>
            <a class="item" href="https://github.com/larryboyko/dimityjones"
              >Show HN: Dimity Jones in Puzzle Castle: An Electronic Escape
              Novel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 18:47:31</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39972586"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>Think: escape room in the form of a novel.</p>
              <p>
                A computer, and rudimentary coding skills in a language of your
                choice, will be indispensable for performing the transformations
                -- and might help with the solving too!
              </p>
              <p>
                My wife, the author, passed away five years ago. This is not the
                last thing she wrote, but it is the most unusual,
                unapproachable, and personal of her major works. It is also, as
                the only novel of hers that I cannot breeze through in an
                afternoon (and despite my unflattering appearance in it), my
                favorite.
              </p>
              <p>
                Though _Dimity Jones_ was left unfinished, and perhaps
                abandoned, at the time of my wife's death, its elements were all
                there, on her hard disk, awaiting only a final compiling. My
                contribution to this text has therefore been little more than
                that of an occasional copyeditor (my wife was a meticulous
                speller and self-proofreader) and playtester.
              </p>
              <p>
                Before releasing this work more widely, I would love to have it
                test-driven by better coders and puzzlers than I.
              </p>
              <p>
                Any and all feedback is welcome, from positive to negative, from
                the sweeping to the picayune. Let me know what confuses or
                frustrates you -- and especially let me know if (where) you get
                stuck.
              </p>
              <p>
                Otherwise, there are no special instructions; it's all in the
                book.
              </p>
              <p>
                While _Dimity Jones_ is still in its debugging/proofreading
                phase, please refrain from sharing it or putting it any (other)
                public place. (Christine would have been horrified to see her
                work thus published before it was letter-perfect; but I have
                exhausted my pool of friends and colleagues both able and
                willing to tinker with it. This seems like the ideal community
                of potential testers.)
              </p>
              <p>Thanking you in advance. I hope you enjoy!</p>
            </div>
          </section>
        </section>
        <section id="39971873">
          <h3>
            <a
              class="item"
              href="https://medium.com/airbnb-engineering/chronon-airbnbs-ml-feature-platform-is-now-open-source-d9c4dba859e8"
              >Chronon, Airbnb's ML feature platform, is now open source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 17:27:11</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39971873"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39966969">
          <h3>
            <a
              class="item"
              href="https://www.imperialviolet.org/2024/04/07/letskerberos.html"
              >Let's Kerberos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 06:59:43</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39966969"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
