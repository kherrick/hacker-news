<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43600192">
          <h3>
            <a
              class="item"
              href="https://elenacross7.medium.com/%EF%B8%8F-the-s-in-mcp-stands-for-security-91407b33ed6b"
              >The "S" in MCP Stands for Security</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 09:42:28</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43600192"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43600060">
          <h3>
            <a
              class="item"
              href="https://www.thetimes.com/uk/crime/article/police-make-30-arrests-a-day-for-offensive-online-messages-zbv886tqf"
              >UK Police Arrest 30 People Per Day for Internet Comments</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 09:14:53</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43600060"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43599967">
          <h3>
            <a
              class="item"
              href="https://machinelearning.apple.com/research/seedlm-compressing"
              >SeedLM: Compressing LLM Weights into Seeds of Pseudo-Random
              Generators</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 08:53:41</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43599967"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43599637">
          <h3>
            <a class="item" href="https://standardebooks.org"
              >Standard Ebooks: liberated ebooks, carefully produced for the
              true book lover</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 07:36:12</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43599637"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43599613">
          <h3>
            <a
              class="item"
              href="https://motifanalytics.medium.com/my-browser-wasmt-prepared-for-this-using-duckdb-apache-arrow-and-web-workers-in-real-life-e3dd4695623d"
              >My Browser WASM't Prepared for This. Using DuckDB, Apache Arrow
              and Web Workers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 07:31:27</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43599613"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43599470">
          <h3>
            <a class="item" href="https://www.imgfiber.com/"
              >Show HN: I Built ImgFiber-Better Image Optimizer. Free No
              Limits</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 06:55:55</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43599470"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>NOT A FFmpeg Wrapper.</p>
              <p>It's not like any other Alternatives, Try for yourself!</p>
              <p>
                Are you someone who deals with lots of images and always find
                yourself with your storage full? or Someone Who deals with
                websites optimization and would love to get that fast loading
                speed? No matter who you are, as long as you deal with Images,
                Imgfiber got your back!
              </p>
              <p>
                ⬇ Reduce image file sizes by up to 95% without losing quality!
                Supports all major formats: JPG, PNG, JPEG, GIF, SVG, and WebP.
                Works entirely in your browser—no uploads, no servers, just the
                power of your own device! Blazing fast compression—processes
                images as quickly as you drag and drop. Delivers results 2x
                better than competitors like OptImage, CompressX, TinyPNG, and
                Squoosh. Totally FREE with no file size or count limits -
                compress as many images as you want!
              </p>
              <p>
                Social Proof? - I am gonna be honest with you! I don't have
                social proof! I've been too busy building cool tools like
                IMGFiber, Codeaway, QuickWrap entire year that i forgot they
                need Lovely users to have significant value to its existent.
                I've spent an year building great range of SaaS and had zero
                exposure to provide your with trusted by 40,000+ users around
                the world! Nah! I don't have that! that's why i am here!
              </p>
              <p>I would geneuinly love for you to give ImgFiber a shot!</p>
              <p>Check it out ImgFiber.com and let me know your thoughts!</p>
            </div>
          </section>
        </section>
        <section id="43598600">
          <h3>
            <a
              class="item"
              href="https://spatialists.ch/posts/2025/04-05-serving-vector-tiles-fast/"
              >Serving Vector Tiles, Fast</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-06 @ 02:56:16</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43598600"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43597778">
          <h3>
            <a
              class="item"
              href="https://tansanrao.com/blog/2025/04/xnu-kernel-and-darwin-evolution-and-architecture/"
              >Apple’s Darwin OS and XNU Kernel Deep Dive</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 23:46:19</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43597778"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43597425">
          <h3>
            <a class="item" href="https://add.org/the-body-double/"
              >The ADHD body double: A unique tool for getting things done</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 22:45:03</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43597425"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43596864">
          <h3>
            <a
              class="item"
              href="https://haseebq.com/my-ten-rules-for-negotiating-a-job-offer/"
              >Rules for Negotiating a Job Offer (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 21:15:00</span
              ><span class="points-container"
                >Points: <span class="points">363</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43596864"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43596570">
          <h3>
            <a
              class="item"
              href="https://ultrasciencelabs.com/lab-notes/why-we-are-still-using-88x31-buttons"
              >We are still using 88x31 buttons</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 20:26:36</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43596570"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43596546">
          <h3>
            <a
              class="item"
              href="https://www.jsg.utexas.edu/news/2025/04/north-america-is-dripping-from-below-geoscientists-discover/"
              >North America Is Dripping from Below, Geoscientists Discover</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 20:24:09</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43596546"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43596543">
          <h3>
            <a class="item" href="https://pypi.org/project/model-signing/"
              >Open Source Coalition Announces 'Model-Signing' to Strengthen ML
              Supply Chain</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 20:24:03</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43596543"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43595585">
          <h3>
            <a
              class="item"
              href="https://ai.meta.com/blog/llama-4-multimodal-intelligence/"
              >The Llama 4 herd</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 18:33:56</span
              ><span class="points-container"
                >Points: <span class="points">1058</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43595585"
                  >Comments</a
                ><span class="descendants">: 536</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43595283">
          <h3>
            <a
              class="item"
              href="https://planetscale.com/blog/faster-interpreters-in-go-catching-up-with-cpp"
              >Faster interpreters in Go: Catching up with C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 17:59:55</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43595283"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43595269">
          <h3>
            <a class="item" href="https://simone.org/advertising/"
              >What if we made advertising illegal?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 17:57:46</span
              ><span class="points-container"
                >Points: <span class="points">1203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43595269"
                  >Comments</a
                ><span class="descendants">: 919</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43595223">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/dynamic-register-allocation-on-amds"
              >Dynamic Register Allocation on AMD's RDNA 4 GPU Architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 17:51:49</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43595223"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43594396">
          <h3>
            <a
              class="item"
              href="https://www.devonlive.com/whats-on/whats-on-news/exeters-unassuming-co-op-worker-10039941"
              >Exeter's unassuming co-op worker leads double life as 'Lord of
              the Logos'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 15:54:01</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43594396"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43593789">
          <h3>
            <a class="item" href="https://www.whatsit.today/"
              >Show HN: I built a word game. My mom thinks it's great. What do
              you think?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 14:26:02</span
              ><span class="points-container"
                >Points: <span class="points">401</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43593789"
                  >Comments</a
                ><span class="descendants">: 207</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43593596">
          <h3>
            <a
              class="item"
              href="https://forums.swift.org/t/pitch-a-vision-for-webassembly-support-in-swift/79060"
              >A Vision for WebAssembly Support in Swift</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 13:58:18</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43593596"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43592409">
          <h3>
            <a
              class="item"
              href="https://eshard.com/posts/emulating-ios-14-with-qemu"
              >Emulating an iPhone in QEMU</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-05 @ 10:57:00</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43592409"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43583134">
          <h3>
            <a
              class="item"
              href="https://www.propelauth.com/post/understanding-hydration-errors"
              >Understanding Hydration Errors by Building a SSR React Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-04 @ 14:41:48</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43583134"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43579777">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/guides/tech/what-is-an-ethernet-cable"
              >What is an Ethernet cable? Here's how to connect to the internet
              without Wi-Fi</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-04 @ 08:54:05</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43579777"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43579104">
          <h3>
            <a class="item" href="https://lwn.net/Articles/1013776/"
              >Lessons from open source in the Mexican government</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-04 @ 06:55:11</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43579104"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43578348">
          <h3>
            <a
              class="item"
              href="https://laist.com/news/climate-environment/how-much-toxic-heavy-metal-is-in-that-bright-red-fire-retardant-we-had-it-tested-to-find-out"
              >What's in that bright red fire retardant? No one will say, so we
              had it tested</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-04 @ 04:32:52</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43578348"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43573507">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/OpenSSHConfigOrderMatters"
              >The order of files in /etc/ssh/sshd_config.d/ matters</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-03 @ 18:25:48</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43573507"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43566651">
          <h3>
            <a
              class="item"
              href="http://funcall.blogspot.com/2025/04/blacksmithing-and-lisp.html"
              >Blacksmithing and Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-03 @ 08:34:11</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43566651"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43564591">
          <h3>
            <a
              class="item"
              href="https://www.as.arizona.edu/~mrenzo/courses/notes-lecture-GWprog.html"
              >Photons, neutrinos, and gravitational-wave astronomy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-03 @ 04:00:27</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43564591"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43555365">
          <h3>
            <a
              class="item"
              href="https://peteronprogramming.wordpress.com/2025/04/02/diagnosing-bugs-preventing-sleep-on-windows/"
              >Diagnosing bugs preventing sleep on Windows</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-02 @ 10:40:33</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43555365"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43549893">
          <h3>
            <a
              class="item"
              href="https://lithub.com/on-the-episode-that-changed-ira-glasss-this-american-life-forever/"
              >The Importance of Fact-Checking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-01 @ 18:20:56</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43549893"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
