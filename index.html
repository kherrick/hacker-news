<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37248353">
          <h3>
            <a
              class="item"
              href="https://www.mahdikarimi.com/blog/why-i-wont-use-ai-deliberately"
              >I Won't Deliberately Use AI for Programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 13:13:04</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37248353"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37248002">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37248002"
              >Ask HN: Where do I find good code to read?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 12:28:55</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37248002"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
            <div class="text">
              I feel the need to do some code reading, but I don’t know where to
              find good code (don’t say GitHub).
            </div>
          </section>
        </section>
        <section id="37247879">
          <h3>
            <a class="item" href="http://www.technoblogy.com/show?4FFY"
              >Learn the basics of digital electronics with the hands-on Logic
              Lab kit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 12:10:41</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37247879"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37247394">
          <h3>
            <a class="item" href="https://jacobin.org/"
              >Jacobin: Minimal JVM written in Go and capable of running Java 17
              classes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 10:59:20</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37247394"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37247275">
          <h3>
            <a class="item" href="https://rocketgraph.io/logger-demo"
              >Show HN: I built this Postgres logger for you guys to check
              out</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 10:41:47</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37247275"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <p>
                Some of you were really interested in Postgres logging with
                pgAudit in my previous post here:
                <a href="https://news.ycombinator.com/item?id=37082827"
                  >https://news.ycombinator.com/item?id=37082827</a
                >
              </p>
              <p>
                So I built this logger:
                <a href="https://rocketgraph.io/logger-demo"
                  >https://rocketgraph.io/logger-demo</a
                >
              </p>
              <p>
                using pgAudit to show you what can be done with Postgres
                auditing. It offers some powerful features like "get me all the
                CREATE queries that ran in the past hour". These are generated
                by AWS RDS Instance running on my Rocketgraph account. Then they
                are forwarded to Cloudwatch for complex querying. In the future
                we can connect these logs to slack so you can get slack alerts
                when a developer accidentally DROPs a table.
              </p>
              <p>
                If you like my work, please check it out here:
                <a href="https://github.com/RocketsGraphQL/rgraph"
                  >https://github.com/RocketsGraphQL/rgraph</a
                >
              </p>
              <p>
                And if you want this logging on your own Postgres instance. Use
                <a href="https://rocketgraph.io/">https://rocketgraph.io/</a>
                And setup a project. pgAudit is automatically installed.
              </p>
            </div>
          </section>
        </section>
        <section id="37247268">
          <h3>
            <a class="item" href="https://github.com/mljar/automl-app"
              >Show HN: Web App with GUI for AutoML on Tabular Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 10:40:57</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37247268"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37246932">
          <h3>
            <a
              class="item"
              href="https://journal.infinitenegativeutility.com/leaving-haskell-behind"
              >Leaving Haskell Behind</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 09:51:17</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37246932"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37246740">
          <h3>
            <a
              class="item"
              href="https://blog.whimslab.io/how-modern-sql-databases-are-changing-web-development-4d1f15b0daea"
              >How Modern SQL Databases Are Changing Web Development: Part 1</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 09:25:17</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37246740"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37246458">
          <h3>
            <a
              class="item"
              href="https://github.com/punnerud/playwright_hot_docker"
              >Show HN: Playwright in Docker with hot reloading – Simple
              testautomation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 08:43:56</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37246458"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37246416">
          <h3>
            <a
              class="item"
              href="https://patents.google.com/patent/US3216423A/en"
              >Apparatus for facilitating the birth of a child by centrifugal
              force (1963)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 08:37:27</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37246416"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37245171">
          <h3>
            <a class="item" href="https://www.tooljet.com/workflows"
              >Show HN: Automate complicated manual business processes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 04:57:34</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37245171"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37244971">
          <h3>
            <a
              class="item"
              href="https://blog.shalvah.me/posts/understanding-percentiles"
              >Understanding Percentiles</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 04:21:47</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37244971"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37244503">
          <h3>
            <a
              class="item"
              href="https://medium.com/@ludirehak/printing-lol-doubled-the-speed-of-my-go-code-e32e02fc3f92"
              >Print(“lol”) doubled the speed of my Go function</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 02:53:12</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37244503"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37244012">
          <h3>
            <a class="item" href="https://bun.sh/blog/bun-v0.8.0">Bun v0.8</a>
          </h3>
          <section>
            <h4>
              <span>2023-08-24 @ 01:21:02</span
              ><span class="points-container"
                >Points: <span class="points">308</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37244012"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37241684">
          <h3>
            <a
              class="item"
              href="https://therumpus.net/2012/08/17/the-rumpus-interview-with-francis-ford-coppola-2/"
              >Interview: Francis Ford Coppola (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 20:46:43</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37241684"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37241625">
          <h3>
            <a class="item" href="https://github.com/norvig/pytudes">Pytudes</a>
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 20:41:01</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37241625"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37240363">
          <h3>
            <a class="item" href="https://github.com/Dataherald/dataherald"
              >Show HN: Dataherald AI – Natural Language to SQL Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 18:38:56</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37240363"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/Dataherald/dataherald"
                >https://github.com/Dataherald/dataherald</a
              >). This engine allows you to set up an API from your structured
              database that can answer questions in plain English.
              <p>
                GPT-4 class LLMs have gotten remarkably good at writing SQL.
                However, out-of-the-box LLMs and existing frameworks would not
                work with our own structured data at a necessary quality level.
                For example, given the question “what was the average rent in
                Los Angeles in May 2023?” a reasonable human would either assume
                the question is about Los Angeles, CA or would confirm the state
                with the question asker in a follow up. However, an LLM
                translates this to:
              </p>
              <p>
                select price from rent_prices where city=”Los Angeles” AND
                month=”05” AND year=”2023”
              </p>
              <p>
                This pulls data for Los Angeles, CA and Los Angeles, TX without
                getting columns to differentiate between the two. You can read
                more about the challenges of enterprise-level text-to-SQL in
                this blog post I wrote on the topic:
                <a
                  href="https://medium.com/dataherald/why-enterprise-natural-language-to-sql-is-hard-8849414f41c"
                  >https://medium.com/dataherald/why-enterprise-natural-languag...</a
                >
              </p>
              <p>
                Dataherald comes with “batteries-included.” It has best-in-class
                implementations of core components, including, but not limited
                to: a state of the art NL-to-SQL agent, an LLM-based
                SQL-accuracy evaluator. The architecture is modular, allowing
                these components to be easily replaced. It’s easy to set up and
                use with major data warehouses.
              </p>
              <p>
                There is a “Context Store” where information (NL2SQL examples,
                schemas and table descriptions) is used for the LLM prompts to
                make the engine get better with usage. And we even made it fast!
              </p>
              <p>
                This version allows you to easily connect to PG, Databricks,
                BigQuery or Snowflake and set up an API for semantic
                interactions with your structured data. You can then add
                business and data context that are used for few-shot prompting
                by the engine.
              </p>
              <p>
                The NL-to-SQL agent in this open source release was developed by
                our own Mohammadreza Pourreza, whose DIN-SQL algorithm is
                currently top of the Spider (<a
                  href="https://yale-lily.github.io/spider"
                  >https://yale-lily.github.io/spider</a
                >) and Bird (<a href="https://bird-bench.github.io/"
                  >https://bird-bench.github.io/</a
                >) NL 2 SQL benchmarks. This agent has outperformed the
                Langchain SQLAgent anywhere from 12%-250%.5x (depending on the
                provided context) in our own internal benchmarking while being
                only ~15s slower on average.
              </p>
              <p>
                Needless to say, this is an early release and the codebase is
                under swift development. We would love for you to try it out and
                give us your feedback! And if you are interested in
                contributing, we’d love to hear from you!
              </p>
            </div>
          </section>
        </section>
        <section id="37238254">
          <h3>
            <a class="item" href="https://seaglass.cs.washington.edu/"
              >SeaGlass: City-Wide IMSI-Catcher Detection (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 16:12:27</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37238254"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37237583">
          <h3>
            <a class="item" href="https://generated.photos/human-generator/"
              >AI real-time human full-body photo generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 15:28:45</span
              ><span class="points-container"
                >Points: <span class="points">653</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37237583"
                  >Comments</a
                ><span class="descendants">: 328</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37232626">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Resistor%E2%80%93transistor_logic"
              >Resistor–transistor logic</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 06:51:04</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37232626"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37231276">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/08/21/well/live/screen-apnea-breathing.html"
              >'Screen Apnea'</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 02:42:18</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37231276"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37227606">
          <h3>
            <a
              class="item"
              href="https://attainablefelicity.mattkirkland.com/20230822/Sketchbooks.html"
              >On keeping sketchbooks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-22 @ 19:42:08</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37227606"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37224042">
          <h3>
            <a
              class="item"
              href="https://rosenzweig.io/blog/first-conformant-m1-gpu-driver.html"
              >The first conformant M1 GPU driver</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-22 @ 15:23:09</span
              ><span class="points-container"
                >Points: <span class="points">1537</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37224042"
                  >Comments</a
                ><span class="descendants">: 636</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37216702">
          <h3>
            <a
              class="item"
              href="https://www.embopress.org/doi/full/10.15252/msb.202211325"
              >Automated assembly – molecular mechanisms from text mining and
              curated databases</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 23:28:12</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37216702"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37216489">
          <h3>
            <a
              class="item"
              href="https://blogs.oracle.com/javamagazine/post/java-array-objects"
              >Inside the JVM: Arrays</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 22:58:59</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37216489"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37216455">
          <h3>
            <a
              class="item"
              href="https://www.abortretry.fail/p/the-history-of-windows-20"
              >The History of Windows 2.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 22:55:25</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37216455"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37216412">
          <h3>
            <a class="item" href="https://if50.substack.com/p/the-antagonists"
              >The Antagonists: The rise and fall of type-in text games</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 22:51:25</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37216412"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37215331">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2308.08401"
              >The Simplest Walking Robot: A bipedal robot with 1 actuator and 2
              rigid bodies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 21:03:13</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37215331"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37214742">
          <h3>
            <a class="item" href="https://rameshvarun.github.io/blog-cells/"
              >Blog-cells: Interactive code cells for static sites</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 20:13:09</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37214742"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37214693">
          <h3>
            <a
              class="item"
              href="https://www.advancedsciencenews.com/time-ran-slowly-in-the-early-universe-just-as-einstein-predicted/"
              >Cosmological time dilation in the early Universe</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-21 @ 20:09:20</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37214693"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
