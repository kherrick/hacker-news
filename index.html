<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43647812">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/ABoringDystopia/comments/1jw34qx/attorney_representing_a_student_protester/"
              >Attorney representing a student protester detained by federal
              immigration agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 20:37:21</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43647812"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43647716">
          <h3>
            <a class="item" href="https://peps.python.org/pep-0750/"
              >PEP 750 â€“ Template Strings (t-strings) have been accepted</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 20:24:01</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43647716"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43647598">
          <h3>
            <a
              class="item"
              href="https://bobbiechen.com/blog/2022/7/21/what-if-your-website-had-business-hours"
              >What if your website had business hours? (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 20:09:23</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43647598"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43647294">
          <h3>
            <a
              class="item"
              href="https://www.muppetlabs.com/~breadbox/txt/mopb.html"
              >My Own Private Binary: An Idiosyncratic Introduction to Linux
              Kernel Modules</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 19:29:46</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43647294"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43647237">
          <h3>
            <a
              class="item"
              href="https://actu.epfl.ch/news/trustworthy-ai-without-trusted-data/"
              >Trustworthy AI Without Trusted Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 19:24:25</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43647237"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646698">
          <h3>
            <a
              class="item"
              href="https://crocidb.com/post/kernel-adventures/demystifying-the-shebang/"
              >Demystifying the (Shebang): Kernel Adventures</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 18:21:45</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646698"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646601">
          <h3>
            <a
              class="item"
              href="http://nathanmarz.com/blog/suffering-oriented-programming.html"
              >Suffering-Oriented Programming (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 18:11:34</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646601"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646466">
          <h3>
            <a
              class="item"
              href="https://machinelearning.apple.com/research/transporting-activations"
              >Controlling Language and Diffusion Models by Transporting
              Activations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 17:58:02</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646466"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646219">
          <h3>
            <a class="item" href="https://www.bigbookofr.com/">Big Book of R</a>
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 17:34:19</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646219"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646095">
          <h3>
            <a class="item" href="https://garfieldminusgarfield.net"
              >Garfield Minus Garfield</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 17:21:03</span
              ><span class="points-container"
                >Points: <span class="points">359</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646095"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43645901">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/legion-health/jobs/mqDWIWN-founding-engineer-build-ai-native-ops-for-mental-health-yc-s21-1m-arr"
              >Legion Health (YC S21) is hiring engineers to rebuild psychiatry
              with AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 17:01:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43645331">
          <h3>
            <a
              class="item"
              href="https://news.blueshieldca.com/notice-of-data-breach"
              >Blue Shield Data Breach (Google Ads)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 16:09:12</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43645331"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43645183">
          <h3>
            <a
              class="item"
              href="https://macintoshgarden.org/apps/sdl2-macos-9-rough-draft"
              >SDL2 for macOS 9 "rough draft"</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 15:54:50</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43645183"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43644966">
          <h3>
            <a
              class="item"
              href="https://www.qualcomm.com/developer/blog/2025/04/eld-new-open-source-embedded-linker-tool-for-embedded-systems"
              >ELD: A new open-source embedded linker tool for embedded
              systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 15:34:45</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43644966"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43644351">
          <h3>
            <a class="item" href="https://koreo.dev/"
              >Show HN: Koreo â€“ The platform engineering toolkit for
              Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 14:48:20</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43644351"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p>
                As a result, we ended up building something that's sort of a
                "meta-controller programming language" on top of Kubernetes
                called Koreo. It provides a solution for configuration
                management and resource orchestration in Kubernetes by basically
                letting you program controllers. We've been using Koreo for a
                while now to build internal developer platform capabilities for
                our commercial product and our clients, and we recently open
                sourced it to share it with the community.
              </p>
              <p>
                Koreo has some similarities to configuration languages like KCL,
                Jsonnet, etc. since it is a means of configuration management
                (e.g. you can define base configurations, apply overlays, point
                patches, and so forth). Where it really diverges though is Koreo
                provides a unified approach to config management
                <i>and</i> resource orchestration. This means you can start to
                treat Kubernetes resources as "legos" to build pretty
                sophisticated workflows. For instance, the output of a resource
                can be used as the input to another resource. This isn't really
                possible with Helm, even with `lookup` because `lookup` requires
                the resource to already be in-cluster in order to reference it.
              </p>
              <p>
                This is why we refer to Koreo as a meta-controller programming
                language because it effectively lets you program and compose
                Kubernetes controllers into cohesive platformsâ€”either built-in
                controllers (think Deployment or StatefulSet), off-the-shelf
                ones such as AWS ACK or GCP's Config Connector, or custom
                operators. It lets you build or combine controllers without
                actually needing to implement an operator. Through this lens,
                Koreo is really more akin to Crossplane but without some of the
                limitations such as Providers and cluster-scoped managed
                resources.
              </p>
              <p>
                It seems crazy and maybe it is, but I've found working in Koreo
                to actually be surprisingly fun since it kind of turns
                Kubernetes primitives into legos you can easily piece together,
                reuse, and build some pretty cool automated workflows. You can
                learn more about the motivation and thinking behind it here:
                <a href="https://theyamlengineer.com"
                  >https://theyamlengineer.com</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43644179">
          <h3>
            <a
              class="item"
              href="https://www.openculture.com/2025/04/isaac-asimov-describes-how-ai-will-liberate-humans-their-creativity.html"
              >Isaac Asimov describes how AI will liberate humans and their
              creativity (1992)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 14:30:54</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43644179"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43643968">
          <h3>
            <a
              class="item"
              href="https://www.arroyo.dev/blog/arroyo-is-joining-cloudflare"
              >Arroyo (YC W23) has been acquired by Cloudflare</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 14:12:44</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43643968"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43643886">
          <h3>
            <a
              class="item"
              href="https://developers.redhat.com/articles/2025/04/10/6-usability-improvements-gcc-15"
              >Usability Improvements in GCC 15</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 14:03:54</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43643886"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43643534">
          <h3><a class="item" href="https://busy.bar">Busy Bar</a></h3>
          <section>
            <h4>
              <span>2025-04-10 @ 13:23:58</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43643534"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43643343">
          <h3>
            <a
              class="item"
              href="https://emilygorcenski.com/post/owning-my-own-data-part-1-integrating-a-self-hosted-calendar-solution/"
              >Owning my own data, part 1: Integrating a self-hosted calendar
              solution</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 12:59:54</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43643343"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43643292">
          <h3>
            <a
              class="item"
              href="https://susam.net/elliptical-python-programming.html"
              >Elliptical Python Programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 12:53:56</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43643292"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43642123">
          <h3>
            <a class="item" href="https://susam.net/hn-bell.html"
              >Hacker News Hug of Deaf</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 09:09:03</span
              ><span class="points-container"
                >Points: <span class="points">391</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43642123"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43641469">
          <h3>
            <a
              class="item"
              href="http://www.modelshipsinthecinema.com/2016/12/hunt-for-red-october-1990.html"
              >Hunt for Red October 1990 (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 07:11:37</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43641469"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43639642">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/blog/products/storage-data-transfer/how-the-colossus-stateful-protocol-benefits-rapid-storage"
              >Colossus for Rapid Storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 01:05:30</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43639642"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
            <div class="text">
              Was at the Google Next 2025 conference, and they've unveiled a
              zonal bucket version of GCS and what seems to be a gPRC interface
              over Google Colossus for Rapid Storage.
            </div>
          </section>
        </section>
        <section id="43619884">
          <h3>
            <a class="item" href="https://github.com/koaning/smartfunc"
              >smartfunc: Turn Docstrings into LLM-Functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-08 @ 09:43:11</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43619884"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43619437">
          <h3>
            <a
              class="item"
              href="https://p.bauherren.ovh/blog/tech/new_window_cmds"
              >Native frame transposition coming to Emacs 31</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-08 @ 08:10:06</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43619437"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43616649">
          <h3>
            <a class="item" href="https://jpfennell.com/posts/enum-type-size/"
              >A surprising enum size optimization in the Rust compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-07 @ 22:30:45</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43616649"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43610566">
          <h3>
            <a
              class="item"
              href="https://tigerbeetle.com/blog/2025-02-27-why-we-designed-tigerbeetles-docs-from-scratch/"
              >We Designed TigerBeetle's Docs from Scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-07 @ 12:35:03</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43610566"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43609468">
          <h3>
            <a class="item" href="https://queue.acm.org/detail.cfm?id=2169076"
              >Your Mouse Is a Database (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-07 @ 09:27:44</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43609468"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43608555">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Messier_marathon"
              >Messier Marathon</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-07 @ 06:51:51</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43608555"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
