<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37121180">
          <h3>
            <a
              class="item"
              href="https://abseil.io/resources/swe-book/html/toc.html"
              >Software Engineering at Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 14:06:09</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37121180"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37120982">
          <h3>
            <a
              class="item"
              href="https://www.thediff.co/archive/inside-the-decline-of-stack-exchange/"
              >Inside The Decline of Stack Exchange</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 13:48:53</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37120982"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37120967">
          <h3>
            <a
              class="item"
              href="https://claytonwramsey.github.io/2023/08/14/dumpster.html"
              >I built a garbage collector for a language that doesn't need
              one</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 13:48:02</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37120967"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37120911">
          <h3>
            <a
              class="item"
              href="https://badsoftwareadvice.substack.com/p/how-to-run-a-miserable-code-review"
              >How to run a miserable code review</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 13:42:32</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37120911"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37120874">
          <h3>
            <a class="item" href="https://emiruz.com/post/2023-08-12-data-jobs/"
              >Analysis of the data job market using HN job posts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 13:36:30</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37120874"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37120758">
          <h3>
            <a
              class="item"
              href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3114154/"
              >Positive association between altitude and suicide in U.S.
              counties</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 13:23:01</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37120758"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37120715">
          <h3>
            <a class="item" href="https://www.svix.com/careers/"
              >Svix (YC W21) Is Hiring a Founding Account Executive (US
              Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 13:19:15</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37120697">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/08/14/def_con_roundup/"
              >Bomb threat causes mass evacuation at DEF CON hacking
              convention</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 13:17:19</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37120697"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37120372">
          <h3>
            <a
              class="item"
              href="https://admiralcloudberg.medium.com/tears-in-the-rain-the-2002-%C3%BCberlingen-midair-collision-591232d0c51e"
              >The 2002 Überlingen midair collision</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 12:41:33</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37120372"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37120350">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2023/08/14/1193676139/newspaper-marion-county-kansas-police-raid-first-amendment"
              >Police raid of a Kansas newsroom raises alarms about violations
              of press freedom</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 12:38:47</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37120350"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37120093">
          <h3>
            <a class="item" href="https://chatwith.tools"
              >Show HN: A website chatbot that also uses APIs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 12:08:46</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37120093"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                I have realized that there's an untapped potential for ChatGPT
                plugins: why leave them locked up in the OpenAI store? Let's
                embed them on websites or share using links!
              </p>
              <p>
                Let's make chatbots ~ do stuff ~, not just talk about what they
                know.
              </p>
              <p>
                That's how Chatwith was born. It is a chat widget, it scrapes
                your website, knowledge page, notion etc - but more importantly,
                it also understands your API. It can interact with that API on
                your or your visitors' behalf.
              </p>
              <p>Some use cases &amp; ideas:</p>
              <p>- Shopify bot - ask it for order status and invoice</p>
              <p>- Realtor - ask for budget, provide listings</p>
              <p>
                - Survey - ask questions, collect answers, submit to Typeform
              </p>
              <p>- Airline service - get your boarding pass</p>
              <p>- Mixpanel - talk to your analytics</p>
              <p>In other words:</p>
              <p>- Talk to APIs &amp; hot data</p>
              <p>- ChatGPT plugin on every website</p>
              <p>- Your SaaS can be a chatbot</p>
              <p>
                - APIs made accessible (they were reserved for devs until now)
              </p>
              <p>
                - Create an API, use chat as the interface - skip the frontend
              </p>
              <p>
                I am trying to envision a future where website visitors are
                empowered to just say what they want from the business - instead
                of navigating endless dashboards and documentation.
              </p>
              <p>I'm looking for some feedback about my product! lmk</p>
              <p>Rafal</p>
            </div>
          </section>
        </section>
        <section id="37119942">
          <h3>
            <a class="item" href="https://github.com/dnakov/little-rat"
              >Show HN: Little Rat – Chrome extension monitors network calls of
              all extensions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 11:49:59</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37119942"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                I needed a way to monitor network calls made by chrome
                extensions so I made a small extension.
              </p>
              <p>
                You can install it by dropping the zip or crx into the
                extensions page. It'll be on the chrome store whenever/if it
                gets through the review.
              </p>
              <p>Hopefully it's useful to others.</p>
              <p>
                <a href="https://github.com/dnakov/little-rat"
                  >https://github.com/dnakov/little-rat</a
                >
              </p>
              <p>
                <a href="https://twitter.com/dnak0v"
                  >https://twitter.com/dnak0v</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37119311">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37119311"
              >Launch HN: Serra (YC S23) – Open-source, Python-based dbt
              alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 10:13:16</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37119311"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/Serra-Technologies/serra"
                >https://github.com/Serra-Technologies/serra</a
              >, and our docs are here:
              <a href="https://docs.serra.io/documentation/"
                >https://docs.serra.io/documentation/</a
              >.
              <p>
                I stumbled into this idea as a data engineer for Disney+’s
                subscriptions team. We were “firefighters for data,” ready to
                debug huge pipelines that always crashed and burned. The worst
                part of my job at Disney+ was the graveyard on-call rotations,
                where pagers from 12am to 5am were guaranteed, and you'd have to
                dig through thousands of lines of someone else’s SQL. SQL is
                long-winded—1000 lines of SQL can often be summarized with 10
                key transforms. We take this SQL and summarize those transforms
                with reusable, testable, scalable Spark objects.
              </p>
              <p>
                Serra is written in PySpark and modularizes every component of
                ETL through Spark objects. Similar to dbt, we apply software
                engineering best practices to data, but we aim to do it not just
                with transformations, but with data connectors as well. We
                accomplish this with a configuration YAML file—the idea is if we
                have a pipeline with said 1000 line SQL script that is using
                third-party connectors, we can summarize all of this into a
                12-block config file that gives easy high-level overhead and
                debugging capabilities—10 blocks for the transforms and 2 for
                the in-house connectors. Then, we can add tests and custom
                alerts to each of these objects/blocks so that we know where
                exactly the pipeline breaks and why.
              </p>
              <p>
                We are open-source to make it easy to customize Serra to
                whatever flavor you like with custom transformers/connectors.
                The connectors we support OOB are Snowflake, AWS, BigQuery, and
                Databricks and are adding more based on feedback. The transforms
                we support include mapping, pivoting, joining, truncating,
                imputing, and more. We’re doing our best to make Serra as easy
                to use as possible. If you have docker installed, you can run
                this docker command to instantly get setup with a Serra
                environment to create modular pipelines.
              </p>
              <p>
                We wrap up our functionality with a command line tool that lets
                you: - create your ETL pipelines, test them locally with a
                subset of your data, and deploy them to the cloud (currently we
                only support Databricks, but will soon support others and plan
                to host our own clusters too). It also has an experimental
                “translate” feature which is still a bit finicky, but the idea
                is to take your existing SQL script and get suggestions on how
                you can chunk up and modularize your job with our config. It’s
                still just a super early suggestion feature that is definitely
                not fleshed out, but we think it’s a cool approach.
              </p>
              <p>
                Here’s a quick demo going through retooling a long-winded SQL
                script to an easily maintainable, scalable ETL job:
                <a
                  href="https://www.loom.com/share/acc633c0ec03455e9e8837f5c3db3165?sid=341c529c-1c4a-41b2-85c4-ca8589ff965a"
                  >https://www.loom.com/share/acc633c0ec03455e9e8837f5c3db3165?...</a
                >. (docker command: docker run --mount
                type=bind,source="$(pwd)",target=/app -it serraio/serra
                /bin/bash)
              </p>
              <p>
                We don’t see or store any of your data—we’re a transit layer
                that helps you write ETL jobs that you can send to your
                warehouse of choice with your actual data. Right now we are
                helping customers retool their messy data pipelines and plan to
                monetize by hosting Serra on the cloud, charging if you run the
                job on our own clusters, and per API call on our translate
                feature (once it’s mature).
              </p>
              <p>
                We’re super excited to launch this to Hacker News. We’d love to
                hear what you think. Thanks in advance!
              </p>
            </div>
          </section>
        </section>
        <section id="37118983">
          <h3>
            <a
              class="item"
              href="https://marcochiappetta.medium.com/yes-you-should-test-on-production-61f6dc61908b"
              >Testing on production</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 09:14:04</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118983"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118883">
          <h3>
            <a class="item" href="https://addyosmani.com/blog/write-learn/"
              >Writing about what you learn pushes you to understand topics
              better</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 08:58:03</span
              ><span class="points-container"
                >Points: <span class="points">360</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118883"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118633">
          <h3>
            <a class="item" href="https://joaodlf.com/python-just-write-sql"
              >Python: Just Write SQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 08:14:43</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118633"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118344">
          <h3>
            <a class="item" href="http://electrotechnique.cc/Momentum.html"
              >Momentum, a DIY 12-voice virtual analogue polyphonic synthesizer
              based on TSynth</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 07:18:44</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118344"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118124">
          <h3>
            <a class="item" href="https://veilid.com/"
              >Veilid is an open-source, P2P, mobile-ﬁrst, networked application
              framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 06:32:47</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118124"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118114">
          <h3>
            <a
              class="item"
              href="https://astronomy.stackexchange.com/questions/36488/is-venus-in-some-way-tidally-locked-to-earth"
              >Is Venus in some way tidally locked to Earth? (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 06:31:13</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118114"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118098">
          <h3>
            <a
              class="item"
              href="https://www.m31coding.com/blog/semantic-reviews.html"
              >Semantic Code Reviews – Simple and direct comments without
              drama</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 06:29:02</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118098"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118081">
          <h3>
            <a
              class="item"
              href="https://pixelfed.blog/p/2023/feature/autospam-and-naive-bayes-the-grandfather-of-spam-filters-still-making-waves"
              >Fediverse and Naive Bayes: The Grandfather of Spam Filters Still
              Making Waves</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 06:25:04</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118081"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37117338">
          <h3>
            <a
              class="item"
              href="https://blog.0x7d0.dev/history/how-they-bypass-youtube-video-download-throttling/"
              >Bypassing YouTube video download throttling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 04:02:58</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37117338"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37117291">
          <h3>
            <a
              class="item"
              href="https://rcrowley.org/2010/01/06/things-unix-can-do-atomically.html"
              >Things Unix can do atomically (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 03:53:17</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37117291"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37116487">
          <h3>
            <a class="item" href="https://apenwarr.ca/log/20170810"
              >The world in which IPv6 was a good design (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 01:38:43</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37116487"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37115626">
          <h3>
            <a
              class="item"
              href="https://plbrault.com/blog-posts/i-created-the-nerdierst-game-ever-en/"
              >A video game where you are an operating system</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 23:21:31</span
              ><span class="points-container"
                >Points: <span class="points">543</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37115626"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37112741">
          <h3>
            <a class="item" href="https://github.com/microsoft/azurechatgpt"
              >Azure ChatGPT: Private and secure ChatGPT for internal enterprise
              use</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 18:35:15</span
              ><span class="points-container"
                >Points: <span class="points">811</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37112741"
                  >Comments</a
                ><span class="descendants">: 288</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37111867">
          <h3>
            <a
              class="item"
              href="https://blog.gingerbeardman.com/2023/08/13/automatically-classifying-the-content-of-sound-files-using-ml/"
              >Automatically classifying the content of sound files using ML</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 17:11:37</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37111867"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37111063">
          <h3>
            <a
              class="item"
              href="https://www.britishmuseum.org/blog/long-live-king-kings-accession-ritual-ancient-persia"
              >Long live the King of Kings Accession ritual in ancient Persia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 15:51:59</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37111063"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37108833">
          <h3>
            <a
              class="item"
              href="https://www.bitecode.dev/p/nobody-ever-paid-me-for-code"
              >Nobody ever paid me for code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 11:17:45</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37108833"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37096991">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/risky-giant-steps-can-solve-optimization-problems-faster-20230811/"
              >Risky Giant Steps Can Solve Optimization Problems Faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-12 @ 04:15:31</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37096991"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
