<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37119790">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/08/14/world/americas/argentina-javier-milei-president-primary.html"
              >Argentina voted no on the Argentinian peso. USD will become its
              new currency</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 11:30:14</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37119790"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37119370">
          <h3>
            <a class="item" href="http://cr.yp.to/djbdns/ipv6mess.html"
              >D J Bernstein – The IPv6 mess</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 10:23:20</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37119370"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37119311">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37119311"
              >Launch HN: Serra (YC S23) – Open-source, Python-based dbt
              alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 10:13:16</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37119311"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/Serra-Technologies/serra"
                >https://github.com/Serra-Technologies/serra</a
              >, and our docs are here:
              <a href="https://docs.serra.io/documentation/"
                >https://docs.serra.io/documentation/</a
              >.
              <p>
                I stumbled into this idea as a data engineer for Disney+’s
                subscriptions team. We were “firefighters for data,” ready to
                debug huge pipelines that always crashed and burned. The worst
                part of my job at Disney+ was the graveyard on-call rotations,
                where pagers from 12am to 5am were guaranteed, and you'd have to
                dig through thousands of lines of someone else’s SQL. SQL is
                long-winded—1000 lines of SQL can often be summarized with 10
                key transforms. We take this SQL and summarize those transforms
                with reusable, testable, scalable Spark objects.
              </p>
              <p>
                Serra is written in PySpark and modularizes every component of
                ETL through Spark objects. Similar to dbt, we apply software
                engineering best practices to data, but we aim to do it not just
                with transformations, but with data connectors as well. We
                accomplish this with a configuration YAML file—the idea is if we
                have a pipeline with said 1000 line SQL script that is using
                third-party connectors, we can summarize all of this into a
                12-block config file that gives easy high-level overhead and
                debugging capabilities—10 blocks for the transforms and 2 for
                the in-house connectors. Then, we can add tests and custom
                alerts to each of these objects/blocks so that we know where
                exactly the pipeline breaks and why.
              </p>
              <p>
                We are open-source to make it easy to customize Serra to
                whatever flavor you like with custom transformers/connectors.
                The connectors we support OOB are Snowflake, AWS, BigQuery, and
                Databricks and are adding more based on feedback. The transforms
                we support include mapping, pivoting, joining, truncating,
                imputing, and more. We’re doing our best to make Serra as easy
                to use as possible. If you have docker installed, you can run
                this docker command to instantly get setup with a Serra
                environment to create modular pipelines.
              </p>
              <p>
                We wrap up our functionality with a command line tool that lets
                you: - create your ETL pipelines, test them locally with a
                subset of your data, and deploy them to the cloud (currently we
                only support Databricks, but will soon support others and plan
                to host our own clusters too). It also has an experimental
                “translate” feature which is still a bit finicky, but the idea
                is to take your existing SQL script and get suggestions on how
                you can chunk up and modularize your job with our config. It’s
                still just a super early suggestion feature that is definitely
                not fleshed out, but we think it’s a cool approach.
              </p>
              <p>
                Here’s a quick demo going through retooling a long-winded SQL
                script to an easily maintainable, scalable ETL job:
                <a
                  href="https://www.loom.com/share/acc633c0ec03455e9e8837f5c3db3165?sid=341c529c-1c4a-41b2-85c4-ca8589ff965a"
                  >https://www.loom.com/share/acc633c0ec03455e9e8837f5c3db3165?...</a
                >. (docker command: docker run --mount
                type=bind,source="$(pwd)",target=/app -it serraio/serra
                /bin/bash)
              </p>
              <p>
                We don’t see or store any of your data—we’re a transit layer
                that helps you write ETL jobs that you can send to your
                warehouse of choice with your actual data. Right now we are
                helping customers retool their messy data pipelines and plan to
                monetize by hosting Serra on the cloud, charging if you run the
                job on our own clusters, and per API call on our translate
                feature (once it’s mature).
              </p>
              <p>
                We’re super excited to launch this to Hacker News. We’d love to
                hear what you think. Thanks in advance!
              </p>
            </div>
          </section>
        </section>
        <section id="37118983">
          <h3>
            <a
              class="item"
              href="https://marcochiappetta.medium.com/yes-you-should-test-on-production-61f6dc61908b"
              >“Yes, you should test on production” – Why developer experience
              matters</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 09:14:04</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118983"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118883">
          <h3>
            <a class="item" href="https://addyosmani.com/blog/write-learn/"
              >Write about what you learn. It pushes you to understand topics
              better</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 08:58:03</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118883"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118633">
          <h3>
            <a class="item" href="https://joaodlf.com/python-just-write-sql"
              >Python: Just Write SQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 08:14:43</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118633"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118452">
          <h3>
            <a class="item" href="https://www.jjj.de/fxt/fxtbook.pdf"
              >Matters Computational – Ideas, Algorithms, Source Code [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 07:42:08</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118452"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118344">
          <h3>
            <a class="item" href="http://electrotechnique.cc/Momentum.html"
              >Momentum, a DIY 12-voice virtual analogue polyphonic synthesizer
              based on TSynth</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 07:18:44</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118344"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118124">
          <h3>
            <a class="item" href="https://veilid.com/"
              >Veilid is an open-source, P2P, mobile-ﬁrst, networked application
              framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 06:32:47</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118124"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118114">
          <h3>
            <a
              class="item"
              href="https://astronomy.stackexchange.com/questions/36488/is-venus-in-some-way-tidally-locked-to-earth"
              >Is Venus in some way tidally locked to Earth? (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 06:31:13</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118114"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118098">
          <h3>
            <a
              class="item"
              href="https://www.m31coding.com/blog/semantic-reviews.html"
              >Semantic Code Reviews – Simple and direct comments without
              drama</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 06:29:02</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118098"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118081">
          <h3>
            <a
              class="item"
              href="https://pixelfed.blog/p/2023/feature/autospam-and-naive-bayes-the-grandfather-of-spam-filters-still-making-waves"
              >Fediverse and Naive Bayes: The Grandfather of Spam Filters Still
              Making Waves</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 06:25:04</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118081"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37117338">
          <h3>
            <a
              class="item"
              href="https://blog.0x7d0.dev/history/how-they-bypass-youtube-video-download-throttling/"
              >Bypassing YouTube video download throttling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 04:02:58</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37117338"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37117291">
          <h3>
            <a
              class="item"
              href="https://rcrowley.org/2010/01/06/things-unix-can-do-atomically.html"
              >Things Unix can do atomically (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 03:53:17</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37117291"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37116831">
          <h3>
            <a
              class="item"
              href="https://www.asymptotejournal.com/blog/2023/08/09/the-dance-of-siva/"
              >The Dance of Śiva</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 02:32:40</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37116831"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37116539">
          <h3>
            <a
              class="item"
              href="https://jitsi.org/blog/introducing-the-jitsi-meet-flutter-sdk/"
              >Jitsi Meet Flutter SDK</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 01:47:50</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37116539"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37116487">
          <h3>
            <a class="item" href="https://apenwarr.ca/log/20170810"
              >The world in which IPv6 was a good design (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 01:38:43</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37116487"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37116353">
          <h3>
            <a
              class="item"
              href="https://python.langchain.com/docs/use_cases/agent_simulations/two_player_dnd"
              >LangChain Agent Simulation – Multi-Player Dungeons and Dragons</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 01:15:22</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37116353"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37115626">
          <h3>
            <a
              class="item"
              href="https://plbrault.com/blog-posts/i-created-the-nerdierst-game-ever-en/"
              >A video game where you are an operating system</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 23:21:31</span
              ><span class="points-container"
                >Points: <span class="points">472</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37115626"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37114976">
          <h3>
            <a
              class="item"
              href="http://blog.ezyang.com/2013/05/the-ast-typing-problem/"
              >The AST Typing Problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 22:00:21</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37114976"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37114457">
          <h3>
            <a
              class="item"
              href="https://korban.net/posts/2023-08-11-thoughts-on-elixir-phoenix-liveview/"
              >Thoughts on Elixir, Phoenix and LiveView after 18 months of
              commercial use</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 21:03:53</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37114457"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37114141">
          <h3>
            <a class="item" href="https://github.com/spandanb/learndb-py"
              >Show HN: I wrote a RDBMS (SQLite clone) from scratch in pure
              Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 20:32:11</span
              ><span class="points-container"
                >Points: <span class="points">319</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37114141"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
            <div class="text">
              I wrote a relational database management system (RDBMS) (sqlite
              clone) from scratch in pure Python.
            </div>
          </section>
        </section>
        <section id="37113307">
          <h3>
            <a
              class="item"
              href="https://cohost.org/mcc/post/59045-mi-kama-sona-e-toki"
              >Toki Pona: an attempted universal language with only ~120
              words</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 19:20:52</span
              ><span class="points-container"
                >Points: <span class="points">423</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37113307"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37112741">
          <h3>
            <a class="item" href="https://github.com/microsoft/azurechatgpt"
              >Azure ChatGPT: Private and secure ChatGPT for internal enterprise
              use</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 18:35:15</span
              ><span class="points-container"
                >Points: <span class="points">773</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37112741"
                  >Comments</a
                ><span class="descendants">: 278</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37110648">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/08/05/upshot/darts-sports-perfection.html"
              >Studying the Limits of Human Perfection, Through Darts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 15:03:02</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37110648"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37109017">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/blog/ask-yc-upfront-technical-investments"
              >The Wizard of Oz Approach (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 11:50:48</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37109017"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37108833">
          <h3>
            <a
              class="item"
              href="https://www.bitecode.dev/p/nobody-ever-paid-me-for-code"
              >Nobody ever paid me for code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 11:17:45</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37108833"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37108624">
          <h3>
            <a
              class="item"
              href="https://blog.42yeah.is/rendering/2023/08/12/luapt.html"
              >Writing a Pathtracer in Lua, Week 1</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 10:43:28</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37108624"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37108153">
          <h3>
            <a
              class="item"
              href="https://gieskes.nl/undefined/prepared-gameboy/?f=leach"
              >Gameboy Leach</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-13 @ 09:22:06</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37108153"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37096991">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/risky-giant-steps-can-solve-optimization-problems-faster-20230811/"
              >Risky Giant Steps Can Solve Optimization Problems Faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-12 @ 04:15:31</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37096991"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
