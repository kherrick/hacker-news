<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39273406">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2024/02/06/1228720142/michael-mann-climate-scientist-in-court-suing-for-defamation"
              >A famous climate scientist is in court, with big stakes for
              attacks on science</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 12:13:12</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39273406"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39273380">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/ai/2024/02/mastering-music-is-hard-can-one-click-ai-make-it-easy/"
              >AI can now master your music</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 12:09:04</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39273380"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39273327">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/lago/jobs/zEAkwhK-solution-engineer-post-sales"
              >Lago: Open-Source Alternative to Stripe Is Hiring a Solution
              Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 12:00:42</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39272953">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39272953"
              >Ask HN: Looking for lightweight personal blogging platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 10:51:47</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39272953"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p>
                Bonus points - be able to personalise a little bit the look and
                feel if I wanted to e.g. font
              </p>
              <p>No need for: - comments on blog posts</p>
              <p>What are my options?</p>
            </div>
          </section>
        </section>
        <section id="39272952">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/TrackingMachineImportance"
              >We might want to regularly keep track of how important each
              server is</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 10:51:37</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39272952"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39272884">
          <h3>
            <a
              class="item"
              href="https://spaceweatherarchive.com/2024/02/01/will-satellite-megaconstellations-weaken-earths-magnetic-field/"
              >Will Satellite Megaconstellations Weaken Earth's Magnetic
              Field?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 10:40:05</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39272884"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39272301">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/02/05/climate/global-warming-sponges.html"
              >Six Spongy Sea Creatures Suggest Warming Might Be Worse Than
              Thought</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 08:50:00</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39272301"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39272278">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/02/12/a-teens-fatal-plunge-into-the-london-underworld"
              >A Teen's Fatal Plunge into the London Underworld</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 08:45:48</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39272278"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39270681">
          <h3>
            <a
              class="item"
              href="https://www.tbray.org/ongoing/When/202x/2024/02/02/Vision-1993"
              >Vision 1993</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 04:09:58</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39270681"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39269949">
          <h3>
            <a
              class="item"
              href="https://news.itsfoss.com/servo-rust-web-engine/"
              >Mozilla's Abandoned Web Engine 'Servo' Project Is Getting a
              Well-Deserved Reboot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 02:14:46</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39269949"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39269497">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/it-s-insane-new-viruslike-entities-found-human-gut-microbes"
              >New viruslike entities found in human gut microbes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 01:10:41</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39269497"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39268530">
          <h3>
            <a
              class="item"
              href="https://mina.naguib.ca/blog/2012/10/22/the-little-ssh-that-sometimes-couldnt.html"
              >The little SSH that sometimes couldn't (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 23:14:51</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39268530"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39268439">
          <h3>
            <a class="item" href="https://www.namethatnation.com/"
              >Show HN: Name That Nation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 23:04:17</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39268439"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
            <div class="text">
              I made this map game. react, material ui, hosted on vercel cdn, no
              back end.
            </div>
          </section>
        </section>
        <section id="39268106">
          <h3>
            <a
              class="item"
              href="https://eos.org/articles/weve-already-seen-category-6-hurricanes-now-scientists-want-to-make-it-official"
              >We've already seen category 6 hurricanes – scientists want to
              make it official</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 22:27:08</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39268106"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39266396">
          <h3>
            <a class="item" href="https://dmytry.github.io/space/"
              >Relativistic Spaceship</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 20:07:47</span
              ><span class="points-container"
                >Points: <span class="points">890</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39266396"
                  >Comments</a
                ><span class="descendants">: 399</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39264487">
          <h3>
            <a
              class="item"
              href="https://blog.peerdb.io/reducing-bigquery-costs-by-260x"
              >Reducing BigQuery Costs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 18:09:58</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39264487"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39263854">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39263854"
              >Show HN: Atopile – Design circuit boards with code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 17:30:50</span
              ><span class="points-container"
                >Points: <span class="points">536</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39263854"
                  >Comments</a
                ><span class="descendants">: 262</span></span
              >
            </h4>
            <div class="text">
              <a href="https://youtu.be/7-Q0XVpfW3Y"
                >https://youtu.be/7-Q0XVpfW3Y</a
              >
              <p>
                Could you imagine the pain of building an entire software
                product using only assembly code? That’s about how we felt
                designing hardware. We don’t currently have good ways to
                describe what we need, reuse existing designs and compile that
                description down to a product.
              </p>
              <p>
                We started atopile to fix this. atopile is an open-source
                language and toolchain to describe circuits with code. The
                compiler is here:
                <a href="https://github.com/atopile/atopile"
                  >https://github.com/atopile/atopile</a
                >
                Docs are here:
                <a href="https://atopile.io/getting-started/"
                  >https://atopile.io/getting-started/</a
                >
                . For a detailed deep dive designing an ESP32 module, see this
                video:
                <a href="https://youtu.be/eMWRwZOajdQ"
                  >https://youtu.be/eMWRwZOajdQ</a
                >
              </p>
              <p>
                We realized this was a problem in our previous jobs. Narayan and
                I (Tim) had to manually, draw and export all our electronic
                circuit boards. This lasted until our friend Matt, a software
                engineer, showed us his development workflow. All his projects
                were built, tested, and merged automatically via GitHub. So we
                asked: Can we build the same for hardware?
              </p>
              <p>
                We observed that the ability to abstract electronics effectively
                hinged on using a language to describe the requirements, so we
                came up with the “ato” language. In ato, you can break down
                circuits into modules, components and interfaces. You can nest
                and connect those blocks with each other. Here is an example
                with an RP2040 microcontroller:
              </p>
              <p></p>
              <pre><code>  import RP2040Kit from "rp2040/RP2040Kit.ato"
  import LEDIndicatorBlue from "generics/leds.ato"
  import LDOReg3V3 from "regulators/regulators.ato"
  import USBCConn from "usb-connectors/usb-connectors.ato"

  module Blinky:
    micro_controller = new RP2040Kit
    led_indicator = new LEDIndicatorBlue
    voltage_regulator = new LDOReg3V3
    usb_c_connector = new USBCConn

    usb_c_connector.power ~ voltage_regulator.power_in
    voltage_regulator.power_out ~ micro_controller.power
    micro_controller.gpio13 ~ led_indicator.input
    micro_controller.power.gnd ~ led_indicator.gnd

    led_indicator.resistor.value = 100ohm +/- 10%

</code></pre>
              From there, the compiler produces a netlist that describes how the
              circuit is connected and selects jelly-bean components for you (<a
                href="https://atopile.io/blog/2024/01/31/cloud-components/"
                >https://atopile.io/blog/2024/01/31/cloud-components/</a
              >). Our next focus will be to add layout reuse, mathematical
              relations between values and define circuits by traits (similar to
              Rusts’).
              <p>
                At the moment, atopile is intended to design all types of
                printed circuit boards (PCB) with low to medium complexity. The
                circuit complexity that the compiler can handle will steadily
                increase until it becomes suited for production usage. We often
                get asked if the compiler is meant for chip design rather than
                PCBs, but that is not the case. The language is exclusive to
                PCBs. At least for now..!
              </p>
              <p>
                A big part of why the software community is so prolific is
                thanks to open source and open core technology. The ability to
                share software packages with each other and efficiently chain
                tools together has made the software world an awesome place for
                developers. As hardware engineers, we would love our field to
                benefit from this as well. That’s why we’ve made atopile’s core
                open source (Apache 2.0). We plan to generate revenue by selling
                entreprise targeted features, similar to GitLab.
              </p>
              <p>
                We would love to have your thoughts on the compiler! What’s your
                story in electronics? What would you want us to build?
              </p>
            </div>
          </section>
        </section>
        <section id="39262650">
          <h3>
            <a
              class="item"
              href="https://www.linkedin.com/posts/richardsonalexis_hi-everyone-i-am-very-sad-to-announce-activity-7160295096825860096-ZS67"
              >Weaveworks is shutting down</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 16:06:50</span
              ><span class="points-container"
                >Points: <span class="points">256</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39262650"
                  >Comments</a
                ><span class="descendants">: 220</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39261861">
          <h3>
            <a class="item" href="https://scrollprize.org/grandprize"
              >Vesuvius Challenge 2023 Grand Prize awarded: we can read the
              first scroll</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 15:00:02</span
              ><span class="points-container"
                >Points: <span class="points">1154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39261861"
                  >Comments</a
                ><span class="descendants">: 182</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39261486">
          <h3>
            <a class="item" href="https://github.com/cfahlgren1/natural-sql"
              >Show HN: Natural-SQL-7B, a strong text-to-SQL model</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 14:22:36</span
              ><span class="points-container"
                >Points: <span class="points">325</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39261486"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
            <div class="text">
              <p>
                Here is the HF page:
                <a href="https://huggingface.co/chatdb/natural-sql-7b"
                  >https://huggingface.co/chatdb/natural-sql-7b</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39261268">
          <h3>
            <a
              class="item"
              href="https://ericniebler.com/2024/02/04/what-are-senders-good-for-anyway/"
              >What are senders good for, anyway?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 14:01:21</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39261268"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39250552">
          <h3>
            <a
              class="item"
              href="https://www.ecologyandsociety.org/vol26/iss2/art41/"
              >Mobile phones and wrong numbers: how Maasai form and use
              accidental social ties</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 14:45:43</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39250552"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39249677">
          <h3>
            <a
              class="item"
              href="https://linkedrecords.com/the-house-of-requirements-1fc98061c91b?gi=4d2290392952"
              >The House of Requirements</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 12:21:35</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39249677"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39249378">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/collectibles/bookfind-of-the-century-sells-for-2-23-million/"
              >"Bookfind of the century" sells for $2.23M</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 11:19:26</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39249378"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39249350">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/culture/2024/01/31/the-sothebys-trial-revealed-the-art-markets-unsavoury-practices"
              >The Sotheby's trial revealed the art market's unsavoury
              practices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 11:15:07</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39249350"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39249281">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/pdf/10.1145/322123.322134"
              >Concurrent Processes and Their Syntax (1979) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 11:02:45</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39249281"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39248364">
          <h3>
            <a
              class="item"
              href="https://www.engineersneedart.com/blog/dowdy/dowdy.html"
              >Tom Dowdy (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 07:32:22</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39248364"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39248292">
          <h3>
            <a
              class="item"
              href="https://silent-tower.net/projects/visual-overview-malloc"
              >Visual overview of a custom malloc() implementation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 07:11:54</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39248292"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39248110">
          <h3>
            <a
              class="item"
              href="https://haseebq.com/how-not-to-bomb-your-offer-negotiation/"
              >How not to bomb your offer negotiation (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 06:33:22</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39248110"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39243885">
          <h3>
            <a
              class="item"
              href="https://www.newscientist.com/article/2414826-dance-mat-style-game-helps-stop-older-people-falling/"
              >Dance mat-style game helps stop older people falling</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-03 @ 19:31:36</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39243885"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
