<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43364597">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/prequel/jobs/wdjx5KE-frontend-software-engineer"
              >Prequel (YC W21) Is Hiring a Strong Front End Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 17:00:21</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43364016">
          <h3>
            <a
              class="item"
              href="https://us.community.samsung.com/t5/Home-Theater/Samsung-Q990D-unresponsive-after-1020-firmware-update/td-p/3168571"
              >Samsung bricked their home theater systems through automated
              firmware update</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 16:10:04</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43364016"
                  >Comments</a
                ><span class="descendants">: 176</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43363918">
          <h3>
            <a
              class="item"
              href="https://blog.jacobstechtavern.com/p/building-a-2fa-app-that-detects-patterns"
              >The 2FA app that tells you when you get `314159` (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 16:00:06</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43363918"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43363499">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/games/2025/mar/11/ai-pac-man-clones-reviewed-grok"
              >'A lot worse than expected': AI Pac-Man clones, reviewed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 15:21:24</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43363499"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43363474">
          <h3>
            <a
              class="item"
              href="https://www.propublica.org/article/using-ai-responsibly-for-reporting"
              >How ProPublica Uses AI in Its Investigations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 15:19:16</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43363474"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43363276">
          <h3>
            <a class="item" href="https://studio.codevideo.io"
              >Show HN: CodeVideo – Two years in the making to build an
              event-sourced IDE</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 15:01:01</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43363276"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                The idea is that you create the educational content once, then
                can export the course to multiple formats - as a video (of
                course!), but also as an interactive webpage, a blog post, or
                even a book, PDF, or PowerPoint! Basically a "create once, ship
                everywhere" concept.
              </p>
              <p>
                Things will get more interesting as I incorporate stuff like
                spell check (for speech) and abstract syntax tree checking (for
                code), so you can quite literally check the validity of your
                software course in realtime as you build the course.
              </p>
              <p>
                You can read more about the technical details and history on my
                Substack launch post:
              </p>
              <p>
                <a
                  href="https://codevideo.substack.com/p/launching-codevideo-after-two-years"
                  >https://codevideo.substack.com/p/launching-codevideo-after-t...</a
                >
              </p>
              <p>And here's the intro video about how to use the studio:</p>
              <p>
                <a href="https://youtu.be/4nyuhWF6SS0"
                  >https://youtu.be/4nyuhWF6SS0</a
                >
              </p>
              <p>EDIT: added link to the mp4 created in the demo video:</p>
              <p>
                <a
                  href="https://coffee-app.sfo2.cdn.digitaloceanspaces.com/codevideo/v3/a5edf4e4-c512-4b62-b7f9-11dbe689440e.mp4"
                  >https://coffee-app.sfo2.cdn.digitaloceanspaces.com/codevideo...</a
                >
              </p>
              <p>
                From an intellectual and software standpoint this product has
                been (and still is) an absolute blast to build - and as always,
                I've learned a TON along the way. Very excited to get feedback
                from the Hacker community - even (maybe especially?) the classic
                skeptical feedback ;)
              </p>
              <p>
                As an engineer, I always suck at monetization and things like
                that - I already am wondering if the whole token system is too
                complex and perhaps a different model would be better. Again,
                waiting for feedback from everyone. Until then, enjoy the
                studio!
              </p>
            </div>
          </section>
        </section>
        <section id="43363247">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2503.09573"
              >Block Diffusion: Interpolating Between Autoregressive and
              Diffusion Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 14:58:32</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43363247"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43363174">
          <h3>
            <a class="item" href="https://sethmlarson.dev/fedi-donut-friday"
              >Fediverse Donut Club</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 14:51:42</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43363174"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43363056">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43363056"
              >I'm Peter Roberts, immigration attorney who does work for YC and
              startups. AMA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 14:39:00</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43363056"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
            <div class="text">
              I'll be here for the next 6 hours. As usual, there are countless
              possible topics and I'll be guided by whatever you're concerned
              with but as much as possible I'd like to focus on the recent
              changes and potential changes in U.S. immigration law, policy, and
              practice. Please remember that I am limited in providing legal
              advice on specific cases for obvious liability reasons because I
              won't have access to all the facts. Please stick to a factual
              discussion in your questions and comments and I'll try to do the
              same in my responses. Thank you!
            </div>
          </section>
        </section>
        <section id="43363031">
          <h3>
            <a class="item" href="https://briarproject.org/how-it-works/"
              >Briar: Peer to Peer Encrypted Messaging</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 14:36:23</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43363031"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43363014">
          <h3>
            <a
              class="item"
              href="https://www.exurbe.com/stoicisms-appeal-to-the-rich-and-powerful/"
              >Stoicism's Appeal to the Rich and Powerful (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 14:35:00</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43363014"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43362528">
          <h3>
            <a
              class="item"
              href="https://constraints.cs.washington.edu/solvers/cassowary-tochi.pdf"
              >The Cassowary Linear Arithmetic Constraint Solving Algorithm
              [pdf] (2002)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 13:36:20</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43362528"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43361737">
          <h3>
            <a
              class="item"
              href="https://www.allthingsdistributed.com/2025/03/in-s3-simplicity-is-table-stakes.html"
              >In S3 simplicity is table stakes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 11:55:17</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43361737"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43360894">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/amds-strix-halo-under-the-hood"
              >AMD's Strix Halo – Under the Hood</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 09:23:58</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43360894"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43360642">
          <h3>
            <a
              class="item"
              href="https://github.com/ArcaneNibble/i-cant-believe-its-not-webusb"
              >I-cant-believe-its-not-webusb: Hacking around lack of WebUSB
              support in Firefox</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 08:36:08</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43360642"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43358980">
          <h3>
            <a
              class="item"
              href="https://info.varnish-software.com/blog/tinykvm-the-fastest-sandbox"
              >TinyKVM: Fast sandbox that runs on top of Varnish</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 02:12:11</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43358980"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43358947">
          <h3>
            <a
              class="item"
              href="https://whatever.scalzi.com/2025/03/13/the-church-faq/"
              >The Church FAQ</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 02:00:35</span
              ><span class="points-container"
                >Points: <span class="points">266</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43358947"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43358682">
          <h3>
            <a class="item" href="https://github.com/chenquan/arkflow"
              >ArkFlow – High-performance Rust stream processing engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 00:58:29</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43358682"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43357955">
          <h3>
            <a class="item" href="https://github.com/needleful/c_plus_prolog"
              >C Plus Prolog</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 22:48:45</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43357955"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43357739">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/03/13/y-combinator-urges-the-white-house-to-support-europes-digital-markets-act/"
              >Y Combinator urges the White House to support Europe's Digital
              Markets Act</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 22:12:31</span
              ><span class="points-container"
                >Points: <span class="points">411</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43357739"
                  >Comments</a
                ><span class="descendants">: 302</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43356995">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/10x-engineer"
              >“Normal” engineers are the key to great teams</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 20:35:47</span
              ><span class="points-container"
                >Points: <span class="points">521</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43356995"
                  >Comments</a
                ><span class="descendants">: 443</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43356314">
          <h3>
            <a class="item" href="https://www.lostartoflogarithms.com/"
              >The Lost Art of Logarithms</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 19:05:17</span
              ><span class="points-container"
                >Points: <span class="points">500</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43356314"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43355031">
          <h3>
            <a
              class="item"
              href="https://planetscale.com/blog/io-devices-and-latency"
              >IO Devices and Latency</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 16:46:27</span
              ><span class="points-container"
                >Points: <span class="points">392</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43355031"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43353822">
          <h3>
            <a
              class="item"
              href="https://worksinprogress.co/issue/steam-networks/"
              >Steam Networks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 14:37:05</span
              ><span class="points-container"
                >Points: <span class="points">344</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43353822"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43352531">
          <h3>
            <a
              class="item"
              href="https://finance.yahoo.com/news/openai-asks-white-house-relief-100000706.html"
              >OpenAI asks White House for relief from state AI rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 12:20:29</span
              ><span class="points-container"
                >Points: <span class="points">714</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43352531"
                  >Comments</a
                ><span class="descendants">: 643</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43339212">
          <h3>
            <a
              class="item"
              href="https://www.bentasker.co.uk/posts/blog/security/seducing-a-romance-scammer.html"
              >My Scammer Girlfriend: Baiting a Romance Fraudster</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-12 @ 01:55:32</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43339212"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43330143">
          <h3>
            <a
              class="item"
              href="https://www.md-subs.com/blog/creative-fansubbing-techniques-2"
              >Creative Fansubbing Techniques: Part 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-11 @ 07:48:29</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43330143"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43327506">
          <h3>
            <a
              class="item"
              href="https://www.pritzkerprize.com/laureates/liu-jiakun"
              >Liu Jiakun Receives the 2025 Pritzker Architecture Prize</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 23:41:45</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43327506"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43323491">
          <h3>
            <a
              class="item"
              href="https://www.latimes.com/business/real-estate/story/2020-02-06/architect-paul-williams-documentary"
              >Architect of classic Hollywood gets his own star turn</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 18:03:21</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43323491"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43321109">
          <h3>
            <a
              class="item"
              href="https://www.audubon.org/magazine/apparently-magpies-and-crows-are-using-anti-bird-spikes-make-their-nests"
              >Apparently magpies and crows are using “anti-bird spikes” to make
              nests (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 14:33:10</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43321109"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
