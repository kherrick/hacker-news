<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38285482">
          <h3>
            <a class="item" href="https://github.com/agentcasa/doda"
              >Show HN: OpenAI dev assistant GUI with local code interpreter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 03:13:00</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38285482"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38285251">
          <h3>
            <a
              class="item"
              href="https://becomingaleader.substack.com/p/how-to-build-trust"
              >How to build trust as a new engineering manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 02:29:30</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38285251"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38285228">
          <h3>
            <a class="item" href="https://github.com/abi/screenshot-to-code"
              >Show HN: Convert any screenshot into clean HTML code using GPT
              Vision (OSS tool)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 02:27:40</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38285228"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built a simple React/Python app that takes screenshots of
                websites and converts them to clean HTML/Tailwind code.
              </p>
              <p>
                It uses GPT-4 Vision to generate the code, and DALL-E 3 to
                create placeholder images.
              </p>
              <p>
                To run it, all you need is an OpenAI key with GPT vision access.
              </p>
              <p>
                I’m quite pleased with how well it works most of the time.
                Sometimes, the image generations can be hilariously off. See
                here for a replica of Taylor Swift’s Instagram page:
                <a href="https://streamable.com/70gow1"
                  >https://streamable.com/70gow1</a
                >
                I initially had a hard time getting it to work on full page
                screenshots. GPT4 would code up the first couple of sections and
                then, get lazy and output placeholder comments for the rest of
                the page. With some prompt engineering, full page screenshots
                work a whole lot better now. It’s great for landing pages.
              </p>
              <p>
                Lots of ideas of where to go from here! Let me know if you have
                feedback and you find this useful :)
              </p>
            </div>
          </section>
        </section>
        <section id="38284196">
          <h3>
            <a
              class="item"
              href="https://neurofusionresearchinc.notion.site/Investigating-the-Impact-of-Cold-Plunges-on-Brain-Activity-99cdaa69889542fc8ef123ee9fe5130c?pvs=4"
              >Investigating the Impact of Cold Plunges on Brain Activity Using
              EEG</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 00:06:12</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38284196"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38283936">
          <h3>
            <a
              class="item"
              href="https://ivan.sanchezortega.es/development/2023/11/13/scintillocartography.html"
              >Scintillocartography</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 23:34:48</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38283936"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38283860">
          <h3>
            <a
              class="item"
              href="https://energyhistory.yale.edu/grand-ball-given-by-the-whales-vanity-fair-april-20-1861/"
              >"Grand Ball Given by the Whales," Vanity Fair, April 20, 1861</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 23:23:01</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38283860"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38282950">
          <h3>
            <a
              class="item"
              href="https://matklad.github.io/2023/11/15/push-ifs-up-and-fors-down.html"
              >Push ifs up and fors down</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 21:41:20</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38282950"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38282728">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s42256-023-00703-8"
              >Language models and linguistic theories beyond words</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 21:25:35</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38282728"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38282563">
          <h3>
            <a
              class="item"
              href="https://cobbpg.github.io/articles/stunt-car-racer-apple2-port.html"
              >Porting Stunt Car Racer to the Apple II</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 21:13:01</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38282563"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38282166">
          <h3>
            <a
              class="item"
              href="https://younganimator.uk/winner/1699875910225x437970782709919500"
              >Blender 16yo winner of UK young animator of the year</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 20:42:30</span
              ><span class="points-container"
                >Points: <span class="points">875</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38282166"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38281848">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/humor/sketchbook/is-my-toddler-a-stochastic-parrot"
              >Is my toddler a stochastic parrot?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 20:17:27</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38281848"
                  >Comments</a
                ><span class="descendants">: 219</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38281137">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/society/2023/nov/16/australia-antibiotics-overuse-drug-resistant-infections"
              >Australia's overuse of antibiotics driving rate of drug-resistant
              infections</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 19:21:54</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38281137"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38280472">
          <h3>
            <a class="item" href="https://github.com/poettering/diskomator"
              >Diskomator – NVMe-TCP at your fingertips</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 18:35:42</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38280472"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38280201">
          <h3>
            <a class="item" href="https://datagubbe.se/usab2/"
              >The Decline of Usability: Revisited</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 18:15:46</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38280201"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38279459">
          <h3>
            <a
              class="item"
              href="https://razberry.substack.com/p/btree-factorio"
              >B-trees in Factorio</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 17:25:12</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38279459"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38278246">
          <h3>
            <a
              class="item"
              href="https://www.britishecologicalsociety.org/new-deep-learning-ai-tool-helps-ecologists-monitor-rare-birds-through-their-songs/"
              >AI tool helps ecologists monitor rare birds through their
              songs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 16:09:19</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38278246"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38278171">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/11/15/23960345/microsoft-cpu-gpu-ai-chips-azure-maia-cobalt-specifications-cloud-infrastructure"
              >The first two custom silicon chips designed by Microsoft for its
              cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 16:02:51</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38278171"
                  >Comments</a
                ><span class="descendants">: 219</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38277926">
          <h3>
            <a class="item" href="https://simonwillison.net/2023/Nov/15/gpts/"
              >Exploring GPTs: ChatGPT in a trench coat?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 15:44:23</span
              ><span class="points-container"
                >Points: <span class="points">369</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38277926"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38277701">
          <h3>
            <a
              class="item"
              href="https://www.msn.com/en-us/money/companies/i-visited-over-120-ev-chargers-three-reasons-why-so-many-were-broken/ar-AA1jXDcA"
              >I visited over 120 EV chargers: why so many were broken</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 15:29:43</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38277701"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38277361">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/canned-food-history"
              >Canned food went from military rations to fancy appetizers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 15:06:19</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38277361"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38277248">
          <h3>
            <a class="item" href="https://github.com/monkeypatch/monkeypatch.py"
              >Show HN: MonkeyPatch – Cheap, fast and predictable LLM functions
              in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 14:56:51</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38277248"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
            <div class="text">
              <p>
                For example, if you need to classify PDFs, extract product
                feedback from tweets, or auto-generate synthetic data, you can
                spin up an LLM-powered Python function in &lt;5 minutes to power
                your application. Unlike existing LLM clients, these functions
                generate well-typed outputs with guardrails to mitigate
                unexpected behavior.
              </p>
              <p>
                After about 200-300 calls, these functions will begin to get
                cheaper and faster. We've seen 8-10x reduction in cost and
                latency in some use-cases! This happens via progressive
                knowledge distillation - MonkeyPatch incrementally fine-tunes
                smaller, cheaper models in the background, tests them against
                the constraints defined by the developer, and retains the
                smallest model that meets accuracy requirements, which typically
                has significantly lower costs and latency.
              </p>
              <p>
                As an LLM researcher, I kept getting asked by startups and
                friends to build specific LLM features that they could embed
                into their applications. I realized that most developers have to
                either 1) use existing low-level LLM clients (GPT4/Claude),
                which can be unreliable, untyped, and pricey, or 2) pore through
                LangChain documentation for days to build something.
              </p>
              <p>
                We built MonkeyPatch to make it easy for developers to inject
                LLM-powered functions into their code and create tests to ensure
                they behave as intended. Our goal is to help developers easily
                build apps and functions without worrying about reliability,
                cost, and latency, while following best software engineering
                practices.
              </p>
              <p>
                We're only available in Python currently but actively working on
                a Typescript version. The repo has all the instructions you need
                to get up and running in a few minutes.
              </p>
              <p>
                The world of LLMs is changing by the day and so we're not 100%
                sure how MonkeyPatch will evolve. For now, I'm just excited to
                share what we've been working on with the HN community. Would
                love to know what you guys think!
              </p>
              <p>
                Open-source repo:
                <a href="https://github.com/monkeypatch/monkeypatch.py"
                  >https://github.com/monkeypatch/monkeypatch.py</a
                >
              </p>
              <p>
                Sample use-cases:
                <a
                  href="https://github.com/monkeypatch/monkeypatch.py/tree/master/examples"
                  >https://github.com/monkeypatch/monkeypatch.py/tree/master/ex...</a
                >
              </p>
              <p>
                Benchmarks:
                <a
                  href="https://github.com/monkeypatch/monkeypatch.py#scaling-and-finetuning"
                  >https://github.com/monkeypatch/monkeypatch.py#scaling-and-fi...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="38276951">
          <h3>
            <a
              class="item"
              href="https://www.marginalia.nu/log/19-website-discoverability-crisis/"
              >The Small Website Discoverability Crisis (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 14:31:36</span
              ><span class="points-container"
                >Points: <span class="points">513</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38276951"
                  >Comments</a
                ><span class="descendants">: 224</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38276743">
          <h3>
            <a
              class="item"
              href="https://www.raptitude.com/2023/10/the-truth-is-always-made-of-details/"
              >The Truth Is Always Made of Details</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 14:09:17</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38276743"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38276680">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2023/11/study-reveals-how-natural-processes-helped-sculpt-the-great-sphinx-of-giza/"
              >The Great Sphinx of Giza may have have started out as a natural
              formation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 14:02:50</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38276680"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38276075">
          <h3>
            <a class="item" href="https://wasmbyexample.dev/home.en-us.html"
              >WASM by example</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 12:46:58</span
              ><span class="points-container"
                >Points: <span class="points">278</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38276075"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38275792">
          <h3>
            <a class="item" href="https://taylor.town/pseudoprose"
              >Pseudoprose</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 12:00:52</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38275792"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38275487">
          <h3>
            <a class="item" href="https://archive.org/details/AlanKeyD1987"
              >Alan Kay: Doing with Images Makes Symbols (1987) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 11:13:34</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38275487"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38274923">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/shakna-israel/7cd4251d1a6b7b9ebd3a9b2a26cbbfb8"
              >Obfuscating Lua (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 09:39:08</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38274923"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38274642">
          <h3>
            <a
              class="item"
              href="https://blog.jgc.org/2023/11/my-primality-testing-code-is-6x-faster.html"
              >My primality testing code is 6x faster than Sir Roger
              Penrose's</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 08:51:45</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38274642"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38273488">
          <h3>
            <a class="item" href="https://accentual.com/bmc64/"
              >Bare Metal Emulation on the Raspberry Pi – Commodore 64</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 04:56:18</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38273488"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
