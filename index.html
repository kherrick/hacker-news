<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41060834">
          <h3>
            <a
              class="item"
              href="https://www.dive.club/ideas/will-figma-become-an-awkward-middle-ground"
              >Will Figma become an awkward middle ground?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 19:22:37</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41060834"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41060813">
          <h3>
            <a
              class="item"
              href="https://blog.emojipedia.org/x-redesigns-water-pistol-emoji-back-to-a-firearm/"
              >X redesigns water pistol emoji back to a firearm</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 19:20:42</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41060813"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41060710">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/legal/privacy/data/en/ask-siri-dictation/"
              >Ask Siri, Dictation and Privacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 19:12:09</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41060710"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41060669">
          <h3>
            <a
              class="item"
              href="https://pix11.com/news/local-news/countdown-clock-in-nycs-union-square-ticks-below-5-years-what-it-means/"
              >Countdown clock in NYC's Union Square ticks below 5 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 19:08:29</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41060669"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41060158">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/article/2024/jul/24/crowdstrike-outage-companies-cost"
              >CrowdStrike global outage to cost US Fortune 500 companies
              $5.4B</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 18:28:07</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41060158"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41060102">
          <h3>
            <a
              class="item"
              href="https://trufflesecurity.com/blog/anyone-can-access-deleted-and-private-repo-data-github"
              >Anyone can access deleted and private repository data on
              GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 18:24:02</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41060102"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41059412">
          <h3>
            <a
              class="item"
              href="https://math.andrej.com/2024/01/30/space-filling-curves-constructively/"
              >Space-Filling Curves, Constructively</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 17:20:44</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41059412"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41059342">
          <h3>
            <a
              class="item"
              href="https://dublog.net/blog/commoditize-complement/"
              >Big tech wants to make AI cost nothing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 17:15:46</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41059342"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41059148">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41059148"
              >Join YC's Ruby Meetup on August 13th at Our New SF
              Headquarters</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 17:00:07</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>Speakers so far:</p>
              <p>
                - Jared Friedman (YC Group Partner &amp; Scribd, S06) will give
                an opening talk about the history of software at YC: how we
                chose Rails, who wrote the first MR to our codebase, why
                Bookface is a YC founder’s secret weapon, and how Rails powers
                all of YC.
              </p>
              <p>
                - Daniel Farina (Ubicloud, W24) has been building infrastructure
                control planes in Ruby for 13 years - first at Heroku and now at
                Ubicloud. Daniel will share some war stories, as well as his
                five favorite “features” that make Ruby particularly powerful
                for building infrastructure code.
              </p>
              <p>
                - Kelsey Pedersen (Capsule, S22) built Capsule on a V1 vector
                database with Rails, Postgres and Active Record with the
                PGVector plugin. She’s happy to share learnings at pitfalls, as
                well as how she uses webhooks and rakes to automate workflows
                and help keep the team small.
              </p>
              <p>
                - Keith Schacht (Mystery.org, S17) started coding Ruby in ‘05,
                and is still at it — building ChatGPT in Rails (vs Python) and
                keeping up with stimulus, new morphing, and Turbo Native. He’ll
                do some live coding of these new features, and wants to hear
                what you think!
              </p>
              <p>
                We'll be providing dinner &amp; refreshments for attendees, and
                there will be ample opportunity to meet with speakers, folks
                from YC and network as well.
              </p>
              <p>
                Also note: many YC companies are hiring for ruby engineers —
                including Y Combinator’s Software Team. Ask us about open roles!
              </p>
              <p>
                If you’re interested, please RSVP below to join us -- we have
                limited capacity, but we'll try to get as many Rubyistas in the
                room as possible.
              </p>
              <p>
                <a href="https://events.ycombinator.com/yc-ruby-meetup"
                  >https://events.ycombinator.com/yc-ruby-meetup</a
                >
              </p>
              <p>
                Let me know if you have questions, and hope to see you at our
                new SF office!
              </p>
            </div>
          </section>
        </section>
        <section id="41058791">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=OVdmK1UGzGs"
              >Intel confirms oxidation and excessive voltage in 13th and 14th
              Gen CPUs [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 16:33:53</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41058791"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41058671">
          <h3>
            <a class="item" href="https://biocircuits.github.io/index.html"
              >Biological Circuit Design by Caltech</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 16:22:58</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41058671"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41058424">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2024/07/phish-friendly-domain-registry-top-put-on-notice/"
              >Phish-friendly domain registry ".top" put on notice</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 16:03:30</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41058424"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41058292">
          <h3>
            <a
              class="item"
              href="https://righteousit.com/2024/07/24/hiding-linux-processes-with-bind-mounts/"
              >Hiding Linux Processes with Bind Mounts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 15:52:06</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41058292"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41058194">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-024-07566-y"
              >AI models collapse when trained on recursively generated data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 15:42:03</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41058194"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41058107">
          <h3>
            <a class="item" href="https://mistral.ai/news/mistral-large-2407/"
              >Large Enough – Mistral AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 15:32:21</span
              ><span class="points-container"
                >Points: <span class="points">425</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41058107"
                  >Comments</a
                ><span class="descendants">: 315</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41057766">
          <h3>
            <a class="item" href="https://interactivenn.net/index.html"
              >InteractiVenn – Interactive Venn Diagrams</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 14:57:14</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41057766"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41057289">
          <h3>
            <a
              class="item"
              href="https://gpuopen.com/learn/deep_learning_crash_course/"
              >Crash course in deep learning for computer graphics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 14:08:38</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41057289"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41056694">
          <h3>
            <a
              class="item"
              href="https://www.newscientist.com/article/2440445-physicists-may-now-have-a-way-to-make-element-120-the-heaviest-ever/"
              >Physicists may now have a way to make element 120</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 13:06:41</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41056694"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41056463">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.14394"
              >A Multimodal Automated Interpretability Agent</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 12:42:53</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41056463"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41056387">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-02383-9"
              >You got a null result. Will anyone publish it?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 12:35:00</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41056387"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41053761">
          <h3>
            <a
              class="item"
              href="http://www.kohala.com/start/papers.others/doors.html"
              >"Doors" in Solaris: Lightweight RPC Using File Descriptors
              (1996)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 05:02:30</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41053761"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41053645">
          <h3>
            <a
              class="item"
              href="https://www.crowdstrike.com/blog/falcon-content-update-preliminary-post-incident-report/"
              >Preliminary Post Incident Review</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 04:35:27</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41053645"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41052593">
          <h3>
            <a
              class="item"
              href="https://onlisp.co.uk/On-the-Origin-of-Emacs-in-1976.html"
              >The Origin of Emacs in 1976</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 00:49:26</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41052593"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41052365">
          <h3>
            <a
              class="item"
              href="https://martin.janiczek.cz/2024/07/23/taking-my-diabetes-treatment-into-my-own-hands.html"
              >Taking my diabetes treatment into my own hands</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 00:06:59</span
              ><span class="points-container"
                >Points: <span class="points">313</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41052365"
                  >Comments</a
                ><span class="descendants">: 213</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41050055">
          <h3>
            <a
              class="item"
              href="https://www.jhnewsandguide.com/the_hole_scroll/video-biscuit-basin-geyser-explodes-sending-yellowstone-tourists-packing/article_6862fda2-4923-11ef-b5c4-abdc9bc8cd83.html"
              >Hydrothermal explosion at Yellowstone National Park</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-23 @ 19:49:44</span
              ><span class="points-container"
                >Points: <span class="points">519</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41050055"
                  >Comments</a
                ><span class="descendants">: 275</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41044657">
          <h3>
            <a
              class="item"
              href="https://tigerbeetle.com/blog/2024-07-23-rediscovering-transaction-processing-from-history-and-first-principles"
              >Rediscovering Transaction Processing from History and First
              Principles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-23 @ 10:52:57</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41044657"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41042929">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/tech/amazon-alexa-devices-echo-losses-strategy-25f2581a"
              >Alexa is in millions of households and Amazon is losing
              billions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-23 @ 05:54:39</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41042929"
                  >Comments</a
                ><span class="descendants">: 172</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41034297">
          <h3>
            <a
              class="item"
              href="https://d-star.ai/solving-the-out-of-context-chunk-problem-for-rag"
              >Solving the out-of-context chunk problem for RAG</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 13:44:19</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41034297"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41025341">
          <h3>
            <a
              class="item"
              href="https://www.popularfintech.com/p/why-discover-is-no-american-express"
              >Why Discover is no American Express</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-21 @ 14:28:35</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41025341"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41001744">
          <h3>
            <a
              class="item"
              href="https://users.cs.duke.edu/~ola/papers/bubble.pdf"
              >Bubble Sort: An archaeological algorithmic analysis (2003)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-19 @ 03:06:19</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41001744"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
