<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40872978">
          <h3>
            <a class="item" href="https://www.jogmekeebs.com"
              >Show HN: I made a split keyboard for large palms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 07:11:29</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872978"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              I had an issue a few years ago - every ergonomic keyboard I tried
              had the switches too close to each other and my fingers were
              cramped in that small space. Then I decided to create a keyboard
              which is suitable for larger hands and eliminates most of the
              wrist movement. 34 keys was the most optimized version for
              achieving as little wrist movement as possible. You can try the
              fitment for your palm IRL with the printable template on the
              website.
            </div>
          </section>
        </section>
        <section id="40872672">
          <h3>
            <a
              class="item"
              href="https://www.amphilsoc.org/blog/katharine-way-john-wheeler-and-dawn-nuclear-fission"
              >Katharine Way, John Wheeler, and the Dawn of Nuclear Fission</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 06:02:55</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872672"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40872438">
          <h3>
            <a class="item" href="https://blog.nelhage.com/post/fuzzy-dedup/"
              >Finding near-duplicates with Jaccard similarity and MinHash</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 05:04:09</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872438"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40872332">
          <h3>
            <a
              class="item"
              href="https://lazamar.github.io/haskell-data-compression-with-huffman-codes/"
              >Building a data compression utility in Haskell using Huffman
              codes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 04:29:12</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872332"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40872182">
          <h3>
            <a
              class="item"
              href="https://www.kitze.io/posts/saddest-just-ship-it-story-ever"
              >The saddest "Just Ship It" story ever (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 03:50:35</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872182"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40872020">
          <h3>
            <a class="item" href="https://www.firezone.dev/blog/sans-io"
              >Sans-IO: The secret to effective Rust for network services</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 03:05:36</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872020"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40871783">
          <h3>
            <a class="item" href="https://boyuan.space/diffusion-forcing/"
              >Diffusion Forcing: Next-Token Prediction Meets Full-Sequence
              Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 02:09:20</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40871783"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40871043">
          <h3>
            <a
              class="item"
              href="https://people.csail.mit.edu/asolar/SynthesisCourse/Lecture1.htm"
              >Introduction to Program Synthesis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 23:28:11</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40871043"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870728">
          <h3>
            <a
              class="item"
              href="https://github.com/udlbook/udlbook/blob/main/public/NMI_Review.pdf"
              >Diving into deep learning: Understanding Deep Learning book
              review [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 22:43:05</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870728"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870357">
          <h3>
            <a
              class="item"
              href="https://www.arno.org/on-the-origins-of-ds-store"
              >The Origins of DS_store (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 21:55:13</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870357"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870345">
          <h3>
            <a class="item" href="https://salykova.github.io/matmul-cpu"
              >Beating NumPy matrix multiplication in 150 lines of C</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 21:52:55</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870345"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870280">
          <h3>
            <a
              class="item"
              href="https://reactormag.com/the-joy-of-reading-books-you-dont-entirely-understand/"
              >The Joy of Reading Books You Don't Understand</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 21:44:47</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870280"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40869877">
          <h3>
            <a class="item" href="https://0x.tools/"
              >Show HN: Xcapture-BPF – like Linux top, but with Xray vision</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 20:52:37</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40869877"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40869458">
          <h3>
            <a
              class="item"
              href="https://samueloph.dev/blog/announcing-wcurl-a-curl-wrapper-to-download-files/"
              >Wcurl: a curl wrapper to download files</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 19:55:04</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40869458"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40868425">
          <h3>
            <a class="item" href="https://luakit.github.io/"
              >Luakit: A fast, extensible, and customizable web browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 17:58:14</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40868425"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40867746">
          <h3>
            <a
              class="item"
              href="https://pganalyze.com/blog/a-practical-introduction-to-constraint-programming-using-cp-sat"
              >A practical introduction to constraint programming using CP-SAT
              and Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 16:48:34</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40867746"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40867709">
          <h3>
            <a
              class="item"
              href="https://sigwait.org/~alex/blog/2024/07/01/the-cheapest-nas.html"
              >The Cheapest NAS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 16:45:01</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40867709"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40866442">
          <h3>
            <a
              class="item"
              href="https://blog.brixit.nl/making-a-linux-managed-network-switch/"
              >Making a Linux-managed network switch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 14:47:18</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40866442"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40866374">
          <h3>
            <a
              class="item"
              href="https://www.mattkeeter.com/blog/2023-01-25-branch/"
              >Do not taunt happy fun branch predictor (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 14:42:02</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40866374"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40864249">
          <h3>
            <a
              class="item"
              href="https://groups.csail.mit.edu/medg/people/psz/Licklider.html"
              >Man-Computer Symbiosis (1960)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 09:26:14</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40864249"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40861079">
          <h3>
            <a class="item" href="https://markeasting.github.io/engine/"
              >Engine Sound Simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 22:32:42</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40861079"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40858165">
          <h3>
            <a class="item" href="https://mssv.net/2024/07/02/the-sphere/"
              >The Sphere</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 16:27:25</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40858165"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40856677">
          <h3>
            <a
              class="item"
              href="https://frguthmann.github.io/posts/profiling_webgpu/"
              >GPU profiling for WebGPU workloads on Windows with Chrome</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 13:51:37</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40856677"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40853834">
          <h3>
            <a class="item" href="https://hallofdreams.org/posts/trackmania-1/"
              >The History of Machine Learning in Trackmania</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 05:38:31</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40853834"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40853665">
          <h3>
            <a
              class="item"
              href="https://escapethealgorithm.substack.com/p/should-this-be-a-map-or-500-maps"
              >Should this be a map or 500 maps?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 04:50:40</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40853665"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40851890">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Stonehenge_Archer"
              >Stonehenge Archer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 23:22:43</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40851890"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40849363">
          <h3>
            <a class="item" href="https://blog.brachiosoft.com/en/posts/git/"
              >A Git story: Not so fun this time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 19:10:52</span
              ><span class="points-container"
                >Points: <span class="points">404</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40849363"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40846726">
          <h3>
            <a
              class="item"
              href="https://cohost.org/belarius/post/6677850-architectural-cross"
              >Architectural cross-section of Kowloon Walled City</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 15:27:25</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40846726"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40845628">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/shipt"
              >Shipt's Algorithm Squeezed Gig Workers. They Fought Back</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 13:21:33</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40845628"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40835787">
          <h3>
            <a
              class="item"
              href="https://statmodeling.stat.columbia.edu/2024/06/17/this-well-known-paradox-of-r-squared-is-still-buggin-me-can-you-help-me-out/"
              >Well-known paradox of R-squared is still buggin me</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 08:09:47</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40835787"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
