<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40106741">
          <h3>
            <a
              class="item"
              href="https://english.elpais.com/international/2024-04-21/iran-quickens-path-towards-the-atomic-bomb.html"
              >Iran quickens path towards the atomic bomb</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 15:57:31</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40106741"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40106639">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/04/21/microsoft_national_security_risk/"
              >Microsoft is a national security threat: ex-White House cyber
              policy director</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 15:44:10</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40106639"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40106570">
          <h3>
            <a
              class="item"
              href="https://www.kevindorst.com/stranger_apologies/the-gamblers-fallacy-is-not-a-fallacy"
              >The Gambler's Fallacy Is Not a Fallacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 15:34:53</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40106570"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40106508">
          <h3>
            <a
              class="item"
              href="https://read.highgrowthengineer.com/p/never-struggle-to-give-feedback-again"
              >Never struggle to give feedback again</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 15:29:48</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40106508"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40106500">
          <h3>
            <a
              class="item"
              href="https://www.roguelynn.com/talks/everyday-apis/"
              >The Design of Everyday APIs (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 15:28:57</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40106500"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40106157">
          <h3>
            <a class="item" href="https://bold-edit.com/wrote-my-own.html"
              >I can't stand using VSCode so I wrote my own</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 14:47:48</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40106157"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40106147">
          <h3>
            <a
              class="item"
              href="https://web.stanford.edu/~nanbhas/blog/forward-hooks-pytorch/"
              >Intermediate Activations â€“ The Forward Hook</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 14:46:42</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40106147"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40105773">
          <h3>
            <a
              class="item"
              href="https://www.writesoftwarewell.com/lorry-driver-to-rails-developer-at-38/"
              >From a Lorry Driver to Ruby on Rails Developer at 38</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 13:48:19</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40105773"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40105755">
          <h3>
            <a
              class="item"
              href="https://www.dpreview.com/opinion/6915548723/a-load-of-old-pixel-shift-why-i-just-don-t-care-for-high-res-modes"
              >A load of old pixel shift. Why I just don't care for high-res
              modes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 13:46:25</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40105755"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40105371">
          <h3>
            <a
              class="item"
              href="https://tonoko.notion.site/I-made-an-open-source-app-to-rewind-search-everything-happened-on-your-screen-on-Windows-184d1a9d5edb494dba0c2f46d311ec5c"
              >I made an open source Windows app to rewind and search everything
              on screen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 12:53:25</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40105371"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40105068">
          <h3>
            <a
              class="item"
              href="https://neurosciencenews.com/environment-genetics-metacognition-25945/"
              >Environment shapes emotional cognitive abilities more than
              genes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 12:12:20</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40105068"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40105021">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/0a5d30ed-164f-4b9f-a049-fc9692219f79"
              >How did customer service get so bad?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 12:03:59</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40105021"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40104774">
          <h3>
            <a
              class="item"
              href="https://github.com/tinyworldmap/tiny-world-map"
              >Tiny World Map</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 11:21:13</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40104774"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40104641">
          <h3>
            <a class="item" href="https://stepify.tech/"
              >Show HN: I made a website that converts YT videos into
              step-by-step guides</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 10:52:25</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40104641"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been working on this side project for the past month. It
                generates a step-by-step tutorial guide for YouTube videos that
                you can follow along without watching long videos. Best suited
                for tutorial videos but can work for other videos aswell. No BS.
                Just straight to the point.
              </p>
              <p>
                The guides are generated from pure transcript so you don't have
                to worry about it being AI. It's my first project as a total
                beginner. Something I had to do inorder to get out of tutorial
                hell.
              </p>
              <p>
                Please let me know if you have any suggestions or if you face
                any problems or bugs. I would try to fix them to the best of my
                abilities and as soon as possible.
              </p>
              <p>
                I would appreciate your feedback on this. Let me know what you
                think!
              </p>
            </div>
          </section>
        </section>
        <section id="40104492">
          <h3>
            <a class="item" href="https://github.com/luainkernel/lunatik"
              >Lunatik: Lunatik is a framework for scripting the Linux kernel
              with Lua</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 10:14:42</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40104492"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40104410">
          <h3>
            <a class="item" href="https://github.com/0x0mer/doom-htop"
              >Doom-htop: The classic DOOM game over htop</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 09:53:48</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40104410"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40103407">
          <h3>
            <a
              class="item"
              href="http://agileotter.blogspot.com/2014/09/programming-is-mostly-thinking.html"
              >Programming Is Mostly Thinking (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 05:40:07</span
              ><span class="points-container"
                >Points: <span class="points">520</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40103407"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40103323">
          <h3>
            <a class="item" href="https://blog.regehr.org/archives/2578"
              >Dataflow Analyses and Compiler Optimizations That Use Them, for
              Free</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 05:12:06</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40103323"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40103188">
          <h3>
            <a
              class="item"
              href="https://www.openwall.com/lists/oss-security/2024/04/18/4"
              >Glibc Buffer Overflow in Iconv</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-21 @ 04:31:57</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40103188"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40101885">
          <h3>
            <a class="item" href="https://tinyprojects.dev/projects/mailoji"
              >I bought 300 emoji domain names from Kazakhstan and built an
              email service (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 23:24:30</span
              ><span class="points-container"
                >Points: <span class="points">355</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40101885"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40101317">
          <h3>
            <a
              class="item"
              href="https://newscenter.lbl.gov/2024/04/17/scientists-discover-first-nitrogen-fixing-organelle/"
              >Scientists discover first nitrogen fixing organelle</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 21:50:20</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40101317"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40100971">
          <h3>
            <a class="item" href="https://www.emergetools.com/careers"
              >Emerge (YC W21) is hiring senior engineers to automate dead code
              deletion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 21:00:06</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40099626">
          <h3>
            <a
              class="item"
              href="https://farrs.substack.com/p/my-journey-into-personal-computer"
              >My journey into personal computer software development in 1983</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 18:29:44</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40099626"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40098597">
          <h3>
            <a
              class="item"
              href="https://medium.com/@philogb/exploring-indras-pearls-with-webgpu-e0f4a745c2f6"
              >Show HN: Exploring Indra's Pearls with WebGPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 16:40:26</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40098597"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40095918">
          <h3>
            <a class="item" href="https://psychedeliasyndro.me/"
              >Psychedelia syndrome: the pixels and code of Jeff Minter's
              'Psychedelia'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 09:04:13</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40095918"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40095257">
          <h3>
            <a class="item" href="https://larsjung.de/h5ai/"
              >h5ai â€“ modern HTTP web server index</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 06:23:34</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40095257"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40095077">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/books/2024/04/18/new-look-original-romanic-heartthrob-lord-byron/"
              >A new look at the original Romantic heartthrob, Lord Byron</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-20 @ 05:35:51</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40095077"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40084964">
          <h3>
            <a
              class="item"
              href="https://digitalpreservation-blog.lib.cam.ac.uk/raw-flux-streams-and-obscure-formats-further-work-around-imaging-5-25-inch-floppy-disks-5a2cf2e5f0d1"
              >Raw flux streams and obscure formats: Further work around imaging
              5.25-inch flo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-19 @ 10:10:31</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40084964"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40083748">
          <h3>
            <a class="item" href="https://lwn.net/Articles/968300/"
              >The PostgreSQL community debates ALTER SYSTEM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-19 @ 05:39:36</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40083748"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40071898">
          <h3>
            <a
              class="item"
              href="https://blog.jeffsmits.net/compsci/2024/04/07/parsing-and-all-that/"
              >Parsing and all that</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-18 @ 01:01:28</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40071898"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
