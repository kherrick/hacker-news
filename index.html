<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37237246">
          <h3>
            <a class="item" href="https://www.404media.co/welcome-to-404-media/"
              >A group of Motherboard folks just spun up their own new
              independent outlet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 15:09:35</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37237246"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37237242">
          <h3>
            <a
              class="item"
              href="https://thehill.com/homenews/state-watch/4166222-maui-residents-who-disobeyed-barricade-survived-fires-ap-reports/"
              >Maui residents who disobeyed barricades survived fires</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 15:09:24</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37237242"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37236916">
          <h3>
            <a
              class="item"
              href="https://fasterthanli.me/articles/a-half-hour-to-learn-rust"
              >A half-hour to learn Rust (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 14:49:31</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37236916"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37236860">
          <h3>
            <a
              class="item"
              href="https://rarehistoricalphotos.com/unsafe-vintage-baby-car-seat/"
              >Odd and Unsafe Baby Car Seats from the Past</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 14:46:42</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37236860"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37236746">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37236746"
              >Wappalyzer no longer open source?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 14:40:21</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37236746"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                The Github repo doesn’t exist:
                https://github.com/wappalyzer/wappalyzer
              </p>
            </div>
          </section>
        </section>
        <section id="37236100">
          <h3>
            <a
              class="item"
              href="https://www.bleepingcomputer.com/news/security/winrar-zero-day-exploited-since-april-to-hack-trading-accounts/"
              >WinRAR zero-day exploited since April to hack trading accounts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 14:05:16</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37236100"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37236099">
          <h3>
            <a
              class="item"
              href="https://eli.thegreenplace.net/2023/my-favorite-prime-number-generator/"
              >My favorite prime number generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 14:05:14</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37236099"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37236027">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/ai/2023/08/how-chatgpt-turned-generative-ai-into-an-anything-tool/"
              >ChatGPT turned generative AI into an “anything tool”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 14:01:18</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37236027"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37235957">
          <h3>
            <a
              class="item"
              href="https://www.shuttle.rs/blog/2023/08/23/rust-web-framework-comparison"
              >Choosing the Right Rust Web Framework: An Overview</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 13:57:28</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37235957"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37235738">
          <h3>
            <a
              class="item"
              href="https://www.nginx.com/resources/wiki/start/topics/depth/ifisevil/"
              >If is Evil when used in location context</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 13:44:12</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37235738"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37235578">
          <h3>
            <a
              class="item"
              href="https://www.michiganmedicine.org/health-lab/ai-can-predict-certain-forms-esophageal-and-stomach-cancer"
              >AI predicts certain esophageal and stomach cancers three years
              before diagnosis</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 13:31:58</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37235578"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37235441">
          <h3>
            <a
              class="item"
              href="https://www.vintag.es/2023/08/vase-animation.html"
              >Oldest Known Animation, a 5200 Year-Old Iranian Ceramic Vessel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 13:20:09</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37235441"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37235333">
          <h3>
            <a
              class="item"
              href="https://maximmassenkoff.com/papers/RubbingShoulders.pdf"
              >Rubbing Shoulders: Class Segregation in Daily Activities [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 13:12:05</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37235333"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37234887">
          <h3>
            <a
              class="item"
              href="https://github.com/Dicklesworthstone/fast_vector_similarity"
              >Show HN: Fast vector similarity using Rust and Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 12:34:37</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37234887"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                There are many other more involved measures that can detect more
                subtle relationships, but the problem is that some of them are
                quite slow to compute, especially if you're trying to do it in
                Python. For my favorite measure of statistical dependency,
                Hoeffding's D, that's true even if you use Numpy. Since I
                recently learned Rust and wanted to learn how to make Python
                packages using Rust, I put together this new library that I call
                Fast Vector Similarity.
              </p>
              <p>
                I was blown away by the performance of Rust and the quality of
                the tooling while making this. And even though it required a lot
                of fussing with Github Actions, I was also really impressed with
                just how easy it was to make a Python library using Rust that
                could be automatically compiled into wheels for every
                combination of platform (Linux, Windows, Mac) and Python Version
                (3.8 through 3.11) and uploaded to PyPi, all triggered by a
                commit to the repo and handled by Github's servers-- and all for
                free if you're working on a public repo!
              </p>
              <p>
                Anyway, this library can easily be installed to try out using
                `pip install fast_vector_similarity`, and you can see some
                simple demo Python code in the readme to show how to use it.
              </p>
              <p>
                Aside from exposing some very high performance implementations
                of some very nice similarity measures, I also included the
                ability to get robust estimates of these measures using the
                Bootstrap method. Basically, if you have two very high
                dimensional vectors, instead of using the entire vector to
                measure similarity, you can take the same random subset of
                indices from both vectors and compute the similarity of just
                those elements. Then you repeat the process hundreds or
                thousands of times and look at the robust average (i.e., throw
                away the results outside the 25th percentile to 75th percentile
                and average the remaining ones, to reduce the impact of
                outliers) and standard deviation of the results. Obviously this
                is very demanding of performance, but it's still reasonable if
                you're not trying to compute it for too many vectors.
              </p>
              <p>
                Everything is designed to fully saturate the performance of
                multi-core machines by extensive use of
                broadcasting/vectorization and the use of paralell processing
                via the Rayon library. I was really impressed with how easy and
                low-overhead it is to make highly parallelized code in Rust,
                especially compared to coming from Python, where you have to
                jump through a lot of hoops to use multiprocessing and there is
                a ton of overhead.
              </p>
              <p>
                Anyway, please let me know what you think. I'm looking to add
                more measures of similarity if I can find ones that can be
                efficiently computed (I already gave up on including HSIC
                because I couldn't get it to go fast enough, even using
                BLAS/LAPACK).
              </p>
            </div>
          </section>
        </section>
        <section id="37234121">
          <h3>
            <a class="item" href="https://github.com/roboflow/inference"
              >Show HN: Pip install inference, open source computer vision
              deployment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 11:04:27</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37234121"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <p>
                We, the Roboflow team, have been hard at work open sourcing
                Inference, an open source vision deployment solution. Our
                solution is designed with developers in mind, offering a
                HTTP-based interface. Run models on your hardware without having
                to write architecture-specific inference code. Here's a demo
                showing how to go from a model to GPU inference on a video of a
                football game in ~10 minutes:
              </p>
              <p>
                <a href="https://www.youtube.com/watch?v=at-yuwIMiN4"
                  >https://www.youtube.com/watch?v=at-yuwIMiN4</a
                >
              </p>
              <p>
                Inference powers millions of daily API calls for global sports
                broadcasts, one of the world’s largest railways, a leading
                electric car manufacturer, and multiple other Fortune 500
                companies, along with countless hackers’ hobby and research
                projects. Inference works in Docker and supports CPU (ARM and
                x86), NVIDIA GPU, and TRT. Inference manages dependencies and
                the environment. All you need to do is make HTTP requests to the
                server.
              </p>
              <p>
                YOLOv5, YOLOv8, YOLACT, CLIP, SAM, and other popular vision
                models are supported (some models need to be hosted on Roboflow
                first, see the docs; we're working on bring your own model
                weights!).
              </p>
              <p>Try it out and tell us what you think!</p>
            </div>
          </section>
        </section>
        <section id="37234111">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37234111"
              >Ask HN: Where to find open source house plans?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 11:02:57</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37234111"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
            <div class="text">
              Wanting to build a house, and looking for a DB of open source
              plans if such thing even exist.
            </div>
          </section>
        </section>
        <section id="37233936">
          <h3>
            <a
              class="item"
              href="https://www.isro.gov.in/LIVE_telecast_of_Soft_landing.html"
              >Chandrayaan-3 Soft-landing [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 10:30:23</span
              ><span class="points-container"
                >Points: <span class="points">922</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37233936"
                  >Comments</a
                ><span class="descendants">: 296</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37233902">
          <h3>
            <a
              class="item"
              href="https://mough.xyz/312/psa-add-dir-auto-to-your-inputs-and-textareas"
              >PSA: Add dir=“auto” to your inputs and textareas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 10:26:19</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37233902"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37232451">
          <h3>
            <a
              class="item"
              href="https://blog.demofox.org/2023/08/22/permutation-iteration-and-random-access/"
              >Permutation iteration and random access</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 06:23:36</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37232451"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37232229">
          <h3>
            <a class="item" href="https://crates.io/crates/wherr"
              >Enhance Rust errors with file and line details</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 05:37:01</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37232229"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37232103">
          <h3>
            <a class="item" href="https://zrepl.github.io/"
              >Zrepl – ZFS replication</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 05:11:09</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37232103"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37232102">
          <h3>
            <a
              class="item"
              href="https://www.nationalreview.com/2023/07/i-met-a-book/"
              >I Met a Book</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 05:11:06</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37232102"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37231354">
          <h3>
            <a
              class="item"
              href="https://www.artandobject.com/news/what-you-might-not-know-about-worlds-oldest-photograph"
              >The World's Oldest Photograph (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 02:56:52</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37231354"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37231273">
          <h3>
            <a
              class="item"
              href="https://www.packtpub.com/product/modern-computer-architecture-and-organization-second-edition/9781803234519"
              >Modern Computer Architecture and Organization - Second Edition
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 02:40:55</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37231273"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37231179">
          <h3>
            <a class="item" href="https://esolangs.org/wiki/Fungeoid"
              >A fungeoid is a typically multi-dimensional language similar to
              Befunge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 02:23:48</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37231179"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37231148">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-08-visualizing-mysterious-quantum-entanglement-photons.amp"
              >Visualizing the mysterious: Quantum entanglement photons captured
              in real-time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 02:20:07</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37231148"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37230843">
          <h3>
            <a
              class="item"
              href="https://www.moorfields.nhs.uk/news/eye-scans-detect-signs-parkinson-s-disease-seven-years-diagnosis"
              >Eye scans detect signs of Parkinson’s disease up to seven years
              before diagnosis</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-23 @ 01:37:01</span
              ><span class="points-container"
                >Points: <span class="points">328</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37230843"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37229435">
          <h3>
            <a
              class="item"
              href="https://lukeplant.me.uk/blog/posts/no-one-actually-wants-simplicity/"
              >No One Wants Simplicity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-22 @ 22:30:42</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37229435"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37228821">
          <h3>
            <a class="item" href="https://goodsnooze.gumroad.com/l/macwhisper"
              >MacWhisper: Transcribe audio files on your Mac</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-22 @ 21:34:48</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37228821"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37224042">
          <h3>
            <a
              class="item"
              href="https://rosenzweig.io/blog/first-conformant-m1-gpu-driver.html"
              >The first conformant M1 GPU driver</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-22 @ 15:23:09</span
              ><span class="points-container"
                >Points: <span class="points">1433</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37224042"
                  >Comments</a
                ><span class="descendants">: 595</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
