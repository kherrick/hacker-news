<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44058299">
          <h3>
            <a class="item" href="https://github.com/Kotlin/kotlin-lsp"
              >Kotlin-Lsp: Kotlin Language Server and Plugin for Visual Studio
              Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-22 @ 02:46:47</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44058299"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44057841">
          <h3>
            <a
              class="item"
              href="https://maxwellforbes.com/posts/how-to-get-a-paper-accepted/"
              >Getting a paper accepted</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-22 @ 01:19:41</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44057841"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44057820">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2025/May/21/gemini-diffusion/"
              >Gemini Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-22 @ 01:13:50</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44057820"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44057752">
          <h3>
            <a
              class="item"
              href="https://www.lpm.org/investigate/2023-11-16/a-celebrated-startup-promised-kentuckians-green-jobs-it-gave-them-a-grueling-hell-on-earth"
              >How AppHarvest’s indoor farming scheme imploded (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-22 @ 01:00:09</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44057752"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44057612">
          <h3>
            <a
              class="item"
              href="https://github.com/derekeder/csv-to-html-table"
              >Show HN: Display any CSV file as a searchable, filterable, pretty
              HTML table</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-22 @ 00:31:01</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44057612"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              I combined this with a simple API to update a CSV file using
              Deno/deno-csv library, allowing an Ansible job to easily update a
              CSV file via the API with Ansible URI module, and then have that
              same CSV file viewable/downloadable in a simple and
              easy/dashboardy way (with CSV-to-html-table). Copilot created the
              Deno/deno-csv CSV API code and then with a little back and forth I
              added static website functionality (to serve the CSV table), and I
              had a /view and a /update route. I'm just a sysadmin but I love
              piecing together stuff like this. Thanks Derek!
            </div>
          </section>
        </section>
        <section id="44057467">
          <h3>
            <a
              class="item"
              href="https://oppi.li/posts/tales_from_mainframe_modernization/"
              >Tales from Mainframe Modernization</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-22 @ 00:01:46</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44057467"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44056659">
          <h3>
            <a
              class="item"
              href="https://68kmla.org/bb/index.php?threads/itxplus-a-itx-sized-macintosh-plus-logicboard-reproduction.49715/"
              >ITXPlus: A ITX Sized Macintosh Plus Logicboard Reproduction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 21:52:30</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44056659"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44056407">
          <h3>
            <a
              class="item"
              href="https://standardebooks.org/ebooks/e-m-forster/short-fiction/text/the-machine-stops"
              >The Machine Stops (1909)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 21:18:07</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44056407"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44056280">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/sorcerer/6beb70de-9956-49b7-8e28-f48ea39efac6"
              >Sorcerer (YC S24) Is Hiring a Lead Hardware Design Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 21:00:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44056104">
          <h3>
            <a
              class="item"
              href="https://rockylinux.org/news/rockylinux-support-for-riscv"
              >Rocky Linux 10 Will Support RISC-V</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 20:40:58</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44056104"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44055895">
          <h3>
            <a class="item" href="https://github.com/IBM/ACE-RISCV"
              >Show HN: Confidential computing for high-assurance RISC-V
              embedded systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 20:21:06</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44055895"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              Dear HN community! Looking forward to hearing your feedback on ACE
              (assured confidential execution), technology that implements
              VM-based trusted execution environment (TEE) for embedded RISC-V
              systems with focus on a formally verified and auditable firmware.
              We target high-assurance systems that can benefit from
              compartmentalization and hardware-backed isolation. The key
              ingredient called security monitor (firmware) is implemented in
              Rust. The formal specification is defined as annotations directly
              in code and gets translated to Coq using RefinedRust automation.
              ACE design is now part of the RISCV confidential VM extension
              (CoVE) specification (deployment model 3).
            </div>
          </section>
        </section>
        <section id="44055542">
          <h3>
            <a class="item" href="https://clipjs.vercel.app/"
              >Show HN: ClipJS – Edit your videos from a PC or phone</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 19:50:37</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44055542"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44055347">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/for-algorithms-a-little-memory-outweighs-a-lot-of-time-20250521/"
              >For algorithms, a little memory outweighs a lot of time</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 19:34:20</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44055347"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44054775">
          <h3>
            <a
              class="item"
              href="https://thevinylfactory.com/features/the-curious-tale-of-bhutans-playable-record-postage-stamps/"
              >The curious tale of Bhutan's playable record postage stamps
              (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 18:45:18</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44054775"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44054620">
          <h3>
            <a
              class="item"
              href="https://www.minorplanetcenter.net/mpec/K25/K25K47.html"
              >Possible new dwarf planet found in our solar system</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 18:32:24</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44054620"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44054185">
          <h3>
            <a
              class="item"
              href="https://developers.googleblog.com/en/google-ai-studio-native-code-generation-agentic-tools-upgrade/"
              >An upgraded dev experience in Google AI Studio</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 17:53:40</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44054185"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44053744">
          <h3>
            <a class="item" href="https://jngiam.bearblog.dev/mcp-large-data/"
              >LLM function calls don't scale; code orchestration is simpler,
              more effective</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 17:18:52</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44053744"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44053603">
          <h3>
            <a
              class="item"
              href="https://shopify.dev/docs/api/storefront-web-components"
              >Storefront Web Components</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 17:08:58</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44053603"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44053560">
          <h3>
            <a
              class="item"
              href="https://mattweidner.com/2025/05/21/text-without-crdts.html"
              >Collaborative Text Editing Without CRDTs or OT</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 17:05:45</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44053560"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44053518">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2025-05-21/openai-to-buy-apple-veteran-jony-ive-s-ai-device-startup-in-6-5-billion-deal"
              >OpenAI to buy AI startup from Jony Ive</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 17:01:35</span
              ><span class="points-container"
                >Points: <span class="points">668</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44053518"
                  >Comments</a
                ><span class="descendants">: 903</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44052984">
          <h3>
            <a
              class="item"
              href="https://ai.meta.com/blog/llama-startup-program/?_fb_noscript=1"
              >Introducing the Llama Startup Program</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 16:10:06</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44052984"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44052418">
          <h3>
            <a
              class="item"
              href="https://news.engin.umich.edu/2025/05/the-us-has-a-new-most-powerful-laser/"
              >ZEUS – A new two-petawatt laser facility at the University of
              Michigan</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 15:17:10</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44052418"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44051958">
          <h3>
            <a
              class="item"
              href="http://www.datapointed.net/visualizations/math/factorization/animated-diagrams/"
              >Animated Factorization (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 14:39:37</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44051958"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44051733">
          <h3>
            <a class="item" href="https://mistral.ai/news/devstral">Devstral</a>
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 14:21:10</span
              ><span class="points-container"
                >Points: <span class="points">425</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44051733"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44033711">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2025/05/cern-gears-up-to-ship-antimatter-across-europe/"
              >CERN gears up to ship antimatter across Europe</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-19 @ 19:18:24</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44033711"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44027690">
          <h3>
            <a
              class="item"
              href="https://duckdb.org/2025/05/19/the-lost-decade-of-small-data.html"
              >The Lost Decade of Small Data?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-19 @ 08:39:31</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44027690"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44027624">
          <h3>
            <a
              class="item"
              href="https://m3.material.io/blog/building-with-m3-expressive"
              >Google releases Material 3 Expressive, a more emotional UI design
              system</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-19 @ 08:27:48</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44027624"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44025459">
          <h3>
            <a
              class="item"
              href="https://blog.nawaz.org/posts/2025/May/gemini-figured-out-my-nephews-name/"
              >Gemini figured out my nephew’s name</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-19 @ 00:35:02</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44025459"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44024278">
          <h3>
            <a
              class="item"
              href="https://londonist.com/london/features/london-s-water-pump"
              >London’s water pumps: Where strange history flows freely
              (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 20:59:18</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44024278"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44022736">
          <h3>
            <a
              class="item"
              href="https://nghiant3223.github.io/2025/04/15/go-scheduler.html"
              >Understanding the Go Scheduler</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-18 @ 17:03:55</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44022736"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
