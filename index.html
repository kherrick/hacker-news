<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40355227">
          <h3>
            <a
              class="item"
              href="https://dygalo.dev/blog/blazingly-fast-linked-lists/"
              >Blazingly Fast Linked Lists</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 13:51:26</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40355227"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40354241">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/66506"
              >Unriddle (YC S24) Is Hiring a Founding Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 12:00:15</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40353615">
          <h3>
            <a
              class="item"
              href="https://tratt.net/laurie/blog/2024/what_factors_explain_the_nature_of_software.html"
              >What Factors Explain the Nature of Software?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 10:28:32</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40353615"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40352686">
          <h3>
            <a class="item" href="https://brandur.org/notifier"
              >The Notifier Pattern for Applications That Use Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 07:56:13</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40352686"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40352120">
          <h3>
            <a class="item" href="https://github.com/verilator/verilator"
              >Verilator: Open-Source SystemVerilog simulator and lint system</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 06:08:46</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40352120"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40350954">
          <h3>
            <a class="item" href="https://www.apoorva-srinivasan.com/plms/"
              >A review on protein language models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 02:10:39</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40350954"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40350625">
          <h3>
            <a class="item" href="https://arvyy.github.io/islisp-truffle/"
              >Truffle ISLISP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 01:26:34</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40350625"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40350201">
          <h3>
            <a
              class="item"
              href="https://www.cs.utexas.edu/~bornholt/post/memory-models.html"
              >Memory Consistency Models: A Tutorial</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 00:24:02</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40350201"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40349347">
          <h3>
            <a
              class="item"
              href="https://www.macstories.net/stories/not-an-ipad-pro-review/"
              >Not an iPad Pro Review: Why iPadOS Still Doesn't Get the Basics
              Right</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 22:33:01</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40349347"
                  >Comments</a
                ><span class="descendants">: 284</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40349124">
          <h3>
            <a
              class="item"
              href="https://without.boats/blog/references-are-like-jumps/"
              >References Are Like Jumps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 22:11:17</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40349124"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40348957">
          <h3>
            <a
              class="item"
              href="https://www.intel.com/content/www/us/en/newsroom/news/intel-powered-aurora-supercomputer-breaks-exascale-barrier.html"
              >Intel announces the Aurora supercomputer has broken the exascale
              barrier</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 21:54:53</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40348957"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40348531">
          <h3>
            <a class="item" href="https://www.unitree.com/g1/"
              >Unitree G1 Humanoid Agent</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 21:14:54</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40348531"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40347981">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/05/13/meteor-lakes-e-cores-crestmont-makes-incremental-progress/"
              >Meteor Lake's E-Cores: Crestmont Makes Incremental Progress</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 20:24:57</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40347981"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40347662">
          <h3>
            <a
              class="item"
              href="https://neuviemeporte.github.io/category/f15-se2.html"
              >DOS game "F-15 Strike Eagle II" reverse
              engineering/reconstruction war stories</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 20:00:30</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40347662"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40346995">
          <h3>
            <a class="item" href="https://github.com/nkasmanoff/pi-card"
              >Show HN: Pi-C.A.R.D, a Raspberry Pi Voice Assistant</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 19:03:55</span
              ><span class="points-container"
                >Points: <span class="points">295</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40346995"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
            <div class="text">
              <p>
                It uses distributed models so latency is something I'm working
                on, but I am curious on where this could go, if anywhere.
              </p>
              <p>Very much a WIP. Feedback welcome :-)</p>
            </div>
          </section>
        </section>
        <section id="40346320">
          <h3>
            <a class="item" href="https://c9x.me/compile/"
              >QBE â€“ Compiler Back End</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 18:05:48</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40346320"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40346024">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/ca/newsroom/2024/05/apple-and-google-deliver-support-for-unwanted-tracking-alerts-in-ios-and-android/"
              >Apple and Google deliver support for unwanted tracking alerts in
              iOS and Android</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 17:46:28</span
              ><span class="points-container"
                >Points: <span class="points">411</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40346024"
                  >Comments</a
                ><span class="descendants">: 380</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40345775">
          <h3>
            <a class="item" href="https://openai.com/index/hello-gpt-4o/"
              >GPT-4o</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 17:28:00</span
              ><span class="points-container"
                >Points: <span class="points">2813</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40345775"
                  >Comments</a
                ><span class="descendants">: 2073</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40345696">
          <h3>
            <a class="item" href="https://github.com/pipecat-ai/pipecat"
              >Show HN: An open source framework for voice assistants</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 17:21:14</span
              ><span class="points-container"
                >Points: <span class="points">306</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40345696"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
            <div class="text">
              <p>
                On the theory that something like a LlamaIndex or LangChain for
                real-time/conversational AI would be useful, a few of us started
                working on a Python library for voice (and multimodal) AI
                assistants/agents.
              </p>
              <p>
                So ... Pipecat: a framework for building things like personal
                coaches, meeting assistants, story-telling toys for kids,
                customer support bots, virtual friends, and snarky social bots.
              </p>
              <p>
                Most of the core contributors to Pipecat so far work together at
                our day jobs. This has been a kind of "20% time" thing at our
                company. But we're serious about welcoming all contributions. We
                want Pipecat to support any and all models, services, transport
                layers, and infrastructure tooling. If you're interested in this
                stuff, please check it out and let us know what you think.
                Submit PRs. Become a maintainer. Join the Discord. Post cool
                stuff. Post funny stuff when your voice agent goes completely
                off the rails (as mine sometimes do).
              </p>
            </div>
          </section>
        </section>
        <section id="40345654">
          <h3>
            <a class="item" href="https://chaphlagical.icu/Deblur-GS/"
              >Deblur-GS: 3D Gaussian splatting from camera motion blurred
              images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 17:16:54</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40345654"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40344946">
          <h3>
            <a class="item" href="https://dotat.at/@/2024-05-13-what-ident.html"
              >Unix version control lore: what, ident</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 16:17:20</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40344946"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40342803">
          <h3>
            <a class="item" href="https://www.val.town/v/maxm/staticChess"
              >Static Chess</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 12:56:34</span
              ><span class="points-container"
                >Points: <span class="points">435</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40342803"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40342008">
          <h3>
            <a class="item" href="https://patternlanguage.cc/"
              >A Pattern Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 11:30:33</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40342008"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40341733">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/disney-robot-2668135204"
              >Disney's Robots Use Rockets to Stick the Landing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 10:52:38</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40341733"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40341508">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/tech-industry/artificial-intelligence/commodore-64-can-use-ai-to-generate-8x8-sprites-takes-20-minutes-for-90-iterations"
              >Commodore 64 runs AI to generate images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 10:12:44</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40341508"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40340536">
          <h3>
            <a
              class="item"
              href="https://worldhistory.substack.com/p/to-cut-and-hack-my-days"
              >Timekeeping Before Clocks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 07:14:54</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40340536"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40340289">
          <h3>
            <a
              class="item"
              href="https://www.the-tls.co.uk/articles/why-surrealism-matters-by-mark-polizzotti-book-review/"
              >Why Surrealism Matters: Book review</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 06:19:22</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40340289"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40340226">
          <h3>
            <a
              class="item"
              href="https://medium.com/@fogleman/pen-plotter-programming-the-basics-ec0407ab5929"
              >Pen Plotter Programming: The Basics (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 06:05:46</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40340226"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40340220">
          <h3>
            <a
              class="item"
              href="https://camillovisini.com/writing/fifteen-fundamental-properties"
              >Fifteen Fundamental Properties (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 06:05:09</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40340220"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40340104">
          <h3>
            <a class="item" href="https://thefoggiest.dev/2024/05/13/msx-elite"
              >MSX Elite</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 05:35:04</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40340104"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
