<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46890352">
          <h3>
            <a
              class="item"
              href="https://www.telegraph.co.uk/news/2026/02/03/iranian-regime-doomed-when-it-lost-control-of-women/"
              >Women rejecting the hijab have doomed Iran's brutal regime</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 19:20:29</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46890352"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46889703">
          <h3>
            <a class="item" href="https://www.fluid.sh/"
              >Claude Code for Infrastructure</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 18:34:08</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46889703"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46889282">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2026/jan/25/ai-augment-rather-than-replace-workplace-doomed"
              >AI needs to augment rather than replace humans or the workplace
              is doomed</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 18:06:16</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46889282"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46889008">
          <h3>
            <a class="item" href="https://occupywallst.com/yen"
              >The Great Unwind</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 17:49:26</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46889008"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46888795">
          <h3>
            <a
              class="item"
              href="https://www.scd31.com/posts/building-an-arcade-display-adapter"
              >Building a 24-bit arcade CRT display adapter from scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 17:35:05</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46888795"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46888532">
          <h3>
            <a
              class="item"
              href="https://news.uark.edu/articles/80669/emotional-support-from-social-media-found-to-reduce-anxiety"
              >Study: emotional support from social media found to reduce
              anxiety</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 17:16:44</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46888532"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46888438">
          <h3>
            <a
              class="item"
              href="https://twitter.com/Ced_haurus/status/2018716889191498172"
              >French streamer unbanked by Qonto after criticizing Palantir and
              Peter Thiel</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 17:09:10</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46888438"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46888331">
          <h3>
            <a
              class="item"
              href="https://www.runconverge.com/careers/product-engineer"
              >Converge (YC S23) Is Hiring Product Engineers (NYC, In-Person)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 17:01:14</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46888142">
          <h3>
            <a class="item" href="https://github.com/MaxBittker/rs-sdk"
              >RS-SDK: Drive RuneScape with Claude Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 16:47:26</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46888142"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46887326">
          <h3>
            <a
              class="item"
              href="https://www.divergent-desktop.org/blog/2026/01/26/a12web/"
              >Arcan-A12: Weaving a Different Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 15:50:50</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46887326"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46886735">
          <h3>
            <a class="item" href="https://mistral.ai/news/voxtral-transcribe-2"
              >Voxtral Transcribe 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 15:08:17</span
              ><span class="points-container"
                >Points: <span class="points">425</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46886735"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46886440">
          <h3>
            <a
              class="item"
              href="https://pdfa.org/a-case-study-in-pdf-forensics-the-epstein-pdfs/"
              >A case study in PDF forensics: The Epstein PDFs</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 14:46:46</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46886440"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46886265">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2602.00294"
              >Attention at Constant Cost per Token via Symmetry-Aware Taylor
              Approximation</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 14:33:33</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46886265"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46886237">
          <h3>
            <a
              class="item"
              href="https://www.404media.co/fbi-couldnt-get-into-wapo-reporters-iphone-because-it-had-lockdown-mode-enabled/"
              >FBI couldn't get into WaPo reporter's iPhone because Lockdown
              Mode enabled</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 14:31:32</span
              ><span class="points-container"
                >Points: <span class="points">474</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46886237"
                  >Comments</a
                ><span class="descendants">: 389</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46886191">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/health/2026/02/guinea-worm-on-track-to-be-2nd-eradicated-human-disease-only-10-cases-in-2025/"
              >Guinea worm on track to be 2nd eradicated human disease; only 10
              cases in 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 14:27:05</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46886191"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46884883">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/claude-is-a-space-to-think"
              >Claude Is a Space to Think</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 12:08:49</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46884883"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46882389">
          <h3>
            <a class="item" href="https://github.com/bethington/ghidra-mcp"
              >Show HN: Ghidra MCP Server – 110 tools for AI-assisted reverse
              engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 06:51:51</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46882389"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46881264">
          <h3>
            <a
              class="item"
              href="https://www.jernesto.com/articles/thinking_hard"
              >I miss thinking hard</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 03:54:11</span
              ><span class="points-container"
                >Points: <span class="points">1160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46881264"
                  >Comments</a
                ><span class="descendants">: 628</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46877278">
          <h3>
            <a
              class="item"
              href="https://incoherency.co.uk/blog/stories/tractor.html"
              >Tractor</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-03 @ 21:04:59</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46877278"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46876105">
          <h3>
            <a class="item" href="https://civai.org/blog/space-data-centers"
              >Data centers in space makes no sense</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-03 @ 19:37:30</span
              ><span class="points-container"
                >Points: <span class="points">998</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46876105"
                  >Comments</a
                ><span class="descendants">: 1159</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46872465">
          <h3>
            <a class="item" href="https://brandon.wang/2026/clawdbot"
              >A sane but bull case on Clawdbot / OpenClaw</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-03 @ 15:47:10</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46872465"
                  >Comments</a
                ><span class="descendants">: 324</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46844410">
          <h3>
            <a
              class="item"
              href="https://michael.stapelberg.ch/posts/2026-02-01-coding-agent-microvm-nix/"
              >Coding Agent VMs on NixOS with Microvm.nix</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-01 @ 08:02:46</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46844410"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46844195">
          <h3>
            <a class="item" href="https://highways.dot.gov/media/7941"
              >Procedures for Repair of Potholes in Asphalt-Surfaced
              Pavements</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-01 @ 07:08:03</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46844195"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46842711">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46842711"
              >Show HN: SymDerive – A functional, stateless symbolic math
              library</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-01 @ 01:20:57</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46842711"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’m a physicist turned quant. Some friends and I 'built'
                SymDerive because we wanted a symbolic math library that was
                "Agent-Native" by design, but still a practical tool for humans.
              </p>
              <p>It boils down to two main goals:</p>
              <p>
                1. Agent Reliability: I’ve found that AI agents write much more
                reliable code when they stick to stateless, functional pipelines
                (Lisp-style). It keeps them from hallucinating state changes or
                getting lost in long procedural scripts. I wanted a library that
                enforces that "Input -&gt; Transform -&gt; Output" flow by
                default.
              </p>
              <p>
                2. Easing the transition to Python: For many physicists,
                Mathematica is the native tongue. I wanted a way to ease that
                transition—providing a bridge that keeps the familiar syntax
                (CamelCase, Sin, Integrate) while strictly using the Python
                scientific stack under the hood.
              </p>
              <p>
                What I built: It’s a functional wrapper around the standard
                stack (SymPy, PySR, CVXPY) that works as a standalone engine for
                anyone—human or agent—who prefers a pipe-based workflow.
              </p>
              <p></p>
              <pre><code>  # The "Pipe" approach (Cleaner for agents, readable for humans)
  result = (
      Pipe((x + 1)**3)
      .then(Expand)
      .then(Simplify) 
      .value
  )
</code></pre>
              The "Vibes" features:
              <p>
                Wolfram Syntax: Integrate, Det, Solve. If you know the math, you
                know the API.
              </p>
              <p>
                Modular: The heavy stuff (Symbolic Regression, Convex
                Optimization) are optional installs ([regression], [optimize]).
                It won’t bloat your venv unless you ask it to.
              </p>
              <p>
                Physics stuff: I added tools I actually use—abstract index
                notation for GR, Kramers-Kronig for causal models, etc.
              </p>
              <p>
                It’s definitely opinionated, but if you’re building agents to do
                rigorous math, or just want a familiar functional interface for
                your own research, this might help.
              </p>
              <p>
                I have found that orchestrators (Claude Code, etc) are fairly
                good at learning the tools and sending tasks to the right
                persona, we have been surprised by how well it has worked.
              </p>
              <p>Repo here: https://github.com/closedform/deriver</p>
              <p>I will cry if roasted too hard</p>
            </div>
          </section>
        </section>
        <section id="46842288">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/explore-stratosphere-diy-pico-balloon"
              >High-Altitude Adventure with a DIY Pico Balloon</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-01 @ 00:14:55</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46842288"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46840558">
          <h3>
            <a class="item" href="https://saas-map.ssr.trapiche.cloud/"
              >Brazilian Micro-SaaS Map</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 20:35:51</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46840558"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46832606">
          <h3>
            <a class="item" href="https://spritely.institute/goblins/"
              >Goblins: Distributed, Transactional Programming with Racket and
              Guile</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-31 @ 02:05:25</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46832606"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46826803">
          <h3>
            <a
              class="item"
              href="https://www.newscientist.com/article/2513692-yawning-has-an-unexpected-influence-on-the-fluid-inside-your-brain/"
              >Yawning has an unexpected influence on the fluid inside your
              brain</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-30 @ 16:57:19</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46826803"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46824752">
          <h3>
            <a
              class="item"
              href="https://bmoreart.com/2024/09/the-voxel-is-a-cutting-edge-theater-experiment.html"
              >The Voxel Is a Cutting-Edge Theater Experiment</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-30 @ 14:25:36</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46824752"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46788588">
          <h3>
            <a class="item" href="https://oldinsurancemaps.net/"
              >Old Insurance Maps – Georeferencing Sanborn Fire Insurance Maps
              on Modern Maps</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 23:18:48</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46788588"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
