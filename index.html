<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38361135">
          <h3>
            <a
              class="item"
              href="https://twitter.com/aschmelyun/status/1726584677799272515"
              >My keyboard wasn't mechanical enough, so I upgraded to a rotary
              phone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 08:56:26</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38361135"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38361094">
          <h3>
            <a
              class="item"
              href="https://northvolt.com/articles/northvolt-sodium-ion/"
              >Northvolt develops state-of-the-art sodium-ion battery validated
              at 160 Wh/kg</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 08:50:05</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38361094"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38361049">
          <h3>
            <a class="item" href="https://www.idp-z3.be/"
              >The IDP Knowledge Base System</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 08:44:02</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38361049"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38360827">
          <h3>
            <a
              class="item"
              href="https://blog.pzakrzewski.com/find-legal-moves-in-brass-birmingham-with-logic-programming"
              >Find Legal Moves in Brass Birmingham with Datalog</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 08:13:42</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38360827"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38360776">
          <h3>
            <a class="item" href="https://github.com/joennlae/halutmatmul"
              >Show HN: Stella Nera – Maddness Hardware Accelerator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 08:06:23</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38360776"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38360709">
          <h3>
            <a
              class="item"
              href="https://www.gnunet.org/de/news/2023-11-RFC9498.html"
              >RFC 9498: The GNU Name System</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 07:56:33</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38360709"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38360582">
          <h3>
            <a class="item" href="https://dusted.codes/dotnet-blazor"
              >.NET Blazor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 07:41:16</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38360582"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38360148">
          <h3>
            <a
              class="item"
              href="https://www.alignmentforum.org/posts/odtMt7zbMuuyavaZB/when-do-brains-beat-brawn-in-chess-an-experiment"
              >When do "brains beat brawn" in Chess? An experiment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 06:35:48</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38360148"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38360135">
          <h3>
            <a class="item" href="https://www.rfc-editor.org/info/rfc9498"
              >RFC 9498 on the GNU Name System</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 06:33:21</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38360135"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38359523">
          <h3>
            <a
              class="item"
              href="https://www.axios.com/2023/11/20/earth-2c-warming-threshold-passed-report"
              >Earth likely briefly passed critical warming threshold on Friday
              and Saturday</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 05:03:09</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38359523"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38358032">
          <h3>
            <a
              class="item"
              href="https://www.secondstate.io/articles/mistral-7b-instruct-v0.1/"
              >Self-Hosting Open Source LLMs: Cross Devices and Local Deployment
              of Mistral 7B</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 02:12:44</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38358032"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38357736">
          <h3>
            <a
              class="item"
              href="https://observablehq.com/@ldgrp/sydney-trees-jacaranda"
              >How many jacaranda trees are there in Sydney?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 01:44:47</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38357736"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38357137">
          <h3>
            <a
              class="item"
              href="https://twitter.com/KateClarkTweets/status/1726732841730326862"
              >Former GitHub CEO Friedman and Scale AI CEO Wang Declined OpenAI
              CEO Role</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 00:36:26</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38357137"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38356534">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/openais-employees-given-explanations-why-sam-altman-out-2023-11"
              >OpenAI's employees were given two explanations for why Sam Altman
              was fired</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 23:31:57</span
              ><span class="points-container"
                >Points: <span class="points">514</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38356534"
                  >Comments</a
                ><span class="descendants">: 661</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38356361">
          <h3>
            <a
              class="item"
              href="https://www.sec.gov/news/press-release/2023-237"
              >SEC charges Kraken for operating as an unregistered securities
              exchange</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 23:16:19</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38356361"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38355502">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/FinleyTechnologies/70462b30-c31a-4db3-932a-0abb96ec5566"
              >Finley (YC W21) Is Hiring Capital Markets Team Members</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 21:58:33</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38354939">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2023/10/31/health/fda-considers-crispr-treatment-cure-sickle-cell/index.html"
              >FDA considers first CRISPR gene editing treatment that may cure
              sickle cell</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 21:18:00</span
              ><span class="points-container"
                >Points: <span class="points">258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38354939"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38354788">
          <h3>
            <a
              class="item"
              href="https://tailscale.com/blog/quic-udp-throughput/"
              >Increasing QUIC and UDP Throughput over Tailscale</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 21:07:55</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38354788"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38354422">
          <h3>
            <a class="item" href="https://typst.app/"
              >Typst – Compose Papers Faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 20:44:03</span
              ><span class="points-container"
                >Points: <span class="points">312</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38354422"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38353473">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38353473"
              >Launch HN: Stralis (YC W23) – Hydrogen electric aircraft for
              medium-haul travel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 19:47:49</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38353473"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
            <div class="text">
              <a href="https://stralis.aero">https://stralis.aero</a>). We’re
              taking advantage of hydrogen electric propulsion technology to
              design a low cost, 50-seat aircraft that can replace a significant
              portion of the ubiquitous single-aisle (e.g. Boeing 737) market
              that makes up ~60% of commercial aircraft sold. We are starting
              out by developing the propulsion system for a 6-seat Beechcraft
              Bonanza. So far, we have installed and tested the electric motor
              and performed some benchtop fuel cell testing. Here’s a quick
              video showing what it looks like these days:
              <a href="https://vimeo.com/879966330"
                >https://vimeo.com/879966330</a
              >. Next step is to perform some system testing with a COTS fuel
              cell, whilst we progress our own fuel cell development. We are
              currently working through setting up our hydrogen electric
              propulsion test lab at Brisbane International Airport, which will
              allow us to rapidly prototype subsystems and generate the data we
              need for the 50 seat, SA-1, design. Quick fly through video of our
              facility here:
              <a href="https://vimeo.com/884325165"
                >https://vimeo.com/884325165</a
              >
              <p>
                Airlines are anticipating the need to de-carbonise, driven by
                legislation or by customer pressure, but there is not yet any
                emission-free aircraft solution that is practical and
                cost-effective to adopt. Other solutions are either too heavy,
                like batteries and automotive industry fuel cells, or too
                expensive and inefficient, like sustainable aviation fuel. It is
                important to get a low enough CASM (Cost per Available Seat
                Mile) to allow operators to switch to a sustainable solution
                without having to dramatically increase ticket prices.
              </p>
              <p>
                Bob and I met at a company called magniX, who develop high
                specific power electric motors. magniX quickly identified
                aerospace as a major market for their technology but at the
                time, most of the customers were working on battery electric
                solutions for de-carbonizing air travel. We were personally
                involved in 3 aircraft platforms (that have flown) that used our
                motors. Whilst we are super proud of what we achieved and
                overcoming the technical hurdles to fly those planes, it became
                clear that batteries were never going to be the solution to
                de-carbonising a significant portion of air travel. We went on
                to work at a few different sustainable aviation companies, and
                slowly became convinced that hydrogen would be the only
                technology that would have a chance of achieving the goal of
                sustainable aviation. There is a lot of public discourse on what
                is the best technology to solve this high-stakes problem, but
                instead of arguing about what can and can't work, we decided it
                would be best to dive into the technology and give our best go
                at what we think has the best chance.
              </p>
              <p>
                Our propulsion system is quite straightforward—we carry liquid
                hydrogen in a composite, vacuum insulated storage tank. We boil
                off the hydrogen and feed it into the fuel cell. We take air
                from outside the plane to supply the fuel cell with oxygen.
                Hydrogen and oxygen react in the fuel cell and produce
                electricity, with water vapor being the only by-product. The
                electricity then powers a lightweight electric motor that spins
                a propeller.
              </p>
              <p>
                Unlike most other fuel cell systems, we use the oxygen supply
                air to cool the fuel cell as well — removing the need for large,
                heavy and draggy external heat exchangers. This is achieved
                through our choice of fuel cell membrane with a much higher
                operating temperature (180 C). We remove the weight of the heat
                exchangers but also reduce the weight of the propulsion system
                as we don’t need to overcome the extra drag created by the
                radiators. All of this combines to reduce the fuel cell system
                weight by about 40%, which equates to a doubling of our payload
                capacity and, therefore, half the CASM, when compared to a
                conventional PEM fuel cell system.
              </p>
              <p>
                In addition to our tech, we are also approaching the market
                differently. We think that a 50-seat aircraft is the optimum
                size for an aircraft with our hydrogen electric propulsion. This
                is different from conventional turbofan technology where the
                optimum size appears to be about 200 seats. All of our
                competitors are working towards a family of aircraft going
                upwards of 200 seats (Airbus are only focusing on larger
                aircraft) but we think there are diminishing returns from
                building larger hydrogen electric aircraft. Instead, we are
                honing in on a 50-seat design, optimized for hydrogen electric
                and designed with automotive manufacture methods in mind. There
                could be a market demand for up to 50,000 aircraft within the
                next 25 years, driven by more efficient, point-to-point routes.
                Most other aircraft programs deliver around 1,000 units, which
                generally doesn't warrant a large amount of automation, and
                keeps unit costs high.
              </p>
              <p>
                Hydrogen fuel cells are not new, but we think the need to
                de-carbonise, the reduction in renewable energy costs, and the
                improvement in component technologies such as motors, power
                electronics, batteries etc. make today the best time to pursue
                this solution to sustainable air travel. We would love to hear
                from any of you who have worked in aerospace, sustainable
                aviation fuel (the biggest alternative to hydrogen) and the
                hydrogen industry. We would also like to hear from people who
                fly often, and airlines, to learn how important a switch to a
                sustainable solution is to you. Looking forward to reading all
                the comments!
              </p>
            </div>
          </section>
        </section>
        <section id="38353285">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2311.08516"
              >LLMs cannot find reasoning errors, but can correct them</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 19:35:27</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38353285"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38352484">
          <h3>
            <a
              class="item"
              href="https://www.itbrew.com/stories/2023/11/17/after-boeing-declines-to-pay-up-ransomware-group-leaks-45-gb-of-data"
              >After Boeing declines to pay up, ransomware group leaks 45 GB of
              data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 18:47:18</span
              ><span class="points-container"
                >Points: <span class="points">497</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38352484"
                  >Comments</a
                ><span class="descendants">: 334</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38344358">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Vespa_150_TAP"
              >Anti Tank Vespa</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 08:08:08</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38344358"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38343957">
          <h3>
            <a
              class="item"
              href="https://lab.scub.net/architecture-patterns-the-circuit-breaker-8f79280771f1"
              >Architecture Patterns: The Circuit-Breaker</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 07:30:51</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38343957"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38343933">
          <h3>
            <a
              class="item"
              href="https://www.n16f.net/blog/interactive-common-lisp-development/"
              >Interactive Common Lisp Development</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 07:27:42</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38343933"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38343748">
          <h3>
            <a
              class="item"
              href="https://retrocomputing.stackexchange.com/questions/3019/why-did-base64-win-against-uuencode"
              >Why did base64 win against uuencode?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 07:08:53</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38343748"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38331770">
          <h3>
            <a class="item" href="http://antirez.com/news/136"
              >Writing Wohpe (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 11:51:07</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38331770"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38331097">
          <h3>
            <a class="item" href="http://www.floodgap.com/retrotech/xa/"
              >Xa: Open-source 6502 cross assembler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 10:03:47</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38331097"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38330877">
          <h3>
            <a
              class="item"
              href="https://engineering.atspotify.com/2014/02/how-to-shuffle-songs/"
              >How to Shuffle Songs? (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 09:33:47</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38330877"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38317893">
          <h3>
            <a
              class="item"
              href="https://electronics.stackexchange.com/questions/623358/wouldnt-charging-a-lithium-battery-to-80-only-defeat-the-purpose-of-putting-th"
              >Charging a lithium battery to 80% only?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 10:40:23</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38317893"
                  >Comments</a
                ><span class="descendants">: 172</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
