<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44343840">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=6CfLC5xVy90"
              >Linux on the Behringer X32 [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-22 @ 05:05:07</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44343840"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44342977">
          <h3>
            <a
              class="item"
              href="https://henryhmko.github.io/posts/tpu/tpu.html"
              >TPU (Tensor Processing Unit) Deep Dive</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-22 @ 02:51:03</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44342977"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44342731">
          <h3>
            <a class="item" href="https://github.com/lfnoise/sapf"
              >Sound As Pure Form: Music Language Inspired by Supercollider,
              APL, and Forth</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-22 @ 02:17:51</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44342731"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.youtube.com/watch?v=FY2WYXOdXoM"
                >https://www.youtube.com/watch?v=FY2WYXOdXoM</a
              >
            </div>
          </section>
        </section>
        <section id="44341639">
          <h3>
            <a class="item" href="https://www.bbc.co.uk/news/live/ckg3rzj8emjt"
              >U.S. bombs Iranian nuclear sites</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-22 @ 00:00:16</span
              ><span class="points-container"
                >Points: <span class="points">595</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44341639"
                  >Comments</a
                ><span class="descendants">: 1611</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44340386">
          <h3>
            <a
              class="item"
              href="https://www.filmlabs.org/wiki/en/meetings_projects/spectral/laborberlin16mmprojector/start"
              >LaborBerlin: State-of-the-Art 16mm Projector</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-21 @ 20:08:30</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44340386"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44339596">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2025-06-20/ai-is-ushering-in-the-tiny-team-era-in-silicon-valley"
              >AI is ushering in a 'tiny team' era</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-21 @ 18:21:27</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44339596"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44339076">
          <h3>
            <a class="item" href="https://alltracker.github.io/"
              >AllTracker: Efficient Dense Point Tracking at High Resolution</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-21 @ 17:09:35</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44339076"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44338562">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44338562"
              >Tell HN: Beware confidentiality agreements that act as lifetime
              non competes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-21 @ 16:02:24</span
              ><span class="points-container"
                >Points: <span class="points">295</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44338562"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
            <div class="text">
              <p>
                Companies don’t really need non-competes anymore. Some companies
                take an extremely broad interpretation of IP confidentiality,
                where they consider doing any work in the industry during your
                lifetime an inevitable confidentiality violation. They argue it
                would be impossible for you to work elsewhere in this industry
                <i>during your entire career</i> without violating
                confidentiality with the technical and business instincts you
                bring to that domain. It doesn’t require conscious violation on
                your part (they argue).
              </p>
              <p>So beware and read your employment agreement carefully.</p>
              <p>
                More here
                <a
                  href="https://www.promarket.org/2024/02/08/confidentiality-agreements-can-act-like-noncompetes/"
                  >https://www.promarket.org/2024/02/08/confidentiality-agreeme...</a
                >
              </p>
              <p>And this is the insane legal doctrine behind this</p>
              <p>
                <a href="https://en.m.wikipedia.org/wiki/Inevitable_disclosure"
                  >https://en.m.wikipedia.org/wiki/Inevitable_disclosure</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44336381">
          <h3>
            <a class="item" href="https://mmondrian.com/">Show HN: MMOndrian</a>
          </h3>
          <section>
            <h4>
              <span>2025-06-21 @ 10:39:21</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44336381"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              Made a collaborative, persistent state Mondrian-style painting
              editor. Feedback welcome!
            </div>
          </section>
        </section>
        <section id="44336015">
          <h3>
            <a
              class="item"
              href="https://clickhouse.com/blog/scaling-observability-beyond-100pb-wide-events-replacing-otel"
              >Scaling our observability platform by embracing wide events and
              replacing OTel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-21 @ 09:23:21</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44336015"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44335664">
          <h3>
            <a class="item" href="https://testflight.apple.com/join/JjTcThrV"
              >uBlock Origin Lite Beta for Safari iOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-21 @ 08:10:50</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44335664"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44335517">
          <h3>
            <a
              class="item"
              href="https://www.lemonde.fr/en/science/article/2025/06/21/gwada-negative-french-scientists-find-new-blood-type-in-woman_6742577_10.html"
              >'Gwada negative': French scientists find new blood type in
              woman</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-21 @ 07:38:42</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44335517"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44335065">
          <h3>
            <a class="item" href="https://delta.chat/en/"
              >Delta Chat is a decentralized and secure messenger app</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-21 @ 06:29:00</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44335065"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44334167">
          <h3>
            <a
              class="item"
              href="https://smex.org/open-letter-to-samsung-end-forced-israeli-app-installations-in-the-wana-region/"
              >Samsung embeds IronSource spyware app on phones across WANA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-21 @ 03:06:42</span
              ><span class="points-container"
                >Points: <span class="points">737</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44334167"
                  >Comments</a
                ><span class="descendants">: 425</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44328326">
          <h3>
            <a
              class="item"
              href="https://fly.io/blog/phoenix-new-the-remote-ai-runtime/"
              >Phoenix.new – Remote AI Runtime for Phoenix</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-20 @ 14:57:04</span
              ><span class="points-container"
                >Points: <span class="points">556</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44328326"
                  >Comments</a
                ><span class="descendants">: 245</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44323562">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/axolotls-may-hold-the-key-to-regrowing-limbs-and-scientists-are-unraveling-their-secrets-to-help-humans-do-the-same-180986781/"
              >Axolotls May Hold the Key to Regrowing Limbs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-19 @ 23:48:20</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44323562"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44320435">
          <h3>
            <a
              class="item"
              href="https://blog.cr.yp.to/20231003-countcorrectly.html"
              >Debunking NIST's calculation of the Kyber-512 security level
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-19 @ 16:58:50</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44320435"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44314305">
          <h3>
            <a class="item" href="https://sarupro.itch.io/thenyanja"
              >The Nyanja new PC-Engine/TurboGrafx 16-bit console game in
              development</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-19 @ 00:02:20</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44314305"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44314234">
          <h3>
            <a
              class="item"
              href="https://sol.sbc.org.br/index.php/sblp/article/view/30252/30059"
              >Compact Representations for Arrays in Lua [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 23:49:18</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44314234"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44312363">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/claude-code-remote-mcp?campaignId=13926158&amp;source=i_email&amp;medium=email&amp;content=Oct2024AnalysisTool&amp;messageTypeId=140367"
              >Remote MCP Support in Claude Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 18:52:24</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44312363"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44310763">
          <h3>
            <a class="item" href="https://airpass.tiagoalves.me/"
              >Airpass – easily overcome WiFi time limits</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 15:29:30</span
              ><span class="points-container"
                >Points: <span class="points">294</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44310763"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44309734">
          <h3>
            <a
              class="item"
              href="https://blog.engora.com/2023/05/the-bad-boy-of-bar-charts-william.html"
              >The bad boy of bar charts: William Playfair (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 13:29:31</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44309734"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44309279">
          <h3>
            <a class="item" href="https://github.com/tsoding/b"
              >Compiler for the B Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 12:27:51</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44309279"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44309191">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/denmark-let-amateurs-dig-for-treasure-and-it-paid-off/"
              >Denmark's Archaeology Experiment Is Paying Off in Gold and
              Knowledge</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 12:13:15</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44309191"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44308953">
          <h3>
            <a
              class="item"
              href="https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/"
              >Unexpected security footguns in Go's parsers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 11:35:12</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44308953"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44308328">
          <h3>
            <a class="item" href="https://briefer.cloud/blog/posts/p-hacking/"
              >P-Hacking in Startups</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 09:56:28</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44308328"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44307976">
          <h3>
            <a class="item" href="https://luna-rail.com/en/home-2"
              >Show HN: Luna Rail – treating night trains as a spatial
              optimization problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 08:50:30</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44307976"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44307667">
          <h3>
            <a class="item" href="https://zoo.cuichen.cc/"
              >Type Inference Zoo</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 08:02:32</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44307667"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44307552">
          <h3>
            <a class="item" href="https://p2piano.com/"
              >P2piano: A P2P collaboration space for the musically inclined</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 07:45:22</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44307552"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44306892">
          <h3>
            <a
              class="item"
              href="https://www.omgubuntu.co.uk/2025/06/microsoft-edit-text-editor-ubuntu"
              >Using Microsoft's New CLI Text Editor on Ubuntu</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-18 @ 05:25:36</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44306892"
                  >Comments</a
                ><span class="descendants">: 246</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
