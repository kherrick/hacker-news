<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40695165">
          <h3>
            <a
              class="item"
              href="https://popovicu.com/posts/making-my-first-embedded-linux-system/"
              >Making my first embedded Linux system</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 06:51:25</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40695165"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40694948">
          <h3>
            <a class="item" href="https://flitter.pages.dev"
              >Show HN: I made first declaritive SVG,canvas framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 05:45:27</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40694948"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              you can make your own chart or diagram easily than using d3
            </div>
          </section>
        </section>
        <section id="40694909">
          <h3>
            <a
              class="item"
              href="https://www.irwincollier.com/harvard-enrollment-and-final-exam-for-railroad-practice-daggett-1906-1907/"
              >Harvard Railroad Economics Exam (1906)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 05:33:12</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40694909"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40694805">
          <h3>
            <a class="item" href="https://www.paste2download.com/"
              >Show HN: Paste2Download – No Login, No Ads, Download Videos
              Watermark Free</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 05:05:43</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40694805"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm excited to share Paste2Download, a web app that lets you
                download videos from various platforms like TikTok, YouTube,
                Instagram Reels, YouTube Shorts, Pinterest, and even 9Gag, all
                without watermarks.
              </p>
              <p>
                What it does: Paste2Download simplifies the process of
                downloading videos by allowing you to paste a video URL from
                multiple platforms and download the video directly to your
                device. It removes watermarks and supports a wide range of video
                sources.
              </p>
              <p>
                Why I built it: There are plenty of sites that can help with
                downloading videos from TikTok, but many of these websites are
                cluttered with banners and ads, making them slow and cumbersome
                to use. I wanted to create a tool that offers a seamless,
                ad-free experience. Paste2Download is designed to be super clean
                and fast, providing a hassle-free way to download videos.
              </p>
              <p>
                Feedback: I’d love to get your feedback! Let me know what you
                think, any suggestions, or if you encounter any issues.
              </p>
            </div>
          </section>
        </section>
        <section id="40694768">
          <h3>
            <a class="item" href="https://blog.sofiane.cc/ssh_honeypot/"
              >What You Get After Running an SSH Honeypot for 30 Days</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 04:52:12</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40694768"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40694616">
          <h3>
            <a
              class="item"
              href="https://gbatemp.net/threads/doom-for-snes-full-source-code-released-by-former-sculptured-software-employees.657118/"
              >Doom for SNES full source code released by former Sculptured
              Software employee</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 04:08:19</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40694616"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40694375">
          <h3>
            <a
              class="item"
              href="https://github.com/fudan-generative-vision/hallo"
              >Highly realistic talking head video generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 03:04:31</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40694375"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40694254">
          <h3>
            <a
              class="item"
              href="https://docs.murexrobotics.com/elec/boards/networking/switch"
              >Show HN: We Made The World's Smallest and Cheapest Network
              Switch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 02:26:55</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40694254"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
            <div class="text">
              <p>
                You can find us at byran@mrx.ee and max@mrx.ee as well if you
                have any questions.
              </p>
              <p>
                We will be putting a small run of these boards for sale
                somewhere (we have &lt;25 units of stock), probably for
                $10+shipping. Let us know if you're interested in more!
              </p>
              <p>
                Board files for everything we make is here:
                <a href="https://github.com/murexrobotics/electrical-2024"
                  >https://github.com/murexrobotics/electrical-2024</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40694103">
          <h3>
            <a
              class="item"
              href="https://anthonynsimon.com/blog/one-man-saas-architecture/"
              >The Architecture Behind a One-Person Tech Startup (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 01:51:54</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40694103"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40693944">
          <h3>
            <a class="item" href="https://micropolisweb.com/"
              >SimCity in the web browser using WebAssembly and OpenGL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 01:12:38</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40693944"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40693451">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/google-cloudflare-cisco-will-poison-dns-to-stop-piracy-block-circumvention-240613/"
              >Google, Cloudflare and Cisco will poison DNS to stop piracy block
              circumvention</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 23:26:20</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40693451"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40692535">
          <h3>
            <a class="item" href="https://k3xec.com/td158/"
              >Reverse engineering a restaurant pager system</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 20:37:28</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40692535"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40691929">
          <h3>
            <a class="item" href="https://www.georgefairbanks.com/book/"
              >Just Enough Software Architecture (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 19:02:38</span
              ><span class="points-container"
                >Points: <span class="points">256</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40691929"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40691133">
          <h3>
            <a
              class="item"
              href="https://terrytao.wordpress.com/2024/04/19/two-announcements-ai-for-math-resources-and-erdosproblems-com/"
              >AI for math resources, and erdosproblems.com</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 17:24:12</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40691133"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40691042">
          <h3><a class="item" href="https://sky.esa.int/esasky/">ESASky</a></h3>
          <section>
            <h4>
              <span>2024-06-15 @ 17:10:57</span
              ><span class="points-container"
                >Points: <span class="points">297</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40691042"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40690990">
          <h3>
            <a class="item" href="https://github.com/jarusll/keydogger"
              >Show HN: Keydogger – Minimal keyboard macro for Linux
              (Wayland)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 17:03:26</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40690990"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">Works using uinput &amp;amp; wl-clipboard</div>
          </section>
        </section>
        <section id="40690718">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/solar-panels-breaking-efficiency-records"
              >Engineer's solar panels are breaking efficiency records</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 16:25:03</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40690718"
                  >Comments</a
                ><span class="descendants">: 223</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40689759">
          <h3>
            <a
              class="item"
              href="https://thoughtforms.life/a-most-profound-video-game-a-good-cognitive-aid-for-research-at-the-frontier-of-life-and-mind/"
              >A most profound video game: a good cognitive aid for research</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 13:43:40</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40689759"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40689750">
          <h3>
            <a
              class="item"
              href="https://blog.gistre.epita.fr/posts/benjamin.peter-2022-10-28-address_sanitizer_internals/"
              >Address Sanitizer Internals</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 13:42:08</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40689750"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40689296">
          <h3>
            <a class="item" href="https://github.com/meliharvey/threescaper"
              >Threescaper: A website for loading Townscaper models into
              Three.js</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 12:13:43</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40689296"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40689231">
          <h3>
            <a
              class="item"
              href="https://www.ribbonfarm.com/2018/04/24/survival-of-the-mediocre-mediocre/"
              >Survival of the Mediocre Mediocre (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 12:00:31</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40689231"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40688921">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/style/article/japan-new-banknotes-great-wave/index.html"
              >Hokusai's 'Great Wave' features on new Japanese banknotes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 10:56:17</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40688921"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40688771">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/ernest-shackletons-last-ship-quest-discovered-off-the-coast-of-canada-180984545/"
              >Ernest Shackleton's Last Ship, Quest, Discovered Off the Coast of
              Canada</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 10:20:16</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40688771"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40688505">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/lifeandstyle/article/2024/jun/15/the-big-problem-is-water-uk-ebike-owners-plagued-by-failing-motors"
              >'The big problem is water': UK ebike owners plagued by failing
              motors</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 09:11:13</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40688505"
                  >Comments</a
                ><span class="descendants">: 201</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40688138">
          <h3>
            <a
              class="item"
              href="https://eclecticlight.co/2024/06/15/a-brief-history-of-mac-enclaves-and-exclaves/"
              >A brief history of Mac enclaves and exclaves</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 07:39:41</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40688138"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40687751">
          <h3>
            <a class="item" href="https://visualprogramming.net/"
              >VVVV – A hybrid visual/textual development environment for
              .NET</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 05:41:06</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40687751"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40686728">
          <h3>
            <a
              class="item"
              href="https://www.ryantolsma.com/thoughts/2024/06/14/topological-voting.html"
              >Topological Problems in Voting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 01:20:21</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40686728"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40685173">
          <h3>
            <a
              class="item"
              href="http://siek.blogspot.com/2024/06/sequential-search-correctly.html"
              >Sequential Search, Correctly</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 21:10:41</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40685173"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40682863">
          <h3>
            <a
              class="item"
              href="https://www.openmymind.net/Leveraging-Zigs-Allocators/"
              >Leveraging Zig's Allocators</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 17:34:47</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40682863"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40663686">
          <h3>
            <a
              class="item"
              href="https://bignerdranch.com/blog/finding-new-pastures-big-nerd-ranchs-next-chapter/"
              >Finding New Pastures: Big Nerd Ranch's Next Chapter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-12 @ 22:00:10</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40663686"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
