<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39317107">
          <h3>
            <a
              class="item"
              href="https://morethancoding.com/2024/02/09/the-3-standup-questions-are-terrible-and-need-to-die/"
              >The "3 standup questions" are terrible and need to die</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 17:00:56</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39317107"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39317100">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39317100"
              >GoGoGrandparent (YC S16) is hiring a senior/staff back
              end/full-stack engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 17:00:14</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                The position: FULLY REMOTE | Full-time | US, UK, or able to work
                4+ hours overlap with mainland US (UK time working hours also
                OK) | $100k to $140k
              </p>
              <p>
                Build high-quality, robust engineering at the rarest of things -
                a Silicon Valley startup that is both wholesome AND profitable.
                We have 8-figure revenue, are YC-backed, and growing fast.
              </p>
              <p>
                Tech stack (<i>required): Back-end heavy (Node</i>, Typescript<i
                  >, MySQL</i
                >, REST*+GraphQL), front-end (Vue), deploy (AWS, Docker/K8s)
              </p>
              <p>
                Minimum 6 years experience (mostly Node). If full-stack, you
                must be strongest on the backend.
              </p>
              <p>2-stage interview process.</p>
              <p>
                If you want to help older adults and people with disabilities,
                send your LinkedIn/CV to william@gogograndparent.com (keep it
                brief) or apply at
                <a
                  href="https://www.ycombinator.com/companies/gogograndparent/jobs"
                  >https://www.ycombinator.com/companies/gogograndparent/jobs</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39316796">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/02/09/-inflation-in-december-was-even-lower-than-first-reported-the-government-says.html"
              >Inflation in December was even lower than first reported, the
              government says</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 16:43:19</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39316796"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39316707">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-02-09/another-great-retirement-wave-hits-the-us-after-stocks-rally"
              >Another 'Great Retirement' Wave Hits the US After Stocks Rally</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 16:38:43</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39316707"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39316653">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39316653"
              >I'm an engineer that needs to sell my services. Any good books on
              sales?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 16:35:36</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39316653"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              I recently left my role as a lead devops engineer and would like
              to work for myself under a devops service contract model (multiple
              clients, each part-time). Unfortunately, I know nothing about
              sales or the mechanics of creating and following up on leads. Are
              there any good books that can explain the tools and workflows of
              someone who works in sales? Thanks in advance.
            </div>
          </section>
        </section>
        <section id="39316365">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/column-preservation-of-abandoned-places"
              >A Case for the Preservation of Abandoned Places</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 16:19:12</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39316365"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39316266">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/02/09/240_4_ipv4_block_activism/"
              >250M-plus reserved IPv4 addresses could be released</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 16:11:41</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39316266"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39316257">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/london-underground-ai-surveillance-documents/"
              >London Underground Is Testing Real-Time AI Surveillance Tools to
              Spot Crime</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 16:10:53</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39316257"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39316234">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/tech-industry/cryptomining/just-137-crypto-miners-use-23-of-total-us-power-government-now-requiring-commercial-miners-to-report-energy-consumption"
              >Just 137 crypto miners use 2.3% of total U.S. power</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 16:08:21</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39316234"
                  >Comments</a
                ><span class="descendants">: 314</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39316193">
          <h3>
            <a class="item" href="https://ctan.org/pkg/coffeestains"
              >Add coffee stains to LaTeX documents (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 16:05:00</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39316193"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39316084">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/02/02/climate/sun-shade-climate-geoengineering.html"
              >Could a Giant Parasol in Outer Space Help Solve the Climate
              Crisis?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 15:55:26</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39316084"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39315986">
          <h3>
            <a class="item" href="https://www.goody2.ai/chat"
              >Goody-2, the world's most responsible AI model</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 15:48:29</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39315986"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39315880">
          <h3>
            <a
              class="item"
              href="https://fedoramagazine.org/introducing-fedora-atomic-desktops/"
              >Fedora Atomic Desktops</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 15:40:30</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39315880"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39315847">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/02/09/world/europe/eiffel-tower-matchsticks-guinness.html"
              >In Reversal, Guinness Gives a Frenchman's Matchstick Eiffel Tower
              the Record</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 15:38:23</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39315847"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39315378">
          <h3>
            <a
              class="item"
              href="https://astrobiology.com/2024/02/what-turned-earth-into-a-giant-snowball-700m-years-ago.html"
              >What Turned Earth into a Giant Snowball 700M Years Ago?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 14:54:16</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39315378"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39314189">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2024/02/09/tech/china-huawei-france-financial-investigation-intl-hnk/index.html"
              >Huawei's offices in France raided by financial prosecutors</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 12:41:05</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39314189"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39313891">
          <h3>
            <a
              class="item"
              href="https://github.com/honojs/hono/releases/tag/v4.0.0"
              >Hono v4.0.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 11:55:10</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39313891"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39313696">
          <h3>
            <a
              class="item"
              href="https://www.gregegan.net/PERMUTATION/Permutation.html"
              >Permutation City (1994)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 11:18:07</span
              ><span class="points-container"
                >Points: <span class="points">240</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39313696"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39311507">
          <h3>
            <a class="item" href="https://rachelbythebay.com/w/2024/02/08/ldap/"
              >Figure out who's leaving the company: dump, diff, repeat</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 04:46:02</span
              ><span class="points-container"
                >Points: <span class="points">514</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39311507"
                  >Comments</a
                ><span class="descendants">: 338</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39310837">
          <h3>
            <a
              class="item"
              href="https://www.citusdata.com/blog/2024/02/08/whats-new-in-postgres-16-query-planner-optimizer/"
              >What's new in the Postgres 16 query planner</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-09 @ 02:52:10</span
              ><span class="points-container"
                >Points: <span class="points">231</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39310837"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39301839">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Light_characteristic"
              >Light Characteristic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-08 @ 13:46:40</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39301839"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39300985">
          <h3>
            <a
              class="item"
              href="https://idlewords.com/2008/04/controlled_tango_into_terrain.htm"
              >Controlled Tango into Terrain (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-08 @ 12:05:35</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39300985"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39300859">
          <h3>
            <a
              class="item"
              href="https://craftinginterpreters.com/compiling-expressions.html"
              >Compiling Expressions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-08 @ 11:49:20</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39300859"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39300629">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Cyclomatic_complexity"
              >Cyclomatic Complexity</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-08 @ 11:11:21</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39300629"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39300573">
          <h3>
            <a
              class="item"
              href="https://engineeringatscale.substack.com/p/how-quic-is-displacing-tcp-for-speed"
              >How QUIC is displacing TCP for speed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-08 @ 11:02:18</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39300573"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39299794">
          <h3>
            <a
              class="item"
              href="https://hegdenu.net/posts/debugging-tokio-instrumentation/"
              >Debugging Tokio Instrumentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-08 @ 08:51:51</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39299794"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39299715">
          <h3>
            <a
              class="item"
              href="https://zenhorace.dev/blog/context-control-go/"
              >Context Control in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-08 @ 08:40:58</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39299715"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39299482">
          <h3>
            <a
              class="item"
              href="https://blog.fponzi.me/2024-02-02-lamport-clocks.html"
              >Lamport Clocks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-08 @ 08:01:00</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39299482"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39299455">
          <h3>
            <a class="item" href="https://colourclash.co.uk/spectrum-analyser/"
              >Spectrum Analyser, a Sinclair ZX Spectrum reverse engineering
              tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-08 @ 07:55:58</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39299455"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39299419">
          <h3>
            <a
              class="item"
              href="https://support.nooelec.com/hc/en-us/articles/10407982882327-Receiving-Weather-Satellite-Images-Using-SatDump"
              >Receiving Weather Satellite Images Using SatDump</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-08 @ 07:50:19</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39299419"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
