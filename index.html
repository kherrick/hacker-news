<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43269368">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/euv-light-source"
              >The Tiny Star Explosions Powering Moore's Law</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 17:09:41</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43269368"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43269332">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/search/ai-mode-search/"
              >Expanding AI Overviews and Introducing AI Mode</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 17:07:17</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43269332"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43269237">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/greptile/jobs/rMIxqoV-design-engineer"
              >Greptile (YC W24) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 17:00:10</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43268454">
          <h3>
            <a
              class="item"
              href="https://fangpenlin.com/posts/2024/12/30/my-beancount-books-are-95-percent-automatic/"
              >My Beancount books are 95% automatic after 3 years (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 16:08:02</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43268454"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43268411">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-03-years-efforts-yellowstone-bison-population.html"
              >After 120 years, Yellowstone bison are a single breeding
              population</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 16:04:49</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43268411"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43268401">
          <h3>
            <a class="item" href="https://jcgt.org/published/0014/01/05/"
              >JCGT – Arc Blanc: a real time ocean simulation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 16:04:11</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43268401"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43267857">
          <h3>
            <a class="item" href="https://noiseexplorer.com/"
              >Design and Explore Noise Handshake Patterns (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 15:29:56</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43267857"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43267095">
          <h3>
            <a
              class="item"
              href="https://newsletter.posthog.com/p/50-things-weve-learned-about-building"
              >Things we've learned about building successful products</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 14:44:04</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43267095"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43266537">
          <h3>
            <a class="item" href="https://www.apple.com/macbook-air/"
              >MacBook Air M4</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 14:06:54</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43266537"
                  >Comments</a
                ><span class="descendants">: 285</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43266474">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2025/03/apple-unveils-new-mac-studio-the-most-powerful-mac-ever/"
              >Apple unveils new Mac Studio, the most powerful Mac ever,
              featuring M4 Max</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 14:00:57</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43266474"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43266453">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2025/03/apple-reveals-m3-ultra-taking-apple-silicon-to-a-new-extreme/"
              >Apple M3 Ultra</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 13:59:50</span
              ><span class="points-container"
                >Points: <span class="points">439</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43266453"
                  >Comments</a
                ><span class="descendants">: 474</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43266029">
          <h3>
            <a
              class="item"
              href="https://www.middleeastmonitor.com/20250304-how-a-key-ingredient-in-coca-cola-mms-is-smuggled-from-war-torn-sudan/"
              >How a key ingredient in Coca-Cola, M&amp;amp;M's is smuggled from
              war-torn Sudan</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 13:18:28</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43266029"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43265521">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/03/05/technology/digg-alexis-ohanian-kevin-rose.html"
              >The Return of Digg, a Star of an Earlier Internet Era</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 12:06:40</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43265521"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43265431">
          <h3>
            <a class="item" href="https://ms-paint-i.de/">MS Paint IDE</a>
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 11:52:28</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43265431"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43265303">
          <h3>
            <a
              class="item"
              href="https://www.nasa.gov/general/nasa-successfully-acquires-gps-signals-on-moon/"
              >NASA Successfully Acquires GPS Signals on Moon</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 11:29:50</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43265303"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43264957">
          <h3>
            <a
              class="item"
              href="https://lynxjs.org/blog/lynx-unlock-native-for-more.html"
              >Lynx: Open Source Native Cross Platform framework used in
              TikTok</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 10:25:55</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43264957"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43264847">
          <h3>
            <a class="item" href="https://awards.acm.org/about/2024-turing"
              >Richard Sutton and Andrew Barto Win 2024 Turing Award</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 10:03:31</span
              ><span class="points-container"
                >Points: <span class="points">323</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43264847"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43262510">
          <h3>
            <a class="item" href="https://delta.chat/"
              >Delta Chat – Email Based PGP Encrypted Chat</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 03:50:21</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43262510"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43262188">
          <h3>
            <a
              class="item"
              href="https://fatsquirrel.org/oldfartsalmanac/netbsd-on-a-javastation/"
              >NetBSD on a JavaStation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 03:11:54</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43262188"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43261933">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/peripherals/printers/brother-accused-of-locking-down-third-party-printer-ink-cartridges-via-firmware-updates-removing-older-firmware-versions-from-support-portals"
              >Brother accused of locking down third-party printer ink
              cartridges</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 02:34:47</span
              ><span class="points-container"
                >Points: <span class="points">460</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43261933"
                  >Comments</a
                ><span class="descendants">: 282</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43261729">
          <h3>
            <a class="item" href="https://www.xmox.nl/"
              >Mox – modern, secure, all-in-one email server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 01:58:11</span
              ><span class="points-container"
                >Points: <span class="points">462</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43261729"
                  >Comments</a
                ><span class="descendants">: 256</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43258709">
          <h3>
            <a
              class="item"
              href="https://fabiensanglard.net/fastdoom/index.html"
              >Why fastDOOM is fast</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-04 @ 19:05:43</span
              ><span class="points-container"
                >Points: <span class="points">635</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43258709"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43257323">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43257323"
              >Launch HN: Enhanced Radar (YC W25) – A safety net for air traffic
              control</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-04 @ 17:04:17</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43257323"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
            <div class="text">
              <p>
                Recent weeks have put aviation safety on everyone’s mind, but
                we’ve been thinking about this problem for years. Both of us are
                pilots — we have 2,500 hours of flight time between us. Eric
                flew professionally and holds a Gulfstream 280 type rating and
                both FAA and EASA certificates. Kristian flies recreationally,
                and before this worked on edge computer vision for satellites.
              </p>
              <p>
                We know from our flying experience that air traffic management
                is imperfect (every pilot can tell stories of that one time…),
                so this felt like an obvious problem to work on.
              </p>
              <p>
                Most accidents are the result of an overdetermined “accident
                chain” (<a
                  href="https://code7700.com/accident_investigation.htm"
                  >https://code7700.com/accident_investigation.htm</a
                >). The popular analogy here is the swiss cheese model, where
                holes in every slice line up perfectly to cause an accident.
                Often, at least one link in that chain is human error.
              </p>
              <p>
                We’ll avoid dissecting this year’s tragedies and take a close
                call from last April at DCA as an example:
              </p>
              <p>
                The tower cleared JetBlue 1554 to depart on Runway 04, but
                simultaneously a ground controller on a different frequency
                cleared a Southwest jet to cross that same runway, putting them
                on a collision course. Controllers noticed the conflict
                unfolding and jumped in to yell at both aircraft to stop,
                avoiding a collision with about 8 seconds to spare (<a
                  href="https://www.youtube.com/watch?v=yooJmu30DxY"
                  >https://www.youtube.com/watch?v=yooJmu30DxY</a
                >).
              </p>
              <p>
                Importantly, the error that caused this incident occurred
                approximately 23 seconds before the conflict became obvious. In
                this scenario, a good solution would be a system that
                understands when an aircraft has been cleared to depart from a
                runway, and then makes sure no aircraft are cleared to cross (or
                are in fact crossing) that runway until the departing aircraft
                is wheels-up. And so on.
              </p>
              <p>
                To do this, we’ve developed Yeager, an ensemble of models
                including state of the art speech-to-text that can understand
                ATC audio. It’s trained on a large amount of our own labeled ATC
                audio collected from our VHF receivers located at airports
                around the US. We improve performance by injecting context such
                as airport layout details, nearby/relevant navaids, and
                information on all relevant aircraft captured via ADS-B.
              </p>
              <p>
                Our product piggy-backs on the raw signal in the air (VHF radio
                from towers to pilots) by having our own antennas, radios, and
                software installed at the airport. This system is completely
                parallel to existing infrastructure, requires zero permission,
                and zero integration. It’s an extra safety net over existing
                systems (no replacement required). All the data we need is
                open-source and unencrypted.
              </p>
              <p>
                Building models for processing ATC speech is our first step
                toward building a safety net that detects human error (by both
                pilots and ATC). The latest system transcribes the VHF control
                audio at about ~1.1% WER (Word Error Rate), down from a previous
                record of ~9%. We’re using these transcripts with NLP and ADS-B
                (the system that tracks aircraft positions in real time) for
                readback detection (ensuring pilots correctly repeat ATC
                instructions) and command compliance.
              </p>
              <p>
                There are different views about the future of ATC. Our product
                is naturally based on our own convictions and experience in the
                field. For example, it’s sometimes said that voice comms are
                going away — we think they aren’t (<a
                  href="https://www.ericbutton.co/p/speech"
                  >https://www.ericbutton.co/p/speech</a
                >). People also point out that airplanes are going to fly
                themselves — in fact they already do. But passenger airlines,
                for example, will keep a pilot onboard (or on the ground) with
                ultimate control, for a long time from now; the economics and
                politics and mind-boggling safety and legal standards for
                aviation make this inevitable. Also, while next-gen ATC systems
                like ASDE-X are already in place, they don’t eliminate the
                problem. The April 2024 scenario mentioned above occurred at
                DCA, an ASDE-X-equipped airport.
              </p>
              <p>
                America has more than 5,000 public-use airports, but only 540 of
                these have control towers (due to cost). As a result, there are
                over 100 commercial airline routes that fly into uncontrolled
                airports, and 4.4M landings at these fields. Air traffic control
                from first principles looks significantly more automated, more
                remote-controlled, and much cheaper — and as a result, much more
                widespread.
              </p>
              <p>
                We’ve known each other for 3 years, and decided independently
                that we needed to work on air traffic. Having started on this,
                we feel like it’s our mission for the next decade or two.
              </p>
              <p>
                If you’re a pilot or an engineer who’s thought about this stuff,
                we’d love to get your input. We look forward to hearing
                everyone’s thoughts, questions, ideas!
              </p>
            </div>
          </section>
        </section>
        <section id="43241499">
          <h3>
            <a
              class="item"
              href="https://mikelikejordan.bearblog.dev/how-math-academy-pulled-me-out-of-the-valley-of-despair/"
              >How Math Academy pulled me out of the Valley of Despair</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 13:27:07</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43241499"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43239046">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/culture/photo-booth/what-vivian-maier-saw-in-color"
              >What Vivian Maier saw in color (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 07:00:57</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43239046"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43236184">
          <h3>
            <a
              class="item"
              href="https://leehanchung.github.io/blogs/2025/02/26/deep-research/"
              >The Differences Between Deep Research, Deep Research, and Deep
              Research</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-02 @ 22:59:13</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43236184"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43235424">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20250227-the-vermont-farmers-using-urine-to-grow-their-crops"
              >Why Vermont farmers are using urine on their crops</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-02 @ 21:36:20</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43235424"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43234510">
          <h3>
            <a class="item" href="https://jacquesheunis.com/post/rotors/"
              >Rotors: A practical introduction for 3D graphics (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-02 @ 20:10:55</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43234510"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43225805">
          <h3>
            <a
              class="item"
              href="https://workingwoodenplanes.com/p/2025-02-28-ebenezer-clifford-bell-diver-planemaker/"
              >The Planemaker Who Walked Beneath the Water</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-02 @ 00:34:57</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43225805"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43218724">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-025-00264-3"
              >Asteroid fragments upend theory of how life on Earth bloomed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-01 @ 12:44:40</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43218724"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
