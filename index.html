<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35550786">
          <h3>
            <a class="item" href="http://jesda.com/2011/02/10/kids-toys-suck/"
              >Kids Toys Suck (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 04:02:39</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35550786"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35550761">
          <h3>
            <a class="item" href="https://getfleek.dev/"
              >Take Control of Your $Home</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 03:59:22</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35550761"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35550419">
          <h3>
            <a
              class="item"
              href="https://amistrongeryet.substack.com/p/gpt-4-capabilities"
              >What GPT-4 Does Is Less Like “Figuring Out” and More Like
              “Already Knowing”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 03:08:37</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35550419"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35550342">
          <h3>
            <a
              class="item"
              href="https://www.servethehome.com/breaking-intel-exiting-the-server-business-selling-to-mitac/"
              >Intel exiting its longtime server business</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 02:59:30</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35550342"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35550240">
          <h3>
            <a
              class="item"
              href="https://stackoverflow.blog/2022/02/23/what-you-give-up-when-moving-into-engineering-management/"
              >What you give up by moving into engineering management</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 02:45:33</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35550240"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35550194">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/national-security/2023/04/12/discord-leaked-documents/"
              >Leaker of U.S. secret documents worked on military base, friend
              says</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 02:38:56</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35550194"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35549322">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/international/2023/04/03/was-your-degree-really-worth-it"
              >Was your degree really worth it?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 00:45:25</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35549322"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35549116">
          <h3>
            <a
              class="item"
              href="https://baturin.org/misc/software-reviews/lindows/"
              >Lindows 4.0 (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 00:24:21</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35549116"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35548911">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/mathematicians-find-hidden-structure-in-a-common-type-of-space-20230412/"
              >Mathematicians find hidden structure in a common type of space</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 00:03:46</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35548911"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35548778">
          <h3>
            <a
              class="item"
              href="https://github.com/trevorhobenshield/twitter-api-client"
              >Show HN: Twitter API Reverse Engineered</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 23:50:08</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35548778"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">endpoints: /graphql /1.1 /2 /i</div>
          </section>
        </section>
        <section id="35547819">
          <h3>
            <a
              class="item"
              href="https://phiresky.github.io/blog/2020/sqlite-performance-tuning/"
              >SQLite performance tuning: concurrent reads, multiple GBs and
              100k SELECTs/s</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 22:19:55</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35547819"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35547467">
          <h3>
            <a
              class="item"
              href="https://github.com/microsoft/DeepSpeed/blob/master/blogs/deepspeed-chat/README.md"
              >DeepSpeed Chat: Easy, fast and affordable RLHF training of
              ChatGPT-like models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 21:48:00</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35547467"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35547316">
          <h3>
            <a
              class="item"
              href="https://developers.redhat.com/articles/2023/04/12/why-you-should-use-iouring-network-io"
              >Use io_uring for network I/O</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 21:35:48</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35547316"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35546845">
          <h3>
            <a class="item" href="https://onesignal.com/careers"
              >OneSignal (YC S11) Is Hiring Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 21:01:31</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35546804">
          <h3>
            <a
              class="item"
              href="https://joblib.readthedocs.io/en/latest/index.html"
              >Joblib: Running Python functions as pipeline jobs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 20:59:15</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35546804"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35545817">
          <h3>
            <a
              class="item"
              href="https://behdadesfahbod.medium.com/on-a-great-interview-question-aea168279942"
              >On a great interview question</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 19:54:43</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35545817"
                  >Comments</a
                ><span class="descendants">: 234</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35544851">
          <h3>
            <a
              class="item"
              href="https://eugeneyan.com/writing/llm-experiments/"
              >Experimenting with LLMs to Research, Reflect, and Plan</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 18:53:11</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35544851"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35543893">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/bitcoin-blockchain-hacking-arrests-93a4cb29"
              >The U.S. cracked a $3.4B crypto heist and Bitcoin’s anonymity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 17:56:14</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35543893"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35543668">
          <h3>
            <a class="item" href="https://www.phind.com"
              >Show HN: GPT-4-powered web searches for developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 17:44:08</span
              ><span class="points-container"
                >Points: <span class="points">795</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35543668"
                  >Comments</a
                ><span class="descendants">: 288</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today we’re launching GPT-4 answers on Phind.com, a
                developer-focused search engine that uses generative AI to
                browse the web and answer technical questions, complete with
                code examples and detailed explanations. Unlike vanilla GPT-4,
                Phind feeds in relevant websites and technical documentation,
                reducing the model’s hallucination and keeping it up-to-date. To
                use it, simply enable the “Expert” toggle before doing a search.
              </p>
              <p>
                GPT-4 is making a night-and-day difference in terms of answer
                quality. For a question like “How can I RLHF a LLaMa model”,
                Phind in Expert mode delivers a step-by-step guide complete with
                citations (<a
                  href="https://phind.com/search?cache=0fecf96b-0ac9-4b65-893d-8ea5708db222"
                  >https://phind.com/search?cache=0fecf96b-0ac9-4b65-893d-8ea57...</a
                >) while Phind in default mode meanders a bit and answers the
                question very generally (<a
                  href="https://phind.com/search?cache=dd1fe16f-b101-4cc8-8089-ac56defb228d"
                  >https://phind.com/search?cache=dd1fe16f-b101-4cc8-8089-ac56d...</a
                >).
              </p>
              <p>
                GPT-4 is significantly more concise and “systematic” in its
                answers than our default model. It generates step-by-step
                instructions over 90% of the time, while our default model does
                not.
              </p>
              <p>
                We’re particularly focused on ML developers, as Phind can answer
                questions about many recent ML libraries, papers, and
                technologies that ChatGPT simply cannot. Even with ChatGPT’s
                alpha browsing mode, Phind answers technical questions faster
                and in more detail.
              </p>
              <p>
                For example, Phind running on “Expert” GPT-4 mode can concisely
                and correctly tell you how to run an Alpaca model using
                llama.cpp: (<a
                  href="https://phind.com/search?cache=0132c27e-c876-4f87-a0e1-cc48f07ccc20"
                  >https://phind.com/search?cache=0132c27e-c876-4f87-a0e1-cc48f...</a
                >). In contrast, ChatGPT-4 hallucinates and writes a make
                function for a fictional llama.cpp.
              </p>
              <p>
                We still have a long way to go and would love to hear your
                feedback.
              </p>
            </div>
          </section>
        </section>
        <section id="35539464">
          <h3>
            <a
              class="item"
              href="https://blog.ferretdb.io/ferretdb-1-0-ga-opensource-mongodb-alternative/"
              >FerretDB: open-source MongoDB alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 13:39:05</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35539464"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35539255">
          <h3>
            <a class="item" href="https://ianthehenry.com/posts/why-janet/"
              >Why Janet?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 13:25:10</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35539255"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35539057">
          <h3>
            <a
              class="item"
              href="https://www.intel.com/content/www/us/en/newsroom/news/intel-foundry-arm-announce-multigeneration-collaboration-leading-edge-soc-design.html"
              >Intel Foundry Services and Arm announce collaboration on SoC
              design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 13:09:49</span
              ><span class="points-container"
                >Points: <span class="points">402</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35539057"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35536550">
          <h3>
            <a
              class="item"
              href="https://github.com/everythingishacked/Semaphore"
              >Semaphore: A Full-Body Keyboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 08:24:44</span
              ><span class="points-container"
                >Points: <span class="points">1157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35536550"
                  >Comments</a
                ><span class="descendants">: 188</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35535430">
          <h3>
            <a
              class="item"
              href="https://www.discoverwildlife.com/animal-facts/could-the-dodo-come-back-from-extinction/"
              >Could the dodo come back from extinction?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 05:37:22</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35535430"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35528692">
          <h3>
            <a
              class="item"
              href="https://bikepacking.com/plog/steve-roberts-computing-across-america/"
              >Steve Roberts: Computing Across America</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-11 @ 17:55:18</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35528692"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35524256">
          <h3>
            <a class="item" href="https://www.equalto.com/markup/"
              >Show HN: Sheet Markup – add spreadsheets to a Markdown
              document</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-11 @ 12:32:30</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35524256"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://github.com/EqualTo-Software/stackedit-sheet-markup"
                >https://github.com/EqualTo-Software/stackedit-sheet-markup</a
              >
            </div>
          </section>
        </section>
        <section id="35523948">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/a-number-system-invented-by-inuit-schoolchildren-will-make-its-silicon-valley-debut/"
              >A number system invented by Inuit schoolchildren</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-11 @ 12:05:56</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35523948"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35523300">
          <h3>
            <a
              class="item"
              href="https://tratt.net/laurie/blog/2023/displaying_my_washing_machines_remaining_time_with_curl_jq_pizauth.html"
              >Displaying my washing machine's remaining time with curl, jq, and
              pizauth</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-11 @ 10:51:20</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35523300"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35521327">
          <h3>
            <a
              class="item"
              href="https://irclog.tymoon.eu/libera/%23commonlisp?to=1681213754"
              >Conversation with Larry Masinter about standardizing Common
              Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-11 @ 05:49:28</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35521327"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35518944">
          <h3>
            <a
              class="item"
              href="https://www.forbes.com/sites/bradtempleton/2023/04/10/transit-study-reveals-robotaxis-causing-surprisingly-little-disruption-on-streets/"
              >Study reveals robotaxis causing surprisingly little disruption on
              streets</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-10 @ 23:58:53</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35518944"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
