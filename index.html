<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36213704">
          <h3>
            <a class="item" href="https://counterexamples.org/intro.html"
              >Counterexamples in Type Systems: programs that crash, segfault or
              explode (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 14:51:15</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36213704"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36213332">
          <h3>
            <a class="item" href="https://garden.io/blog/aws-security-issue"
              >We reported a security issue in AWS CDK’s eks.Cluster
              component</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 14:27:42</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36213332"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36213330">
          <h3>
            <a
              class="item"
              href="https://bugs.chromium.org/p/chromium/issues/detail?id=1178058#c406"
              >Chrome still hasn't changed its opinion about dropping JPEG XL
              support</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 14:27:34</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36213330"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36212903">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36212903"
              >Launch HN: Seam (YC S20) – API for IoT Devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 14:00:21</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212903"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <p>
                We're building Seam (<a href="https://www.seam.co"
                  >https://www.seam.co</a
                >), a universal API for controlling IoT devices such as smart
                locks, thermostats, sensors, and (soon) cameras. Our hope is to
                make device integration simple, with a Plaid-like UI flow for
                obtaining device authorization and standardized API/SDKs for
                device control.
              </p>
              <p>
                We started Seam out of our frustration with the challenges of
                integrating IoT devices with software apps.
              </p>
              <p>
                For example, my co-founder Dawn led Sonder's efforts to
                integrate smartlocks with their reservation systems in order to
                automate access for guests. She struggled with poorly documented
                and unreliable device APIs along the way. Our founding engineer
                Max authored the popular TuyAPI library and has spent countless
                hours trying to build sensible interfaces on top of unreliable
                devices.
              </p>
              <p>
                For my part, I was an early engineer at Nest and saw firsthand
                how manufacturers often lack the resources and motivation to
                support third-party developers.
              </p>
              <p>
                As a result, most devices lack public APIs, and getting access
                to the private ones (if they exist) requires lengthy
                negotiations with manufacturers. This task grows in complexity
                with each additional device brand a developer may need to
                integrate.
              </p>
              <p>
                Seam serves as a single API that works across dozens of brands
                and hundreds of devices.
              </p>
              <p>
                We start by testing each device in our hardware lab in San
                Francisco. We study their behaviors &amp; quirks, and faithfully
                reproduce those in our development sandbox. We take time to
                craft custom client libraries that maximize developer ergonomics
                while accounting for the asynchronous nature of the devices. We
                offer pre-built UI components (React, Web-native…etc) to let
                developers rapidly assemble complex UIs that can manage large
                fleets of devices. And we even have a small hardware gateway to
                connect on-prem and legacy devices.
              </p>
              <p>
                A few app developers like Guesty (YC S14) already use Seam to
                connect to their end users’ devices. We have a generous free
                tier and charge a small fee for additional devices. We work
                closely with manufacturers to improve device reliability, add
                OAuth support, and patch security holes. We also spend time
                educating them on the importance of supporting open source
                projects like Home Assistant, OpenHab...etc and we will be
                contributing some of our own integrations to those ecosystems.
              </p>
              <p>
                Seam is still very much a work in progress with many aspects
                that need to be improved. But our hope is that it will help push
                IoT devices from being (mostly) point solutions, to becoming a
                set of API endpoints software engineers can tap to interact with
                the physical world.
              </p>
            </div>
          </section>
        </section>
        <section id="36212865">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/in-new-paradox-black-holes-appear-to-evade-heat-death-20230606/"
              >In New Paradox, Black Holes Appear to Evade Heat Death</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 13:57:56</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212865"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36212674">
          <h3>
            <a
              class="item"
              href="https://asahilinux.org/2023/06/opengl-3-1-on-asahi-linux/"
              >OpenGL 3.1 on Asahi Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 13:46:13</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212674"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36212480">
          <h3>
            <a
              class="item"
              href="https://shufflingbytes.com/posts/ripping-off-professional-criminals-by-fermenting-onions-phishing-darknet-users-for-bitcoins/"
              >Ripping off professional criminals by fermenting onions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 13:34:31</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212480"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36212242">
          <h3>
            <a
              class="item"
              href="https://www.bhf.org.uk/what-we-do/news-from-the-bhf/news-archive/2023/june/heart-attack-more-common-monday"
              >Deadly heart attacks are more common on a Monday</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 13:19:59</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212242"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36212120">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/legal/us-sec-sues-coinbase-over-failure-register-2023-06-06/"
              >US SEC sues Coinbase, one day after suing Binance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 13:10:56</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212120"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36211788">
          <h3>
            <a class="item" href="https://stratechery.com/2023/apple-vision/"
              >Apple Vision</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 12:45:05</span
              ><span class="points-container"
                >Points: <span class="points">269</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36211788"
                  >Comments</a
                ><span class="descendants">: 366</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36211341">
          <h3>
            <a class="item" href="https://www.svix.com/careers/"
              >Svix (YC W21) Is Hiring an Account Executive (US Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 12:00:54</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36211250">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-01833-0"
              >Tips for better coding with ChatGPT</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 11:49:23</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36211250"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36211219">
          <h3>
            <a
              class="item"
              href="https://www.forbes.com/sites/alexkonrad/2023/06/06/sequoia-splits-into-three-firms/"
              >Sequoia Is Splitting into Three VC Firms</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 11:45:42</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36211219"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36210886">
          <h3>
            <a
              class="item"
              href="https://blog.appsignal.com/2023/06/06/absinthe-for-large-elixir-applications.html"
              >Absinthe for Large Elixir Applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 11:04:49</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36210886"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36210805">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/06/reddits-plan-to-kill-third-party-apps-sparks-widespread-protests/"
              >Reddit’s plan to kill third-party apps sparks widespread
              protests</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 10:52:36</span
              ><span class="points-container"
                >Points: <span class="points">452</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36210805"
                  >Comments</a
                ><span class="descendants">: 272</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36210727">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2302.00441"
              >Hyperparameter Optimization for LLMs via Scaling Laws</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 10:43:12</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36210727"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36210548">
          <h3>
            <a class="item" href="https://lethain.com/digg-v4/"
              >Digg's v4 launch: an optimism born of necessity (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 10:13:47</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36210548"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36209867">
          <h3>
            <a
              class="item"
              href="https://erikjohannes.no/posts/20230108-reconstructing-obsidian-features-in-vim/"
              >Reconstructing Obsidian Features in Vim and Bash</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 08:32:40</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36209867"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36209408">
          <h3>
            <a class="item" href="https://developer.apple.com/passkeys/"
              >Passkeys now support external providers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 07:29:19</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36209408"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36209047">
          <h3>
            <a
              class="item"
              href="https://www.nvidia.com/en-us/data-center/grace-hopper-superchip/"
              >Nvidia releases new AI chip with 480GB CPU RAM, 96GB GPU RAM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 06:46:31</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36209047"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36209014">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/wwdc23/topics/ml-vision/"
              >Apple releasing segmentation/pose for humans and animals,
              embedding for 27 lang</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 06:42:31</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36209014"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36208568">
          <h3>
            <a
              class="item"
              href="https://blog.turso.tech/why-sqlite-is-so-great-for-the-edge-ee00a3a9a55f"
              >Why SQLite is so great for the edge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 05:37:28</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36208568"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36206526">
          <h3>
            <a class="item" href="http://ascii.textfiles.com/archives/5543"
              >Preparing for the Incoming Computer Shopper Tsunami</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 00:39:28</span
              ><span class="points-container"
                >Points: <span class="points">495</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36206526"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36201593">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/06/introducing-apple-vision-pro/"
              >Apple Vision Pro: Apple’s first spatial computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-05 @ 19:04:46</span
              ><span class="points-container"
                >Points: <span class="points">2505</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36201593"
                  >Comments</a
                ><span class="descendants">: 2677</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36197588">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-05-scientists-world-x-ray-atom.html"
              >Scientists' report first X-ray of a single atom</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-05 @ 15:25:08</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36197588"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36195762">
          <h3>
            <a
              class="item"
              href="https://www.csie.ntu.edu.tw/~r98922004/doc/SPT.pdf"
              >Undirected SS Shortest Paths with Positive Integer Weights in
              O(n) (1999) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-05 @ 13:16:48</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36195762"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36195105">
          <h3>
            <a
              class="item"
              href="https://neurofrontiers.blog/helplessness-is-not-learned/"
              >Helplessness is not learned (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-05 @ 12:02:15</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36195105"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36193495">
          <h3>
            <a class="item" href="https://qri.org/blog/psycrypto-contest"
              >Messages that can only be understood under the influence of
              psychedelics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-05 @ 07:27:35</span
              ><span class="points-container"
                >Points: <span class="points">431</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36193495"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36193196">
          <h3>
            <a
              class="item"
              href="https://yeokhengmeng.com/2023/06/teardown-and-review-of-hand386/"
              >Teardown and review of a new 386 system: Hand386</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-05 @ 06:45:18</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36193196"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36193054">
          <h3>
            <a class="item" href="https://github.com/boyter/cs"
              >Show HN: Codespelunker – A command line search tool with TUI and
              HTTP modes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-05 @ 06:22:43</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36193054"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
