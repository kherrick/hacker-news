<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39948840">
          <h3>
            <a
              class="item"
              href="https://www.nist.gov/news-events/news/2024/04/nist-researchers-use-cellphone-compass-measure-tiny-concentrations"
              >NIST researchers use cellphone compass to measure glucose</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-06 @ 00:18:20</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39948840"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39948686">
          <h3>
            <a
              class="item"
              href="https://www.cockroachlabs.com/blog/why-cockroachdb-doesnt-use-evalplanqual/"
              >Why CockroachDB doesn't use EvalPlanQual</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 23:55:41</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39948686"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39948404">
          <h3>
            <a class="item" href="https://github.com/andreasfertig/cppinsights"
              >C++ Insights – See your source code with the eyes of a
              compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 23:15:40</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39948404"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39948044">
          <h3>
            <a class="item" href="https://github.com/searxng/searxng"
              >SearXNG is a free internet metasearch engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 22:27:59</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39948044"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39947731">
          <h3>
            <a
              class="item"
              href="https://yhetil.org/emacs-bugs/874jcgbekr.fsf@gmail.com/T/#u"
              >Emacs bug: describe-key and lambda too poetic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 21:56:59</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39947731"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39947713">
          <h3>
            <a class="item" href="https://worldsim.nousresearch.com/"
              >World_sim: LLM prompted to act as a sentient CLI universe
              simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 21:55:01</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39947713"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39946694">
          <h3>
            <a
              class="item"
              href="https://www.macrumors.com/2024/04/05/app-store-guidelines-emulators-music-app-links/"
              >Apple Updates App Store Guidelines to Permit Game Emulators, EU
              Music App Links</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 20:16:56</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39946694"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39946169">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.03502"
              >AI and the Problem of Knowledge Collapse</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 19:30:30</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39946169"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39945931">
          <h3>
            <a class="item" href="https://hazlitt.net/longreads/dark-matter"
              >For twenty years, PostSecret has broadcast suburban America’s
              hidden truths</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 19:09:25</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39945931"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39945733">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=C-uekD6VTIQ"
              >Autonomous Overhead Powerline Recharging for Uninterrupted Drone
              Operations [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 18:50:46</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39945733"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39944658">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/continue/jobs/smcxRnM-founding-engineer"
              >Continue (YC S23) is hiring a founding engineer in San
              Francisco</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 17:00:39</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39944496">
          <h3>
            <a
              class="item"
              href="https://www.abortretry.fail/p/the-rise-and-fall-of-silicon-graphics"
              >The Rise and Fall of Silicon Graphics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 16:42:38</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39944496"
                  >Comments</a
                ><span class="descendants">: 270</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39944275">
          <h3>
            <a class="item" href="https://gws.phd/posts/fortran_wasm/"
              >Fortran on WebAssembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 16:21:49</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39944275"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39942902">
          <h3>
            <a
              class="item"
              href="https://planet-tracker.org/deep-sea-mining-could-be-worse-for-the-climate-than-land-ores/"
              >Deep sea mining could be worse for the climate than land ores</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 14:35:55</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39942902"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39942397">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39942397"
              >Ask HN: What is the most useless project you have worked on?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 13:53:10</span
              ><span class="points-container"
                >Points: <span class="points">345</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39942397"
                  >Comments</a
                ><span class="descendants">: 459</span></span
              >
            </h4>
            <div class="text">
              <p>
                Let me give you some context. I work in the pipeline automation
                department of a company. Last month, our team decided to
                deprecate an internal tool due to several maintenance issues. So
                we created a pipeline that automates the implementation of this
                legacy tool, in case other teams needed to use it. (WHAT???)
              </p>
              <p>
                This month, a guy in my team found some improvement scenarios in
                the automation. So I was chosen to implement this changes in
                this legacy internal tool.
              </p>
              <p>
                The thing is, after I finished the adjustments, my pull requests
                are not getting approved due to adjustments meticulously
                requested by this guy in my team. Adjustments to make the
                pipeline automation even more resilient in complete unlikely
                scenarios.
              </p>
              <p>
                But this same week, my TL sent notices to all the other teams
                informing them that this internal tool has been deprecated and
                they should no longer use it. So what sense does it make to have
                a pipeline automation that implements the use of the deprecated
                tool? And if it has been deprecated, why would I need to make an
                adjustment for the automation to be even resilient if no one
                should be able to use it anymore? So why am I being allocated to
                work on in such waste of time like it? (WTF???)
              </p>
              <p>
                This makes me wonder, how many people have to work on something
                that they see no sense in doing at all.
              </p>
              <p>
                So once again, if you're feeling useless, remember that I exist.
              </p>
            </div>
          </section>
        </section>
        <section id="39942288">
          <h3>
            <a
              class="item"
              href="https://www.experimental-history.com/p/so-you-wanna-de-bog-yourself"
              >So you wanna de-bog yourself</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 13:43:14</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39942288"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39941232">
          <h3>
            <a class="item" href="https://github.com/zoriya/Kyoo"
              >Show HN: Kyoo – Self-hosted media browser (Jellyfin/Plex
              alternative)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 11:49:55</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39941232"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
            <div class="text">
              I started working on Kyoo almost 5 years ago because I did not
              like the options at the time. It started as a "sandbox" project
              where I could learn about tech I was interested in, and slowly
              became more than that.
            </div>
          </section>
        </section>
        <section id="39940975">
          <h3>
            <a
              class="item"
              href="https://axleos.com/an-irc-client-in-your-motherboard/"
              >An IRC client in your motherboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 11:13:57</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39940975"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39940959">
          <h3>
            <a
              class="item"
              href="https://www.asomo.co/p/a-lego-model-of-financial-capitalism"
              >A Lego model of financial capitalism</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 11:10:47</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39940959"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39939036">
          <h3>
            <a class="item" href="https://leontrolski.github.io/pglockpy.html"
              >Postgres locks explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 05:45:36</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39939036"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39928860">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/04/04/65_years_ago_mercury_7/"
              >65 years ago, America announced the names of its first
              astronauts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 11:16:09</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39928860"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39928679">
          <h3>
            <a
              class="item"
              href="https://www.vincit.com/blog/software-development-450-words-per-minute"
              >Interview with a blind developer on how he works (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 10:47:10</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39928679"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39928646">
          <h3>
            <a
              class="item"
              href="https://www.pragmaticsemi.com/newsroom/press-releases/pragmatic-semiconductor-re-invents-the-iconic-processor-that-changed-the-world"
              >Pragmatic Semiconductor made a flexible version of the 6502
              processor (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 10:42:04</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39928646"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39927040">
          <h3>
            <a
              class="item"
              href="http://jpkoning.blogspot.com/2017/03/bringing-back-somali-shilling.html"
              >Bringing back the Somali shilling (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 06:01:05</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39927040"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39927018">
          <h3>
            <a
              class="item"
              href="https://artsfuse.org/289985/book-review-vincent-czyzs-sun-eye-moon-eye-cozy-with-the-quotidian-and-the-cosmological/"
              >Vincent Czyz's "Sun Eye Moon Eye": Cozy with the Quotidian and
              the Cosmological</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 05:57:08</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39927018"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39921653">
          <h3>
            <a class="item" href="https://beltmag.com/st-louis-brick-by-brick/"
              >St. Louis Brick by Brick (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-03 @ 19:08:23</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39921653"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39919035">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/essay/windows-onto-history/"
              >The Defenestrations of Prague (1419–1997)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-03 @ 15:51:20</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39919035"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39914776">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/places/philly-typewriter-philadelphia"
              >Philly Typewriter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-03 @ 08:13:40</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39914776"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39905211">
          <h3>
            <a
              class="item"
              href="https://en.wikisource.org/wiki/What_is_the_Fourth_Dimension%3F"
              >What is the Fourth Dimension? (1884)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-02 @ 12:57:40</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39905211"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39903398">
          <h3>
            <a
              class="item"
              href="https://www.jetbrains.com/pages/inspectopedia-by-jetbrains/"
              >Inspectopedia: Analyze code against inspections in your IDE or CI
              pipeline</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-02 @ 08:09:03</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39903398"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
