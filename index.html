<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44800185">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/claude-opus-4-1"
              >Claude Opus 4.1</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 16:28:05</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44800185"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44800051">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/08/04/google_ai_datacenter_grid/"
              >Google agrees to pause AI workloads when power demand spikes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 16:18:57</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44800051"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44799869">
          <h3>
            <a class="item" href="https://github.com/openai/harmony"
              >OpenAI Harmony</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 16:07:58</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44799869"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44799861">
          <h3>
            <a
              class="item"
              href="https://yoyo-code.com/why-is-github-ui-getting-so-much-slower/"
              >Why is GitHub UI getting so much slower?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 16:07:46</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44799861"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44799834">
          <h3>
            <a class="item" href="https://samlshield.com/"
              >SAML Shield: Drop-in protection that works for any stack</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 16:05:56</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44799834"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44799756">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2025/08/05/trump-fcc-abandons-efforts-to-make-u-s-broadband-fast-and-affordable/"
              >FCC Abandons Efforts to Make U.S. Broadband Fast and
              Affordable</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 15:59:50</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44799756"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44799494">
          <h3>
            <a
              class="item"
              href="https://www.githubstatus.com/incidents/6swp0zf7lk8h"
              >GitHub is having an ongoing incident with loading pull
              requests</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 15:44:09</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44799494"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44799479">
          <h3>
            <a
              class="item"
              href="https://elevenlabs.io/blog/eleven-music-is-here"
              >Eleven Music Is Here</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 15:42:40</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44799479"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44799435">
          <h3>
            <a
              class="item"
              href="https://github.com/github/site-policy/pull/582"
              >GitHub Pull Requests Are Down</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 15:39:25</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44799435"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44799290">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/08/05/climate/epa-cancels-solar-energy-grants.html"
              >EPA Moves to Cancel $7B in Grants for Solar Energy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 15:29:28</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44799290"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44798705">
          <h3>
            <a
              class="item"
              href="https://www.news.uscg.mil/Press-Releases/Article/4265651/coast-guard-marine-board-of-investigation-releases-report-on-titan-submersible/"
              >US Coast Guard Report on Titan Submersible</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 14:47:35</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44798705"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44798695">
          <h3>
            <a
              class="item"
              href="https://www.lanl.gov/media/publications/1663/dynamics-of-dynamic-imaging"
              >Los Alamos is capturing real-time images of explosions at 7mths
              of a second</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 14:47:07</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44798695"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44798553">
          <h3>
            <a class="item" href="https://github.com/stagewise-io/stagewise"
              >Show HN: Stagewise (YC S25) – Front end coding agent for existing
              codebases</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 14:38:36</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44798553"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <a href="https://stagewise.io">https://stagewise.io</a>), a
              frontend coding agent that lives inside your browser on localhost
              and operates on local codebases.
              <p>
                You can spawn the agent into locally running web apps in dev
                mode with `npx stagewise` from the project root. The agent lets
                you then click on HTML Elements in your app, enter prompts like
                'increase the height here' and will implement the changes in
                your source code.
              </p>
              <p>
                Before stagewise, we were building a vertical SaaS for logistics
                from scratch and loved using prototyping tools like v0 or
                lovable to get to the first version. But when switching from v0/
                lovable to Cursor for local development, we felt like the
                frontend magic was gone. So, we decided to build stagewise to
                bring that same magic to local development.
              </p>
              <p>
                The first version of stagewise just forwarded a prompt with
                browser context to existing IDEs and agents (Cursor, Cline, ..)
                and went viral on X after we open sourced it. However, the APIs
                of existing coding agents were very limiting, so we figured that
                building our own agent would unlock the full potential of
                stagewise.
              </p>
              <p>
                Here's how it works: When you run `npx stagewise`, our cli
                proxies your running web application in dev mode and injects a
                toolbar containing the coding agent on top of it. Each prompt
                you send will be enriched with browser context and sent to our
                cli, which will call our backend and modify the source code of
                your local codebase accordingly.
              </p>
              <p>
                Here's a demo of our agent changing the login UI of Cal.com, a
                popular open-source meeting scheduling app:
                <a href="https://www.youtube.com/watch?v=BkDcAozK9L4"
                  >https://www.youtube.com/watch?v=BkDcAozK9L4</a
                >.
              </p>
              <p>
                So far, we've seen great adoption from non-technical users who
                wanted to continue building their lovable prototype locally. We
                personally use the agent almost daily to make changes to our
                landing page and to build the UI of new features on our console
                (<a href="https://console.stagewise.io"
                  >https://console.stagewise.io</a
                >).
              </p>
              <p>
                If you have an app running in dev mode, simply `cd` into the app
                directory and run `npx stagewise` - the agent should appear,
                ready to play with.
              </p>
              <p>We're very excited to hear your feedback!</p>
            </div>
          </section>
        </section>
        <section id="44798434">
          <h3>
            <a class="item" href="https://prog21.dadgum.com/57.html"
              >No Comment (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 14:30:19</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44798434"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44798215">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2025/08/enough-is-enough-i-dumped-googles-worsening-search-for-kagi/"
              >Enough is enough–I dumped Google's worsening search for Kagi</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 14:12:51</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44798215"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44798189">
          <h3>
            <a
              class="item"
              href="https://colton.dev/blog/curing-your-ai-10x-engineer-imposter-syndrome/"
              >AI is not Making Engineers 10x as Productive</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 14:10:42</span
              ><span class="points-container"
                >Points: <span class="points">372</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44798189"
                  >Comments</a
                ><span class="descendants">: 300</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44798166">
          <h3>
            <a
              class="item"
              href="https://deepmind.google/discover/blog/genie-3-a-new-frontier-for-world-models/"
              >Genie 3: A new frontier for world models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 14:08:52</span
              ><span class="points-container"
                >Points: <span class="points">459</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44798166"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44798035">
          <h3>
            <a
              class="item"
              href="https://www.proxmox.com/en/about/company-details/press-releases/proxmox-virtual-environment-9-0"
              >Proxmox Virtual Environment 9.0 with Debian 13 released</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 13:57:00</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44798035"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44797917">
          <h3>
            <a
              class="item"
              href="https://lambdaland.org/posts/2025-08-04_artifical_inanity/"
              >AI Stands for Artificial Inanity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 13:46:30</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44797917"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44797834">
          <h3>
            <a class="item" href="https://github.com/stratdev3/SimpleW"
              >SimpleW – Web Server Library .NET Core</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 13:39:57</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44797834"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44797466">
          <h3>
            <a class="item" href="https://canyoublockit.com/"
              >Can you block it? A simple Ad Block Tester</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 12:59:01</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44797466"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44797408">
          <h3>
            <a
              class="item"
              href="https://9to5mac.com/2025/08/05/tsmc-says-employees-tried-to-steal-trade-secrets-on-iphone-18-chip-process/"
              >TSMC says employees tried to steal trade secrets on iPhone 18
              chip process</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 12:53:15</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44797408"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44796953">
          <h3>
            <a class="item" href="https://www.buildyourownlisp.com/"
              >Build Your Own Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 11:55:20</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44796953"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44796698">
          <h3>
            <a
              class="item"
              href="https://www.os2museum.com/wp/more-than-two-hard-disks-in-dos/"
              >More than two hard disks in DOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 11:19:27</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44796698"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44795825">
          <h3>
            <a
              class="item"
              href="https://apps.apple.com/app/ublock-origin-lite/id6745342698"
              >uBlock Origin Lite now available for Safari</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 09:01:54</span
              ><span class="points-container"
                >Points: <span class="points">635</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44795825"
                  >Comments</a
                ><span class="descendants">: 257</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44794926">
          <h3>
            <a
              class="item"
              href="https://echarts.apache.org/handbook/en/basics/release-note/v6-feature/"
              >Apache ECharts 6</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 06:33:04</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44794926"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44794508">
          <h3>
            <a class="item" href="https://frigate.video/"
              >Monitor your security cameras with locally processed AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 05:05:23</span
              ><span class="points-container"
                >Points: <span class="points">423</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44794508"
                  >Comments</a
                ><span class="descendants">: 197</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44794271">
          <h3>
            <a
              class="item"
              href="https://thephp.foundation/blog/2025/07/11/php-85-adds-pipe-operator/"
              >PHP 8.5 adds pipe operator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 04:13:43</span
              ><span class="points-container"
                >Points: <span class="points">357</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44794271"
                  >Comments</a
                ><span class="descendants">: 230</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44782596">
          <h3>
            <a
              class="item"
              href="https://blog.zarfhome.com/2025/08/age-of-bronze-and-steel"
              >The Age of Bronze and Steel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-04 @ 06:18:24</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44782596"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44770215">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/history/man-who-pretended-be-doctor-ran-worlds-fair-attraction-saved-lives-thousands-premature-babies-180960200/"
              >A Carnival Attraction That Saved Premature Babies (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 18:45:14</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44770215"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
