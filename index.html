<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43395496">
          <h3>
            <a class="item" href="https://bahr.io/pubs/entries/calctyper.html"
              >The Calculated Typer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-18 @ 03:31:36</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43395496"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43394881">
          <h3>
            <a class="item" href="https://rhombus-lang.org">Rhombus Language</a>
          </h3>
          <section>
            <h4>
              <span>2025-03-18 @ 01:37:19</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43394881"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43394621">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/doctor-droid/jobs/2v9x6QW-ai-lead"
              >Doctor Droid (YC W23) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-18 @ 01:00:34</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43393924">
          <h3>
            <a class="item" href="https://www.datagubbe.se/futui/"
              >Past and Present Futures of User Interface Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 23:35:02</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43393924"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43393822">
          <h3>
            <a
              class="item"
              href="https://testing.gimp.org/news/2025/03/16/gimp-3-0-released/"
              >GIMP 3.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 23:25:53</span
              ><span class="points-container"
                >Points: <span class="points">714</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43393822"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43393198">
          <h3>
            <a
              class="item"
              href="https://apps.apple.com/us/app/straysync/id6742747753"
              >Show HN: I Built an iOS app to locate stray animals</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 22:05:04</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43393198"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <a href="https://stray-sync-landing.vercel.app/"
                >https://stray-sync-landing.vercel.app/</a
              >
            </div>
          </section>
        </section>
        <section id="43392950">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/quantum-speedup-found-for-huge-class-of-hard-problems-20250317/"
              >Quantum Speedup Found for Class of Hard Problems</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 21:34:53</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43392950"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43392549">
          <h3>
            <a
              class="item"
              href="https://simonschreibt.de/gat/the-high-heel-problem/"
              >The High Heel Problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 20:43:35</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43392549"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43392521">
          <h3>
            <a class="item" href="https://opentimes.org"
              >Show HN: OpenTimes – Free travel times between U.S. Census
              geographies</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 20:40:52</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43392521"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <p>
                The primary goal here is to enable research and fill a gap I
                noticed in the open-source spatial ecosystem. Researchers
                (social scientists, economists, etc.) use large travel time
                matrices to quantify things like access to healthcare, but they
                often end up paying Google or Esri for the necessary data. By
                pre-calculating times between commonly-used research geographies
                (i.e. Census) and then making those times easily accessible via
                SQL, I hope to make large-scale accessibility research cheaper
                and simpler.
              </p>
              <p>Some technical bits that may be of interest to HN folks:</p>
              <p>
                - The entire OpenTimes backend is just static Parquet files on
                R2. There's no RDBMS or running service. The whole thing costs
                about $10/month to host and is free to serve.
              </p>
              <p>
                - All travel times were calculated by pre-building the inputs
                (OSM, OSRM networks) and then distributing the compute over
                hundreds of GitHub Actions jobs.
              </p>
              <p>
                - The query/SQL layer uses a setup I haven't seen before: a
                single DuckDB database file with views that point to static
                Parquet files via HTTP.
              </p>
              <p>
                Finally, the driving times are optimistic since they don't (yet)
                account for traffic. This is something I hope to work on in the
                near future. Enjoy!
              </p>
            </div>
          </section>
        </section>
        <section id="43392295">
          <h3>
            <a
              class="item"
              href="https://raymii.org/s/blog/After_47_years_OpenVMS_gets_a_package_manager_VSP.html"
              >After 47 years, OpenVMS gets a package manager (VSP)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 20:11:09</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43392295"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43391459">
          <h3>
            <a
              class="item"
              href="https://blog.dshr.org/2025/03/archival-storage.html"
              >Archival Storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 18:36:21</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43391459"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43390747">
          <h3>
            <a
              class="item"
              href="https://theintercept.com/2025/03/17/lapd-surveillance-gaza-palestine-protests-dataminr/"
              >Dataminr tracked Gaza-related protests</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 17:25:35</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43390747"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43390595">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/features/2025-03-16/wall-street-s-dark-pools-grow-murkier-with-private-rooms"
              >Wall Street’s ‘Private Rooms’</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 17:10:59</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43390595"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43390467">
          <h3>
            <a
              class="item"
              href="https://x.company/blog/posts/taara-graduation/"
              >Alphabet spins out Taara – Internet over lasers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 16:55:17</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43390467"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43390400">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2503.02113"
              >Deep Learning Is Not So Mysterious or Different</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 16:47:02</span
              ><span class="points-container"
                >Points: <span class="points">332</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43390400"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43387334">
          <h3>
            <a
              class="item"
              href="http://blog.kevinalbs.com/stupid_smart_pointers"
              >Stupid Smart Pointers in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 11:29:04</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43387334"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43386578">
          <h3>
            <a
              class="item"
              href="https://makerworld.com/en/models/783010-underware-2-0-infinite-cable-management"
              >Underware 2.0 – Open Source Infinite Cable Management</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 09:29:33</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43386578"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43378671">
          <h3>
            <a
              class="item"
              href="https://reflector.dev/articles/breaking-up-with-on-call/"
              >Breaking Up with On-Call</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-16 @ 12:57:49</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43378671"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43378627">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2025/03/towards-extracting-content-from-an-lcp-protected-epub/"
              >Extracting content from an LCP “protected” ePub</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-16 @ 12:50:56</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43378627"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43378114">
          <h3>
            <a class="item" href="https://printedlabs.uni-bayreuth.de/en"
              >PrintedLabs – 3D printable optical experiment equipment</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-16 @ 11:05:58</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43378114"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43378001">
          <h3>
            <a class="item" href="https://simonwillison.net/2025/Mar/16/olmo2/"
              >Mlx-community/OLMo-2-0325-32B-Instruct-4bit</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-16 @ 10:33:32</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43378001"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43377897">
          <h3>
            <a class="item" href="https://github.com/casparwylie/cascii-core"
              >Show HN: Cascii – A portable ASCII diagram builder written in
              vanilla JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-16 @ 10:02:21</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43377897"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <p>
                Since, I've built Cascii from scratch in vanilla Javascript (I'm
                not an FE dev, it might be obvious...).
              </p>
              <p>
                I hope it works alright. Please check out the live version at
                <a href="https://cascii.app">https://cascii.app</a>, report
                problems, make diagrams to improve your code's documentation.
                Hope you enjoy using it.
              </p>
            </div>
          </section>
        </section>
        <section id="43374753">
          <h3>
            <a
              class="item"
              href="https://maxwellforbes.com/posts/dont-try-to-reform-science/"
              >Don't Try to Reform Science</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-15 @ 19:45:04</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43374753"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43374407">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43374407"
              >Ask HN: What kind of whiteboard do you use that does NOT use dry
              erase markers?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-15 @ 18:46:02</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43374407"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text"><p>Anybody have any recommendations?</p></div>
          </section>
        </section>
        <section id="43366671">
          <h3>
            <a class="item" href="https://hackers.town/@zwol/114155595855705796"
              >Recommendations for designing magic numbers of binary file
              formats</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 20:05:53</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43366671"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43361389">
          <h3>
            <a
              class="item"
              href="https://forum.level1techs.com/t/theory-crafting-a-system-for-maximum-simultaneous-micro-sd-card-ingest/227159"
              >Theory crafting a system for 1000 simultaneous micro SD card
              ingests</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 11:00:41</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43361389"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43360633">
          <h3>
            <a class="item" href="https://github.com/formal-land/coq-of-rust"
              >Coq-of-rust: Formal verification tool for Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 08:34:18</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43360633"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43360251">
          <h3>
            <a
              class="item"
              href="https://httptoolkit.com/blog/http3-quic-open-source-support-nowhere/"
              >HTTP/3 is everywhere but nowhere</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 07:02:39</span
              ><span class="points-container"
                >Points: <span class="points">335</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43360251"
                  >Comments</a
                ><span class="descendants">: 367</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43359264">
          <h3>
            <a
              class="item"
              href="https://slamdunksoftware.substack.com/p/hidden-messages-in-emojis-and-hacking"
              >Hidden Messages in Emojis and Hacking the US Treasury</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-14 @ 03:13:26</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43359264"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43358264">
          <h3>
            <a
              class="item"
              href="https://collidingscopes.github.io/liquid-shape-distortions/"
              >Show HN: Psychedelic animation generator; (p)art of your next
              trip</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-13 @ 23:26:56</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43358264"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
            <div class="text">
              <p>
                This project was inspired by drum &amp; bass / acid techno
                music, and 90s rave posters.
              </p>
              <p>
                Use this to create art for a music video, concert posters,
                stylized animations in creative projects, or simply to enjoy
                alongside some fine music.
              </p>
              <p>
                Use the detailed control menu (top-right) to set a custom canvas
                size, adjust animation speed, control pattern and colours,
                etc...
              </p>
              <p>
                You can export your creation as an image or video afterwards.
              </p>
              <p>
                How this works: this tool uses WebGL shaders to create a
                real-time animation (with a trippy liquid / shadow / blur
                aesthetic).
              </p>
              <p>
                The animation is created using a random seed position and mixes
                in random noise (fractal brownian motion, 3D simplex noise), so
                each time you re-run it you're creating a unique piece of art.
              </p>
              <p>
                Github repo:
                <a
                  href="https://github.com/collidingScopes/liquid-shape-distortions"
                  >https://github.com/collidingScopes/liquid-shape-distortions</a
                >
              </p>
              <p>-----</p>
              <p>
                I hope you enjoy the visuals. I'd love to hear any feedback or
                suggestions.
              </p>
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
