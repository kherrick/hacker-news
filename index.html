<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35655910">
          <h3>
            <a
              class="item"
              href="https://static.sched.com/hosted_files/kccnceu2023/3d/KubeCon-2023-Scaling-Databases-Activision.pdf"
              >Scaling Databases at Activision [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 16:09:37</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35655910"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35655780">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/lyft-to-cut-at-least-1-200-jobs-in-new-round-of-layoffs-to-reduce-costs-da423e53"
              >Lyft to Cut at Least 1,200 Jobs in New Round of Layoffs to Reduce
              Costs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 16:01:35</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35655780"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35655282">
          <h3>
            <a
              class="item"
              href="https://www.eff.org/deeplinks/2023/04/earn-it-bill-back-again-seeking-scan-our-messages-and-photos"
              >The EARN IT bill is back, seeking to scan our messages and
              photos</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 15:32:44</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35655282"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35654783">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-01391-5"
              >Editors quit top neuroscience journal to protest against
              open-access charges</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 14:59:37</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35654783"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35654654">
          <h3>
            <a
              class="item"
              href="https://9to5mac.com/2023/04/18/iphone-sideloading/"
              >Apple’s fight against iPhone sideloading was pointless at best,
              harmful at worst</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 14:52:16</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35654654"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35654621">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=i4EFkspO5p4"
              >Four-Byte Burger [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 14:50:31</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35654621"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35654574">
          <h3>
            <a
              class="item"
              href="https://www.fileside.app/blog/2023-03-17_windows-file-paths/"
              >The weird world of Windows file paths</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 14:47:54</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35654574"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35653867">
          <h3>
            <a
              class="item"
              href="https://www.thedailybeast.com/elon-musk-tech-bosses-are-letting-dictators-censor-what-americans-see"
              >Tech bosses are letting dictators censor what Americans see</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 14:00:30</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35653867"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35653816">
          <h3>
            <a class="item" href="https://memit.baulab.info/"
              >Mass editing memory in a transformer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 13:56:56</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35653816"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35653719">
          <h3>
            <a
              class="item"
              href="https://wideangle.co/blog/dark-patterns-examples-of-manipulative-consent-requests"
              >Manipulative Consent Requests</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 13:49:56</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35653719"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35653702">
          <h3>
            <a
              class="item"
              href="https://candidates.perrettlaver.com/vacancies/3565/"
              >W3C invites applications to be our next CEO</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 13:49:09</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35653702"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35653648">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/ai/code-with-bard/"
              >Bard coding update with Colab exporting</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 13:45:29</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35653648"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35652852">
          <h3>
            <a
              class="item"
              href="https://www.undeadly.org/cgi?action=article;sid=20230421124221"
              >OpenBSD: Viogpu(4), a VirtIO GPU driver, added to -current</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 12:42:52</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35652852"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35652541">
          <h3>
            <a class="item" href="https://revive-machines.com/index-en.html"
              >Atari 800XL Remake</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 12:11:03</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35652541"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35652444">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/interactive/science-and-technology/2023/04/22/large-creative-ai-models-will-transform-how-we-live-and-work"
              >Large, creative AI models will transform lives and labour
              markets</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 11:58:13</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35652444"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35651871">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/null-island-is-one-of-the-most-visited-places-on-earth-too-bad-it-doesnt-exist"
              >Null Island is one of the most visited places on Earth, and it
              doesn’t exist</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 10:32:50</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35651871"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35650699">
          <h3>
            <a class="item" href="https://president.mn/mng/"
              >Office of the President of Mongolia: Top to bottom text on the
              web</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 07:20:07</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35650699"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35650563">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/memfault/730541eb-637f-4d9d-9526-8949432f9a34"
              >Memfault (YC W19) Is Hiring Their First Product Designer
              (Berlin)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 07:00:07</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35650200">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35650200"
              >Tell HN: Eid Mubarak</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 05:55:19</span
              ><span class="points-container"
                >Points: <span class="points">427</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35650200"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
            <div class="text">
              <p>
                For those who don't know. Eid is a day of celebration after the
                month of Ramadan, in which Muslims fasted for 30 days from
                sunrise to sunset with no food or water. It's something 2B
                people around the world celebrate to today or tomorrow (moon
                sighting permitted).
              </p>
              <p>
                A note on Ramadan. To those interested in intermittent fasting,
                longevity, and coming back to a more human experience not
                drowning in technology, food and consumerism I would say check
                it out! After over 20 years of doing it I'm still learning
                something new every year, or I should say, unlearning bad habits
                we've created for ourselves as a society through abundance.
              </p>
              <p>Hope you all have a great day!</p>
            </div>
          </section>
        </section>
        <section id="35649935">
          <h3>
            <a
              class="item"
              href="https://thedriven.io/2023/04/21/worlds-largest-battery-maker-announces-major-breakthrough-in-battery-density/"
              >CATL has announced a new “condensed” battery with 500 Wh/kg</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 04:54:39</span
              ><span class="points-container"
                >Points: <span class="points">774</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35649935"
                  >Comments</a
                ><span class="descendants">: 605</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35649245">
          <h3>
            <a class="item" href="https://www.newgrounds.com/portal/view/881533"
              >Show HN: Thoughts on Flash in 2023, in Flash, in 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 02:48:05</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35649245"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
            <div class="text">
              Spent the past few days making this - something halfway between a
              demoscene program and an experimental film. I wanted to celebrate
              the unique computer-y aesthetics of flash, while showing off some
              weird and obscure tricks I've picked up over the years since it's
              been deprecated. (Also, some maybe-not-subtle commentary about
              AI-art and the tools of the future)
            </div>
          </section>
        </section>
        <section id="35648440">
          <h3>
            <a class="item" href="https://www.saelig.com/product/c700.htm"
              >RF Breadboarding System</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-21 @ 00:37:35</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35648440"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35646199">
          <h3>
            <a class="item" href="https://x.st/spinning-diagrams-with-css/"
              >Spinning Diagrams with CSS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 20:57:54</span
              ><span class="points-container"
                >Points: <span class="points">890</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35646199"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35646033">
          <h3>
            <a
              class="item"
              href="https://www.extremeelectronics.co.uk/pico-cray-small-scale-distributed-computing/"
              >Pico Cray – Small scale distributed computing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 20:45:33</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35646033"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35644468">
          <h3>
            <a
              class="item"
              href="https://kelteseth.com/post/20-04-2023-current-issues-with-the-qt-project-from-the-outside-looking-in/"
              >Current issues with the Qt project from the outside looking in</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 18:51:23</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35644468"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35643432">
          <h3>
            <a
              class="item"
              href="https://alexkondov.com/use-databases-without-putting-domain-logic-in-them/"
              >Use databases without putting domain logic in them</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 17:38:47</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35643432"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35643255">
          <h3>
            <a
              class="item"
              href="https://github.com/highlight/highlight/blob/main/README.md"
              >Show HN: We built a ClickHouse-based logging service</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 17:26:31</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35643255"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today we're sharing a ClickHouse-based logging solution we've
                been working on. We wanted to showcase how we built it and share
                how you could try it out to give feedback. Since we started
                working on highlight.io, we've been hyper-focused on "cohesion",
                or ensuring that when you install your monitoring stack, all of
                the resources in that stack (user interactions, requests,
                traces, logs, etc.) are connected in a consumable way. We've
                written up more about our philosophy on this here [1].
              </p>
              <p>
                We started building towards this by connecting your client-side
                app and your server-side exceptions with session replay and
                exception monitoring; i.e. if an error happened in a server-side
                app, we would make it easy (with session replay) to trace all
                the steps that a user took leading up to it.
              </p>
              <p>
                Especially for larger companies using highlight.io, the request
                to tie in logs came up repeatedly, and we wanted to build this
                with the same philosophy in mind. Now, you'll see client-side
                and server-side logs all in one place, brought together in the
                context of a user session, as well as logs in the context of an
                error.
              </p>
              <p>
                Like the rest of our stack, this project is written in Go and
                Typescript, and for log ingestion/querying, we're using
                ClickHouse [2]. Before deciding on ClickHouse, we were planning
                to use OpenSearch (an aws fork of elasticsearch [3]) for this
                part of our product, but as our traffic has increased, we
                encountered quite a few pains with write throughput for
                OpenSearch. After evaluating a few options, we eventually landed
                with ClickHouse (their cloud offering was icing on the cake),
                which has also proven to be much more cost-effective so far.
              </p>
              <p>
                Building with ClickHouse from scratch has been an exciting
                journey. Eric (the mastermind behind this project) wrote a blog
                post [4] on a handful of ClickHouse learnings we've gathered
                since starting the project.
              </p>
              <p>
                For those wanting to try out the product locally, you can run
                the following commands [5]:
              </p>
              <p>
                git clone --recurse-submodules
                <a href="https://github.com/highlight/highlight"
                  >https://github.com/highlight/highlight</a
                >
                cd highlight/docker; ./run-hobby.sh;
              </p>
              <p>
                To send logs to highlight, you can use your own OpenTelemetry
                implementation [6] or use our SDKs [7] which provide lightweight
                wrappers over OTEL.
              </p>
              <p>
                Like the rest of highlight.io, we plan to make money from this
                with our hosted cloud offering. For those interested in trying
                out the cloud-hosted version, you can get setup at
                app.highlight.io.
              </p>
              <p>
                To open the floor for feedback, we would love to get some
                thoughts on what we've built so far. Beyond that, what are parts
                of a logging product you wish you had with your current setup?
                And are there any notable pain-points of using a hosted
                monitoring product? (We're toying with the idea of an enterprise
                deployment). Excited to hear from everyone.
              </p>
              <p>
                [1]:
                <a
                  href="https://highlight.io/docs/general/company/product-philosphy"
                  >https://highlight.io/docs/general/company/product-philosphy</a
                >
              </p>
              <p>
                [2]: <a href="https://clickhouse.com">https://clickhouse.com</a>
              </p>
              <p>
                [3]:
                <a href="https://news.ycombinator.com/item?id=26780848"
                  >https://news.ycombinator.com/item?id=26780848</a
                >
              </p>
              <p>
                [4]:
                <a
                  href="https://www.highlight.io/blog/how-we-built-logging-with-clickhouse"
                  >https://www.highlight.io/blog/how-we-built-logging-with-clic...</a
                >
              </p>
              <p>
                [5]:
                <a
                  href="https://www.highlight.io/docs/getting-started/self-host/self-hosted-hobby-guide"
                  >https://www.highlight.io/docs/getting-started/self-host/self...</a
                >
              </p>
              <p>
                [6]:
                <a
                  href="https://www.highlight.io/docs/getting-started/backend-logging/http"
                  >https://www.highlight.io/docs/getting-started/backend-loggin...</a
                >
              </p>
              <p>
                [7]:
                <a
                  href="https://www.highlight.io/docs/getting-started/overview#for-your-backend-logging"
                  >https://www.highlight.io/docs/getting-started/overview#for-y...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="35640894">
          <h3>
            <a
              class="item"
              href="https://davidlaprade.github.io/give-a-lot-of-notice"
              >Career advice no one gave me: Give a lot of notice when you
              quit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-20 @ 14:46:30</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35640894"
                  >Comments</a
                ><span class="descendants">: 159</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35633999">
          <h3>
            <a class="item" href="https://fictionalbrandsarchive.com/"
              >Fictional Brands Archive</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-19 @ 22:14:38</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35633999"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35626891">
          <h3>
            <a
              class="item"
              href="https://www.vice.com/en/article/v7beyj/car-thieves-tech-hidden-old-nokia-phones-bluetooth-speakers-emergency-engine-start-keyless"
              >Car thieves using tech disguised inside old Nokia phones and
              Bluetooth speakers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-19 @ 11:33:55</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35626891"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
