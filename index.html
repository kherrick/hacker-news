<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40318456">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2024/05/10/1249930674/california-restaurants-fees"
              >California says restaurants must bake all of their add-on fees
              into menu prices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 13:00:18</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40318456"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40318356">
          <h3>
            <a
              class="item"
              href="https://www.swpc.noaa.gov/news/swpc-issues-its-first-g4-watch-2005"
              >SWPC issues first G4 geomagnetic storm watch since 2005</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 12:52:27</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40318356"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40318206">
          <h3>
            <a class="item" href="https://sel4.systems/news/#member-apple"
              >Apple Joins the SeL4 Foundation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 12:33:04</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40318206"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40317912">
          <h3>
            <a class="item" href="https://dkimvalidator.com/"
              >DKIM, SPF, SpamAssassin Email Validator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 12:02:19</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40317912"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40317883">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/science.adk4858"
              >A fragment of human cerebral cortex reconstructed at nanoscale
              resolution</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 11:59:22</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40317883"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40317740">
          <h3>
            <a
              class="item"
              href="https://developer.mozilla.org/en-US/docs/Web/API/Popover_API"
              >Popover API</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 11:41:12</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40317740"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40317627">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/pc-components/cpus/apple-m4-scores-suggest-it-is-the-new-single-core-performance-champ-beating-intels-core-i9-14900ks-incredible-results-of-3800-posted"
              >Apple M4 benchmarks suggest it is new single-core performance
              champ</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 11:22:23</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40317627"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40316814">
          <h3>
            <a
              class="item"
              href="https://www.think-cell.com/en/career/devblog/trip-report-cpp-now-2024"
              >Trip C++Now 2024 – think-cell</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 09:06:05</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40316814"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40316788">
          <h3>
            <a
              class="item"
              href="https://mathoverflow.net/questions/470951/is-the-largest-root-of-a-random-polynomial-more-likely-to-be-real-than-complex"
              >Is the largest root of a random polynomial more likely to be real
              than complex?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 09:01:05</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40316788"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40316121">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/bloop/jobs/iCrEllp-ai-engineer"
              >Bloop (YC S21) Is Hiring AI Engineers. Devin for Legacy Code
              (London, Onsite)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 07:00:38</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40316039">
          <h3>
            <a class="item" href="https://github.com/travisdoor/tine"
              >Tine Text Editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 06:43:36</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40316039"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40316010">
          <h3>
            <a class="item" href="https://elv.sh"
              >Elvish, expressive programming language and a versatile
              interactive shell</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 06:38:44</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40316010"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40315970">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cjje132jvygo"
              >Roman Tyrian purple snail dye found in UK for first time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 06:31:34</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40315970"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40315434">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.17027"
              >Player-Driven Emergence in LLM-Driven Game Narrative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 04:05:29</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40315434"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40315400">
          <h3>
            <a class="item" href="https://lwn.net/Articles/444910/"
              >Object oriented design patterns in the Linux kernel (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 03:58:42</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40315400"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40314285">
          <h3>
            <a
              class="item"
              href="https://direct.mit.edu/books/oa-monograph/5770/Weapons-in-SpaceTechnology-Politics-and-the-Rise"
              >Weapons in Space Technology, Politics, and the Rise and Fall of
              SDI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 00:16:39</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40314285"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40314236">
          <h3>
            <a
              class="item"
              href="https://www.cs.utexas.edu/~gdurrett/courses/online-course/materials.html"
              >CS388: Natural Language Processing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 00:09:11</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40314236"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40313798">
          <h3>
            <a class="item" href="https://github.com/wayland-transpositor/wprs"
              >Wprs – rootless remote desktop for Wayland (and X11, via
              XWayland) applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 23:02:14</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40313798"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40313733">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/5/9/24153113/apple-ipad-ad-crushing-apology"
              >Apple apologizes for iPad 'Crush' ad that 'missed the mark'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 22:50:05</span
              ><span class="points-container"
                >Points: <span class="points">309</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40313733"
                  >Comments</a
                ><span class="descendants">: 707</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40313143">
          <h3>
            <a class="item" href="https://github.com/ahrm/sioyek"
              >Sioyek is a PDF viewer with a focus on textbooks and research
              papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 21:28:43</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40313143"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40310896">
          <h3>
            <a
              class="item"
              href="https://brooker.co.za/blog/2024/05/09/nagle.html"
              >It's always TCP_NODELAY</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 17:54:49</span
              ><span class="points-container"
                >Points: <span class="points">727</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40310896"
                  >Comments</a
                ><span class="descendants">: 228</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40309342">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40309342"
              >Launch HN: Muddy (YC S19) – Multiplayer browser for getting work
              done</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 15:38:48</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40309342"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
            <div class="text">
              <a href="https://feelmuddy.com/">https://feelmuddy.com/</a>).
              Muddy is a browser for work that automatically keeps project files
              organized in the same place where you use and share them. Here’s a
              demo:
              <a href="https://www.youtube.com/watch?v=tZr49aN3sjQ"
                >https://www.youtube.com/watch?v=tZr49aN3sjQ</a
              >. Download and try it out here:
              <a href="https://feelmuddy.com/">https://feelmuddy.com/</a>.
              <p>
                Building together in the past, we were incredibly frustrated
                with how much friction there is to get anything done on our
                computers. I was losing time everyday digging through chat logs
                looking for that one important link or breaking others out of
                flow by asking where something is.
              </p>
              <p>
                Web apps promised to help us get more done—and they do, but each
                in its own silo, so there’s still a ton of redundancy to deal
                with. Every app has its own way of organizing files, its own
                notification inbox, its own search system. Conversations live
                everywhere and there isn’t a single view to see everything about
                a project. Remember when files simply lived in folders rather
                than the “cloud”?
              </p>
              <p>
                We started dedicating time to organizing our files in shared
                docs and limiting new apps we used. This helped – but the second
                we didn’t stay on top of organization, links became stale and
                things got messy again.
              </p>
              <p>
                Muddy started as a hack week project we built for ourselves—a
                single place to use web apps with others, but personalized for
                each user automatically. Everyone gets their own view for every
                project, designed around how they work.
              </p>
              <p>
                Muddy users work on projects in spaces, which are like automatic
                tab groups. Users share apps (any site works—a Github PR, Figma
                file, Trello board—whatever you want) into the project’s shared
                timeline and Muddy automatically opens relevant tabs for you.
                It’s a single click to open up all the apps you need for the
                project.
              </p>
              <p>
                Under the hood, Muddy works in the background to keep track of
                the timeline and uses a LLM to continuously organize apps and
                keep everything on to date. It considers signals like the
                popularity of a file, naming conventions, and conversations to
                figure out what’s relevant. So everyone is presented with an
                updated list of important tabs, without anyone lifting a finger.
                Our actual browser is based on Chromium.
              </p>
              <p>
                When you need to revisit something from weeks ago, you can
                rewind the project timeline to that point in a single click.
                Apps open up in the timeline so you’ll see your files right
                away. For sites that don’t have built in collaboration features
                (like documentation), Muddy lets you do annotations directly on
                the website.
              </p>
              <p>
                Projects sometimes get big and need to be broken up. Across all
                your spaces, Muddy can answer questions like ChatGPT, cite your
                files as sources, and return apps directly. This is possible
                since Muddy’s AI shares your browser and can use your
                authenticated apps locally (with privacy in mind).
              </p>
              <p>
                Other browsers like Chrome and Arc focus on solo productivity
                with sharing as a bolt-on. We think productivity depends on how
                well you can work with others, and should be the first class
                consideration. And doing organizational work manually is
                unsustainable.
              </p>
              <p>
                Muddy will have paid subscriptions for teams with additional
                features like shared passwords, team organization, custom
                shortcuts, and SSO management. Those aren’t built out yet and
                the base product will be free. No part of our revenue will come
                from data monetization.
              </p>
              <p>
                We’d love for you to give Muddy a spin! You can download Muddy
                for Mac or Windows on our website and add others once inside:
                <a href="https://feelmuddy.com/">https://feelmuddy.com/</a>.
                We’ll be around to answer questions and look forward to any and
                all feedback!
              </p>
            </div>
          </section>
        </section>
        <section id="40299681">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-05-modern-plate-tectonics-due-blobs.html"
              >Computer models suggest modern plate tectonics due to blobs left
              by collision</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 16:06:42</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40299681"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40297642">
          <h3>
            <a
              class="item"
              href="https://medium.com/@malikpiara/introducing-logicola-3-1aa4047ee335"
              >Logicola 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 13:03:12</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40297642"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40294808">
          <h3>
            <a class="item" href="https://github.com/fzliu/radient"
              >Radient – vectorize many data types, not just text</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 06:03:18</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40294808"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40294660">
          <h3>
            <a class="item" href="https://aestuans.github.io/blob/"
              >Show HN: A simple 2D fluid and gravity simulation with WASM and
              WebGL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 05:30:03</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40294660"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                Mainly an excuse for me to experiment with wasm and WebGL, but
                it makes for a surprisingly good fidget toy.
              </p>
            </div>
          </section>
        </section>
        <section id="40291012">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/sound-suppressing-silk-can-create-quiet-spaces-0507"
              >Sound-suppressing silk can create quiet spaces</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 20:23:29</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40291012"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40290228">
          <h3>
            <a
              class="item"
              href="https://hakaimagazine.com/features/how-viking-age-hunters-took-down-the-biggest-animal-on-earth/"
              >Medieval Icelanders were likely hunting blue whales long
              industrial technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 19:12:15</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40290228"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40265928">
          <h3>
            <a
              class="item"
              href="https://melmagazine.com/en-us/story/orson-welles-drunk-wine-commercial"
              >I was at the clapperboard for Orson Welles' drunk wine commercial
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 16:12:30</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40265928"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40265332">
          <h3>
            <a
              class="item"
              href="http://oldvcr.blogspot.com/2024/05/with-powerpc-windows-ce-and-wiin-pad.html"
              >With PowerPC, Windows CE and the WiiN-Pad Slate, Everyone's a
              WiiN-Er</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 14:54:44</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40265332"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
