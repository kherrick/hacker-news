<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36820469">
          <h3>
            <a
              class="item"
              href="https://blog.zaccohn.com/Fruitflies-and-the-Little-Shop-of-Horrors/"
              >Managing Kitchen Fruit Flies with a Little Shop of Horrors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 21:58:40</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36820469"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36820378">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36820378"
              >Ask HN: What are some LLM prompts you've found useful?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 21:51:07</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36820378"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>I'll start with mine:</p>
              <p>All of these queries are for ChatGPT using GPT-4.</p>
              <p>tip-of-my-tongue-search:</p>
              <p>
                Hello. I am in a tip-of-my tongue situation, and it's your job
                to help me figure out what thing I'm describing.
              </p>
              <p>
                Vague descriptions of how I remember something will be given to
                you, and it's your job to help me figure out what I'm
                remembering. These memories may have inaccuracies or may be
                conflated with other memories. Your job is to help me figure out
                what I might be thinking of, by giving me suggestions. Tell me
                what you think I might be thinking of, and also what you think I
                might be remembering incorrectly. When you give me a list of
                things that might be what I'm thinking of, factor in your
                personal confidence in the result. For example, if you are
                unsure what I may be thinking of, try listing 10 different
                things that may be related or what I am thinking of. Another
                example of factoring in a personal confidence in a guess: When
                you are more sure of an answer, provide fewer results, but a
                more detailed description for a few things, and state how you
                are confident in your answer.
              </p>
              <p>
                Tell me how you are going to answer a question like this: "I'm
                thinking of a game, I think it was for the original xbox. I
                think it was about alien worlds? I remember there was this green
                millitary guy, who was an alien named halo"
              </p>
              <p>
                [Confirm that the returned response understands that I'm talking
                about Halo, while also being able to correct what I'm
                remembering wrong. If this response isn't a good starting seed,
                either tune it with corrections, or try again.]
              </p>
              <p>ableton-live-help:</p>
              <p>
                You are my music production assistant. Your job is to help me
                with music production by answering questions about music theory,
                mixing, mastering, instrument design, guitar production, and
                more. Answer questions in an academic, thoughtful manner. Answer
                as if you were giving an answer to a professional, with
                knowledge and experience. Your questions are backed by music
                theory, acoustics, digital signal processing principles, and a
                wealth of music production experience.
              </p>
              <p>
                Include examples and instructions when questions ask how to do
                something. When giving examples, use the DAW Ableton Live 10 as
                your example and instruction reference DAW.
              </p>
              <p>
                Tell me how you will answer questions to begin. After your
                answer we will go into "query mode", where the user asks
                questions and advice
              </p>
              <p>[Confirm prompt using similar methods as above]</p>
            </div>
          </section>
        </section>
        <section id="36819906">
          <h3>
            <a
              class="item"
              href="https://github.com/ggerganov/llama.cpp/pull/1773"
              >Llama: Add grammar-based sampling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 21:17:45</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36819906"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36819894">
          <h3>
            <a
              class="item"
              href="https://www.zdnet.com/article/meta-cancels-quest-pro-stops-development-of-quest-pro-2/"
              >Meta stops ordering new parts for Quest Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 21:16:08</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36819894"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36819670">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/sleep-reset/jobs/8qZIdyD-personal-assistant-must-be-korean-english-bilingual"
              >Sleep Reset (YC W17) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 21:01:12</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36818896">
          <h3>
            <a
              class="item"
              href="https://natesilver.substack.com/p/journalists-should-be-skeptical-of"
              >Journalists should be skeptical of all sources including
              scientists</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 20:01:20</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36818896"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36818713">
          <h3>
            <a
              class="item"
              href="https://journals.sagepub.com/doi/10.1177/01410768231164780"
              >Borderline personality disorder: a spurious condition?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 19:49:10</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36818713"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36818640">
          <h3>
            <a
              class="item"
              href="https://www.bigtechwiki.com/index.php/Big_Tech_as_the_New_Big_Tobacco"
              >Big Tech as the New Big Tobacco</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 19:44:31</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36818640"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36818501">
          <h3>
            <a
              class="item"
              href="https://onehundredpages.wordpress.com/2013/06/12/dont-make-fun-of-renowned-dan-brown/"
              >Don’t Make Fun of Renowned Dan Brown (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 19:35:39</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36818501"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36818233">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/07/20/slackware_turns_30/"
              >Slackware Linux distribution turns 30 years old</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 19:17:28</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36818233"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36817900">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/07/imax-emulates-palmpilot-software-to-power-oppenheimers-70-mm-release/"
              >IMAX emulates PalmPilot software to power Oppenheimer’s 70 mm
              release</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 18:52:01</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36817900"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36817628">
          <h3><a class="item" href="https://www.minizinc.org/">MiniZinc</a></h3>
          <section>
            <h4>
              <span>2023-07-21 @ 18:32:16</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36817628"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36817482">
          <h3>
            <a
              class="item"
              href="https://www.tech-insider.org/unix/research/1992/0622.html"
              >For BSD Unix, It's Sayonara (1992)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 18:22:52</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36817482"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36817305">
          <h3>
            <a
              class="item"
              href="https://github.com/RupertBenWiser/Web-Environment-Integrity"
              >Web Environment Integrity API Proposal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 18:09:43</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36817305"
                  >Comments</a
                ><span class="descendants">: 151</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36816436">
          <h3>
            <a
              class="item"
              href="https://www.psypost.org/2023/07/longitudinal-study-highlights-bidirectional-relationship-between-childhood-maltreatment-and-adhd-symptoms-166568"
              >Longitudinal study on the relationship between childhood
              maltreatment and ADHD</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 17:05:11</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36816436"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36815744">
          <h3>
            <a
              class="item"
              href="https://www.forbes.com/sites/paultassi/2023/07/21/world-of-warcraft-players-trick-ai-scraping-games-website-into-publishing-nonsense/"
              >‘World of Warcraft’ players trick AI-scraping website into
              publishing nonsense</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 16:22:20</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36815744"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36815705">
          <h3>
            <a class="item" href="https://blog.phnx.im/rfc-9420-mls/"
              >RFC 9420 a.k.a. Messaging Layer Security</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 16:19:54</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36815705"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36815453">
          <h3>
            <a
              class="item"
              href="https://www.semafor.com/article/07/21/2023/exxon-carbon-denbury"
              >Exxon bets carbon will be the new oil</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 16:02:42</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36815453"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36815255">
          <h3>
            <a
              class="item"
              href="https://www.alessiofanelli.com/blog/llama2-isnt-open-source"
              >In the LLM space, "open source" is being used to mean
              "downloadable weights"</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 15:49:04</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36815255"
                  >Comments</a
                ><span class="descendants">: 184</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36813564">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02374-2"
              >Dementia risk linked to blood-protein imbalance in middle age</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 13:34:11</span
              ><span class="points-container"
                >Points: <span class="points">301</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36813564"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36813210">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/07/the-90s-internet-when-20-hours-online-triggered-an-email-from-my-isps-president/"
              >90s Internet: When 20 hours online triggered an email from my
              ISP’s president</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 12:56:25</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36813210"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36813086">
          <h3>
            <a class="item" href="https://primocms.org"
              >Show HN: Primo – a visual CMS with Svelte blocks, a code editor,
              and SSG</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 12:38:14</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36813086"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36812175">
          <h3>
            <a
              class="item"
              href="http://www.zannzen.com/blog/small_joys_with_odin_1/"
              >Small joys of programming in Odin</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 10:30:55</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36812175"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36811554">
          <h3>
            <a
              class="item"
              href="https://andreabergia.com/blog/2023/07/i-have-written-a-jvm-in-rust/"
              >I have written a JVM in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 08:48:48</span
              ><span class="points-container"
                >Points: <span class="points">598</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36811554"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36811018">
          <h3>
            <a
              class="item"
              href="https://home.cern/news/news/accelerators/accelerator-report-quench-lhc-inner-triplet-magnet-causes-small-leak-major"
              >Quench of LHC inner triplet magnet causes a small leak with major
              consequences</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 07:29:26</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36811018"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36810818">
          <h3>
            <a
              class="item"
              href="https://www.evanjones.ca/nanosecond-collisions.html"
              >Nanosecond timestamp collisions are common</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 07:01:03</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36810818"
                  >Comments</a
                ><span class="descendants">: 230</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36796917">
          <h3>
            <a
              class="item"
              href="https://www.tabletmag.com/sections/arts-letters/articles/lament-for-susan"
              >The Rediscovery of Susan Taubes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-20 @ 04:32:45</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36796917"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36784864">
          <h3>
            <a
              class="item"
              href="https://commoncog.com/seeing-expertise-milestone-worth-aiming-for/"
              >Ability to see expertise is a milestone worth aiming for
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 11:51:08</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36784864"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36783196">
          <h3>
            <a class="item" href="https://siderea.dreamwidth.org/1817931.html"
              >How professional ethics work</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 07:41:41</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36783196"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36783062">
          <h3>
            <a
              class="item"
              href="https://blog.jgc.org/2023/07/revisiting-cansole-my-silly-pong-game.html"
              >Revisiting the “Cansole”, because my TV doesn't have the right
              connectors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 07:20:26</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36783062"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
