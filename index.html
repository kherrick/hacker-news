<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36150543">
          <h3>
            <a
              class="item"
              href="https://escapebigtech.info/posts/privacy-one-of-the-most-fundamental-human-rights-yet-constantly-under-threat/"
              >Privacy: One of the Most Fundamental Human Rights, yet Constantly
              Under Threat</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 13:07:57</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36150543"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36150443">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/wellness/2023/06/01/schizophrenia-autoimmune-lupus-psychiatry/"
              >Autoimmune disease can attack the brain, cause psychiatric
              symptoms</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 12:56:22</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36150443"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36150300">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2023/06/selectively-compressed-images-a-hybrid-format/"
              >Selectively Compressed Images – A Hybrid Format</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 12:40:15</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36150300"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36150274">
          <h3>
            <a
              class="item"
              href="https://www.hamiltonnolan.com/p/automate-the-ceos"
              >Automate the CEOs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 12:37:54</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36150274"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36150110">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/family/archive/2020/10/people-who-prioritize-friendship-over-romance/616779/"
              >What If Friendship, Not Marriage, Was at the Center of Life?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 12:19:17</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36150110"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36149966">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36149966"
              >Ask HN: Lots of AWS credits expiring soon, ideas?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 11:59:33</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36149966"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
            <div class="text">
              <p>
                Long story short I have a lot (~$10K) of AWS credits expiring in
                a few months. Any ideas on the best way to make money / do some
                good with those? I can't directly sell them. Thanks!
              </p>
            </div>
          </section>
        </section>
        <section id="36149904">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36149904"
              >Ask HN: Cyber Security folks – what are your biggest pain
              points?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 11:51:16</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36149904"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                In my case I'm building everything from the ground up, and the
                MVP is trying to start with a better inventory of everything;
                whereas the inventory focusses on the network-scale rather than
                the "per single machine scale" that other solutions offer (if
                they even offer anything like it, which in practice they
                actually don't for the most parts).
              </p>
              <p>
                My journey started with log4j's log4shell1/2, after realizing
                that most blueteams (my one included) don't actually have a
                full, reliable and correctly indexed inventory. If you ask
                around in other blueteams something simple like "How many
                machines you got?" you'll always get responses like "well, one
                software says 30.000, the other one 24.000 and our SNMP sensors
                say around 38.000..." which is kinda ridiculous to start with.
                If you then ask whether or not they use log4j in any of their
                software they either shrug or say "nope" with a panicking voice,
                because they don't really know for sure.
              </p>
              <p>
                Anyways, my solution currently is a peer-to-peer approach where
                the systems themselves decide to mitigate issues, propagate
                patches (or even vaccines for zero-days) and also share
                incidents that look suspicious, so the surrounding nodes can
                start to quarantine themselves off, for example, when something
                really bad happened. For this to be a reliable product I decided
                to ditch the whole Windows "hooks are kinda useless" shitshow,
                and went for Linux/BSD/Unizes in general first, while leveraging
                a mixture of golang for userspace and eBPF for kernelspace.
              </p>
              <p>
                But I wouldn't be a good founder if I ignored my customers,
                right?
              </p>
              <p>
                So my questions are now somewhat to all the cyber security
                professionals out there:
              </p>
              <p>
                - What are your biggest pain points? Do you use yet another
                Elastic Search dashboard that's painful to use in practice?
              </p>
              <p>- Do you have a reliable software inventory / SBOM?</p>
              <p>
                - Do you have a reliable network inventory / NBOM / SaaSBOM?
              </p>
              <p>
                - Do you have an SBOM for all third-party software that's only
                available via binaries, where you don't have the source code
                available?
              </p>
              <p>
                - Does your anti-virus / EDR solution still require signatures
                or is it behaviour driven?
              </p>
              <p>
                - What about golang malware (aka malware that doesn't need to
                call hooked APIs in the kernel and can instead just use
                something like purego to generate shellcode directly)?
              </p>
              <p>
                - How confident are you that your CVE/NVD vulnerability database
                is correctly tagged? (hint: I think it's not reliable for more
                than 80% of entries)
              </p>
              <p>
                - Do you use Linux in your infrastructure? If so, which
                distributions?
              </p>
            </div>
          </section>
        </section>
        <section id="36149789">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-05-secret-industry-documents-reveal-makers.html"
              >Industry docs reveal makers of 'forever chemicals' covered up
              health dangers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 11:33:04</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36149789"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36149690">
          <h3>
            <a
              class="item"
              href="https://www.vice.com/en/article/4a3xe9/maryland-license-plates-now-inadvertently-advertising-filipino-online-casino"
              >Maryland License Plates Now Inadvertently Advertising Filipino
              Online Casino</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 11:18:44</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36149690"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36149462">
          <h3>
            <a class="item" href="http://ratfactor.com/zig/hard"
              >I think Zig is hard but worth it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 10:44:44</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36149462"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36149375">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/sysadmin/comments/13wmowy/psa_epyc_7002_cpus_may_hang_after_1042_days_of/"
              >EPYC 7002 CPUs may hang after 1042 days of uptime</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 10:30:48</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36149375"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36149004">
          <h3>
            <a
              class="item"
              href="https://netherlands.postsen.com/trends/198695/Securitytxt-now-mandatory-for-Dutch-government-websites.html"
              >Security.txt file now mandatory for Dutch government websites</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 09:27:28</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36149004"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36148807">
          <h3>
            <a class="item" href="https://csspro.com"
              >Show HN: I made CSS Pro, a re-imagined Devtools for web design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 08:47:40</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36148807"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36148588">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/june/jobs/SHd7fFLYG-product-engineer-3"
              >June (YC W21) is hiring product engineer #3</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 08:00:09</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36148495">
          <h3>
            <a
              class="item"
              href="https://resources.altium.com/p/open-source-laptop-part-one"
              >Introduction to Open Source Laptop Project by Lukas Henkel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 07:42:35</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36148495"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36148475">
          <h3>
            <a class="item" href="https://www.distcc.org/"
              >Distcc: A fast, free distributed C/C++ compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 07:37:44</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36148475"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36148269">
          <h3>
            <a
              class="item"
              href="https://www.systemreboot.net/post/deploy-scripts-using-g-expressions"
              >Deploy scripts using G-expressions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 06:53:54</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36148269"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36148217">
          <h3>
            <a
              class="item"
              href="https://github.com/hickford/git-credential-oauth"
              >Show HN: Git credential helper using OAuth in browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 06:45:11</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36148217"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                Git Credential Manager (included with Git for Windows) has a
                similar feature but it's awkward for Linux users to install.
                git-credential-oauth is cross platform and packaged in many
                Linux distributions.
              </p>
            </div>
          </section>
        </section>
        <section id="36146905">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2023/05/31/1179098682/john-coltrane-eric-dolphy-village-gate-1961-lost-album"
              >Lost John Coltrane recording, from experimental phase with Eric
              Dolphy, emerges</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 02:18:09</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36146905"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36146278">
          <h3>
            <a
              class="item"
              href="https://palant.info/2023/05/31/more-malicious-extensions-in-chrome-web-store/"
              >More malicious extensions in Chrome Web Store</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 00:26:45</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36146278"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36145823">
          <h3>
            <a
              class="item"
              href="https://thebulletin.org/2023/05/qa-how-darpa-hacked-a-science-writers-brain-and-turned-her-into-a-sharpshooter/"
              >DARPA hacked a science writer’s brain and turned her into a
              sharpshooter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 23:23:19</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36145823"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36140916">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36140916"
              >Launch HN: Onu (YC W23) – Turn scripts into internal tools in
              minutes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:19:40</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140916"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
            <div class="text">
              <a href="https://joinonu.com">https://joinonu.com</a>). Onu lets
              you write scripts and turn them into internal tools suitable for
              use by non-technical teammates. We built Onu to help you spend
              more time coding and less time running scripts for ops or customer
              support. Unlike no-code/low-code products, we’re code-first and
              let you use your preferred tools. We take care of the annoying
              parts for you: most importantly the frontend, but also auditing,
              permissions, and 3rd party integrations (e.g. Slack, email, Jira,
              Pagerduty).
              <p>
                We’ve put up a few sample screenshots at
                <a href="https://joinonu.com/examples"
                  >https://joinonu.com/examples</a
                >, and a demo video here:
                <a href="https://www.youtube.com/watch?v=4XMnBRsktsw"
                  >https://www.youtube.com/watch?v=4XMnBRsktsw</a
                >.
              </p>
              <p>
                Many engineers lose hours a week fielding requests from other
                teams. While most companies have a home-grown internal dashboard
                (or are using a third party tool builder for this such as
                Retool), there is still a long tail of scripts that engineers
                have to run regularly for their ops and CX teammates, either
                locally or by SSHing into prod. Maybe a user’s account got stuck
                in a weird state, or you have a script to manually onboard new
                customers to your B2B product, or you have to run a custom
                provisioning script each time you add a bike to your e-bike
                fleet (something we experienced at Lyft).
              </p>
              <p>
                We experienced these problems while working on engineering teams
                at Lyft and Stripe. Our teams needed internal tooling, but we
                didn’t have time to build feature-rich dashboards. Stripe had a
                homegrown tool that allowed engineers to quickly spin up simple
                internal tools without writing any frontend code. When we
                started working on Onu with a different idea we immediately felt
                the pain of not having a similar tool. We pivoted to working on
                our current product instead because we already knew how powerful
                it can be for speeding up engineering teams.
              </p>
              <p>
                Internal tool builders mostly take a no code/low code approach
                that requires engineers to duplicate a lot of business logic in
                the browser. This leads to brittle internal apps that are hard
                to keep in sync with the business logic in your codebase, and
                difficult to maintain as you scale. In addition, such tools
                subject you to point-and-click / drag-and-drop workflows that
                just aren’t the sweet spot for programmers. We don’t like
                working that way ourselves, so we focus on a code-first
                approach, allowing you to hand scripts to non-technical
                teammates to own and run without engineering oversight.
              </p>
              <p>
                Onu works with your existing dev workflow. You write scripts in
                your editor of choice—not the browser—and deploy tasks the same
                way you deploy any other code. We can host your scripts if you
                prefer, but you can also add Onu to your existing Express server
                and our frontend will handle routing requests to the correct
                script. We currently have a Node SDK and are rolling out Python
                next.
              </p>
              <p>
                You can try Onu now by heading to
                <a href="https://auth.joinonu.com/signup"
                  >https://auth.joinonu.com/signup</a
                >
                and signing up for an account. It’s free for personal use cases
                and for teams of up to 5 people.
              </p>
              <p>We’re looking forward to your thoughts and feedback!</p>
            </div>
          </section>
        </section>
        <section id="36139042">
          <h3>
            <a
              class="item"
              href="https://www.crunchydata.com/blog/svg-images-from-postgis"
              >SVG Images from Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 14:48:53</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36139042"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36138304">
          <h3>
            <a class="item" href="https://cs.uwaterloo.ca/~csk/slide/"
              >Slide to Unlock</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 13:41:55</span
              ><span class="points-container"
                >Points: <span class="points">1053</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36138304"
                  >Comments</a
                ><span class="descendants">: 196</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36137535">
          <h3>
            <a
              class="item"
              href="https://sneller.io/blog/decompressing-at-over-10-gigabytes-per-second/"
              >Iguana: fast SIMD-optimized decompression</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 12:28:46</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36137535"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36136552">
          <h3>
            <a
              class="item"
              href="https://archive.org/details/KevinEdwards6502TheMicroUser"
              >Kevin Edwards in The Micro User – article series on 6502
              (1985)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 10:06:40</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36136552"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36136179">
          <h3>
            <a
              class="item"
              href="https://www.reproof.app/blog/notes-apps-help-us-forget"
              >Notes apps are where ideas go to die (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 09:11:37</span
              ><span class="points-container"
                >Points: <span class="points">584</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36136179"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36135250">
          <h3>
            <a
              class="item"
              href="https://archive.org/details/bitsavers_applelisasarketingCatalogSummer1988_28586791"
              >Sun Remarketing Catalog Summer 1988</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 06:45:27</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36135250"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36130699">
          <h3>
            <a class="item" href="https://obscuritory.com/"
              >The Obscuritory - Odd, lesser-known games and software</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 20:58:36</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36130699"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36130194">
          <h3>
            <a
              class="item"
              href="https://borretti.me/article/language-pragmatics"
              >Language Pragmatics Engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 20:22:11</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36130194"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
