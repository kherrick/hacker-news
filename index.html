<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41118418">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/play/jobs/f7pIIqU-product-engineer-at-play-yc-w23"
              >PlayAI (YC W23) Is Hiring Product Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 12:00:22</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41118349">
          <h3>
            <a
              class="item"
              href="https://cafely.com/blogs/research/which-country-consumes-the-most-coffee"
              >Which country consumes the most coffee?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 11:50:37</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41118349"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41118281">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/articles/c0xj3xq5l1vo"
              >Australia starts world-first peanut allergy treatment for
              babies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 11:40:50</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41118281"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41116813">
          <h3>
            <a
              class="item"
              href="https://fermatslibrary.com/s/cargo-cult-science"
              >Cargo Cult Science (1974)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 06:26:36</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41116813"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41116639">
          <h3>
            <a class="item" href="https://words.filippo.io/rustgo/"
              >Rustgo: Calling Rust from Go with near-zero overhead (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 05:43:33</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41116639"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41116473">
          <h3>
            <a class="item" href="https://github.com/sickcodes/Docker-OSX"
              >macOS in Docker Container</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 04:51:12</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41116473"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41116414">
          <h3>
            <a class="item" href="https://github.com/mcastillof/FakeTraveler"
              >FakeTraveler: Fake where your phone is located (Mock location for
              Android)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 04:30:15</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41116414"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41116253">
          <h3>
            <a class="item" href="https://coldwar-ct.com/Home_Page_S1DO.html"
              >Construction of the AT&amp;amp;T Long Lines "Cheshire"
              underground site</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 03:47:42</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41116253"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41115941">
          <h3>
            <a
              class="item"
              href="https://ogiekako.vercel.app/blog/find_mkdir_tc"
              >`find` + `mkdir` is Turing complete</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 02:22:41</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41115941"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41115619">
          <h3>
            <a
              class="item"
              href="https://blog.activision.com/activision/2024/activision-releases-call-of-duty-warzone-caldera-data-set"
              >Call of Duty: Warzone Caldera Data Set for Academic Use</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 01:06:09</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41115619"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41115591">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/new-superconductor-microprocessor-yields-a-substantial-boost-in-efficiency"
              >Superconducting Microprocessors? Turns Out They're
              Ultra-Efficient (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-31 @ 01:00:26</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41115591"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41115128">
          <h3>
            <a class="item" href="https://github.com/facundoolano/ngtop"
              >Ngtop – Request analytics from the Nginx access logs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 23:31:33</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41115128"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41114839">
          <h3>
            <a
              class="item"
              href="https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/"
              >Our audit of Homebrew</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 22:39:21</span
              ><span class="points-container"
                >Points: <span class="points">606</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41114839"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41114825">
          <h3>
            <a
              class="item"
              href="https://shwin.co/blog/creativity-fundamentally-comes-from-memorization"
              >Creativity fundamentally comes from memorization</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 22:37:24</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41114825"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41114601">
          <h3>
            <a
              class="item"
              href="https://eli.thegreenplace.net/2024/building-static-binaries-with-go-on-linux/"
              >Building static binaries with Go on Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 22:07:53</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41114601"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41114569">
          <h3>
            <a class="item" href="https://lock.cmpxchg8b.com/slowterm.html"
              >Troubleshooting: Terminal Lag</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 22:04:39</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41114569"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41112854">
          <h3>
            <a class="item" href="https://porffor.dev/"
              >Porffor: A from-scratch experimental ahead-of-time JS engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 18:55:10</span
              ><span class="points-container"
                >Points: <span class="points">375</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41112854"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41111208">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/underwater-marble-floor-mosaic-discovered-off-the-coast-of-naples-180984772/"
              >Divers Discover Mesmerizing Roman Mosaic Beneath the Sea</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 16:46:15</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41111208"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41111129">
          <h3>
            <a
              class="item"
              href="https://www.swift.org/blog/announcing-swift-homomorphic-encryption/"
              >Swift Homomorphic Encryption</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 16:40:13</span
              ><span class="points-container"
                >Points: <span class="points">270</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41111129"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41111115">
          <h3>
            <a class="item" href="https://www.stat.cmu.edu/~cshalizi/TALR/"
              >The Truth About Linear Regression (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 16:38:40</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41111115"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41110850">
          <h3>
            <a class="item" href="https://github.com/ssoready/ssoready"
              >Launch HN: SSOReady (YC W24) – Making SAML SSO painless and open
              source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 16:19:45</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41110850"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/ssoready/ssoready"
                >https://github.com/ssoready/ssoready</a
              >).
              <p>
                SSOReady is an open-source (MIT) service that lets you implement
                SAML single sign-on without ever touching SAML yourself. You
                just need to implement two API endpoints: one to initiate SAML
                logins and another to receive incoming SAML messages. And then
                you're pretty much done.
              </p>
              <p>
                Here's me setting up SAML single sign-on in under a minute: (<a
                  href="https://www.youtube.com/watch?v=_HVtFkW8xCI"
                  >https://www.youtube.com/watch?v=_HVtFkW8xCI</a
                >).
              </p>
              <p>
                You can use our service with whatever tech stack or programming
                language you prefer.
              </p>
              <p>
                Earlier in my career, I worked on SAML authentication at
                Segment. I've been pretty obsessed with SAML since then. In the
                depths of the COVID pandemic, I even wrote an implementation of
                SAML in Go to entertain myself (<a
                  href="https://github.com/ucarion/saml"
                  >https://github.com/ucarion/saml</a
                >).
              </p>
              <p>
                Over the years, I've gotten really itchy to build better SAML
                tooling. There just aren't a lot of great options out there.
                Almost no one seems interested in making SAML easy for
                developers. Almost no one seems interested in writing clear
                documentation.
              </p>
              <p>
                We're hoping to change that with SSOReady. We've open-sourced
                our codebase on an MIT license. You can do pretty much whatever
                you want with the code. Fork us. Self-host us.
              </p>
              <p>We've also made the product entirely free.</p>
              <p>
                Why free and open source? We're focused solitarily on becoming
                developers' first choice for SAML SSO. If it makes developers'
                lives easier, it works for us. We expect to monetize in the
                future by building extra features that serve large companies
                with complex needs. We don't see any point to being secretive or
                squeezing dollars out of small companies.
              </p>
              <p>
                I'd be thrilled if you gave the product a try, and I'd be really
                grateful for any feedback on your experience.
              </p>
              <p>
                If you have any questions or concerns, my cofounder Ned and I
                will stay active on this thread throughout the day. You can also
                reach us directly at founders@ssoready.com. (We really mean
                this! We want to hear from you!)
              </p>
            </div>
          </section>
        </section>
        <section id="41108884">
          <h3>
            <a class="item" href="https://siliconfolklore.com/internet-history/"
              >Was the Internet created to survive a nuclear strike? (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 13:20:14</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41108884"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41108662">
          <h3>
            <a
              class="item"
              href="https://www.tunglevo.com/note/crafting-interpreters-with-rust-on-garbage-collection/"
              >Crafting Interpreters with Rust: On Garbage Collection</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 12:57:18</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41108662"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41107480">
          <h3>
            <a
              class="item"
              href="https://www.bristol.ac.uk/news/2024/july/butterflies-static-electricity.html"
              >Butterflies accumulate static electricity to attract pollen
              without contact</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 09:32:56</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41107480"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41106280">
          <h3>
            <a
              class="item"
              href="https://cohost.org/prophet/post/7083950-functional-programmi"
              >Functional languages should be so much better at mutation than
              they are</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 05:31:05</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41106280"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41105229">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/ckdgp7r5y11o"
              >Missing Henry VIII portrait found after random X post</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-30 @ 01:10:28</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41105229"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41102981">
          <h3>
            <a class="item" href="https://trayce.dev"
              >Show HN: Trayce – Network tab for Docker containers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-29 @ 19:23:57</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41102981"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/evanrolfe/trayce_gui"
                >https://github.com/evanrolfe/trayce_gui</a
              >) is an open source desktop application which monitors HTTP(S)
              traffic to Docker containers on your machine. It uses EBPF to
              achieve zero-configuration sniffing of TLS-encrypted traffic.
              <p>
                As a backend developer I wanted something which was similar to
                Wireshark or the Chrome network tab, but which intercepted
                requests &amp; responses to my containers for debugging in a
                local dev environment. Wireshark is a great tool but it seems
                more geared towards lower level networking tasks. When I'm
                developing APIs or microservices I dont care about packets, I'm
                only concerned with HTTP requests and their responses. I also
                didn't want to have to configure a pre-shared master key to
                intercept TLS, I wanted it to work out-of-the-box.
              </p>
              <p>
                Trayce is in beta phase so feedback is very welcome, bug reports
                too. The frontend GUI is written in Python with the QT
                framework. The TrayceAgent which is what does the intercepting
                of traffic is written in Go and EBPF.
              </p>
            </div>
          </section>
        </section>
        <section id="41091225">
          <h3>
            <a
              class="item"
              href="https://knowablemagazine.org/content/article/mind/2024/animals-change-social-habits-old-age-macaques-deer-sheep"
              >It's not just us: Other animals change their social habits in old
              age</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 04:28:06</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41091225"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41076063">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s44172-024-00235-y"
              >Genetically synthesized supergain broadband wire-bundle
              antenna</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 05:42:18</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41076063"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41076021">
          <h3>
            <a
              class="item"
              href="https://blog.poisson.chat/posts/2024-07-26-adt-history.html"
              >Where does the name "algebraic data type" come from?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 05:32:05</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41076021"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
