<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38247423">
          <h3>
            <a
              class="item"
              href="https://journals.sagepub.com/doi/full/10.1177/0003122420912941"
              >From Aristocratic to Ordinary: Shifting Modes of Elite
              Distinction (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 05:54:01</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38247423"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38247339">
          <h3>
            <a
              class="item"
              href="https://herbsutter.com/2023/11/11/trip-report-autumn-iso-c-standards-meeting-kona-hi-usa/"
              >Trip Autumn ISO C++ standards meeting</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 05:41:01</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38247339"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38247305">
          <h3>
            <a
              class="item"
              href="https://twitter.com/Vjeux/status/1722733472522142022"
              >10k Bounty for Rewriting Prettier in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 05:34:09</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38247305"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38246668">
          <h3>
            <a
              class="item"
              href="https://www.secondstate.io/articles/fast-llm-inference/"
              >Run LLMs on my own Mac fast and efficient Only 2 MBs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 03:48:44</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38246668"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38246413">
          <h3>
            <a
              class="item"
              href="https://qualiacomputing.com/2019/09/06/more-dakka-in-medicine/"
              >More Dakka in Medicine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 03:05:05</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38246413"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38246395">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=kya_LXa_y1E"
              >String theory lied to us and now science communication is hard
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 03:01:28</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38246395"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38246226">
          <h3>
            <a
              class="item"
              href="https://www.tuxedocomputers.com/en/TUXEDO-Pulse-14-Gen3.tuxedo"
              >Tuxedo Pulse Gen 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 02:33:35</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38246226"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38246209">
          <h3>
            <a
              class="item"
              href="https://www.vox.com/future-perfect/2023/9/20/23881981/bangladesh-tumeric-lead-poisoning-contamination-public-health"
              >Bangladesh removed lead from turmeric spice</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 02:30:48</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38246209"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38246082">
          <h3>
            <a
              class="item"
              href="https://staff.science.uva.nl/a.j.p.heck/Courses/Mastercourse2005/tutorial.pdf"
              >Learn PostScript by Doing (2005) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 02:04:12</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38246082"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38246032">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/generative-ai-training"
              >MLPerf training tests put Nvidia ahead, Intel close, and Google
              well behind</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 01:57:35</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38246032"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38245935">
          <h3>
            <a class="item" href="https://www.troyhunt.com/beg-bounties/"
              >Beg Bounties (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 01:39:37</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38245935"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38245762">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-11-11/diamond-prices-miners-take-radical-steps-to-support-the-market"
              >The diamond world takes radical steps to stop a pricing plunge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 01:04:36</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38245762"
                  >Comments</a
                ><span class="descendants">: 251</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38245240">
          <h3>
            <a class="item" href="https://fabiensanglard.net/blog/"
              >0XReasons to Write and Publish</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-12 @ 23:33:31</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38245240"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38244927">
          <h3>
            <a
              class="item"
              href="https://www.computer.org/csdl/magazine/mi/2021/06/09623432/1yJTxgRWQgg"
              >The Apollo Guidance Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-12 @ 22:49:33</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38244927"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38243949">
          <h3>
            <a class="item" href="https://github.com/Jcparkyn/dpoint"
              >Show HN: Open-source digital stylus with six degrees of
              freedom</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-12 @ 20:48:30</span
              ><span class="points-container"
                >Points: <span class="points">391</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38243949"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38242946">
          <h3>
            <a
              class="item"
              href="https://grossack.site/2023/11/08/37-median.html"
              >37, the median value for the second prime factor of an integer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-12 @ 18:45:48</span
              ><span class="points-container"
                >Points: <span class="points">338</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38242946"
                  >Comments</a
                ><span class="descendants">: 167</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38241951">
          <h3>
            <a class="item" href="https://sievedata.com/about/jobs"
              >Sieve (YC W22), a video/audio AI cloud, is hiring AI/product
              engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-12 @ 17:02:09</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38241674">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/the-evolution-of-expert-communities"
              >The evolution of expert communities</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-12 @ 16:36:00</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38241674"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38241583">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/news/sandisk-extreme-pro-failures-are-due-to-design-flaw"
              >SanDisk Extreme Pro failures result from design flaw, says
              researcher</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-12 @ 16:27:25</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38241583"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38241304">
          <h3><a class="item" href="https://html-first.com/">HTML First</a></h3>
          <section>
            <h4>
              <span>2023-11-12 @ 16:00:36</span
              ><span class="points-container"
                >Points: <span class="points">765</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38241304"
                  >Comments</a
                ><span class="descendants">: 462</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38241235">
          <h3>
            <a
              class="item"
              href="https://twitter.com/abidlabs/status/1723074108739706959"
              >Generate images fast with SD 1.5 while typing on Gradio</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-12 @ 15:54:46</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38241235"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38240333">
          <h3>
            <a class="item" href="https://free.oberon.org/en/"
              >Free Oberon: Cross-platform Oberon IDE</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-12 @ 14:28:22</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38240333"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38236198">
          <h3>
            <a
              class="item"
              href="https://github.com/Dicklesworthstone/bulk_transcribe_youtube_videos_from_playlist"
              >Show HN: Bulk Creation of Transcripts from YouTube Playlists with
              Whisper</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-12 @ 00:57:16</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38236198"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's truly easy to use-- you can clone the repo, install to a
                venv, and be generating a folder full of high quality transcript
                text files in under 5 minutes. All you need to do is supply the
                URL to a YouTube playlist or to an individual video file and
                this tool does the rest automatically. It uses faster-whisper
                with a high beam_size, so it's a bit slower than you might
                expect, but this does result in higher accuracy. The best way to
                use this is to take an existing playlist, or create a new one on
                YouTube, start this script up, and come back the next morning
                with all your finished transcripts. It attempts to "upgrade" the
                output of whisper by taking all the transcript segments, gluing
                them together, and then splitting them back into sentences (it
                uses Spacy for this, or a simpler regex-based function). You end
                up with a single text file with the full transcript all ready to
                go for each video in the playlist, with a sensible file name
                based on the title of the video.
              </p>
              <p>
                If you have CUDA installed, it will try to use it, but as with
                all things CUDA, it's annoyingly fragile and picky, so don't be
                surprised if you get a CUDA error even if you know for a fact
                CUDA is installed on your system. If you're looking for
                reliability, disable CUDA. But if you need to transcribe a LOT
                of transcripts, it does go much, much faster on a GPU.
              </p>
              <p>
                Even if you don't have a GPU, if you have a powerful machine
                with a lot of RAM and cores, this script will fully saturate
                them and can download and process multiple videos at the same
                time. The default settings are pretty good for that situation.
                But if you have a slower machine, you might want to use a
                smaller Whisper model (like `base.en` or even `tiny.en`) and
                dial down the beam_size to 2.
              </p>
            </div>
          </section>
        </section>
        <section id="38232767">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2023/11/its-still-easy-for-anyone-to-become-you-at-experian/"
              >It's still easy for anyone to become you at Experian</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-11 @ 18:05:58</span
              ><span class="points-container"
                >Points: <span class="points">830</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38232767"
                  >Comments</a
                ><span class="descendants">: 304</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38230161">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Linux-6.7-RISC-V"
              >RISC-V with Linux 6.7 Gains Optimized TLB Flushing, Software
              Shadow Call Stacks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-11 @ 13:33:59</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38230161"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38230141">
          <h3>
            <a
              class="item"
              href="https://www.nextplatform.com/2023/11/08/you-can-load-up-on-cheap-cores-with-updated-milan-epycs/"
              >You Can Load Up on Cheap Cores with Updated Milan Epycs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-11 @ 13:31:43</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38230141"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38228320">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-023-06647-8"
              >Role play with large language models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-11 @ 07:37:03</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38228320"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38228122">
          <h3>
            <a
              class="item"
              href="https://poignardazur.github.io//2023/11/08/time-for-variadic-generics/"
              >Variadic generics, again</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-11 @ 06:49:50</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38228122"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38226057">
          <h3>
            <a
              class="item"
              href="https://www.howtogeek.com/how-to-copy-uncopyable-texts-on-windows/"
              >How to Copy Uncopyable Texts on Windows</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-10 @ 23:43:09</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38226057"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38225150">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/in-the-wild-west-of-geometry-mathematicians-redefine-the-sphere-20231107/"
              >In the 'Wild West' of geometry, mathematicians redefine the
              sphere</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-10 @ 22:04:28</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38225150"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
