<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36040282">
          <h3>
            <a class="item" href="https://i.redd.it/r68fgiisk3sa1.jpg"
              >r/all removals over time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 05:38:18</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36040282"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36039232">
          <h3>
            <a
              class="item"
              href="https://eli.thegreenplace.net/2023/demystifying-tuppers-formula/"
              >Demystifying Tupper's Formula</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 02:51:13</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36039232"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36039000">
          <h3>
            <a
              class="item"
              href="https://vanillaos.org/2023/03/07/vanilla-os-2.0-orchid-initial-work.html"
              >Vanilla OS 2.0 Orchid base is changing from Ubuntu to Debian</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 02:14:20</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36039000"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36038950">
          <h3>
            <a
              class="item"
              href="https://www.rockpapershotgun.com/simcity-4-the-greatest-citybuilder-of-all-time-was-released-20-years-ago"
              >SimCity 4, the greatest citybuilder of all time, was released 20
              years ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 02:04:56</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36038950"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36038945">
          <h3>
            <a class="item" href="https://ai-muzic.github.io/getmusic/"
              >Generating Music Tracks with Unified Representation and Diffusion
              Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 02:03:51</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36038945"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36038868">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.13048"
              >RWKV: Reinventing RNNs for the Transformer Era</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 01:50:00</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36038868"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36038815">
          <h3>
            <a class="item" href="https://github.com/csunny/DB-GPT"
              >Show HN: DB-GPT, an LLM tool for database</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 01:40:55</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36038815"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36038796">
          <h3>
            <a
              class="item"
              href="https://slate.com/human-interest/2012/05/how-to-cook-onions-why-recipe-writers-lie-and-lie-about-how-long-they-take-to-caramelize.html"
              >Why do recipe writers lie about how long it takes to caramelize
              onions? (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 01:38:01</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36038796"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36038684">
          <h3>
            <a
              class="item"
              href="https://academictorrents.com/details/7c0645c94321311bb05bd879ddee4d0eba08aaee"
              >Reddit comments and submissions collected by Pushshift</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 01:17:32</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36038684"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36038635">
          <h3>
            <a
              class="item"
              href="https://www.boston.com/news/local-news/2023/05/17/mit-professor-gilbert-strang-retiring-standing-ovation-video/"
              >Students give Gilbert Strang a standing ovation after his last
              lecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 01:08:34</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36038635"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36037607">
          <h3>
            <a class="item" href="https://github.com/ChrisCavs/aimless.js"
              >Show HN: Aimless.js – the missing js randomness library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 22:41:31</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36037607"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36037419">
          <h3>
            <a class="item" href="https://www.twitch.tv/blotterstream"
              >Show HN: Blotter – An interactive, never ending music video</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 22:21:06</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36037419"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <p>
                Blotter is a proof of concept I hacked together that does a bit
                of audio recognition combined with a few generative AI models
                (both text and img) to create visuals that are relevant to the
                song.
              </p>
              <p>
                The video stream is generated in real time at 24fps - you can
                try it yourself by requesting visuals in the Twitch chat using
                the "!v" command!
              </p>
              <p>
                Right now it's mostly a fun hack project, but I am tinkering
                with new model architectures for higher fidelity video as well
                as an interactive tool so people can make videos with their own
                audio files.
              </p>
              <p>I'd love to hear any feedback or suggestions, thanks!</p>
            </div>
          </section>
        </section>
        <section id="36036997">
          <h3>
            <a class="item" href="https://buddhistuniversity.net/"
              >The Open Buddhist University</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 21:33:51</span
              ><span class="points-container"
                >Points: <span class="points">287</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36036997"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36034929">
          <h3>
            <a
              class="item"
              href="https://stackoverflow.blog/2023/05/22/modern-work-requires-attention-constant-alerts-steal-it/"
              >Modern work requires attention – constant alerts steal it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 18:28:40</span
              ><span class="points-container"
                >Points: <span class="points">370</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36034929"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36034726">
          <h3>
            <a
              class="item"
              href="https://www.mrdbourke.com/what-if-you-did-the-exact-opposite-like-the-rogue-bees-do/"
              >What if you did the exact opposite, like rogue bees do (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 18:15:11</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36034726"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36034718">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-01604-x"
              >Talks That Attendees See in Person More Likely to Be Cited</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 18:14:25</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36034718"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36034409">
          <h3>
            <a class="item" href="https://www.vogons.org/viewtopic.php?t=86172"
              >Salt Lake 2002 – not enough memory/crashes to desktop after
              starting error</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 17:46:44</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36034409"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36034211">
          <h3>
            <a
              class="item"
              href="https://github.com/facebookresearch/fairseq/tree/main/examples/mms"
              >Meta AI announces Massive Multilingual Speech code, models for
              1000+ languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 17:27:05</span
              ><span class="points-container"
                >Points: <span class="points">591</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36034211"
                  >Comments</a
                ><span class="descendants">: 196</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36032081">
          <h3>
            <a class="item" href="https://github.com/psychic-api/psychic"
              >Show HN: Psychic - An open-source integration platform for
              unstructured data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 14:41:47</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36032081"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <p>
                For example, we know that the pain of building new API
                integrations scales with the level of fragmentation and number
                of competing "standards". In the current meta, we see this pain
                with a lot of AI startups who invariably need to connect to
                their customers data, but have to support 50+ integrations
                before they even scale to 50+ customers.
              </p>
              <p>
                This is the process for an AI startup to add a new integration
                for a customer:
              </p>
              <p>
                - Pore over the API docs for each source application and write a
                connector for each
              </p>
              <p>
                - Play email tag to find the right stakeholders and get them to
                share sensitive API keys, or give them an OAuth app. It can take
                6+ weeks for some platforms to review new OAuth apps
              </p>
              <p>
                - Normalize data that arrives in a different formats from each
                source (HTML, XML, text dumps, 3 different flavors of markdown,
                JSON, etc)
              </p>
              <p>
                - Figure out what data should be vectorized, what should be
                stored as SQL, and what should be discarded
              </p>
              <p>- Detect when data has been updated and synchronize it</p>
              <p>- Monitor when pipelines break so data doesn’t go stale</p>
              <p>
                This is a LOT of work for something that doesn’t move the needle
                on product quality.
              </p>
              <p>
                That’s why we built Psychic.dev to be the fastest and most
                secure way for startups to connect to their customer’s data. You
                integrate once with our universal APIs and get N integrations
                with CRMs, knowledge bases, ticketing systems and more with no
                incremental engineering effort.
              </p>
              <p>
                We abstract away the quirks of each data source into Document
                and Conversation data models, and try to find a good balance to
                allow for deep integrations while maintaining broad utility.
                Since it’s open source, we encourage founders to fork and extend
                our data models to fit their needs as they evolve, even if it
                means migrating off our paid version.
              </p>
              <p>
                To see an example in action, check out our demo repo here:
                <a
                  href="https://github.com/psychic-api/psychic-langchain-tutorial/"
                  >https://github.com/psychic-api/psychic-langchain-tutorial/</a
                >
              </p>
              <p>
                We are also open source and open to contributions, learn more at
                docs.psychic.dev or by emailing us at founders@psychic.dev!
              </p>
            </div>
          </section>
        </section>
        <section id="36029087">
          <h3>
            <a class="item" href="https://samwho.dev/memory-allocation/"
              >Memory Allocation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 09:26:22</span
              ><span class="points-container"
                >Points: <span class="points">1137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36029087"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36028244">
          <h3>
            <a class="item" href="https://github.com/softdorothy/GliderPRO"
              >Source code for Glider Pro (1994)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 06:51:58</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36028244"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36025180">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/the-fight-to-protect-the-joshua-tree-609bc7e9"
              >The Fight to Protect the Joshua Tree</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 22:22:14</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36025180"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36023706">
          <h3>
            <a class="item" href="https://surma.dev/things/ditherpunk/"
              >Ditherpunk – The article I wish I had about monochrome image
              dithering</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 18:50:21</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36023706"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36023557">
          <h3>
            <a
              class="item"
              href="https://wildlifeinformer.com/can-alligators-climb-trees/"
              >Can alligators climb trees? (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 18:31:28</span
              ><span class="points-container"
                >Points: <span class="points">2</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36023557"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36023463">
          <h3>
            <a
              class="item"
              href="https://eisenbergeffect.medium.com/the-industrial-hammer-complex-d9785886ee59"
              >The Industrial Hammer Complex</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 18:22:27</span
              ><span class="points-container"
                >Points: <span class="points">2</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36023463"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36022733">
          <h3>
            <a class="item" href="https://plato.stanford.edu/entries/plotinus/"
              >Plotinus (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 16:54:30</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36022733"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36022589">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=6FOCNf06lqY"
              >You Keep Using That Word: Asynchronous and Interprocess Comms</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 16:38:30</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36022589"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36021741">
          <h3>
            <a
              class="item"
              href="https://www.engadget.com/blackberry-movie-review-comedy-tragedy-innovators-dilemma-140115574.html"
              >'BlackBerry' review: The comedy and tragedy of the innovator's
              dilemma</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 15:07:24</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36021741"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36021652">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.10947"
              >In Defense of Pure 16-Bit Floating-Point Neural Networks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 14:59:53</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36021652"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36020534">
          <h3>
            <a
              class="item"
              href="https://www.lockheedmartin.com/en-us/products/quesst.html"
              >X-59 supersonic aircraft</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 13:12:01</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36020534"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
