<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38573609">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/technology/2023/12/08/open-ai-sam-altman-complaints/"
              >Warning from OpenAI leaders helped trigger Sam Altman's ouster</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 20:10:17</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38573609"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38573378">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/12/google-podcasts-dies-april-2024-youtube-music-migration-tool-goes-live/"
              >Google announces April 2024 shutdown date for Google Podcasts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 19:55:01</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38573378"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38573269">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2023/12/08/protect-or-perish/"
              >DNA companies should receive the death penalty for getting
              hacked</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 19:45:47</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38573269"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38572974">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/okta-breach-disclosure-all-customer-support-users/"
              >Okta Breach Impacted All Customer Support Users–Not 1 Percent</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 19:19:04</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38572974"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38572675">
          <h3>
            <a
              class="item"
              href="https://jackpoulson.substack.com/p/inside-the-pro-israel-information"
              >The pro-Israel information war</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 18:49:14</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38572675"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38572504">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38572504"
              >Want to apply for YC W24? We’re opening some last-minute spots</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 18:36:45</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                Even though the official YC W24 application deadline was in
                October, we know there are founders that haven't already applied
                but are interested in being a part of the batch.
              </p>
              <p>
                We didn’t want those people to miss out on the chance to
                participate in the W24 batch, and we had some extra bandwidth to
                review late applications, so we’re opening up a special
                application process just for them, with at least 10 additional
                spots.
              </p>
              <p>
                So, if you’ve been thinking about applying to YC for a while and
                just got to the point where you are ready to actually do it, you
                can apply now and get a quick decision rather than waiting for
                the summer batch.
              </p>
              <p>A few operational details:</p>
              <p>
                1) Apply by December 13 at 5pm Pacific Time. You’ll hear back by
                December 20th.
              </p>
              <p>
                2) To be eligible for these late W24 interviews, in your answer
                to the question “If you have a referral code”, include the
                string: HNW24 (yes, we made a special referral code for HN so we
                can understand where our users come from)
              </p>
              <p>
                3) This is for founders that did not already apply for the W24
                batch at some point in the past.
              </p>
            </div>
          </section>
        </section>
        <section id="38572284">
          <h3>
            <a class="item" href="https://arxiv.org/abs/1701.06538"
              >Outrageously Large Neural Networks: The Sparsely-Gated
              Mixture-of-Experts (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 18:20:51</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38572284"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38571956">
          <h3>
            <a
              class="item"
              href="https://www.statnews.com/2023/12/08/fda-approves-casgevy-crispr-based-medicine-for-treatment-of-sickle-cell-disease/"
              >FDA approves a CRISPR-based medicine for treatment of sickle cell
              disease</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 17:56:30</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38571956"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38571332">
          <h3>
            <a
              class="item"
              href="https://www.vice.com/en/article/4a35kp/scientists-have-reported-a-breakthrough-in-understanding-whale-language"
              >Researchers have identified new elements of whale
              vocalizations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 17:09:11</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38571332"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38571088">
          <h3>
            <a class="item" href="https://ia.net/topics/ia-writer-in-paper"
              >IA Writer in Paper</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 16:49:57</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38571088"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38571017">
          <h3>
            <a class="item" href="https://reconfusion.github.io/"
              >ReconFusion: 3D Reconstruction with Diffusion Priors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 16:44:34</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38571017"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38570732">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/12/8/23991092/homes-need-to-be-built-for-better-internet"
              >Homes need to be built for better internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 16:20:26</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570732"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38570677">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2023/12/08/judge-allows-major-right-to-repair-lawsuit-against-john-deere-to-move-forward/"
              >Judge Allows Major 'Right to Repair' Lawsuit Against John Deere
              to Move Forward</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 16:15:45</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570677"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38570624">
          <h3>
            <a class="item" href="https://www.warpbuild.com/"
              >Show HN: WarpBuild – x86-64 and arm GitHub Action runners for 30%
              faster builds</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 16:11:20</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570624"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
            <div class="text">
              <p>
                WarpBuild provides fast, secure `x86-64` and `arm64` Github
                actions runners. This speeds up your workloads by 30%, at half
                the cost, and takes ~2mins to get started.
              </p>
              <p>
                We’ve been seeing pretty good results since we opened up signups
                a week ago and I’ve shared some numbers publicly here [1].
              </p>
              <p>
                Currently, we support linux runners for Github organizations
                (not personal accounts) and MacOS support is coming soon (~Jan).
              </p>
              <p>
                The way the runners work is deceptively simple: Runners are
                assigned to hardware that is ideal for build workloads with fast
                NVMe disks and high single-core performance.
              </p>
              <p>
                The runners are allocated on VMs, not containers. This provides
                faster performance and enables use cases requiring (1) nested
                virtualization for running firecracker and other hypervisors,
                (2) k8s without relying on kind, and (3) Android emulators on
                `arm64` instances in test workflows.
              </p>
              <p>
                We also have released a Github Action called `Action-Debugger`
                that allows you to SSH into a running workflow for simplifying
                pesky debugging[2].
              </p>
              <p>
                The same set of packages that you’d get on Github hosted runners
                are pre-configured (on x86-64 runners) so everything works out
                of the box with no modifications needed.
              </p>
              <p>
                A very minor detail that I’m rather proud of, and I’d love your
                thoughts on improving it further, is the onboarding flow for the
                ease of moving workflows to WarpBuild. We’ve also put in a lot
                of effort into making the workflow start up time where we are as
                fast or faster than Github.
              </p>
              <p>
                [1]
                <a href="https://x.com/suryaoruganti/status/1732932591001735419"
                  >https://x.com/suryaoruganti/status/1732932591001735419</a
                >
                [2]
                <a href="https://github.com/WarpBuilds/action-debugger"
                  >https://github.com/WarpBuilds/action-debugger</a
                >, h/t to tmate
              </p>
              <p>
                Making builds faster by providing optimal hardware and
                configurations across CI providers is the first step in our
                mission to make build engineering better.
              </p>
              <p>
                I’d love your feedback on the product and thoughts on other CI
                pain points we could solve to enable better collaboration and
                developer experience.
              </p>
            </div>
          </section>
        </section>
        <section id="38570537">
          <h3>
            <a
              class="item"
              href="https://twitter.com/MistralAI/status/1733150512395038967"
              >Mistral "Mixtral" 8x7B 32k model [magnet]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 16:03:00</span
              ><span class="points-container"
                >Points: <span class="points">287</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570537"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38570261">
          <h3>
            <a
              class="item"
              href="https://www.florianbellmann.com/blog/never-taught-qa"
              >You are never taught how to build quality software</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 15:35:29</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570261"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38570035">
          <h3>
            <a
              class="item"
              href="https://www.akamai.com/blog/security-research/spoofing-dns-by-abusing-dhcp"
              >Spoofing DNS records by abusing DHCP DNS dynamic updates</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 15:18:50</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38570035"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38569608">
          <h3>
            <a class="item" href="https://onyxlang.io/"
              >The Onyx Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 14:43:46</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38569608"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38569240">
          <h3>
            <a class="item" href="https://github.com/kellyjonbrazil/jc"
              >JC converts the output of popular command-line tools to JSON</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 14:12:03</span
              ><span class="points-container"
                >Points: <span class="points">274</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38569240"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38569129">
          <h3>
            <a class="item" href="https://www.nongnu.org/txr/txr-lisp.html"
              >TXR Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 14:02:06</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38569129"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38568264">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2307.09444"
              >No distributed quantum advantage for approximate graph
              coloring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 12:35:28</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38568264"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38567687">
          <h3>
            <a
              class="item"
              href="https://badcyber.com/dieselgate-but-for-trains-some-heavyweight-hardware-hacking/"
              >Dieselgate, but for trains – some heavyweight hardware hacking</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 11:20:36</span
              ><span class="points-container"
                >Points: <span class="points">598</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38567687"
                  >Comments</a
                ><span class="descendants">: 238</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38567149">
          <h3>
            <a
              class="item"
              href="https://asset-group.github.io/disclosures/5ghoul/"
              >5Ghoul: 5G Modem Firmware CVEs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 09:51:36</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38567149"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38567074">
          <h3>
            <a
              class="item"
              href="https://yuelangx.github.io/gaussianheadavatar/"
              >Gaussian Head Avatar: Ultra High-Fidelity Head Avatar via Dynamic
              Gaussians</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 09:38:44</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38567074"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38565567">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-12-ancient-stars-extraordinarily-heavy-elements.html"
              >Ancient stars made extraordinarily heavy elements, researchers
              find</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 04:47:28</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38565567"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38565314">
          <h3>
            <a
              class="item"
              href="https://staysaasy.com/management/2023/12/07/accelerating-product-velocity.html"
              >Practical Ways to Increase Product Velocity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-08 @ 04:05:07</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38565314"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38561682">
          <h3>
            <a class="item" href="https://bloomberg.github.io/memray/index.html"
              >Memray: Python memory profiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-07 @ 20:53:23</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38561682"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38552245">
          <h3>
            <a
              class="item"
              href="http://www.midieditor.org/index.php?category=intro"
              >MIDI Editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-07 @ 02:53:03</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38552245"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38545522">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/a-team-of-math-proves-a-critical-link-between-addition-and-sets-20231206/"
              >'A-team' of math proves a critical link between addition and
              sets</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-06 @ 15:55:08</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38545522"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38541983">
          <h3>
            <a
              class="item"
              href="https://interruptlabs.ca/2022/07/29/I-m-Building-a-Self-Destructing-USB-Drive/"
              >I'm building a self-destructing USB drive (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-06 @ 09:33:51</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38541983"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
