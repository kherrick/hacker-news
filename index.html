<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40874888">
          <h3>
            <a class="item" href="https://rentelderlypeople.com/"
              >Show HN: Rent Elderly People â€“ Skip Lines and Get Senior Perks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 13:41:53</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40874888"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              First of all, of course, this is a joke. But... what if it's not?
              What if it really makes sense? Take a look and let us know what
              you think!
            </div>
          </section>
        </section>
        <section id="40874189">
          <h3>
            <a class="item" href="https://jobs.lever.co/buildzoom"
              >BuildZoom (better way to build custom homes) Is hiring a Growth
              Associate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 12:00:57</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40874013">
          <h3>
            <a
              class="item"
              href="https://corecursive.com/building-powershell-with-jeffrey-snover/"
              >Jeffrey Snover and the Making of PowerShell</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 11:26:32</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40874013"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40873912">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/ExperiencedDevs/comments/1dh9rly/the_chaos_of_react_in_medium_to_large_web_apps"
              >React chaos in mid and large web apps: Any different
              experiences?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 11:02:39</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40873912"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40873001">
          <h3>
            <a
              class="item"
              href="https://community.fly.io/t/fresh-produce-region-specific-machines-pricing/20690"
              >Fly.io initiates Region-specific Machines pricing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 07:17:34</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40873001"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40872978">
          <h3>
            <a class="item" href="https://www.jogmekeebs.com"
              >Show HN: I made a split keyboard for large palms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 07:11:29</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872978"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
            <div class="text">
              I had an issue a few years ago - every ergonomic keyboard I tried
              had the switches too close to each other and my fingers were
              cramped in that small space. Then I decided to create a keyboard
              which is suitable for larger hands and eliminates most of the
              wrist movement. 34 keys was the most optimized version for
              achieving as little wrist movement as possible. You can try the
              fitment for your palm IRL with the printable template on the
              website.
            </div>
          </section>
        </section>
        <section id="40872438">
          <h3>
            <a class="item" href="https://blog.nelhage.com/post/fuzzy-dedup/"
              >Finding near-duplicates with Jaccard similarity and MinHash</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 05:04:09</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872438"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40872332">
          <h3>
            <a
              class="item"
              href="https://lazamar.github.io/haskell-data-compression-with-huffman-codes/"
              >Building a data compression utility in Haskell using Huffman
              codes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 04:29:12</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872332"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40872020">
          <h3>
            <a class="item" href="https://www.firezone.dev/blog/sans-io"
              >Sans-IO: The secret to effective Rust for network services</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 03:05:36</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872020"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40871783">
          <h3>
            <a class="item" href="https://boyuan.space/diffusion-forcing/"
              >Diffusion Forcing: Next-Token Prediction Meets Full-Sequence
              Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 02:09:20</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40871783"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870728">
          <h3>
            <a
              class="item"
              href="https://github.com/udlbook/udlbook/blob/main/public/NMI_Review.pdf"
              >Diving into deep learning: Understanding Deep Learning book
              review [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 22:43:05</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870728"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870357">
          <h3>
            <a
              class="item"
              href="https://www.arno.org/on-the-origins-of-ds-store"
              >The Origins of DS_store (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 21:55:13</span
              ><span class="points-container"
                >Points: <span class="points">324</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870357"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870345">
          <h3>
            <a class="item" href="https://salykova.github.io/matmul-cpu"
              >Beating NumPy matrix multiplication in 150 lines of C</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 21:52:55</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870345"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870280">
          <h3>
            <a
              class="item"
              href="https://reactormag.com/the-joy-of-reading-books-you-dont-entirely-understand/"
              >The Joy of Reading Books You Don't Understand</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 21:44:47</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870280"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40869877">
          <h3>
            <a class="item" href="https://0x.tools/"
              >Show HN: Xcapture-BPF â€“ like Linux top, but with Xray vision</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 20:52:37</span
              ><span class="points-container"
                >Points: <span class="points">313</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40869877"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40867746">
          <h3>
            <a
              class="item"
              href="https://pganalyze.com/blog/a-practical-introduction-to-constraint-programming-using-cp-sat"
              >A practical introduction to constraint programming using CP-SAT
              and Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 16:48:34</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40867746"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40867709">
          <h3>
            <a
              class="item"
              href="https://sigwait.org/~alex/blog/2024/07/01/the-cheapest-nas.html"
              >The Cheapest NAS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 16:45:01</span
              ><span class="points-container"
                >Points: <span class="points">254</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40867709"
                  >Comments</a
                ><span class="descendants">: 254</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40866442">
          <h3>
            <a
              class="item"
              href="https://blog.brixit.nl/making-a-linux-managed-network-switch/"
              >Making a Linux-managed network switch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 14:47:18</span
              ><span class="points-container"
                >Points: <span class="points">214</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40866442"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40866374">
          <h3>
            <a
              class="item"
              href="https://www.mattkeeter.com/blog/2023-01-25-branch/"
              >Do not taunt happy fun branch predictor (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 14:42:02</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40866374"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40861079">
          <h3>
            <a class="item" href="https://markeasting.github.io/engine/"
              >Engine Sound Simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 22:32:42</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40861079"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40858165">
          <h3>
            <a class="item" href="https://mssv.net/2024/07/02/the-sphere/"
              >The Sphere</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 16:27:25</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40858165"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40856677">
          <h3>
            <a
              class="item"
              href="https://frguthmann.github.io/posts/profiling_webgpu/"
              >GPU profiling for WebGPU workloads on Windows with Chrome</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 13:51:37</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40856677"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40853834">
          <h3>
            <a class="item" href="https://hallofdreams.org/posts/trackmania-1/"
              >The History of Machine Learning in Trackmania</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 05:38:31</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40853834"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40853665">
          <h3>
            <a
              class="item"
              href="https://escapethealgorithm.substack.com/p/should-this-be-a-map-or-500-maps"
              >Should this be a map or 500 maps?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 04:50:40</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40853665"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40850987">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/article/2024/jun/22/bugs-drugs-and-electric-venom-is-this-the-most-deadly-library-in-the-world"
              >Bugs, drugs and electric venom: is this the most deadly library
              in the world?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 21:34:55</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40850987"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40849363">
          <h3>
            <a class="item" href="https://blog.brachiosoft.com/en/posts/git/"
              >A Git story: Not so fun this time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 19:10:52</span
              ><span class="points-container"
                >Points: <span class="points">473</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40849363"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40846726">
          <h3>
            <a
              class="item"
              href="https://cohost.org/belarius/post/6677850-architectural-cross"
              >Architectural cross-section of Kowloon Walled City</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 15:27:25</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40846726"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40845628">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/shipt"
              >Shipt's Algorithm Squeezed Gig Workers. They Fought Back</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 13:21:33</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40845628"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40843185">
          <h3>
            <a
              class="item"
              href="https://www.yachtingworld.com/extraordinary-boats/faster-than-the-weather-how-comanche-took-more-than-a-day-off-the-transatlantic-record-99160"
              >Breaking transatlantic sailing record by more than a day
              (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 06:40:56</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40843185"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40841698">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40841698"
              >Ask HN: Where to Sell Vintage Computers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 01:03:20</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40841698"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
            <div class="text">
              Many of us have vintage often rare computers. The first few
              Apple's computers goes to premium auctions but what about things
              in a lower tier?
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
