<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44712831">
          <h3>
            <a class="item" href="https://vibeinsecurity.com/"
              >The Rise of Vibeinsecurity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 17:04:46</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44712831"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44712459">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/07/28/nasa_voluntary_exits/"
              >NASA faces brain drain as thousands exit under voluntary
              resignation scheme</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 16:31:49</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44712459"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44712311">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=hCQCP-5g5bo"
              >I saved a PNG image to a bird</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 16:18:49</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44712311"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711745">
          <h3>
            <a
              class="item"
              href="https://shaneosullivan.wordpress.com/2025/07/28/on-designing-for-children/"
              >Simplify, then add delightness: On designing for children</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 15:21:13</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711745"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711612">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/infectious-diseases/hiv-prevention-fda-lenacapavir/"
              >The first 100% effective HIV prevention drug is approved and
              going global</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 15:06:00</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711612"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711519">
          <h3>
            <a class="item" href="https://github.com/9001/copyparty"
              >Copyparty, turn almost any device into a file server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 14:57:55</span
              ><span class="points-container"
                >Points: <span class="points">240</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711519"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711306">
          <h3>
            <a
              class="item"
              href="https://mathstodon.xyz/@tao/114915604830689046"
              >Tao on "blue team" vs. "red team" LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 14:36:39</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711306"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711106">
          <h3>
            <a class="item" href="https://z.ai/blog/glm-4.5"
              >GLM-4.5: Reasoning, Coding, and Agentic Abililties</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 14:15:52</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711106"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711075">
          <h3>
            <a
              class="item"
              href="https://thezvi.substack.com/p/ai-companion-piece"
              >AI Companion Piece</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 14:11:35</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711075"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44710533">
          <h3>
            <a
              class="item"
              href="https://harpers.org/archive/2025/07/the-geological-sublime-lewis-hyde-deep-time/"
              >The Geological Sublime</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 13:10:00</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44710533"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44709727">
          <h3>
            <a class="item" href="https://pictiler.com"
              >Show HN: I made a tool to generate photomosaics with your
              pictures</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 11:23:50</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44709727"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wanted to make some photomosaics for an anniversary gift, but
                I ended up building this tool and turning it into a website that
                anyone can use.
              </p>
              <p>
                For those who don’t know, a photomosaic is an image made up of
                many smaller tile images, arranged in a way that forms a larger,
                recognisable picture.
              </p>
              <p>
                The best part? Everything runs directly in your browser. No
                files are uploaded, and there’s no sign-up required.
              </p>
            </div>
          </section>
        </section>
        <section id="44709408">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/07/25/y2k38_bug_debian/"
              >Debian switches to 64-bit time for everything</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 10:43:36</span
              ><span class="points-container"
                >Points: <span class="points">317</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44709408"
                  >Comments</a
                ><span class="descendants">: 209</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44708173">
          <h3>
            <a
              class="item"
              href="https://abitmighty.com/posts/the-ultimate-meeting-culture"
              >What would an efficient and trustworthy meeting culture look
              like?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 07:27:17</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44708173"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44708028">
          <h3>
            <a
              class="item"
              href="https://huggingface.co/spaces/hesamation/primer-llm-embedding"
              >LLM Embeddings Explained: A Visual and Intuitive Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 07:02:14</span
              ><span class="points-container"
                >Points: <span class="points">332</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44708028"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44707546">
          <h3>
            <a
              class="item"
              href="https://maltsev.space/blog/012-simd-within-a-register-how-i-doubled-hash-table-lookup-performance"
              >SIMD within a register: How I doubled hash table lookup
              performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 05:41:34</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44707546"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44706653">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/356674b0-9f1d-4f95-b1d5-f27570379a9b"
              >VPN use surges in UK as new online safety rules kick in</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 02:33:04</span
              ><span class="points-container"
                >Points: <span class="points">465</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44706653"
                  >Comments</a
                ><span class="descendants">: 671</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44706409">
          <h3>
            <a
              class="item"
              href="https://sammyguru.com/breaking-samsung-removes-bootloader-unlocking-with-one-ui-8/"
              >Samsung Removes Bootloader Unlocking with One UI 8</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 01:43:36</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44706409"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44705445">
          <h3>
            <a
              class="item"
              href="https://www.geoffreylitt.com/2025/07/27/enough-ai-copilots-we-need-ai-huds"
              >Enough AI copilots, we need AI HUDs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 22:51:28</span
              ><span class="points-container"
                >Points: <span class="points">719</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44705445"
                  >Comments</a
                ><span class="descendants">: 218</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44704270">
          <h3>
            <a
              class="item"
              href="https://nexy.blog/2025/07/27/how-i-hacked-my-washing-machine/"
              >I hacked my washing machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 20:09:29</span
              ><span class="points-container"
                >Points: <span class="points">334</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44704270"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44703164">
          <h3>
            <a
              class="item"
              href="https://github.com/segmentationf4u1t/trae_telemetry_research"
              >Performance and telemetry analysis of Trae IDE, ByteDance's
              VSCode fork</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 17:57:06</span
              ><span class="points-container"
                >Points: <span class="points">925</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44703164"
                  >Comments</a
                ><span class="descendants">: 328</span></span
              >
            </h4>
            <div class="text">
              <p>Here are the key findings:</p>
              <p>
                1. Extreme Resource Consumption: Out of the box, Trae used 6.3x
                more RAM (~5.7 GB) and spawned 3.7x more processes (33 total)
                than a standard VSCode setup with the same project open. The
                team has since made improvements, but it's still significantly
                heavier.
              </p>
              <p>
                2. Telemetry Opt-Out Doesn't Work (It Makes It Worse): I found
                Trae was constantly sending data to ByteDance servers
                (byteoversea.com). I went into the settings and disabled all
                telemetry. To my surprise, this didn't stop the traffic. In
                fact, it increased the frequency of batch data collection. The
                telemetry "off" switch appears to be purely cosmetic.
              </p>
              <p>
                3. What's Being Sent: Even with telemetry "disabled," Trae sends
                detailed payloads including: Hardware specs (CPU, memory, etc.)
                Persistent user, device, and machine IDs OS version, app
                language, user name Granular usage data like time-on-ide, window
                focus state, and active file types.
              </p>
              <p>
                4. Community Censorship: When I tried to discuss these findings
                on their official Discord, my posts were deleted and my account
                was muted for 7 days. It seems words like "track" trigger an
                automated gag rule, which prevents any real discussion about
                privacy.
              </p>
              <p>
                I believe developers should be aware of this behavior. The
                combination of resource drain, non-functional privacy settings,
                and censorship of technical feedback is a major red flag. The
                full, detailed analysis with all the evidence (process lists,
                Fiddler captures, JSON payloads, and screenshots of the Discord
                moderation) is available at the link. Happy to answer any
                questions.
              </p>
            </div>
          </section>
        </section>
        <section id="44701555">
          <h3>
            <a class="item" href="https://www.dumbpipe.dev/">Dumb Pipe</a>
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 14:25:47</span
              ><span class="points-container"
                >Points: <span class="points">929</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44701555"
                  >Comments</a
                ><span class="descendants">: 211</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44691232">
          <h3>
            <a
              class="item"
              href="https://lareviewofbooks.org/article/viral-language/"
              >Viral Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-26 @ 04:07:28</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44691232"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44684055">
          <h3>
            <a
              class="item"
              href="https://blog.jgc.org/2025/02/getting-kim-1-to-talk-to-my-mac.html"
              >Getting the KIM-1 to talk to my Mac</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 15:12:19</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44684055"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44682451">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/the-cells-that-breathe-two-ways-20250723/"
              >The Cells That Breathe Two Ways</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 12:38:31</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44682451"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44681858">
          <h3>
            <a
              class="item"
              href="https://www.androidauthority.com/linux-terminal-graphical-apps-3580905/"
              >Terminal app can now run full graphical Linux apps in the latest
              Android Canary</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 11:08:45</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44681858"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44675771">
          <h3>
            <a
              class="item"
              href="https://fnune.com/hardware/2025/07/20/nixos-on-a-tuxedo-infinitybook-pro-14-gen9-amd/"
              >NixOS on a Tuxedo InfinityBook Pro 14 Gen9 AMD Laptop</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 20:35:04</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44675771"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44675438">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2506.22707"
              >A Photonic SRAM with Embedded XOR Logic for Ultra-Fast In-Memory
              Computing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 20:10:15</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44675438"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44672230">
          <h3>
            <a
              class="item"
              href="https://deepmind.google/discover/blog/aeneas-transforms-how-historians-connect-the-past/"
              >Aeneas transforms how historians connect the past</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 15:53:58</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44672230"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44671802">
          <h3>
            <a
              class="item"
              href="https://code.blender.org/2025/07/beyond-mouse-keyboard/"
              >Blender: Beyond Mouse and Keyboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 15:20:49</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44671802"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44670885">
          <h3>
            <a
              class="item"
              href="https://www.vrt.be/vrtnws/en/2025/07/24/200-000-flemish-drivers-can-turn-traffic-lights-green-but-waze/"
              >200k Flemish drivers can turn traffic lights green</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-24 @ 14:08:26</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44670885"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
