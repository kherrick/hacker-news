<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36814019">
          <h3>
            <a
              class="item"
              href="https://vercel.com/blog/how-turborepo-is-porting-from-go-to-rust?nxtPslug=how-turborepo-is-porting-from-go-to-rust"
              >How Turborepo is porting from Go to Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 14:14:48</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36814019"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36813858">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36813858"
              >Ask HN: Do Agile 'Sprints' Benefit Software Developers?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 14:01:12</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36813858"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <p>To clarify my intent:</p>
              <p>
                1. I'm seeking input primarily from software developers rather
                than project managers, executives, customers, etc. 2. This is
                not an indictment of Agile overall. I endorse limiting
                work-in-progress, decomposing larger tasks, continuous delivery,
                and scheduling improvement time - all achievable without
                sprints. 3. When I refer to "Agile", I'm talking about
                methodologies adhering to the Agile manifesto.
              </p>
              <p>
                To be clear, I don't believe sprints inherently benefit
                developers, and it feels as if the Agile community hasn't
                adequately consulted engineers on this topic. When I've asked
                developers about their feelings on sprints (excluding WIP limits
                or task decomposition), the responses lean towards indifference
                or opposition. Is the effort of sprint planning worthwhile when
                faced with such apathy?
              </p>
              <p>Common pro-sprint arguments I've encountered include:</p>
              <p>
                1. Incremental improvement/Faster feedback loop. However, sprint
                planning seems overly complex, with most of the book dedicated
                to explaining a convoluted system and potential pitfalls. 2.
                Early value delivery. But we're in the era of CI/CD, where
                deployments can happen multiple times a day. Are sprint
                deadlines just relics of a time when physical software delivery
                was necessary? 3. Autonomy. I'm not sold on this either.
                Autonomy for developers is often overstated. We're not pursuing
                hobbies or creating art; we want a drama-free, predictable, and
                coordinated work environment where we're respected. Autonomy,
                especially technical, is important, but it's not the only thing
                that matters on a software team, and two-week Jira ticket
                batches don't necessarily provide it.
              </p>
              <p>My reservations include:</p>
              <p>
                * Overcomplication, with an entire industry of trainers, books,
                and seminars evolving around it. Over time, sprint discipline
                often deteriorates or transforms into something less Agile.
              </p>
              <p>* Lack of relevance for teams practicing CI/CD.</p>
              <p>
                * The creation of artificial deadlines leading to overtime,
                burnout, and, eventually, high staff turnover.
              </p>
              <p>
                * Inability to handle reality. Interruptions and unforeseen
                tasks will occur. The database may malfunction, revealing an
                architectural issue requiring immediate attention. While
                frustrating, these could be managed with stricter WIP limits.
              </p>
              <p>
                * Contradiction of the Agile manifesto's "Responding to change
                over following a plan". Sprint planning can degenerate into
                "micro-waterfall".
              </p>
              <p>After substantial reflection, I'm left with these thoughts:</p>
              <p>
                1. Most benefits attributed to sprints could be addressed
                through strict WIP limits. "The Art of Agile" disappointingly
                provides only cursory coverage of continuous planning
                methodologies (like Kanban, Scrumban, etc.), recommending most
                organizations adopt a sprint-based approach without further
                elaboration. 2. If sprints offer any advantages, they aren't for
                the developers. I've seldom encountered developers who genuinely
                enjoy sprints or would miss them in a sprint-less model.
              </p>
              <p>
                Do any fellow developers here <i>actually enjoy</i> conducting
                sprints? If so, why and how do you make it work?
              </p>
              <p>
                And if any of the book's authors frequent HN, your insights
                would be appreciated. The book was excellent, barring the points
                mentioned above.
              </p>
            </div>
          </section>
        </section>
        <section id="36813564">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02374-2"
              >Dementia risk linked to blood-protein imbalance in middle age</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 13:34:11</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36813564"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36813194">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/07/21/us/politics/ai-regulation-biden.html"
              >A.I. Companies Agree to Safeguards After Pressure from the White
              House</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 12:53:12</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36813194"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36813086">
          <h3>
            <a class="item" href="https://primocms.org"
              >Show HN: Primo – a visual CMS with Svelte blocks, a code editor,
              and SSG</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 12:38:14</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36813086"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36812981">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36812981"
              >Show HN: A non-VC backed content creation and social media
              platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 12:22:59</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36812981"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm building a platform for writers, bloggers and content
                creators that's built for them rather than for investors and
                advertisers like most similar products and social media
                platforms backed by VCs.
              </p>
              <p>
                I wrote about why I built it here:
                <a
                  href="https://persumi.com/c/persumi/u/fredwu/p/welcome-to-persumi-a-modern-platform-for-content-creation"
                  >https://persumi.com/c/persumi/u/fredwu/p/welcome-to-persumi-...</a
                >
              </p>
              <p>
                And the landing page is here:
                <a href="https://persumi.com/">https://persumi.com/</a>
              </p>
              <p>
                I would really love your honest feedback, if you care to share
                them with me. :)
              </p>
              <p>
                In the next week or two I'll write about how I built this MVP in
                three months - the tech, the architecture, the experiments and
                the missteps... If you are curious, stay tuned!
              </p>
            </div>
          </section>
        </section>
        <section id="36812848">
          <h3>
            <a
              class="item"
              href="https://nathanpeck.com/rethinking-infrastructure-as-code-from-scratch/"
              >Rethinking Infrastructure as Code from Scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 12:04:49</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36812848"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36812765">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/7/21/23802742/roblox-data-breach-leak-developer-personal-information-exposed"
              >Data breach exposes personal information of 4k Roblox
              developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 11:53:14</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36812765"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36812655">
          <h3>
            <a
              class="item"
              href="https://www.whitehouse.gov/briefing-room/statements-releases/2023/07/21/fact-sheet-biden-harris-administration-secures-voluntary-commitments-from-leading-artificial-intelligence-companies-to-manage-the-risks-posed-by-ai/"
              >White House Secures Commitments from Leading AI Companies to
              Manage AI Risks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 11:39:51</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36812655"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36812317">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Proofs_from_THE_BOOK"
              >Proofs from the Book</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 10:58:38</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36812317"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36812256">
          <h3>
            <a
              class="item"
              href="https://github.com/metabase/metabase/releases/tag/v0.46.6.1"
              >Tell HN: Upgrade your Metabase installation immediately</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 10:45:52</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36812256"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36812175">
          <h3>
            <a
              class="item"
              href="http://www.zannzen.com/blog/small_joys_with_odin_1/"
              >Small Joys with Odin</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 10:30:55</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36812175"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36811554">
          <h3>
            <a
              class="item"
              href="https://andreabergia.com/blog/2023/07/i-have-written-a-jvm-in-rust/"
              >I have written a JVM in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 08:48:48</span
              ><span class="points-container"
                >Points: <span class="points">330</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36811554"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36811018">
          <h3>
            <a
              class="item"
              href="https://home.cern/news/news/accelerators/accelerator-report-quench-lhc-inner-triplet-magnet-causes-small-leak-major"
              >Quench of LHC inner triplet magnet causes a small leak with major
              consequences</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 07:29:26</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36811018"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36810818">
          <h3>
            <a
              class="item"
              href="https://www.evanjones.ca/nanosecond-collisions.html"
              >Nanosecond timestamp collisions are common</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 07:01:03</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36810818"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36810230">
          <h3>
            <a class="item" href="https://llmconstellation.olafblitz.repl.co/"
              >LLM Constellation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 05:13:25</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36810230"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36810112">
          <h3>
            <a
              class="item"
              href="https://computinged.wordpress.com/2023/07/17/what-humanities-scholars-want-students-to-know-about-the-internet-alternative-paths-for-alternative-endpoints/"
              >What humanities scholars want students to know about the
              internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 04:49:57</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36810112"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36809565">
          <h3>
            <a
              class="item"
              href="https://news.unl.edu/newsrooms/today/article/nebraska-study-finds-billions-of-nanoplastics-released-when-microwaving/"
              >Study finds billions of nanoplastics released when microwaving
              containers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 03:10:16</span
              ><span class="points-container"
                >Points: <span class="points">362</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36809565"
                  >Comments</a
                ><span class="descendants">: 254</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36809457">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/07/20/magazine/family-genetics-frontotemporal-dementia.html"
              >The Vanishing Family: Life in the Shadow of a Cruel Genetic
              Mutation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 02:48:44</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36809457"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36809404">
          <h3>
            <a
              class="item"
              href="https://acko.net/blog/subpixel-distance-transform/"
              >Sub-Pixel Distance Transform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 02:40:22</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36809404"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36808296">
          <h3>
            <a
              class="item"
              href="https://webcache.googleusercontent.com/search?q=cache:2T9NpG8thZgJ:https://community.fly.io/t/service-interruption-cant-destroy-machine-deploy-or-restart/14227&amp;cd=9&amp;hl=en&amp;ct=clnk&amp;gl=au"
              >Fly.io Postgres cluster down for 3 days, no word from them about
              it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-20 @ 23:42:10</span
              ><span class="points-container"
                >Points: <span class="points">704</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36808296"
                  >Comments</a
                ><span class="descendants">: 371</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36807108">
          <h3>
            <a
              class="item"
              href="https://www.linyangchen.com/Typography-Fell-Types-font"
              >A 17th-century font in a 21st-century thesis</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-20 @ 21:38:52</span
              ><span class="points-container"
                >Points: <span class="points">416</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36807108"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36807071">
          <h3>
            <a
              class="item"
              href="https://thepointmag.com/examined-life/my-beautiful-friend/"
              >My Beautiful Friend</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-20 @ 21:35:22</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36807071"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36801491">
          <h3>
            <a
              class="item"
              href="https://www.federalreserve.gov/newsevents/pressreleases/other20230720a.htm"
              >FedNow Is Live</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-20 @ 15:00:25</span
              ><span class="points-container"
                >Points: <span class="points">1076</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36801491"
                  >Comments</a
                ><span class="descendants">: 936</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36799776">
          <h3>
            <a class="item" href="https://github.com/bartobri/no-more-secrets"
              >No-more-secrets: recreate the decryption effect seen in the 1992
              movie Sneakers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-20 @ 12:57:03</span
              ><span class="points-container"
                >Points: <span class="points">946</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36799776"
                  >Comments</a
                ><span class="descendants">: 244</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36797324">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/film/2023/jul/03/anton-corbijn-hipgnosis-film-pink-floyd-led-zeppelin"
              >Hipgnosis, the designers who changed the record sleeve</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-20 @ 06:02:04</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36797324"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36784864">
          <h3>
            <a
              class="item"
              href="https://commoncog.com/seeing-expertise-milestone-worth-aiming-for/"
              >Ability to see expertise is a milestone worth aiming for
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 11:51:08</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36784864"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36784032">
          <h3>
            <a class="item" href="https://www.foldnfly.com/runway.php"
              >Paper Airplane Ideas and Tips</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 09:52:41</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36784032"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36783062">
          <h3>
            <a
              class="item"
              href="https://blog.jgc.org/2023/07/revisiting-cansole-my-silly-pong-game.html"
              >Revisiting the “Cansole”, because my TV doesn't have the right
              connectors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 07:20:26</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36783062"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36782487">
          <h3>
            <a
              class="item"
              href="https://www.vox.com/2015/3/5/8150929/momofuku-ando-ramen-instant-noodles"
              >Momofuku Ando invented instant ramen (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-19 @ 05:39:49</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36782487"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
