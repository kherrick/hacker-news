<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46783600">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46783600"
              >Show HN: LemonSlice – Give your voice agents a face</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 17:55:15</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46783600"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <a href="https://lemonslice.com">https://lemonslice.com</a>). We
              train interactive avatar video models. Our API lets you upload a
              photo and immediately jump into a FaceTime-style call with that
              character. Here's a demo:
              <a
                href="https://www.loom.com/share/941577113141418e80d2834c83a5a0a9"
                >https://www.loom.com/share/941577113141418e80d2834c83a5a0a9</a
              >
              <p>
                Chatbots are everywhere. Voice AI has recently taken off. But we
                believe video avatars will be the most common form factor for
                conversational AI. Most people would rather watch something than
                read it. The problem is that generating video in real-time is
                hard, and overcoming the uncanny valley is even harder.
              </p>
              <p>
                We haven’t broken the uncanny valley yet. Nobody has. But we’re
                getting close and our photorealistic avatars are currently
                best-in-class (judge for yourself:
                <a href="https://lemonslice.com/try/taylor"
                  >https://lemonslice.com/try/taylor</a
                >). Plus, we're the only avatar model that can do animals and
                heavily stylized cartoons. Try it:
                <a href="https://lemonslice.com/try/alien"
                  >https://lemonslice.com/try/alien</a
                >. Warning! Talking to this little guy may improve your mood.
              </p>
              <p>
                Today we're releasing our new model* - Lemon Slice 2, a
                20B-parameter diffusion transformer that generates
                infinite-length video at 20fps on a single GPU - and opening up
                our API.
              </p>
              <p>
                How did we get a video diffusion model to run in real-time?
                There was no single trick, just a lot of them stacked together.
                The first big change was making our model causal. Standard video
                diffusion models are bidirectional (they look at frames both
                before and after the current one), which means you can't stream.
              </p>
              <p>
                From there it was about fitting everything on one GPU. We
                switched from full to sliding window attention, which killed our
                memory bottleneck. We distilled from 40 denoising steps down to
                just a few - quality degraded less than we feared, especially
                after using GAN-based distillation (though tuning that
                adversarial loss to avoid mode collapse was its own adventure).
              </p>
              <p>
                And the rest was inference work: modifying RoPE from complex to
                real (this one was cool!), precision tuning, fusing kernels, a
                special rolling KV cache, lots of other caching, and more. We
                kept shaving off milliseconds wherever we could and eventually
                got to real-time.
              </p>
              <p>
                We set up a guest playground for HN so you can create and talk
                to characters without logging in:
                <a href="https://lemonslice.com/hn">https://lemonslice.com/hn</a
                >. For those who want to build with our API (we have a new
                LiveKit integration that we’re pumped about!), grab a coupon
                code in the HN playground for your first Pro month free ($100
                value). See the docs:
                <a href="https://lemonslice.com/docs"
                  >https://lemonslice.com/docs</a
                >. Pricing is usage-based at $0.12-0.20/min for video
                generation.
              </p>
              <p>
                Looking forward to your feedback! And we’d love to see any cool
                characters you make - please share their links in the comments
              </p>
              <p>
                *We did a Show HN last year for our V1 model:
                <a href="https://news.ycombinator.com/item?id=43785044"
                  >https://news.ycombinator.com/item?id=43785044</a
                >. It was technically impressive but so bad compared to what we
                have today.
              </p>
            </div>
          </section>
        </section>
        <section id="46782930">
          <h3>
            <a class="item" href="https://haveibeenpwned.com/Breach/SoundCloud"
              >SoundCloud Data Breach Now on HaveIBeenPwned</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 17:11:39</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46782930"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46782811">
          <h3>
            <a
              class="item"
              href="https://www.oneusefulthing.org/p/management-as-ai-superpower"
              >Management as AI superpower: Thriving in a world of agentic AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 17:04:22</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46782811"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46782763">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/artie/jobs/MX163y2-founding-recruiter"
              >Artie (YC S23) Is Hiring a Founding Recruiter</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 17:01:37</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46782662">
          <h3>
            <a
              class="item"
              href="https://openssl-library.org/news/vulnerabilities/#CVE-2025-15467"
              >OpenSSL: Stack buffer overflow in CMS AuthEnvelopedData
              parsing</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 16:56:23</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46782662"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46782091">
          <h3>
            <a
              class="item"
              href="https://tailscale.com/blog/aperture-private-alpha"
              >A first look at Aperture by Tailscale (private alpha)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 16:23:40</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46782091"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46781707">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2026/01/27/food/amazon-fresh-go-closures"
              >Amazon to shut down Go and Fresh stores</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 15:58:05</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46781707"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://www.wsj.com/business/retail/amazon-to-shut-down-all-amazon-go-and-amazon-fresh-stores-0301dfb7"
                >https://www.wsj.com/business/retail/amazon-to-shut-down-all-...</a
              >
            </div>
          </section>
        </section>
        <section id="46781530">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2026/01/26/science/archaeology-neanderthals-tools.html"
              >430k-year-old well-preserved wooden tools are the oldest ever
              found</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 15:46:29</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46781530"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.ph/mHlUT">https://archive.ph/mHlUT</a>
              <p>
                <a
                  href="https://apnews.com/article/oldest-wooden-tools-marathousa-1-6e07cfc79f6d8ba648138f805531b933"
                  >https://apnews.com/article/oldest-wooden-tools-marathousa-1-...</a
                >
              </p>
              <p>
                <a
                  href="https://archaeologymag.com/2026/01/430000-year-old-wooden-tools-marathousa/"
                  >https://archaeologymag.com/2026/01/430000-year-old-wooden-to...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46781516">
          <h3>
            <a
              class="item"
              href="https://tech.lgbt/@JadedBlueEyes/115967791152135761"
              >Cloudflare claimed they implemented Matrix on Cloudflare workers.
              They didn't</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 15:45:45</span
              ><span class="points-container"
                >Points: <span class="points">353</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46781516"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46780065">
          <h3>
            <a
              class="item"
              href="https://tautvilas.medium.com/software-pump-and-dump-c8a9a73d313b"
              >The age of Pump and Dump software</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 14:05:48</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46780065"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46779809">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2026/01/26/tech/tiktok-ice-censorship-glitch-cec"
              >TikTok users can't upload anti-ICE videos. The company blames
              tech issues</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 13:44:24</span
              ><span class="points-container"
                >Points: <span class="points">902</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46779809"
                  >Comments</a
                ><span class="descendants">: 646</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46779645">
          <h3>
            <a class="item" href="https://alexxcons.github.io/blogpost_15.html"
              >Xfwl4 – The Roadmap for a Xfce Wayland Compositor</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 13:25:53</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46779645"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46778341">
          <h3>
            <a class="item" href="https://tonystr.net/blog/git_immitation"
              >I made my own Git</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 10:55:37</span
              ><span class="points-container"
                >Points: <span class="points">270</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46778341"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46777641">
          <h3>
            <a
              class="item"
              href="https://consciousdigital.org/why-we-do-not-support-opt-out-forms/"
              >We Do Not Support Opt-Out Forms (2025)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 09:35:42</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46777641"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46775961">
          <h3>
            <a class="item" href="https://www.kimi.com/blog/kimi-k2-5.html"
              >Kimi Released Kimi K2.5, Open-Source Visual SOTA-Agentic Model</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 05:42:27</span
              ><span class="points-container"
                >Points: <span class="points">417</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46775961"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46775135">
          <h3>
            <a class="item" href="https://telnet.org/htm/places.htm"
              >A list of fun destinations for telnet</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-27 @ 03:24:13</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46775135"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46771564">
          <h3>
            <a
              class="item"
              href="https://twitter.com/karpathy/status/2015883857489522876"
              >A few random notes from Claude coding quite a bit last few
              weeks</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-26 @ 21:09:19</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46771564"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
            <div class="text">
              <a href="https://xcancel.com/karpathy/status/2015883857489522876"
                >https://xcancel.com/karpathy/status/2015883857489522876</a
              >
            </div>
          </section>
        </section>
        <section id="46770855">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/two-twisty-shapes-resolve-a-centuries-old-topology-puzzle-20260120/"
              >Two Twisty Shapes Resolve a Centuries-Old Topology Puzzle</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-26 @ 20:12:34</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46770855"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46770221">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2026/Jan/26/chatgpt-containers/"
              >ChatGPT Containers can now run bash, pip/npm install packages and
              download files</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-26 @ 19:19:40</span
              ><span class="points-container"
                >Points: <span class="points">431</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46770221"
                  >Comments</a
                ><span class="descendants">: 304</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46766526">
          <h3>
            <a
              class="item"
              href="https://www.windowscentral.com/microsoft/windows-11/windows-11s-botched-patch-tuesday-update-nightmare-continues-as-microsoft-confirms-some-pcs-might-fail-to-boot"
              >Windows 11's Patch Tuesday nightmare gets worse</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-26 @ 15:07:37</span
              ><span class="points-container"
                >Points: <span class="points">414</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46766526"
                  >Comments</a
                ><span class="descendants">: 323</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46765819">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2026/01/apple-introduces-new-airtag-with-expanded-range-and-improved-findability/"
              >Apple introduces new AirTag with longer range and improved
              findability</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-26 @ 14:10:25</span
              ><span class="points-container"
                >Points: <span class="points">579</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46765819"
                  >Comments</a
                ><span class="descendants">: 690</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46762827">
          <h3>
            <a
              class="item"
              href="https://maskray.me/blog/2026-01-25-handling-long-branches"
              >Handling Long Branches</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-26 @ 07:31:17</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46762827"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46736815">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/c1evvx89559o"
              >Heathrow scraps liquid container limit</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-23 @ 19:38:33</span
              ><span class="points-container"
                >Points: <span class="points">566</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46736815"
                  >Comments</a
                ><span class="descendants">: 731</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46735637">
          <h3>
            <a
              class="item"
              href="https://www.gutenberg.org/files/45109/45109-h/45109-h.htm"
              >The Enchiridion by Epictetus</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-23 @ 18:07:31</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46735637"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46728878">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/in-mysterious-pattern-math-and-nature-converge-20130205/"
              >The Universal Pattern Popping Up in Math, Physics and Biology
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-23 @ 05:49:50</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46728878"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46711159">
          <h3>
            <a class="item" href="https://doi.org/10.1016/j.cub.2025.11.059"
              >Flexible use of a multi-purpose tool by a cow</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-21 @ 20:33:50</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46711159"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46702948">
          <h3>
            <a class="item" href="https://soupof.life"
              >A simulation where life unfolds in real time</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-21 @ 09:01:03</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46702948"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46694193">
          <h3>
            <a
              class="item"
              href="https://practical.engineering/blog/2026/1/20/the-hidden-engineering-of-runways"
              >The hidden engineering of runways</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-20 @ 16:52:52</span
              ><span class="points-container"
                >Points: <span class="points">401</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46694193"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46691548">
          <h3>
            <a
              class="item"
              href="https://potch.me/2026/snow-simulation-toy.html"
              >Snow Simulation Toy</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-20 @ 13:21:22</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46691548"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46687729">
          <h3>
            <a class="item" href="https://github.com/velox-apps/velox"
              >Velox: A Port of Tauri to Swift by Miguel de Icaza</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-20 @ 03:52:16</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46687729"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
