<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44283388">
          <h3>
            <a class="item" href="https://hexhowells.com/posts/journey.html"
              >I want to be a Journey Programmer Again</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 16:57:47</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44283388"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44283239">
          <h3>
            <a class="item" href="https://strangemachine.tv/safespace/popov/"
              >The experience continues until you stop experiencing it</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 16:36:27</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44283239"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44283095">
          <h3>
            <a
              class="item"
              href="https://www.pnas.org/doi/abs/10.1073/pnas.2308706120"
              >Social anxiety disorder-associated gut microbiota increases
              social fear</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 16:16:12</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44283095"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44283093">
          <h3>
            <a
              class="item"
              href="https://deosjr.github.io/dynamicland/datalog.html"
              >Datalog in miniKanren</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 16:16:08</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44283093"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44283047">
          <h3>
            <a class="item" href="https://linuxgazette.net/165/laycock.html"
              >Red Hat Linux in 1998 (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 16:08:42</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44283047"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44283008">
          <h3>
            <a
              class="item"
              href="https://insideclimatenews.org/news/13062025/agriculture-ethanol-biofuel-policy-climate-failure/"
              >Biofuels Policy, a Mainstay of American Agriculture, a Failure
              for the Climate</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 16:02:22</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44283008"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44282998">
          <h3>
            <a
              class="item"
              href="https://www.downtowndougbrown.com/2025/06/modifying-an-hdmi-dummy-plugs-edid-using-a-raspberry-pi/"
              >Modifying an HDMI dummy plug's EDID using a Raspberry Pi</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 16:00:43</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44282998"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44282754">
          <h3>
            <a
              class="item"
              href="https://bsky.app/profile/alistairkitchen.bsky.social/post/3lrjsdecc5c2x"
              >Journalists Wary of Travelling to US Due to Palantir
              Surveillance</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 15:22:35</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44282754"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44282232">
          <h3>
            <a class="item" href="https://dougengelbart.org/content/view/273/"
              >The Keyset</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 13:39:31</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44282232"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44282177">
          <h3><a class="item" href="https://canyonmid.com/">Canyon.mid</a></h3>
          <section>
            <h4>
              <span>2025-06-15 @ 13:23:55</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44282177"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44282143">
          <h3>
            <a
              class="item"
              href="https://ourworldindata.org/childhood-leukemia-treatment-history"
              >Childhood leukemia: how a deadly cancer became treatable</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 13:12:42</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44282143"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44282017">
          <h3>
            <a
              class="item"
              href="https://olegkutkov.me/2025/06/15/how-to-modify-starlink-mini-to-run-without-the-built-in-wifi-router/"
              >How to modify Starlink Mini to run without the built-in WiFi
              router</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 12:40:07</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44282017"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44281958">
          <h3>
            <a class="item" href="https://github.com/Kuberwastaken/meow"
              >Show HN: Meow – An Image File Format I made because PNGs and
              JPEGs suck for AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 12:26:55</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44281958"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
            <div class="text">
              <p>
                Instead of storing metadata alongside the image where it can be
                lost, MEOW ENCODES it directly inside the image pixels using LSB
                steganography - hiding data in the least significant bits where
                your eyes can't tell the difference, this also doesn't increase
                the image size significantly. So if you use any form of lossless
                compression, it stays.
              </p>
              <p>
                What I noticed was, Most "innovative" image file formats died
                because of lack of adoption, but MEOW is completely CROSS
                COMPATIBLE WITH PNGs You can quite literally rename a .MEOW file
                to a .PNG and open it in a normal image viewer.
              </p>
              <p>Here's what gets baked right into every pixel:</p>
              <p>
                - Edge Detection Maps - pre-computed boundaries so AI doesn't
                waste time figuring out where objects start and end.
              </p>
              <p>
                - Texture Analysis Data - surface patterns, roughness, material
                properties already mapped out.
              </p>
              <p>
                - Complexity Scores - tells AI models how much processing power
                different regions need.
              </p>
              <p>
                - Attention Weight Maps - highlights where models should focus
                their compute (like faces, text, important objects)
              </p>
              <p>
                - Object Relationship Data - spatial connections between
                detected elements.
              </p>
              <p>
                - Future Proofing Space - reserved bits for whatever AI wants to
                add (or comments for training LORAs or labelling)
              </p>
              <p>
                Of course, all of these are editable and configurable while
                surviving compression, sharing, even screenshot-and-repost
                cycles :p
              </p>
              <p>
                When you convert ANY image format to .meow, it automatically
                generates most AI-specific features and data from what it sees
                in the image, which makes it work way better.
              </p>
              <p>
                Would love thoughts, suggestions or ideas you all have for it :)
              </p>
            </div>
          </section>
        </section>
        <section id="44281727">
          <h3>
            <a
              class="item"
              href="https://github.com/frankmcsherry/blog/blob/master/posts/2025-06-03.md"
              >Datalog in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 11:18:40</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44281727"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44281506">
          <h3>
            <a class="item" href="https://visionbook.mit.edu"
              >Foundations of Computer Vision</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 10:11:41</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44281506"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44281371">
          <h3>
            <a
              class="item"
              href="https://placing.technology/notes-on-the-history-of-the-map-tile"
              >Notes on the History of the Map Tile</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 09:14:09</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44281371"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44281148">
          <h3>
            <a class="item" href="https://github.com/tanelp/tiny-diffusion"
              >Tiny-diffusion: A minimal implementation of probabilistic
              diffusion models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 07:52:49</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44281148"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44281016">
          <h3>
            <a class="item" href="https://www.dreamsongs.com/ArtOfLisp.html"
              >The Art of Lisp and Writing (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 07:07:42</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44281016"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44279850">
          <h3>
            <a
              class="item"
              href="https://seohong.me/blog/q-learning-is-not-yet-scalable/"
              >Q-learning is not yet scalable</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 00:56:54</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44279850"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44279181">
          <h3>
            <a
              class="item"
              href="https://www.mathpages.com/home/kmath668/kmath668.htm"
              >Infinite Grid of Resistors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-14 @ 22:12:12</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44279181"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44278746">
          <h3>
            <a
              class="item"
              href="https://morethanmoore.substack.com/p/amds-ai-future-is-rack-scale-helios"
              >AMD's AI Future Is Rack Scale 'Helios'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-14 @ 20:51:11</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44278746"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44276476">
          <h3>
            <a class="item" href="https://github.com/yousef-rafat/miniDiffusion"
              >I have reimplemented Stable Diffusion 3.5 from scratch in pure
              PyTorch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-14 @ 13:56:46</span
              ><span class="points-container"
                >Points: <span class="points">447</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44276476"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44274696">
          <h3>
            <a
              class="item"
              href="https://typesanitizer.com/blog/complexity-definitions.html"
              >Meta-analysis of three different notions of software
              complexity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-14 @ 06:54:45</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44274696"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44274440">
          <h3>
            <a
              class="item"
              href="https://yalereview.org/article/working-for-patricia-highsmith"
              >The Talented Ms. Highsmith</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-14 @ 05:39:20</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44274440"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44262227">
          <h3>
            <a class="item" href="https://github.com/egnor/wt32-eth01"
              >Bits and bobs related to Wireless-Tag's WT32-ETH01 board</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-12 @ 19:37:09</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44262227"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44257422">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/massive-field-where-native-american-farmers-grew-corn-beans-and-squash-1000-years-ago-discovered-in-michigan-180986758/"
              >1k year old 3 sisters crop farm found in Northern Michigan</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-12 @ 13:13:39</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44257422"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44255232">
          <h3>
            <a
              class="item"
              href="https://ostif.org/ruby-on-rails-audit-complete/"
              >Ruby on Rails Audit Complete</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-12 @ 08:15:18</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44255232"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44254627">
          <h3>
            <a class="item" href="https://github.com/SakanaAI/text-to-lora"
              >Text-to-LoRA: Hypernetwork that generates task-specific LLM
              adapters (LoRAs)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-12 @ 05:51:10</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44254627"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44249511">
          <h3>
            <a class="item" href="https://kristaps.bsd.lv/devsecflops/"
              >How easy is it for a developer to "sandbox" a program?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-11 @ 16:57:24</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44249511"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44247020">
          <h3>
            <a
              class="item"
              href="https://signoz.io/blog/cicd-observability-with-opentelemetry/"
              >CI/CD Observability with OpenTelemetry Step by Step Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-11 @ 12:42:50</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44247020"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
