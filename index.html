<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39967474">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2024/04/07/business/southwest-boeing-737-800-engine/index.html"
              >Southwest Boeing 737-800 flight from Denver loses engine cover</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 08:28:13</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39967474"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39966978">
          <h3>
            <a
              class="item"
              href="https://bitmovin.com/careers/full-stack-engineer-7260509002"
              >Bitmovin (YC S15) Is Hiring a Full Stack Engineer in Austria</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 07:01:37</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39966918">
          <h3>
            <a
              class="item"
              href="https://bxt.rs/blog/just-how-much-faster-are-the-gnome-46-terminals/"
              >Just How Much Faster Are the Gnome 46 Terminals?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 06:49:59</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39966918"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39966743">
          <h3>
            <a
              class="item"
              href="https://djmag.com/news/spotify-officially-demonetises-all-tracks-under-1000-streams"
              >Spotify demonetizes all tracks under 1k streams</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 06:19:51</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39966743"
                  >Comments</a
                ><span class="descendants">: 172</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39966534">
          <h3>
            <a class="item" href="https://github.com/Filimoa/open-parse"
              >Show HN: Beyond text splitting – improved file parsing for
              LLM's</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 05:41:15</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39966534"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39966152">
          <h3>
            <a
              class="item"
              href="https://github.com/sourcegraph/awesome-code-ai"
              >A list of AI coding tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 04:13:23</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39966152"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39965907">
          <h3>
            <a
              class="item"
              href="https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide"
              >High Definition CSS Color Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 03:14:17</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39965907"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39965446">
          <h3>
            <a
              class="item"
              href="https://medicalxpress.com/news/2024-04-autism-adhd-linked-disturbed-gut.html"
              >Infant microbes and metabolites point to childhood
              neurodevelopmental disorders</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 01:30:01</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39965446"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39965267">
          <h3>
            <a
              class="item"
              href="https://arpa-e.energy.gov/news-and-media/press-releases/us-department-energy-announces-10-million-explore-using-plants"
              >Phytomining – Extracting Minerals via Plants</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-08 @ 00:55:08</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39965267"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39965006">
          <h3>
            <a
              class="item"
              href="https://www.mpg.de/21778967/0404-grav-mysterious-object-in-the-gap-152520-x"
              >When a black hole and a neutron star merge</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 23:59:07</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39965006"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39964590">
          <h3>
            <a
              class="item"
              href="https://www.eetimes.com/groq-ceo-we-no-longer-sell-hardware/"
              >Groq CEO: 'We No Longer Sell Hardware'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 22:40:50</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39964590"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39964107">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/ernest-shackleton-ship-discovery-antarctic-explorer-history-180979702/"
              >Wreck of Shackleton's 'Endurance' discovered in Antarctic depths
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 21:28:39</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39964107"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39962415">
          <h3>
            <a class="item" href="https://www.flashnotesapp.com"
              >Show HN: Flash Notes – Flashcards for Your Notes, LLM, iOS/macOS
              Sync</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 17:54:31</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39962415"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                So I've started experimenting with flashcards derived from
                structured notes. Writing the 1st MVP was fast, but
                productionising it was way harder. Content synchronisation when
                the user can work from tube/plane and use multiple devices and
                content is text is… not trivial. So I had to learn about OT
                (Operational Transformation) and CRDT (Conflict-Free Replicated
                Data Type), and even implemented a few iterations of CRDT in
                Swift. This was intellectually rewarding, but the app was not
                progressing. Also, when you have both app data model and CRDT in
                your head, you start to over-optimize - you are leaking
                abstractions. Thankfully, the CRDT market nowadays is pretty
                mature; Automerge is production-ready, and automerge-swift comes
                with a nice abstraction. I strongly believe offline-first apps
                are the future/now.
              </p>
              <p>
                ChatGPT happened, and it felt like a perfect match for the app,
                as it's already text-focused. First, it was just to provide
                prompts for the cards, but when you turn the problem around, you
                realise that LLM is great for predicting other flashcards in the
                context of your note. So instead of downloading a premade
                flashcard deck, you start a new note, give it a title, and click
                generate. I still find it weird to watch but also mesmerising.
              </p>
              <p>
                Other features that I think are valuable: App data sits within
                your iCloud account until you use Generative AI (LLM).
                Hopefully, we will get an API from Apple soon.
              </p>
              <p>
                The Spaced Repetition that I've implemented is not really
                spaced. I wanted the app to adapt to the user. So it's focusing
                on sorting the card deck based on your recall and lets you
                practise as much as you want. I found this approach to work way
                better for me.
              </p>
              <p>Oh, it's multilingual with text-to-speech.</p>
              <p>
                Here we are; the 1st production-ready "MVP" is live. I'd love to
                hear your feedback.
              </p>
            </div>
          </section>
        </section>
        <section id="39962303">
          <h3>
            <a class="item" href="https://diffoscope.org/"
              >Diffoscope – In-depth comparison of files, archives, and
              directories</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 17:36:06</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39962303"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39962023">
          <h3>
            <a class="item" href="https://github.com/migueletto/PumpkinOS"
              >PumpkinOS, a Re-Implementation of PalmOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 16:55:16</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39962023"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39961910">
          <h3>
            <a
              class="item"
              href="https://3quarksdaily.com/3quarksdaily/2020/10/what-john-von-neumann-really-did-at-los-alamos.html"
              >What John von Neumann did at Los Alamos (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 16:42:04</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39961910"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39961245">
          <h3>
            <a
              class="item"
              href="https://retrocmp.de/hardware/greaseweazle/greaseweazle.htm"
              >Greaseweazle</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 15:06:42</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39961245"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960717">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.02258"
              >Mixture-of-Depths: Dynamically allocating compute in
              transformers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 13:42:05</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960717"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960645">
          <h3>
            <a class="item" href="https://breckyunits.com/sleepWriting.html"
              >Blog posts, sorted by sleep</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 13:32:27</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960645"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960537">
          <h3>
            <a class="item" href="https://github.com/stackframe-projects/pgmock"
              >Show HN: I open-sourced the in-memory PostgreSQL I built at work
              for E2E tests</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 13:13:43</span
              ><span class="points-container"
                >Points: <span class="points">282</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960537"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960535">
          <h3>
            <a class="item" href="https://github.com/AmrDeveloper/ClangQL"
              >ClangQL: A tool to run SQL-like query on C/C++ Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 13:13:23</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960535"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960125">
          <h3>
            <a
              class="item"
              href="https://security.googleblog.com/2024/03/google-public-dnss-approach-to-fight.html"
              >Google Public DNS's approach to fight against cache poisoning
              attacks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 11:46:55</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960125"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39959946">
          <h3>
            <a
              class="item"
              href="https://retrocomputing.stackexchange.com/questions/29787/did-any-processor-implement-an-integer-square-root-instruction"
              >Did any processor implement an integer square root
              instruction?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 10:55:10</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39959946"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39959380">
          <h3>
            <a
              class="item"
              href="https://sourcegraph.com/blog/the-lifecycle-of-a-code-ai-completion"
              >The lifecycle of a code AI completion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 08:55:03</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39959380"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39959368">
          <h3>
            <a
              class="item"
              href="https://eidel.io/how-to-found-a-company-in-germany-14-easy-steps-and-lots-of-pain/"
              >How to found a company in Germany: 14 "easy" steps and lots of
              pain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 08:51:20</span
              ><span class="points-container"
                >Points: <span class="points">385</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39959368"
                  >Comments</a
                ><span class="descendants">: 583</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39956008">
          <h3>
            <a class="item" href="https://github.com/maharmstone/btrfs"
              >WinBtrfs – an open-source btrfs driver for Windows</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-06 @ 21:59:31</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39956008"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39954422">
          <h3>
            <a class="item" href="https://zengm.com/facesjs/"
              >Faces.js, a JavaScript library for generating vector-based
              cartoon faces</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-06 @ 18:37:36</span
              ><span class="points-container"
                >Points: <span class="points">435</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39954422"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39950989">
          <h3>
            <a
              class="item"
              href="https://susam.net/programming-with-dos-debugger.html"
              >Programming with DOS Debugger (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-06 @ 08:46:52</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39950989"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39950459">
          <h3>
            <a
              class="item"
              href="https://www.colour-science.org/posts/retrospective-on-10-years-of-colour-science/"
              >Retrospective on 10 Years of colour-science</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-06 @ 06:26:58</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39950459"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39927682">
          <h3>
            <a class="item" href="https://www6.slac.stanford.edu/lsst"
              >LSST Camera: largest camera for astronomy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 07:57:47</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39927682"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
