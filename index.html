<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42427916">
          <h3>
            <a class="item" href="https://cyphernet.es/#"
              >Cyphernetes: A Query Language for Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 04:01:32</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42427916"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42427888">
          <h3><a class="item" href="https://www.openerv.ca">OpenERV</a></h3>
          <section>
            <h4>
              <span>2024-12-16 @ 03:55:10</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42427888"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42427826">
          <h3>
            <a
              class="item"
              href="https://johncarlosbaez.wordpress.com/2021/09/13/the-cyclic-identity-for-partial-derivatives/"
              >Derivatives don't always act like fractions (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 03:39:44</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42427826"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42427132">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/legal/us-lawmakers-tell-apple-google-be-ready-remove-tiktok-app-stores-jan-19-2024-12-13/"
              >US lawmakers tell Apple, Google to be ready to remove TikTok from
              stores Jan. 19</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 01:08:33</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42427132"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42426589">
          <h3>
            <a class="item" href="https://dillo-browser.github.io/25-years/"
              >25 Years of Dillo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 23:06:15</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42426589"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42426337">
          <h3>
            <a
              class="item"
              href="https://people.mpim-bonn.mpg.de/zagier/files/doi/10.1007/BF03039306/fulltext.pdf"
              >The First 50M Prime Numbers (1975) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 22:11:57</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42426337"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42426284">
          <h3>
            <a class="item" href="https://github.com/anvaka/map-of-github"
              >Map of GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 22:02:33</span
              ><span class="points-container"
                >Points: <span class="points">368</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42426284"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42425398">
          <h3>
            <a
              class="item"
              href="https://www.makeuseof.com/reasons-why-dumb-tvs-deserve-a-comeback/"
              >Dumb TVs deserve a comeback</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 19:29:32</span
              ><span class="points-container"
                >Points: <span class="points">265</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42425398"
                  >Comments</a
                ><span class="descendants">: 309</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42425139">
          <h3>
            <a
              class="item"
              href="https://leancrew.com/all-this/2024/12/the-antikythera-mechanism/"
              >The Antikythera mechanism – 254:19 ratio</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 18:46:48</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42425139"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42424879">
          <h3>
            <a
              class="item"
              href="https://rish-01.github.io/blog/posts/ml_estimation/"
              >Maximum likelihood estimation and loss functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 18:07:06</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42424879"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42424508">
          <h3>
            <a class="item" href="https://smarthome.steviep.xyz"
              >Show HN: SmartHome – An Adventure Game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 17:05:30</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42424508"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
            <div class="text">
              <p>
                If you find it too hard and don't mind some mild spoilers, then
                check out the hints page:
                <a href="https://smarthome.steviep.xyz/help"
                  >https://smarthome.steviep.xyz/help</a
                >
              </p>
              <p>Enjoy!</p>
            </div>
          </section>
        </section>
        <section id="42424370">
          <h3>
            <a class="item" href="https://github.com/JanNeuendorf/SVC16"
              >SVC16: Simplest Virtual Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 16:39:26</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42424370"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42423988">
          <h3>
            <a class="item" href="https://railgunlabs.com/unicorn/"
              >Show HN: I built an embeddable Unicode library with MISRA C
              conformance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 15:41:27</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42423988"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
            <div class="text">
              <p>
                Unicorn is designed to be fully customizable: you can select
                which Unicode algorithms and character properties are included
                or excluded from compilation. You can also exclude Unicode
                character blocks wholesale for scripts your application does not
                support. It's perfect for resource constrained devices like
                microcontrollers and IoT devices.
              </p>
              <p>
                About me: I quit my Big Corp job a few years back to pursue my
                passion for software development and this is one of my first
                commercial releases.
              </p>
            </div>
          </section>
        </section>
        <section id="42423409">
          <h3>
            <a
              class="item"
              href="https://www.futilitycloset.com/2024/12/15/tidy-2/"
              >A visual proof that a^2 – b^2 = (a + b)(a – b)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 14:01:37</span
              ><span class="points-container"
                >Points: <span class="points">538</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42423409"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42422138">
          <h3>
            <a
              class="item"
              href="https://jaketae.github.io/study/prime-spirals/"
              >Plotting Prime Numbers (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 07:41:39</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42422138"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42419224">
          <h3>
            <a
              class="item"
              href="https://milescole.dev/data-engineering/2024/12/12/Should-You-Ditch-Spark-DuckDB-Polars.html"
              >Should you ditch Spark for DuckDB or Polars?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 20:28:44</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42419224"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42417857">
          <h3>
            <a class="item" href="https://andrewkchan.dev/posts/yalm.html"
              >Fast LLM Inference From Scratch (using CUDA)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 16:02:48</span
              ><span class="points-container"
                >Points: <span class="points">228</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42417857"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42417478">
          <h3>
            <a
              class="item"
              href="https://softwaredoug.com/blog/2024/12/14/throwaway-prs-not-design-docs"
              >Preferring throwaway code over design docs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 14:52:22</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42417478"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42416812">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/03/plato-how-an-educational-computer-system-from-the-60s-shaped-the-future/"
              >PLATO: An educational computer system from the '60s shaped the
              future (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 12:57:12</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42416812"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42415857">
          <h3>
            <a class="item" href="http://marc.merlins.org/linux/teaparty/"
              >Silicon Valley Tea Party a.k.a. the great 1998 Linux revolt take
              II (1999)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 09:49:15</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42415857"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42414864">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2412.03556"
              >Best-of-N Jailbreaking</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 05:18:52</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42414864"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42413690">
          <h3>
            <a
              class="item"
              href="https://www.eatingpolicy.com/p/bringing-elon-to-a-knife-fight"
              >Wishing for a more orderly disruption may misunderstand
              government reform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 00:52:27</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42413690"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42413656">
          <h3>
            <a
              class="item"
              href="https://ewpratten.com/blog/iphone-mifare-magic"
              >Coercing a Magic MIFARE credential into being an
              iPhone-compatible NFC tag</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-14 @ 00:44:55</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42413656"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42408934">
          <h3>
            <a
              class="item"
              href="https://www.nottingham.ac.uk/news/researchers-discover-new-third-class-of-magnetism-that-could-transform-digital-devices"
              >Researchers discover new third class of magnetism</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 14:52:33</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42408934"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42408546">
          <h3>
            <a
              class="item"
              href="https://mfasold.net/blog/displaying-website-content-on-an-e-ink-display/"
              >I replaced my son's school timetable app with an e-paper</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 14:13:34</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42408546"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42406070">
          <h3>
            <a class="item" href="https://github.com/vercel/fun"
              >Vercel/fun: ƒun – Local serverless function λ development
              runtime</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 05:08:58</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42406070"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42405364">
          <h3>
            <a
              class="item"
              href="https://www.scannedinavian.com/programmers-want-flow-when-programming-light-turns-red.html"
              >Programmers want flow. when programming, light turns RED</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 02:04:30</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42405364"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42405323">
          <h3>
            <a
              class="item"
              href="https://techcommunity.microsoft.com/blog/aiplatformblog/introducing-phi-4-microsoft%E2%80%99s-newest-small-language-model-specializing-in-comple/4357090"
              >Phi-4: Microsoft's Newest Small Language Model Specializing in
              Complex Reasoning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 01:54:41</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42405323"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42398651">
          <h3>
            <a
              class="item"
              href="https://fangpenlin.com/posts/2024/12/11/cading-and-3d-printing-like-a-software-engineer-part1/"
              >CADing and 3D printing like a software engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 12:38:42</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42398651"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42396521">
          <h3>
            <a
              class="item"
              href="https://thereader.mitpress.mit.edu/the-bitter-aftertaste-of-technical-sweetness/"
              >The Bitter Aftertaste of "Technical Sweetness"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 05:38:01</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42396521"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
