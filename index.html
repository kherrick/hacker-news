<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41604267">
          <h3>
            <a
              class="item"
              href="https://discord.com/blog/how-discord-reduced-websocket-traffic-by-40-percent"
              >Discord Reduced WebSocket Traffic by 40%</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 18:09:15</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41604267"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41604262">
          <h3>
            <a class="item" href="https://container-desktop.com/"
              >Docker Desktop Alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 18:08:22</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41604262"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41604042">
          <h3>
            <a class="item" href="https://www.inngest.com/"
              >Show HN: Inngest 1.0 – Open-source durable workflows on every
              platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 17:33:15</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41604042"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <a href="https://inngest.com/">https://inngest.com/</a>)
              <p>
                Inngest is an open-source durable workflow platform that works
                on any cloud. Durable workflows are stateful, long running step
                functions written in code, which automatically retry on failure.
                It abstracts everything about queues, event streams and state
                for you, letting you focus on code. Some examples of uses:
                managing stateful AI chained step functions; managing search/rag
                indexes and data pipelines; integrations and webhooks; billing
                and payment flows.
              </p>
              <p>
                Technical details: unlike other solutions, we put lots of effort
                into designing our SDK’s step.run APIs to make them extremely
                easy to use — developer experience is the most important thing
                for us.
              </p>
              <p>
                We had to design and build our own queueing system to work with
                multi-tenancy, batching, and debouncing, and we’re iterating on
                this as we move to FoundationDB. It’s largely all Go in the
                backend, with a bunch of caching, clickhouse, event streams, and
                coordination on our behalf. Workers are shared nothing, and run
                based off of the queue and execution state.
              </p>
              <p>
                We did a post last year as we iterated on our TS SDK. The
                product has changed a lot since then and wanted to show the
                community what’s changed as we reach 1.0:
              </p>
              <p></p>
              <pre><code>    * Golang, Java, and Python SDKs with cross-language function invocation (across clouds, too)

    * Multi-tenant aware flow control (concurrency, throttling, debounce)

    * Batching, grouping many events into a single function call

    * Much improved dashboard, with tracing and metrics built in

    * Advanced recovery tools like function replay, temporary pausing,  bulk cancellation (with optional expressions).  No more dead letter queues!

    * Branch deploys built in, with staging env support out of the box

    * Full local testing with production parity

</code></pre>
              There's a ton on the roadmap, with more launching next week. We’re
              hiring systems &amp; infra engineers, too — it’s a fun job with
              lots of challenges!
              <p>
                Wanted to say thank you to the HN community for feedback so far!
                Happy Friday :)
              </p>
            </div>
          </section>
        </section>
        <section id="41603955">
          <h3>
            <a
              class="item"
              href="https://pierre-couy.dev/simulations/2024/09/gray-scott-shader.html"
              >Mitosis in the Gray-Scott model: writing shader-based chemical
              simulations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 17:22:06</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41603955"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41603865">
          <h3>
            <a class="item" href="https://any-skin.github.io"
              >Show HN: Put this touch sensor on a robot and learn super precise
              tasks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 17:11:48</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41603865"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                Our most exciting result: Learned visuotactile policies for
                precise tasks like inserting USBs and credit card swiping, that
                work out-of-the-box when you replace skins! To the best of our
                knowledge, this has never been shown before with any existing
                tactile sensor.
              </p>
              <p>
                Why is this important? For the first time, you could now collect
                data and train models on one sensor and expect them to
                generalize to new copies of the sensor -- opening the door to
                the kind of large foundation models that have revolutionized
                vision and language reasoning.
              </p>
              <p>
                Would love to hear the community's questions, thoughts and
                comments!
              </p>
            </div>
          </section>
        </section>
        <section id="41603774">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/trellis/jobs/1ypWafM-founding-engineer-full-time-backend-ml-infra"
              >Trellis (YC W24) is hiring eng to build AI workflows for
              unstructured data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 17:00:58</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41603546">
          <h3>
            <a class="item" href="https://github.com/lds133/weather_landscape"
              >Visualizing Weather Forecasts Through Landscape Imagery</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 16:31:00</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41603546"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41602474">
          <h3>
            <a class="item" href="https://github.com/qhjqhj00/MemoRAG"
              >MemoRAG – Enhance RAG with memory-based knowledge discovery for
              long contexts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 14:41:16</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41602474"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41602056">
          <h3>
            <a
              class="item"
              href="https://taylor.town/reactive-relational-algebra"
              >Reactive Relational Algebra</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 13:54:41</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41602056"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41601730">
          <h3>
            <a class="item" href="https://github.com/cupy/cupy"
              >CuPy: NumPy and SciPy for GPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 13:18:06</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41601730"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41601347">
          <h3>
            <a class="item" href="https://xn--treo-l3a.nz/"
              >Tō Reo – A Māori Spellchecker</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 12:30:11</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41601347"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41600756">
          <h3>
            <a
              class="item"
              href="https://dmitry.gr/?r=05.Projects&amp;proj=35.%20Linux4004"
              >Linux/4004: booting Linux on Intel 4004 for fun, art, and no
              profit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 11:04:15</span
              ><span class="points-container"
                >Points: <span class="points">326</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41600756"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41600179">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2409.12917"
              >Training Language Models to Self-Correct via Reinforcement
              Learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 09:19:40</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41600179"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41600177">
          <h3>
            <a class="item" href="https://github.com/commaai/openpilot"
              >Openpilot – Operating system for robotics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 09:19:00</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41600177"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41599109">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2409.07591"
              >A rigid but foldable indoor airship aerial system for cave
              exploration</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 05:41:23</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41599109"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41598119">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/contextual-retrieval"
              >Contextual Retrieval</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 01:57:22</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41598119"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41597929">
          <h3>
            <a
              class="item"
              href="https://travel.stackexchange.com/questions/26780/is-there-a-flight-search-engine-that-combines-flights-from-different-airlines"
              >A flight search engine that combines flights from different
              airlines? (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 01:20:32</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41597929"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41597250">
          <h3>
            <a class="item" href="https://kibty.town/blog/arc/"
              >Gaining access to anyones Arc browser without them even visiting
              a website</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 23:04:42</span
              ><span class="points-container"
                >Points: <span class="points">890</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41597250"
                  >Comments</a
                ><span class="descendants">: 279</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41596336">
          <h3>
            <a
              class="item"
              href="https://www.anfractuosity.com/projects/cnc-microscopy/"
              >Show HN: CNC Microscopy for Fun</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 20:59:28</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41596336"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41595310">
          <h3>
            <a
              class="item"
              href="https://www.zombiezen.com/blog/2024/09/zb-early-stage-build-system/"
              >Zb: An Early-Stage Build System</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 19:16:04</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41595310"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41592552">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/5g-antenna-transparent-window"
              >Glass Antenna Turns windows into 5G Base Stations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 14:53:32</span
              ><span class="points-container"
                >Points: <span class="points">351</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41592552"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41591018">
          <h3>
            <a class="item" href="https://github.com/MightyMoud/sidekick"
              >Show HN: A CLI tool I made to self-host any app with two commands
              on a VPS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 12:17:05</span
              ><span class="points-container"
                >Points: <span class="points">390</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41591018"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41590466">
          <h3>
            <a class="item" href="https://larslofgren.com/forbes-marketplace/"
              >Forbes Marketplace: The Parasite SEO Company Trying to Devour Its
              Host</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 10:44:08</span
              ><span class="points-container"
                >Points: <span class="points">533</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41590466"
                  >Comments</a
                ><span class="descendants">: 264</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41589361">
          <h3>
            <a
              class="item"
              href="https://neilmadden.blog/2024/09/18/digital-signatures-and-how-to-avoid-them/"
              >Digital signatures and how to avoid them</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 07:12:16</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41589361"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41578440">
          <h3>
            <a class="item" href="http://www.mattmahoney.net/dc/text.html"
              >Large Text Compression Benchmark</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-18 @ 11:36:46</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41578440"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41562506">
          <h3>
            <a
              class="item"
              href="https://placesjournal.org/article/julia-childs-kitchens/"
              >Julia Child's Kitchens</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-16 @ 23:54:56</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41562506"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41559024">
          <h3>
            <a class="item" href="https://hengyiwang.github.io/projects/spanner"
              >3D Reconstruction with Spatial Memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-16 @ 18:29:59</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41559024"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41553940">
          <h3>
            <a
              class="item"
              href="https://jfmengels.net/constraints-and-guarantees/"
              >Constraints and Guarantees</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-16 @ 08:26:14</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41553940"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41553727">
          <h3>
            <a
              class="item"
              href="https://lethain.com/decompose-monolith-strategy/"
              >Should we decompose our monolith?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-16 @ 07:45:25</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41553727"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41550404">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/topological-acoustics"
              >Ultrasonic Chips Could Cut Interference in the IoT</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-15 @ 21:07:49</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41550404"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
