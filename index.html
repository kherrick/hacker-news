<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35423290">
          <h3>
            <a
              class="item"
              href="https://english.elpais.com/science-tech/2023-04-02/one-of-the-worlds-most-cited-scientists-rafael-luque-suspended-without-pay-for-13-years.html"
              >Scientist Rafael Luque suspended without pay for 13 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 13:33:53</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35423290"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35422739">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Steam-Linux-March-2023"
              >Valve Shows a Drop in Linux Gamers for March, but the Numbers Are
              Questionable</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 12:58:29</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35422739"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35422570">
          <h3>
            <a
              class="item"
              href="http://johnearnest.github.io/ok/ike/ike.html?gist=f78af1a96ec206dc3b07ike.html?key=c9argHWP"
              >Animated Unknown Pleasures in 3 lines of K (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 12:45:44</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35422570"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35422494">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2023/04/stable-diffusion-copyright-lawsuits-could-be-a-legal-earthquake-for-ai/"
              >Stable Diffusion copyright lawsuits could be a legal earthquake
              for AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 12:41:01</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35422494"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35422323">
          <h3>
            <a
              class="item"
              href="https://www.newstatesman.com/science-tech/2023/02/ai-porn-will-never-be-sexy"
              >AI porn will never be sexy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 12:24:00</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35422323"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35422154">
          <h3>
            <a class="item" href="https://jobs.lever.co/buildzoom"
              >BuildZoom (better way to build custom homes) Is hiring a
              Principal Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 12:11:43</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35421899">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/23664746/framework-laptop-excitement-vpr-matrix-history-nostalgia"
              >Framework’s computers aren’t perfect, but they are exciting</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 11:49:16</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35421899"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35421554">
          <h3>
            <a
              class="item"
              href="https://www.construct.net/en/blogs/ashleys-blog-2/safari-releases-development-1616"
              >Safari releases are development hell</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 11:10:09</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35421554"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35421545">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2023/04/03/wwe-ufc-merger-endeavor.html"
              >WWE Agrees to Merge with UFC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 11:09:09</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35421545"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35421474">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35421474"
              >Ask HN: Best way to “donate” dev hours to charity?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 11:00:23</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35421474"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <p>
                I work at a service oriented dev company and from time to time
                we have some bench time to utilize. I'd like to keep people
                engaged on projects and ideally exposed them to best practices
                as much as possible.
              </p>
              <p>
                What's the best way to find places to "donate" our time to
                certain charities or non-profit organizations?
              </p>
              <p>
                Right now people are going out to our most used third party open
                source software repos and actively contributing there, but I'd
                like to do more of a full on apps.
              </p>
              <p>Thanks</p>
            </div>
          </section>
        </section>
        <section id="35421034">
          <h3>
            <a class="item" href="https://mullvad.net/en/browser"
              >The Mullvad Browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 10:11:50</span
              ><span class="points-container"
                >Points: <span class="points">465</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35421034"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35420946">
          <h3>
            <a
              class="item"
              href="https://www.macrumors.com/2023/04/03/apple-stopped-m2-chip-production-1q-2023/"
              >Apple Halted M2 Chip Production in January Amid 'Plummeting' Mac
              Sales</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 09:58:44</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35420946"
                  >Comments</a
                ><span class="descendants">: 241</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35420863">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Wronger_than_wrong"
              >Wronger Than Wrong</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 09:48:03</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35420863"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35420553">
          <h3>
            <a
              class="item"
              href="http://richg42.blogspot.com/2023/04/a-dead-simple-lossless-or-lossy-lz4.html"
              >The Near-Lossless Image Formats Using Ultra-Fast LZ Codecs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 09:09:24</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35420553"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35419771">
          <h3>
            <a class="item" href="https://pouria.dev/unknown-pleasures"
              >Show HN: Unknown Pleasures, a tiny web experiment with WebGL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 07:28:01</span
              ><span class="points-container"
                >Points: <span class="points">432</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35419771"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35418760">
          <h3>
            <a class="item" href="https://ersei.net/en/blog/bye-bye-github"
              >Saying Goodbye to GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 05:04:25</span
              ><span class="points-container"
                >Points: <span class="points">411</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35418760"
                  >Comments</a
                ><span class="descendants">: 316</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35416224">
          <h3>
            <a
              class="item"
              href="https://www.xda-developers.com/starlink-internet-rural-savior-unreliable-luxury/"
              >Starlink internet is going from rural savior to unreliable
              luxury</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 23:00:05</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35416224"
                  >Comments</a
                ><span class="descendants">: 250</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35413770">
          <h3>
            <a
              class="item"
              href="https://onlinelibrary.wiley.com/doi/10.1002/advs.202300111"
              >Reducing Iron Oxide with Ammonia: A Sustainable Path to Green
              Steel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 18:43:16</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35413770"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35408835">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Privilegium_Maius"
              >Privilegium Maius</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 09:45:51</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35408835"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35407617">
          <h3>
            <a
              class="item"
              href="https://www.theartnewspaper.com/2023/03/29/juan-de-pareja-from-slave-to-old-master"
              >Juan de Pareja: from Diego Velázquez’s slave to distinguished
              artist</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 05:55:53</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35407617"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35407578">
          <h3>
            <a
              class="item"
              href="https://daily.jstor.org/what-it-sounds-like-when-doves-cry/"
              >What it Sounds Like When Doves Cry: transcribing bird sound as
              human speech</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-02 @ 05:47:46</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35407578"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35401185">
          <h3>
            <a
              class="item"
              href="https://kottke.org/15/02/the-origin-of-the-joy-divisions-unknown-pleasures-album-cover-art"
              >The Origin of Joy Division’s Unknown Pleasures Album Cover Art
              (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 15:47:31</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35401185"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35401126">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=81ebWToAnvA"
              >Can water solve a maze? [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 15:40:00</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35401126"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35401114">
          <h3>
            <a
              class="item"
              href="https://archive.org/details/MacUser9606June1996"
              >MacUser 1996: How to Rig Up the Fastest Photoshop Machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 15:38:28</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35401114"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35400994">
          <h3>
            <a
              class="item"
              href="https://medium.com/sort-of-like-a-tech-diary/the-problems-that-attract-the-smartest-people-a384d2f8af"
              >The Problems That Attract the Smartest People</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 15:23:44</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35400994"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35400671">
          <h3>
            <a
              class="item"
              href="https://www.rogerebert.com/reviews/solaris-1976"
              >Solaris movie review and film summary (1976)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 14:43:36</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35400671"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35400562">
          <h3>
            <a
              class="item"
              href="https://every.to/no-small-plans/the-status-trap"
              >Pursuing status will never bring true happiness</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 14:29:45</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35400562"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35400006">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2023/04/03/the-data-delusion"
              >The Data Delusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 13:04:38</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35400006"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35399848">
          <h3>
            <a
              class="item"
              href="https://www.servethehome.com/what-is-a-mcr-dimm-or-multiplexer-combined-ranks-dimm-sk-hynix-micron-samsung-intel-amd-nvidia/"
              >What Is an MCR or Multiplexer Combined Ranks DIMM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 12:43:23</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35399848"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35399221">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=pwGdw0eZVCQ"
              >3Dfx Voodoo Memory Upgrade – 6MB Mod [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-01 @ 11:03:54</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35399221"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
