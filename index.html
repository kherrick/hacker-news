<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39046930">
          <h3>
            <a
              class="item"
              href="https://www.greenpeace.org/international/press-release/64831/environmental-youth-groups-win-climate-court-case-against-norwegian-state/"
              >Norwegian youth win climate court case against the Norwegian
              State</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 20:08:20</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39046930"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39046761">
          <h3>
            <a
              class="item"
              href="https://www.saastr.com/venture-backed-theres-a-third-way-just-raise-one-round/"
              >Venture Backed or Bootstrapped? There's a Third Way. Just Raise
              One Round</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 19:55:41</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39046761"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39046541">
          <h3>
            <a
              class="item"
              href="https://nautil.us/cells-across-the-body-talk-to-each-other-about-aging-494209/"
              >Cells Across the Body Talk to Each Other About Aging</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 19:39:36</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39046541"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39046534">
          <h3>
            <a
              class="item"
              href="https://www.miele.com/brand/en/revolutionary-excellence-38683.htm"
              >The Miele Dialog: cook a fish in ice without melting the ice</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 19:38:51</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39046534"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39046167">
          <h3>
            <a
              class="item"
              href="https://brettscott.substack.com/p/a-lego-model-of-corporate-capitalism"
              >A Lego Model of Corporate Capitalism</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 19:08:59</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39046167"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39045598">
          <h3>
            <a
              class="item"
              href="https://developer.chrome.com/blog/new-in-webgpu-121"
              >WebGPU is now available on Android</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 18:29:57</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39045598"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39045417">
          <h3>
            <a
              class="item"
              href="https://shubhamjain.co/2023/01/18/ditching-paas-why-i-went-back-to-self-hosting/"
              >Ditching PaaS: Why I Went Back to Self-Hosting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 18:20:35</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39045417"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39044985">
          <h3>
            <a class="item" href="https://www.bbc.com/news/health-67793887"
              >New cancer drug kinder than chemotherapy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 17:54:27</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39044985"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39044663">
          <h3>
            <a class="item" href="https://github.com/apple/ml-aim"
              >Scalable Pre-Training of Large Autoregressive Image Models (Aim
              by Apple)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 17:30:44</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39044663"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39044586">
          <h3>
            <a
              class="item"
              href="https://www.construction-physics.com/p/what-happened-to-the-us-machine-tool"
              >What happened to the US machine tool industry?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 17:25:43</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39044586"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39043871">
          <h3>
            <a
              class="item"
              href="https://waxy.org/2024/01/the-quiet-death-of-ellos-big-dreams/"
              >The quiet death of Ello's big dreams</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 16:35:59</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39043871"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39043469">
          <h3>
            <a
              class="item"
              href="https://folklore.org/Scrooge_McDuck.html?sort=date"
              >Scrooge McDuck: The first image on the first Macintosh (1980)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 16:08:35</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39043469"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39043306">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/micro-wind-power-kitepower"
              >Flying kites deliver container-sized power generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 15:56:28</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39043306"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39042093">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39042093"
              >Launch HN: Talc AI (YC S23) – Test Sets for AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 14:32:55</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39042093"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
            <div class="text">
              <a href="https://talc.ai/demo">https://talc.ai/demo</a>
              <p>
                We’ve found that it's very difficult to know how well LLM
                applications (and especially RAG systems) are going to work in
                the wild. Many companies tackle this by having developers or
                contractors run tests manually. It’s a slow process that holds
                back development, and often results in unexpected behavior when
                the application ships.
              </p>
              <p>
                We’ve dealt with similar problems before; Max was a staff
                engineer working on systematic technical solutions for privacy
                problems at facebook, and Matt worked on ML ops on facebooks’
                election integrity team, helping run classifiers that handled
                trillions of data points. We learned that even the best
                predictive systems need to be deeply understood and trusted to
                be useful to product teams, and set out to build the same
                understanding in AI.
              </p>
              <p>
                To solve this, we take ideas from academia on how to benchmark
                the general capabilities of language models, and apply them to
                generating domain specific test cases that run against your
                actual prompts and code.
              </p>
              <p>
                Consider an analogy: If you’re a lawyer, we don’t need to be
                lawyers to open up a legal textbook and test your knowledge of
                the content. Similarly if you’re building a legal AI
                application, we don’t need to build your application to come up
                with an effective set of tests that can benchmark your
                performance.
              </p>
              <p>
                To make this more concrete - when you pick a topic in the demo,
                we grab the associated wikipedia page and extract a bunch of
                facts from it using a classic NLP technique called “named entity
                recognition”. For example if you picked FreeBASIC, we might
                extract the following line from it:
              </p>
              <p></p>
              <pre><code>    Source of truth: "IDEs specifically made for FreeBASIC include FBide and FbEdit,[5] while more graphical options include WinFBE Suite and VisualFBEditor." 

</code></pre>
              This line is our source of truth. We then use an LLM to work
              backwards from this fact into a question and answer:
              <p></p>
              <pre><code>    Question: "What programming language are the IDEs WinFBE Suite and FbEdit designed to support?"
    Reference Answer: "FreeBasic"

</code></pre>
              We can then evaluate accurately by comparing the reference answer
              and the original source of truth– this is how we generate “simple”
              questions in the demo.
              <p>
                In production we’re building this same functionality on our
                customers' knowledge base instead of wikipedia. We then employ a
                few different strategies to generate questions – these range
                from simple factual questions like “how much does the 2024 chevy
                tahoe cost”, to complex questions like “What would a mechanic
                have to do to fix the recall on my 2018 Golf?” These questions
                are based on facts extracted from your knowledge base and real
                customer examples.
              </p>
              <p>
                This testing and grading process is fast – it’s driven by a
                mixture of LLMs and traditional algorithms, and can turn around
                in minutes. Our business model is pretty simple - we charge for
                each test created. If you opt to use our grading product as well
                we charge for each example graded against the test.
              </p>
              <p>
                We’re excited to hear what the HN community thinks – please let
                us know in the comments if you have any feedback, questions or
                concerns!
              </p>
            </div>
          </section>
        </section>
        <section id="39041942">
          <h3>
            <a
              class="item"
              href="https://www.heritagedaily.com/2024/01/archaeologists-find-intact-medieval-gauntlet/150272"
              >Archaeologists find intact medieval gauntlet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 14:20:29</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39041942"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39041520">
          <h3>
            <a
              class="item"
              href="https://blog.polybdenum.com/2024/01/17/identifying-the-collect-vec-memory-leak-footgun.html"
              >Identifying Rust's collect:&amp;gt;() memory leak footgun</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 13:38:02</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39041520"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39041477">
          <h3>
            <a
              class="item"
              href="https://ferd.ca/queues-don-t-fix-overload.html"
              >Queues don't fix overload (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 13:33:52</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39041477"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39040839">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2024/01/17/study-field-drug-tests-generate-nearly-30000-bogus-arrests-a-year/"
              >Study: Field Drug Tests Generate Nearly 30k Bogus Arrests a
              Year</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 12:21:39</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39040839"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39040718">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/gym-class-by-irl-studios/jobs/XG7v8sQ-lead-applied-ai-gaming-engineer"
              >Gym Class VR (YC W22) Is Hiring Lead Applied AI Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 12:00:54</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39040023">
          <h3>
            <a class="item" href="https://flattr.com/"
              >Flattr is closing down</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 10:12:26</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39040023"
                  >Comments</a
                ><span class="descendants">: 161</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39039588">
          <h3>
            <a
              class="item"
              href="https://wiki.archiveteam.org/index.php/A_Million_Ways_to_Die_on_the_Web"
              >A million ways to die on the web</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 09:02:49</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39039588"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39036842">
          <h3>
            <a
              class="item"
              href="https://www.fortressofdoors.com/i-lost-my-son/"
              >Losing my son</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-18 @ 02:34:24</span
              ><span class="points-container"
                >Points: <span class="points">2087</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39036842"
                  >Comments</a
                ><span class="descendants">: 306</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39032752">
          <h3>
            <a
              class="item"
              href="https://michael.stapelberg.ch/posts/2024-01-17-systemd-indefinite-service-restarts/"
              >Systemd: Enable Indefinite Service Restarts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-17 @ 20:08:34</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39032752"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39031555">
          <h3>
            <a class="item" href="https://queue.acm.org/detail.cfm?id=3639445"
              >How to Design an ISA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-17 @ 18:33:45</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39031555"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39029279">
          <h3>
            <a
              class="item"
              href="https://ntietz.com/blog/rsa-deceptively-simple/"
              >RSA is deceptively simple and fun</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-17 @ 15:46:02</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39029279"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39024102">
          <h3>
            <a
              class="item"
              href="https://gustedt.wordpress.com/2024/01/16/white-space-does-matter-in-c23/"
              >White space does matter in C23</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-17 @ 06:45:15</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39024102"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39023301">
          <h3>
            <a
              class="item"
              href="https://huyenchip.com/2024/01/16/sampling.html"
              >Sampling for Text Generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-17 @ 04:27:46</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39023301"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39007384">
          <h3>
            <a
              class="item"
              href="https://www.hezmatt.org/~mpalmer/blog/2024/01/16/pwned-certificates-on-the-fediverse.html"
              >Pwned Certificates on the Fediverse</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 23:19:32</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39007384"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39000730">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/01/15/worlds-five-richest-men-have-doubled-their-fortunes-since-2020-oxfam.html"
              >Five richest men have doubled their wealth since 2020</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 13:30:37</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39000730"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38999069">
          <h3>
            <a
              class="item"
              href="https://open-std.org/JTC1/SC22/WG14/www/docs/n3212.pdf"
              >Polymorphic Types in C [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 10:02:26</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38999069"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
