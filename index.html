<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40315551">
          <h3>
            <a
              class="item"
              href="https://www.dezeen.com/2024/02/06/polestar-4-eliminiates-rear-window/"
              >Polestar eliminates the rear window in latest electric car</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 04:43:01</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40315551"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40315434">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.17027"
              >Player-Driven Emergence in LLM-Driven Game Narrative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 04:05:29</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40315434"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40315400">
          <h3>
            <a class="item" href="https://lwn.net/Articles/444910/"
              >Object oriented design patterns in the Linux kernel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 03:58:42</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40315400"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40315394">
          <h3>
            <a
              class="item"
              href="https://www.swpc.noaa.gov/news/media-advisory-noaa-forecasts-severe-solar-storm-media-availability-scheduled-friday-may-10"
              >NOAA Forecasts Solar Storm (G4)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 03:56:38</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40315394"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40315274">
          <h3>
            <a
              class="item"
              href="https://words.filippo.io/dispatches/telegram-ecdh/"
              >The Most Backdoor-Looking Bug I've Ever Seen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 03:33:11</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40315274"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40315022">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2405.00738"
              >Energy-Efficient Llama 2 Inference on FPGAs via High Level
              Synthesis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 02:46:11</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40315022"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40314285">
          <h3>
            <a
              class="item"
              href="https://direct.mit.edu/books/oa-monograph/5770/Weapons-in-SpaceTechnology-Politics-and-the-Rise"
              >Weapons in Space Technology, Politics, and the Rise and Fall of
              SDI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 00:16:39</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40314285"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40314236">
          <h3>
            <a
              class="item"
              href="https://www.cs.utexas.edu/~gdurrett/courses/online-course/materials.html"
              >CS388: Natural Language Processing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 00:09:11</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40314236"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40314188">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/05/09/chips-and-cheese-state-of-the-union/"
              >Chips and Cheese State of the Union</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 00:01:16</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40314188"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40313798">
          <h3>
            <a class="item" href="https://github.com/wayland-transpositor/wprs"
              >Wprs – rootless remote desktop for Wayland (and X11, via
              XWayland) applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 23:02:14</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40313798"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40313792">
          <h3>
            <a
              class="item"
              href="https://chinabooksreview.com/2024/05/09/a-record-of-old-kashgar/"
              >A Record of Old Kashgar</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 23:00:55</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40313792"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40313769">
          <h3>
            <a
              class="item"
              href="https://www.hackerfactor.com/blog/index.php?/archives/1031-C2PA-from-the-Attackers-Perspective.html"
              >C2PA from the Attacker's Perspective</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 22:56:55</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40313769"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40313451">
          <h3>
            <a
              class="item"
              href="https://www.sustainabilitybynumbers.com/p/peak-pollution"
              >The world has probably passed peak pollution</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 22:11:41</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40313451"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40313143">
          <h3>
            <a class="item" href="https://github.com/ahrm/sioyek"
              >Sioyek is a PDF viewer with a focus on textbooks and research
              papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 21:28:43</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40313143"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40312500">
          <h3>
            <a
              class="item"
              href="https://slate.com/culture/2024/05/light-eaters-zoe-schlanger-book-plant-intelligence.html"
              >Being Green: A new book marvels at the strangeness of plants</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 20:14:39</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40312500"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40312469">
          <h3>
            <a
              class="item"
              href="https://www.leonarddavid.com/blinded-by-the-light-megaconstellation-clash-with-astronomical-peer-groups/"
              >How bad are satellite megaconstellations for astronomy?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 20:11:21</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40312469"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40310896">
          <h3>
            <a
              class="item"
              href="https://brooker.co.za/blog/2024/05/09/nagle.html"
              >It's always TCP_NODELAY</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 17:54:49</span
              ><span class="points-container"
                >Points: <span class="points">567</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40310896"
                  >Comments</a
                ><span class="descendants">: 188</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40310278">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/freshpaint/bfe56523-bff4-4ca3-936b-0ba15fb4e572?utm_source=hn"
              >Freshpaint (YC S19) is hiring software engineers to protect
              patient privacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 17:00:54</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40309759">
          <h3>
            <a class="item" href="https://github.com/zircothc/DRUM_2004_V1"
              >ESP32 Drum Synth Machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 16:17:14</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40309759"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40309719">
          <h3>
            <a class="item" href="https://www.ellipsis.dev/"
              >Show HN: Ellipsis – Automated PR reviews and bug fixes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 16:14:47</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40309719"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.ellipsis.dev">https://www.ellipsis.dev</a>).
              Ellipsis automatically reviews your PRs when opened and on each
              new commit. If you tag @ellipsis-dev in a comment, it can make
              changes to the PR (via direct commit or side PR) and answer
              questions, just like a human.
              <p>
                Demo video:
                <a href="https://www.youtube.com/watch?v=X61NGZpaNQA"
                  >https://www.youtube.com/watch?v=X61NGZpaNQA</a
                >
              </p>
              <p>
                So far, we have dozens of open source projects and companies
                using Ellipsis. We seem to have landed in a kind of sweet spot
                where there’s a good match between the current capabilities of
                AI tools and the actual needs of software engineers - this
                doesn’t replace human review, but it saves you time by
                catching/fixing lots of small silly stuff.
              </p>
              <p>
                Here’s an example in the wild:
                <a href="https://github.com/relari-ai/continuous-eval/pull/38"
                  >https://github.com/relari-ai/continuous-eval/pull/38</a
                >. Ellipsis (1) adds a PR summary; (2) finds a bug and adds a
                review comment; (3) after a (human) user comments, generates a
                side PR with the fix; and (4) after a (human) user merges the
                side PR and adds another commit, re-reviews the PR and approves
                it
              </p>
              <p>
                Here’s another example:
                <a
                  href="https://github.com/SciPhi-AI/R2R/pull/350#pullrequestreview-204013694"
                  >https://github.com/SciPhi-AI/R2R/pull/350#pullrequestreview-...</a
                >, where Ellipsis adds several comments with inline suggestions
                that were directly merged by the developer.
              </p>
              <p>
                You can configure Ellipsis in natural language to enforce custom
                rules, style guides, or conventions. For example, here’s how the
                `jxnl/instructor` repo uses natural language rules to make sure
                that docs are kept in sync:
                <a
                  href="https://github.com/jxnl/instructor/blob/main/ellipsis.yaml#L13-L14"
                  >https://github.com/jxnl/instructor/blob/main/ellipsis.yaml#L...</a
                >, and here’s an example PR that Ellipsis came up with based on
                those rules:
                <a href="https://github.com/jxnl/instructor/pull/346"
                  >https://github.com/jxnl/instructor/pull/346</a
                >.
              </p>
              <p>
                Installing into your repo takes 2 clicks at
                <a href="https://www.ellipsis.dev">https://www.ellipsis.dev</a>.
                You do have to sign up to try it out because we need you to
                authorize our GitHub app to read your code. Don’t worry, your
                code is never stored or used to train models (<a
                  href="https://docs.ellipsis.dev/security"
                  >https://docs.ellipsis.dev/security</a
                >).
              </p>
              <p>We’d really appreciate your feedback, thoughts, and ideas!</p>
            </div>
          </section>
        </section>
        <section id="40309342">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40309342"
              >Launch HN: Muddy (YC S19) – Multiplayer browser for getting work
              done</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 15:38:48</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40309342"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
            <div class="text">
              <a href="https://feelmuddy.com/">https://feelmuddy.com/</a>).
              Muddy is a browser for work that automatically keeps project files
              organized in the same place where you use and share them. Here’s a
              demo:
              <a href="https://www.youtube.com/watch?v=tZr49aN3sjQ"
                >https://www.youtube.com/watch?v=tZr49aN3sjQ</a
              >. Download and try it out here:
              <a href="https://feelmuddy.com/">https://feelmuddy.com/</a>.
              <p>
                Building together in the past, we were incredibly frustrated
                with how much friction there is to get anything done on our
                computers. I was losing time everyday digging through chat logs
                looking for that one important link or breaking others out of
                flow by asking where something is.
              </p>
              <p>
                Web apps promised to help us get more done—and they do, but each
                in its own silo, so there’s still a ton of redundancy to deal
                with. Every app has its own way of organizing files, its own
                notification inbox, its own search system. Conversations live
                everywhere and there isn’t a single view to see everything about
                a project. Remember when files simply lived in folders rather
                than the “cloud”?
              </p>
              <p>
                We started dedicating time to organizing our files in shared
                docs and limiting new apps we used. This helped – but the second
                we didn’t stay on top of organization, links became stale and
                things got messy again.
              </p>
              <p>
                Muddy started as a hack week project we built for ourselves—a
                single place to use web apps with others, but personalized for
                each user automatically. Everyone gets their own view for every
                project, designed around how they work.
              </p>
              <p>
                Muddy users work on projects in spaces, which are like automatic
                tab groups. Users share apps (any site works—a Github PR, Figma
                file, Trello board—whatever you want) into the project’s shared
                timeline and Muddy automatically opens relevant tabs for you.
                It’s a single click to open up all the apps you need for the
                project.
              </p>
              <p>
                Under the hood, Muddy works in the background to keep track of
                the timeline and uses a LLM to continuously organize apps and
                keep everything on to date. It considers signals like the
                popularity of a file, naming conventions, and conversations to
                figure out what’s relevant. So everyone is presented with an
                updated list of important tabs, without anyone lifting a finger.
                Our actual browser is based on Chromium.
              </p>
              <p>
                When you need to revisit something from weeks ago, you can
                rewind the project timeline to that point in a single click.
                Apps open up in the timeline so you’ll see your files right
                away. For sites that don’t have built in collaboration features
                (like documentation), Muddy lets you do annotations directly on
                the website.
              </p>
              <p>
                Projects sometimes get big and need to be broken up. Across all
                your spaces, Muddy can answer questions like ChatGPT, cite your
                files as sources, and return apps directly. This is possible
                since Muddy’s AI shares your browser and can use your
                authenticated apps locally (with privacy in mind).
              </p>
              <p>
                Other browsers like Chrome and Arc focus on solo productivity
                with sharing as a bolt-on. We think productivity depends on how
                well you can work with others, and should be the first class
                consideration. And doing organizational work manually is
                unsustainable.
              </p>
              <p>
                Muddy will have paid subscriptions for teams with additional
                features like shared passwords, team organization, custom
                shortcuts, and SSO management. Those aren’t built out yet and
                the base product will be free. No part of our revenue will come
                from data monetization.
              </p>
              <p>
                We’d love for you to give Muddy a spin! You can download Muddy
                for Mac or Windows on our website and add others once inside:
                <a href="https://feelmuddy.com/">https://feelmuddy.com/</a>.
                We’ll be around to answer questions and look forward to any and
                all feedback!
              </p>
            </div>
          </section>
        </section>
        <section id="40307519">
          <h3>
            <a class="item" href="https://blog.wilsonl.in/hackerverse/"
              >Show HN: Exploring HN by mapping and analyzing 40M posts and
              comments for fun</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 12:31:04</span
              ><span class="points-container"
                >Points: <span class="points">383</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40307519"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40307454">
          <h3>
            <a class="item" href="https://github.com/tembo-io/pgmq"
              >Show HN: An SQS Alternative on Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 12:21:53</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40307454"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40307138">
          <h3>
            <a
              class="item"
              href="https://www.independent.co.uk/news/health/deaf-cure-girl-gene-therapy-b2541735.html"
              >Deaf girl is cured in world first gene therapy trial</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 11:38:14</span
              ><span class="points-container"
                >Points: <span class="points">582</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40307138"
                  >Comments</a
                ><span class="descendants">: 274</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40307098">
          <h3>
            <a class="item" href="https://github.com/Hirrolot/datatype99"
              >Algebraic Data Types for C99</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 11:31:27</span
              ><span class="points-container"
                >Points: <span class="points">323</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40307098"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40306463">
          <h3>
            <a class="item" href="https://lovehindpa.ws/posts/xilinx-hbm2/"
              >Xilinx HBM2 Internals (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 09:08:06</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40306463"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40296734">
          <h3>
            <a class="item" href="https://briefer.cloud/blog/posts/logarithms/"
              >Logarithmic Scales</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 11:25:49</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40296734"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40292853">
          <h3>
            <a
              class="item"
              href="https://n1vux.github.io/articles/Geodetic/RTK-experiments.html"
              >RTK Experiments</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 23:49:50</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40292853"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40290228">
          <h3>
            <a
              class="item"
              href="https://hakaimagazine.com/features/how-viking-age-hunters-took-down-the-biggest-animal-on-earth/"
              >Viking-Age Hunters Took Down the Biggest Animal on Earth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 19:12:15</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40290228"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40261378">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-05-medieval-england-leprosy-red-squirrels.html"
              >In medieval England, leprosy spread btwn red squirrels/people,
              genome evidence</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 00:13:44</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40261378"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
