<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44734475">
          <h3>
            <a
              class="item"
              href="https://www.channable.com/tech/introducing-opsqueue"
              >Opsqueue: Lightweight batch processing queue for heavy loads –
              now open-source</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 14:12:09</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44734475"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44734263">
          <h3>
            <a
              class="item"
              href="https://marginalrevolution.com/marginalrevolution/2025/07/the-rising-cost-of-child-and-pet-day-care.html"
              >The Rising Cost of Child and Pet Day Care</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 13:55:33</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44734263"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44734260">
          <h3>
            <a
              class="item"
              href="https://grillbert.substack.com/p/nmda-receptor-antagonists-a-bit-more"
              >NMDA Receptor Antagonists: Slightly More Than You Wanted to
              Know</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 13:55:25</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44734260"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44733983">
          <h3>
            <a class="item" href="https://www.doist.dev/bitmapist/"
              >Bitmapist: We built an open-source cohorts analytics tool that
              saved millions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 13:33:37</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44733983"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44733968">
          <h3>
            <a
              class="item"
              href="https://tomscheers.github.io/2025/07/29/writing-memory-efficient-structs-post.html"
              >Writing memory efficient C structs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 13:32:23</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44733968"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44733888">
          <h3>
            <a
              class="item"
              href="https://www.energyvanguard.com/blog/try-the-mosquito-bucket-of-death/"
              >Try the Mosquito Bucket of Death</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 13:24:10</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44733888"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44733817">
          <h3>
            <a class="item" href="https://oxide.computer/blog/our-100m-series-b"
              >Our $100M Series B</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 13:17:28</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44733817"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44733742">
          <h3>
            <a
              class="item"
              href="https://blog.glyphdrawing.club/moebiusxbin-ascii-and-text-mode-art-editor-with-custom-font-support/"
              >Show HN: MoebiusXBIN – ASCII and text-mode art editor with custom
              font support</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 13:11:06</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44733742"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44733734">
          <h3>
            <a
              class="item"
              href="https://jeroen.github.io/notes/webassembly-curl/"
              >Making Libcurl Work in WebAssembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 13:09:27</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44733734"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44733341">
          <h3>
            <a class="item" href="https://www.jstor.org/stable/41548580"
              >Problem Solving Is Often a Matter of Cooking Up an Appropriate
              Markov Chain</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 12:29:52</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44733341"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44733119">
          <h3>
            <a class="item" href="https://www.htmlhobbyist.com/"
              >The HTML Hobbyist</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 12:03:54</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44733119"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44733094">
          <h3>
            <a class="item" href="https://os.phil-opp.com/"
              >Blog series on creating an OS in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 12:01:10</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44733094"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44733086">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/cedana/jobs/zRmK2by-systems-engineer-advanced-orchestration"
              >Cedana (YC S23) Is Hiring a Systems Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 12:00:30</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44732937">
          <h3>
            <a
              class="item"
              href="https://www.axios.com/2025/07/30/merger-hpe-juniper-networks-national-security"
              >U.S. intelligence intervened with DOJ to push HPE-Juniper
              merger</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 11:38:10</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44732937"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44732700">
          <h3>
            <a
              class="item"
              href="https://bitcoinke.io/2025/07/moneybadger-peach-payments-partnership/"
              >Moneybadger and Peach Payments partner to enable Bitcoin
              payments</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 10:50:39</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44732700"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44732593">
          <h3>
            <a
              class="item"
              href="https://cborbook.com/introduction/from_xml_to_json_to_cbor.html"
              >From XML to JSON to CBOR</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 10:31:12</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44732593"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44732345">
          <h3>
            <a class="item" href="https://panamaplaylists.com/"
              >PanamaPlaylists – Leaked Tech CEOs Spotify Profiles</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 09:29:38</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44732345"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44732020">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/blog-post/it-all-comes-down-mitochondria"
              >Sleep all comes down to the mitochondria</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 08:34:10</span
              ><span class="points-container"
                >Points: <span class="points">329</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44732020"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44731958">
          <h3>
            <a
              class="item"
              href="https://www.latimes.com/entertainment-arts/story/2025-07-29/awdah-hathaleen-killed-no-other-land-palestinian-activist-israeli-settler"
              >Oscar-Winning 'No Other Land' Awdah Hathaleen Killed by Israeli
              Settler</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 08:19:46</span
              ><span class="points-container"
                >Points: <span class="points">306</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44731958"
                  >Comments</a
                ><span class="descendants">: 191</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44729865">
          <h3>
            <a
              class="item"
              href="https://earthquake.usgs.gov/earthquakes/eventpage/us6000qw60/executive"
              >M8.7 earthquake in Western Pacific, tsunami warning issued</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 00:38:25</span
              ><span class="points-container"
                >Points: <span class="points">803</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44729865"
                  >Comments</a
                ><span class="descendants">: 215</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44728833">
          <h3>
            <a
              class="item"
              href="https://www.lorenstew.art/blog/bookmarkable-by-design-url-state-htmx/"
              >URL-Driven State in HTMX</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 22:09:48</span
              ><span class="points-container"
                >Points: <span class="points">260</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44728833"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44728188">
          <h3>
            <a
              class="item"
              href="https://JapaneseNostalgicCar.com/rip-shunsaku-tamiya-plastic-model-kits/"
              >RIP Shunsaku Tamiya, the man who made plastic model kits a global
              obsession</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 20:57:47</span
              ><span class="points-container"
                >Points: <span class="points">366</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44728188"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44725966">
          <h3>
            <a class="item" href="https://www.acm.org/publications/openaccess"
              >ACM Transitions to Full Open Access</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 17:17:58</span
              ><span class="points-container"
                >Points: <span class="points">358</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44725966"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44725764">
          <h3>
            <a class="item" href="https://openai.com/index/chatgpt-study-mode/"
              >Study mode</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 17:01:14</span
              ><span class="points-container"
                >Points: <span class="points">1028</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44725764"
                  >Comments</a
                ><span class="descendants">: 738</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44725306">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44725306"
              >Launch HN: Hyprnote (YC S25) – An open-source AI meeting
              notetaker</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 16:24:08</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44725306"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
            <div class="text">
              <a href="https://hyprnote.com">https://hyprnote.com</a>). We're
              building an open-source, privacy-first AI note-taking app that
              runs fully on-device. Think of it as an open-source Granola. No
              Zoom bots, no cloud APIs, no data ever leaves your machine.
              <p>
                Source code:
                <a href="https://github.com/fastrepl/hyprnote"
                  >https://github.com/fastrepl/hyprnote</a
                >
                Demo video:
                <a href="https://hyprnote.com/demo"
                  >https://hyprnote.com/demo</a
                >
              </p>
              <p>
                We built Hyprnote because some of our friends told us that their
                companies banned certain meeting notetakers due to data
                concerns, or they simply felt uncomfortable sending data to
                unknown servers. So they went back to manual note-taking -
                losing focus during meetings and wasting time afterward.
              </p>
              <p>
                We asked: could we build something just as useful, but
                completely local?
              </p>
              <p>
                Hyprnote is a desktop app that transcribes and summarizes
                meetings on-device. It captures both your mic input and system
                audio, so you don't need to invite bots. It generates a summary
                based on the notes you take. Everything runs on local AI models
                by default, using Whisper and HyprLLM. HyprLLM is our
                proof-of-concept model fine-tuned from Qwen3 1.7B. We learned
                that summarizing meetings is a very nuanced task and that a
                model's raw intelligence (or weight) doesn't matter THAT much.
                We'll release more details on evaluation and training once we
                finish the 2nd iteration of the model (still not that good we
                can make it a lot better).
              </p>
              <p>
                Whisper inference:
                <a
                  href="https://github.com/fastrepl/hyprnote/blob/main/crates/whisper-local/src/model.rs"
                  >https://github.com/fastrepl/hyprnote/blob/main/crates/whispe...</a
                >
              </p>
              <p>
                AEC inference:
                <a
                  href="https://github.com/fastrepl/hyprnote/blob/main/crates/aec/src/lib.rs"
                  >https://github.com/fastrepl/hyprnote/blob/main/crates/aec/sr...</a
                >
              </p>
              <p>
                LLM inference:
                <a
                  href="https://github.com/fastrepl/hyprnote/blob/main/crates/llama/src/lib.rs"
                  >https://github.com/fastrepl/hyprnote/blob/main/crates/llama/...</a
                >
              </p>
              <p>
                We also learned that for some folks, having full data
                controllability was as important as privacy. So we support
                custom endpoints, allowing users to bring in their company's
                internal LLM. For teams that need integrations, collaboration,
                or admin controls, we're working on an optional server component
                that can be self-hosted. Lastly, we're exploring ways to make
                Hyprnote work like VSCode, so you can install extensions and
                build your own workflows around your meetings.
              </p>
              <p>
                We believe privacy-first tools, powered by local models, are
                going to unlock the next wave of real-world AI apps.
              </p>
              <p>We're here and looking forward to your comments!</p>
            </div>
          </section>
        </section>
        <section id="44723461">
          <h3>
            <a class="item" href="https://candid9.com/phone-camera/"
              >iPhone 16 cameras vs. traditional digital cameras</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 13:58:06</span
              ><span class="points-container"
                >Points: <span class="points">433</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44723461"
                  >Comments</a
                ><span class="descendants">: 422</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44703210">
          <h3>
            <a class="item" href="https://github.com/vvvvv/dlg"
              >Show HN: Dlg – Zero-cost printf-style debugging for Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 18:02:13</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44703210"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                I tend to use printf-style debugging as my primary
                troubleshooting method and only resort to gdb as a last resort.
              </p>
              <p>
                While I like its ease of use printf debugging isn't without its
                annoyances, namely removing the print statements once you're
                done.
              </p>
              <p>
                I used to use trace-level logging from proper logging libraries
                but adding trace calls in every corner quickly gets out of
                control and results in an overwhelming amount of output.
              </p>
              <p>
                To scratch my own itch I created dlg - a minimal debugging
                library that disappears completely from production builds. Its
                API exposes just a single function, Printf [1].
              </p>
              <p>
                dlg is optimized for performance in debug builds and, most
                importantly, when compiled without the dlg build tag, all calls
                are eliminated by the Go linker as if dlg was never imported.
              </p>
              <p>
                For debug builds it adds optional stack trace generation
                configurable via environment variables or linker flags.
              </p>
              <p>
                GitHub:
                <a href="https://github.com/vvvvv/dlg"
                  >https://github.com/vvvvv/dlg</a
                >
              </p>
              <p>Any feedback is much appreciated.</p>
              <p>[1]: Actually two functions - there's also SetOutput.</p>
            </div>
          </section>
        </section>
        <section id="44699174">
          <h3>
            <a
              class="item"
              href="https://www.infoworld.com/article/4023654/net-10-preview-6-brings-jit-improvements-one-shot-tool-execution.html"
              >.NET 10 Preview 6 brings JIT improvements, one-shot tool
              execution</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 05:53:40</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44699174"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44698413">
          <h3>
            <a
              class="item"
              href="https://www.peterbe.com/plog/a-python-dict-that-can-report-which-keys-you-did-not-use"
              >A Python dict that can report which keys you did not use</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-27 @ 02:22:51</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44698413"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44694606">
          <h3>
            <a class="item" href="https://github.com/dtenny/clj-coll"
              >Clj-coll: Clojure collections and sequences in Common Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-26 @ 14:58:49</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44694606"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
